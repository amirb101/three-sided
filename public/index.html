<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Three-Sided â€“ Community Flashcard App for STEM Students</title>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  
  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>
  
  <script src="https://js.stripe.com/v3/"></script>

  <meta name="description" content="Join the Three-Sided community of STEM students sharing and studying flashcards together. Discover thousands of user-generated cards with AI-powered assistance for hints and proofs.">
  <link rel="canonical" href="https://three-sided.com/" />
  
<link rel="stylesheet" href="styles/main.css">
<link rel="icon" type="image/png" href="/files/three-sided_logo.png">
</head>
<body>
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Three-Sided</h1>
      <p class="hero-subtitle">
        Join a community of STEM students sharing and studying flashcards together. 
        Create, discover, and learn from thousands of user-generated cards with AI-powered assistance.
      </p>
      <div class="hero-cta">
        <a href="search.html" class="btn btn-primary" target="_blank">
          ğŸ” Search Flashcards
        </a>
        <a href="updates.html" class="btn btn-secondary" target="_blank">
          ğŸ“‹ What's New?
        </a>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container">
      <!-- Features Grid -->
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">ğŸ‘¥</div>
          <h3 class="feature-title">Community-Driven</h3>
          <p class="feature-description">Discover and share flashcards with students worldwide. Learn from the community's collective knowledge.</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">ğŸ§ </div>
          <h3 class="feature-title">AI-Powered Assistance</h3>
          <p class="feature-description">Get AI-generated hints and proofs to help you create better flashcards faster.</p>
        </div>
        
        <div class="feature-card">
          <a href="latex_guide.html" style="text-decoration: none; color: inherit;">
          <div class="feature-icon">ğŸ“</div>
          <h3 class="feature-title">LaTeX Support</h3>
          <p class="feature-description">Beautiful mathematical notation with full LaTeX rendering. Wrap math in <code>$ $</code> for inline or <code>$$ $$</code> for blocks.</p>
          </a>
        </div>
      </div>

      <!-- Onboarding Checklist Section -->
      <div class="section" id="onboardingSection" style="margin-top: 2rem;">
        <h2 class="section-title" style="text-align:center;">ğŸš€ Get Started with Three-Sided</h2>
        <p style="text-align: center; font-size: 1.1rem; opacity: 0.9; margin-bottom: 2rem;">
          Complete these steps to join our community and start sharing flashcards!
        </p>
        
        <div class="onboarding-checklist" style="max-width: 600px; margin: 0 auto;">
          <div class="checklist-item" id="checklist-login" onclick="handleChecklistClick('login')" style="display: flex; align-items: center; padding: 1rem; margin-bottom: 1rem; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s;">
            <div class="checklist-icon" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid #e2e8f0; margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #e2e8f0;">1</div>
            <div class="checklist-content" style="flex: 1;">
              <h3 style="margin: 0 0 0.25rem 0; font-size: 1.1rem;">Sign in to your account</h3>
              <p style="margin: 0; color: #718096; font-size: 0.9rem;">Log in to start creating and sharing flashcards</p>
            </div>
            <div class="checklist-arrow" style="color: #a0aec0; font-size: 1.2rem;">â†’</div>
          </div>

          <div class="checklist-item" id="checklist-profile" onclick="handleChecklistClick('profile')" style="display: flex; align-items: center; padding: 1rem; margin-bottom: 1rem; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s; opacity: 0.5;">
            <div class="checklist-icon" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid #e2e8f0; margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #e2e8f0;">2</div>
            <div class="checklist-content" style="flex: 1;">
              <h3 style="margin: 0 0 0.25rem 0; font-size: 1.1rem;">Create your public profile</h3>
              <p style="margin: 0; color: #718096; font-size: 0.9rem;">Set up your profile to share with the community</p>
            </div>
            <div class="checklist-arrow" style="color: #a0aec0; font-size: 1.2rem;">â†’</div>
          </div>

          <div class="checklist-item" id="checklist-card" onclick="handleChecklistClick('card')" style="display: flex; align-items: center; padding: 1rem; margin-bottom: 1rem; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s; opacity: 0.5;">
            <div class="checklist-icon" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid #e2e8f0; margin-right: 1rem; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #e2e8f0;">3</div>
            <div class="checklist-content" style="flex: 1;">
              <h3 style="margin: 0 0 0.25rem 0; font-size: 1.1rem;">Publish your first card</h3>
              <p style="margin: 0; color: #718096; font-size: 0.9rem;">Create and share a flashcard with the community</p>
            </div>
            <div class="checklist-arrow" style="color: #a0aec0; font-size: 1.2rem;">â†’</div>
          </div>
        </div>
      </div>

      <!-- Community Search Widget -->
      <div class="section" style="margin-top: 2rem;">
        <div class="search-widget" style="background: linear-gradient(135deg, #0066cc 0%, #004a99 100%); border-radius: 16px; padding: 2rem; text-align: center; color: white; box-shadow: 0 10px 30px rgba(0, 102, 204, 0.4);">
          <div class="search-icon" style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”</div>
          <h2 style="font-size: 1.8rem; margin-bottom: 0.5rem; color: white;">Looking for a specific flashcard?</h2>
          <p style="font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.95; color: white;">
            Search our community flashcard database for exactly what you need. 
            Find cards from thousands of STEM students worldwide.
          </p>
          <a href="search.html" class="btn btn-secondary" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px); font-weight: 600; padding: 0.75rem 2rem; font-size: 1.1rem; border-radius: 50px; text-decoration: none; display: inline-block; transition: all 0.3s ease;">
            ğŸ” Search Community Flashcards
          </a>
        </div>
      </div>

      <!-- Leaderboard Section -->
      <div class="section" id="leaderboardSection" style="margin-top: 2rem;">
        <h2 class="section-title" style="text-align:center;">ğŸ† Leaderboard</h2>
        <button id="toggleLeaderboard" class="toggle-btn" style="margin: 0 auto 1rem auto; display: block;">
          â–¼ Click to see Leaderboard
        </button>
        <div id="leaderboardContent" style="display: none;">
          <div style="text-align:right; margin-bottom:0.5rem;">
            <label for="leaderboardSort" style="font-weight:500; color:#4a5568;">Sort by:</label>
            <select id="leaderboardSort" style="margin-left:0.5rem; padding:0.25rem 0.5rem; border-radius:6px;">
              <option value="upvotes">Upvotes</option>
              <option value="flashcards">Flashcards</option>
              <option value="streak">Streak</option>
            </select>
          </div>
          <div style="overflow-x:auto;">
            <table id="leaderboardTable" class="leaderboard-table" style="width:100%; background:#fff; border-radius:12px; box-shadow:0 4px 24px rgba(0,0,0,0.04); margin:0 auto;">
              <thead>
                <tr style="background:#f7fafc; color:#4a5568;">
                  <th style="padding:0.75rem 1rem;">#</th>
                  <th style="padding:0.75rem 1rem; text-align:left;">User</th>
                  <th style="padding:0.75rem 1rem;">Upvotes</th>
                  <th style="padding:0.75rem 1rem;">Flashcards</th>
                  <th style="padding:0.75rem 1rem;">Streak</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="5" style="text-align:center; color:#a0aec0;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Quick Tip -->
      <div class="auth-section">
        <h3>ğŸ’¡ Quick Start Tip</h3>
        <p>Import my sample flashcards above, then refresh this page to start studying immediately. Check out our <a href="cheatsheet.html" target="_blank" style="color: #667eea; font-weight: 600;">revision resources</a> for additional help!</p>
      </div>

      <!-- Authentication Section -->
      <div class="auth-section" id="authBox">
        <div id="authSummary" class="auth-summary" onclick="toggleAuthDetails()">
          <h3>ğŸ” Account Status</h3>
        </div>
        <div id="authDetails" style="margin-top: 1rem;">
          <button onclick="signInWithGoogle()" class="btn btn-primary" style="margin: 0.5rem;">Sign In with Google</button>
          <button onclick="logout()" class="btn btn-secondary" style="margin: 0.5rem; background: #0066cc; color: white; border: 2px solid #0066cc;">Log Out</button>        </div>
      </div>

      <!-- Profile Button -->
      <div id="profileBtnWrapper" class="profile-btn-wrapper" style="text-align: center; margin: 1rem 0;">
        <button id="profileBtn" class="btn btn-secondary custom-visible">My Public Profile</button>
      </div>

      <!-- Main Flashcard Display -->
      <div class="flashcard-preview" id="card" onclick="flip()">
        <div class="flashcard-content" style="text-align: center; color: #718096;">
          Please log in to start studying...
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button onclick="prevCard()" class="control-btn">â† Previous</button>
        <button onclick="nextCard()" class="control-btn">Next â†’</button>
        <button onclick="restartDeck()" class="control-btn">ğŸ”„ Restart</button>
        <button onclick="handleToggleFilter()" class="control-btn">ğŸ·ï¸ Filter</button>
        <button onclick="handleToggleListPopup()" class="control-btn">ğŸ“‹ View All</button>
        <button onclick="window.location.href = 'sr.html'" class="control-btn">ğŸ¯ Spaced Repetition</button>
      </div>

      <div id="status" style="text-align: center; margin: 1rem 0; color: #718096;"></div>

      <!-- Add Flashcard Form -->
      <div class="section">
        <h2 class="section-title">
          â• Add a Flashcard
        </h2>
        <button id="toggleAddForm" class="toggle-btn" onclick="uiRenderer.toggleAddForm()">
          â–¼ Try AI without signing up
        </button>

        <div id="addFormContent" style="display: none; margin-top: 2rem;">
          <div class="form-group">
            <textarea id="newStatement" class="form-control" placeholder="Statement (LaTeX supported $ \int $)" rows="5"></textarea>
          </div>
          
          <div class="button-group">
            <button onclick="autoFillFromStatement()" class="btn btn-primary">ğŸ¤– Autofill Hint, Proof & Tags</button>
            <button onclick="autoTagOnly()" class="btn-auto-tag">ğŸ·ï¸ Auto Tag Only</button>
          </div>
          
          <div class="form-group">
            <textarea id="newHints" class="form-control" placeholder="Hints (LaTeX supported)" rows="4"></textarea>
          </div>
          
          <div class="form-group">
            <textarea id="newProof" class="form-control" placeholder="Proof (LaTeX supported)" rows="6"></textarea>
          </div>
          
          <div class="form-group">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #4a5568;">Tags</label>
            <div class="tag-input-container" style="position: relative;">
              <textarea id="newTags" class="form-control" placeholder="Type tags here (comma-separated) or click existing tags below" rows="2"></textarea>
              <div class="existing-tags-section" style="margin-top: 0.5rem;">
                <div style="font-size: 0.9rem; color: #718096; margin-bottom: 0.5rem;">Click to add existing tags:</div>
                <div id="existingTagsList" class="existing-tags-list" style="display: flex; flex-wrap: wrap; gap: 0.5rem; max-height: 120px; overflow-y: auto; padding: 0.5rem; background: #f7fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                  <div style="color: #a0aec0; font-style: italic;">Loading existing tags...</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" id="makePublic"> 
              <span>Make this card public</span>
            </label>
          </div>
          
          <button onclick="addCard()" class="btn btn-primary">Add Card</button>
        </div>
      </div>

      <!-- LaTeX Conversion -->
      <div class="section">
        <h2 class="section-title">ğŸ”„ Convert Words to LaTeX</h2>
        <div class="form-group">
          <textarea id="naturalLangInput" class="form-control" placeholder="e.g. A direct sum B (copies to clipboard)" rows="3"></textarea>
        </div>
        <button onclick="convertToLatex()" class="btn btn-primary">Convert with DeepSeek</button>
        <div id="latexOutput" style="margin-top: 1rem; padding: 1rem; background: #f7fafc; border-radius: 8px; min-height: 50px; border: 2px dashed #e2e8f0;">
          LaTeX will appear here...
        </div>
      </div>

      <!-- Knowledge Tree Section -->
      <!-- <div class="section" id="knowledgeTreeSection">
        <h2 class="section-title" style="text-align: center;">ğŸŒ³ Your Knowledge Tree</h2>
        <p style="text-align: center; font-size: 1.1rem; opacity: 0.9; margin-bottom: 2rem;">
          Watch your learning journey grow into a beautiful tree. Each flashcard you study adds branches to your personal knowledge visualization.
        </p>
        <button id="toggleTreeSection" class="toggle-btn" onclick="toggleKnowledgeTree()" style="margin-bottom: 2rem;">
          â–¼ View Your Knowledge Tree
        </button>
        <div id="knowledgeTreeContent" style="display: none;">
          <div id="treeGrowthIndicator" class="growth-indicator" style="display: none; text-align: center; margin-bottom: 1rem;">
            ğŸŒ± <span id="treeNewCardsCount">0</span> new cards studied! Your tree is growing.
          </div>
          <div class="tree-stats-bar" style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <div class="tree-stat" style="text-align: center;">
              <div class="tree-stat-value" id="treeStatCards" style="font-size: 2rem; font-weight: 700;">0</div>
              <div class="tree-stat-label" style="opacity: 0.9;">Cards Studied</div>
            </div>
            <div class="tree-stat" style="text-align: center;">
              <div class="tree-stat-value" id="treeStatSessions" style="font-size: 2rem; font-weight: 700;">0</div>
              <div class="tree-stat-label" style="opacity: 0.9;">Study Sessions</div>
            </div>
            <div class="tree-stat" style="text-align: center;">
              <div class="tree-stat-value" id="treeStatStreak" style="font-size: 2rem; font-weight: 700;">0</div>
              <div class="tree-stat-label" style="opacity: 0.9;">Day Streak</div>
            </div>
          </div>
          <div class="tree-canvas-container" style="background: #fff; border-radius: 16px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
            <canvas id="knowledgeTreeCanvas" width="800" height="500" style="width: 100%; height: auto; border-radius: 8px;"></canvas>
            <div class="tree-loading-overlay" id="treeLoadingOverlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: none; align-items: center; justify-content: center; border-radius: 16px;">
              <div style="text-align: center;">
                <div style="width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                <div style="color: #667eea; font-weight: 600;">Growing your tree...</div>
              </div>
            </div>
          </div>
          <div class="tree-controls" style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
            <button onclick="regenerateKnowledgeTree()" class="btn btn-primary">
              Grow New Tree
            </button>
            <button onclick="shareKnowledgeTree()" class="btn btn-secondary">
              Share Progress
            </button>
            <button onclick="downloadKnowledgeTree()" class="btn btn-secondary">
              Download
            </button>
          </div>
          <div style="text-align: center; margin-top: 2rem; opacity: 0.8; font-style: italic;">
            Every branch represents your dedication to learning ğŸ’¡
          </div>
        </div>
      </div> -->


    <div style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
      <a href="https://www.producthunt.com/products/three-sided?embed=true&utm_source=badge-featured&utm_medium=badge&utm_source=badge-three&#0045;sided" target="_blank">
        <img src="https://api.producthunt.com/widgets/embed-image/v1/featured.svg?post_id=976784&theme=light&t=1749902181695" alt="Three&#0045;Sided - The&#0032;AI&#0032;flashcard&#0032;app&#0032;with&#0032;maths&#0032;students&#0032;in&#0032;mind&#0046; | Product Hunt" style="width: 250px; height: 54px;" width="250" height="54" />
      </a>
    </div>

    <!-- Premium Section -->
    <div class="premium-section">
      <div class="container">
        <h2 style="font-size: 2rem; margin-bottom: 1rem;">âœ¨ Premium Features</h2>
        <button id="toggleComparison" class="toggle-btn" onclick="uiRenderer.toggleComparison()" style="color: #e2e8f0;">
          â–¼ Click to see Premium advantages
        </button>

        <div id="comparisonContent" style="display: none;">
          <table class="comparison-table">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Free</th>
                <th>Premium (Â£5/month)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Spaced Repetition Mode</td>
                <td>âœ…</td>
                <td>âœ…</td>
              </tr>
              <tr>
                <td>AI Autofill (Hint, Proof, Tags)</td>
                <td>âš ï¸ Limited (1/day)</td>
                <td>âœ… Unlimited</td>
              </tr>
              <tr>
                <td>AI Auto-Tagging</td>
                <td>âš ï¸ Limited (1/day)</td>
                <td>âœ… Unlimited</td>
              </tr>
              <tr>
                <td>AI LaTeX Conversion</td>
                <td>âœ… Unlimited</td>
                <td>âœ… Unlimited</td>
              </tr>
              <tr>
                <td>Public Profile & Card Sharing</td>
                <td>âœ…</td>
                <td>âœ… + Custom Themes (Coming Soon)</td>
              </tr>
            </tbody>
          </table>
          
          <div style="text-align: center; margin-top: 2rem;">
            <button onclick="startSubscription()" class="btn btn-primary" style="margin: 0.5rem;">Go Premium (Â£5/month)</button>
            <button onclick="openBillingPortal()" class="btn btn-secondary" style="margin: 0.5rem;">Manage Subscription</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<div id="popup-backdrop" class="popup-backdrop" style="display: none;" onclick="closeAllPopups()"></div>

<!-- List Popup -->
<div id="listPopup" class="popup-box" style="display:none;">
  <div class="popup-header">
    <h2>ğŸ“‹ All Flashcards</h2>
    <button onclick="uiRenderer.closeListPopup()" class="popup-close">âœ•</button>
  </div>
  <div class="popup-content">
    <div id="flashcardList"></div>
  </div>
</div>

<!-- Edit Popup -->
<div id="editPopup" class="popup-box" style="display:none;">
  <div class="popup-header">
    <h2>âœï¸ Edit Flashcard</h2>
    <button onclick="closeEditPopup()" class="popup-close">âœ•</button>
  </div>
  <div class="popup-content">
    <div class="form-group">
      <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Statement</label>
      <textarea id="editStatement" class="form-control" placeholder="Statement" rows="4"></textarea>
    </div>
    <div class="form-group">
      <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Hints</label>
      <textarea id="editHints" class="form-control" placeholder="Hints" rows="3"></textarea>
    </div>
    <div class="form-group">
      <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Proof</label>
      <textarea id="editProof" class="form-control" placeholder="Proof" rows="5"></textarea>
    </div>
    <div class="form-group">
      <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Tags</label>
      <textarea id="editTags" class="form-control" placeholder="Tags (optional)" rows="2"></textarea>
    </div>
    <button onclick="saveEdit()" class="btn btn-primary">Save Changes</button>
  </div>
</div>

<!-- Filter Popup -->
<div id="filterPopup" class="popup-box" style="display:none;">
  <div class="popup-header">
    <h2>ğŸ·ï¸ Filter by Tags</h2>
    <button onclick="uiRenderer.closeFilterPopup()" class="popup-close">âœ•</button>
  </div>
  <div class="popup-content">
    <p style="margin-bottom: 1rem; color: #718096;">Select tags to filter your flashcards:</p>
    <div id="tagCheckboxContainer" class="tag-filter-container"></div>
    <div style="margin-top: 2rem;">
      <button onclick="applyTagFilter()" class="btn btn-primary">Apply Filter</button>
    </div>
  </div>
</div>

<!-- Loading Popup -->
<div id="loadingPopup" class="popup-box" style="display:none;">
  <div class="popup-header">
    <h2>ğŸ¤– AI Processing</h2>
  </div>
  <div class="popup-content">
    <div style="text-align: center;">
      <div style="font-size: 1.2rem; margin-bottom: 1rem;">Generating content...</div>
      <div style="color: #718096;">(This may take a few seconds)</div>
      <div style="margin-top: 2rem;">
        <div style="width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
      </div>
    </div>
  </div>
</div>


  <!-- JavaScript Files (keeping all original functionality) -->
  <script src="/scripts/main/deepSeekService.js"></script>
  <script src="/scripts/main/flashcardService.js"></script>
  <script src="/scripts/main/cacheService.js"></script>
  <script src="scripts/main/uiRenderer.js"></script>
  <script src="scripts/main/authService.js"></script>
  <script src="scripts/main/subscriptionService.js"></script>
  <script src="scripts/main/combinedController.js"></script>
  <script src="scripts/main/firebaseConfig.js"></script>
  <script src="scripts/main/aiHandlers.js"></script>
  <script src="scripts/main/appController.js"></script>
  <script src="scripts/main/eventHandlers.js"></script>
  <script src="scripts/main/main.js"></script>
  <script>
    // Add this function to handle backdrop clicks
    function closeAllPopups() {
    uiRenderer.hidePopupWithBackdrop("listPopup");
    uiRenderer.hidePopupWithBackdrop("filterPopup");
    uiRenderer.hidePopupWithBackdrop("editPopup");
    uiRenderer.hidePopupWithBackdrop("loadingPopup");
    }

    // Also add ESC key handler
    document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeAllPopups();
    }
    });
    </script>
    <script src="scripts/tree.js"></script>

  <footer>
    <div class="container">
      <p>Â© 2025 Three-Sided. All rights reserved.</p>
      <p style="margin-top: 0.5rem; opacity: 0.7;">
        <a href="mailto:amirbattye@gmail.com" style="color: #a0aec0;">amirbattye@gmail.com</a> â€¢ 
        <a href="mailto:three.dash.sided@gmail.com" style="color: #a0aec0;">three.dash.sided@gmail.com</a>
      </p>
    </div>
  </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const toggleBtn = document.getElementById('toggleLeaderboard');
  const content = document.getElementById('leaderboardContent');
  let isOpen = false;

  toggleBtn.addEventListener('click', function() {
    isOpen = !isOpen;
    content.style.display = isOpen ? 'block' : 'none';
    toggleBtn.textContent = (isOpen ? 'â–² Hide Leaderboard' : 'â–¼ Click to see Leaderboard');
    // Optionally, fetch leaderboard only when opened for the first time
    if (isOpen && !content.dataset.loaded) {
      if (typeof fetchAndRenderLeaderboard === 'function') {
        fetchAndRenderLeaderboard(document.getElementById('leaderboardSort').value);
      }
      content.dataset.loaded = 'true';
    }
  });
});
</script>

<script>
// Onboarding Checklist Functions
function handleChecklistClick(action) {
  switch(action) {
    case 'login':
      // Scroll to login area or trigger login modal
      const loginArea = document.querySelector('.auth-section') || document.querySelector('[onclick*="signIn"]');
      if (loginArea) {
        loginArea.scrollIntoView({ behavior: 'smooth' });
      } else {
        // If no login area found, try to trigger login
        if (typeof signIn === 'function') {
          signIn();
        }
      }
      break;
      
    case 'profile':
      // Navigate to create profile page
      window.location.href = '/create-profile.html';
      break;
      
    case 'card':
      // Scroll to add card section
      const addCardSection = document.querySelector('#addCardSection') || document.querySelector('[onclick*="addCard"]');
      if (addCardSection) {
        addCardSection.scrollIntoView({ behavior: 'smooth' });
      }
      break;
  }
}

function updateOnboardingProgress() {
  // Check if user is logged in
  const isLoggedIn = firebase.auth().currentUser !== null;
  
  if (isLoggedIn) {
    // Mark login as complete
    markChecklistComplete('login');
    
    // Check if user has a public profile
    checkProfileStatus();
    
    // Check if user has published cards
    checkCardStatus();
  } else {
    // Reset checklist to initial state
    resetChecklist();
  }
}

function markChecklistComplete(item) {
  const checklistItem = document.getElementById(`checklist-${item}`);
  if (checklistItem) {
    const icon = checklistItem.querySelector('.checklist-icon');
    const arrow = checklistItem.querySelector('.checklist-arrow');
    
    // Update icon to checkmark
    icon.innerHTML = 'âœ“';
    icon.style.backgroundColor = '#48bb78';
    icon.style.borderColor = '#48bb78';
    icon.style.color = 'white';
    
    // Update arrow
    arrow.innerHTML = 'âœ“';
    arrow.style.color = '#48bb78';
    
    // Update opacity
    checklistItem.style.opacity = '0.7';
    checklistItem.style.cursor = 'default';
    
    // Remove click handler
    checklistItem.onclick = null;
  }
}

function resetChecklist() {
  const items = ['login', 'profile', 'card'];
  items.forEach(item => {
    const checklistItem = document.getElementById(`checklist-${item}`);
    if (checklistItem) {
      const icon = checklistItem.querySelector('.checklist-icon');
      const arrow = checklistItem.querySelector('.checklist-arrow');
      
      // Reset icon
      icon.innerHTML = item === 'login' ? '1' : item === 'profile' ? '2' : '3';
      icon.style.backgroundColor = '';
      icon.style.borderColor = '#e2e8f0';
      icon.style.color = '#e2e8f0';
      
      // Reset arrow
      arrow.innerHTML = 'â†’';
      arrow.style.color = '#a0aec0';
      
      // Reset opacity and cursor
      checklistItem.style.opacity = item === 'login' ? '1' : '0.5';
      checklistItem.style.cursor = 'pointer';
      
      // Restore click handler
      checklistItem.onclick = () => handleChecklistClick(item);
    }
  });
}

async function checkProfileStatus() {
  try {
    const user = firebase.auth().currentUser;
    if (!user) return;
    
    // First, get the user's slug from userToSlug collection
    const slugDoc = await firebase.firestore().collection('userToSlug').doc(user.uid).get();
    if (slugDoc.exists) {
      const slug = slugDoc.data().slug;
      
      // Then check if the profile exists with that slug
      const profileDoc = await firebase.firestore().collection('profiles').doc(slug).get();
      if (profileDoc.exists) {
        markChecklistComplete('profile');
      }
    }
  } catch (error) {
    console.error('Error checking profile status:', error);
  }
}

async function checkCardStatus() {
  try {
    const user = firebase.auth().currentUser;
    if (!user) return;
    
    const publicCardsQuery = await firebase.firestore()
      .collection('publicCards')
      .where('userId', '==', user.uid)
      .limit(1)
      .get();
    
    if (!publicCardsQuery.empty) {
      markChecklistComplete('card');
      // Hide the entire onboarding section if all items are complete
      setTimeout(() => {
        const onboardingSection = document.getElementById('onboardingSection');
        if (onboardingSection) {
          onboardingSection.style.display = 'none';
        }
      }, 2000);
    }
  } catch (error) {
    console.error('Error checking card status:', error);
  }
}

// Listen for auth state changes
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    updateOnboardingProgress();
  } else {
    resetChecklist();
  }
});

// Check progress when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Wait a bit for Firebase to initialize
  setTimeout(() => {
    updateOnboardingProgress();
  }, 1000);
});

// New Layout Popup
function showNewLayoutPopup() {
  const popup = document.createElement('div');
  popup.id = 'newLayoutPopup';
  popup.innerHTML = `
    <div style="
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(4px);
    ">
      <div style="
        background: white;
        border-radius: 16px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        text-align: center;
        position: relative;
      ">
        <div style="
          width: 80px;
          height: 80px;
          background: linear-gradient(135deg, #635BFF, #4F46E5);
          border-radius: 50%;
          margin: 0 auto 1.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 2rem;
          color: white;
        ">
          âœ¨
        </div>
        
        <h2 style="
          margin: 0 0 1rem 0;
          font-size: 1.75rem;
          font-weight: 700;
          color: #1a202c;
        ">
          Try our new React layout!
        </h2>
        
        <p style="
          margin: 0 0 2rem 0;
          color: #4a5568;
          font-size: 1.1rem;
          line-height: 1.5;
        ">
          We've built a modern, faster version with improved social features, better mobile experience, and sleek new design.
        </p>
        
        <div style="
          display: flex;
          gap: 1rem;
          justify-content: center;
        ">
          <button onclick="tryNewLayout()" style="
            background: linear-gradient(135deg, #635BFF, #4F46E5);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 91, 255, 0.3);
          " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(99, 91, 255, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(99, 91, 255, 0.3)'">
            ğŸš€ Try New Layout
          </button>
          
          <button onclick="stayOnOld()" style="
            background: transparent;
            color: #4a5568;
            border: 2px solid #e2e8f0;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
          " onmouseover="this.style.borderColor='#cbd5e0'; this.style.background='#f7fafc'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='transparent'">
            Stay on Classic
          </button>
        </div>
        
        <button onclick="closeNewLayoutPopup()" style="
          position: absolute;
          top: 12px;
          right: 12px;
          background: none;
          border: none;
          font-size: 1.5rem;
          color: #a0aec0;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        " onmouseover="this.style.background='#f7fafc'; this.style.color='#4a5568'" onmouseout="this.style.background='none'; this.style.color='#a0aec0'">
          Ã—
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(popup);
}

function tryNewLayout() {
  // Set a preference so we don't show this again for a while
  localStorage.setItem('newLayoutShown', Date.now().toString());
  localStorage.setItem('userPreference', 'new');
  window.location.href = '/new/';
}

function stayOnOld() {
  // Set preference to stay on old for this session
  localStorage.setItem('newLayoutShown', Date.now().toString());
  localStorage.setItem('userPreference', 'classic');
  closeNewLayoutPopup();
}

function closeNewLayoutPopup() {
  const popup = document.getElementById('newLayoutPopup');
  if (popup) {
    popup.remove();
  }
}

// Manual trigger for testing - call showNewLayoutPopup() in console
window.showNewLayoutPopup = showNewLayoutPopup;

// Function to reset popup preferences (for testing)
window.resetPopupPrefs = function() {
  localStorage.removeItem('newLayoutShown');
  localStorage.removeItem('userPreference');
  console.log('Popup preferences reset!');
};

// Show popup after page loads (every time)
window.addEventListener('load', function() {
  setTimeout(() => {
    console.log('Showing new layout popup...');
    showNewLayoutPopup();
  }, 1000); // Show after 1 second
});
</script>
</body>
</html>