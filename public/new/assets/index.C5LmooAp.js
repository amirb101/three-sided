(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();var ky={exports:{}},pd={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M_;function vC(){if(M_)return pd;M_=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,a,l){var u=null;if(l!==void 0&&(u=""+l),a.key!==void 0&&(u=""+a.key),"key"in a){l={};for(var h in a)h!=="key"&&(l[h]=a[h])}else l=a;return a=l.ref,{$$typeof:s,type:n,key:u,ref:a!==void 0?a:null,props:l}}return pd.Fragment=e,pd.jsx=t,pd.jsxs=t,pd}var O_;function bC(){return O_||(O_=1,ky.exports=vC()),ky.exports}var i=bC(),Ry={exports:{}},Je={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V_;function wC(){if(V_)return Je;V_=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),w=Symbol.iterator;function b(I){return I===null||typeof I!="object"?null:(I=w&&I[w]||I["@@iterator"],typeof I=="function"?I:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k=Object.assign,R={};function U(I,W,ve){this.props=I,this.context=W,this.refs=R,this.updater=ve||E}U.prototype.isReactComponent={},U.prototype.setState=function(I,W){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,W,"setState")},U.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function z(){}z.prototype=U.prototype;function B(I,W,ve){this.props=I,this.context=W,this.refs=R,this.updater=ve||E}var q=B.prototype=new z;q.constructor=B,k(q,U.prototype),q.isPureReactComponent=!0;var G=Array.isArray,Q={H:null,A:null,T:null,S:null,V:null},L=Object.prototype.hasOwnProperty;function P(I,W,ve,de,Ce,ye){return ve=ye.ref,{$$typeof:s,type:I,key:W,ref:ve!==void 0?ve:null,props:ye}}function T(I,W){return P(I.type,W,void 0,void 0,void 0,I.props)}function A(I){return typeof I=="object"&&I!==null&&I.$$typeof===s}function F(I){var W={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(ve){return W[ve]})}var S=/\/+/g;function V(I,W){return typeof I=="object"&&I!==null&&I.key!=null?F(""+I.key):W.toString(36)}function D(){}function ke(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(D,D):(I.status="pending",I.then(function(W){I.status==="pending"&&(I.status="fulfilled",I.value=W)},function(W){I.status==="pending"&&(I.status="rejected",I.reason=W)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function ne(I,W,ve,de,Ce){var ye=typeof I;(ye==="undefined"||ye==="boolean")&&(I=null);var Ee=!1;if(I===null)Ee=!0;else switch(ye){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(I.$$typeof){case s:case e:Ee=!0;break;case x:return Ee=I._init,ne(Ee(I._payload),W,ve,de,Ce)}}if(Ee)return Ce=Ce(I),Ee=de===""?"."+V(I,0):de,G(Ce)?(ve="",Ee!=null&&(ve=Ee.replace(S,"$&/")+"/"),ne(Ce,W,ve,"",function(wt){return wt})):Ce!=null&&(A(Ce)&&(Ce=T(Ce,ve+(Ce.key==null||I&&I.key===Ce.key?"":(""+Ce.key).replace(S,"$&/")+"/")+Ee)),W.push(Ce)),1;Ee=0;var We=de===""?".":de+":";if(G(I))for(var Le=0;Le<I.length;Le++)de=I[Le],ye=We+V(de,Le),Ee+=ne(de,W,ve,ye,Ce);else if(Le=b(I),typeof Le=="function")for(I=Le.call(I),Le=0;!(de=I.next()).done;)de=de.value,ye=We+V(de,Le++),Ee+=ne(de,W,ve,ye,Ce);else if(ye==="object"){if(typeof I.then=="function")return ne(ke(I),W,ve,de,Ce);throw W=String(I),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function O(I,W,ve){if(I==null)return I;var de=[],Ce=0;return ne(I,de,"","",function(ye){return W.call(ve,ye,Ce++)}),de}function ie(I){if(I._status===-1){var W=I._result;W=W(),W.then(function(ve){(I._status===0||I._status===-1)&&(I._status=1,I._result=ve)},function(ve){(I._status===0||I._status===-1)&&(I._status=2,I._result=ve)}),I._status===-1&&(I._status=0,I._result=W)}if(I._status===1)return I._result.default;throw I._result}var $=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)};function ge(){}return Je.Children={map:O,forEach:function(I,W,ve){O(I,function(){W.apply(this,arguments)},ve)},count:function(I){var W=0;return O(I,function(){W++}),W},toArray:function(I){return O(I,function(W){return W})||[]},only:function(I){if(!A(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},Je.Component=U,Je.Fragment=t,Je.Profiler=a,Je.PureComponent=B,Je.StrictMode=n,Je.Suspense=m,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Q,Je.__COMPILER_RUNTIME={__proto__:null,c:function(I){return Q.H.useMemoCache(I)}},Je.cache=function(I){return function(){return I.apply(null,arguments)}},Je.cloneElement=function(I,W,ve){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var de=k({},I.props),Ce=I.key,ye=void 0;if(W!=null)for(Ee in W.ref!==void 0&&(ye=void 0),W.key!==void 0&&(Ce=""+W.key),W)!L.call(W,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&W.ref===void 0||(de[Ee]=W[Ee]);var Ee=arguments.length-2;if(Ee===1)de.children=ve;else if(1<Ee){for(var We=Array(Ee),Le=0;Le<Ee;Le++)We[Le]=arguments[Le+2];de.children=We}return P(I.type,Ce,void 0,void 0,ye,de)},Je.createContext=function(I){return I={$$typeof:u,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:l,_context:I},I},Je.createElement=function(I,W,ve){var de,Ce={},ye=null;if(W!=null)for(de in W.key!==void 0&&(ye=""+W.key),W)L.call(W,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(Ce[de]=W[de]);var Ee=arguments.length-2;if(Ee===1)Ce.children=ve;else if(1<Ee){for(var We=Array(Ee),Le=0;Le<Ee;Le++)We[Le]=arguments[Le+2];Ce.children=We}if(I&&I.defaultProps)for(de in Ee=I.defaultProps,Ee)Ce[de]===void 0&&(Ce[de]=Ee[de]);return P(I,ye,void 0,void 0,null,Ce)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(I){return{$$typeof:h,render:I}},Je.isValidElement=A,Je.lazy=function(I){return{$$typeof:x,_payload:{_status:-1,_result:I},_init:ie}},Je.memo=function(I,W){return{$$typeof:p,type:I,compare:W===void 0?null:W}},Je.startTransition=function(I){var W=Q.T,ve={};Q.T=ve;try{var de=I(),Ce=Q.S;Ce!==null&&Ce(ve,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(ge,$)}catch(ye){$(ye)}finally{Q.T=W}},Je.unstable_useCacheRefresh=function(){return Q.H.useCacheRefresh()},Je.use=function(I){return Q.H.use(I)},Je.useActionState=function(I,W,ve){return Q.H.useActionState(I,W,ve)},Je.useCallback=function(I,W){return Q.H.useCallback(I,W)},Je.useContext=function(I){return Q.H.useContext(I)},Je.useDebugValue=function(){},Je.useDeferredValue=function(I,W){return Q.H.useDeferredValue(I,W)},Je.useEffect=function(I,W,ve){var de=Q.H;if(typeof ve=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return de.useEffect(I,W)},Je.useId=function(){return Q.H.useId()},Je.useImperativeHandle=function(I,W,ve){return Q.H.useImperativeHandle(I,W,ve)},Je.useInsertionEffect=function(I,W){return Q.H.useInsertionEffect(I,W)},Je.useLayoutEffect=function(I,W){return Q.H.useLayoutEffect(I,W)},Je.useMemo=function(I,W){return Q.H.useMemo(I,W)},Je.useOptimistic=function(I,W){return Q.H.useOptimistic(I,W)},Je.useReducer=function(I,W,ve){return Q.H.useReducer(I,W,ve)},Je.useRef=function(I){return Q.H.useRef(I)},Je.useState=function(I){return Q.H.useState(I)},Je.useSyncExternalStore=function(I,W,ve){return Q.H.useSyncExternalStore(I,W,ve)},Je.useTransition=function(){return Q.H.useTransition()},Je.version="19.1.1",Je}var L_;function Wx(){return L_||(L_=1,Ry.exports=wC()),Ry.exports}var M=Wx(),Dy={exports:{}},yd={},Py={exports:{}},My={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F_;function _C(){return F_||(F_=1,(function(s){function e(O,ie){var $=O.length;O.push(ie);e:for(;0<$;){var ge=$-1>>>1,I=O[ge];if(0<a(I,ie))O[ge]=ie,O[$]=I,$=ge;else break e}}function t(O){return O.length===0?null:O[0]}function n(O){if(O.length===0)return null;var ie=O[0],$=O.pop();if($!==ie){O[0]=$;e:for(var ge=0,I=O.length,W=I>>>1;ge<W;){var ve=2*(ge+1)-1,de=O[ve],Ce=ve+1,ye=O[Ce];if(0>a(de,$))Ce<I&&0>a(ye,de)?(O[ge]=ye,O[Ce]=$,ge=Ce):(O[ge]=de,O[ve]=$,ge=ve);else if(Ce<I&&0>a(ye,$))O[ge]=ye,O[Ce]=$,ge=Ce;else break e}}return ie}function a(O,ie){var $=O.sortIndex-ie.sortIndex;return $!==0?$:O.id-ie.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;s.unstable_now=function(){return l.now()}}else{var u=Date,h=u.now();s.unstable_now=function(){return u.now()-h}}var m=[],p=[],x=1,w=null,b=3,E=!1,k=!1,R=!1,U=!1,z=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;function G(O){for(var ie=t(p);ie!==null;){if(ie.callback===null)n(p);else if(ie.startTime<=O)n(p),ie.sortIndex=ie.expirationTime,e(m,ie);else break;ie=t(p)}}function Q(O){if(R=!1,G(O),!k)if(t(m)!==null)k=!0,L||(L=!0,V());else{var ie=t(p);ie!==null&&ne(Q,ie.startTime-O)}}var L=!1,P=-1,T=5,A=-1;function F(){return U?!0:!(s.unstable_now()-A<T)}function S(){if(U=!1,L){var O=s.unstable_now();A=O;var ie=!0;try{e:{k=!1,R&&(R=!1,B(P),P=-1),E=!0;var $=b;try{t:{for(G(O),w=t(m);w!==null&&!(w.expirationTime>O&&F());){var ge=w.callback;if(typeof ge=="function"){w.callback=null,b=w.priorityLevel;var I=ge(w.expirationTime<=O);if(O=s.unstable_now(),typeof I=="function"){w.callback=I,G(O),ie=!0;break t}w===t(m)&&n(m),G(O)}else n(m);w=t(m)}if(w!==null)ie=!0;else{var W=t(p);W!==null&&ne(Q,W.startTime-O),ie=!1}}break e}finally{w=null,b=$,E=!1}ie=void 0}}finally{ie?V():L=!1}}}var V;if(typeof q=="function")V=function(){q(S)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,ke=D.port2;D.port1.onmessage=S,V=function(){ke.postMessage(null)}}else V=function(){z(S,0)};function ne(O,ie){P=z(function(){O(s.unstable_now())},ie)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(O){O.callback=null},s.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},s.unstable_getCurrentPriorityLevel=function(){return b},s.unstable_next=function(O){switch(b){case 1:case 2:case 3:var ie=3;break;default:ie=b}var $=b;b=ie;try{return O()}finally{b=$}},s.unstable_requestPaint=function(){U=!0},s.unstable_runWithPriority=function(O,ie){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var $=b;b=O;try{return ie()}finally{b=$}},s.unstable_scheduleCallback=function(O,ie,$){var ge=s.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?ge+$:ge):$=ge,O){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=$+I,O={id:x++,callback:ie,priorityLevel:O,startTime:$,expirationTime:I,sortIndex:-1},$>ge?(O.sortIndex=$,e(p,O),t(m)===null&&O===t(p)&&(R?(B(P),P=-1):R=!0,ne(Q,$-ge))):(O.sortIndex=I,e(m,O),k||E||(k=!0,L||(L=!0,V()))),O},s.unstable_shouldYield=F,s.unstable_wrapCallback=function(O){var ie=b;return function(){var $=b;b=ie;try{return O.apply(this,arguments)}finally{b=$}}}})(My)),My}var U_;function NC(){return U_||(U_=1,Py.exports=_C()),Py.exports}var Oy={exports:{}},cs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B_;function TC(){if(B_)return cs;B_=1;var s=Wx();function e(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(m,p,x){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:w==null?null:""+w,children:m,containerInfo:p,implementation:x}}var u=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return cs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,cs.createPortal=function(m,p){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(m,p,null,x)},cs.flushSync=function(m){var p=u.T,x=n.p;try{if(u.T=null,n.p=2,m)return m()}finally{u.T=p,n.p=x,n.d.f()}},cs.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,n.d.C(m,p))},cs.prefetchDNS=function(m){typeof m=="string"&&n.d.D(m)},cs.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var x=p.as,w=h(x,p.crossOrigin),b=typeof p.integrity=="string"?p.integrity:void 0,E=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;x==="style"?n.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:w,integrity:b,fetchPriority:E}):x==="script"&&n.d.X(m,{crossOrigin:w,integrity:b,fetchPriority:E,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},cs.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var x=h(p.as,p.crossOrigin);n.d.M(m,{crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&n.d.M(m)},cs.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var x=p.as,w=h(x,p.crossOrigin);n.d.L(m,x,{crossOrigin:w,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},cs.preloadModule=function(m,p){if(typeof m=="string")if(p){var x=h(p.as,p.crossOrigin);n.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else n.d.m(m)},cs.requestFormReset=function(m){n.d.r(m)},cs.unstable_batchedUpdates=function(m,p){return m(p)},cs.useFormState=function(m,p,x){return u.H.useFormState(m,p,x)},cs.useFormStatus=function(){return u.H.useHostTransitionStatus()},cs.version="19.1.1",cs}var q_;function EC(){if(q_)return Oy.exports;q_=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Oy.exports=TC(),Oy.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z_;function SC(){if(z_)return yd;z_=1;var s=NC(),e=Wx(),t=EC();function n(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function u(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(l(r)!==r)throw Error(n(188))}function m(r){var o=r.alternate;if(!o){if(o=l(r),o===null)throw Error(n(188));return o!==r?null:r}for(var c=r,d=o;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(d=g.return,d!==null){c=d;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return h(g),r;if(y===d)return h(g),o;y=y.sibling}throw Error(n(188))}if(c.return!==d.return)c=g,d=y;else{for(var N=!1,j=g.child;j;){if(j===c){N=!0,c=g,d=y;break}if(j===d){N=!0,d=g,c=y;break}j=j.sibling}if(!N){for(j=y.child;j;){if(j===c){N=!0,c=y,d=g;break}if(j===d){N=!0,d=y,c=g;break}j=j.sibling}if(!N)throw Error(n(189))}}if(c.alternate!==d)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?r:o}function p(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=p(r),o!==null)return o;r=r.sibling}return null}var x=Object.assign,w=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),B=Symbol.for("react.consumer"),q=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),S=Symbol.iterator;function V(r){return r===null||typeof r!="object"?null:(r=S&&r[S]||r["@@iterator"],typeof r=="function"?r:null)}var D=Symbol.for("react.client.reference");function ke(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===D?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case k:return"Fragment";case U:return"Profiler";case R:return"StrictMode";case Q:return"Suspense";case L:return"SuspenseList";case A:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case E:return"Portal";case q:return(r.displayName||"Context")+".Provider";case B:return(r._context.displayName||"Context")+".Consumer";case G:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case P:return o=r.displayName||null,o!==null?o:ke(r.type)||"Memo";case T:o=r._payload,r=r._init;try{return ke(r(o))}catch{}}return null}var ne=Array.isArray,O=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},ge=[],I=-1;function W(r){return{current:r}}function ve(r){0>I||(r.current=ge[I],ge[I]=null,I--)}function de(r,o){I++,ge[I]=r.current,r.current=o}var Ce=W(null),ye=W(null),Ee=W(null),We=W(null);function Le(r,o){switch(de(Ee,o),de(ye,r),de(Ce,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?c_(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=c_(o),r=u_(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ve(Ce),de(Ce,r)}function wt(){ve(Ce),ve(ye),ve(Ee)}function Rt(r){r.memoizedState!==null&&de(We,r);var o=Ce.current,c=u_(o,r.type);o!==c&&(de(ye,r),de(Ce,c))}function Gt(r){ye.current===r&&(ve(Ce),ve(ye)),We.current===r&&(ve(We),dd._currentValue=$)}var st=Object.prototype.hasOwnProperty,ce=s.unstable_scheduleCallback,Ae=s.unstable_cancelCallback,Te=s.unstable_shouldYield,$e=s.unstable_requestPaint,Qe=s.unstable_now,Tt=s.unstable_getCurrentPriorityLevel,gt=s.unstable_ImmediatePriority,ot=s.unstable_UserBlockingPriority,Ge=s.unstable_NormalPriority,$t=s.unstable_LowPriority,en=s.unstable_IdlePriority,Et=s.log,Wn=s.unstable_setDisableYieldValue,pt=null,ut=null;function Vn(r){if(typeof Et=="function"&&Wn(r),ut&&typeof ut.setStrictMode=="function")try{ut.setStrictMode(pt,r)}catch{}}var jn=Math.clz32?Math.clz32:tr,ii=Math.log,El=Math.LN2;function tr(r){return r>>>=0,r===0?32:31-(ii(r)/El|0)|0}var nr=256,Jn=4194304;function Ln(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function zr(r,o,c){var d=r.pendingLanes;if(d===0)return 0;var g=0,y=r.suspendedLanes,N=r.pingedLanes;r=r.warmLanes;var j=d&134217727;return j!==0?(d=j&~y,d!==0?g=Ln(d):(N&=j,N!==0?g=Ln(N):c||(c=j&~r,c!==0&&(g=Ln(c))))):(j=d&~y,j!==0?g=Ln(j):N!==0?g=Ln(N):c||(c=d&~r,c!==0&&(g=Ln(c)))),g===0?0:o!==0&&o!==g&&(o&y)===0&&(y=g&-g,c=o&-o,y>=c||y===32&&(c&4194048)!==0)?o:g}function Tr(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function mo(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hr(){var r=nr;return nr<<=1,(nr&4194048)===0&&(nr=256),r}function Gr(){var r=Jn;return Jn<<=1,(Jn&62914560)===0&&(Jn=4194304),r}function Er(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function gs(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function go(r,o,c,d,g,y){var N=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var j=r.entanglements,H=r.expirationTimes,se=r.hiddenUpdates;for(c=N&~c;0<c;){var ue=31-jn(c),me=1<<ue;j[ue]=0,H[ue]=-1;var ae=se[ue];if(ae!==null)for(se[ue]=null,ue=0;ue<ae.length;ue++){var oe=ae[ue];oe!==null&&(oe.lane&=-536870913)}c&=~me}d!==0&&sr(r,d,0),y!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=y&~(N&~o))}function sr(r,o,c){r.pendingLanes|=o,r.suspendedLanes&=~o;var d=31-jn(o);r.entangledLanes|=o,r.entanglements[d]=r.entanglements[d]|1073741824|c&4194090}function Kt(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var d=31-jn(c),g=1<<d;g&o|r[d]&o&&(r[d]|=o),c&=~g}}function ps(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function oi(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Sr(){var r=ie.p;return r!==0?r:(r=window.event,r===void 0?32:C_(r.type))}function li(r,o){var c=ie.p;try{return ie.p=r,o()}finally{ie.p=c}}var Lt=Math.random().toString(36).slice(2),cn="__reactFiber$"+Lt,un="__reactProps$"+Lt,tn="__reactContainer$"+Lt,rr="__reactEvents$"+Lt,Sl="__reactListeners$"+Lt,jr="__reactHandles$"+Lt,ci="__reactResources$"+Lt,$r="__reactMarker$"+Lt;function Fn(r){delete r[cn],delete r[un],delete r[rr],delete r[Sl],delete r[jr]}function ar(r){var o=r[cn];if(o)return o;for(var c=r.parentNode;c;){if(o=c[tn]||c[cn]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=m_(r);r!==null;){if(c=r[cn])return c;r=m_(r)}return o}r=c,c=r.parentNode}return null}function Ls(r){if(r=r[cn]||r[tn]){var o=r.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return r}return null}function Fs(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(n(33))}function Un(r){var o=r[ci];return o||(o=r[ci]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function nn(r){r[$r]=!0}var Pe=new Set,Y={};function xe(r,o){je(r,o),je(r+"Capture",o)}function je(r,o){for(Y[r]=o,r=0;r<o.length;r++)Pe.add(o[r])}var St=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fn={},Ft={};function An(r){return st.call(Ft,r)?!0:st.call(fn,r)?!1:St.test(r)?Ft[r]=!0:(fn[r]=!0,!1)}function Bn(r,o,c){if(An(o))if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var d=o.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+c)}}function os(r,o,c){if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+c)}}function mn(r,o,c,d){if(d===null)r.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(o,c,""+d)}}var Qt,po;function ir(r){if(Qt===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);Qt=o&&o[1]||"",po=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Qt+r+po}var jl=!1;function Al(r,o){if(!r||jl)return"";jl=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(o){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(oe){var ae=oe}Reflect.construct(r,[],me)}else{try{me.call()}catch(oe){ae=oe}r.call(me.prototype)}}else{try{throw Error()}catch(oe){ae=oe}(me=r())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(oe){if(oe&&ae&&typeof oe.stack=="string")return[oe.stack,ae.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),N=y[0],j=y[1];if(N&&j){var H=N.split(`
`),se=j.split(`
`);for(g=d=0;d<H.length&&!H[d].includes("DetermineComponentFrameRoot");)d++;for(;g<se.length&&!se[g].includes("DetermineComponentFrameRoot");)g++;if(d===H.length||g===se.length)for(d=H.length-1,g=se.length-1;1<=d&&0<=g&&H[d]!==se[g];)g--;for(;1<=d&&0<=g;d--,g--)if(H[d]!==se[g]){if(d!==1||g!==1)do if(d--,g--,0>g||H[d]!==se[g]){var ue=`
`+H[d].replace(" at new "," at ");return r.displayName&&ue.includes("<anonymous>")&&(ue=ue.replace("<anonymous>",r.displayName)),ue}while(1<=d&&0<=g);break}}}finally{jl=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?ir(c):""}function xu(r){switch(r.tag){case 26:case 27:case 5:return ir(r.type);case 16:return ir("Lazy");case 13:return ir("Suspense");case 19:return ir("SuspenseList");case 0:case 15:return Al(r.type,!1);case 11:return Al(r.type.render,!1);case 1:return Al(r.type,!0);case 31:return ir("Activity");default:return""}}function Cl(r){try{var o="";do o+=xu(r),r=r.return;while(r);return o}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function ys(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function vu(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Mg(r){var o=vu(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),d=""+r[o];if(!r.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,y=c.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return g.call(this)},set:function(N){d=""+N,y.call(this,N)}}),Object.defineProperty(r,o,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(N){d=""+N},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function Il(r){r._valueTracker||(r._valueTracker=Mg(r))}function bu(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),d="";return r&&(d=vu(r)?r.checked?"true":"false":r.value),r=d,r!==c?(o.setValue(r),!0):!1}function yo(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Og=/[\n"\\]/g;function vn(r){return r.replace(Og,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Us(r,o,c,d,g,y,N,j){r.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?r.type=N:r.removeAttribute("type"),o!=null?N==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+ys(o)):r.value!==""+ys(o)&&(r.value=""+ys(o)):N!=="submit"&&N!=="reset"||r.removeAttribute("value"),o!=null?ui(r,N,ys(o)):c!=null?ui(r,N,ys(c)):d!=null&&r.removeAttribute("value"),g==null&&y!=null&&(r.defaultChecked=!!y),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?r.name=""+ys(j):r.removeAttribute("name")}function xo(r,o,c,d,g,y,N,j){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(r.type=y),o!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||o!=null))return;c=c!=null?""+ys(c):"",o=o!=null?""+ys(o):c,j||o===r.value||(r.value=o),r.defaultValue=o}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=j?r.checked:!!d,r.defaultChecked=!!d,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(r.name=N)}function ui(r,o,c){o==="number"&&yo(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function xa(r,o,c,d){if(r=r.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=o.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&d&&(r[c].defaultSelected=!0)}else{for(c=""+ys(c),o=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,d&&(r[g].defaultSelected=!0);return}o!==null||r[g].disabled||(o=r[g])}o!==null&&(o.selected=!0)}}function Dt(r,o,c){if(o!=null&&(o=""+ys(o),o!==r.value&&(r.value=o),c==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=c!=null?""+ys(c):""}function vo(r,o,c,d){if(o==null){if(d!=null){if(c!=null)throw Error(n(92));if(ne(d)){if(1<d.length)throw Error(n(93));d=d[0]}c=d}c==null&&(c=""),o=c}c=ys(o),r.defaultValue=c,d=r.textContent,d===c&&d!==""&&d!==null&&(r.value=d)}function or(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var bo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jh(r,o,c){var d=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":d?r.setProperty(o,c):typeof c!="number"||c===0||bo.has(o)?o==="float"?r.cssFloat=c:r[o]=(""+c).trim():r[o]=c+"px"}function wu(r,o,c){if(o!=null&&typeof o!="object")throw Error(n(62));if(r=r.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||o!=null&&o.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var g in o)d=o[g],o.hasOwnProperty(g)&&c[g]!==d&&jh(r,g,d)}else for(var y in o)o.hasOwnProperty(y)&&jh(r,y,o[y])}function _u(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Lg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function kl(r){return Lg.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var va=null;function lr(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ba=null,wa=null;function Nu(r){var o=Ls(r);if(o&&(r=o.stateNode)){var c=r[un]||null;e:switch(r=o.stateNode,o.type){case"input":if(Us(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+vn(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var d=c[o];if(d!==r&&d.form===r.form){var g=d[un]||null;if(!g)throw Error(n(90));Us(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)d=c[o],d.form===r.form&&bu(d)}break e;case"textarea":Dt(r,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&xa(r,!!c.multiple,o,!1)}}}var Kr=!1;function Ah(r,o,c){if(Kr)return r(o,c);Kr=!0;try{var d=r(o);return d}finally{if(Kr=!1,(ba!==null||wa!==null)&&(_f(),ba&&(o=ba,r=wa,wa=ba=null,Nu(o),r)))for(o=0;o<r.length;o++)Nu(r[o])}}function wo(r,o){var c=r.stateNode;if(c===null)return null;var d=c[un]||null;if(d===null)return null;c=d[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(n(231,o,typeof c));return c}var Ar=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cr=!1;if(Ar)try{var _o={};Object.defineProperty(_o,"passive",{get:function(){cr=!0}}),window.addEventListener("test",_o,_o),window.removeEventListener("test",_o,_o)}catch{cr=!1}var Qr=null,di=null,_a=null;function Tu(){if(_a)return _a;var r,o=di,c=o.length,d,g="value"in Qr?Qr.value:Qr.textContent,y=g.length;for(r=0;r<c&&o[r]===g[r];r++);var N=c-r;for(d=1;d<=N&&o[c-d]===g[y-d];d++);return _a=g.slice(r,1<d?1-d:void 0)}function Yr(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Xr(){return!0}function Eu(){return!1}function qn(r){function o(c,d,g,y,N){this._reactName=c,this._targetInst=g,this.type=d,this.nativeEvent=y,this.target=N,this.currentTarget=null;for(var j in r)r.hasOwnProperty(j)&&(c=r[j],this[j]=c?c(y):y[j]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Xr:Eu,this.isPropagationStopped=Eu,this}return x(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Xr)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Xr)},persist:function(){},isPersistent:Xr}),o}var _t={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rl=qn(_t),No=x({},_t,{view:0,detail:0}),Ch=qn(No),Dl,Pl,Wr,To=x({},No,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Wr&&(Wr&&r.type==="mousemove"?(Dl=r.screenX-Wr.screenX,Pl=r.screenY-Wr.screenY):Pl=Dl=0,Wr=r),Dl)},movementY:function(r){return"movementY"in r?r.movementY:Pl}}),ur=qn(To),Ih=x({},To,{dataTransfer:0}),Fg=qn(Ih),Eo=x({},No,{relatedTarget:0}),Ml=qn(Eo),Su=x({},_t,{animationName:0,elapsedTime:0,pseudoElement:0}),Ol=qn(Su),kh=x({},_t,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Vl=qn(kh),Ug=x({},_t,{data:0}),ju=qn(Ug),So={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Au(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=Dh[r])?!!o[r]:!1}function jo(){return Au}var Ph=x({},No,{key:function(r){if(r.key){var o=So[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Yr(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Rh[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jo,charCode:function(r){return r.type==="keypress"?Yr(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Yr(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Ll=qn(Ph),Mh=x({},To,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cu=qn(Mh),Na=x({},No,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jo}),Oh=qn(Na),Vh=x({},_t,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lh=qn(Vh),Fh=x({},To,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Fl=qn(Fh),xs=x({},_t,{newState:0,oldState:0}),Uh=qn(xs),Bh=[9,13,27,32],Jr=Ar&&"CompositionEvent"in window,f=null;Ar&&"documentMode"in document&&(f=document.documentMode);var v=Ar&&"TextEvent"in window&&!f,_=Ar&&(!Jr||f&&8<f&&11>=f),C=" ",Z=!1;function le(r,o){switch(r){case"keyup":return Bh.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function we(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var dt=!1;function Cn(r,o){switch(r){case"compositionend":return we(o);case"keypress":return o.which!==32?null:(Z=!0,C);case"textInput":return r=o.data,r===C&&Z?null:r;default:return null}}function ht(r,o){if(dt)return r==="compositionend"||!Jr&&le(r,o)?(r=Tu(),_a=di=Qr=null,dt=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return _&&o.locale!=="ko"?null:o.data;default:return null}}var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function In(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!zn[r.type]:o==="textarea"}function Ta(r,o,c,d){ba?wa?wa.push(d):wa=[d]:ba=d,o=Af(o,"onChange"),0<o.length&&(c=new Rl("onChange","change",null,c,d),r.push({event:c,listeners:o}))}var Zn=null,Zr=null;function Iu(r){r_(r,0)}function qh(r){var o=Fs(r);if(bu(o))return r}function E0(r,o){if(r==="change")return o}var S0=!1;if(Ar){var Bg;if(Ar){var qg="oninput"in document;if(!qg){var j0=document.createElement("div");j0.setAttribute("oninput","return;"),qg=typeof j0.oninput=="function"}Bg=qg}else Bg=!1;S0=Bg&&(!document.documentMode||9<document.documentMode)}function A0(){Zn&&(Zn.detachEvent("onpropertychange",C0),Zr=Zn=null)}function C0(r){if(r.propertyName==="value"&&qh(Zr)){var o=[];Ta(o,Zr,r,lr(r)),Ah(Iu,o)}}function Y1(r,o,c){r==="focusin"?(A0(),Zn=o,Zr=c,Zn.attachEvent("onpropertychange",C0)):r==="focusout"&&A0()}function X1(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return qh(Zr)}function W1(r,o){if(r==="click")return qh(o)}function J1(r,o){if(r==="input"||r==="change")return qh(o)}function Z1(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Bs=typeof Object.is=="function"?Object.is:Z1;function ku(r,o){if(Bs(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),d=Object.keys(o);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var g=c[d];if(!st.call(o,g)||!Bs(r[g],o[g]))return!1}return!0}function I0(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function k0(r,o){var c=I0(r);r=0;for(var d;c;){if(c.nodeType===3){if(d=r+c.textContent.length,r<=o&&d>=o)return{node:c,offset:o-r};r=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=I0(c)}}function R0(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?R0(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function D0(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=yo(r.document);o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=yo(r.document)}return o}function zg(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var e2=Ar&&"documentMode"in document&&11>=document.documentMode,Ul=null,Hg=null,Ru=null,Gg=!1;function P0(r,o,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Gg||Ul==null||Ul!==yo(d)||(d=Ul,"selectionStart"in d&&zg(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Ru&&ku(Ru,d)||(Ru=d,d=Af(Hg,"onSelect"),0<d.length&&(o=new Rl("onSelect","select",null,o,c),r.push({event:o,listeners:d}),o.target=Ul)))}function Ao(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var Bl={animationend:Ao("Animation","AnimationEnd"),animationiteration:Ao("Animation","AnimationIteration"),animationstart:Ao("Animation","AnimationStart"),transitionrun:Ao("Transition","TransitionRun"),transitionstart:Ao("Transition","TransitionStart"),transitioncancel:Ao("Transition","TransitionCancel"),transitionend:Ao("Transition","TransitionEnd")},$g={},M0={};Ar&&(M0=document.createElement("div").style,"AnimationEvent"in window||(delete Bl.animationend.animation,delete Bl.animationiteration.animation,delete Bl.animationstart.animation),"TransitionEvent"in window||delete Bl.transitionend.transition);function Co(r){if($g[r])return $g[r];if(!Bl[r])return r;var o=Bl[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in M0)return $g[r]=o[c];return r}var O0=Co("animationend"),V0=Co("animationiteration"),L0=Co("animationstart"),t2=Co("transitionrun"),n2=Co("transitionstart"),s2=Co("transitioncancel"),F0=Co("transitionend"),U0=new Map,Kg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Kg.push("scrollEnd");function Cr(r,o){U0.set(r,o),xe(o,[r])}var B0=new WeakMap;function dr(r,o){if(typeof r=="object"&&r!==null){var c=B0.get(r);return c!==void 0?c:(o={value:r,source:o,stack:Cl(o)},B0.set(r,o),o)}return{value:r,source:o,stack:Cl(o)}}var hr=[],ql=0,Qg=0;function zh(){for(var r=ql,o=Qg=ql=0;o<r;){var c=hr[o];hr[o++]=null;var d=hr[o];hr[o++]=null;var g=hr[o];hr[o++]=null;var y=hr[o];if(hr[o++]=null,d!==null&&g!==null){var N=d.pending;N===null?g.next=g:(g.next=N.next,N.next=g),d.pending=g}y!==0&&q0(c,g,y)}}function Hh(r,o,c,d){hr[ql++]=r,hr[ql++]=o,hr[ql++]=c,hr[ql++]=d,Qg|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function Yg(r,o,c,d){return Hh(r,o,c,d),Gh(r)}function zl(r,o){return Hh(r,null,null,o),Gh(r)}function q0(r,o,c){r.lanes|=c;var d=r.alternate;d!==null&&(d.lanes|=c);for(var g=!1,y=r.return;y!==null;)y.childLanes|=c,d=y.alternate,d!==null&&(d.childLanes|=c),y.tag===22&&(r=y.stateNode,r===null||r._visibility&1||(g=!0)),r=y,y=y.return;return r.tag===3?(y=r.stateNode,g&&o!==null&&(g=31-jn(c),r=y.hiddenUpdates,d=r[g],d===null?r[g]=[o]:d.push(o),o.lane=c|536870912),y):null}function Gh(r){if(50<sd)throw sd=0,ty=null,Error(n(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var Hl={};function r2(r,o,c,d){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qs(r,o,c,d){return new r2(r,o,c,d)}function Xg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Ea(r,o){var c=r.alternate;return c===null?(c=qs(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function z0(r,o){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,o=c.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function $h(r,o,c,d,g,y){var N=0;if(d=r,typeof r=="function")Xg(r)&&(N=1);else if(typeof r=="string")N=iC(r,c,Ce.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case A:return r=qs(31,c,o,g),r.elementType=A,r.lanes=y,r;case k:return Io(c.children,g,y,o);case R:N=8,g|=24;break;case U:return r=qs(12,c,o,g|2),r.elementType=U,r.lanes=y,r;case Q:return r=qs(13,c,o,g),r.elementType=Q,r.lanes=y,r;case L:return r=qs(19,c,o,g),r.elementType=L,r.lanes=y,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case z:case q:N=10;break e;case B:N=9;break e;case G:N=11;break e;case P:N=14;break e;case T:N=16,d=null;break e}N=29,c=Error(n(130,r===null?"null":typeof r,"")),d=null}return o=qs(N,c,o,g),o.elementType=r,o.type=d,o.lanes=y,o}function Io(r,o,c,d){return r=qs(7,r,d,o),r.lanes=c,r}function Wg(r,o,c){return r=qs(6,r,null,o),r.lanes=c,r}function Jg(r,o,c){return o=qs(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var Gl=[],$l=0,Kh=null,Qh=0,fr=[],mr=0,ko=null,Sa=1,ja="";function Ro(r,o){Gl[$l++]=Qh,Gl[$l++]=Kh,Kh=r,Qh=o}function H0(r,o,c){fr[mr++]=Sa,fr[mr++]=ja,fr[mr++]=ko,ko=r;var d=Sa;r=ja;var g=32-jn(d)-1;d&=~(1<<g),c+=1;var y=32-jn(o)+g;if(30<y){var N=g-g%5;y=(d&(1<<N)-1).toString(32),d>>=N,g-=N,Sa=1<<32-jn(o)+g|c<<g|d,ja=y+r}else Sa=1<<y|c<<g|d,ja=r}function Zg(r){r.return!==null&&(Ro(r,1),H0(r,1,0))}function ep(r){for(;r===Kh;)Kh=Gl[--$l],Gl[$l]=null,Qh=Gl[--$l],Gl[$l]=null;for(;r===ko;)ko=fr[--mr],fr[mr]=null,ja=fr[--mr],fr[mr]=null,Sa=fr[--mr],fr[mr]=null}var vs=null,dn=null,vt=!1,Do=null,ea=!1,tp=Error(n(519));function Po(r){var o=Error(n(418,""));throw Mu(dr(o,r)),tp}function G0(r){var o=r.stateNode,c=r.type,d=r.memoizedProps;switch(o[cn]=r,o[un]=d,c){case"dialog":at("cancel",o),at("close",o);break;case"iframe":case"object":case"embed":at("load",o);break;case"video":case"audio":for(c=0;c<ad.length;c++)at(ad[c],o);break;case"source":at("error",o);break;case"img":case"image":case"link":at("error",o),at("load",o);break;case"details":at("toggle",o);break;case"input":at("invalid",o),xo(o,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),Il(o);break;case"select":at("invalid",o);break;case"textarea":at("invalid",o),vo(o,d.value,d.defaultValue,d.children),Il(o)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||d.suppressHydrationWarning===!0||l_(o.textContent,c)?(d.popover!=null&&(at("beforetoggle",o),at("toggle",o)),d.onScroll!=null&&at("scroll",o),d.onScrollEnd!=null&&at("scrollend",o),d.onClick!=null&&(o.onclick=Cf),o=!0):o=!1,o||Po(r)}function $0(r){for(vs=r.return;vs;)switch(vs.tag){case 5:case 13:ea=!1;return;case 27:case 3:ea=!0;return;default:vs=vs.return}}function Du(r){if(r!==vs)return!1;if(!vt)return $0(r),vt=!0,!1;var o=r.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||yy(r.type,r.memoizedProps)),c=!c),c&&dn&&Po(r),$0(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(o===0){dn=kr(r.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++;r=r.nextSibling}dn=null}}else o===27?(o=dn,ji(r.type)?(r=wy,wy=null,dn=r):dn=o):dn=vs?kr(r.stateNode.nextSibling):null;return!0}function Pu(){dn=vs=null,vt=!1}function K0(){var r=Do;return r!==null&&(Ss===null?Ss=r:Ss.push.apply(Ss,r),Do=null),r}function Mu(r){Do===null?Do=[r]:Do.push(r)}var np=W(null),Mo=null,Aa=null;function hi(r,o,c){de(np,o._currentValue),o._currentValue=c}function Ca(r){r._currentValue=np.current,ve(np)}function sp(r,o,c){for(;r!==null;){var d=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),r===c)break;r=r.return}}function rp(r,o,c,d){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var y=g.dependencies;if(y!==null){var N=g.child;y=y.firstContext;e:for(;y!==null;){var j=y;y=g;for(var H=0;H<o.length;H++)if(j.context===o[H]){y.lanes|=c,j=y.alternate,j!==null&&(j.lanes|=c),sp(y.return,c,r),d||(N=null);break e}y=j.next}}else if(g.tag===18){if(N=g.return,N===null)throw Error(n(341));N.lanes|=c,y=N.alternate,y!==null&&(y.lanes|=c),sp(N,c,r),N=null}else N=g.child;if(N!==null)N.return=g;else for(N=g;N!==null;){if(N===r){N=null;break}if(g=N.sibling,g!==null){g.return=N.return,N=g;break}N=N.return}g=N}}function Ou(r,o,c,d){r=null;for(var g=o,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var N=g.alternate;if(N===null)throw Error(n(387));if(N=N.memoizedProps,N!==null){var j=g.type;Bs(g.pendingProps.value,N.value)||(r!==null?r.push(j):r=[j])}}else if(g===We.current){if(N=g.alternate,N===null)throw Error(n(387));N.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(dd):r=[dd])}g=g.return}r!==null&&rp(o,r,c,d),o.flags|=262144}function Yh(r){for(r=r.firstContext;r!==null;){if(!Bs(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Oo(r){Mo=r,Aa=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ls(r){return Q0(Mo,r)}function Xh(r,o){return Mo===null&&Oo(r),Q0(r,o)}function Q0(r,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},Aa===null){if(r===null)throw Error(n(308));Aa=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else Aa=Aa.next=o;return c}var a2=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(c,d){r.push(d)}};this.abort=function(){o.aborted=!0,r.forEach(function(c){return c()})}},i2=s.unstable_scheduleCallback,o2=s.unstable_NormalPriority,kn={$$typeof:q,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ap(){return{controller:new a2,data:new Map,refCount:0}}function Vu(r){r.refCount--,r.refCount===0&&i2(o2,function(){r.controller.abort()})}var Lu=null,ip=0,Kl=0,Ql=null;function l2(r,o){if(Lu===null){var c=Lu=[];ip=0,Kl=ly(),Ql={status:"pending",value:void 0,then:function(d){c.push(d)}}}return ip++,o.then(Y0,Y0),o}function Y0(){if(--ip===0&&Lu!==null){Ql!==null&&(Ql.status="fulfilled");var r=Lu;Lu=null,Kl=0,Ql=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function c2(r,o){var c=[],d={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){d.status="fulfilled",d.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(d.status="rejected",d.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),d}var X0=O.S;O.S=function(r,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&l2(r,o),X0!==null&&X0(r,o)};var Vo=W(null);function op(){var r=Vo.current;return r!==null?r:Bt.pooledCache}function Wh(r,o){o===null?de(Vo,Vo.current):de(Vo,o.pool)}function W0(){var r=op();return r===null?null:{parent:kn._currentValue,pool:r}}var Fu=Error(n(460)),J0=Error(n(474)),Jh=Error(n(542)),lp={then:function(){}};function Z0(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Zh(){}function eb(r,o,c){switch(c=r[c],c===void 0?r.push(o):c!==o&&(o.then(Zh,Zh),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,nb(r),r;default:if(typeof o.status=="string")o.then(Zh,Zh);else{if(r=Bt,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=o,r.status="pending",r.then(function(d){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=d}},function(d){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=d}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,nb(r),r}throw Uu=o,Fu}}var Uu=null;function tb(){if(Uu===null)throw Error(n(459));var r=Uu;return Uu=null,r}function nb(r){if(r===Fu||r===Jh)throw Error(n(483))}var fi=!1;function cp(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function up(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function mi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function gi(r,o,c){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(jt&2)!==0){var g=d.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),d.pending=o,o=Gh(r),q0(r,null,c),o}return Hh(r,d,o,c),Gh(r)}function Bu(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var d=o.lanes;d&=r.pendingLanes,c|=d,o.lanes=c,Kt(r,c)}}function dp(r,o){var c=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var N={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=N:y=y.next=N,c=c.next}while(c!==null);y===null?g=y=o:y=y.next=o}else g=y=o;c={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}var hp=!1;function qu(){if(hp){var r=Ql;if(r!==null)throw r}}function zu(r,o,c,d){hp=!1;var g=r.updateQueue;fi=!1;var y=g.firstBaseUpdate,N=g.lastBaseUpdate,j=g.shared.pending;if(j!==null){g.shared.pending=null;var H=j,se=H.next;H.next=null,N===null?y=se:N.next=se,N=H;var ue=r.alternate;ue!==null&&(ue=ue.updateQueue,j=ue.lastBaseUpdate,j!==N&&(j===null?ue.firstBaseUpdate=se:j.next=se,ue.lastBaseUpdate=H))}if(y!==null){var me=g.baseState;N=0,ue=se=H=null,j=y;do{var ae=j.lane&-536870913,oe=ae!==j.lane;if(oe?(ft&ae)===ae:(d&ae)===ae){ae!==0&&ae===Kl&&(hp=!0),ue!==null&&(ue=ue.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});e:{var ze=r,Ue=j;ae=o;var Ot=c;switch(Ue.tag){case 1:if(ze=Ue.payload,typeof ze=="function"){me=ze.call(Ot,me,ae);break e}me=ze;break e;case 3:ze.flags=ze.flags&-65537|128;case 0:if(ze=Ue.payload,ae=typeof ze=="function"?ze.call(Ot,me,ae):ze,ae==null)break e;me=x({},me,ae);break e;case 2:fi=!0}}ae=j.callback,ae!==null&&(r.flags|=64,oe&&(r.flags|=8192),oe=g.callbacks,oe===null?g.callbacks=[ae]:oe.push(ae))}else oe={lane:ae,tag:j.tag,payload:j.payload,callback:j.callback,next:null},ue===null?(se=ue=oe,H=me):ue=ue.next=oe,N|=ae;if(j=j.next,j===null){if(j=g.shared.pending,j===null)break;oe=j,j=oe.next,oe.next=null,g.lastBaseUpdate=oe,g.shared.pending=null}}while(!0);ue===null&&(H=me),g.baseState=H,g.firstBaseUpdate=se,g.lastBaseUpdate=ue,y===null&&(g.shared.lanes=0),Ni|=N,r.lanes=N,r.memoizedState=me}}function sb(r,o){if(typeof r!="function")throw Error(n(191,r));r.call(o)}function rb(r,o){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)sb(c[r],o)}var Yl=W(null),ef=W(0);function ab(r,o){r=Oa,de(ef,r),de(Yl,o),Oa=r|o.baseLanes}function fp(){de(ef,Oa),de(Yl,Yl.current)}function mp(){Oa=ef.current,ve(Yl),ve(ef)}var pi=0,Ze=null,Pt=null,bn=null,tf=!1,Xl=!1,Lo=!1,nf=0,Hu=0,Wl=null,u2=0;function gn(){throw Error(n(321))}function gp(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!Bs(r[c],o[c]))return!1;return!0}function pp(r,o,c,d,g,y){return pi=y,Ze=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,O.H=r===null||r.memoizedState===null?qb:zb,Lo=!1,y=c(d,g),Lo=!1,Xl&&(y=ob(o,c,d,g)),ib(r),y}function ib(r){O.H=cf;var o=Pt!==null&&Pt.next!==null;if(pi=0,bn=Pt=Ze=null,tf=!1,Hu=0,Wl=null,o)throw Error(n(300));r===null||Hn||(r=r.dependencies,r!==null&&Yh(r)&&(Hn=!0))}function ob(r,o,c,d){Ze=r;var g=0;do{if(Xl&&(Wl=null),Hu=0,Xl=!1,25<=g)throw Error(n(301));if(g+=1,bn=Pt=null,r.updateQueue!=null){var y=r.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}O.H=y2,y=o(c,d)}while(Xl);return y}function d2(){var r=O.H,o=r.useState()[0];return o=typeof o.then=="function"?Gu(o):o,r=r.useState()[0],(Pt!==null?Pt.memoizedState:null)!==r&&(Ze.flags|=1024),o}function yp(){var r=nf!==0;return nf=0,r}function xp(r,o,c){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~c}function vp(r){if(tf){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}tf=!1}pi=0,bn=Pt=Ze=null,Xl=!1,Hu=nf=0,Wl=null}function Ts(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?Ze.memoizedState=bn=r:bn=bn.next=r,bn}function wn(){if(Pt===null){var r=Ze.alternate;r=r!==null?r.memoizedState:null}else r=Pt.next;var o=bn===null?Ze.memoizedState:bn.next;if(o!==null)bn=o,Pt=r;else{if(r===null)throw Ze.alternate===null?Error(n(467)):Error(n(310));Pt=r,r={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},bn===null?Ze.memoizedState=bn=r:bn=bn.next=r}return bn}function bp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gu(r){var o=Hu;return Hu+=1,Wl===null&&(Wl=[]),r=eb(Wl,r,o),o=Ze,(bn===null?o.memoizedState:bn.next)===null&&(o=o.alternate,O.H=o===null||o.memoizedState===null?qb:zb),r}function sf(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Gu(r);if(r.$$typeof===q)return ls(r)}throw Error(n(438,String(r)))}function wp(r){var o=null,c=Ze.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var d=Ze.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(o={data:d.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=bp(),Ze.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(r),d=0;d<r;d++)c[d]=F;return o.index++,c}function Ia(r,o){return typeof o=="function"?o(r):o}function rf(r){var o=wn();return _p(o,Pt,r)}function _p(r,o,c){var d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=c;var g=r.baseQueue,y=d.pending;if(y!==null){if(g!==null){var N=g.next;g.next=y.next,y.next=N}o.baseQueue=g=y,d.pending=null}if(y=r.baseState,g===null)r.memoizedState=y;else{o=g.next;var j=N=null,H=null,se=o,ue=!1;do{var me=se.lane&-536870913;if(me!==se.lane?(ft&me)===me:(pi&me)===me){var ae=se.revertLane;if(ae===0)H!==null&&(H=H.next={lane:0,revertLane:0,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),me===Kl&&(ue=!0);else if((pi&ae)===ae){se=se.next,ae===Kl&&(ue=!0);continue}else me={lane:0,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},H===null?(j=H=me,N=y):H=H.next=me,Ze.lanes|=ae,Ni|=ae;me=se.action,Lo&&c(y,me),y=se.hasEagerState?se.eagerState:c(y,me)}else ae={lane:me,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},H===null?(j=H=ae,N=y):H=H.next=ae,Ze.lanes|=me,Ni|=me;se=se.next}while(se!==null&&se!==o);if(H===null?N=y:H.next=j,!Bs(y,r.memoizedState)&&(Hn=!0,ue&&(c=Ql,c!==null)))throw c;r.memoizedState=y,r.baseState=N,r.baseQueue=H,d.lastRenderedState=y}return g===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function Np(r){var o=wn(),c=o.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=r;var d=c.dispatch,g=c.pending,y=o.memoizedState;if(g!==null){c.pending=null;var N=g=g.next;do y=r(y,N.action),N=N.next;while(N!==g);Bs(y,o.memoizedState)||(Hn=!0),o.memoizedState=y,o.baseQueue===null&&(o.baseState=y),c.lastRenderedState=y}return[y,d]}function lb(r,o,c){var d=Ze,g=wn(),y=vt;if(y){if(c===void 0)throw Error(n(407));c=c()}else c=o();var N=!Bs((Pt||g).memoizedState,c);N&&(g.memoizedState=c,Hn=!0),g=g.queue;var j=db.bind(null,d,g,r);if($u(2048,8,j,[r]),g.getSnapshot!==o||N||bn!==null&&bn.memoizedState.tag&1){if(d.flags|=2048,Jl(9,af(),ub.bind(null,d,g,c,o),null),Bt===null)throw Error(n(349));y||(pi&124)!==0||cb(d,o,c)}return c}function cb(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=Ze.updateQueue,o===null?(o=bp(),Ze.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function ub(r,o,c,d){o.value=c,o.getSnapshot=d,hb(o)&&fb(r)}function db(r,o,c){return c(function(){hb(o)&&fb(r)})}function hb(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!Bs(r,c)}catch{return!0}}function fb(r){var o=zl(r,2);o!==null&&Ks(o,r,2)}function Tp(r){var o=Ts();if(typeof r=="function"){var c=r;if(r=c(),Lo){Vn(!0);try{c()}finally{Vn(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:r},o}function mb(r,o,c,d){return r.baseState=c,_p(r,Pt,typeof d=="function"?d:Ia)}function h2(r,o,c,d,g){if(lf(r))throw Error(n(485));if(r=o.action,r!==null){var y={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){y.listeners.push(N)}};O.T!==null?c(!0):y.isTransition=!1,d(y),c=o.pending,c===null?(y.next=o.pending=y,gb(o,y)):(y.next=c.next,o.pending=c.next=y)}}function gb(r,o){var c=o.action,d=o.payload,g=r.state;if(o.isTransition){var y=O.T,N={};O.T=N;try{var j=c(g,d),H=O.S;H!==null&&H(N,j),pb(r,o,j)}catch(se){Ep(r,o,se)}finally{O.T=y}}else try{y=c(g,d),pb(r,o,y)}catch(se){Ep(r,o,se)}}function pb(r,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){yb(r,o,d)},function(d){return Ep(r,o,d)}):yb(r,o,c)}function yb(r,o,c){o.status="fulfilled",o.value=c,xb(o),r.state=c,o=r.pending,o!==null&&(c=o.next,c===o?r.pending=null:(c=c.next,o.next=c,gb(r,c)))}function Ep(r,o,c){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do o.status="rejected",o.reason=c,xb(o),o=o.next;while(o!==d)}r.action=null}function xb(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function vb(r,o){return o}function bb(r,o){if(vt){var c=Bt.formState;if(c!==null){e:{var d=Ze;if(vt){if(dn){t:{for(var g=dn,y=ea;g.nodeType!==8;){if(!y){g=null;break t}if(g=kr(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){dn=kr(g.nextSibling),d=g.data==="F!";break e}}Po(d)}d=!1}d&&(o=c[0])}}return c=Ts(),c.memoizedState=c.baseState=o,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vb,lastRenderedState:o},c.queue=d,c=Fb.bind(null,Ze,d),d.dispatch=c,d=Tp(!1),y=Ip.bind(null,Ze,!1,d.queue),d=Ts(),g={state:o,dispatch:null,action:r,pending:null},d.queue=g,c=h2.bind(null,Ze,g,y,c),g.dispatch=c,d.memoizedState=r,[o,c,!1]}function wb(r){var o=wn();return _b(o,Pt,r)}function _b(r,o,c){if(o=_p(r,o,vb)[0],r=rf(Ia)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var d=Gu(o)}catch(N){throw N===Fu?Jh:N}else d=o;o=wn();var g=o.queue,y=g.dispatch;return c!==o.memoizedState&&(Ze.flags|=2048,Jl(9,af(),f2.bind(null,g,c),null)),[d,y,r]}function f2(r,o){r.action=o}function Nb(r){var o=wn(),c=Pt;if(c!==null)return _b(o,c,r);wn(),o=o.memoizedState,c=wn();var d=c.queue.dispatch;return c.memoizedState=r,[o,d,!1]}function Jl(r,o,c,d){return r={tag:r,create:c,deps:d,inst:o,next:null},o=Ze.updateQueue,o===null&&(o=bp(),Ze.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=r.next=r:(d=c.next,c.next=r,r.next=d,o.lastEffect=r),r}function af(){return{destroy:void 0,resource:void 0}}function Tb(){return wn().memoizedState}function of(r,o,c,d){var g=Ts();d=d===void 0?null:d,Ze.flags|=r,g.memoizedState=Jl(1|o,af(),c,d)}function $u(r,o,c,d){var g=wn();d=d===void 0?null:d;var y=g.memoizedState.inst;Pt!==null&&d!==null&&gp(d,Pt.memoizedState.deps)?g.memoizedState=Jl(o,y,c,d):(Ze.flags|=r,g.memoizedState=Jl(1|o,y,c,d))}function Eb(r,o){of(8390656,8,r,o)}function Sb(r,o){$u(2048,8,r,o)}function jb(r,o){return $u(4,2,r,o)}function Ab(r,o){return $u(4,4,r,o)}function Cb(r,o){if(typeof o=="function"){r=r();var c=o(r);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function Ib(r,o,c){c=c!=null?c.concat([r]):null,$u(4,4,Cb.bind(null,o,r),c)}function Sp(){}function kb(r,o){var c=wn();o=o===void 0?null:o;var d=c.memoizedState;return o!==null&&gp(o,d[1])?d[0]:(c.memoizedState=[r,o],r)}function Rb(r,o){var c=wn();o=o===void 0?null:o;var d=c.memoizedState;if(o!==null&&gp(o,d[1]))return d[0];if(d=r(),Lo){Vn(!0);try{r()}finally{Vn(!1)}}return c.memoizedState=[d,o],d}function jp(r,o,c){return c===void 0||(pi&1073741824)!==0?r.memoizedState=o:(r.memoizedState=c,r=Mw(),Ze.lanes|=r,Ni|=r,c)}function Db(r,o,c,d){return Bs(c,o)?c:Yl.current!==null?(r=jp(r,c,d),Bs(r,o)||(Hn=!0),r):(pi&42)===0?(Hn=!0,r.memoizedState=c):(r=Mw(),Ze.lanes|=r,Ni|=r,o)}function Pb(r,o,c,d,g){var y=ie.p;ie.p=y!==0&&8>y?y:8;var N=O.T,j={};O.T=j,Ip(r,!1,o,c);try{var H=g(),se=O.S;if(se!==null&&se(j,H),H!==null&&typeof H=="object"&&typeof H.then=="function"){var ue=c2(H,d);Ku(r,o,ue,$s(r))}else Ku(r,o,d,$s(r))}catch(me){Ku(r,o,{then:function(){},status:"rejected",reason:me},$s())}finally{ie.p=y,O.T=N}}function m2(){}function Ap(r,o,c,d){if(r.tag!==5)throw Error(n(476));var g=Mb(r).queue;Pb(r,g,o,$,c===null?m2:function(){return Ob(r),c(d)})}function Mb(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:$},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:c},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function Ob(r){var o=Mb(r).next.queue;Ku(r,o,{},$s())}function Cp(){return ls(dd)}function Vb(){return wn().memoizedState}function Lb(){return wn().memoizedState}function g2(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var c=$s();r=mi(c);var d=gi(o,r,c);d!==null&&(Ks(d,o,c),Bu(d,o,c)),o={cache:ap()},r.payload=o;return}o=o.return}}function p2(r,o,c){var d=$s();c={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},lf(r)?Ub(o,c):(c=Yg(r,o,c,d),c!==null&&(Ks(c,r,d),Bb(c,o,d)))}function Fb(r,o,c){var d=$s();Ku(r,o,c,d)}function Ku(r,o,c,d){var g={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(lf(r))Ub(o,g);else{var y=r.alternate;if(r.lanes===0&&(y===null||y.lanes===0)&&(y=o.lastRenderedReducer,y!==null))try{var N=o.lastRenderedState,j=y(N,c);if(g.hasEagerState=!0,g.eagerState=j,Bs(j,N))return Hh(r,o,g,0),Bt===null&&zh(),!1}catch{}finally{}if(c=Yg(r,o,g,d),c!==null)return Ks(c,r,d),Bb(c,o,d),!0}return!1}function Ip(r,o,c,d){if(d={lane:2,revertLane:ly(),action:d,hasEagerState:!1,eagerState:null,next:null},lf(r)){if(o)throw Error(n(479))}else o=Yg(r,c,d,2),o!==null&&Ks(o,r,2)}function lf(r){var o=r.alternate;return r===Ze||o!==null&&o===Ze}function Ub(r,o){Xl=tf=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function Bb(r,o,c){if((c&4194048)!==0){var d=o.lanes;d&=r.pendingLanes,c|=d,o.lanes=c,Kt(r,c)}}var cf={readContext:ls,use:sf,useCallback:gn,useContext:gn,useEffect:gn,useImperativeHandle:gn,useLayoutEffect:gn,useInsertionEffect:gn,useMemo:gn,useReducer:gn,useRef:gn,useState:gn,useDebugValue:gn,useDeferredValue:gn,useTransition:gn,useSyncExternalStore:gn,useId:gn,useHostTransitionStatus:gn,useFormState:gn,useActionState:gn,useOptimistic:gn,useMemoCache:gn,useCacheRefresh:gn},qb={readContext:ls,use:sf,useCallback:function(r,o){return Ts().memoizedState=[r,o===void 0?null:o],r},useContext:ls,useEffect:Eb,useImperativeHandle:function(r,o,c){c=c!=null?c.concat([r]):null,of(4194308,4,Cb.bind(null,o,r),c)},useLayoutEffect:function(r,o){return of(4194308,4,r,o)},useInsertionEffect:function(r,o){of(4,2,r,o)},useMemo:function(r,o){var c=Ts();o=o===void 0?null:o;var d=r();if(Lo){Vn(!0);try{r()}finally{Vn(!1)}}return c.memoizedState=[d,o],d},useReducer:function(r,o,c){var d=Ts();if(c!==void 0){var g=c(o);if(Lo){Vn(!0);try{c(o)}finally{Vn(!1)}}}else g=o;return d.memoizedState=d.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},d.queue=r,r=r.dispatch=p2.bind(null,Ze,r),[d.memoizedState,r]},useRef:function(r){var o=Ts();return r={current:r},o.memoizedState=r},useState:function(r){r=Tp(r);var o=r.queue,c=Fb.bind(null,Ze,o);return o.dispatch=c,[r.memoizedState,c]},useDebugValue:Sp,useDeferredValue:function(r,o){var c=Ts();return jp(c,r,o)},useTransition:function(){var r=Tp(!1);return r=Pb.bind(null,Ze,r.queue,!0,!1),Ts().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,c){var d=Ze,g=Ts();if(vt){if(c===void 0)throw Error(n(407));c=c()}else{if(c=o(),Bt===null)throw Error(n(349));(ft&124)!==0||cb(d,o,c)}g.memoizedState=c;var y={value:c,getSnapshot:o};return g.queue=y,Eb(db.bind(null,d,y,r),[r]),d.flags|=2048,Jl(9,af(),ub.bind(null,d,y,c,o),null),c},useId:function(){var r=Ts(),o=Bt.identifierPrefix;if(vt){var c=ja,d=Sa;c=(d&~(1<<32-jn(d)-1)).toString(32)+c,o=""+o+"R"+c,c=nf++,0<c&&(o+="H"+c.toString(32)),o+=""}else c=u2++,o=""+o+"r"+c.toString(32)+"";return r.memoizedState=o},useHostTransitionStatus:Cp,useFormState:bb,useActionState:bb,useOptimistic:function(r){var o=Ts();o.memoizedState=o.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=Ip.bind(null,Ze,!0,c),c.dispatch=o,[r,o]},useMemoCache:wp,useCacheRefresh:function(){return Ts().memoizedState=g2.bind(null,Ze)}},zb={readContext:ls,use:sf,useCallback:kb,useContext:ls,useEffect:Sb,useImperativeHandle:Ib,useInsertionEffect:jb,useLayoutEffect:Ab,useMemo:Rb,useReducer:rf,useRef:Tb,useState:function(){return rf(Ia)},useDebugValue:Sp,useDeferredValue:function(r,o){var c=wn();return Db(c,Pt.memoizedState,r,o)},useTransition:function(){var r=rf(Ia)[0],o=wn().memoizedState;return[typeof r=="boolean"?r:Gu(r),o]},useSyncExternalStore:lb,useId:Vb,useHostTransitionStatus:Cp,useFormState:wb,useActionState:wb,useOptimistic:function(r,o){var c=wn();return mb(c,Pt,r,o)},useMemoCache:wp,useCacheRefresh:Lb},y2={readContext:ls,use:sf,useCallback:kb,useContext:ls,useEffect:Sb,useImperativeHandle:Ib,useInsertionEffect:jb,useLayoutEffect:Ab,useMemo:Rb,useReducer:Np,useRef:Tb,useState:function(){return Np(Ia)},useDebugValue:Sp,useDeferredValue:function(r,o){var c=wn();return Pt===null?jp(c,r,o):Db(c,Pt.memoizedState,r,o)},useTransition:function(){var r=Np(Ia)[0],o=wn().memoizedState;return[typeof r=="boolean"?r:Gu(r),o]},useSyncExternalStore:lb,useId:Vb,useHostTransitionStatus:Cp,useFormState:Nb,useActionState:Nb,useOptimistic:function(r,o){var c=wn();return Pt!==null?mb(c,Pt,r,o):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:wp,useCacheRefresh:Lb},Zl=null,Qu=0;function uf(r){var o=Qu;return Qu+=1,Zl===null&&(Zl=[]),eb(Zl,r,o)}function Yu(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function df(r,o){throw o.$$typeof===w?Error(n(525)):(r=Object.prototype.toString.call(o),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function Hb(r){var o=r._init;return o(r._payload)}function Gb(r){function o(X,K){if(r){var ee=X.deletions;ee===null?(X.deletions=[K],X.flags|=16):ee.push(K)}}function c(X,K){if(!r)return null;for(;K!==null;)o(X,K),K=K.sibling;return null}function d(X){for(var K=new Map;X!==null;)X.key!==null?K.set(X.key,X):K.set(X.index,X),X=X.sibling;return K}function g(X,K){return X=Ea(X,K),X.index=0,X.sibling=null,X}function y(X,K,ee){return X.index=ee,r?(ee=X.alternate,ee!==null?(ee=ee.index,ee<K?(X.flags|=67108866,K):ee):(X.flags|=67108866,K)):(X.flags|=1048576,K)}function N(X){return r&&X.alternate===null&&(X.flags|=67108866),X}function j(X,K,ee,fe){return K===null||K.tag!==6?(K=Wg(ee,X.mode,fe),K.return=X,K):(K=g(K,ee),K.return=X,K)}function H(X,K,ee,fe){var Re=ee.type;return Re===k?ue(X,K,ee.props.children,fe,ee.key):K!==null&&(K.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===T&&Hb(Re)===K.type)?(K=g(K,ee.props),Yu(K,ee),K.return=X,K):(K=$h(ee.type,ee.key,ee.props,null,X.mode,fe),Yu(K,ee),K.return=X,K)}function se(X,K,ee,fe){return K===null||K.tag!==4||K.stateNode.containerInfo!==ee.containerInfo||K.stateNode.implementation!==ee.implementation?(K=Jg(ee,X.mode,fe),K.return=X,K):(K=g(K,ee.children||[]),K.return=X,K)}function ue(X,K,ee,fe,Re){return K===null||K.tag!==7?(K=Io(ee,X.mode,fe,Re),K.return=X,K):(K=g(K,ee),K.return=X,K)}function me(X,K,ee){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return K=Wg(""+K,X.mode,ee),K.return=X,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case b:return ee=$h(K.type,K.key,K.props,null,X.mode,ee),Yu(ee,K),ee.return=X,ee;case E:return K=Jg(K,X.mode,ee),K.return=X,K;case T:var fe=K._init;return K=fe(K._payload),me(X,K,ee)}if(ne(K)||V(K))return K=Io(K,X.mode,ee,null),K.return=X,K;if(typeof K.then=="function")return me(X,uf(K),ee);if(K.$$typeof===q)return me(X,Xh(X,K),ee);df(X,K)}return null}function ae(X,K,ee,fe){var Re=K!==null?K.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return Re!==null?null:j(X,K,""+ee,fe);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case b:return ee.key===Re?H(X,K,ee,fe):null;case E:return ee.key===Re?se(X,K,ee,fe):null;case T:return Re=ee._init,ee=Re(ee._payload),ae(X,K,ee,fe)}if(ne(ee)||V(ee))return Re!==null?null:ue(X,K,ee,fe,null);if(typeof ee.then=="function")return ae(X,K,uf(ee),fe);if(ee.$$typeof===q)return ae(X,K,Xh(X,ee),fe);df(X,ee)}return null}function oe(X,K,ee,fe,Re){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return X=X.get(ee)||null,j(K,X,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case b:return X=X.get(fe.key===null?ee:fe.key)||null,H(K,X,fe,Re);case E:return X=X.get(fe.key===null?ee:fe.key)||null,se(K,X,fe,Re);case T:var et=fe._init;return fe=et(fe._payload),oe(X,K,ee,fe,Re)}if(ne(fe)||V(fe))return X=X.get(ee)||null,ue(K,X,fe,Re,null);if(typeof fe.then=="function")return oe(X,K,ee,uf(fe),Re);if(fe.$$typeof===q)return oe(X,K,ee,Xh(K,fe),Re);df(K,fe)}return null}function ze(X,K,ee,fe){for(var Re=null,et=null,Ve=K,Be=K=0,$n=null;Ve!==null&&Be<ee.length;Be++){Ve.index>Be?($n=Ve,Ve=null):$n=Ve.sibling;var xt=ae(X,Ve,ee[Be],fe);if(xt===null){Ve===null&&(Ve=$n);break}r&&Ve&&xt.alternate===null&&o(X,Ve),K=y(xt,K,Be),et===null?Re=xt:et.sibling=xt,et=xt,Ve=$n}if(Be===ee.length)return c(X,Ve),vt&&Ro(X,Be),Re;if(Ve===null){for(;Be<ee.length;Be++)Ve=me(X,ee[Be],fe),Ve!==null&&(K=y(Ve,K,Be),et===null?Re=Ve:et.sibling=Ve,et=Ve);return vt&&Ro(X,Be),Re}for(Ve=d(Ve);Be<ee.length;Be++)$n=oe(Ve,X,Be,ee[Be],fe),$n!==null&&(r&&$n.alternate!==null&&Ve.delete($n.key===null?Be:$n.key),K=y($n,K,Be),et===null?Re=$n:et.sibling=$n,et=$n);return r&&Ve.forEach(function(Ri){return o(X,Ri)}),vt&&Ro(X,Be),Re}function Ue(X,K,ee,fe){if(ee==null)throw Error(n(151));for(var Re=null,et=null,Ve=K,Be=K=0,$n=null,xt=ee.next();Ve!==null&&!xt.done;Be++,xt=ee.next()){Ve.index>Be?($n=Ve,Ve=null):$n=Ve.sibling;var Ri=ae(X,Ve,xt.value,fe);if(Ri===null){Ve===null&&(Ve=$n);break}r&&Ve&&Ri.alternate===null&&o(X,Ve),K=y(Ri,K,Be),et===null?Re=Ri:et.sibling=Ri,et=Ri,Ve=$n}if(xt.done)return c(X,Ve),vt&&Ro(X,Be),Re;if(Ve===null){for(;!xt.done;Be++,xt=ee.next())xt=me(X,xt.value,fe),xt!==null&&(K=y(xt,K,Be),et===null?Re=xt:et.sibling=xt,et=xt);return vt&&Ro(X,Be),Re}for(Ve=d(Ve);!xt.done;Be++,xt=ee.next())xt=oe(Ve,X,Be,xt.value,fe),xt!==null&&(r&&xt.alternate!==null&&Ve.delete(xt.key===null?Be:xt.key),K=y(xt,K,Be),et===null?Re=xt:et.sibling=xt,et=xt);return r&&Ve.forEach(function(xC){return o(X,xC)}),vt&&Ro(X,Be),Re}function Ot(X,K,ee,fe){if(typeof ee=="object"&&ee!==null&&ee.type===k&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case b:e:{for(var Re=ee.key;K!==null;){if(K.key===Re){if(Re=ee.type,Re===k){if(K.tag===7){c(X,K.sibling),fe=g(K,ee.props.children),fe.return=X,X=fe;break e}}else if(K.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===T&&Hb(Re)===K.type){c(X,K.sibling),fe=g(K,ee.props),Yu(fe,ee),fe.return=X,X=fe;break e}c(X,K);break}else o(X,K);K=K.sibling}ee.type===k?(fe=Io(ee.props.children,X.mode,fe,ee.key),fe.return=X,X=fe):(fe=$h(ee.type,ee.key,ee.props,null,X.mode,fe),Yu(fe,ee),fe.return=X,X=fe)}return N(X);case E:e:{for(Re=ee.key;K!==null;){if(K.key===Re)if(K.tag===4&&K.stateNode.containerInfo===ee.containerInfo&&K.stateNode.implementation===ee.implementation){c(X,K.sibling),fe=g(K,ee.children||[]),fe.return=X,X=fe;break e}else{c(X,K);break}else o(X,K);K=K.sibling}fe=Jg(ee,X.mode,fe),fe.return=X,X=fe}return N(X);case T:return Re=ee._init,ee=Re(ee._payload),Ot(X,K,ee,fe)}if(ne(ee))return ze(X,K,ee,fe);if(V(ee)){if(Re=V(ee),typeof Re!="function")throw Error(n(150));return ee=Re.call(ee),Ue(X,K,ee,fe)}if(typeof ee.then=="function")return Ot(X,K,uf(ee),fe);if(ee.$$typeof===q)return Ot(X,K,Xh(X,ee),fe);df(X,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint"?(ee=""+ee,K!==null&&K.tag===6?(c(X,K.sibling),fe=g(K,ee),fe.return=X,X=fe):(c(X,K),fe=Wg(ee,X.mode,fe),fe.return=X,X=fe),N(X)):c(X,K)}return function(X,K,ee,fe){try{Qu=0;var Re=Ot(X,K,ee,fe);return Zl=null,Re}catch(Ve){if(Ve===Fu||Ve===Jh)throw Ve;var et=qs(29,Ve,null,X.mode);return et.lanes=fe,et.return=X,et}finally{}}}var ec=Gb(!0),$b=Gb(!1),gr=W(null),ta=null;function yi(r){var o=r.alternate;de(Rn,Rn.current&1),de(gr,r),ta===null&&(o===null||Yl.current!==null||o.memoizedState!==null)&&(ta=r)}function Kb(r){if(r.tag===22){if(de(Rn,Rn.current),de(gr,r),ta===null){var o=r.alternate;o!==null&&o.memoizedState!==null&&(ta=r)}}else xi()}function xi(){de(Rn,Rn.current),de(gr,gr.current)}function ka(r){ve(gr),ta===r&&(ta=null),ve(Rn)}var Rn=W(0);function hf(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||by(c)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function kp(r,o,c,d){o=r.memoizedState,c=c(d,o),c=c==null?o:x({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Rp={enqueueSetState:function(r,o,c){r=r._reactInternals;var d=$s(),g=mi(d);g.payload=o,c!=null&&(g.callback=c),o=gi(r,g,d),o!==null&&(Ks(o,r,d),Bu(o,r,d))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var d=$s(),g=mi(d);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=gi(r,g,d),o!==null&&(Ks(o,r,d),Bu(o,r,d))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=$s(),d=mi(c);d.tag=2,o!=null&&(d.callback=o),o=gi(r,d,c),o!==null&&(Ks(o,r,c),Bu(o,r,c))}};function Qb(r,o,c,d,g,y,N){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,y,N):o.prototype&&o.prototype.isPureReactComponent?!ku(c,d)||!ku(g,y):!0}function Yb(r,o,c,d){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,d),o.state!==r&&Rp.enqueueReplaceState(o,o.state,null)}function Fo(r,o){var c=o;if("ref"in o){c={};for(var d in o)d!=="ref"&&(c[d]=o[d])}if(r=r.defaultProps){c===o&&(c=x({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}var ff=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function Xb(r){ff(r)}function Wb(r){console.error(r)}function Jb(r){ff(r)}function mf(r,o){try{var c=r.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(d){setTimeout(function(){throw d})}}function Zb(r,o,c){try{var d=r.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Dp(r,o,c){return c=mi(c),c.tag=3,c.payload={element:null},c.callback=function(){mf(r,o)},c}function ew(r){return r=mi(r),r.tag=3,r}function tw(r,o,c,d){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=d.value;r.payload=function(){return g(y)},r.callback=function(){Zb(o,c,d)}}var N=c.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(r.callback=function(){Zb(o,c,d),typeof g!="function"&&(Ti===null?Ti=new Set([this]):Ti.add(this));var j=d.stack;this.componentDidCatch(d.value,{componentStack:j!==null?j:""})})}function x2(r,o,c,d,g){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(o=c.alternate,o!==null&&Ou(o,c,g,!0),c=gr.current,c!==null){switch(c.tag){case 13:return ta===null?sy():c.alternate===null&&hn===0&&(hn=3),c.flags&=-257,c.flags|=65536,c.lanes=g,d===lp?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([d]):o.add(d),ay(r,d,g)),!1;case 22:return c.flags|=65536,d===lp?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([d]):c.add(d)),ay(r,d,g)),!1}throw Error(n(435,c.tag))}return ay(r,d,g),sy(),!1}if(vt)return o=gr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,d!==tp&&(r=Error(n(422),{cause:d}),Mu(dr(r,c)))):(d!==tp&&(o=Error(n(423),{cause:d}),Mu(dr(o,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,d=dr(d,c),g=Dp(r.stateNode,d,g),dp(r,g),hn!==4&&(hn=2)),!1;var y=Error(n(520),{cause:d});if(y=dr(y,c),nd===null?nd=[y]:nd.push(y),hn!==4&&(hn=2),o===null)return!0;d=dr(d,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=Dp(c.stateNode,d,r),dp(c,r),!1;case 1:if(o=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ti===null||!Ti.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=ew(g),tw(g,r,c,d),dp(c,g),!1}c=c.return}while(c!==null);return!1}var nw=Error(n(461)),Hn=!1;function es(r,o,c,d){o.child=r===null?$b(o,null,c,d):ec(o,r.child,c,d)}function sw(r,o,c,d,g){c=c.render;var y=o.ref;if("ref"in d){var N={};for(var j in d)j!=="ref"&&(N[j]=d[j])}else N=d;return Oo(o),d=pp(r,o,c,N,y,g),j=yp(),r!==null&&!Hn?(xp(r,o,g),Ra(r,o,g)):(vt&&j&&Zg(o),o.flags|=1,es(r,o,d,g),o.child)}function rw(r,o,c,d,g){if(r===null){var y=c.type;return typeof y=="function"&&!Xg(y)&&y.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=y,aw(r,o,y,d,g)):(r=$h(c.type,null,d,o,o.mode,g),r.ref=o.ref,r.return=o,o.child=r)}if(y=r.child,!Bp(r,g)){var N=y.memoizedProps;if(c=c.compare,c=c!==null?c:ku,c(N,d)&&r.ref===o.ref)return Ra(r,o,g)}return o.flags|=1,r=Ea(y,d),r.ref=o.ref,r.return=o,o.child=r}function aw(r,o,c,d,g){if(r!==null){var y=r.memoizedProps;if(ku(y,d)&&r.ref===o.ref)if(Hn=!1,o.pendingProps=d=y,Bp(r,g))(r.flags&131072)!==0&&(Hn=!0);else return o.lanes=r.lanes,Ra(r,o,g)}return Pp(r,o,c,d,g)}function iw(r,o,c){var d=o.pendingProps,g=d.children,y=r!==null?r.memoizedState:null;if(d.mode==="hidden"){if((o.flags&128)!==0){if(d=y!==null?y.baseLanes|c:c,r!==null){for(g=o.child=r.child,y=0;g!==null;)y=y|g.lanes|g.childLanes,g=g.sibling;o.childLanes=y&~d}else o.childLanes=0,o.child=null;return ow(r,o,d,c)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&Wh(o,y!==null?y.cachePool:null),y!==null?ab(o,y):fp(),Kb(o);else return o.lanes=o.childLanes=536870912,ow(r,o,y!==null?y.baseLanes|c:c,c)}else y!==null?(Wh(o,y.cachePool),ab(o,y),xi(),o.memoizedState=null):(r!==null&&Wh(o,null),fp(),xi());return es(r,o,g,c),o.child}function ow(r,o,c,d){var g=op();return g=g===null?null:{parent:kn._currentValue,pool:g},o.memoizedState={baseLanes:c,cachePool:g},r!==null&&Wh(o,null),fp(),Kb(o),r!==null&&Ou(r,o,d,!0),null}function gf(r,o){var c=o.ref;if(c===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(r===null||r.ref!==c)&&(o.flags|=4194816)}}function Pp(r,o,c,d,g){return Oo(o),c=pp(r,o,c,d,void 0,g),d=yp(),r!==null&&!Hn?(xp(r,o,g),Ra(r,o,g)):(vt&&d&&Zg(o),o.flags|=1,es(r,o,c,g),o.child)}function lw(r,o,c,d,g,y){return Oo(o),o.updateQueue=null,c=ob(o,d,c,g),ib(r),d=yp(),r!==null&&!Hn?(xp(r,o,y),Ra(r,o,y)):(vt&&d&&Zg(o),o.flags|=1,es(r,o,c,y),o.child)}function cw(r,o,c,d,g){if(Oo(o),o.stateNode===null){var y=Hl,N=c.contextType;typeof N=="object"&&N!==null&&(y=ls(N)),y=new c(d,y),o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Rp,o.stateNode=y,y._reactInternals=o,y=o.stateNode,y.props=d,y.state=o.memoizedState,y.refs={},cp(o),N=c.contextType,y.context=typeof N=="object"&&N!==null?ls(N):Hl,y.state=o.memoizedState,N=c.getDerivedStateFromProps,typeof N=="function"&&(kp(o,c,N,d),y.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(N=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),N!==y.state&&Rp.enqueueReplaceState(y,y.state,null),zu(o,d,y,g),qu(),y.state=o.memoizedState),typeof y.componentDidMount=="function"&&(o.flags|=4194308),d=!0}else if(r===null){y=o.stateNode;var j=o.memoizedProps,H=Fo(c,j);y.props=H;var se=y.context,ue=c.contextType;N=Hl,typeof ue=="object"&&ue!==null&&(N=ls(ue));var me=c.getDerivedStateFromProps;ue=typeof me=="function"||typeof y.getSnapshotBeforeUpdate=="function",j=o.pendingProps!==j,ue||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(j||se!==N)&&Yb(o,y,d,N),fi=!1;var ae=o.memoizedState;y.state=ae,zu(o,d,y,g),qu(),se=o.memoizedState,j||ae!==se||fi?(typeof me=="function"&&(kp(o,c,me,d),se=o.memoizedState),(H=fi||Qb(o,c,H,d,ae,se,N))?(ue||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(o.flags|=4194308)):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=se),y.props=d,y.state=se,y.context=N,d=H):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{y=o.stateNode,up(r,o),N=o.memoizedProps,ue=Fo(c,N),y.props=ue,me=o.pendingProps,ae=y.context,se=c.contextType,H=Hl,typeof se=="object"&&se!==null&&(H=ls(se)),j=c.getDerivedStateFromProps,(se=typeof j=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(N!==me||ae!==H)&&Yb(o,y,d,H),fi=!1,ae=o.memoizedState,y.state=ae,zu(o,d,y,g),qu();var oe=o.memoizedState;N!==me||ae!==oe||fi||r!==null&&r.dependencies!==null&&Yh(r.dependencies)?(typeof j=="function"&&(kp(o,c,j,d),oe=o.memoizedState),(ue=fi||Qb(o,c,ue,d,ae,oe,H)||r!==null&&r.dependencies!==null&&Yh(r.dependencies))?(se||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,oe,H),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,oe,H)),typeof y.componentDidUpdate=="function"&&(o.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof y.componentDidUpdate!="function"||N===r.memoizedProps&&ae===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||N===r.memoizedProps&&ae===r.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=oe),y.props=d,y.state=oe,y.context=H,d=ue):(typeof y.componentDidUpdate!="function"||N===r.memoizedProps&&ae===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||N===r.memoizedProps&&ae===r.memoizedState||(o.flags|=1024),d=!1)}return y=d,gf(r,o),d=(o.flags&128)!==0,y||d?(y=o.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:y.render(),o.flags|=1,r!==null&&d?(o.child=ec(o,r.child,null,g),o.child=ec(o,null,c,g)):es(r,o,c,g),o.memoizedState=y.state,r=o.child):r=Ra(r,o,g),r}function uw(r,o,c,d){return Pu(),o.flags|=256,es(r,o,c,d),o.child}var Mp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Op(r){return{baseLanes:r,cachePool:W0()}}function Vp(r,o,c){return r=r!==null?r.childLanes&~c:0,o&&(r|=pr),r}function dw(r,o,c){var d=o.pendingProps,g=!1,y=(o.flags&128)!==0,N;if((N=y)||(N=r!==null&&r.memoizedState===null?!1:(Rn.current&2)!==0),N&&(g=!0,o.flags&=-129),N=(o.flags&32)!==0,o.flags&=-33,r===null){if(vt){if(g?yi(o):xi(),vt){var j=dn,H;if(H=j){e:{for(H=j,j=ea;H.nodeType!==8;){if(!j){j=null;break e}if(H=kr(H.nextSibling),H===null){j=null;break e}}j=H}j!==null?(o.memoizedState={dehydrated:j,treeContext:ko!==null?{id:Sa,overflow:ja}:null,retryLane:536870912,hydrationErrors:null},H=qs(18,null,null,0),H.stateNode=j,H.return=o,o.child=H,vs=o,dn=null,H=!0):H=!1}H||Po(o)}if(j=o.memoizedState,j!==null&&(j=j.dehydrated,j!==null))return by(j)?o.lanes=32:o.lanes=536870912,null;ka(o)}return j=d.children,d=d.fallback,g?(xi(),g=o.mode,j=pf({mode:"hidden",children:j},g),d=Io(d,g,c,null),j.return=o,d.return=o,j.sibling=d,o.child=j,g=o.child,g.memoizedState=Op(c),g.childLanes=Vp(r,N,c),o.memoizedState=Mp,d):(yi(o),Lp(o,j))}if(H=r.memoizedState,H!==null&&(j=H.dehydrated,j!==null)){if(y)o.flags&256?(yi(o),o.flags&=-257,o=Fp(r,o,c)):o.memoizedState!==null?(xi(),o.child=r.child,o.flags|=128,o=null):(xi(),g=d.fallback,j=o.mode,d=pf({mode:"visible",children:d.children},j),g=Io(g,j,c,null),g.flags|=2,d.return=o,g.return=o,d.sibling=g,o.child=d,ec(o,r.child,null,c),d=o.child,d.memoizedState=Op(c),d.childLanes=Vp(r,N,c),o.memoizedState=Mp,o=g);else if(yi(o),by(j)){if(N=j.nextSibling&&j.nextSibling.dataset,N)var se=N.dgst;N=se,d=Error(n(419)),d.stack="",d.digest=N,Mu({value:d,source:null,stack:null}),o=Fp(r,o,c)}else if(Hn||Ou(r,o,c,!1),N=(c&r.childLanes)!==0,Hn||N){if(N=Bt,N!==null&&(d=c&-c,d=(d&42)!==0?1:ps(d),d=(d&(N.suspendedLanes|c))!==0?0:d,d!==0&&d!==H.retryLane))throw H.retryLane=d,zl(r,d),Ks(N,r,d),nw;j.data==="$?"||sy(),o=Fp(r,o,c)}else j.data==="$?"?(o.flags|=192,o.child=r.child,o=null):(r=H.treeContext,dn=kr(j.nextSibling),vs=o,vt=!0,Do=null,ea=!1,r!==null&&(fr[mr++]=Sa,fr[mr++]=ja,fr[mr++]=ko,Sa=r.id,ja=r.overflow,ko=o),o=Lp(o,d.children),o.flags|=4096);return o}return g?(xi(),g=d.fallback,j=o.mode,H=r.child,se=H.sibling,d=Ea(H,{mode:"hidden",children:d.children}),d.subtreeFlags=H.subtreeFlags&65011712,se!==null?g=Ea(se,g):(g=Io(g,j,c,null),g.flags|=2),g.return=o,d.return=o,d.sibling=g,o.child=d,d=g,g=o.child,j=r.child.memoizedState,j===null?j=Op(c):(H=j.cachePool,H!==null?(se=kn._currentValue,H=H.parent!==se?{parent:se,pool:se}:H):H=W0(),j={baseLanes:j.baseLanes|c,cachePool:H}),g.memoizedState=j,g.childLanes=Vp(r,N,c),o.memoizedState=Mp,d):(yi(o),c=r.child,r=c.sibling,c=Ea(c,{mode:"visible",children:d.children}),c.return=o,c.sibling=null,r!==null&&(N=o.deletions,N===null?(o.deletions=[r],o.flags|=16):N.push(r)),o.child=c,o.memoizedState=null,c)}function Lp(r,o){return o=pf({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function pf(r,o){return r=qs(22,r,null,o),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Fp(r,o,c){return ec(o,r.child,null,c),r=Lp(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function hw(r,o,c){r.lanes|=o;var d=r.alternate;d!==null&&(d.lanes|=o),sp(r.return,o,c)}function Up(r,o,c,d,g){var y=r.memoizedState;y===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:g}:(y.isBackwards=o,y.rendering=null,y.renderingStartTime=0,y.last=d,y.tail=c,y.tailMode=g)}function fw(r,o,c){var d=o.pendingProps,g=d.revealOrder,y=d.tail;if(es(r,o,d.children,c),d=Rn.current,(d&2)!==0)d=d&1|2,o.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&hw(r,c,o);else if(r.tag===19)hw(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}switch(de(Rn,d),g){case"forwards":for(c=o.child,g=null;c!==null;)r=c.alternate,r!==null&&hf(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),Up(o,!1,g,c,y);break;case"backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(r=g.alternate,r!==null&&hf(r)===null){o.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}Up(o,!0,c,null,y);break;case"together":Up(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Ra(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),Ni|=o.lanes,(c&o.childLanes)===0)if(r!==null){if(Ou(r,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(n(153));if(o.child!==null){for(r=o.child,c=Ea(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=Ea(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function Bp(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&Yh(r)))}function v2(r,o,c){switch(o.tag){case 3:Le(o,o.stateNode.containerInfo),hi(o,kn,r.memoizedState.cache),Pu();break;case 27:case 5:Rt(o);break;case 4:Le(o,o.stateNode.containerInfo);break;case 10:hi(o,o.type,o.memoizedProps.value);break;case 13:var d=o.memoizedState;if(d!==null)return d.dehydrated!==null?(yi(o),o.flags|=128,null):(c&o.child.childLanes)!==0?dw(r,o,c):(yi(o),r=Ra(r,o,c),r!==null?r.sibling:null);yi(o);break;case 19:var g=(r.flags&128)!==0;if(d=(c&o.childLanes)!==0,d||(Ou(r,o,c,!1),d=(c&o.childLanes)!==0),g){if(d)return fw(r,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),de(Rn,Rn.current),d)break;return null;case 22:case 23:return o.lanes=0,iw(r,o,c);case 24:hi(o,kn,r.memoizedState.cache)}return Ra(r,o,c)}function mw(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps)Hn=!0;else{if(!Bp(r,c)&&(o.flags&128)===0)return Hn=!1,v2(r,o,c);Hn=(r.flags&131072)!==0}else Hn=!1,vt&&(o.flags&1048576)!==0&&H0(o,Qh,o.index);switch(o.lanes=0,o.tag){case 16:e:{r=o.pendingProps;var d=o.elementType,g=d._init;if(d=g(d._payload),o.type=d,typeof d=="function")Xg(d)?(r=Fo(d,r),o.tag=1,o=cw(null,o,d,r,c)):(o.tag=0,o=Pp(null,o,d,r,c));else{if(d!=null){if(g=d.$$typeof,g===G){o.tag=11,o=sw(null,o,d,r,c);break e}else if(g===P){o.tag=14,o=rw(null,o,d,r,c);break e}}throw o=ke(d)||d,Error(n(306,o,""))}}return o;case 0:return Pp(r,o,o.type,o.pendingProps,c);case 1:return d=o.type,g=Fo(d,o.pendingProps),cw(r,o,d,g,c);case 3:e:{if(Le(o,o.stateNode.containerInfo),r===null)throw Error(n(387));d=o.pendingProps;var y=o.memoizedState;g=y.element,up(r,o),zu(o,d,null,c);var N=o.memoizedState;if(d=N.cache,hi(o,kn,d),d!==y.cache&&rp(o,[kn],c,!0),qu(),d=N.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:N.cache},o.updateQueue.baseState=y,o.memoizedState=y,o.flags&256){o=uw(r,o,d,c);break e}else if(d!==g){g=dr(Error(n(424)),o),Mu(g),o=uw(r,o,d,c);break e}else{switch(r=o.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(dn=kr(r.firstChild),vs=o,vt=!0,Do=null,ea=!0,c=$b(o,null,d,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Pu(),d===g){o=Ra(r,o,c);break e}es(r,o,d,c)}o=o.child}return o;case 26:return gf(r,o),r===null?(c=x_(o.type,null,o.pendingProps,null))?o.memoizedState=c:vt||(c=o.type,r=o.pendingProps,d=If(Ee.current).createElement(c),d[cn]=o,d[un]=r,ns(d,c,r),nn(d),o.stateNode=d):o.memoizedState=x_(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return Rt(o),r===null&&vt&&(d=o.stateNode=g_(o.type,o.pendingProps,Ee.current),vs=o,ea=!0,g=dn,ji(o.type)?(wy=g,dn=kr(d.firstChild)):dn=g),es(r,o,o.pendingProps.children,c),gf(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&vt&&((g=d=dn)&&(d=K2(d,o.type,o.pendingProps,ea),d!==null?(o.stateNode=d,vs=o,dn=kr(d.firstChild),ea=!1,g=!0):g=!1),g||Po(o)),Rt(o),g=o.type,y=o.pendingProps,N=r!==null?r.memoizedProps:null,d=y.children,yy(g,y)?d=null:N!==null&&yy(g,N)&&(o.flags|=32),o.memoizedState!==null&&(g=pp(r,o,d2,null,null,c),dd._currentValue=g),gf(r,o),es(r,o,d,c),o.child;case 6:return r===null&&vt&&((r=c=dn)&&(c=Q2(c,o.pendingProps,ea),c!==null?(o.stateNode=c,vs=o,dn=null,r=!0):r=!1),r||Po(o)),null;case 13:return dw(r,o,c);case 4:return Le(o,o.stateNode.containerInfo),d=o.pendingProps,r===null?o.child=ec(o,null,d,c):es(r,o,d,c),o.child;case 11:return sw(r,o,o.type,o.pendingProps,c);case 7:return es(r,o,o.pendingProps,c),o.child;case 8:return es(r,o,o.pendingProps.children,c),o.child;case 12:return es(r,o,o.pendingProps.children,c),o.child;case 10:return d=o.pendingProps,hi(o,o.type,d.value),es(r,o,d.children,c),o.child;case 9:return g=o.type._context,d=o.pendingProps.children,Oo(o),g=ls(g),d=d(g),o.flags|=1,es(r,o,d,c),o.child;case 14:return rw(r,o,o.type,o.pendingProps,c);case 15:return aw(r,o,o.type,o.pendingProps,c);case 19:return fw(r,o,c);case 31:return d=o.pendingProps,c=o.mode,d={mode:d.mode,children:d.children},r===null?(c=pf(d,c),c.ref=o.ref,o.child=c,c.return=o,o=c):(c=Ea(r.child,d),c.ref=o.ref,o.child=c,c.return=o,o=c),o;case 22:return iw(r,o,c);case 24:return Oo(o),d=ls(kn),r===null?(g=op(),g===null&&(g=Bt,y=ap(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),o.memoizedState={parent:d,cache:g},cp(o),hi(o,kn,g)):((r.lanes&c)!==0&&(up(r,o),zu(o,null,null,c),qu()),g=r.memoizedState,y=o.memoizedState,g.parent!==d?(g={parent:d,cache:d},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),hi(o,kn,d)):(d=y.cache,hi(o,kn,d),d!==g.cache&&rp(o,[kn],c,!0))),es(r,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(n(156,o.tag))}function Da(r){r.flags|=4}function gw(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!N_(o)){if(o=gr.current,o!==null&&((ft&4194048)===ft?ta!==null:(ft&62914560)!==ft&&(ft&536870912)===0||o!==ta))throw Uu=lp,J0;r.flags|=8192}}function yf(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?Gr():536870912,r.lanes|=o,rc|=o)}function Xu(r,o){if(!vt)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function sn(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,d=0;if(o)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=d,r.childLanes=c,o}function b2(r,o,c){var d=o.pendingProps;switch(ep(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sn(o),null;case 1:return sn(o),null;case 3:return c=o.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),Ca(kn),wt(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Du(o)?Da(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,K0())),sn(o),null;case 26:return c=o.memoizedState,r===null?(Da(o),c!==null?(sn(o),gw(o,c)):(sn(o),o.flags&=-16777217)):c?c!==r.memoizedState?(Da(o),sn(o),gw(o,c)):(sn(o),o.flags&=-16777217):(r.memoizedProps!==d&&Da(o),sn(o),o.flags&=-16777217),null;case 27:Gt(o),c=Ee.current;var g=o.type;if(r!==null&&o.stateNode!=null)r.memoizedProps!==d&&Da(o);else{if(!d){if(o.stateNode===null)throw Error(n(166));return sn(o),null}r=Ce.current,Du(o)?G0(o):(r=g_(g,d,c),o.stateNode=r,Da(o))}return sn(o),null;case 5:if(Gt(o),c=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==d&&Da(o);else{if(!d){if(o.stateNode===null)throw Error(n(166));return sn(o),null}if(r=Ce.current,Du(o))G0(o);else{switch(g=If(Ee.current),r){case 1:r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof d.is=="string"?g.createElement("select",{is:d.is}):g.createElement("select"),d.multiple?r.multiple=!0:d.size&&(r.size=d.size);break;default:r=typeof d.is=="string"?g.createElement(c,{is:d.is}):g.createElement(c)}}r[cn]=o,r[un]=d;e:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)r.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break e;for(;g.sibling===null;){if(g.return===null||g.return===o)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=r;e:switch(ns(r,c,d),c){case"button":case"input":case"select":case"textarea":r=!!d.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Da(o)}}return sn(o),o.flags&=-16777217,null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==d&&Da(o);else{if(typeof d!="string"&&o.stateNode===null)throw Error(n(166));if(r=Ee.current,Du(o)){if(r=o.stateNode,c=o.memoizedProps,d=null,g=vs,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}r[cn]=o,r=!!(r.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||l_(r.nodeValue,c)),r||Po(o)}else r=If(r).createTextNode(d),r[cn]=o,o.stateNode=r}return sn(o),null;case 13:if(d=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Du(o),d!==null&&d.dehydrated!==null){if(r===null){if(!g)throw Error(n(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(n(317));g[cn]=o}else Pu(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;sn(o),g=!1}else g=K0(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(ka(o),o):(ka(o),null)}if(ka(o),(o.flags&128)!==0)return o.lanes=c,o;if(c=d!==null,r=r!==null&&r.memoizedState!==null,c){d=o.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool);var y=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==g&&(d.flags|=2048)}return c!==r&&c&&(o.child.flags|=8192),yf(o,o.updateQueue),sn(o),null;case 4:return wt(),r===null&&hy(o.stateNode.containerInfo),sn(o),null;case 10:return Ca(o.type),sn(o),null;case 19:if(ve(Rn),g=o.memoizedState,g===null)return sn(o),null;if(d=(o.flags&128)!==0,y=g.rendering,y===null)if(d)Xu(g,!1);else{if(hn!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(y=hf(r),y!==null){for(o.flags|=128,Xu(g,!1),r=y.updateQueue,o.updateQueue=r,yf(o,r),o.subtreeFlags=0,r=c,c=o.child;c!==null;)z0(c,r),c=c.sibling;return de(Rn,Rn.current&1|2),o.child}r=r.sibling}g.tail!==null&&Qe()>bf&&(o.flags|=128,d=!0,Xu(g,!1),o.lanes=4194304)}else{if(!d)if(r=hf(y),r!==null){if(o.flags|=128,d=!0,r=r.updateQueue,o.updateQueue=r,yf(o,r),Xu(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!vt)return sn(o),null}else 2*Qe()-g.renderingStartTime>bf&&c!==536870912&&(o.flags|=128,d=!0,Xu(g,!1),o.lanes=4194304);g.isBackwards?(y.sibling=o.child,o.child=y):(r=g.last,r!==null?r.sibling=y:o.child=y,g.last=y)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=Qe(),o.sibling=null,r=Rn.current,de(Rn,d?r&1|2:r&1),o):(sn(o),null);case 22:case 23:return ka(o),mp(),d=o.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(o.flags|=8192):d&&(o.flags|=8192),d?(c&536870912)!==0&&(o.flags&128)===0&&(sn(o),o.subtreeFlags&6&&(o.flags|=8192)):sn(o),c=o.updateQueue,c!==null&&yf(o,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),d=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048),r!==null&&ve(Vo),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),Ca(kn),sn(o),null;case 25:return null;case 30:return null}throw Error(n(156,o.tag))}function w2(r,o){switch(ep(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Ca(kn),wt(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Gt(o),null;case 13:if(ka(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(n(340));Pu()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return ve(Rn),null;case 4:return wt(),null;case 10:return Ca(o.type),null;case 22:case 23:return ka(o),mp(),r!==null&&ve(Vo),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return Ca(kn),null;case 25:return null;default:return null}}function pw(r,o){switch(ep(o),o.tag){case 3:Ca(kn),wt();break;case 26:case 27:case 5:Gt(o);break;case 4:wt();break;case 13:ka(o);break;case 19:ve(Rn);break;case 10:Ca(o.type);break;case 22:case 23:ka(o),mp(),r!==null&&ve(Vo);break;case 24:Ca(kn)}}function Wu(r,o){try{var c=o.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var g=d.next;c=g;do{if((c.tag&r)===r){d=void 0;var y=c.create,N=c.inst;d=y(),N.destroy=d}c=c.next}while(c!==g)}}catch(j){Ut(o,o.return,j)}}function vi(r,o,c){try{var d=o.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var y=g.next;d=y;do{if((d.tag&r)===r){var N=d.inst,j=N.destroy;if(j!==void 0){N.destroy=void 0,g=o;var H=c,se=j;try{se()}catch(ue){Ut(g,H,ue)}}}d=d.next}while(d!==y)}}catch(ue){Ut(o,o.return,ue)}}function yw(r){var o=r.updateQueue;if(o!==null){var c=r.stateNode;try{rb(o,c)}catch(d){Ut(r,r.return,d)}}}function xw(r,o,c){c.props=Fo(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(d){Ut(r,o,d)}}function Ju(r,o){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof c=="function"?r.refCleanup=c(d):c.current=d}}catch(g){Ut(r,o,g)}}function na(r,o){var c=r.ref,d=r.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(g){Ut(r,o,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Ut(r,o,g)}else c.current=null}function vw(r){var o=r.type,c=r.memoizedProps,d=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break e;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(g){Ut(r,r.return,g)}}function qp(r,o,c){try{var d=r.stateNode;q2(d,r.type,c,o),d[un]=o}catch(g){Ut(r,r.return,g)}}function bw(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&ji(r.type)||r.tag===4}function zp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||bw(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&ji(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Hp(r,o,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(r),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Cf));else if(d!==4&&(d===27&&ji(r.type)&&(c=r.stateNode,o=null),r=r.child,r!==null))for(Hp(r,o,c),r=r.sibling;r!==null;)Hp(r,o,c),r=r.sibling}function xf(r,o,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(d!==4&&(d===27&&ji(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(xf(r,o,c),r=r.sibling;r!==null;)xf(r,o,c),r=r.sibling}function ww(r){var o=r.stateNode,c=r.memoizedProps;try{for(var d=r.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);ns(o,d,c),o[cn]=r,o[un]=c}catch(y){Ut(r,r.return,y)}}var Pa=!1,pn=!1,Gp=!1,_w=typeof WeakSet=="function"?WeakSet:Set,Gn=null;function _2(r,o){if(r=r.containerInfo,gy=Of,r=D0(r),zg(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var g=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var N=0,j=-1,H=-1,se=0,ue=0,me=r,ae=null;t:for(;;){for(var oe;me!==c||g!==0&&me.nodeType!==3||(j=N+g),me!==y||d!==0&&me.nodeType!==3||(H=N+d),me.nodeType===3&&(N+=me.nodeValue.length),(oe=me.firstChild)!==null;)ae=me,me=oe;for(;;){if(me===r)break t;if(ae===c&&++se===g&&(j=N),ae===y&&++ue===d&&(H=N),(oe=me.nextSibling)!==null)break;me=ae,ae=me.parentNode}me=oe}c=j===-1||H===-1?null:{start:j,end:H}}else c=null}c=c||{start:0,end:0}}else c=null;for(py={focusedElem:r,selectionRange:c},Of=!1,Gn=o;Gn!==null;)if(o=Gn,r=o.child,(o.subtreeFlags&1024)!==0&&r!==null)r.return=o,Gn=r;else for(;Gn!==null;){switch(o=Gn,y=o.alternate,r=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&y!==null){r=void 0,c=o,g=y.memoizedProps,y=y.memoizedState,d=c.stateNode;try{var ze=Fo(c.type,g,c.elementType===c.type);r=d.getSnapshotBeforeUpdate(ze,y),d.__reactInternalSnapshotBeforeUpdate=r}catch(Ue){Ut(c,c.return,Ue)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,c=r.nodeType,c===9)vy(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":vy(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=o.sibling,r!==null){r.return=o.return,Gn=r;break}Gn=o.return}}function Nw(r,o,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:bi(r,c),d&4&&Wu(5,c);break;case 1:if(bi(r,c),d&4)if(r=c.stateNode,o===null)try{r.componentDidMount()}catch(N){Ut(c,c.return,N)}else{var g=Fo(c.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(g,o,r.__reactInternalSnapshotBeforeUpdate)}catch(N){Ut(c,c.return,N)}}d&64&&yw(c),d&512&&Ju(c,c.return);break;case 3:if(bi(r,c),d&64&&(r=c.updateQueue,r!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{rb(r,o)}catch(N){Ut(c,c.return,N)}}break;case 27:o===null&&d&4&&ww(c);case 26:case 5:bi(r,c),o===null&&d&4&&vw(c),d&512&&Ju(c,c.return);break;case 12:bi(r,c);break;case 13:bi(r,c),d&4&&Sw(r,c),d&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=k2.bind(null,c),Y2(r,c))));break;case 22:if(d=c.memoizedState!==null||Pa,!d){o=o!==null&&o.memoizedState!==null||pn,g=Pa;var y=pn;Pa=d,(pn=o)&&!y?wi(r,c,(c.subtreeFlags&8772)!==0):bi(r,c),Pa=g,pn=y}break;case 30:break;default:bi(r,c)}}function Tw(r){var o=r.alternate;o!==null&&(r.alternate=null,Tw(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&Fn(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Yt=null,Es=!1;function Ma(r,o,c){for(c=c.child;c!==null;)Ew(r,o,c),c=c.sibling}function Ew(r,o,c){if(ut&&typeof ut.onCommitFiberUnmount=="function")try{ut.onCommitFiberUnmount(pt,c)}catch{}switch(c.tag){case 26:pn||na(c,o),Ma(r,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:pn||na(c,o);var d=Yt,g=Es;ji(c.type)&&(Yt=c.stateNode,Es=!1),Ma(r,o,c),od(c.stateNode),Yt=d,Es=g;break;case 5:pn||na(c,o);case 6:if(d=Yt,g=Es,Yt=null,Ma(r,o,c),Yt=d,Es=g,Yt!==null)if(Es)try{(Yt.nodeType===9?Yt.body:Yt.nodeName==="HTML"?Yt.ownerDocument.body:Yt).removeChild(c.stateNode)}catch(y){Ut(c,o,y)}else try{Yt.removeChild(c.stateNode)}catch(y){Ut(c,o,y)}break;case 18:Yt!==null&&(Es?(r=Yt,f_(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),gd(r)):f_(Yt,c.stateNode));break;case 4:d=Yt,g=Es,Yt=c.stateNode.containerInfo,Es=!0,Ma(r,o,c),Yt=d,Es=g;break;case 0:case 11:case 14:case 15:pn||vi(2,c,o),pn||vi(4,c,o),Ma(r,o,c);break;case 1:pn||(na(c,o),d=c.stateNode,typeof d.componentWillUnmount=="function"&&xw(c,o,d)),Ma(r,o,c);break;case 21:Ma(r,o,c);break;case 22:pn=(d=pn)||c.memoizedState!==null,Ma(r,o,c),pn=d;break;default:Ma(r,o,c)}}function Sw(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{gd(r)}catch(c){Ut(o,o.return,c)}}function N2(r){switch(r.tag){case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new _w),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new _w),o;default:throw Error(n(435,r.tag))}}function $p(r,o){var c=N2(r);o.forEach(function(d){var g=R2.bind(null,r,d);c.has(d)||(c.add(d),d.then(g,g))})}function zs(r,o){var c=o.deletions;if(c!==null)for(var d=0;d<c.length;d++){var g=c[d],y=r,N=o,j=N;e:for(;j!==null;){switch(j.tag){case 27:if(ji(j.type)){Yt=j.stateNode,Es=!1;break e}break;case 5:Yt=j.stateNode,Es=!1;break e;case 3:case 4:Yt=j.stateNode.containerInfo,Es=!0;break e}j=j.return}if(Yt===null)throw Error(n(160));Ew(y,N,g),Yt=null,Es=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)jw(o,r),o=o.sibling}var Ir=null;function jw(r,o){var c=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:zs(o,r),Hs(r),d&4&&(vi(3,r,r.return),Wu(3,r),vi(5,r,r.return));break;case 1:zs(o,r),Hs(r),d&512&&(pn||c===null||na(c,c.return)),d&64&&Pa&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var g=Ir;if(zs(o,r),Hs(r),d&512&&(pn||c===null||na(c,c.return)),d&4){var y=c!==null?c.memoizedState:null;if(d=r.memoizedState,c===null)if(d===null)if(r.stateNode===null){e:{d=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(d){case"title":y=g.getElementsByTagName("title")[0],(!y||y[$r]||y[cn]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(d),g.head.insertBefore(y,g.querySelector("head > title"))),ns(y,d,c),y[cn]=r,nn(y),d=y;break e;case"link":var N=w_("link","href",g).get(d+(c.href||""));if(N){for(var j=0;j<N.length;j++)if(y=N[j],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){N.splice(j,1);break t}}y=g.createElement(d),ns(y,d,c),g.head.appendChild(y);break;case"meta":if(N=w_("meta","content",g).get(d+(c.content||""))){for(j=0;j<N.length;j++)if(y=N[j],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){N.splice(j,1);break t}}y=g.createElement(d),ns(y,d,c),g.head.appendChild(y);break;default:throw Error(n(468,d))}y[cn]=r,nn(y),d=y}r.stateNode=d}else __(g,r.type,r.stateNode);else r.stateNode=b_(g,d,r.memoizedProps);else y!==d?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,d===null?__(g,r.type,r.stateNode):b_(g,d,r.memoizedProps)):d===null&&r.stateNode!==null&&qp(r,r.memoizedProps,c.memoizedProps)}break;case 27:zs(o,r),Hs(r),d&512&&(pn||c===null||na(c,c.return)),c!==null&&d&4&&qp(r,r.memoizedProps,c.memoizedProps);break;case 5:if(zs(o,r),Hs(r),d&512&&(pn||c===null||na(c,c.return)),r.flags&32){g=r.stateNode;try{or(g,"")}catch(oe){Ut(r,r.return,oe)}}d&4&&r.stateNode!=null&&(g=r.memoizedProps,qp(r,g,c!==null?c.memoizedProps:g)),d&1024&&(Gp=!0);break;case 6:if(zs(o,r),Hs(r),d&4){if(r.stateNode===null)throw Error(n(162));d=r.memoizedProps,c=r.stateNode;try{c.nodeValue=d}catch(oe){Ut(r,r.return,oe)}}break;case 3:if(Df=null,g=Ir,Ir=kf(o.containerInfo),zs(o,r),Ir=g,Hs(r),d&4&&c!==null&&c.memoizedState.isDehydrated)try{gd(o.containerInfo)}catch(oe){Ut(r,r.return,oe)}Gp&&(Gp=!1,Aw(r));break;case 4:d=Ir,Ir=kf(r.stateNode.containerInfo),zs(o,r),Hs(r),Ir=d;break;case 12:zs(o,r),Hs(r);break;case 13:zs(o,r),Hs(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Jp=Qe()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,$p(r,d)));break;case 22:g=r.memoizedState!==null;var H=c!==null&&c.memoizedState!==null,se=Pa,ue=pn;if(Pa=se||g,pn=ue||H,zs(o,r),pn=ue,Pa=se,Hs(r),d&8192)e:for(o=r.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||H||Pa||pn||Uo(r)),c=null,o=r;;){if(o.tag===5||o.tag===26){if(c===null){H=c=o;try{if(y=H.stateNode,g)N=y.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none";else{j=H.stateNode;var me=H.memoizedProps.style,ae=me!=null&&me.hasOwnProperty("display")?me.display:null;j.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(oe){Ut(H,H.return,oe)}}}else if(o.tag===6){if(c===null){H=o;try{H.stateNode.nodeValue=g?"":H.memoizedProps}catch(oe){Ut(H,H.return,oe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}d&4&&(d=r.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,$p(r,c))));break;case 19:zs(o,r),Hs(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,$p(r,d)));break;case 30:break;case 21:break;default:zs(o,r),Hs(r)}}function Hs(r){var o=r.flags;if(o&2){try{for(var c,d=r.return;d!==null;){if(bw(d)){c=d;break}d=d.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var g=c.stateNode,y=zp(r);xf(r,y,g);break;case 5:var N=c.stateNode;c.flags&32&&(or(N,""),c.flags&=-33);var j=zp(r);xf(r,j,N);break;case 3:case 4:var H=c.stateNode.containerInfo,se=zp(r);Hp(r,se,H);break;default:throw Error(n(161))}}catch(ue){Ut(r,r.return,ue)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function Aw(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;Aw(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function bi(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Nw(r,o.alternate,o),o=o.sibling}function Uo(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:vi(4,o,o.return),Uo(o);break;case 1:na(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&xw(o,o.return,c),Uo(o);break;case 27:od(o.stateNode);case 26:case 5:na(o,o.return),Uo(o);break;case 22:o.memoizedState===null&&Uo(o);break;case 30:Uo(o);break;default:Uo(o)}r=r.sibling}}function wi(r,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var d=o.alternate,g=r,y=o,N=y.flags;switch(y.tag){case 0:case 11:case 15:wi(g,y,c),Wu(4,y);break;case 1:if(wi(g,y,c),d=y,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(se){Ut(d,d.return,se)}if(d=y,g=d.updateQueue,g!==null){var j=d.stateNode;try{var H=g.shared.hiddenCallbacks;if(H!==null)for(g.shared.hiddenCallbacks=null,g=0;g<H.length;g++)sb(H[g],j)}catch(se){Ut(d,d.return,se)}}c&&N&64&&yw(y),Ju(y,y.return);break;case 27:ww(y);case 26:case 5:wi(g,y,c),c&&d===null&&N&4&&vw(y),Ju(y,y.return);break;case 12:wi(g,y,c);break;case 13:wi(g,y,c),c&&N&4&&Sw(g,y);break;case 22:y.memoizedState===null&&wi(g,y,c),Ju(y,y.return);break;case 30:break;default:wi(g,y,c)}o=o.sibling}}function Kp(r,o){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&Vu(c))}function Qp(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Vu(r))}function sa(r,o,c,d){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Cw(r,o,c,d),o=o.sibling}function Cw(r,o,c,d){var g=o.flags;switch(o.tag){case 0:case 11:case 15:sa(r,o,c,d),g&2048&&Wu(9,o);break;case 1:sa(r,o,c,d);break;case 3:sa(r,o,c,d),g&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Vu(r)));break;case 12:if(g&2048){sa(r,o,c,d),r=o.stateNode;try{var y=o.memoizedProps,N=y.id,j=y.onPostCommit;typeof j=="function"&&j(N,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(H){Ut(o,o.return,H)}}else sa(r,o,c,d);break;case 13:sa(r,o,c,d);break;case 23:break;case 22:y=o.stateNode,N=o.alternate,o.memoizedState!==null?y._visibility&2?sa(r,o,c,d):Zu(r,o):y._visibility&2?sa(r,o,c,d):(y._visibility|=2,tc(r,o,c,d,(o.subtreeFlags&10256)!==0)),g&2048&&Kp(N,o);break;case 24:sa(r,o,c,d),g&2048&&Qp(o.alternate,o);break;default:sa(r,o,c,d)}}function tc(r,o,c,d,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var y=r,N=o,j=c,H=d,se=N.flags;switch(N.tag){case 0:case 11:case 15:tc(y,N,j,H,g),Wu(8,N);break;case 23:break;case 22:var ue=N.stateNode;N.memoizedState!==null?ue._visibility&2?tc(y,N,j,H,g):Zu(y,N):(ue._visibility|=2,tc(y,N,j,H,g)),g&&se&2048&&Kp(N.alternate,N);break;case 24:tc(y,N,j,H,g),g&&se&2048&&Qp(N.alternate,N);break;default:tc(y,N,j,H,g)}o=o.sibling}}function Zu(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=r,d=o,g=d.flags;switch(d.tag){case 22:Zu(c,d),g&2048&&Kp(d.alternate,d);break;case 24:Zu(c,d),g&2048&&Qp(d.alternate,d);break;default:Zu(c,d)}o=o.sibling}}var ed=8192;function nc(r){if(r.subtreeFlags&ed)for(r=r.child;r!==null;)Iw(r),r=r.sibling}function Iw(r){switch(r.tag){case 26:nc(r),r.flags&ed&&r.memoizedState!==null&&lC(Ir,r.memoizedState,r.memoizedProps);break;case 5:nc(r);break;case 3:case 4:var o=Ir;Ir=kf(r.stateNode.containerInfo),nc(r),Ir=o;break;case 22:r.memoizedState===null&&(o=r.alternate,o!==null&&o.memoizedState!==null?(o=ed,ed=16777216,nc(r),ed=o):nc(r));break;default:nc(r)}}function kw(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function td(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];Gn=d,Dw(d,r)}kw(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Rw(r),r=r.sibling}function Rw(r){switch(r.tag){case 0:case 11:case 15:td(r),r.flags&2048&&vi(9,r,r.return);break;case 3:td(r);break;case 12:td(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,vf(r)):td(r);break;default:td(r)}}function vf(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];Gn=d,Dw(d,r)}kw(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:vi(8,o,o.return),vf(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,vf(o));break;default:vf(o)}r=r.sibling}}function Dw(r,o){for(;Gn!==null;){var c=Gn;switch(c.tag){case 0:case 11:case 15:vi(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Vu(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,Gn=d;else e:for(c=r;Gn!==null;){d=Gn;var g=d.sibling,y=d.return;if(Tw(d),d===c){Gn=null;break e}if(g!==null){g.return=y,Gn=g;break e}Gn=y}}}var T2={getCacheForType:function(r){var o=ls(kn),c=o.data.get(r);return c===void 0&&(c=r(),o.data.set(r,c)),c}},E2=typeof WeakMap=="function"?WeakMap:Map,jt=0,Bt=null,rt=null,ft=0,At=0,Gs=null,_i=!1,sc=!1,Yp=!1,Oa=0,hn=0,Ni=0,Bo=0,Xp=0,pr=0,rc=0,nd=null,Ss=null,Wp=!1,Jp=0,bf=1/0,wf=null,Ti=null,ts=0,Ei=null,ac=null,ic=0,Zp=0,ey=null,Pw=null,sd=0,ty=null;function $s(){if((jt&2)!==0&&ft!==0)return ft&-ft;if(O.T!==null){var r=Kl;return r!==0?r:ly()}return Sr()}function Mw(){pr===0&&(pr=(ft&536870912)===0||vt?Hr():536870912);var r=gr.current;return r!==null&&(r.flags|=32),pr}function Ks(r,o,c){(r===Bt&&(At===2||At===9)||r.cancelPendingCommit!==null)&&(oc(r,0),Si(r,ft,pr,!1)),gs(r,c),((jt&2)===0||r!==Bt)&&(r===Bt&&((jt&2)===0&&(Bo|=c),hn===4&&Si(r,ft,pr,!1)),ra(r))}function Ow(r,o,c){if((jt&6)!==0)throw Error(n(327));var d=!c&&(o&124)===0&&(o&r.expiredLanes)===0||Tr(r,o),g=d?A2(r,o):ry(r,o,!0),y=d;do{if(g===0){sc&&!d&&Si(r,o,0,!1);break}else{if(c=r.current.alternate,y&&!S2(c)){g=ry(r,o,!1),y=!1;continue}if(g===2){if(y=o,r.errorRecoveryDisabledLanes&y)var N=0;else N=r.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){o=N;e:{var j=r;g=nd;var H=j.current.memoizedState.isDehydrated;if(H&&(oc(j,N).flags|=256),N=ry(j,N,!1),N!==2){if(Yp&&!H){j.errorRecoveryDisabledLanes|=y,Bo|=y,g=4;break e}y=Ss,Ss=g,y!==null&&(Ss===null?Ss=y:Ss.push.apply(Ss,y))}g=N}if(y=!1,g!==2)continue}}if(g===1){oc(r,0),Si(r,o,0,!0);break}e:{switch(d=r,y=g,y){case 0:case 1:throw Error(n(345));case 4:if((o&4194048)!==o)break;case 6:Si(d,o,pr,!_i);break e;case 2:Ss=null;break;case 3:case 5:break;default:throw Error(n(329))}if((o&62914560)===o&&(g=Jp+300-Qe(),10<g)){if(Si(d,o,pr,!_i),zr(d,0,!0)!==0)break e;d.timeoutHandle=d_(Vw.bind(null,d,c,Ss,wf,Wp,o,pr,Bo,rc,_i,y,2,-0,0),g);break e}Vw(d,c,Ss,wf,Wp,o,pr,Bo,rc,_i,y,0,-0,0)}}break}while(!0);ra(r)}function Vw(r,o,c,d,g,y,N,j,H,se,ue,me,ae,oe){if(r.timeoutHandle=-1,me=o.subtreeFlags,(me&8192||(me&16785408)===16785408)&&(ud={stylesheets:null,count:0,unsuspend:oC},Iw(o),me=cC(),me!==null)){r.cancelPendingCommit=me(Hw.bind(null,r,o,y,c,d,g,N,j,H,ue,1,ae,oe)),Si(r,y,N,!se);return}Hw(r,o,y,c,d,g,N,j,H)}function S2(r){for(var o=r;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var g=c[d],y=g.getSnapshot;g=g.value;try{if(!Bs(y(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Si(r,o,c,d){o&=~Xp,o&=~Bo,r.suspendedLanes|=o,r.pingedLanes&=~o,d&&(r.warmLanes|=o),d=r.expirationTimes;for(var g=o;0<g;){var y=31-jn(g),N=1<<y;d[y]=-1,g&=~N}c!==0&&sr(r,c,o)}function _f(){return(jt&6)===0?(rd(0),!1):!0}function ny(){if(rt!==null){if(At===0)var r=rt.return;else r=rt,Aa=Mo=null,vp(r),Zl=null,Qu=0,r=rt;for(;r!==null;)pw(r.alternate,r),r=r.return;rt=null}}function oc(r,o){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,H2(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),ny(),Bt=r,rt=c=Ea(r.current,null),ft=o,At=0,Gs=null,_i=!1,sc=Tr(r,o),Yp=!1,rc=pr=Xp=Bo=Ni=hn=0,Ss=nd=null,Wp=!1,(o&8)!==0&&(o|=o&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=o;0<d;){var g=31-jn(d),y=1<<g;o|=r[g],d&=~y}return Oa=o,zh(),c}function Lw(r,o){Ze=null,O.H=cf,o===Fu||o===Jh?(o=tb(),At=3):o===J0?(o=tb(),At=4):At=o===nw?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Gs=o,rt===null&&(hn=1,mf(r,dr(o,r.current)))}function Fw(){var r=O.H;return O.H=cf,r===null?cf:r}function Uw(){var r=O.A;return O.A=T2,r}function sy(){hn=4,_i||(ft&4194048)!==ft&&gr.current!==null||(sc=!0),(Ni&134217727)===0&&(Bo&134217727)===0||Bt===null||Si(Bt,ft,pr,!1)}function ry(r,o,c){var d=jt;jt|=2;var g=Fw(),y=Uw();(Bt!==r||ft!==o)&&(wf=null,oc(r,o)),o=!1;var N=hn;e:do try{if(At!==0&&rt!==null){var j=rt,H=Gs;switch(At){case 8:ny(),N=6;break e;case 3:case 2:case 9:case 6:gr.current===null&&(o=!0);var se=At;if(At=0,Gs=null,lc(r,j,H,se),c&&sc){N=0;break e}break;default:se=At,At=0,Gs=null,lc(r,j,H,se)}}j2(),N=hn;break}catch(ue){Lw(r,ue)}while(!0);return o&&r.shellSuspendCounter++,Aa=Mo=null,jt=d,O.H=g,O.A=y,rt===null&&(Bt=null,ft=0,zh()),N}function j2(){for(;rt!==null;)Bw(rt)}function A2(r,o){var c=jt;jt|=2;var d=Fw(),g=Uw();Bt!==r||ft!==o?(wf=null,bf=Qe()+500,oc(r,o)):sc=Tr(r,o);e:do try{if(At!==0&&rt!==null){o=rt;var y=Gs;t:switch(At){case 1:At=0,Gs=null,lc(r,o,y,1);break;case 2:case 9:if(Z0(y)){At=0,Gs=null,qw(o);break}o=function(){At!==2&&At!==9||Bt!==r||(At=7),ra(r)},y.then(o,o);break e;case 3:At=7;break e;case 4:At=5;break e;case 7:Z0(y)?(At=0,Gs=null,qw(o)):(At=0,Gs=null,lc(r,o,y,7));break;case 5:var N=null;switch(rt.tag){case 26:N=rt.memoizedState;case 5:case 27:var j=rt;if(!N||N_(N)){At=0,Gs=null;var H=j.sibling;if(H!==null)rt=H;else{var se=j.return;se!==null?(rt=se,Nf(se)):rt=null}break t}}At=0,Gs=null,lc(r,o,y,5);break;case 6:At=0,Gs=null,lc(r,o,y,6);break;case 8:ny(),hn=6;break e;default:throw Error(n(462))}}C2();break}catch(ue){Lw(r,ue)}while(!0);return Aa=Mo=null,O.H=d,O.A=g,jt=c,rt!==null?0:(Bt=null,ft=0,zh(),hn)}function C2(){for(;rt!==null&&!Te();)Bw(rt)}function Bw(r){var o=mw(r.alternate,r,Oa);r.memoizedProps=r.pendingProps,o===null?Nf(r):rt=o}function qw(r){var o=r,c=o.alternate;switch(o.tag){case 15:case 0:o=lw(c,o,o.pendingProps,o.type,void 0,ft);break;case 11:o=lw(c,o,o.pendingProps,o.type.render,o.ref,ft);break;case 5:vp(o);default:pw(c,o),o=rt=z0(o,Oa),o=mw(c,o,Oa)}r.memoizedProps=r.pendingProps,o===null?Nf(r):rt=o}function lc(r,o,c,d){Aa=Mo=null,vp(o),Zl=null,Qu=0;var g=o.return;try{if(x2(r,g,o,c,ft)){hn=1,mf(r,dr(c,r.current)),rt=null;return}}catch(y){if(g!==null)throw rt=g,y;hn=1,mf(r,dr(c,r.current)),rt=null;return}o.flags&32768?(vt||d===1?r=!0:sc||(ft&536870912)!==0?r=!1:(_i=r=!0,(d===2||d===9||d===3||d===6)&&(d=gr.current,d!==null&&d.tag===13&&(d.flags|=16384))),zw(o,r)):Nf(o)}function Nf(r){var o=r;do{if((o.flags&32768)!==0){zw(o,_i);return}r=o.return;var c=b2(o.alternate,o,Oa);if(c!==null){rt=c;return}if(o=o.sibling,o!==null){rt=o;return}rt=o=r}while(o!==null);hn===0&&(hn=5)}function zw(r,o){do{var c=w2(r.alternate,r);if(c!==null){c.flags&=32767,rt=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(r=r.sibling,r!==null)){rt=r;return}rt=r=c}while(r!==null);hn=6,rt=null}function Hw(r,o,c,d,g,y,N,j,H){r.cancelPendingCommit=null;do Tf();while(ts!==0);if((jt&6)!==0)throw Error(n(327));if(o!==null){if(o===r.current)throw Error(n(177));if(y=o.lanes|o.childLanes,y|=Qg,go(r,c,y,N,j,H),r===Bt&&(rt=Bt=null,ft=0),ac=o,Ei=r,ic=c,Zp=y,ey=g,Pw=d,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,D2(Ge,function(){return Yw(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||d){d=O.T,O.T=null,g=ie.p,ie.p=2,N=jt,jt|=4;try{_2(r,o,c)}finally{jt=N,ie.p=g,O.T=d}}ts=1,Gw(),$w(),Kw()}}function Gw(){if(ts===1){ts=0;var r=Ei,o=ac,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=O.T,O.T=null;var d=ie.p;ie.p=2;var g=jt;jt|=4;try{jw(o,r);var y=py,N=D0(r.containerInfo),j=y.focusedElem,H=y.selectionRange;if(N!==j&&j&&j.ownerDocument&&R0(j.ownerDocument.documentElement,j)){if(H!==null&&zg(j)){var se=H.start,ue=H.end;if(ue===void 0&&(ue=se),"selectionStart"in j)j.selectionStart=se,j.selectionEnd=Math.min(ue,j.value.length);else{var me=j.ownerDocument||document,ae=me&&me.defaultView||window;if(ae.getSelection){var oe=ae.getSelection(),ze=j.textContent.length,Ue=Math.min(H.start,ze),Ot=H.end===void 0?Ue:Math.min(H.end,ze);!oe.extend&&Ue>Ot&&(N=Ot,Ot=Ue,Ue=N);var X=k0(j,Ue),K=k0(j,Ot);if(X&&K&&(oe.rangeCount!==1||oe.anchorNode!==X.node||oe.anchorOffset!==X.offset||oe.focusNode!==K.node||oe.focusOffset!==K.offset)){var ee=me.createRange();ee.setStart(X.node,X.offset),oe.removeAllRanges(),Ue>Ot?(oe.addRange(ee),oe.extend(K.node,K.offset)):(ee.setEnd(K.node,K.offset),oe.addRange(ee))}}}}for(me=[],oe=j;oe=oe.parentNode;)oe.nodeType===1&&me.push({element:oe,left:oe.scrollLeft,top:oe.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<me.length;j++){var fe=me[j];fe.element.scrollLeft=fe.left,fe.element.scrollTop=fe.top}}Of=!!gy,py=gy=null}finally{jt=g,ie.p=d,O.T=c}}r.current=o,ts=2}}function $w(){if(ts===2){ts=0;var r=Ei,o=ac,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=O.T,O.T=null;var d=ie.p;ie.p=2;var g=jt;jt|=4;try{Nw(r,o.alternate,o)}finally{jt=g,ie.p=d,O.T=c}}ts=3}}function Kw(){if(ts===4||ts===3){ts=0,$e();var r=Ei,o=ac,c=ic,d=Pw;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?ts=5:(ts=0,ac=Ei=null,Qw(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Ti=null),oi(c),o=o.stateNode,ut&&typeof ut.onCommitFiberRoot=="function")try{ut.onCommitFiberRoot(pt,o,void 0,(o.current.flags&128)===128)}catch{}if(d!==null){o=O.T,g=ie.p,ie.p=2,O.T=null;try{for(var y=r.onRecoverableError,N=0;N<d.length;N++){var j=d[N];y(j.value,{componentStack:j.stack})}}finally{O.T=o,ie.p=g}}(ic&3)!==0&&Tf(),ra(r),g=r.pendingLanes,(c&4194090)!==0&&(g&42)!==0?r===ty?sd++:(sd=0,ty=r):sd=0,rd(0)}}function Qw(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Vu(o)))}function Tf(r){return Gw(),$w(),Kw(),Yw()}function Yw(){if(ts!==5)return!1;var r=Ei,o=Zp;Zp=0;var c=oi(ic),d=O.T,g=ie.p;try{ie.p=32>c?32:c,O.T=null,c=ey,ey=null;var y=Ei,N=ic;if(ts=0,ac=Ei=null,ic=0,(jt&6)!==0)throw Error(n(331));var j=jt;if(jt|=4,Rw(y.current),Cw(y,y.current,N,c),jt=j,rd(0,!1),ut&&typeof ut.onPostCommitFiberRoot=="function")try{ut.onPostCommitFiberRoot(pt,y)}catch{}return!0}finally{ie.p=g,O.T=d,Qw(r,o)}}function Xw(r,o,c){o=dr(c,o),o=Dp(r.stateNode,o,2),r=gi(r,o,2),r!==null&&(gs(r,2),ra(r))}function Ut(r,o,c){if(r.tag===3)Xw(r,r,c);else for(;o!==null;){if(o.tag===3){Xw(o,r,c);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ti===null||!Ti.has(d))){r=dr(c,r),c=ew(2),d=gi(o,c,2),d!==null&&(tw(c,d,o,r),gs(d,2),ra(d));break}}o=o.return}}function ay(r,o,c){var d=r.pingCache;if(d===null){d=r.pingCache=new E2;var g=new Set;d.set(o,g)}else g=d.get(o),g===void 0&&(g=new Set,d.set(o,g));g.has(c)||(Yp=!0,g.add(c),r=I2.bind(null,r,o,c),o.then(r,r))}function I2(r,o,c){var d=r.pingCache;d!==null&&d.delete(o),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Bt===r&&(ft&c)===c&&(hn===4||hn===3&&(ft&62914560)===ft&&300>Qe()-Jp?(jt&2)===0&&oc(r,0):Xp|=c,rc===ft&&(rc=0)),ra(r)}function Ww(r,o){o===0&&(o=Gr()),r=zl(r,o),r!==null&&(gs(r,o),ra(r))}function k2(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),Ww(r,c)}function R2(r,o){var c=0;switch(r.tag){case 13:var d=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(o),Ww(r,c)}function D2(r,o){return ce(r,o)}var Ef=null,cc=null,iy=!1,Sf=!1,oy=!1,qo=0;function ra(r){r!==cc&&r.next===null&&(cc===null?Ef=cc=r:cc=cc.next=r),Sf=!0,iy||(iy=!0,M2())}function rd(r,o){if(!oy&&Sf){oy=!0;do for(var c=!1,d=Ef;d!==null;){if(r!==0){var g=d.pendingLanes;if(g===0)var y=0;else{var N=d.suspendedLanes,j=d.pingedLanes;y=(1<<31-jn(42|r)+1)-1,y&=g&~(N&~j),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,t_(d,y))}else y=ft,y=zr(d,d===Bt?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(y&3)===0||Tr(d,y)||(c=!0,t_(d,y));d=d.next}while(c);oy=!1}}function P2(){Jw()}function Jw(){Sf=iy=!1;var r=0;qo!==0&&(z2()&&(r=qo),qo=0);for(var o=Qe(),c=null,d=Ef;d!==null;){var g=d.next,y=Zw(d,o);y===0?(d.next=null,c===null?Ef=g:c.next=g,g===null&&(cc=c)):(c=d,(r!==0||(y&3)!==0)&&(Sf=!0)),d=g}rd(r)}function Zw(r,o){for(var c=r.suspendedLanes,d=r.pingedLanes,g=r.expirationTimes,y=r.pendingLanes&-62914561;0<y;){var N=31-jn(y),j=1<<N,H=g[N];H===-1?((j&c)===0||(j&d)!==0)&&(g[N]=mo(j,o)):H<=o&&(r.expiredLanes|=j),y&=~j}if(o=Bt,c=ft,c=zr(r,r===o?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,c===0||r===o&&(At===2||At===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&Ae(d),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Tr(r,c)){if(o=c&-c,o===r.callbackPriority)return o;switch(d!==null&&Ae(d),oi(c)){case 2:case 8:c=ot;break;case 32:c=Ge;break;case 268435456:c=en;break;default:c=Ge}return d=e_.bind(null,r),c=ce(c,d),r.callbackPriority=o,r.callbackNode=c,o}return d!==null&&d!==null&&Ae(d),r.callbackPriority=2,r.callbackNode=null,2}function e_(r,o){if(ts!==0&&ts!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Tf()&&r.callbackNode!==c)return null;var d=ft;return d=zr(r,r===Bt?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(Ow(r,d,o),Zw(r,Qe()),r.callbackNode!=null&&r.callbackNode===c?e_.bind(null,r):null)}function t_(r,o){if(Tf())return null;Ow(r,o,!0)}function M2(){G2(function(){(jt&6)!==0?ce(gt,P2):Jw()})}function ly(){return qo===0&&(qo=Hr()),qo}function n_(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:kl(""+r)}function s_(r,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,r.id&&c.setAttribute("form",r.id),o.parentNode.insertBefore(c,o),r=new FormData(r),c.parentNode.removeChild(c),r}function O2(r,o,c,d,g){if(o==="submit"&&c&&c.stateNode===g){var y=n_((g[un]||null).action),N=d.submitter;N&&(o=(o=N[un]||null)?n_(o.formAction):N.getAttribute("formAction"),o!==null&&(y=o,N=null));var j=new Rl("action","action",null,d,g);r.push({event:j,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(qo!==0){var H=N?s_(g,N):new FormData(g);Ap(c,{pending:!0,data:H,method:g.method,action:y},null,H)}}else typeof y=="function"&&(j.preventDefault(),H=N?s_(g,N):new FormData(g),Ap(c,{pending:!0,data:H,method:g.method,action:y},y,H))},currentTarget:g}]})}}for(var cy=0;cy<Kg.length;cy++){var uy=Kg[cy],V2=uy.toLowerCase(),L2=uy[0].toUpperCase()+uy.slice(1);Cr(V2,"on"+L2)}Cr(O0,"onAnimationEnd"),Cr(V0,"onAnimationIteration"),Cr(L0,"onAnimationStart"),Cr("dblclick","onDoubleClick"),Cr("focusin","onFocus"),Cr("focusout","onBlur"),Cr(t2,"onTransitionRun"),Cr(n2,"onTransitionStart"),Cr(s2,"onTransitionCancel"),Cr(F0,"onTransitionEnd"),je("onMouseEnter",["mouseout","mouseover"]),je("onMouseLeave",["mouseout","mouseover"]),je("onPointerEnter",["pointerout","pointerover"]),je("onPointerLeave",["pointerout","pointerover"]),xe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xe("onBeforeInput",["compositionend","keypress","textInput","paste"]),xe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ad="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),F2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ad));function r_(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var d=r[c],g=d.event;d=d.listeners;e:{var y=void 0;if(o)for(var N=d.length-1;0<=N;N--){var j=d[N],H=j.instance,se=j.currentTarget;if(j=j.listener,H!==y&&g.isPropagationStopped())break e;y=j,g.currentTarget=se;try{y(g)}catch(ue){ff(ue)}g.currentTarget=null,y=H}else for(N=0;N<d.length;N++){if(j=d[N],H=j.instance,se=j.currentTarget,j=j.listener,H!==y&&g.isPropagationStopped())break e;y=j,g.currentTarget=se;try{y(g)}catch(ue){ff(ue)}g.currentTarget=null,y=H}}}}function at(r,o){var c=o[rr];c===void 0&&(c=o[rr]=new Set);var d=r+"__bubble";c.has(d)||(a_(o,r,2,!1),c.add(d))}function dy(r,o,c){var d=0;o&&(d|=4),a_(c,r,d,o)}var jf="_reactListening"+Math.random().toString(36).slice(2);function hy(r){if(!r[jf]){r[jf]=!0,Pe.forEach(function(c){c!=="selectionchange"&&(F2.has(c)||dy(c,!1,r),dy(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[jf]||(o[jf]=!0,dy("selectionchange",!1,o))}}function a_(r,o,c,d){switch(C_(o)){case 2:var g=hC;break;case 8:g=fC;break;default:g=Sy}c=g.bind(null,o,c,r),g=void 0,!cr||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),d?g!==void 0?r.addEventListener(o,c,{capture:!0,passive:g}):r.addEventListener(o,c,!0):g!==void 0?r.addEventListener(o,c,{passive:g}):r.addEventListener(o,c,!1)}function fy(r,o,c,d,g){var y=d;if((o&1)===0&&(o&2)===0&&d!==null)e:for(;;){if(d===null)return;var N=d.tag;if(N===3||N===4){var j=d.stateNode.containerInfo;if(j===g)break;if(N===4)for(N=d.return;N!==null;){var H=N.tag;if((H===3||H===4)&&N.stateNode.containerInfo===g)return;N=N.return}for(;j!==null;){if(N=ar(j),N===null)return;if(H=N.tag,H===5||H===6||H===26||H===27){d=y=N;continue e}j=j.parentNode}}d=d.return}Ah(function(){var se=y,ue=lr(c),me=[];e:{var ae=U0.get(r);if(ae!==void 0){var oe=Rl,ze=r;switch(r){case"keypress":if(Yr(c)===0)break e;case"keydown":case"keyup":oe=Ll;break;case"focusin":ze="focus",oe=Ml;break;case"focusout":ze="blur",oe=Ml;break;case"beforeblur":case"afterblur":oe=Ml;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=ur;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=Fg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=Oh;break;case O0:case V0:case L0:oe=Ol;break;case F0:oe=Lh;break;case"scroll":case"scrollend":oe=Ch;break;case"wheel":oe=Fl;break;case"copy":case"cut":case"paste":oe=Vl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=Cu;break;case"toggle":case"beforetoggle":oe=Uh}var Ue=(o&4)!==0,Ot=!Ue&&(r==="scroll"||r==="scrollend"),X=Ue?ae!==null?ae+"Capture":null:ae;Ue=[];for(var K=se,ee;K!==null;){var fe=K;if(ee=fe.stateNode,fe=fe.tag,fe!==5&&fe!==26&&fe!==27||ee===null||X===null||(fe=wo(K,X),fe!=null&&Ue.push(id(K,fe,ee))),Ot)break;K=K.return}0<Ue.length&&(ae=new oe(ae,ze,null,c,ue),me.push({event:ae,listeners:Ue}))}}if((o&7)===0){e:{if(ae=r==="mouseover"||r==="pointerover",oe=r==="mouseout"||r==="pointerout",ae&&c!==va&&(ze=c.relatedTarget||c.fromElement)&&(ar(ze)||ze[tn]))break e;if((oe||ae)&&(ae=ue.window===ue?ue:(ae=ue.ownerDocument)?ae.defaultView||ae.parentWindow:window,oe?(ze=c.relatedTarget||c.toElement,oe=se,ze=ze?ar(ze):null,ze!==null&&(Ot=l(ze),Ue=ze.tag,ze!==Ot||Ue!==5&&Ue!==27&&Ue!==6)&&(ze=null)):(oe=null,ze=se),oe!==ze)){if(Ue=ur,fe="onMouseLeave",X="onMouseEnter",K="mouse",(r==="pointerout"||r==="pointerover")&&(Ue=Cu,fe="onPointerLeave",X="onPointerEnter",K="pointer"),Ot=oe==null?ae:Fs(oe),ee=ze==null?ae:Fs(ze),ae=new Ue(fe,K+"leave",oe,c,ue),ae.target=Ot,ae.relatedTarget=ee,fe=null,ar(ue)===se&&(Ue=new Ue(X,K+"enter",ze,c,ue),Ue.target=ee,Ue.relatedTarget=Ot,fe=Ue),Ot=fe,oe&&ze)t:{for(Ue=oe,X=ze,K=0,ee=Ue;ee;ee=uc(ee))K++;for(ee=0,fe=X;fe;fe=uc(fe))ee++;for(;0<K-ee;)Ue=uc(Ue),K--;for(;0<ee-K;)X=uc(X),ee--;for(;K--;){if(Ue===X||X!==null&&Ue===X.alternate)break t;Ue=uc(Ue),X=uc(X)}Ue=null}else Ue=null;oe!==null&&i_(me,ae,oe,Ue,!1),ze!==null&&Ot!==null&&i_(me,Ot,ze,Ue,!0)}}e:{if(ae=se?Fs(se):window,oe=ae.nodeName&&ae.nodeName.toLowerCase(),oe==="select"||oe==="input"&&ae.type==="file")var Re=E0;else if(In(ae))if(S0)Re=J1;else{Re=X1;var et=Y1}else oe=ae.nodeName,!oe||oe.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?se&&_u(se.elementType)&&(Re=E0):Re=W1;if(Re&&(Re=Re(r,se))){Ta(me,Re,c,ue);break e}et&&et(r,ae,se),r==="focusout"&&se&&ae.type==="number"&&se.memoizedProps.value!=null&&ui(ae,"number",ae.value)}switch(et=se?Fs(se):window,r){case"focusin":(In(et)||et.contentEditable==="true")&&(Ul=et,Hg=se,Ru=null);break;case"focusout":Ru=Hg=Ul=null;break;case"mousedown":Gg=!0;break;case"contextmenu":case"mouseup":case"dragend":Gg=!1,P0(me,c,ue);break;case"selectionchange":if(e2)break;case"keydown":case"keyup":P0(me,c,ue)}var Ve;if(Jr)e:{switch(r){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else dt?le(r,c)&&(Be="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Be="onCompositionStart");Be&&(_&&c.locale!=="ko"&&(dt||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&dt&&(Ve=Tu()):(Qr=ue,di="value"in Qr?Qr.value:Qr.textContent,dt=!0)),et=Af(se,Be),0<et.length&&(Be=new ju(Be,r,null,c,ue),me.push({event:Be,listeners:et}),Ve?Be.data=Ve:(Ve=we(c),Ve!==null&&(Be.data=Ve)))),(Ve=v?Cn(r,c):ht(r,c))&&(Be=Af(se,"onBeforeInput"),0<Be.length&&(et=new ju("onBeforeInput","beforeinput",null,c,ue),me.push({event:et,listeners:Be}),et.data=Ve)),O2(me,r,se,c,ue)}r_(me,o)})}function id(r,o,c){return{instance:r,listener:o,currentTarget:c}}function Af(r,o){for(var c=o+"Capture",d=[];r!==null;){var g=r,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=wo(r,c),g!=null&&d.unshift(id(r,g,y)),g=wo(r,o),g!=null&&d.push(id(r,g,y))),r.tag===3)return d;r=r.return}return[]}function uc(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function i_(r,o,c,d,g){for(var y=o._reactName,N=[];c!==null&&c!==d;){var j=c,H=j.alternate,se=j.stateNode;if(j=j.tag,H!==null&&H===d)break;j!==5&&j!==26&&j!==27||se===null||(H=se,g?(se=wo(c,y),se!=null&&N.unshift(id(c,se,H))):g||(se=wo(c,y),se!=null&&N.push(id(c,se,H)))),c=c.return}N.length!==0&&r.push({event:o,listeners:N})}var U2=/\r\n?/g,B2=/\u0000|\uFFFD/g;function o_(r){return(typeof r=="string"?r:""+r).replace(U2,`
`).replace(B2,"")}function l_(r,o){return o=o_(o),o_(r)===o}function Cf(){}function Mt(r,o,c,d,g,y){switch(c){case"children":typeof d=="string"?o==="body"||o==="textarea"&&d===""||or(r,d):(typeof d=="number"||typeof d=="bigint")&&o!=="body"&&or(r,""+d);break;case"className":os(r,"class",d);break;case"tabIndex":os(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":os(r,c,d);break;case"style":wu(r,d,y);break;case"data":if(o!=="object"){os(r,"data",d);break}case"src":case"href":if(d===""&&(o!=="a"||c!=="href")){r.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=kl(""+d),r.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(o!=="input"&&Mt(r,o,"name",g.name,g,null),Mt(r,o,"formEncType",g.formEncType,g,null),Mt(r,o,"formMethod",g.formMethod,g,null),Mt(r,o,"formTarget",g.formTarget,g,null)):(Mt(r,o,"encType",g.encType,g,null),Mt(r,o,"method",g.method,g,null),Mt(r,o,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=kl(""+d),r.setAttribute(c,d);break;case"onClick":d!=null&&(r.onclick=Cf);break;case"onScroll":d!=null&&at("scroll",r);break;case"onScrollEnd":d!=null&&at("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}c=kl(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""+d):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":d===!0?r.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,d):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(c,d):r.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(c):r.setAttribute(c,d);break;case"popover":at("beforetoggle",r),at("toggle",r),Bn(r,"popover",d);break;case"xlinkActuate":mn(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":mn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":mn(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":mn(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":mn(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":mn(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":mn(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":mn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":mn(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Bn(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Vg.get(c)||c,Bn(r,c,d))}}function my(r,o,c,d,g,y){switch(c){case"style":wu(r,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"children":typeof d=="string"?or(r,d):(typeof d=="number"||typeof d=="bigint")&&or(r,""+d);break;case"onScroll":d!=null&&at("scroll",r);break;case"onScrollEnd":d!=null&&at("scrollend",r);break;case"onClick":d!=null&&(r.onclick=Cf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Y.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),y=r[un]||null,y=y!=null?y[c]:null,typeof y=="function"&&r.removeEventListener(o,y,g),typeof d=="function")){typeof y!="function"&&y!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(o,d,g);break e}c in r?r[c]=d:d===!0?r.setAttribute(c,""):Bn(r,c,d)}}}function ns(r,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":at("error",r),at("load",r);var d=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var N=c[y];if(N!=null)switch(y){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:Mt(r,o,y,N,c,null)}}g&&Mt(r,o,"srcSet",c.srcSet,c,null),d&&Mt(r,o,"src",c.src,c,null);return;case"input":at("invalid",r);var j=y=N=g=null,H=null,se=null;for(d in c)if(c.hasOwnProperty(d)){var ue=c[d];if(ue!=null)switch(d){case"name":g=ue;break;case"type":N=ue;break;case"checked":H=ue;break;case"defaultChecked":se=ue;break;case"value":y=ue;break;case"defaultValue":j=ue;break;case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(n(137,o));break;default:Mt(r,o,d,ue,c,null)}}xo(r,y,j,H,se,N,g,!1),Il(r);return;case"select":at("invalid",r),d=N=y=null;for(g in c)if(c.hasOwnProperty(g)&&(j=c[g],j!=null))switch(g){case"value":y=j;break;case"defaultValue":N=j;break;case"multiple":d=j;default:Mt(r,o,g,j,c,null)}o=y,c=N,r.multiple=!!d,o!=null?xa(r,!!d,o,!1):c!=null&&xa(r,!!d,c,!0);return;case"textarea":at("invalid",r),y=g=d=null;for(N in c)if(c.hasOwnProperty(N)&&(j=c[N],j!=null))switch(N){case"value":d=j;break;case"defaultValue":g=j;break;case"children":y=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(n(91));break;default:Mt(r,o,N,j,c,null)}vo(r,d,g,y),Il(r);return;case"option":for(H in c)if(c.hasOwnProperty(H)&&(d=c[H],d!=null))switch(H){case"selected":r.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Mt(r,o,H,d,c,null)}return;case"dialog":at("beforetoggle",r),at("toggle",r),at("cancel",r),at("close",r);break;case"iframe":case"object":at("load",r);break;case"video":case"audio":for(d=0;d<ad.length;d++)at(ad[d],r);break;case"image":at("error",r),at("load",r);break;case"details":at("toggle",r);break;case"embed":case"source":case"link":at("error",r),at("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in c)if(c.hasOwnProperty(se)&&(d=c[se],d!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:Mt(r,o,se,d,c,null)}return;default:if(_u(o)){for(ue in c)c.hasOwnProperty(ue)&&(d=c[ue],d!==void 0&&my(r,o,ue,d,c,void 0));return}}for(j in c)c.hasOwnProperty(j)&&(d=c[j],d!=null&&Mt(r,o,j,d,c,null))}function q2(r,o,c,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,N=null,j=null,H=null,se=null,ue=null;for(oe in c){var me=c[oe];if(c.hasOwnProperty(oe)&&me!=null)switch(oe){case"checked":break;case"value":break;case"defaultValue":H=me;default:d.hasOwnProperty(oe)||Mt(r,o,oe,null,d,me)}}for(var ae in d){var oe=d[ae];if(me=c[ae],d.hasOwnProperty(ae)&&(oe!=null||me!=null))switch(ae){case"type":y=oe;break;case"name":g=oe;break;case"checked":se=oe;break;case"defaultChecked":ue=oe;break;case"value":N=oe;break;case"defaultValue":j=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(n(137,o));break;default:oe!==me&&Mt(r,o,ae,oe,d,me)}}Us(r,N,j,H,se,ue,y,g);return;case"select":oe=N=j=ae=null;for(y in c)if(H=c[y],c.hasOwnProperty(y)&&H!=null)switch(y){case"value":break;case"multiple":oe=H;default:d.hasOwnProperty(y)||Mt(r,o,y,null,d,H)}for(g in d)if(y=d[g],H=c[g],d.hasOwnProperty(g)&&(y!=null||H!=null))switch(g){case"value":ae=y;break;case"defaultValue":j=y;break;case"multiple":N=y;default:y!==H&&Mt(r,o,g,y,d,H)}o=j,c=N,d=oe,ae!=null?xa(r,!!c,ae,!1):!!d!=!!c&&(o!=null?xa(r,!!c,o,!0):xa(r,!!c,c?[]:"",!1));return;case"textarea":oe=ae=null;for(j in c)if(g=c[j],c.hasOwnProperty(j)&&g!=null&&!d.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:Mt(r,o,j,null,d,g)}for(N in d)if(g=d[N],y=c[N],d.hasOwnProperty(N)&&(g!=null||y!=null))switch(N){case"value":ae=g;break;case"defaultValue":oe=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(n(91));break;default:g!==y&&Mt(r,o,N,g,d,y)}Dt(r,ae,oe);return;case"option":for(var ze in c)if(ae=c[ze],c.hasOwnProperty(ze)&&ae!=null&&!d.hasOwnProperty(ze))switch(ze){case"selected":r.selected=!1;break;default:Mt(r,o,ze,null,d,ae)}for(H in d)if(ae=d[H],oe=c[H],d.hasOwnProperty(H)&&ae!==oe&&(ae!=null||oe!=null))switch(H){case"selected":r.selected=ae&&typeof ae!="function"&&typeof ae!="symbol";break;default:Mt(r,o,H,ae,d,oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ue in c)ae=c[Ue],c.hasOwnProperty(Ue)&&ae!=null&&!d.hasOwnProperty(Ue)&&Mt(r,o,Ue,null,d,ae);for(se in d)if(ae=d[se],oe=c[se],d.hasOwnProperty(se)&&ae!==oe&&(ae!=null||oe!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(n(137,o));break;default:Mt(r,o,se,ae,d,oe)}return;default:if(_u(o)){for(var Ot in c)ae=c[Ot],c.hasOwnProperty(Ot)&&ae!==void 0&&!d.hasOwnProperty(Ot)&&my(r,o,Ot,void 0,d,ae);for(ue in d)ae=d[ue],oe=c[ue],!d.hasOwnProperty(ue)||ae===oe||ae===void 0&&oe===void 0||my(r,o,ue,ae,d,oe);return}}for(var X in c)ae=c[X],c.hasOwnProperty(X)&&ae!=null&&!d.hasOwnProperty(X)&&Mt(r,o,X,null,d,ae);for(me in d)ae=d[me],oe=c[me],!d.hasOwnProperty(me)||ae===oe||ae==null&&oe==null||Mt(r,o,me,ae,d,oe)}var gy=null,py=null;function If(r){return r.nodeType===9?r:r.ownerDocument}function c_(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function u_(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function yy(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var xy=null;function z2(){var r=window.event;return r&&r.type==="popstate"?r===xy?!1:(xy=r,!0):(xy=null,!1)}var d_=typeof setTimeout=="function"?setTimeout:void 0,H2=typeof clearTimeout=="function"?clearTimeout:void 0,h_=typeof Promise=="function"?Promise:void 0,G2=typeof queueMicrotask=="function"?queueMicrotask:typeof h_<"u"?function(r){return h_.resolve(null).then(r).catch($2)}:d_;function $2(r){setTimeout(function(){throw r})}function ji(r){return r==="head"}function f_(r,o){var c=o,d=0,g=0;do{var y=c.nextSibling;if(r.removeChild(c),y&&y.nodeType===8)if(c=y.data,c==="/$"){if(0<d&&8>d){c=d;var N=r.ownerDocument;if(c&1&&od(N.documentElement),c&2&&od(N.body),c&4)for(c=N.head,od(c),N=c.firstChild;N;){var j=N.nextSibling,H=N.nodeName;N[$r]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&N.rel.toLowerCase()==="stylesheet"||c.removeChild(N),N=j}}if(g===0){r.removeChild(y),gd(o);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:d=c.charCodeAt(0)-48;else d=0;c=y}while(c);gd(o)}function vy(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":vy(c),Fn(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function K2(r,o,c,d){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[$r])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(y=r.getAttribute("rel"),y==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(y!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(y=r.getAttribute("src"),(y!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===y)return r}else return r;if(r=kr(r.nextSibling),r===null)break}return null}function Q2(r,o,c){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=kr(r.nextSibling),r===null))return null;return r}function by(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function Y2(r,o){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")o();else{var d=function(){o(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function kr(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return r}var wy=null;function m_(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return r;o--}else c==="/$"&&o++}r=r.previousSibling}return null}function g_(r,o,c){switch(o=If(c),r){case"html":if(r=o.documentElement,!r)throw Error(n(452));return r;case"head":if(r=o.head,!r)throw Error(n(453));return r;case"body":if(r=o.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function od(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);Fn(r)}var yr=new Map,p_=new Set;function kf(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Va=ie.d;ie.d={f:X2,r:W2,D:J2,C:Z2,L:eC,m:tC,X:sC,S:nC,M:rC};function X2(){var r=Va.f(),o=_f();return r||o}function W2(r){var o=Ls(r);o!==null&&o.tag===5&&o.type==="form"?Ob(o):Va.r(r)}var dc=typeof document>"u"?null:document;function y_(r,o,c){var d=dc;if(d&&typeof o=="string"&&o){var g=vn(o);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),p_.has(g)||(p_.add(g),r={rel:r,crossOrigin:c,href:o},d.querySelector(g)===null&&(o=d.createElement("link"),ns(o,"link",r),nn(o),d.head.appendChild(o)))}}function J2(r){Va.D(r),y_("dns-prefetch",r,null)}function Z2(r,o){Va.C(r,o),y_("preconnect",r,o)}function eC(r,o,c){Va.L(r,o,c);var d=dc;if(d&&r&&o){var g='link[rel="preload"][as="'+vn(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+vn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+vn(c.imageSizes)+'"]')):g+='[href="'+vn(r)+'"]';var y=g;switch(o){case"style":y=hc(r);break;case"script":y=fc(r)}yr.has(y)||(r=x({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:r,as:o},c),yr.set(y,r),d.querySelector(g)!==null||o==="style"&&d.querySelector(ld(y))||o==="script"&&d.querySelector(cd(y))||(o=d.createElement("link"),ns(o,"link",r),nn(o),d.head.appendChild(o)))}}function tC(r,o){Va.m(r,o);var c=dc;if(c&&r){var d=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+vn(d)+'"][href="'+vn(r)+'"]',y=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=fc(r)}if(!yr.has(y)&&(r=x({rel:"modulepreload",href:r},o),yr.set(y,r),c.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(cd(y)))return}d=c.createElement("link"),ns(d,"link",r),nn(d),c.head.appendChild(d)}}}function nC(r,o,c){Va.S(r,o,c);var d=dc;if(d&&r){var g=Un(d).hoistableStyles,y=hc(r);o=o||"default";var N=g.get(y);if(!N){var j={loading:0,preload:null};if(N=d.querySelector(ld(y)))j.loading=5;else{r=x({rel:"stylesheet",href:r,"data-precedence":o},c),(c=yr.get(y))&&_y(r,c);var H=N=d.createElement("link");nn(H),ns(H,"link",r),H._p=new Promise(function(se,ue){H.onload=se,H.onerror=ue}),H.addEventListener("load",function(){j.loading|=1}),H.addEventListener("error",function(){j.loading|=2}),j.loading|=4,Rf(N,o,d)}N={type:"stylesheet",instance:N,count:1,state:j},g.set(y,N)}}}function sC(r,o){Va.X(r,o);var c=dc;if(c&&r){var d=Un(c).hoistableScripts,g=fc(r),y=d.get(g);y||(y=c.querySelector(cd(g)),y||(r=x({src:r,async:!0},o),(o=yr.get(g))&&Ny(r,o),y=c.createElement("script"),nn(y),ns(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function rC(r,o){Va.M(r,o);var c=dc;if(c&&r){var d=Un(c).hoistableScripts,g=fc(r),y=d.get(g);y||(y=c.querySelector(cd(g)),y||(r=x({src:r,async:!0,type:"module"},o),(o=yr.get(g))&&Ny(r,o),y=c.createElement("script"),nn(y),ns(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function x_(r,o,c,d){var g=(g=Ee.current)?kf(g):null;if(!g)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=hc(c.href),c=Un(g).hoistableStyles,d=c.get(o),d||(d={type:"style",instance:null,count:0,state:null},c.set(o,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=hc(c.href);var y=Un(g).hoistableStyles,N=y.get(r);if(N||(g=g.ownerDocument||g,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(r,N),(y=g.querySelector(ld(r)))&&!y._p&&(N.instance=y,N.state.loading=5),yr.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},yr.set(r,c),y||aC(g,r,c,N.state))),o&&d===null)throw Error(n(528,""));return N}if(o&&d!==null)throw Error(n(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=fc(c),c=Un(g).hoistableScripts,d=c.get(o),d||(d={type:"script",instance:null,count:0,state:null},c.set(o,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function hc(r){return'href="'+vn(r)+'"'}function ld(r){return'link[rel="stylesheet"]['+r+"]"}function v_(r){return x({},r,{"data-precedence":r.precedence,precedence:null})}function aC(r,o,c,d){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?d.loading=1:(o=r.createElement("link"),d.preload=o,o.addEventListener("load",function(){return d.loading|=1}),o.addEventListener("error",function(){return d.loading|=2}),ns(o,"link",c),nn(o),r.head.appendChild(o))}function fc(r){return'[src="'+vn(r)+'"]'}function cd(r){return"script[async]"+r}function b_(r,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var d=r.querySelector('style[data-href~="'+vn(c.href)+'"]');if(d)return o.instance=d,nn(d),d;var g=x({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),nn(d),ns(d,"style",g),Rf(d,c.precedence,r),o.instance=d;case"stylesheet":g=hc(c.href);var y=r.querySelector(ld(g));if(y)return o.state.loading|=4,o.instance=y,nn(y),y;d=v_(c),(g=yr.get(g))&&_y(d,g),y=(r.ownerDocument||r).createElement("link"),nn(y);var N=y;return N._p=new Promise(function(j,H){N.onload=j,N.onerror=H}),ns(y,"link",d),o.state.loading|=4,Rf(y,c.precedence,r),o.instance=y;case"script":return y=fc(c.src),(g=r.querySelector(cd(y)))?(o.instance=g,nn(g),g):(d=c,(g=yr.get(y))&&(d=x({},c),Ny(d,g)),r=r.ownerDocument||r,g=r.createElement("script"),nn(g),ns(g,"link",d),r.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(n(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(d=o.instance,o.state.loading|=4,Rf(d,c.precedence,r));return o.instance}function Rf(r,o,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,y=g,N=0;N<d.length;N++){var j=d[N];if(j.dataset.precedence===o)y=j;else if(y!==g)break}y?y.parentNode.insertBefore(r,y.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(r,o.firstChild))}function _y(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function Ny(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var Df=null;function w_(r,o,c){if(Df===null){var d=new Map,g=Df=new Map;g.set(c,d)}else g=Df,d=g.get(c),d||(d=new Map,g.set(c,d));if(d.has(r))return d;for(d.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var y=c[g];if(!(y[$r]||y[cn]||r==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var N=y.getAttribute(o)||"";N=r+N;var j=d.get(N);j?j.push(y):d.set(N,[y])}}return d}function __(r,o,c){r=r.ownerDocument||r,r.head.insertBefore(c,o==="title"?r.querySelector("head > title"):null)}function iC(r,o,c){if(c===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function N_(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var ud=null;function oC(){}function lC(r,o,c){if(ud===null)throw Error(n(475));var d=ud;if(o.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=hc(c.href),y=r.querySelector(ld(g));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(d.count++,d=Pf.bind(d),r.then(d,d)),o.state.loading|=4,o.instance=y,nn(y);return}y=r.ownerDocument||r,c=v_(c),(g=yr.get(g))&&_y(c,g),y=y.createElement("link"),nn(y);var N=y;N._p=new Promise(function(j,H){N.onload=j,N.onerror=H}),ns(y,"link",c),o.instance=y}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(d.count++,o=Pf.bind(d),r.addEventListener("load",o),r.addEventListener("error",o))}}function cC(){if(ud===null)throw Error(n(475));var r=ud;return r.stylesheets&&r.count===0&&Ty(r,r.stylesheets),0<r.count?function(o){var c=setTimeout(function(){if(r.stylesheets&&Ty(r,r.stylesheets),r.unsuspend){var d=r.unsuspend;r.unsuspend=null,d()}},6e4);return r.unsuspend=o,function(){r.unsuspend=null,clearTimeout(c)}}:null}function Pf(){if(this.count--,this.count===0){if(this.stylesheets)Ty(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Mf=null;function Ty(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Mf=new Map,o.forEach(uC,r),Mf=null,Pf.call(r))}function uC(r,o){if(!(o.state.loading&4)){var c=Mf.get(r);if(c)var d=c.get(null);else{c=new Map,Mf.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var N=g[y];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(c.set(N.dataset.precedence,N),d=N)}d&&c.set(null,d)}g=o.instance,N=g.getAttribute("data-precedence"),y=c.get(N)||d,y===d&&c.set(null,g),c.set(N,g),this.count++,d=Pf.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),y?y.parentNode.insertBefore(g,y.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),o.state.loading|=4}}var dd={$$typeof:q,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function dC(r,o,c,d,g,y,N,j){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Er(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Er(0),this.hiddenUpdates=Er(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function T_(r,o,c,d,g,y,N,j,H,se,ue,me){return r=new dC(r,o,c,N,j,H,se,me),o=1,y===!0&&(o|=24),y=qs(3,null,null,o),r.current=y,y.stateNode=r,o=ap(),o.refCount++,r.pooledCache=o,o.refCount++,y.memoizedState={element:d,isDehydrated:c,cache:o},cp(y),r}function E_(r){return r?(r=Hl,r):Hl}function S_(r,o,c,d,g,y){g=E_(g),d.context===null?d.context=g:d.pendingContext=g,d=mi(o),d.payload={element:c},y=y===void 0?null:y,y!==null&&(d.callback=y),c=gi(r,d,o),c!==null&&(Ks(c,r,o),Bu(c,r,o))}function j_(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function Ey(r,o){j_(r,o),(r=r.alternate)&&j_(r,o)}function A_(r){if(r.tag===13){var o=zl(r,67108864);o!==null&&Ks(o,r,67108864),Ey(r,67108864)}}var Of=!0;function hC(r,o,c,d){var g=O.T;O.T=null;var y=ie.p;try{ie.p=2,Sy(r,o,c,d)}finally{ie.p=y,O.T=g}}function fC(r,o,c,d){var g=O.T;O.T=null;var y=ie.p;try{ie.p=8,Sy(r,o,c,d)}finally{ie.p=y,O.T=g}}function Sy(r,o,c,d){if(Of){var g=jy(d);if(g===null)fy(r,o,d,Vf,c),I_(r,d);else if(gC(g,r,o,c,d))d.stopPropagation();else if(I_(r,d),o&4&&-1<mC.indexOf(r)){for(;g!==null;){var y=Ls(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var N=Ln(y.pendingLanes);if(N!==0){var j=y;for(j.pendingLanes|=2,j.entangledLanes|=2;N;){var H=1<<31-jn(N);j.entanglements[1]|=H,N&=~H}ra(y),(jt&6)===0&&(bf=Qe()+500,rd(0))}}break;case 13:j=zl(y,2),j!==null&&Ks(j,y,2),_f(),Ey(y,2)}if(y=jy(d),y===null&&fy(r,o,d,Vf,c),y===g)break;g=y}g!==null&&d.stopPropagation()}else fy(r,o,d,null,c)}}function jy(r){return r=lr(r),Ay(r)}var Vf=null;function Ay(r){if(Vf=null,r=ar(r),r!==null){var o=l(r);if(o===null)r=null;else{var c=o.tag;if(c===13){if(r=u(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Vf=r,null}function C_(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Tt()){case gt:return 2;case ot:return 8;case Ge:case $t:return 32;case en:return 268435456;default:return 32}default:return 32}}var Cy=!1,Ai=null,Ci=null,Ii=null,hd=new Map,fd=new Map,ki=[],mC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function I_(r,o){switch(r){case"focusin":case"focusout":Ai=null;break;case"dragenter":case"dragleave":Ci=null;break;case"mouseover":case"mouseout":Ii=null;break;case"pointerover":case"pointerout":hd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":fd.delete(o.pointerId)}}function md(r,o,c,d,g,y){return r===null||r.nativeEvent!==y?(r={blockedOn:o,domEventName:c,eventSystemFlags:d,nativeEvent:y,targetContainers:[g]},o!==null&&(o=Ls(o),o!==null&&A_(o)),r):(r.eventSystemFlags|=d,o=r.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),r)}function gC(r,o,c,d,g){switch(o){case"focusin":return Ai=md(Ai,r,o,c,d,g),!0;case"dragenter":return Ci=md(Ci,r,o,c,d,g),!0;case"mouseover":return Ii=md(Ii,r,o,c,d,g),!0;case"pointerover":var y=g.pointerId;return hd.set(y,md(hd.get(y)||null,r,o,c,d,g)),!0;case"gotpointercapture":return y=g.pointerId,fd.set(y,md(fd.get(y)||null,r,o,c,d,g)),!0}return!1}function k_(r){var o=ar(r.target);if(o!==null){var c=l(o);if(c!==null){if(o=c.tag,o===13){if(o=u(c),o!==null){r.blockedOn=o,li(r.priority,function(){if(c.tag===13){var d=$s();d=ps(d);var g=zl(c,d);g!==null&&Ks(g,c,d),Ey(c,d)}});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Lf(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=jy(r.nativeEvent);if(c===null){c=r.nativeEvent;var d=new c.constructor(c.type,c);va=d,c.target.dispatchEvent(d),va=null}else return o=Ls(c),o!==null&&A_(o),r.blockedOn=c,!1;o.shift()}return!0}function R_(r,o,c){Lf(r)&&c.delete(o)}function pC(){Cy=!1,Ai!==null&&Lf(Ai)&&(Ai=null),Ci!==null&&Lf(Ci)&&(Ci=null),Ii!==null&&Lf(Ii)&&(Ii=null),hd.forEach(R_),fd.forEach(R_)}function Ff(r,o){r.blockedOn===o&&(r.blockedOn=null,Cy||(Cy=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,pC)))}var Uf=null;function D_(r){Uf!==r&&(Uf=r,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){Uf===r&&(Uf=null);for(var o=0;o<r.length;o+=3){var c=r[o],d=r[o+1],g=r[o+2];if(typeof d!="function"){if(Ay(d||c)===null)continue;break}var y=Ls(c);y!==null&&(r.splice(o,3),o-=3,Ap(y,{pending:!0,data:g,method:c.method,action:d},d,g))}}))}function gd(r){function o(H){return Ff(H,r)}Ai!==null&&Ff(Ai,r),Ci!==null&&Ff(Ci,r),Ii!==null&&Ff(Ii,r),hd.forEach(o),fd.forEach(o);for(var c=0;c<ki.length;c++){var d=ki[c];d.blockedOn===r&&(d.blockedOn=null)}for(;0<ki.length&&(c=ki[0],c.blockedOn===null);)k_(c),c.blockedOn===null&&ki.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var g=c[d],y=c[d+1],N=g[un]||null;if(typeof y=="function")N||D_(c);else if(N){var j=null;if(y&&y.hasAttribute("formAction")){if(g=y,N=y[un]||null)j=N.formAction;else if(Ay(g)!==null)continue}else j=N.action;typeof j=="function"?c[d+1]=j:(c.splice(d,3),d-=3),D_(c)}}}function Iy(r){this._internalRoot=r}Bf.prototype.render=Iy.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(n(409));var c=o.current,d=$s();S_(c,d,r,o,null,null)},Bf.prototype.unmount=Iy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;S_(r.current,2,null,r,null,null),_f(),o[tn]=null}};function Bf(r){this._internalRoot=r}Bf.prototype.unstable_scheduleHydration=function(r){if(r){var o=Sr();r={blockedOn:null,target:r,priority:o};for(var c=0;c<ki.length&&o!==0&&o<ki[c].priority;c++);ki.splice(c,0,r),c===0&&k_(r)}};var P_=e.version;if(P_!=="19.1.1")throw Error(n(527,P_,"19.1.1"));ie.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=m(o),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var yC={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qf.isDisabled&&qf.supportsFiber)try{pt=qf.inject(yC),ut=qf}catch{}}return yd.createRoot=function(r,o){if(!a(r))throw Error(n(299));var c=!1,d="",g=Xb,y=Wb,N=Jb,j=null;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(N=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(j=o.unstable_transitionCallbacks)),o=T_(r,1,!1,null,null,c,d,g,y,N,j,null),r[tn]=o.current,hy(r),new Iy(o)},yd.hydrateRoot=function(r,o,c){if(!a(r))throw Error(n(299));var d=!1,g="",y=Xb,N=Wb,j=Jb,H=null,se=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(N=c.onCaughtError),c.onRecoverableError!==void 0&&(j=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(H=c.unstable_transitionCallbacks),c.formState!==void 0&&(se=c.formState)),o=T_(r,1,!0,o,c??null,d,g,y,N,j,H,se),o.context=E_(null),c=o.current,d=$s(),d=ps(d),g=mi(d),g.callback=null,gi(c,g,d),c=d,o.current.lanes=c,gs(o,c),ra(o),r[tn]=o.current,hy(r),new Bf(o)},yd.version="19.1.1",yd}var H_;function jC(){if(H_)return Dy.exports;H_=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Dy.exports=SC(),Dy.exports}var AC=jC();const CC=()=>{};var G_={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pE=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let a=s.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},IC=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const a=s[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const l=s[t++];e[n++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=s[t++],u=s[t++],h=s[t++],m=((a&7)<<18|(l&63)<<12|(u&63)<<6|h&63)-65536;e[n++]=String.fromCharCode(55296+(m>>10)),e[n++]=String.fromCharCode(56320+(m&1023))}else{const l=s[t++],u=s[t++];e[n++]=String.fromCharCode((a&15)<<12|(l&63)<<6|u&63)}}return e.join("")},yE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<s.length;a+=3){const l=s[a],u=a+1<s.length,h=u?s[a+1]:0,m=a+2<s.length,p=m?s[a+2]:0,x=l>>2,w=(l&3)<<4|h>>4;let b=(h&15)<<2|p>>6,E=p&63;m||(E=64,u||(b=64)),n.push(t[x],t[w],t[b],t[E])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(pE(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):IC(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<s.length;){const l=t[s.charAt(a++)],h=a<s.length?t[s.charAt(a)]:0;++a;const p=a<s.length?t[s.charAt(a)]:64;++a;const w=a<s.length?t[s.charAt(a)]:64;if(++a,l==null||h==null||p==null||w==null)throw new kC;const b=l<<2|h>>4;if(n.push(b),p!==64){const E=h<<4&240|p>>2;if(n.push(E),w!==64){const k=p<<6&192|w;n.push(k)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class kC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const RC=function(s){const e=pE(s);return yE.encodeByteArray(e,!0)},bm=function(s){return RC(s).replace(/\./g,"")},xE=function(s){try{return yE.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC=()=>vE().__FIREBASE_DEFAULTS__,PC=()=>{if(typeof process>"u"||typeof G_>"u")return;const s=G_.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},MC=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&xE(s[1]);return e&&JSON.parse(e)},Wm=()=>{try{return CC()||DC()||PC()||MC()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},bE=s=>Wm()?.emulatorHosts?.[s],wE=s=>{const e=bE(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},_E=()=>Wm()?.config,NE=s=>Wm()?.[`_${s}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Jm(s){return(await fetch(s,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VC(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=s.iat||0,l=s.sub||s.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...s};return[bm(JSON.stringify(t)),bm(JSON.stringify(u)),""].join(".")}const Pd={};function LC(){const s={prod:[],emulator:[]};for(const e of Object.keys(Pd))Pd[e]?s.emulator.push(e):s.prod.push(e);return s}function FC(s){let e=document.getElementById(s),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",s),t=!0),{created:t,element:e}}let $_=!1;function Jx(s,e){if(typeof window>"u"||typeof document>"u"||!ti(window.location.host)||Pd[s]===e||Pd[s]||$_)return;Pd[s]=e;function t(b){return`__firebase__banner__${b}`}const n="__firebase__banner",l=LC().prod.length>0;function u(){const b=document.getElementById(n);b&&b.remove()}function h(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function m(b,E){b.setAttribute("width","24"),b.setAttribute("id",E),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function p(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{$_=!0,u()},b}function x(b,E){b.setAttribute("id",E),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function w(){const b=FC(n),E=t("text"),k=document.getElementById(E)||document.createElement("span"),R=t("learnmore"),U=document.getElementById(R)||document.createElement("a"),z=t("preprendIcon"),B=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const q=b.element;h(q),x(U,R);const G=p();m(B,z),q.append(B,k,U,G),document.body.appendChild(q)}l?(k.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",w):w()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function UC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Pn())}function TE(){const s=Wm()?.forceEnvironment;if(s==="node")return!0;if(s==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function BC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function EE(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function qC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function zC(){const s=Pn();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function SE(){return!TE()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jE(){return!TE()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Zx(){try{return typeof indexedDB=="object"}catch{return!1}}function AE(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(t){e(t)}})}function HC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC="FirebaseError";class Nr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=GC,Object.setPrototypeOf(this,Nr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,vl.prototype.create)}}class vl{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,l=this.errors[e],u=l?$C(l,n):"Error",h=`${this.serviceName}: ${u} (${a}).`;return new Nr(a,h,n)}}function $C(s,e){return s.replace(KC,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const KC=/\{\$([^}]+)}/g;function QC(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function br(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const l=s[a],u=e[a];if(K_(l)&&K_(u)){if(!br(l,u))return!1}else if(l!==u)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function K_(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lh(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function YC(s,e){const t=new XC(s,e);return t.subscribe.bind(t)}class XC{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");WC(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=Vy),a.error===void 0&&(a.error=Vy),a.complete===void 0&&(a.complete=Vy);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function WC(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function Vy(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JC=1e3,ZC=2,eI=14400*1e3,tI=.5;function Q_(s,e=JC,t=ZC){const n=e*Math.pow(t,s),a=Math.round(tI*n*(Math.random()-.5)*2);return Math.min(eI,n+a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yt(s){return s&&s._delegate?s._delegate:s}class wr{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new OC;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(a){if(n)return null;throw a}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rI(e))try{this.getOrInitializeService({instanceIdentifier:Go})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:a});n.resolve(l)}catch{}}}}clearInstance(e=Go){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Go){return this.instances.has(e)}getOptions(e=Go){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[l,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(l);n===h&&u.resolve(a)}return a}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),a=this.onInitCallbacks.get(n)??new Set;a.add(e),this.onInitCallbacks.set(n,a);const l=this.instances.get(n);return l&&e(l,n),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:sI(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Go){return this.component?this.component.multipleInstances?e:Go:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sI(s){return s===Go?void 0:s}function rI(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new nI(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lt;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(lt||(lt={}));const iI={debug:lt.DEBUG,verbose:lt.VERBOSE,info:lt.INFO,warn:lt.WARN,error:lt.ERROR,silent:lt.SILENT},oI=lt.INFO,lI={[lt.DEBUG]:"log",[lt.VERBOSE]:"log",[lt.INFO]:"info",[lt.WARN]:"warn",[lt.ERROR]:"error"},cI=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),a=lI[e];if(a)console[a](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Zm{constructor(e){this.name=e,this._logLevel=oI,this._logHandler=cI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in lt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?iI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,lt.DEBUG,...e),this._logHandler(this,lt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,lt.VERBOSE,...e),this._logHandler(this,lt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,lt.INFO,...e),this._logHandler(this,lt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,lt.WARN,...e),this._logHandler(this,lt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,lt.ERROR,...e),this._logHandler(this,lt.ERROR,...e)}}const uI=(s,e)=>e.some(t=>s instanceof t);let Y_,X_;function dI(){return Y_||(Y_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hI(){return X_||(X_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const CE=new WeakMap,cx=new WeakMap,IE=new WeakMap,Ly=new WeakMap,ev=new WeakMap;function fI(s){const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("success",l),s.removeEventListener("error",u)},l=()=>{t(Gi(s.result)),a()},u=()=>{n(s.error),a()};s.addEventListener("success",l),s.addEventListener("error",u)});return e.then(t=>{t instanceof IDBCursor&&CE.set(t,s)}).catch(()=>{}),ev.set(e,s),e}function mI(s){if(cx.has(s))return;const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",u),s.removeEventListener("abort",u)},l=()=>{t(),a()},u=()=>{n(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",l),s.addEventListener("error",u),s.addEventListener("abort",u)});cx.set(s,e)}let ux={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return cx.get(s);if(e==="objectStoreNames")return s.objectStoreNames||IE.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Gi(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function gI(s){ux=s(ux)}function pI(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(Fy(this),e,...t);return IE.set(n,e.sort?e.sort():[e]),Gi(n)}:hI().includes(s)?function(...e){return s.apply(Fy(this),e),Gi(CE.get(this))}:function(...e){return Gi(s.apply(Fy(this),e))}}function yI(s){return typeof s=="function"?pI(s):(s instanceof IDBTransaction&&mI(s),uI(s,dI())?new Proxy(s,ux):s)}function Gi(s){if(s instanceof IDBRequest)return fI(s);if(Ly.has(s))return Ly.get(s);const e=yI(s);return e!==s&&(Ly.set(s,e),ev.set(e,s)),e}const Fy=s=>ev.get(s);function kE(s,e,{blocked:t,upgrade:n,blocking:a,terminated:l}={}){const u=indexedDB.open(s,e),h=Gi(u);return n&&u.addEventListener("upgradeneeded",m=>{n(Gi(u.result),m.oldVersion,m.newVersion,Gi(u.transaction),m)}),t&&u.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),h.then(m=>{l&&m.addEventListener("close",()=>l()),a&&m.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),h}const xI=["get","getKey","getAll","getAllKeys","count"],vI=["put","add","delete","clear"],Uy=new Map;function W_(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Uy.get(e))return Uy.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=vI.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||xI.includes(t)))return;const l=async function(u,...h){const m=this.transaction(u,a?"readwrite":"readonly");let p=m.store;return n&&(p=p.index(h.shift())),(await Promise.all([p[t](...h),a&&m.done]))[0]};return Uy.set(e,l),l}gI(s=>({...s,get:(e,t,n)=>W_(e,t)||s.get(e,t,n),has:(e,t)=>!!W_(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(wI(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function wI(s){return s.getComponent()?.type==="VERSION"}const dx="@firebase/app",J_="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xa=new Zm("@firebase/app"),_I="@firebase/app-compat",NI="@firebase/analytics-compat",TI="@firebase/analytics",EI="@firebase/app-check-compat",SI="@firebase/app-check",jI="@firebase/auth",AI="@firebase/auth-compat",CI="@firebase/database",II="@firebase/data-connect",kI="@firebase/database-compat",RI="@firebase/functions",DI="@firebase/functions-compat",PI="@firebase/installations",MI="@firebase/installations-compat",OI="@firebase/messaging",VI="@firebase/messaging-compat",LI="@firebase/performance",FI="@firebase/performance-compat",UI="@firebase/remote-config",BI="@firebase/remote-config-compat",qI="@firebase/storage",zI="@firebase/storage-compat",HI="@firebase/firestore",GI="@firebase/ai",$I="@firebase/firestore-compat",KI="firebase",QI="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wm="[DEFAULT]",YI={[dx]:"fire-core",[_I]:"fire-core-compat",[TI]:"fire-analytics",[NI]:"fire-analytics-compat",[SI]:"fire-app-check",[EI]:"fire-app-check-compat",[jI]:"fire-auth",[AI]:"fire-auth-compat",[CI]:"fire-rtdb",[II]:"fire-data-connect",[kI]:"fire-rtdb-compat",[RI]:"fire-fn",[DI]:"fire-fn-compat",[PI]:"fire-iid",[MI]:"fire-iid-compat",[OI]:"fire-fcm",[VI]:"fire-fcm-compat",[LI]:"fire-perf",[FI]:"fire-perf-compat",[UI]:"fire-rc",[BI]:"fire-rc-compat",[qI]:"fire-gcs",[zI]:"fire-gcs-compat",[HI]:"fire-fst",[$I]:"fire-fst-compat",[GI]:"fire-vertex","fire-js":"fire-js",[KI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _m=new Map,XI=new Map,hx=new Map;function Z_(s,e){try{s.container.addComponent(e)}catch(t){Xa.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function qr(s){const e=s.name;if(hx.has(e))return Xa.debug(`There were multiple attempts to register component ${e}.`),!1;hx.set(e,s);for(const t of _m.values())Z_(t,s);for(const t of XI.values())Z_(t,s);return!0}function ya(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function WI(s,e,t=wm){ya(s,e).clearInstance(t)}function Xs(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$i=new vl("app","Firebase",JI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new wr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $i.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru=QI;function RE(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n={name:wm,automaticDataCollectionEnabled:!0,...e},a=n.name;if(typeof a!="string"||!a)throw $i.create("bad-app-name",{appName:String(a)});if(t||(t=_E()),!t)throw $i.create("no-options");const l=_m.get(a);if(l){if(br(t,l.options)&&br(n,l.config))return l;throw $i.create("duplicate-app",{appName:a})}const u=new aI(a);for(const m of hx.values())u.addComponent(m);const h=new ZI(t,n,u);return _m.set(a,h),h}function eg(s=wm){const e=_m.get(s);if(!e&&s===wm&&_E())return RE();if(!e)throw $i.create("no-app",{appName:s});return e}function Ds(s,e,t){let n=YI[s]??s;t&&(n+=`-${t}`);const a=n.match(/\s|\//),l=e.match(/\s|\//);if(a||l){const u=[`Unable to register library "${n}" with version "${e}":`];a&&u.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&l&&u.push("and"),l&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xa.warn(u.join(" "));return}qr(new wr(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek="firebase-heartbeat-database",tk=1,Kd="firebase-heartbeat-store";let By=null;function DE(){return By||(By=kE(ek,tk,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(Kd)}catch(t){console.warn(t)}}}}).catch(s=>{throw $i.create("idb-open",{originalErrorMessage:s.message})})),By}async function nk(s){try{const t=(await DE()).transaction(Kd),n=await t.objectStore(Kd).get(PE(s));return await t.done,n}catch(e){if(e instanceof Nr)Xa.warn(e.message);else{const t=$i.create("idb-get",{originalErrorMessage:e?.message});Xa.warn(t.message)}}}async function eN(s,e){try{const n=(await DE()).transaction(Kd,"readwrite");await n.objectStore(Kd).put(e,PE(s)),await n.done}catch(t){if(t instanceof Nr)Xa.warn(t.message);else{const n=$i.create("idb-set",{originalErrorMessage:t?.message});Xa.warn(n.message)}}}function PE(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sk=1024,rk=30;class ak{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ok(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=tN();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>rk){const a=lk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Xa.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=tN(),{heartbeatsToSend:t,unsentEntries:n}=ik(this._heartbeatsCache.heartbeats),a=bm(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return Xa.warn(e),""}}}function tN(){return new Date().toISOString().substring(0,10)}function ik(s,e=sk){const t=[];let n=s.slice();for(const a of s){const l=t.find(u=>u.agent===a.agent);if(l){if(l.dates.push(a.date),nN(t)>e){l.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),nN(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class ok{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Zx()?AE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await nk(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return eN(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return eN(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function nN(s){return bm(JSON.stringify({version:2,heartbeats:s})).length}function lk(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ck(s){qr(new wr("platform-logger",e=>new bI(e),"PRIVATE")),qr(new wr("heartbeat",e=>new ak(e),"PRIVATE")),Ds(dx,J_,s),Ds(dx,J_,"esm2020"),Ds("fire-js","")}ck("");function ME(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const uk=ME,OE=new vl("auth","Firebase",ME());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nm=new Zm("@firebase/auth");function dk(s,...e){Nm.logLevel<=lt.WARN&&Nm.warn(`Auth (${ru}): ${s}`,...e)}function nm(s,...e){Nm.logLevel<=lt.ERROR&&Nm.error(`Auth (${ru}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ga(s,...e){throw nv(s,...e)}function Fr(s,...e){return nv(s,...e)}function tv(s,e,t){const n={...uk(),[e]:t};return new vl("auth","Firebase",n).create(e,{appName:s.name})}function Ki(s){return tv(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function VE(s,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&ga(s,"argument-error"),tv(s,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function nv(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return OE.create(s,...e)}function He(s,e,...t){if(!s)throw nv(e,...t)}function qa(s){const e="INTERNAL ASSERTION FAILED: "+s;throw nm(e),new Error(e)}function Wa(s,e){s||qa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fx(){return typeof self<"u"&&self.location?.href||""}function hk(){return sN()==="http:"||sN()==="https:"}function sN(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hk()||EE()||"connection"in navigator)?navigator.onLine:!0}function mk(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wa(t>e,"Short delay should be less than long delay!"),this.isMobile=UC()||qC()}get(){return fk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(s,e){Wa(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;qa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;qa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;qa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],yk=new ch(3e4,6e4);function rv(s,e){return s.tenantId&&!e.tenantId?{...e,tenantId:s.tenantId}:e}async function au(s,e,t,n,a={}){return FE(s,a,async()=>{let l={},u={};n&&(e==="GET"?u=n:l={body:JSON.stringify(n)});const h=lh({key:s.config.apiKey,...u}).slice(1),m=await s._getAdditionalHeaders();m["Content-Type"]="application/json",s.languageCode&&(m["X-Firebase-Locale"]=s.languageCode);const p={method:e,headers:m,...l};return BC()||(p.referrerPolicy="no-referrer"),s.emulatorConfig&&ti(s.emulatorConfig.host)&&(p.credentials="include"),LE.fetch()(await UE(s,s.config.apiHost,t,h),p)})}async function FE(s,e,t){s._canInitEmulator=!1;const n={...gk,...e};try{const a=new vk(s),l=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw zf(s,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const h=l.ok?u.errorMessage:u.error.message,[m,p]=h.split(" : ");if(m==="FEDERATED_USER_ID_ALREADY_LINKED")throw zf(s,"credential-already-in-use",u);if(m==="EMAIL_EXISTS")throw zf(s,"email-already-in-use",u);if(m==="USER_DISABLED")throw zf(s,"user-disabled",u);const x=n[m]||m.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw tv(s,x,p);ga(s,x)}}catch(a){if(a instanceof Nr)throw a;ga(s,"network-request-failed",{message:String(a)})}}async function xk(s,e,t,n,a={}){const l=await au(s,e,t,n,a);return"mfaPendingCredential"in l&&ga(s,"multi-factor-auth-required",{_serverResponse:l}),l}async function UE(s,e,t,n){const a=`${e}${t}?${n}`,l=s,u=l.config.emulator?sv(s.config,a):`${s.config.apiScheme}://${a}`;return pk.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}class vk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Fr(this.auth,"network-request-failed")),yk.get())})}}function zf(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=Fr(s,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bk(s,e){return au(s,"POST","/v1/accounts:delete",e)}async function Tm(s,e){return au(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Md(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function wk(s,e=!1){const t=yt(s),n=await t.getIdToken(e),a=av(n);He(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,u=l?.sign_in_provider;return{claims:a,token:n,authTime:Md(qy(a.auth_time)),issuedAtTime:Md(qy(a.iat)),expirationTime:Md(qy(a.exp)),signInProvider:u||null,signInSecondFactor:l?.sign_in_second_factor||null}}function qy(s){return Number(s)*1e3}function av(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return nm("JWT malformed, contained fewer than 3 sections"),null;try{const a=xE(t);return a?JSON.parse(a):(nm("Failed to decode base64 JWT payload"),null)}catch(a){return nm("Caught error parsing JWT payload as JSON",a?.toString()),null}}function rN(s){const e=av(s);return He(e,"internal-error"),He(typeof e.exp<"u","internal-error"),He(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qd(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Nr&&_k(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function _k({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Md(this.lastLoginAt),this.creationTime=Md(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Em(s){const e=s.auth,t=await s.getIdToken(),n=await Qd(s,Tm(e,{idToken:t}));He(n?.users.length,e,"internal-error");const a=n.users[0];s._notifyReloadListener(a);const l=a.providerUserInfo?.length?BE(a.providerUserInfo):[],u=Ek(s.providerData,l),h=s.isAnonymous,m=!(s.email&&a.passwordHash)&&!u?.length,p=h?m:!1,x={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new mx(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(s,x)}async function Tk(s){const e=yt(s);await Em(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ek(s,e){return[...s.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function BE(s){return s.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(s,e){const t=await FE(s,{},async()=>{const n=lh({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=s.config,u=await UE(s,a,"/v1/token",`key=${l}`),h=await s._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const m={method:"POST",headers:h,body:n};return s.emulatorConfig&&ti(s.emulatorConfig.host)&&(m.credentials="include"),LE.fetch()(u,m)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function jk(s,e){return au(s,"POST","/v2/accounts:revokeToken",rv(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){He(e.idToken,"internal-error"),He(typeof e.idToken<"u","internal-error"),He(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):rN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){He(e.length!==0,"internal-error");const t=rN(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(He(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:l}=await Sk(e,t);this.updateTokensAndExpiration(n,a,Number(l))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:l}=t,u=new Sc;return n&&(He(typeof n=="string","internal-error",{appName:e}),u.refreshToken=n),a&&(He(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),l&&(He(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Sc,this.toJSON())}_performRefresh(){return qa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(s,e){He(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class Vr{constructor({uid:e,auth:t,stsTokenManager:n,...a}){this.providerId="firebase",this.proactiveRefresh=new Nk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new mx(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await Qd(this,this.stsTokenManager.getToken(this.auth,e));return He(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return wk(this,e)}reload(){return Tk(this)}_assign(e){this!==e&&(He(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){He(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Em(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xs(this.auth.app))return Promise.reject(Ki(this.auth));const e=await this.getIdToken();return await Qd(this,bk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,a=t.email??void 0,l=t.phoneNumber??void 0,u=t.photoURL??void 0,h=t.tenantId??void 0,m=t._redirectEventId??void 0,p=t.createdAt??void 0,x=t.lastLoginAt??void 0,{uid:w,emailVerified:b,isAnonymous:E,providerData:k,stsTokenManager:R}=t;He(w&&R,e,"internal-error");const U=Sc.fromJSON(this.name,R);He(typeof w=="string",e,"internal-error"),Di(n,e.name),Di(a,e.name),He(typeof b=="boolean",e,"internal-error"),He(typeof E=="boolean",e,"internal-error"),Di(l,e.name),Di(u,e.name),Di(h,e.name),Di(m,e.name),Di(p,e.name),Di(x,e.name);const z=new Vr({uid:w,auth:e,email:a,emailVerified:b,displayName:n,isAnonymous:E,photoURL:u,phoneNumber:l,tenantId:h,stsTokenManager:U,createdAt:p,lastLoginAt:x});return k&&Array.isArray(k)&&(z.providerData=k.map(B=>({...B}))),m&&(z._redirectEventId=m),z}static async _fromIdTokenResponse(e,t,n=!1){const a=new Sc;a.updateFromServerResponse(t);const l=new Vr({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await Em(l),l}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];He(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?BE(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!l?.length,h=new Sc;h.updateFromIdToken(n);const m=new Vr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:u}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new mx(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(m,p),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN=new Map;function za(s){Wa(s instanceof Function,"Expected a class definition");let e=aN.get(s);return e?(Wa(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,aN.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}qE.type="NONE";const iN=qE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sm(s,e,t){return`firebase:${s}:${e}:${t}`}class jc{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:l}=this.auth;this.fullUserKey=sm(this.userKey,a.apiKey,l),this.fullPersistenceKey=sm("persistence",a.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Tm(this.auth,{idToken:e}).catch(()=>{});return t?Vr._fromGetAccountInfoResponse(this.auth,t,e):null}return Vr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new jc(za(iN),e,n);const a=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||za(iN);const u=sm(n,e.config.apiKey,e.name);let h=null;for(const p of t)try{const x=await p._get(u);if(x){let w;if(typeof x=="string"){const b=await Tm(e,{idToken:x}).catch(()=>{});if(!b)break;w=await Vr._fromGetAccountInfoResponse(e,b,x)}else w=Vr._fromJSON(e,x);p!==l&&(h=w),l=p;break}}catch{}const m=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!m.length?new jc(l,e,n):(l=m[0],h&&await l._set(u,h.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(u)}catch{}})),new jc(l,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oN(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($E(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(zE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(QE(e))return"Blackberry";if(YE(e))return"Webos";if(HE(e))return"Safari";if((e.includes("chrome/")||GE(e))&&!e.includes("edge/"))return"Chrome";if(KE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if(n?.length===2)return n[1]}return"Other"}function zE(s=Pn()){return/firefox\//i.test(s)}function HE(s=Pn()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function GE(s=Pn()){return/crios\//i.test(s)}function $E(s=Pn()){return/iemobile/i.test(s)}function KE(s=Pn()){return/android/i.test(s)}function QE(s=Pn()){return/blackberry/i.test(s)}function YE(s=Pn()){return/webos/i.test(s)}function iv(s=Pn()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function Ak(s=Pn()){return iv(s)&&!!window.navigator?.standalone}function Ck(){return zC()&&document.documentMode===10}function XE(s=Pn()){return iv(s)||KE(s)||YE(s)||QE(s)||/windows phone/i.test(s)||$E(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WE(s,e=[]){let t;switch(s){case"Browser":t=oN(Pn());break;case"Worker":t=`${oN(Pn())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ru}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=l=>new Promise((u,h)=>{try{const m=e(l);u(m)}catch(m){h(m)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk(s,e={}){return au(s,"GET","/v2/passwordPolicy",rv(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk=6;class Dk{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Rk,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lN(this),this.idTokenSubscription=new lN(this),this.beforeStateQueue=new Ik(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=OE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=za(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await jc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Tm(this,{idToken:e}),n=await Vr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Xs(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,u=n?._redirectEventId,h=await this.tryRedirectSignIn(e);(!l||l===u)&&h?.user&&(n=h.user,a=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(n)}catch(l){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return He(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Em(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=mk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Xs(this.app))return Promise.reject(Ki(this));const t=e?yt(e):null;return t&&He(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&He(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Xs(this.app)?Promise.reject(Ki(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Xs(this.app)?Promise.reject(Ki(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(za(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await kk(this),t=new Dk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new vl("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await jk(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&za(e)||this._popupRedirectResolver;He(t,this,"argument-error"),this.redirectPersistenceManager=await jc.create(this,[za(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(He(h,this,"internal-error"),h.then(()=>{u||l(this.currentUser)}),typeof t=="function"){const m=e.addObserver(t,n,a);return()=>{u=!0,m()}}else{const m=e.addObserver(t);return()=>{u=!0,m()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return He(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=WE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Xs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&dk(`Error while retrieving App Check token: ${e.error}`),e?.token}}function uh(s){return yt(s)}class lN{constructor(e){this.auth=e,this.observer=null,this.addObserver=YC(t=>this.observer=t)}get next(){return He(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ov={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Mk(s){ov=s}function Ok(s){return ov.loadJS(s)}function Vk(){return ov.gapiScript}function Lk(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fk(s,e){const t=ya(s,"auth");if(t.isInitialized()){const a=t.getImmediate(),l=t.getOptions();if(br(l,e??{}))return a;ga(a,"already-initialized")}return t.initialize({options:e})}function Uk(s,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(za);e?.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e?.popupRedirectResolver)}function Bk(s,e,t){const n=uh(s);He(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,l=JE(e),{host:u,port:h}=qk(e),m=h===null?"":`:${h}`,p={url:`${l}//${u}${m}/`},x=Object.freeze({host:u,port:h,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!n._canInitEmulator){He(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),He(br(p,n.config.emulator)&&br(x,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=p,n.emulatorConfig=x,n.settings.appVerificationDisabledForTesting=!0,ti(u)?(Jm(`${l}//${u}${m}`),Jx("Auth",!0)):zk()}function JE(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function qk(s){const e=JE(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const l=a[1];return{host:l,port:cN(n.substr(l.length+1))}}else{const[l,u]=n.split(":");return{host:l,port:cN(u)}}}function cN(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function zk(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return qa("not implemented")}_getIdTokenResponse(e){return qa("not implemented")}_linkToIdToken(e,t){return qa("not implemented")}_getReauthenticationResolver(e){return qa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ac(s,e){return xk(s,"POST","/v1/accounts:signInWithIdp",rv(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk="http://localhost";class ol extends ZE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ol(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ga("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a,...l}=t;if(!n||!a)return null;const u=new ol(n,a);return u.idToken=l.idToken||void 0,u.accessToken=l.accessToken||void 0,u.secret=l.secret,u.nonce=l.nonce,u.pendingToken=l.pendingToken||null,u}_getIdTokenResponse(e){const t=this.buildRequest();return Ac(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ac(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ac(e,t)}buildRequest(){const e={requestUri:Hk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=lh(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh extends tg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi extends dh{constructor(){super("facebook.com")}static credential(e){return ol._fromParams({providerId:Vi.PROVIDER_ID,signInMethod:Vi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vi.credentialFromTaggedObject(e)}static credentialFromError(e){return Vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vi.credential(e.oauthAccessToken)}catch{return null}}}Vi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Vi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua extends dh{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ol._fromParams({providerId:Ua.PROVIDER_ID,signInMethod:Ua.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ua.credentialFromTaggedObject(e)}static credentialFromError(e){return Ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ua.credential(t,n)}catch{return null}}}Ua.GOOGLE_SIGN_IN_METHOD="google.com";Ua.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li extends dh{constructor(){super("github.com")}static credential(e){return ol._fromParams({providerId:Li.PROVIDER_ID,signInMethod:Li.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Li.credentialFromTaggedObject(e)}static credentialFromError(e){return Li.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Li.credential(e.oauthAccessToken)}catch{return null}}}Li.GITHUB_SIGN_IN_METHOD="github.com";Li.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi extends dh{constructor(){super("twitter.com")}static credential(e,t){return ol._fromParams({providerId:Fi.PROVIDER_ID,signInMethod:Fi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Fi.credentialFromTaggedObject(e)}static credentialFromError(e){return Fi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Fi.credential(t,n)}catch{return null}}}Fi.TWITTER_SIGN_IN_METHOD="twitter.com";Fi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const l=await Vr._fromIdTokenResponse(e,n,a),u=uN(n);return new Rc({user:l,providerId:u,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=uN(n);return new Rc({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function uN(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm extends Nr{constructor(e,t,n,a){super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,Sm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new Sm(e,t,n,a)}}function eS(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?Sm._fromErrorAndOperation(s,l,e,n):l})}async function Gk(s,e,t=!1){const n=await Qd(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return Rc._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $k(s,e,t=!1){const{auth:n}=s;if(Xs(n.app))return Promise.reject(Ki(n));const a="reauthenticate";try{const l=await Qd(s,eS(n,a,e,s),t);He(l.idToken,n,"internal-error");const u=av(l.idToken);He(u,n,"internal-error");const{sub:h}=u;return He(s.uid===h,n,"user-mismatch"),Rc._forOperation(s,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&ga(n,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(s,e,t=!1){if(Xs(s.app))return Promise.reject(Ki(s));const n="signIn",a=await eS(s,n,e),l=await Rc._fromIdTokenResponse(s,n,a);return t||await s._updateCurrentUser(l.user),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(s,e){return yt(s).setPersistence(e)}function tS(s,e,t,n){return yt(s).onIdTokenChanged(e,t,n)}function Yk(s,e,t){return yt(s).beforeAuthStateChanged(e,t)}function Xk(s,e,t,n){return yt(s).onAuthStateChanged(e,t,n)}function Wk(s){return yt(s).signOut()}const jm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nS{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(jm,"1"),this.storage.removeItem(jm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=1e3,Zk=10;class sS extends nS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=XE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((u,h,m)=>{this.notifyListeners(u,m)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const u=this.storage.getItem(n);!t&&this.localCache[n]===u||this.notifyListeners(n,u)},l=this.storage.getItem(n);Ck()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,Zk):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Jk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}sS.type="LOCAL";const rS=sS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS extends nS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}aS.type="SESSION";const iS=aS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eR(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new ng(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:l}=t.data,u=this.handlersMap[a];if(!u?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const h=Array.from(u).map(async p=>p(t.origin,l)),m=await eR(h);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:m})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ng.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lv(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,u;return new Promise((h,m)=>{const p=lv("",20);a.port1.start();const x=setTimeout(()=>{m(new Error("unsupported_event"))},n);u={messageChannel:a,onMessage(w){const b=w;if(b.data.eventId===p)switch(b.data.status){case"ack":clearTimeout(x),l=setTimeout(()=>{m(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),h(b.data.response);break;default:clearTimeout(x),clearTimeout(l),m(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ha(){return window}function nR(s){ha().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(){return typeof ha().WorkerGlobalScope<"u"&&typeof ha().importScripts=="function"}async function sR(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function rR(){return navigator?.serviceWorker?.controller||null}function aR(){return oS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lS="firebaseLocalStorageDb",iR=1,Am="firebaseLocalStorage",cS="fbase_key";class hh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function sg(s,e){return s.transaction([Am],e?"readwrite":"readonly").objectStore(Am)}function oR(){const s=indexedDB.deleteDatabase(lS);return new hh(s).toPromise()}function gx(){const s=indexedDB.open(lS,iR);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(Am,{keyPath:cS})}catch(a){t(a)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(Am)?e(n):(n.close(),await oR(),e(await gx()))})})}async function dN(s,e,t){const n=sg(s,!0).put({[cS]:e,value:t});return new hh(n).toPromise()}async function lR(s,e){const t=sg(s,!1).get(e),n=await new hh(t).toPromise();return n===void 0?null:n.value}function hN(s,e){const t=sg(s,!0).delete(e);return new hh(t).toPromise()}const cR=800,uR=3;class uS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await gx(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>uR)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ng._getInstance(aR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await sR(),!this.activeServiceWorker)return;this.sender=new tR(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||rR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await gx();return await dN(e,jm,"1"),await hN(e,jm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>dN(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>lR(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>hN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=sg(a,!1).getAll();return new hh(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),cR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}uS.type="LOCAL";const dR=uS;new ch(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cv(s,e){return e?za(e):(He(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv extends ZE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ac(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ac(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ac(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function hR(s){return Kk(s.auth,new uv(s),s.bypassAuthState)}function fR(s){const{auth:e,user:t}=s;return He(t,e,"internal-error"),$k(t,new uv(s),s.bypassAuthState)}async function mR(s){const{auth:e,user:t}=s;return He(t,e,"internal-error"),Gk(t,new uv(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dS{constructor(e,t,n,a,l=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:l,error:u,type:h}=e;if(u){this.reject(u);return}const m={auth:this.auth,requestUri:t,sessionId:n,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(m))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return hR;case"linkViaPopup":case"linkViaRedirect":return mR;case"reauthViaPopup":case"reauthViaRedirect":return fR;default:ga(this.auth,"internal-error")}}resolve(e){Wa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gR=new ch(2e3,1e4);async function pR(s,e,t){if(Xs(s.app))return Promise.reject(Fr(s,"operation-not-supported-in-this-environment"));const n=uh(s);VE(s,e,tg);const a=cv(n,t);return new Jo(n,"signInViaPopup",e,a).executeNotNull()}class Jo extends dS{constructor(e,t,n,a,l){super(e,t,a,l),this.provider=n,this.authWindow=null,this.pollId=null,Jo.currentPopupAction&&Jo.currentPopupAction.cancel(),Jo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return He(e,this.auth,"internal-error"),e}async onExecution(){Wa(this.filter.length===1,"Popup operations only handle one event");const e=lv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Jo.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,gR.get())};e()}}Jo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yR="pendingRedirect",rm=new Map;class xR extends dS{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=rm.get(this.auth._key());if(!e){try{const n=await vR(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}rm.set(this.auth._key(),e)}return this.bypassAuthState||rm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function vR(s,e){const t=fS(e),n=hS(s);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}async function bR(s,e){return hS(s)._set(fS(e),"true")}function wR(s,e){rm.set(s._key(),e)}function hS(s){return za(s._redirectPersistence)}function fS(s){return sm(yR,s.config.apiKey,s.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(s,e,t){return NR(s,e,t)}async function NR(s,e,t){if(Xs(s.app))return Promise.reject(Ki(s));const n=uh(s);VE(s,e,tg),await n._initializationPromise;const a=cv(n,t);return await bR(a,n),a._openRedirect(n,e,"signInViaRedirect")}async function TR(s,e,t=!1){if(Xs(s.app))return Promise.reject(Ki(s));const n=uh(s),a=cv(n,e),u=await new xR(n,a,t).execute();return u&&!t&&(delete u.user._redirectEventId,await n._persistUserIfCurrent(u.user),await n._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER=600*1e3;class SR{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!jR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!mS(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Fr(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=ER&&this.cachedEventUids.clear(),this.cachedEventUids.has(fN(e))}saveEventToCache(e){this.cachedEventUids.add(fN(e)),this.lastProcessedEventTime=Date.now()}}function fN(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function mS({type:s,error:e}){return s==="unknown"&&e?.code==="auth/no-auth-event"}function jR(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mS(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AR(s,e={}){return au(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,IR=/^https?/;async function kR(s){if(s.config.emulator)return;const{authorizedDomains:e}=await AR(s);for(const t of e)try{if(RR(t))return}catch{}ga(s,"unauthorized-domain")}function RR(s){const e=fx(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const u=new URL(s);return u.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&u.hostname===n}if(!IR.test(t))return!1;if(CR.test(s))return n===s;const a=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DR=new ch(3e4,6e4);function mN(){const s=ha().___jsl;if(s?.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function PR(s){return new Promise((e,t)=>{function n(){mN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{mN(),t(Fr(s,"network-request-failed"))},timeout:DR.get()})}if(ha().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ha().gapi?.load)n();else{const a=Lk("iframefcb");return ha()[a]=()=>{gapi.load?n():t(Fr(s,"network-request-failed"))},Ok(`${Vk()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw am=null,e})}let am=null;function MR(s){return am=am||PR(s),am}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OR=new ch(5e3,15e3),VR="__/auth/iframe",LR="emulator/auth/iframe",FR={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},UR=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function BR(s){const e=s.config;He(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?sv(e,LR):`https://${s.config.authDomain}/${VR}`,n={apiKey:e.apiKey,appName:s.name,v:ru},a=UR.get(s.config.apiHost);a&&(n.eid=a);const l=s._getFrameworks();return l.length&&(n.fw=l.join(",")),`${t}?${lh(n).slice(1)}`}async function qR(s){const e=await MR(s),t=ha().gapi;return He(t,s,"internal-error"),e.open({where:document.body,url:BR(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:FR,dontclear:!0},n=>new Promise(async(a,l)=>{await n.restyle({setHideOnLeave:!1});const u=Fr(s,"network-request-failed"),h=ha().setTimeout(()=>{l(u)},OR.get());function m(){ha().clearTimeout(h),a(n)}n.ping(m).then(m,()=>{l(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zR={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},HR=500,GR=600,$R="_blank",KR="http://localhost";class gN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function QR(s,e,t,n=HR,a=GR){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-n)/2,0).toString();let h="";const m={...zR,width:n.toString(),height:a.toString(),top:l,left:u},p=Pn().toLowerCase();t&&(h=GE(p)?$R:t),zE(p)&&(e=e||KR,m.scrollbars="yes");const x=Object.entries(m).reduce((b,[E,k])=>`${b}${E}=${k},`,"");if(Ak(p)&&h!=="_self")return YR(e||"",h),new gN(null);const w=window.open(e||"",h,x);He(w,s,"popup-blocked");try{w.focus()}catch{}return new gN(w)}function YR(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XR="__/auth/handler",WR="emulator/auth/handler",JR=encodeURIComponent("fac");async function pN(s,e,t,n,a,l){He(s.config.authDomain,s,"auth-domain-config-required"),He(s.config.apiKey,s,"invalid-api-key");const u={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:ru,eventId:a};if(e instanceof tg){e.setDefaultLanguage(s.languageCode),u.providerId=e.providerId||"",QC(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,w]of Object.entries({}))u[x]=w}if(e instanceof dh){const x=e.getScopes().filter(w=>w!=="");x.length>0&&(u.scopes=x.join(","))}s.tenantId&&(u.tid=s.tenantId);const h=u;for(const x of Object.keys(h))h[x]===void 0&&delete h[x];const m=await s._getAppCheckToken(),p=m?`#${JR}=${encodeURIComponent(m)}`:"";return`${ZR(s)}?${lh(h).slice(1)}${p}`}function ZR({config:s}){return s.emulator?sv(s,WR):`https://${s.authDomain}/${XR}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zy="webStorageSupport";class eD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iS,this._completeRedirectFn=TR,this._overrideRedirectResult=wR}async _openPopup(e,t,n,a){Wa(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await pN(e,t,n,fx(),a);return QR(e,l,lv())}async _openRedirect(e,t,n,a){await this._originValidation(e);const l=await pN(e,t,n,fx(),a);return nR(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:l}=this.eventManagers[t];return a?Promise.resolve(a):(Wa(l,"If manager is not set, promise should be"),l)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await qR(e),n=new SR(e);return t.register("authEvent",a=>(He(a?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(zy,{type:zy},a=>{const l=a?.[0]?.[zy];l!==void 0&&t(!!l),ga(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=kR(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return XE()||HE()||iv()}}const tD=eD;var yN="@firebase/auth",xN="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){He(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sD(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rD(s){qr(new wr("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=n.options;He(u&&!u.includes(":"),"invalid-api-key",{appName:n.name});const m={apiKey:u,authDomain:h,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:WE(s)},p=new Pk(n,a,l,m);return Uk(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),qr(new wr("auth-internal",e=>{const t=uh(e.getProvider("auth").getImmediate());return(n=>new nD(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ds(yN,xN,sD(s)),Ds(yN,xN,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD=300,iD=NE("authIdTokenMaxAge")||aD;let vN=null;const oD=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>iD)return;const a=t?.token;vN!==a&&(vN=a,await fetch(s,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function lD(s=eg()){const e=ya(s,"auth");if(e.isInitialized())return e.getImmediate();const t=Fk(s,{popupRedirectResolver:tD,persistence:[dR,rS,iS]}),n=NE("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(n,location.origin);if(location.origin===l.origin){const u=oD(l.toString());Yk(t,u,()=>u(t.currentUser)),tS(t,h=>u(h))}}const a=bE("auth");return a&&Bk(t,`http://${a}`),t}function cD(){return document.getElementsByTagName("head")?.[0]??document}Mk({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=a=>{const l=Fr("internal-error");l.customData=a,t(l)},n.type="text/javascript",n.charset="UTF-8",cD().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rD("Browser");var uD="firebase",dD="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ds(uD,dD,"app");var bN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Qi,gS;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,T){function A(){}A.prototype=T.prototype,P.D=T.prototype,P.prototype=new A,P.prototype.constructor=P,P.C=function(F,S,V){for(var D=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)D[ke-2]=arguments[ke];return T.prototype[S].apply(F,D)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(P,T,A){A||(A=0);var F=Array(16);if(typeof T=="string")for(var S=0;16>S;++S)F[S]=T.charCodeAt(A++)|T.charCodeAt(A++)<<8|T.charCodeAt(A++)<<16|T.charCodeAt(A++)<<24;else for(S=0;16>S;++S)F[S]=T[A++]|T[A++]<<8|T[A++]<<16|T[A++]<<24;T=P.g[0],A=P.g[1],S=P.g[2];var V=P.g[3],D=T+(V^A&(S^V))+F[0]+3614090360&4294967295;T=A+(D<<7&4294967295|D>>>25),D=V+(S^T&(A^S))+F[1]+3905402710&4294967295,V=T+(D<<12&4294967295|D>>>20),D=S+(A^V&(T^A))+F[2]+606105819&4294967295,S=V+(D<<17&4294967295|D>>>15),D=A+(T^S&(V^T))+F[3]+3250441966&4294967295,A=S+(D<<22&4294967295|D>>>10),D=T+(V^A&(S^V))+F[4]+4118548399&4294967295,T=A+(D<<7&4294967295|D>>>25),D=V+(S^T&(A^S))+F[5]+1200080426&4294967295,V=T+(D<<12&4294967295|D>>>20),D=S+(A^V&(T^A))+F[6]+2821735955&4294967295,S=V+(D<<17&4294967295|D>>>15),D=A+(T^S&(V^T))+F[7]+4249261313&4294967295,A=S+(D<<22&4294967295|D>>>10),D=T+(V^A&(S^V))+F[8]+1770035416&4294967295,T=A+(D<<7&4294967295|D>>>25),D=V+(S^T&(A^S))+F[9]+2336552879&4294967295,V=T+(D<<12&4294967295|D>>>20),D=S+(A^V&(T^A))+F[10]+4294925233&4294967295,S=V+(D<<17&4294967295|D>>>15),D=A+(T^S&(V^T))+F[11]+2304563134&4294967295,A=S+(D<<22&4294967295|D>>>10),D=T+(V^A&(S^V))+F[12]+1804603682&4294967295,T=A+(D<<7&4294967295|D>>>25),D=V+(S^T&(A^S))+F[13]+4254626195&4294967295,V=T+(D<<12&4294967295|D>>>20),D=S+(A^V&(T^A))+F[14]+2792965006&4294967295,S=V+(D<<17&4294967295|D>>>15),D=A+(T^S&(V^T))+F[15]+1236535329&4294967295,A=S+(D<<22&4294967295|D>>>10),D=T+(S^V&(A^S))+F[1]+4129170786&4294967295,T=A+(D<<5&4294967295|D>>>27),D=V+(A^S&(T^A))+F[6]+3225465664&4294967295,V=T+(D<<9&4294967295|D>>>23),D=S+(T^A&(V^T))+F[11]+643717713&4294967295,S=V+(D<<14&4294967295|D>>>18),D=A+(V^T&(S^V))+F[0]+3921069994&4294967295,A=S+(D<<20&4294967295|D>>>12),D=T+(S^V&(A^S))+F[5]+3593408605&4294967295,T=A+(D<<5&4294967295|D>>>27),D=V+(A^S&(T^A))+F[10]+38016083&4294967295,V=T+(D<<9&4294967295|D>>>23),D=S+(T^A&(V^T))+F[15]+3634488961&4294967295,S=V+(D<<14&4294967295|D>>>18),D=A+(V^T&(S^V))+F[4]+3889429448&4294967295,A=S+(D<<20&4294967295|D>>>12),D=T+(S^V&(A^S))+F[9]+568446438&4294967295,T=A+(D<<5&4294967295|D>>>27),D=V+(A^S&(T^A))+F[14]+3275163606&4294967295,V=T+(D<<9&4294967295|D>>>23),D=S+(T^A&(V^T))+F[3]+4107603335&4294967295,S=V+(D<<14&4294967295|D>>>18),D=A+(V^T&(S^V))+F[8]+1163531501&4294967295,A=S+(D<<20&4294967295|D>>>12),D=T+(S^V&(A^S))+F[13]+2850285829&4294967295,T=A+(D<<5&4294967295|D>>>27),D=V+(A^S&(T^A))+F[2]+4243563512&4294967295,V=T+(D<<9&4294967295|D>>>23),D=S+(T^A&(V^T))+F[7]+1735328473&4294967295,S=V+(D<<14&4294967295|D>>>18),D=A+(V^T&(S^V))+F[12]+2368359562&4294967295,A=S+(D<<20&4294967295|D>>>12),D=T+(A^S^V)+F[5]+4294588738&4294967295,T=A+(D<<4&4294967295|D>>>28),D=V+(T^A^S)+F[8]+2272392833&4294967295,V=T+(D<<11&4294967295|D>>>21),D=S+(V^T^A)+F[11]+1839030562&4294967295,S=V+(D<<16&4294967295|D>>>16),D=A+(S^V^T)+F[14]+4259657740&4294967295,A=S+(D<<23&4294967295|D>>>9),D=T+(A^S^V)+F[1]+2763975236&4294967295,T=A+(D<<4&4294967295|D>>>28),D=V+(T^A^S)+F[4]+1272893353&4294967295,V=T+(D<<11&4294967295|D>>>21),D=S+(V^T^A)+F[7]+4139469664&4294967295,S=V+(D<<16&4294967295|D>>>16),D=A+(S^V^T)+F[10]+3200236656&4294967295,A=S+(D<<23&4294967295|D>>>9),D=T+(A^S^V)+F[13]+681279174&4294967295,T=A+(D<<4&4294967295|D>>>28),D=V+(T^A^S)+F[0]+3936430074&4294967295,V=T+(D<<11&4294967295|D>>>21),D=S+(V^T^A)+F[3]+3572445317&4294967295,S=V+(D<<16&4294967295|D>>>16),D=A+(S^V^T)+F[6]+76029189&4294967295,A=S+(D<<23&4294967295|D>>>9),D=T+(A^S^V)+F[9]+3654602809&4294967295,T=A+(D<<4&4294967295|D>>>28),D=V+(T^A^S)+F[12]+3873151461&4294967295,V=T+(D<<11&4294967295|D>>>21),D=S+(V^T^A)+F[15]+530742520&4294967295,S=V+(D<<16&4294967295|D>>>16),D=A+(S^V^T)+F[2]+3299628645&4294967295,A=S+(D<<23&4294967295|D>>>9),D=T+(S^(A|~V))+F[0]+4096336452&4294967295,T=A+(D<<6&4294967295|D>>>26),D=V+(A^(T|~S))+F[7]+1126891415&4294967295,V=T+(D<<10&4294967295|D>>>22),D=S+(T^(V|~A))+F[14]+2878612391&4294967295,S=V+(D<<15&4294967295|D>>>17),D=A+(V^(S|~T))+F[5]+4237533241&4294967295,A=S+(D<<21&4294967295|D>>>11),D=T+(S^(A|~V))+F[12]+1700485571&4294967295,T=A+(D<<6&4294967295|D>>>26),D=V+(A^(T|~S))+F[3]+2399980690&4294967295,V=T+(D<<10&4294967295|D>>>22),D=S+(T^(V|~A))+F[10]+4293915773&4294967295,S=V+(D<<15&4294967295|D>>>17),D=A+(V^(S|~T))+F[1]+2240044497&4294967295,A=S+(D<<21&4294967295|D>>>11),D=T+(S^(A|~V))+F[8]+1873313359&4294967295,T=A+(D<<6&4294967295|D>>>26),D=V+(A^(T|~S))+F[15]+4264355552&4294967295,V=T+(D<<10&4294967295|D>>>22),D=S+(T^(V|~A))+F[6]+2734768916&4294967295,S=V+(D<<15&4294967295|D>>>17),D=A+(V^(S|~T))+F[13]+1309151649&4294967295,A=S+(D<<21&4294967295|D>>>11),D=T+(S^(A|~V))+F[4]+4149444226&4294967295,T=A+(D<<6&4294967295|D>>>26),D=V+(A^(T|~S))+F[11]+3174756917&4294967295,V=T+(D<<10&4294967295|D>>>22),D=S+(T^(V|~A))+F[2]+718787259&4294967295,S=V+(D<<15&4294967295|D>>>17),D=A+(V^(S|~T))+F[9]+3951481745&4294967295,P.g[0]=P.g[0]+T&4294967295,P.g[1]=P.g[1]+(S+(D<<21&4294967295|D>>>11))&4294967295,P.g[2]=P.g[2]+S&4294967295,P.g[3]=P.g[3]+V&4294967295}n.prototype.u=function(P,T){T===void 0&&(T=P.length);for(var A=T-this.blockSize,F=this.B,S=this.h,V=0;V<T;){if(S==0)for(;V<=A;)a(this,P,V),V+=this.blockSize;if(typeof P=="string"){for(;V<T;)if(F[S++]=P.charCodeAt(V++),S==this.blockSize){a(this,F),S=0;break}}else for(;V<T;)if(F[S++]=P[V++],S==this.blockSize){a(this,F),S=0;break}}this.h=S,this.o+=T},n.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var T=1;T<P.length-8;++T)P[T]=0;var A=8*this.o;for(T=P.length-8;T<P.length;++T)P[T]=A&255,A/=256;for(this.u(P),P=Array(16),T=A=0;4>T;++T)for(var F=0;32>F;F+=8)P[A++]=this.g[T]>>>F&255;return P};function l(P,T){var A=h;return Object.prototype.hasOwnProperty.call(A,P)?A[P]:A[P]=T(P)}function u(P,T){this.h=T;for(var A=[],F=!0,S=P.length-1;0<=S;S--){var V=P[S]|0;F&&V==T||(A[S]=V,F=!1)}this.g=A}var h={};function m(P){return-128<=P&&128>P?l(P,function(T){return new u([T|0],0>T?-1:0)}):new u([P|0],0>P?-1:0)}function p(P){if(isNaN(P)||!isFinite(P))return w;if(0>P)return U(p(-P));for(var T=[],A=1,F=0;P>=A;F++)T[F]=P/A|0,A*=4294967296;return new u(T,0)}function x(P,T){if(P.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(P.charAt(0)=="-")return U(x(P.substring(1),T));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=p(Math.pow(T,8)),F=w,S=0;S<P.length;S+=8){var V=Math.min(8,P.length-S),D=parseInt(P.substring(S,S+V),T);8>V?(V=p(Math.pow(T,V)),F=F.j(V).add(p(D))):(F=F.j(A),F=F.add(p(D)))}return F}var w=m(0),b=m(1),E=m(16777216);s=u.prototype,s.m=function(){if(R(this))return-U(this).m();for(var P=0,T=1,A=0;A<this.g.length;A++){var F=this.i(A);P+=(0<=F?F:4294967296+F)*T,T*=4294967296}return P},s.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(k(this))return"0";if(R(this))return"-"+U(this).toString(P);for(var T=p(Math.pow(P,6)),A=this,F="";;){var S=G(A,T).g;A=z(A,S.j(T));var V=((0<A.g.length?A.g[0]:A.h)>>>0).toString(P);if(A=S,k(A))return V+F;for(;6>V.length;)V="0"+V;F=V+F}},s.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function k(P){if(P.h!=0)return!1;for(var T=0;T<P.g.length;T++)if(P.g[T]!=0)return!1;return!0}function R(P){return P.h==-1}s.l=function(P){return P=z(this,P),R(P)?-1:k(P)?0:1};function U(P){for(var T=P.g.length,A=[],F=0;F<T;F++)A[F]=~P.g[F];return new u(A,~P.h).add(b)}s.abs=function(){return R(this)?U(this):this},s.add=function(P){for(var T=Math.max(this.g.length,P.g.length),A=[],F=0,S=0;S<=T;S++){var V=F+(this.i(S)&65535)+(P.i(S)&65535),D=(V>>>16)+(this.i(S)>>>16)+(P.i(S)>>>16);F=D>>>16,V&=65535,D&=65535,A[S]=D<<16|V}return new u(A,A[A.length-1]&-2147483648?-1:0)};function z(P,T){return P.add(U(T))}s.j=function(P){if(k(this)||k(P))return w;if(R(this))return R(P)?U(this).j(U(P)):U(U(this).j(P));if(R(P))return U(this.j(U(P)));if(0>this.l(E)&&0>P.l(E))return p(this.m()*P.m());for(var T=this.g.length+P.g.length,A=[],F=0;F<2*T;F++)A[F]=0;for(F=0;F<this.g.length;F++)for(var S=0;S<P.g.length;S++){var V=this.i(F)>>>16,D=this.i(F)&65535,ke=P.i(S)>>>16,ne=P.i(S)&65535;A[2*F+2*S]+=D*ne,B(A,2*F+2*S),A[2*F+2*S+1]+=V*ne,B(A,2*F+2*S+1),A[2*F+2*S+1]+=D*ke,B(A,2*F+2*S+1),A[2*F+2*S+2]+=V*ke,B(A,2*F+2*S+2)}for(F=0;F<T;F++)A[F]=A[2*F+1]<<16|A[2*F];for(F=T;F<2*T;F++)A[F]=0;return new u(A,0)};function B(P,T){for(;(P[T]&65535)!=P[T];)P[T+1]+=P[T]>>>16,P[T]&=65535,T++}function q(P,T){this.g=P,this.h=T}function G(P,T){if(k(T))throw Error("division by zero");if(k(P))return new q(w,w);if(R(P))return T=G(U(P),T),new q(U(T.g),U(T.h));if(R(T))return T=G(P,U(T)),new q(U(T.g),T.h);if(30<P.g.length){if(R(P)||R(T))throw Error("slowDivide_ only works with positive integers.");for(var A=b,F=T;0>=F.l(P);)A=Q(A),F=Q(F);var S=L(A,1),V=L(F,1);for(F=L(F,2),A=L(A,2);!k(F);){var D=V.add(F);0>=D.l(P)&&(S=S.add(A),V=D),F=L(F,1),A=L(A,1)}return T=z(P,S.j(T)),new q(S,T)}for(S=w;0<=P.l(T);){for(A=Math.max(1,Math.floor(P.m()/T.m())),F=Math.ceil(Math.log(A)/Math.LN2),F=48>=F?1:Math.pow(2,F-48),V=p(A),D=V.j(T);R(D)||0<D.l(P);)A-=F,V=p(A),D=V.j(T);k(V)&&(V=b),S=S.add(V),P=z(P,D)}return new q(S,P)}s.A=function(P){return G(this,P).h},s.and=function(P){for(var T=Math.max(this.g.length,P.g.length),A=[],F=0;F<T;F++)A[F]=this.i(F)&P.i(F);return new u(A,this.h&P.h)},s.or=function(P){for(var T=Math.max(this.g.length,P.g.length),A=[],F=0;F<T;F++)A[F]=this.i(F)|P.i(F);return new u(A,this.h|P.h)},s.xor=function(P){for(var T=Math.max(this.g.length,P.g.length),A=[],F=0;F<T;F++)A[F]=this.i(F)^P.i(F);return new u(A,this.h^P.h)};function Q(P){for(var T=P.g.length+1,A=[],F=0;F<T;F++)A[F]=P.i(F)<<1|P.i(F-1)>>>31;return new u(A,P.h)}function L(P,T){var A=T>>5;T%=32;for(var F=P.g.length-A,S=[],V=0;V<F;V++)S[V]=0<T?P.i(V+A)>>>T|P.i(V+A+1)<<32-T:P.i(V+A);return new u(S,P.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,gS=n,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=p,u.fromString=x,Qi=u}).apply(typeof bN<"u"?bN:typeof self<"u"?self:typeof window<"u"?window:{});var Hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var pS,Ad,yS,im,px,xS,vS,bS;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,v,_){return f==Array.prototype||f==Object.prototype||(f[v]=_.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Hf=="object"&&Hf];for(var v=0;v<f.length;++v){var _=f[v];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var n=t(this);function a(f,v){if(v)e:{var _=n;f=f.split(".");for(var C=0;C<f.length-1;C++){var Z=f[C];if(!(Z in _))break e;_=_[Z]}f=f[f.length-1],C=_[f],v=v(C),v!=C&&v!=null&&e(_,f,{configurable:!0,writable:!0,value:v})}}function l(f,v){f instanceof String&&(f+="");var _=0,C=!1,Z={next:function(){if(!C&&_<f.length){var le=_++;return{value:v(le,f[le]),done:!1}}return C=!0,{done:!0,value:void 0}}};return Z[Symbol.iterator]=function(){return Z},Z}a("Array.prototype.values",function(f){return f||function(){return l(this,function(v,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var u=u||{},h=this||self;function m(f){var v=typeof f;return v=v!="object"?v:f?Array.isArray(f)?"array":v:"null",v=="array"||v=="object"&&typeof f.length=="number"}function p(f){var v=typeof f;return v=="object"&&f!=null||v=="function"}function x(f,v,_){return f.call.apply(f.bind,arguments)}function w(f,v,_){if(!f)throw Error();if(2<arguments.length){var C=Array.prototype.slice.call(arguments,2);return function(){var Z=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Z,C),f.apply(v,Z)}}return function(){return f.apply(v,arguments)}}function b(f,v,_){return b=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?x:w,b.apply(null,arguments)}function E(f,v){var _=Array.prototype.slice.call(arguments,1);return function(){var C=_.slice();return C.push.apply(C,arguments),f.apply(this,C)}}function k(f,v){function _(){}_.prototype=v.prototype,f.aa=v.prototype,f.prototype=new _,f.prototype.constructor=f,f.Qb=function(C,Z,le){for(var we=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)we[dt-2]=arguments[dt];return v.prototype[Z].apply(C,we)}}function R(f){const v=f.length;if(0<v){const _=Array(v);for(let C=0;C<v;C++)_[C]=f[C];return _}return[]}function U(f,v){for(let _=1;_<arguments.length;_++){const C=arguments[_];if(m(C)){const Z=f.length||0,le=C.length||0;f.length=Z+le;for(let we=0;we<le;we++)f[Z+we]=C[we]}else f.push(C)}}class z{constructor(v,_){this.i=v,this.j=_,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function B(f){return/^[\s\xa0]*$/.test(f)}function q(){var f=h.navigator;return f&&(f=f.userAgent)?f:""}function G(f){return G[" "](f),f}G[" "]=function(){};var Q=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function L(f,v,_){for(const C in f)v.call(_,f[C],C,f)}function P(f,v){for(const _ in f)v.call(void 0,f[_],_,f)}function T(f){const v={};for(const _ in f)v[_]=f[_];return v}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(f,v){let _,C;for(let Z=1;Z<arguments.length;Z++){C=arguments[Z];for(_ in C)f[_]=C[_];for(let le=0;le<A.length;le++)_=A[le],Object.prototype.hasOwnProperty.call(C,_)&&(f[_]=C[_])}}function S(f){var v=1;f=f.split(":");const _=[];for(;0<v&&f.length;)_.push(f.shift()),v--;return f.length&&_.push(f.join(":")),_}function V(f){h.setTimeout(()=>{throw f},0)}function D(){var f=ge;let v=null;return f.g&&(v=f.g,f.g=f.g.next,f.g||(f.h=null),v.next=null),v}class ke{constructor(){this.h=this.g=null}add(v,_){const C=ne.get();C.set(v,_),this.h?this.h.next=C:this.g=C,this.h=C}}var ne=new z(()=>new O,f=>f.reset());class O{constructor(){this.next=this.g=this.h=null}set(v,_){this.h=v,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let ie,$=!1,ge=new ke,I=()=>{const f=h.Promise.resolve(void 0);ie=()=>{f.then(W)}};var W=()=>{for(var f;f=D();){try{f.h.call(f.g)}catch(_){V(_)}var v=ne;v.j(f),100>v.h&&(v.h++,f.next=v.g,v.g=f)}$=!1};function ve(){this.s=this.s,this.C=this.C}ve.prototype.s=!1,ve.prototype.ma=function(){this.s||(this.s=!0,this.N())},ve.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function de(f,v){this.type=f,this.g=this.target=v,this.defaultPrevented=!1}de.prototype.h=function(){this.defaultPrevented=!0};var Ce=(function(){if(!h.addEventListener||!Object.defineProperty)return!1;var f=!1,v=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const _=()=>{};h.addEventListener("test",_,v),h.removeEventListener("test",_,v)}catch{}return f})();function ye(f,v){if(de.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var _=this.type=f.type,C=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=v,v=f.relatedTarget){if(Q){e:{try{G(v.nodeName);var Z=!0;break e}catch{}Z=!1}Z||(v=null)}}else _=="mouseover"?v=f.fromElement:_=="mouseout"&&(v=f.toElement);this.relatedTarget=v,C?(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Ee[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&ye.aa.h.call(this)}}k(ye,de);var Ee={2:"touch",3:"pen",4:"mouse"};ye.prototype.h=function(){ye.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var We="closure_listenable_"+(1e6*Math.random()|0),Le=0;function wt(f,v,_,C,Z){this.listener=f,this.proxy=null,this.src=v,this.type=_,this.capture=!!C,this.ha=Z,this.key=++Le,this.da=this.fa=!1}function Rt(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Gt(f){this.src=f,this.g={},this.h=0}Gt.prototype.add=function(f,v,_,C,Z){var le=f.toString();f=this.g[le],f||(f=this.g[le]=[],this.h++);var we=ce(f,v,C,Z);return-1<we?(v=f[we],_||(v.fa=!1)):(v=new wt(v,this.src,le,!!C,Z),v.fa=_,f.push(v)),v};function st(f,v){var _=v.type;if(_ in f.g){var C=f.g[_],Z=Array.prototype.indexOf.call(C,v,void 0),le;(le=0<=Z)&&Array.prototype.splice.call(C,Z,1),le&&(Rt(v),f.g[_].length==0&&(delete f.g[_],f.h--))}}function ce(f,v,_,C){for(var Z=0;Z<f.length;++Z){var le=f[Z];if(!le.da&&le.listener==v&&le.capture==!!_&&le.ha==C)return Z}return-1}var Ae="closure_lm_"+(1e6*Math.random()|0),Te={};function $e(f,v,_,C,Z){if(Array.isArray(v)){for(var le=0;le<v.length;le++)$e(f,v[le],_,C,Z);return null}return _=Wn(_),f&&f[We]?f.K(v,_,p(C)?!!C.capture:!1,Z):Qe(f,v,_,!1,C,Z)}function Qe(f,v,_,C,Z,le){if(!v)throw Error("Invalid event type");var we=p(Z)?!!Z.capture:!!Z,dt=en(f);if(dt||(f[Ae]=dt=new Gt(f)),_=dt.add(v,_,C,we,le),_.proxy)return _;if(C=Tt(),_.proxy=C,C.src=f,C.listener=_,f.addEventListener)Ce||(Z=we),Z===void 0&&(Z=!1),f.addEventListener(v.toString(),C,Z);else if(f.attachEvent)f.attachEvent(Ge(v.toString()),C);else if(f.addListener&&f.removeListener)f.addListener(C);else throw Error("addEventListener and attachEvent are unavailable.");return _}function Tt(){function f(_){return v.call(f.src,f.listener,_)}const v=$t;return f}function gt(f,v,_,C,Z){if(Array.isArray(v))for(var le=0;le<v.length;le++)gt(f,v[le],_,C,Z);else C=p(C)?!!C.capture:!!C,_=Wn(_),f&&f[We]?(f=f.i,v=String(v).toString(),v in f.g&&(le=f.g[v],_=ce(le,_,C,Z),-1<_&&(Rt(le[_]),Array.prototype.splice.call(le,_,1),le.length==0&&(delete f.g[v],f.h--)))):f&&(f=en(f))&&(v=f.g[v.toString()],f=-1,v&&(f=ce(v,_,C,Z)),(_=-1<f?v[f]:null)&&ot(_))}function ot(f){if(typeof f!="number"&&f&&!f.da){var v=f.src;if(v&&v[We])st(v.i,f);else{var _=f.type,C=f.proxy;v.removeEventListener?v.removeEventListener(_,C,f.capture):v.detachEvent?v.detachEvent(Ge(_),C):v.addListener&&v.removeListener&&v.removeListener(C),(_=en(v))?(st(_,f),_.h==0&&(_.src=null,v[Ae]=null)):Rt(f)}}}function Ge(f){return f in Te?Te[f]:Te[f]="on"+f}function $t(f,v){if(f.da)f=!0;else{v=new ye(v,this);var _=f.listener,C=f.ha||f.src;f.fa&&ot(f),f=_.call(C,v)}return f}function en(f){return f=f[Ae],f instanceof Gt?f:null}var Et="__closure_events_fn_"+(1e9*Math.random()>>>0);function Wn(f){return typeof f=="function"?f:(f[Et]||(f[Et]=function(v){return f.handleEvent(v)}),f[Et])}function pt(){ve.call(this),this.i=new Gt(this),this.M=this,this.F=null}k(pt,ve),pt.prototype[We]=!0,pt.prototype.removeEventListener=function(f,v,_,C){gt(this,f,v,_,C)};function ut(f,v){var _,C=f.F;if(C)for(_=[];C;C=C.F)_.push(C);if(f=f.M,C=v.type||v,typeof v=="string")v=new de(v,f);else if(v instanceof de)v.target=v.target||f;else{var Z=v;v=new de(C,f),F(v,Z)}if(Z=!0,_)for(var le=_.length-1;0<=le;le--){var we=v.g=_[le];Z=Vn(we,C,!0,v)&&Z}if(we=v.g=f,Z=Vn(we,C,!0,v)&&Z,Z=Vn(we,C,!1,v)&&Z,_)for(le=0;le<_.length;le++)we=v.g=_[le],Z=Vn(we,C,!1,v)&&Z}pt.prototype.N=function(){if(pt.aa.N.call(this),this.i){var f=this.i,v;for(v in f.g){for(var _=f.g[v],C=0;C<_.length;C++)Rt(_[C]);delete f.g[v],f.h--}}this.F=null},pt.prototype.K=function(f,v,_,C){return this.i.add(String(f),v,!1,_,C)},pt.prototype.L=function(f,v,_,C){return this.i.add(String(f),v,!0,_,C)};function Vn(f,v,_,C){if(v=f.i.g[String(v)],!v)return!0;v=v.concat();for(var Z=!0,le=0;le<v.length;++le){var we=v[le];if(we&&!we.da&&we.capture==_){var dt=we.listener,Cn=we.ha||we.src;we.fa&&st(f.i,we),Z=dt.call(Cn,C)!==!1&&Z}}return Z&&!C.defaultPrevented}function jn(f,v,_){if(typeof f=="function")_&&(f=b(f,_));else if(f&&typeof f.handleEvent=="function")f=b(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:h.setTimeout(f,v||0)}function ii(f){f.g=jn(()=>{f.g=null,f.i&&(f.i=!1,ii(f))},f.l);const v=f.h;f.h=null,f.m.apply(null,v)}class El extends ve{constructor(v,_){super(),this.m=v,this.l=_,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:ii(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function tr(f){ve.call(this),this.h=f,this.g={}}k(tr,ve);var nr=[];function Jn(f){L(f.g,function(v,_){this.g.hasOwnProperty(_)&&ot(v)},f),f.g={}}tr.prototype.N=function(){tr.aa.N.call(this),Jn(this)},tr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ln=h.JSON.stringify,zr=h.JSON.parse,Tr=class{stringify(f){return h.JSON.stringify(f,void 0)}parse(f){return h.JSON.parse(f,void 0)}};function mo(){}mo.prototype.h=null;function Hr(f){return f.h||(f.h=f.i())}function Gr(){}var Er={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gs(){de.call(this,"d")}k(gs,de);function go(){de.call(this,"c")}k(go,de);var sr={},Kt=null;function ps(){return Kt=Kt||new pt}sr.La="serverreachability";function oi(f){de.call(this,sr.La,f)}k(oi,de);function Sr(f){const v=ps();ut(v,new oi(v))}sr.STAT_EVENT="statevent";function li(f,v){de.call(this,sr.STAT_EVENT,f),this.stat=v}k(li,de);function Lt(f){const v=ps();ut(v,new li(v,f))}sr.Ma="timingevent";function cn(f,v){de.call(this,sr.Ma,f),this.size=v}k(cn,de);function un(f,v){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){f()},v)}function tn(){this.g=!0}tn.prototype.xa=function(){this.g=!1};function rr(f,v,_,C,Z,le){f.info(function(){if(f.g)if(le)for(var we="",dt=le.split("&"),Cn=0;Cn<dt.length;Cn++){var ht=dt[Cn].split("=");if(1<ht.length){var zn=ht[0];ht=ht[1];var In=zn.split("_");we=2<=In.length&&In[1]=="type"?we+(zn+"="+ht+"&"):we+(zn+"=redacted&")}}else we=null;else we=le;return"XMLHTTP REQ ("+C+") [attempt "+Z+"]: "+v+`
`+_+`
`+we})}function Sl(f,v,_,C,Z,le,we){f.info(function(){return"XMLHTTP RESP ("+C+") [ attempt "+Z+"]: "+v+`
`+_+`
`+le+" "+we})}function jr(f,v,_,C){f.info(function(){return"XMLHTTP TEXT ("+v+"): "+$r(f,_)+(C?" "+C:"")})}function ci(f,v){f.info(function(){return"TIMEOUT: "+v})}tn.prototype.info=function(){};function $r(f,v){if(!f.g)return v;if(!v)return null;try{var _=JSON.parse(v);if(_){for(f=0;f<_.length;f++)if(Array.isArray(_[f])){var C=_[f];if(!(2>C.length)){var Z=C[1];if(Array.isArray(Z)&&!(1>Z.length)){var le=Z[0];if(le!="noop"&&le!="stop"&&le!="close")for(var we=1;we<Z.length;we++)Z[we]=""}}}}return Ln(_)}catch{return v}}var Fn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ar={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ls;function Fs(){}k(Fs,mo),Fs.prototype.g=function(){return new XMLHttpRequest},Fs.prototype.i=function(){return{}},Ls=new Fs;function Un(f,v,_,C){this.j=f,this.i=v,this.l=_,this.R=C||1,this.U=new tr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new nn}function nn(){this.i=null,this.g="",this.h=!1}var Pe={},Y={};function xe(f,v,_){f.L=1,f.v=vo(Us(v)),f.m=_,f.P=!0,je(f,null)}function je(f,v){f.F=Date.now(),Ft(f),f.A=Us(f.v);var _=f.A,C=f.R;Array.isArray(C)||(C=[String(C)]),Nu(_.i,"t",C),f.C=0,_=f.j.J,f.h=new nn,f.g=Lh(f.j,_?v:null,!f.m),0<f.O&&(f.M=new El(b(f.Y,f,f.g),f.O)),v=f.U,_=f.g,C=f.ca;var Z="readystatechange";Array.isArray(Z)||(Z&&(nr[0]=Z.toString()),Z=nr);for(var le=0;le<Z.length;le++){var we=$e(_,Z[le],C||v.handleEvent,!1,v.h||v);if(!we)break;v.g[we.key]=we}v=f.H?T(f.H):{},f.m?(f.u||(f.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,v)):(f.u="GET",f.g.ea(f.A,f.u,null,v)),Sr(),rr(f.i,f.u,f.A,f.l,f.R,f.m)}Un.prototype.ca=function(f){f=f.target;const v=this.M;v&&ur(f)==3?v.j():this.Y(f)},Un.prototype.Y=function(f){try{if(f==this.g)e:{const In=ur(this.g);var v=this.g.Ba();const Ta=this.g.Z();if(!(3>In)&&(In!=3||this.g&&(this.h.h||this.g.oa()||Ih(this.g)))){this.J||In!=4||v==7||(v==8||0>=Ta?Sr(3):Sr(2)),Bn(this);var _=this.g.Z();this.X=_;t:if(St(this)){var C=Ih(this.g);f="";var Z=C.length,le=ur(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){mn(this),os(this);var we="";break t}this.h.i=new h.TextDecoder}for(v=0;v<Z;v++)this.h.h=!0,f+=this.h.i.decode(C[v],{stream:!(le&&v==Z-1)});C.length=0,this.h.g+=f,this.C=0,we=this.h.g}else we=this.g.oa();if(this.o=_==200,Sl(this.i,this.u,this.A,this.l,this.R,In,_),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,Cn=this.g;if((dt=Cn.g?Cn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(dt)){var ht=dt;break t}}ht=null}if(_=ht)jr(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qt(this,_);else{this.o=!1,this.s=3,Lt(12),mn(this),os(this);break e}}if(this.P){_=!0;let Zn;for(;!this.J&&this.C<we.length;)if(Zn=fn(this,we),Zn==Y){In==4&&(this.s=4,Lt(14),_=!1),jr(this.i,this.l,null,"[Incomplete Response]");break}else if(Zn==Pe){this.s=4,Lt(15),jr(this.i,this.l,we,"[Invalid Chunk]"),_=!1;break}else jr(this.i,this.l,Zn,null),Qt(this,Zn);if(St(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),In!=4||we.length!=0||this.h.h||(this.s=1,Lt(16),_=!1),this.o=this.o&&_,!_)jr(this.i,this.l,we,"[Invalid Chunked Response]"),mn(this),os(this);else if(0<we.length&&!this.W){this.W=!0;var zn=this.j;zn.g==this&&zn.ba&&!zn.M&&(zn.j.info("Great, no buffering proxy detected. Bytes received: "+we.length),jo(zn),zn.M=!0,Lt(11))}}else jr(this.i,this.l,we,null),Qt(this,we);In==4&&mn(this),this.o&&!this.J&&(In==4?Mh(this.j,this):(this.o=!1,Ft(this)))}else Fg(this.g),_==400&&0<we.indexOf("Unknown SID")?(this.s=3,Lt(12)):(this.s=0,Lt(13)),mn(this),os(this)}}}catch{}finally{}};function St(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function fn(f,v){var _=f.C,C=v.indexOf(`
`,_);return C==-1?Y:(_=Number(v.substring(_,C)),isNaN(_)?Pe:(C+=1,C+_>v.length?Y:(v=v.slice(C,C+_),f.C=C+_,v)))}Un.prototype.cancel=function(){this.J=!0,mn(this)};function Ft(f){f.S=Date.now()+f.I,An(f,f.I)}function An(f,v){if(f.B!=null)throw Error("WatchDog timer not null");f.B=un(b(f.ba,f),v)}function Bn(f){f.B&&(h.clearTimeout(f.B),f.B=null)}Un.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(ci(this.i,this.A),this.L!=2&&(Sr(),Lt(17)),mn(this),this.s=2,os(this)):An(this,this.S-f)};function os(f){f.j.G==0||f.J||Mh(f.j,f)}function mn(f){Bn(f);var v=f.M;v&&typeof v.ma=="function"&&v.ma(),f.M=null,Jn(f.U),f.g&&(v=f.g,f.g=null,v.abort(),v.ma())}function Qt(f,v){try{var _=f.j;if(_.G!=0&&(_.g==f||xu(_.h,f))){if(!f.K&&xu(_.h,f)&&_.G==3){try{var C=_.Da.g.parse(v)}catch{C=null}if(Array.isArray(C)&&C.length==3){var Z=C;if(Z[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<f.F)Ll(_),Ol(_);else break e;Au(_),Lt(18)}}else _.za=Z[1],0<_.za-_.T&&37500>Z[2]&&_.F&&_.v==0&&!_.C&&(_.C=un(b(_.Za,_),6e3));if(1>=Al(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else Na(_,11)}else if((f.K||_.g==f)&&Ll(_),!B(v))for(Z=_.Da.g.parse(v),v=0;v<Z.length;v++){let ht=Z[v];if(_.T=ht[0],ht=ht[1],_.G==2)if(ht[0]=="c"){_.K=ht[1],_.ia=ht[2];const zn=ht[3];zn!=null&&(_.la=zn,_.j.info("VER="+_.la));const In=ht[4];In!=null&&(_.Aa=In,_.j.info("SVER="+_.Aa));const Ta=ht[5];Ta!=null&&typeof Ta=="number"&&0<Ta&&(C=1.5*Ta,_.L=C,_.j.info("backChannelRequestTimeoutMs_="+C)),C=_;const Zn=f.g;if(Zn){const Zr=Zn.g?Zn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Zr){var le=C.h;le.g||Zr.indexOf("spdy")==-1&&Zr.indexOf("quic")==-1&&Zr.indexOf("h2")==-1||(le.j=le.l,le.g=new Set,le.h&&(Cl(le,le.h),le.h=null))}if(C.D){const Iu=Zn.g?Zn.g.getResponseHeader("X-HTTP-Session-Id"):null;Iu&&(C.ya=Iu,Dt(C.I,C.D,Iu))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-f.F,_.j.info("Handshake RTT: "+_.R+"ms")),C=_;var we=f;if(C.qa=Vh(C,C.J?C.ia:null,C.W),we.K){ys(C.h,we);var dt=we,Cn=C.L;Cn&&(dt.I=Cn),dt.B&&(Bn(dt),Ft(dt)),C.g=we}else Dh(C);0<_.i.length&&Vl(_)}else ht[0]!="stop"&&ht[0]!="close"||Na(_,7);else _.G==3&&(ht[0]=="stop"||ht[0]=="close"?ht[0]=="stop"?Na(_,7):Su(_):ht[0]!="noop"&&_.l&&_.l.ta(ht),_.v=0)}}Sr(4)}catch{}}var po=class{constructor(f,v){this.g=f,this.map=v}};function ir(f){this.l=f||10,h.PerformanceNavigationTiming?(f=h.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(h.chrome&&h.chrome.loadTimes&&h.chrome.loadTimes()&&h.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function jl(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function Al(f){return f.h?1:f.g?f.g.size:0}function xu(f,v){return f.h?f.h==v:f.g?f.g.has(v):!1}function Cl(f,v){f.g?f.g.add(v):f.h=v}function ys(f,v){f.h&&f.h==v?f.h=null:f.g&&f.g.has(v)&&f.g.delete(v)}ir.prototype.cancel=function(){if(this.i=vu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function vu(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let v=f.i;for(const _ of f.g.values())v=v.concat(_.D);return v}return R(f.i)}function Mg(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(m(f)){for(var v=[],_=f.length,C=0;C<_;C++)v.push(f[C]);return v}v=[],_=0;for(C in f)v[_++]=f[C];return v}function Il(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(m(f)||typeof f=="string"){var v=[];f=f.length;for(var _=0;_<f;_++)v.push(_);return v}v=[],_=0;for(const C in f)v[_++]=C;return v}}}function bu(f,v){if(f.forEach&&typeof f.forEach=="function")f.forEach(v,void 0);else if(m(f)||typeof f=="string")Array.prototype.forEach.call(f,v,void 0);else for(var _=Il(f),C=Mg(f),Z=C.length,le=0;le<Z;le++)v.call(void 0,C[le],_&&_[le],f)}var yo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Og(f,v){if(f){f=f.split("&");for(var _=0;_<f.length;_++){var C=f[_].indexOf("="),Z=null;if(0<=C){var le=f[_].substring(0,C);Z=f[_].substring(C+1)}else le=f[_];v(le,Z?decodeURIComponent(Z.replace(/\+/g," ")):"")}}}function vn(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof vn){this.h=f.h,xo(this,f.j),this.o=f.o,this.g=f.g,ui(this,f.s),this.l=f.l;var v=f.i,_=new va;_.i=v.i,v.g&&(_.g=new Map(v.g),_.h=v.h),xa(this,_),this.m=f.m}else f&&(v=String(f).match(yo))?(this.h=!1,xo(this,v[1]||"",!0),this.o=or(v[2]||""),this.g=or(v[3]||"",!0),ui(this,v[4]),this.l=or(v[5]||"",!0),xa(this,v[6]||"",!0),this.m=or(v[7]||"")):(this.h=!1,this.i=new va(null,this.h))}vn.prototype.toString=function(){var f=[],v=this.j;v&&f.push(bo(v,wu,!0),":");var _=this.g;return(_||v=="file")&&(f.push("//"),(v=this.o)&&f.push(bo(v,wu,!0),"@"),f.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&f.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&f.push("/"),f.push(bo(_,_.charAt(0)=="/"?Vg:_u,!0))),(_=this.i.toString())&&f.push("?",_),(_=this.m)&&f.push("#",bo(_,kl)),f.join("")};function Us(f){return new vn(f)}function xo(f,v,_){f.j=_?or(v,!0):v,f.j&&(f.j=f.j.replace(/:$/,""))}function ui(f,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);f.s=v}else f.s=null}function xa(f,v,_){v instanceof va?(f.i=v,Ah(f.i,f.h)):(_||(v=bo(v,Lg)),f.i=new va(v,f.h))}function Dt(f,v,_){f.i.set(v,_)}function vo(f){return Dt(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function or(f,v){return f?v?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function bo(f,v,_){return typeof f=="string"?(f=encodeURI(f).replace(v,jh),_&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function jh(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var wu=/[#\/\?@]/g,_u=/[#\?:]/g,Vg=/[#\?]/g,Lg=/[#\?@]/g,kl=/#/g;function va(f,v){this.h=this.g=null,this.i=f||null,this.j=!!v}function lr(f){f.g||(f.g=new Map,f.h=0,f.i&&Og(f.i,function(v,_){f.add(decodeURIComponent(v.replace(/\+/g," ")),_)}))}s=va.prototype,s.add=function(f,v){lr(this),this.i=null,f=Kr(this,f);var _=this.g.get(f);return _||this.g.set(f,_=[]),_.push(v),this.h+=1,this};function ba(f,v){lr(f),v=Kr(f,v),f.g.has(v)&&(f.i=null,f.h-=f.g.get(v).length,f.g.delete(v))}function wa(f,v){return lr(f),v=Kr(f,v),f.g.has(v)}s.forEach=function(f,v){lr(this),this.g.forEach(function(_,C){_.forEach(function(Z){f.call(v,Z,C,this)},this)},this)},s.na=function(){lr(this);const f=Array.from(this.g.values()),v=Array.from(this.g.keys()),_=[];for(let C=0;C<v.length;C++){const Z=f[C];for(let le=0;le<Z.length;le++)_.push(v[C])}return _},s.V=function(f){lr(this);let v=[];if(typeof f=="string")wa(this,f)&&(v=v.concat(this.g.get(Kr(this,f))));else{f=Array.from(this.g.values());for(let _=0;_<f.length;_++)v=v.concat(f[_])}return v},s.set=function(f,v){return lr(this),this.i=null,f=Kr(this,f),wa(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[v]),this.h+=1,this},s.get=function(f,v){return f?(f=this.V(f),0<f.length?String(f[0]):v):v};function Nu(f,v,_){ba(f,v),0<_.length&&(f.i=null,f.g.set(Kr(f,v),R(_)),f.h+=_.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],v=Array.from(this.g.keys());for(var _=0;_<v.length;_++){var C=v[_];const le=encodeURIComponent(String(C)),we=this.V(C);for(C=0;C<we.length;C++){var Z=le;we[C]!==""&&(Z+="="+encodeURIComponent(String(we[C]))),f.push(Z)}}return this.i=f.join("&")};function Kr(f,v){return v=String(v),f.j&&(v=v.toLowerCase()),v}function Ah(f,v){v&&!f.j&&(lr(f),f.i=null,f.g.forEach(function(_,C){var Z=C.toLowerCase();C!=Z&&(ba(this,C),Nu(this,Z,_))},f)),f.j=v}function wo(f,v){const _=new tn;if(h.Image){const C=new Image;C.onload=E(cr,_,"TestLoadImage: loaded",!0,v,C),C.onerror=E(cr,_,"TestLoadImage: error",!1,v,C),C.onabort=E(cr,_,"TestLoadImage: abort",!1,v,C),C.ontimeout=E(cr,_,"TestLoadImage: timeout",!1,v,C),h.setTimeout(function(){C.ontimeout&&C.ontimeout()},1e4),C.src=f}else v(!1)}function Ar(f,v){const _=new tn,C=new AbortController,Z=setTimeout(()=>{C.abort(),cr(_,"TestPingServer: timeout",!1,v)},1e4);fetch(f,{signal:C.signal}).then(le=>{clearTimeout(Z),le.ok?cr(_,"TestPingServer: ok",!0,v):cr(_,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(Z),cr(_,"TestPingServer: error",!1,v)})}function cr(f,v,_,C,Z){try{Z&&(Z.onload=null,Z.onerror=null,Z.onabort=null,Z.ontimeout=null),C(_)}catch{}}function _o(){this.g=new Tr}function Qr(f,v,_){const C=_||"";try{bu(f,function(Z,le){let we=Z;p(Z)&&(we=Ln(Z)),v.push(C+le+"="+encodeURIComponent(we))})}catch(Z){throw v.push(C+"type="+encodeURIComponent("_badmap")),Z}}function di(f){this.l=f.Ub||null,this.j=f.eb||!1}k(di,mo),di.prototype.g=function(){return new _a(this.l,this.j)},di.prototype.i=(function(f){return function(){return f}})({});function _a(f,v){pt.call(this),this.D=f,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(_a,pt),s=_a.prototype,s.open=function(f,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=v,this.readyState=1,Xr(this)},s.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(v.body=f),(this.D||h).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Yr(this)),this.readyState=0},s.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Xr(this)),this.g&&(this.readyState=3,Xr(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof h.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Tu(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function Tu(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}s.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var v=f.value?f.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!f.done}))&&(this.response=this.responseText+=v)}f.done?Yr(this):Xr(this),this.readyState==3&&Tu(this)}},s.Ra=function(f){this.g&&(this.response=this.responseText=f,Yr(this))},s.Qa=function(f){this.g&&(this.response=f,Yr(this))},s.ga=function(){this.g&&Yr(this)};function Yr(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Xr(f)}s.setRequestHeader=function(f,v){this.u.append(f,v)},s.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],v=this.h.entries();for(var _=v.next();!_.done;)_=_.value,f.push(_[0]+": "+_[1]),_=v.next();return f.join(`\r
`)};function Xr(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(_a.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Eu(f){let v="";return L(f,function(_,C){v+=C,v+=":",v+=_,v+=`\r
`}),v}function qn(f,v,_){e:{for(C in _){var C=!1;break e}C=!0}C||(_=Eu(_),typeof f=="string"?_!=null&&encodeURIComponent(String(_)):Dt(f,v,_))}function _t(f){pt.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(_t,pt);var Rl=/^https?$/i,No=["POST","PUT"];s=_t.prototype,s.Ha=function(f){this.J=f},s.ea=function(f,v,_,C){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);v=v?v.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ls.g(),this.v=this.o?Hr(this.o):Hr(Ls),this.g.onreadystatechange=b(this.Ea,this);try{this.B=!0,this.g.open(v,String(f),!0),this.B=!1}catch(le){Ch(this,le);return}if(f=_||"",_=new Map(this.headers),C)if(Object.getPrototypeOf(C)===Object.prototype)for(var Z in C)_.set(Z,C[Z]);else if(typeof C.keys=="function"&&typeof C.get=="function")for(const le of C.keys())_.set(le,C.get(le));else throw Error("Unknown input type for opt_headers: "+String(C));C=Array.from(_.keys()).find(le=>le.toLowerCase()=="content-type"),Z=h.FormData&&f instanceof h.FormData,!(0<=Array.prototype.indexOf.call(No,v,void 0))||C||Z||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[le,we]of _)this.g.setRequestHeader(le,we);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{To(this),this.u=!0,this.g.send(f),this.u=!1}catch(le){Ch(this,le)}};function Ch(f,v){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=v,f.m=5,Dl(f),Wr(f)}function Dl(f){f.A||(f.A=!0,ut(f,"complete"),ut(f,"error"))}s.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,ut(this,"complete"),ut(this,"abort"),Wr(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Wr(this,!0)),_t.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Pl(this):this.bb())},s.bb=function(){Pl(this)};function Pl(f){if(f.h&&typeof u<"u"&&(!f.v[1]||ur(f)!=4||f.Z()!=2)){if(f.u&&ur(f)==4)jn(f.Ea,0,f);else if(ut(f,"readystatechange"),ur(f)==4){f.h=!1;try{const we=f.Z();e:switch(we){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var _;if(!(_=v)){var C;if(C=we===0){var Z=String(f.D).match(yo)[1]||null;!Z&&h.self&&h.self.location&&(Z=h.self.location.protocol.slice(0,-1)),C=!Rl.test(Z?Z.toLowerCase():"")}_=C}if(_)ut(f,"complete"),ut(f,"success");else{f.m=6;try{var le=2<ur(f)?f.g.statusText:""}catch{le=""}f.l=le+" ["+f.Z()+"]",Dl(f)}}finally{Wr(f)}}}}function Wr(f,v){if(f.g){To(f);const _=f.g,C=f.v[0]?()=>{}:null;f.g=null,f.v=null,v||ut(f,"ready");try{_.onreadystatechange=C}catch{}}}function To(f){f.I&&(h.clearTimeout(f.I),f.I=null)}s.isActive=function(){return!!this.g};function ur(f){return f.g?f.g.readyState:0}s.Z=function(){try{return 2<ur(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(f){if(this.g){var v=this.g.responseText;return f&&v.indexOf(f)==0&&(v=v.substring(f.length)),zr(v)}};function Ih(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Fg(f){const v={};f=(f.g&&2<=ur(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let C=0;C<f.length;C++){if(B(f[C]))continue;var _=S(f[C]);const Z=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const le=v[Z]||[];v[Z]=le,le.push(_)}P(v,function(C){return C.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Eo(f,v,_){return _&&_.internalChannelParams&&_.internalChannelParams[f]||v}function Ml(f){this.Aa=0,this.i=[],this.j=new tn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Eo("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Eo("baseRetryDelayMs",5e3,f),this.cb=Eo("retryDelaySeedMs",1e4,f),this.Wa=Eo("forwardChannelMaxRetries",2,f),this.wa=Eo("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new ir(f&&f.concurrentRequestLimit),this.Da=new _o,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Ml.prototype,s.la=8,s.G=1,s.connect=function(f,v,_,C){Lt(0),this.W=f,this.H=v||{},_&&C!==void 0&&(this.H.OSID=_,this.H.OAID=C),this.F=this.X,this.I=Vh(this,null,this.W),Vl(this)};function Su(f){if(kh(f),f.G==3){var v=f.U++,_=Us(f.I);if(Dt(_,"SID",f.K),Dt(_,"RID",v),Dt(_,"TYPE","terminate"),So(f,_),v=new Un(f,f.j,v),v.L=2,v.v=vo(Us(_)),_=!1,h.navigator&&h.navigator.sendBeacon)try{_=h.navigator.sendBeacon(v.v.toString(),"")}catch{}!_&&h.Image&&(new Image().src=v.v,_=!0),_||(v.g=Lh(v.j,null),v.g.ea(v.v)),v.F=Date.now(),Ft(v)}Oh(f)}function Ol(f){f.g&&(jo(f),f.g.cancel(),f.g=null)}function kh(f){Ol(f),f.u&&(h.clearTimeout(f.u),f.u=null),Ll(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&h.clearTimeout(f.s),f.s=null)}function Vl(f){if(!jl(f.h)&&!f.s){f.s=!0;var v=f.Ga;ie||I(),$||(ie(),$=!0),ge.add(v,f),f.B=0}}function Ug(f,v){return Al(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=v.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=un(b(f.Ga,f,v),Cu(f,f.B)),f.B++,!0)}s.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const Z=new Un(this,this.j,f);let le=this.o;if(this.S&&(le?(le=T(le),F(le,this.S)):le=this.S),this.m!==null||this.O||(Z.H=le,le=null),this.P)e:{for(var v=0,_=0;_<this.i.length;_++){t:{var C=this.i[_];if("__data__"in C.map&&(C=C.map.__data__,typeof C=="string")){C=C.length;break t}C=void 0}if(C===void 0)break;if(v+=C,4096<v){v=_;break e}if(v===4096||_===this.i.length-1){v=_+1;break e}}v=1e3}else v=1e3;v=Rh(this,Z,v),_=Us(this.I),Dt(_,"RID",f),Dt(_,"CVER",22),this.D&&Dt(_,"X-HTTP-Session-Id",this.D),So(this,_),le&&(this.O?v="headers="+encodeURIComponent(String(Eu(le)))+"&"+v:this.m&&qn(_,this.m,le)),Cl(this.h,Z),this.Ua&&Dt(_,"TYPE","init"),this.P?(Dt(_,"$req",v),Dt(_,"SID","null"),Z.T=!0,xe(Z,_,null)):xe(Z,_,v),this.G=2}}else this.G==3&&(f?ju(this,f):this.i.length==0||jl(this.h)||ju(this))};function ju(f,v){var _;v?_=v.l:_=f.U++;const C=Us(f.I);Dt(C,"SID",f.K),Dt(C,"RID",_),Dt(C,"AID",f.T),So(f,C),f.m&&f.o&&qn(C,f.m,f.o),_=new Un(f,f.j,_,f.B+1),f.m===null&&(_.H=f.o),v&&(f.i=v.D.concat(f.i)),v=Rh(f,_,1e3),_.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),Cl(f.h,_),xe(_,C,v)}function So(f,v){f.H&&L(f.H,function(_,C){Dt(v,C,_)}),f.l&&bu({},function(_,C){Dt(v,C,_)})}function Rh(f,v,_){_=Math.min(f.i.length,_);var C=f.l?b(f.l.Na,f.l,f):null;e:{var Z=f.i;let le=-1;for(;;){const we=["count="+_];le==-1?0<_?(le=Z[0].g,we.push("ofs="+le)):le=0:we.push("ofs="+le);let dt=!0;for(let Cn=0;Cn<_;Cn++){let ht=Z[Cn].g;const zn=Z[Cn].map;if(ht-=le,0>ht)le=Math.max(0,Z[Cn].g-100),dt=!1;else try{Qr(zn,we,"req"+ht+"_")}catch{C&&C(zn)}}if(dt){C=we.join("&");break e}}}return f=f.i.splice(0,_),v.D=f,C}function Dh(f){if(!f.g&&!f.u){f.Y=1;var v=f.Fa;ie||I(),$||(ie(),$=!0),ge.add(v,f),f.v=0}}function Au(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=un(b(f.Fa,f),Cu(f,f.v)),f.v++,!0)}s.Fa=function(){if(this.u=null,Ph(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=un(b(this.ab,this),f)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Lt(10),Ol(this),Ph(this))};function jo(f){f.A!=null&&(h.clearTimeout(f.A),f.A=null)}function Ph(f){f.g=new Un(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var v=Us(f.qa);Dt(v,"RID","rpc"),Dt(v,"SID",f.K),Dt(v,"AID",f.T),Dt(v,"CI",f.F?"0":"1"),!f.F&&f.ja&&Dt(v,"TO",f.ja),Dt(v,"TYPE","xmlhttp"),So(f,v),f.m&&f.o&&qn(v,f.m,f.o),f.L&&(f.g.I=f.L);var _=f.g;f=f.ia,_.L=1,_.v=vo(Us(v)),_.m=null,_.P=!0,je(_,f)}s.Za=function(){this.C!=null&&(this.C=null,Ol(this),Au(this),Lt(19))};function Ll(f){f.C!=null&&(h.clearTimeout(f.C),f.C=null)}function Mh(f,v){var _=null;if(f.g==v){Ll(f),jo(f),f.g=null;var C=2}else if(xu(f.h,v))_=v.D,ys(f.h,v),C=1;else return;if(f.G!=0){if(v.o)if(C==1){_=v.m?v.m.length:0,v=Date.now()-v.F;var Z=f.B;C=ps(),ut(C,new cn(C,_)),Vl(f)}else Dh(f);else if(Z=v.s,Z==3||Z==0&&0<v.X||!(C==1&&Ug(f,v)||C==2&&Au(f)))switch(_&&0<_.length&&(v=f.h,v.i=v.i.concat(_)),Z){case 1:Na(f,5);break;case 4:Na(f,10);break;case 3:Na(f,6);break;default:Na(f,2)}}}function Cu(f,v){let _=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(_*=2),_*v}function Na(f,v){if(f.j.info("Error code "+v),v==2){var _=b(f.fb,f),C=f.Xa;const Z=!C;C=new vn(C||"//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||xo(C,"https"),vo(C),Z?wo(C.toString(),_):Ar(C.toString(),_)}else Lt(2);f.G=0,f.l&&f.l.sa(v),Oh(f),kh(f)}s.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function Oh(f){if(f.G=0,f.ka=[],f.l){const v=vu(f.h);(v.length!=0||f.i.length!=0)&&(U(f.ka,v),U(f.ka,f.i),f.h.i.length=0,R(f.i),f.i.length=0),f.l.ra()}}function Vh(f,v,_){var C=_ instanceof vn?Us(_):new vn(_);if(C.g!="")v&&(C.g=v+"."+C.g),ui(C,C.s);else{var Z=h.location;C=Z.protocol,v=v?v+"."+Z.hostname:Z.hostname,Z=+Z.port;var le=new vn(null);C&&xo(le,C),v&&(le.g=v),Z&&ui(le,Z),_&&(le.l=_),C=le}return _=f.D,v=f.ya,_&&v&&Dt(C,_,v),Dt(C,"VER",f.la),So(f,C),C}function Lh(f,v,_){if(v&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return v=f.Ca&&!f.pa?new _t(new di({eb:_})):new _t(f.pa),v.Ha(f.J),v}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Fh(){}s=Fh.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Fl(){}Fl.prototype.g=function(f,v){return new xs(f,v)};function xs(f,v){pt.call(this),this.g=new Ml(v),this.l=f,this.h=v&&v.messageUrlParams||null,f=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(f?f["X-WebChannel-Content-Type"]=v.messageContentType:f={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(f?f["X-WebChannel-Client-Profile"]=v.va:f={"X-WebChannel-Client-Profile":v.va}),this.g.S=f,(f=v&&v.Sb)&&!B(f)&&(this.g.m=f),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!B(v)&&(this.g.D=v,f=this.h,f!==null&&v in f&&(f=this.h,v in f&&delete f[v])),this.j=new Jr(this)}k(xs,pt),xs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},xs.prototype.close=function(){Su(this.g)},xs.prototype.o=function(f){var v=this.g;if(typeof f=="string"){var _={};_.__data__=f,f=_}else this.u&&(_={},_.__data__=Ln(f),f=_);v.i.push(new po(v.Ya++,f)),v.G==3&&Vl(v)},xs.prototype.N=function(){this.g.l=null,delete this.j,Su(this.g),delete this.g,xs.aa.N.call(this)};function Uh(f){gs.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var v=f.__sm__;if(v){e:{for(const _ in v){f=_;break e}f=void 0}(this.i=f)&&(f=this.i,v=v!==null&&f in v?v[f]:void 0),this.data=v}else this.data=f}k(Uh,gs);function Bh(){go.call(this),this.status=1}k(Bh,go);function Jr(f){this.g=f}k(Jr,Fh),Jr.prototype.ua=function(){ut(this.g,"a")},Jr.prototype.ta=function(f){ut(this.g,new Uh(f))},Jr.prototype.sa=function(f){ut(this.g,new Bh)},Jr.prototype.ra=function(){ut(this.g,"b")},Fl.prototype.createWebChannel=Fl.prototype.g,xs.prototype.send=xs.prototype.o,xs.prototype.open=xs.prototype.m,xs.prototype.close=xs.prototype.close,bS=function(){return new Fl},vS=function(){return ps()},xS=sr,px={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fn.NO_ERROR=0,Fn.TIMEOUT=8,Fn.HTTP_ERROR=6,im=Fn,ar.COMPLETE="complete",yS=ar,Gr.EventType=Er,Er.OPEN="a",Er.CLOSE="b",Er.ERROR="c",Er.MESSAGE="d",pt.prototype.listen=pt.prototype.K,Ad=Gr,_t.prototype.listenOnce=_t.prototype.L,_t.prototype.getLastError=_t.prototype.Ka,_t.prototype.getLastErrorCode=_t.prototype.Ba,_t.prototype.getStatus=_t.prototype.Z,_t.prototype.getResponseJson=_t.prototype.Oa,_t.prototype.getResponseText=_t.prototype.oa,_t.prototype.send=_t.prototype.ea,_t.prototype.setWithCredentials=_t.prototype.Ha,pS=_t}).apply(typeof Hf<"u"?Hf:typeof self<"u"?self:typeof window<"u"?window:{});const wN="@firebase/firestore",_N="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yn.UNAUTHENTICATED=new Yn(null),Yn.GOOGLE_CREDENTIALS=new Yn("google-credentials-uid"),Yn.FIRST_PARTY=new Yn("first-party-uid"),Yn.MOCK_USER=new Yn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iu="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi=new Zm("@firebase/firestore");function wc(){return Wi.logLevel}function hD(s){Wi.setLogLevel(s)}function pe(s,...e){if(Wi.logLevel<=lt.DEBUG){const t=e.map(dv);Wi.debug(`Firestore (${iu}): ${s}`,...t)}}function yn(s,...e){if(Wi.logLevel<=lt.ERROR){const t=e.map(dv);Wi.error(`Firestore (${iu}): ${s}`,...t)}}function Zs(s,...e){if(Wi.logLevel<=lt.WARN){const t=e.map(dv);Wi.warn(`Firestore (${iu}): ${s}`,...t)}}function dv(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(s,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,wS(s,n,t)}function wS(s,e,t){let n=`FIRESTORE (${iu}) INTERNAL ASSERTION FAILED: ${e} (ID: ${s.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw yn(n),new Error(n)}function De(s,e,t,n){let a="Unexpected state";typeof t=="string"?a=t:n=t,s||wS(e,a,n)}function fD(s,e){s||Se(57014,e)}function Ne(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends Nr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class NS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Yn.UNAUTHENTICATED)))}shutdown(){}}class mD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class gD{constructor(e){this.t=e,this.currentUser=Yn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){De(this.o===void 0,42304);let n=this.i;const a=m=>this.i!==n?(n=this.i,t(m)):Promise.resolve();let l=new Xn;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Xn,e.enqueueRetryable((()=>a(this.currentUser)))};const u=()=>{const m=l;e.enqueueRetryable((async()=>{await m.promise,await a(this.currentUser)}))},h=m=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((m=>h(m))),setTimeout((()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?h(m):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Xn)}}),0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(De(typeof n.accessToken=="string",31837,{l:n}),new _S(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return De(e===null||typeof e=="string",2055,{h:e}),new Yn(e)}}class pD{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Yn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class yD{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new pD(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Yn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class yx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class xD{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Xs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){De(this.o===void 0,3512);const n=l=>{l.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.m;return this.m=l.token,pe("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>n(l)))};const a=l=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>a(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new yx(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(De(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new yx(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class vD{getToken(){return Promise.resolve(new yx(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const a=bD(40);for(let l=0;l<a.length;++l)n.length<20&&a[l]<t&&(n+=e.charAt(a[l]%62))}return n}}function qe(s,e){return s<e?-1:s>e?1:0}function xx(s,e){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++){const a=s.charAt(n),l=e.charAt(n);if(a!==l)return Hy(a)===Hy(l)?qe(a,l):Hy(a)?1:-1}return qe(s.length,e.length)}const wD=55296,_D=57343;function Hy(s){const e=s.charCodeAt(0);return e>=wD&&e<=_D}function Dc(s,e,t){return s.length===e.length&&s.every(((n,a)=>t(n,e[a])))}function TS(s){return s+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx="__name__";class aa{constructor(e,t,n){t===void 0?t=0:t>e.length&&Se(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Se(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return aa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof aa?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const l=aa.compareSegments(e.get(a),t.get(a));if(l!==0)return l}return qe(e.length,t.length)}static compareSegments(e,t){const n=aa.isNumericId(e),a=aa.isNumericId(t);return n&&!a?-1:!n&&a?1:n&&a?aa.extractNumericId(e).compare(aa.extractNumericId(t)):xx(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Qi.fromString(e.substring(4,e.length-2))}}class tt extends aa{construct(e,t,n){return new tt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new he(re.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((a=>a.length>0)))}return new tt(t)}static emptyPath(){return new tt([])}}const ND=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ht extends aa{construct(e,t,n){return new Ht(e,t,n)}static isValidIdentifier(e){return ND.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ht.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===vx}static keyField(){return new Ht([vx])}static fromServerFormat(e){const t=[];let n="",a=0;const l=()=>{if(n.length===0)throw new he(re.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let u=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new he(re.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[a+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new he(re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=m,a+=2}else h==="`"?(u=!u,a++):h!=="."||u?(n+=h,a++):(l(),a++)}if(l(),u)throw new he(re.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ht(t)}static emptyPath(){return new Ht([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.path=e}static fromPath(e){return new _e(tt.fromString(e))}static fromName(e){return new _e(tt.fromString(e).popFirst(5))}static empty(){return new _e(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return tt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _e(new tt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hv(s,e,t){if(!t)throw new he(re.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function ES(s,e,t,n){if(e===!0&&n===!0)throw new he(re.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function NN(s){if(!_e.isDocumentKey(s))throw new he(re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function TN(s){if(_e.isDocumentKey(s))throw new he(re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function SS(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}function ag(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":Se(12329,{type:typeof s})}function nt(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new he(re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ag(s);throw new he(re.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}function jS(s,e){if(e<=0)throw new he(re.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(s,e){const t={typeString:s};return e&&(t.value=e),t}function bl(s,e){if(!SS(s))throw new he(re.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const a=e[n].typeString,l="value"in e[n]?{value:e[n].value}:void 0;if(!(n in s)){t=`JSON missing required field: '${n}'`;break}const u=s[n];if(a&&typeof u!==a){t=`JSON field '${n}' must be a ${a}.`;break}if(l!==void 0&&u!==l.value){t=`Expected '${n}' field to equal '${l.value}'`;break}}if(t)throw new he(re.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN=-62135596800,SN=1e6;class Nt{static now(){return Nt.fromMillis(Date.now())}static fromDate(e){return Nt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*SN);return new Nt(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<EN)throw new he(re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/SN}_compareTo(e){return this.seconds===e.seconds?qe(this.nanoseconds,e.nanoseconds):qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Nt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(bl(e,Nt._jsonSchema))return new Nt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-EN;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Nt._jsonSchemaVersion="firestore/timestamp/1.0",Nt._jsonSchema={type:En("string",Nt._jsonSchemaVersion),seconds:En("number"),nanoseconds:En("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{static fromTimestamp(e){return new Oe(e)}static min(){return new Oe(new Nt(0,0))}static max(){return new Oe(new Nt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pc=-1;class Mc{constructor(e,t,n,a){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=a}}function bx(s){return s.fields.find((e=>e.kind===2))}function $o(s){return s.fields.filter((e=>e.kind!==2))}function TD(s,e){let t=qe(s.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let n=0;n<Math.min(s.fields.length,e.fields.length);++n)if(t=ED(s.fields[n],e.fields[n]),t!==0)return t;return qe(s.fields.length,e.fields.length)}Mc.UNKNOWN_ID=-1;class tl{constructor(e,t){this.fieldPath=e,this.kind=t}}function ED(s,e){const t=Ht.comparator(s.fieldPath,e.fieldPath);return t!==0?t:qe(s.kind,e.kind)}class Oc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Oc(0,er.min())}}function AS(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,a=Oe.fromTimestamp(n===1e9?new Nt(t+1,0):new Nt(t,n));return new er(a,_e.empty(),e)}function CS(s){return new er(s.readTime,s.key,Pc)}class er{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new er(Oe.min(),_e.empty(),Pc)}static max(){return new er(Oe.max(),_e.empty(),Pc)}}function fv(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=_e.comparator(s.documentKey,e.documentKey),t!==0?t:qe(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ao(s){if(s.code!==re.FAILED_PRECONDITION||s.message!==IS)throw s;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Se(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new J(((n,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(n,a)},this.catchCallback=l=>{this.wrapFailure(t,l).next(n,a)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof J?t:J.resolve(t)}catch(t){return J.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):J.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):J.reject(t)}static resolve(e){return new J(((t,n)=>{t(e)}))}static reject(e){return new J(((t,n)=>{n(e)}))}static waitFor(e){return new J(((t,n)=>{let a=0,l=0,u=!1;e.forEach((h=>{++a,h.next((()=>{++l,u&&l===a&&t()}),(m=>n(m)))})),u=!0,l===a&&t()}))}static or(e){let t=J.resolve(!1);for(const n of e)t=t.next((a=>a?J.resolve(a):n()));return t}static forEach(e,t){const n=[];return e.forEach(((a,l)=>{n.push(t.call(this,a,l))})),this.waitFor(n)}static mapArray(e,t){return new J(((n,a)=>{const l=e.length,u=new Array(l);let h=0;for(let m=0;m<l;m++){const p=m;t(e[p]).next((x=>{u[p]=x,++h,h===l&&n(u)}),(x=>a(x)))}}))}static doWhile(e,t){return new J(((n,a)=>{const l=()=>{e()===!0?t().next((()=>{l()}),a):n()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs="SimpleDb";class ig{static open(e,t,n,a){try{return new ig(t,e.transaction(a,n))}catch(l){throw new Od(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Xn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Od(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const a=mv(n.target.error);this.S.reject(new Od(e,a))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(pe(Qs,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new jD(t)}}class fa{static delete(e){return pe(Qs,"Removing database:",e),Qo(vE().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Zx())return!1;if(fa.F())return!0;const e=Pn(),t=fa.M(e),n=0<t&&t<10,a=RS(e),l=0<a&&a<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||l)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,fa.M(Pn())===12.2&&yn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(pe(Qs,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const a=indexedDB.open(this.name,this.version);a.onsuccess=l=>{const u=l.target.result;t(u)},a.onblocked=()=>{n(new Od(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=l=>{const u=l.target.error;u.name==="VersionError"?n(new he(re.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):u.name==="InvalidStateError"?n(new he(re.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u)):n(new Od(e,u))},a.onupgradeneeded=l=>{pe(Qs,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const u=l.target.result;this.N.k(u,a.transaction,l.oldVersion,this.version).next((()=>{pe(Qs,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,a){const l=t==="readonly";let u=0;for(;;){++u;try{this.db=await this.L(e);const h=ig.open(this.db,e,l?"readonly":"readwrite",n),m=a(h).next((p=>(h.C(),p))).catch((p=>(h.abort(p),J.reject(p)))).toPromise();return m.catch((()=>{})),await h.D,m}catch(h){const m=h,p=m.name!=="FirebaseError"&&u<3;if(pe(Qs,"Transaction failed with error:",m.message,"Retrying:",p),this.close(),!p)return Promise.reject(m)}}}close(){this.db&&this.db.close(),this.db=void 0}}function RS(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class SD{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Qo(this.U.delete())}}class Od extends he{constructor(e,t){super(re.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function io(s){return s.name==="IndexedDbTransactionError"}class jD{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(pe(Qs,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(pe(Qs,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Qo(n)}add(e){return pe(Qs,"ADD",this.store.name,e,e),Qo(this.store.add(e))}get(e){return Qo(this.store.get(e)).next((t=>(t===void 0&&(t=null),pe(Qs,"GET",this.store.name,e,t),t)))}delete(e){return pe(Qs,"DELETE",this.store.name,e),Qo(this.store.delete(e))}count(){return pe(Qs,"COUNT",this.store.name),Qo(this.store.count())}J(e,t){const n=this.options(e,t),a=n.index?this.store.index(n.index):this.store;if(typeof a.getAll=="function"){const l=a.getAll(n.range);return new J(((u,h)=>{l.onerror=m=>{h(m.target.error)},l.onsuccess=m=>{u(m.target.result)}}))}{const l=this.cursor(n),u=[];return this.H(l,((h,m)=>{u.push(m)})).next((()=>u))}}Y(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new J(((a,l)=>{n.onerror=u=>{l(u.target.error)},n.onsuccess=u=>{a(u.target.result)}}))}Z(e,t){pe(Qs,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const a=this.cursor(n);return this.H(a,((l,u,h)=>h.delete()))}ee(e,t){let n;t?n=e:(n={},t=e);const a=this.cursor(n);return this.H(a,t)}te(e){const t=this.cursor({});return new J(((n,a)=>{t.onerror=l=>{const u=mv(l.target.error);a(u)},t.onsuccess=l=>{const u=l.target.result;u?e(u.primaryKey,u.value).next((h=>{h?u.continue():n()})):n()}}))}H(e,t){const n=[];return new J(((a,l)=>{e.onerror=u=>{l(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void a();const m=new SD(h),p=t(h.primaryKey,h.value,m);if(p instanceof J){const x=p.catch((w=>(m.done(),J.reject(w))));n.push(x)}m.isDone?a():m.G===null?h.continue():h.continue(m.G)}})).next((()=>J.waitFor(n)))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Qo(s){return new J(((e,t)=>{s.onsuccess=n=>{const a=n.target.result;e(a)},s.onerror=n=>{const a=mv(n.target.error);t(a)}}))}let jN=!1;function mv(s){const e=fa.M(Pn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(s.message.indexOf(t)>=0){const n=new he("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return jN||(jN=!0,setTimeout((()=>{throw n}),0)),n}}return s}const Vd="IndexBackfiller";class AD{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){pe(Vd,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();pe(Vd,`Documents written: ${t}`)}catch(t){io(t)?pe(Vd,"Ignoring IndexedDB error during index backfill: ",t):await ao(t)}await this.re(6e4)}))}}class CD{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const n=new Set;let a=t,l=!0;return J.doWhile((()=>l===!0&&a>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((u=>{if(u!==null&&!n.has(u))return pe(Vd,`Processing collection: ${u}`),this.oe(e,u,a).next((h=>{a-=h,n.add(u)}));l=!1})))).next((()=>t-a))}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((a=>this.localStore.localDocuments.getNextDocuments(e,t,a,n).next((l=>{const u=l.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next((()=>this._e(a,l))).next((h=>(pe(Vd,`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h)))).next((()=>u.size))}))))}_e(e,t){let n=e;return t.changes.forEach(((a,l)=>{const u=CS(l);fv(u,n)>0&&(n=u)})),new er(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Cs.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yi=-1;function fh(s){return s==null}function Yd(s){return s===0&&1/s==-1/0}function DS(s){return typeof s=="number"&&Number.isInteger(s)&&!Yd(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cm="";function fs(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=AN(e)),e=ID(s.get(t),e);return AN(e)}function ID(s,e){let t=e;const n=s.length;for(let a=0;a<n;a++){const l=s.charAt(a);switch(l){case"\0":t+="";break;case Cm:t+="";break;default:t+=l}}return t}function AN(s){return s+Cm+""}function ua(s){const e=s.length;if(De(e>=2,64408,{path:s}),e===2)return De(s.charAt(0)===Cm&&s.charAt(1)==="",56145,{path:s}),tt.emptyPath();const t=e-2,n=[];let a="";for(let l=0;l<e;){const u=s.indexOf(Cm,l);switch((u<0||u>t)&&Se(50515,{path:s}),s.charAt(u+1)){case"":const h=s.substring(l,u);let m;a.length===0?m=h:(a+=h,m=a,a=""),n.push(m);break;case"":a+=s.substring(l,u),a+="\0";break;case"":a+=s.substring(l,u+1);break;default:Se(61167,{path:s})}l=u+2}return new tt(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ko="remoteDocuments",mh="owner",mc="owner",Xd="mutationQueues",kD="userId",Pr="mutations",CN="batchId",Zo="userMutationsIndex",IN=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(s,e){return[s,fs(e)]}function PS(s,e,t){return[s,fs(e),t]}const RD={},Vc="documentMutations",Im="remoteDocumentsV14",DD=["prefixPath","collectionGroup","readTime","documentId"],lm="documentKeyIndex",PD=["prefixPath","collectionGroup","documentId"],MS="collectionGroupIndex",MD=["collectionGroup","readTime","prefixPath","documentId"],Wd="remoteDocumentGlobal",wx="remoteDocumentGlobalKey",Lc="targets",OS="queryTargetsIndex",OD=["canonicalId","targetId"],Fc="targetDocuments",VD=["targetId","path"],gv="documentTargetsIndex",LD=["path","targetId"],km="targetGlobalKey",nl="targetGlobal",Jd="collectionParents",FD=["collectionId","parent"],Uc="clientMetadata",UD="clientId",og="bundles",BD="bundleId",lg="namedQueries",qD="name",pv="indexConfiguration",zD="indexId",_x="collectionGroupIndex",HD="collectionGroup",Ld="indexState",GD=["indexId","uid"],VS="sequenceNumberIndex",$D=["uid","sequenceNumber"],Fd="indexEntries",KD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],LS="documentKeyIndex",QD=["indexId","uid","orderedDocumentKey"],cg="documentOverlays",YD=["userId","collectionPath","documentId"],Nx="collectionPathOverlayIndex",XD=["userId","collectionPath","largestBatchId"],FS="collectionGroupOverlayIndex",WD=["userId","collectionGroup","largestBatchId"],yv="globals",JD="name",US=[Xd,Pr,Vc,Ko,Lc,mh,nl,Fc,Uc,Wd,Jd,og,lg],ZD=[...US,cg],BS=[Xd,Pr,Vc,Im,Lc,mh,nl,Fc,Uc,Wd,Jd,og,lg,cg],qS=BS,xv=[...qS,pv,Ld,Fd],e4=xv,zS=[...xv,yv],t4=zS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx extends kS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function On(s,e){const t=Ne(s);return fa.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kN(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function oo(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function HS(s,e){const t=[];for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.push(e(s[n],n,s));return t}function GS(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e,t){this.comparator=e,this.root=t||ss.EMPTY}insert(e,t){return new qt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ss.BLACK,null,null))}remove(e){return new qt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ss.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gf(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gf(this.root,e,this.comparator,!0)}}class Gf{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?n(e.key,t):1,t&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ss{constructor(e,t,n,a,l){this.key=e,this.value=t,this.color=n??ss.RED,this.left=a??ss.EMPTY,this.right=l??ss.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,l){return new ss(e??this.key,t??this.value,n??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const l=n(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,t,n),null):l===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return ss.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return ss.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ss.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ss.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Se(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Se(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Se(27949);return e+(this.isRed()?0:1)}}ss.EMPTY=null,ss.RED=!0,ss.BLACK=!1;ss.EMPTY=new class{constructor(){this.size=0}get key(){throw Se(57766)}get value(){throw Se(16141)}get color(){throw Se(16727)}get left(){throw Se(29726)}get right(){throw Se(36894)}copy(e,t,n,a,l){return this}insert(e,t,n){return new ss(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.comparator=e,this.data=new qt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new RN(this.data.getIterator())}getIteratorFrom(e){return new RN(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof kt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=n.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new kt(this.comparator);return t.data=e,t}}class RN{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gc(s){return s.hasNext()?s.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this.fields=e,e.sort(Ht.comparator)}static empty(){return new Is([])}unionWith(e){let t=new kt(Ht.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Is(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Dc(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $S extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new $S("Invalid base64 string: "+l):l}})(e);return new ln(t)}static fromUint8Array(e){const t=(function(a){let l="";for(let u=0;u<a.length;++u)l+=String.fromCharCode(a[u]);return l})(e);return new ln(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ln.EMPTY_BYTE_STRING=new ln("");const s4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ja(s){if(De(!!s,39018),typeof s=="string"){let e=0;const t=s4.exec(s);if(De(!!t,46558,{timestamp:s}),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Xt(s.seconds),nanos:Xt(s.nanos)}}function Xt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Za(s){return typeof s=="string"?ln.fromBase64String(s):ln.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KS="server_timestamp",QS="__type__",YS="__previous_value__",XS="__local_write_time__";function ug(s){return(s?.mapValue?.fields||{})[QS]?.stringValue===KS}function dg(s){const e=s.mapValue.fields[YS];return ug(e)?dg(e):e}function Zd(s){const e=Ja(s.mapValue.fields[XS].timestampValue);return new Nt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e,t,n,a,l,u,h,m,p,x){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=m,this.useFetchStreams=p,this.isUsingEmulator=x}}const eh="(default)";class Ji{constructor(e,t){this.projectId=e,this.database=t||eh}static empty(){return new Ji("","")}get isDefaultDatabase(){return this.database===eh}isEqual(e){return e instanceof Ji&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv="__type__",WS="__max__",zi={mapValue:{fields:{__type__:{stringValue:WS}}}},bv="__vector__",Bc="value",cm={nullValue:"NULL_VALUE"};function Zi(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?ug(s)?4:JS(s)?9007199254740991:hg(s)?10:11:Se(28295,{value:s})}function pa(s,e){if(s===e)return!0;const t=Zi(s);if(t!==Zi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return Zd(s).isEqual(Zd(e));case 3:return(function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const u=Ja(a.timestampValue),h=Ja(l.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(s,e);case 5:return s.stringValue===e.stringValue;case 6:return(function(a,l){return Za(a.bytesValue).isEqual(Za(l.bytesValue))})(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return(function(a,l){return Xt(a.geoPointValue.latitude)===Xt(l.geoPointValue.latitude)&&Xt(a.geoPointValue.longitude)===Xt(l.geoPointValue.longitude)})(s,e);case 2:return(function(a,l){if("integerValue"in a&&"integerValue"in l)return Xt(a.integerValue)===Xt(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const u=Xt(a.doubleValue),h=Xt(l.doubleValue);return u===h?Yd(u)===Yd(h):isNaN(u)&&isNaN(h)}return!1})(s,e);case 9:return Dc(s.arrayValue.values||[],e.arrayValue.values||[],pa);case 10:case 11:return(function(a,l){const u=a.mapValue.fields||{},h=l.mapValue.fields||{};if(kN(u)!==kN(h))return!1;for(const m in u)if(u.hasOwnProperty(m)&&(h[m]===void 0||!pa(u[m],h[m])))return!1;return!0})(s,e);default:return Se(52216,{left:s})}}function th(s,e){return(s.values||[]).find((t=>pa(t,e)))!==void 0}function eo(s,e){if(s===e)return 0;const t=Zi(s),n=Zi(e);if(t!==n)return qe(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return qe(s.booleanValue,e.booleanValue);case 2:return(function(l,u){const h=Xt(l.integerValue||l.doubleValue),m=Xt(u.integerValue||u.doubleValue);return h<m?-1:h>m?1:h===m?0:isNaN(h)?isNaN(m)?0:-1:1})(s,e);case 3:return DN(s.timestampValue,e.timestampValue);case 4:return DN(Zd(s),Zd(e));case 5:return xx(s.stringValue,e.stringValue);case 6:return(function(l,u){const h=Za(l),m=Za(u);return h.compareTo(m)})(s.bytesValue,e.bytesValue);case 7:return(function(l,u){const h=l.split("/"),m=u.split("/");for(let p=0;p<h.length&&p<m.length;p++){const x=qe(h[p],m[p]);if(x!==0)return x}return qe(h.length,m.length)})(s.referenceValue,e.referenceValue);case 8:return(function(l,u){const h=qe(Xt(l.latitude),Xt(u.latitude));return h!==0?h:qe(Xt(l.longitude),Xt(u.longitude))})(s.geoPointValue,e.geoPointValue);case 9:return PN(s.arrayValue,e.arrayValue);case 10:return(function(l,u){const h=l.fields||{},m=u.fields||{},p=h[Bc]?.arrayValue,x=m[Bc]?.arrayValue,w=qe(p?.values?.length||0,x?.values?.length||0);return w!==0?w:PN(p,x)})(s.mapValue,e.mapValue);case 11:return(function(l,u){if(l===zi.mapValue&&u===zi.mapValue)return 0;if(l===zi.mapValue)return 1;if(u===zi.mapValue)return-1;const h=l.fields||{},m=Object.keys(h),p=u.fields||{},x=Object.keys(p);m.sort(),x.sort();for(let w=0;w<m.length&&w<x.length;++w){const b=xx(m[w],x[w]);if(b!==0)return b;const E=eo(h[m[w]],p[x[w]]);if(E!==0)return E}return qe(m.length,x.length)})(s.mapValue,e.mapValue);default:throw Se(23264,{he:t})}}function DN(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return qe(s,e);const t=Ja(s),n=Ja(e),a=qe(t.seconds,n.seconds);return a!==0?a:qe(t.nanos,n.nanos)}function PN(s,e){const t=s.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const l=eo(t[a],n[a]);if(l)return l}return qe(t.length,n.length)}function qc(s){return Ex(s)}function Ex(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?(function(t){const n=Ja(t);return`time(${n.seconds},${n.nanos})`})(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?(function(t){return Za(t).toBase64()})(s.bytesValue):"referenceValue"in s?(function(t){return _e.fromName(t).toString()})(s.referenceValue):"geoPointValue"in s?(function(t){return`geo(${t.latitude},${t.longitude})`})(s.geoPointValue):"arrayValue"in s?(function(t){let n="[",a=!0;for(const l of t.values||[])a?a=!1:n+=",",n+=Ex(l);return n+"]"})(s.arrayValue):"mapValue"in s?(function(t){const n=Object.keys(t.fields||{}).sort();let a="{",l=!0;for(const u of n)l?l=!1:a+=",",a+=`${u}:${Ex(t.fields[u])}`;return a+"}"})(s.mapValue):Se(61005,{value:s})}function um(s){switch(Zi(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=dg(s);return e?16+um(e):16;case 5:return 2*s.stringValue.length;case 6:return Za(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((a,l)=>a+um(l)),0)})(s.arrayValue);case 10:case 11:return(function(n){let a=0;return oo(n.fields,((l,u)=>{a+=l.length+um(u)})),a})(s.mapValue);default:throw Se(13486,{value:s})}}function ll(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function Sx(s){return!!s&&"integerValue"in s}function nh(s){return!!s&&"arrayValue"in s}function MN(s){return!!s&&"nullValue"in s}function ON(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function dm(s){return!!s&&"mapValue"in s}function hg(s){return(s?.mapValue?.fields||{})[vv]?.stringValue===bv}function Ud(s){if(s.geoPointValue)return{geoPointValue:{...s.geoPointValue}};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:{...s.timestampValue}};if(s.mapValue){const e={mapValue:{fields:{}}};return oo(s.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ud(n))),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ud(s.arrayValue.values[t]);return e}return{...s}}function JS(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===WS}const ZS={mapValue:{fields:{[vv]:{stringValue:bv},[Bc]:{arrayValue:{}}}}};function a4(s){return"nullValue"in s?cm:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?ll(Ji.empty(),_e.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?hg(s)?ZS:{mapValue:{}}:Se(35942,{value:s})}function i4(s){return"nullValue"in s?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?ll(Ji.empty(),_e.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?ZS:"mapValue"in s?hg(s)?{mapValue:{}}:zi:Se(61959,{value:s})}function VN(s,e){const t=eo(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?-1:!s.inclusive&&e.inclusive?1:0}function LN(s,e){const t=eo(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?1:!s.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this.value=e}static empty(){return new as({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!dm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ud(t)}setAll(e){let t=Ht.emptyPath(),n={},a=[];e.forEach(((u,h)=>{if(!t.isImmediateParentOf(h)){const m=this.getFieldsMap(t);this.applyChanges(m,n,a),n={},a=[],t=h.popLast()}u?n[h.lastSegment()]=Ud(u):a.push(h.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,n,a)}delete(e){const t=this.field(e.popLast());dm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pa(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];dm(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){oo(t,((a,l)=>e[a]=l));for(const a of n)delete e[a]}clone(){return new as(Ud(this.value))}}function ej(s){const e=[];return oo(s.fields,((t,n)=>{const a=new Ht([t]);if(dm(n)){const l=ej(n.mapValue).fields;if(l.length===0)e.push(a);else for(const u of l)e.push(a.child(u))}else e.push(a)})),new Is(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e,t,n,a,l,u,h){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=l,this.data=u,this.documentState=h}static newInvalidDocument(e){return new zt(e,0,Oe.min(),Oe.min(),Oe.min(),as.empty(),0)}static newFoundDocument(e,t,n,a){return new zt(e,1,t,Oe.min(),n,a,0)}static newNoDocument(e,t){return new zt(e,2,t,Oe.min(),Oe.min(),as.empty(),0)}static newUnknownDocument(e,t){return new zt(e,3,t,Oe.min(),Oe.min(),as.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Oe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=as.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=as.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Oe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof zt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new zt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e,t){this.position=e,this.inclusive=t}}function FN(s,e,t){let n=0;for(let a=0;a<s.position.length;a++){const l=e[a],u=s.position[a];if(l.field.isKeyField()?n=_e.comparator(_e.fromName(u.referenceValue),t.key):n=eo(u,t.data.field(l.field)),l.dir==="desc"&&(n*=-1),n!==0)break}return n}function UN(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!pa(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(e,t="asc"){this.field=e,this.dir=t}}function o4(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{}class ct extends tj{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new l4(e,t,n):t==="array-contains"?new d4(e,n):t==="in"?new oj(e,n):t==="not-in"?new h4(e,n):t==="array-contains-any"?new f4(e,n):new ct(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new c4(e,n):new u4(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(eo(t,this.value)):t!==null&&Zi(this.value)===Zi(t)&&this.matchesComparison(eo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Se(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ct extends tj{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ct(e,t)}matches(e){return zc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function zc(s){return s.op==="and"}function jx(s){return s.op==="or"}function wv(s){return nj(s)&&zc(s)}function nj(s){for(const e of s.filters)if(e instanceof Ct)return!1;return!0}function Ax(s){if(s instanceof ct)return s.field.canonicalString()+s.op.toString()+qc(s.value);if(wv(s))return s.filters.map((e=>Ax(e))).join(",");{const e=s.filters.map((t=>Ax(t))).join(",");return`${s.op}(${e})`}}function sj(s,e){return s instanceof ct?(function(n,a){return a instanceof ct&&n.op===a.op&&n.field.isEqual(a.field)&&pa(n.value,a.value)})(s,e):s instanceof Ct?(function(n,a){return a instanceof Ct&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce(((l,u,h)=>l&&sj(u,a.filters[h])),!0):!1})(s,e):void Se(19439)}function rj(s,e){const t=s.filters.concat(e);return Ct.create(t,s.op)}function aj(s){return s instanceof ct?(function(t){return`${t.field.canonicalString()} ${t.op} ${qc(t.value)}`})(s):s instanceof Ct?(function(t){return t.op.toString()+" {"+t.getFilters().map(aj).join(" ,")+"}"})(s):"Filter"}class l4 extends ct{constructor(e,t,n){super(e,t,n),this.key=_e.fromName(n.referenceValue)}matches(e){const t=_e.comparator(e.key,this.key);return this.matchesComparison(t)}}class c4 extends ct{constructor(e,t){super(e,"in",t),this.keys=ij("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class u4 extends ct{constructor(e,t){super(e,"not-in",t),this.keys=ij("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function ij(s,e){return(e.arrayValue?.values||[]).map((t=>_e.fromName(t.referenceValue)))}class d4 extends ct{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return nh(t)&&th(t.arrayValue,this.value)}}class oj extends ct{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&th(this.value.arrayValue,t)}}class h4 extends ct{constructor(e,t){super(e,"not-in",t)}matches(e){if(th(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!th(this.value.arrayValue,t)}}class f4 extends ct{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!nh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>th(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e,t=null,n=[],a=[],l=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=l,this.startAt=u,this.endAt=h,this.Te=null}}function Cx(s,e=null,t=[],n=[],a=null,l=null,u=null){return new m4(s,e,t,n,a,l,u)}function cl(s){const e=Ne(s);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>Ax(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(l){return l.field.canonicalString()+l.dir})(n))).join(","),fh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>qc(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>qc(n))).join(",")),e.Te=t}return e.Te}function gh(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!o4(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!sj(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!UN(s.startAt,e.startAt)&&UN(s.endAt,e.endAt)}function Rm(s){return _e.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}function Dm(s,e){return s.filters.filter((t=>t instanceof ct&&t.field.isEqual(e)))}function BN(s,e,t){let n=cm,a=!0;for(const l of Dm(s,e)){let u=cm,h=!0;switch(l.op){case"<":case"<=":u=a4(l.value);break;case"==":case"in":case">=":u=l.value;break;case">":u=l.value,h=!1;break;case"!=":case"not-in":u=cm}VN({value:n,inclusive:a},{value:u,inclusive:h})<0&&(n=u,a=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];VN({value:n,inclusive:a},{value:u,inclusive:t.inclusive})<0&&(n=u,a=t.inclusive);break}}return{value:n,inclusive:a}}function qN(s,e,t){let n=zi,a=!0;for(const l of Dm(s,e)){let u=zi,h=!0;switch(l.op){case">=":case">":u=i4(l.value),h=!1;break;case"==":case"in":case"<=":u=l.value;break;case"<":u=l.value,h=!1;break;case"!=":case"not-in":u=zi}LN({value:n,inclusive:a},{value:u,inclusive:h})>0&&(n=u,a=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];LN({value:n,inclusive:a},{value:u,inclusive:t.inclusive})>0&&(n=u,a=t.inclusive);break}}return{value:n,inclusive:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e,t=null,n=[],a=[],l=null,u="F",h=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=l,this.limitType=u,this.startAt=h,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function lj(s,e,t,n,a,l,u,h){return new ni(s,e,t,n,a,l,u,h)}function ou(s){return new ni(s)}function zN(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function _v(s){return s.collectionGroup!==null}function Cc(s){const e=Ne(s);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new kt(Ht.comparator);return u.filters.forEach((m=>{m.getFlattenedFilters().forEach((p=>{p.isInequality()&&(h=h.add(p.field))}))})),h})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new sh(l,n))})),t.has(Ht.keyField().canonicalString())||e.Ie.push(new sh(Ht.keyField(),n))}return e.Ie}function ms(s){const e=Ne(s);return e.Ee||(e.Ee=uj(e,Cc(s))),e.Ee}function cj(s){const e=Ne(s);return e.de||(e.de=uj(e,s.explicitOrderBy)),e.de}function uj(s,e){if(s.limitType==="F")return Cx(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map((a=>{const l=a.dir==="desc"?"asc":"desc";return new sh(a.field,l)}));const t=s.endAt?new to(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new to(s.startAt.position,s.startAt.inclusive):null;return Cx(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Ix(s,e){const t=s.filters.concat([e]);return new ni(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function Pm(s,e,t){return new ni(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function ph(s,e){return gh(ms(s),ms(e))&&s.limitType===e.limitType}function dj(s){return`${cl(ms(s))}|lt:${s.limitType}`}function _c(s){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((a=>aj(a))).join(", ")}]`),fh(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((a=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(a))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((a=>qc(a))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((a=>qc(a))).join(",")),`Target(${n})`})(ms(s))}; limitType=${s.limitType})`}function yh(s,e){return e.isFoundDocument()&&(function(n,a){const l=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(l):_e.isDocumentKey(n.path)?n.path.isEqual(l):n.path.isImmediateParentOf(l)})(s,e)&&(function(n,a){for(const l of Cc(n))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0})(s,e)&&(function(n,a){for(const l of n.filters)if(!l.matches(a))return!1;return!0})(s,e)&&(function(n,a){return!(n.startAt&&!(function(u,h,m){const p=FN(u,h,m);return u.inclusive?p<=0:p<0})(n.startAt,Cc(n),a)||n.endAt&&!(function(u,h,m){const p=FN(u,h,m);return u.inclusive?p>=0:p>0})(n.endAt,Cc(n),a))})(s,e)}function hj(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function fj(s){return(e,t)=>{let n=!1;for(const a of Cc(s)){const l=g4(a,e,t);if(l!==0)return l;n=n||a.field.isKeyField()}return 0}}function g4(s,e,t){const n=s.field.isKeyField()?_e.comparator(e.key,t.key):(function(l,u,h){const m=u.data.field(l),p=h.data.field(l);return m!==null&&p!==null?eo(m,p):Se(42886)})(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return Se(19790,{direction:s.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,l]of n)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){oo(this.inner,((t,n)=>{for(const[a,l]of n)e(a,l)}))}isEmpty(){return GS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p4=new qt(_e.comparator);function ks(){return p4}const mj=new qt(_e.comparator);function Cd(...s){let e=mj;for(const t of s)e=e.insert(t.key,t);return e}function gj(s){let e=mj;return s.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function da(){return Bd()}function pj(){return Bd()}function Bd(){return new si((s=>s.toString()),((s,e)=>s.isEqual(e)))}const y4=new qt(_e.comparator),x4=new kt(_e.comparator);function Xe(...s){let e=x4;for(const t of s)e=e.add(t);return e}const v4=new kt(qe);function Nv(){return v4}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tv(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yd(e)?"-0":e}}function yj(s){return{integerValue:""+s}}function xj(s,e){return DS(e)?yj(e):Tv(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(){this._=void 0}}function b4(s,e,t){return s instanceof Hc?(function(a,l){const u={fields:{[QS]:{stringValue:KS},[XS]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&ug(l)&&(l=dg(l)),l&&(u.fields[YS]=l),{mapValue:u}})(t,e):s instanceof ul?bj(s,e):s instanceof dl?wj(s,e):(function(a,l){const u=vj(a,l),h=HN(u)+HN(a.Ae);return Sx(u)&&Sx(a.Ae)?yj(h):Tv(a.serializer,h)})(s,e)}function w4(s,e,t){return s instanceof ul?bj(s,e):s instanceof dl?wj(s,e):t}function vj(s,e){return s instanceof Gc?(function(n){return Sx(n)||(function(l){return!!l&&"doubleValue"in l})(n)})(e)?e:{integerValue:0}:null}class Hc extends fg{}class ul extends fg{constructor(e){super(),this.elements=e}}function bj(s,e){const t=_j(e);for(const n of s.elements)t.some((a=>pa(a,n)))||t.push(n);return{arrayValue:{values:t}}}class dl extends fg{constructor(e){super(),this.elements=e}}function wj(s,e){let t=_j(e);for(const n of s.elements)t=t.filter((a=>!pa(a,n)));return{arrayValue:{values:t}}}class Gc extends fg{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function HN(s){return Xt(s.integerValue||s.doubleValue)}function _j(s){return nh(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(e,t){this.field=e,this.transform=t}}function _4(s,e){return s.field.isEqual(e.field)&&(function(n,a){return n instanceof ul&&a instanceof ul||n instanceof dl&&a instanceof dl?Dc(n.elements,a.elements,pa):n instanceof Gc&&a instanceof Gc?pa(n.Ae,a.Ae):n instanceof Hc&&a instanceof Hc})(s.transform,e.transform)}class N4{constructor(e,t){this.version=e,this.transformResults=t}}class Jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Jt}static exists(e){return new Jt(void 0,e)}static updateTime(e){return new Jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hm(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class mg{}function Nj(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new cu(s.key,Jt.none()):new lu(s.key,s.data,Jt.none());{const t=s.data,n=as.empty();let a=new kt(Ht.comparator);for(let l of e.fields)if(!a.has(l)){let u=t.field(l);u===null&&l.length>1&&(l=l.popLast(),u=t.field(l)),u===null?n.delete(l):n.set(l,u),a=a.add(l)}return new ri(s.key,n,new Is(a.toArray()),Jt.none())}}function T4(s,e,t){s instanceof lu?(function(a,l,u){const h=a.value.clone(),m=$N(a.fieldTransforms,l,u.transformResults);h.setAll(m),l.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(s,e,t):s instanceof ri?(function(a,l,u){if(!hm(a.precondition,l))return void l.convertToUnknownDocument(u.version);const h=$N(a.fieldTransforms,l,u.transformResults),m=l.data;m.setAll(Tj(a)),m.setAll(h),l.convertToFoundDocument(u.version,m).setHasCommittedMutations()})(s,e,t):(function(a,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,t)}function qd(s,e,t,n){return s instanceof lu?(function(l,u,h,m){if(!hm(l.precondition,u))return h;const p=l.value.clone(),x=KN(l.fieldTransforms,m,u);return p.setAll(x),u.convertToFoundDocument(u.version,p).setHasLocalMutations(),null})(s,e,t,n):s instanceof ri?(function(l,u,h,m){if(!hm(l.precondition,u))return h;const p=KN(l.fieldTransforms,m,u),x=u.data;return x.setAll(Tj(l)),x.setAll(p),u.convertToFoundDocument(u.version,x).setHasLocalMutations(),h===null?null:h.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((w=>w.field)))})(s,e,t,n):(function(l,u,h){return hm(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(s,e,t)}function E4(s,e){let t=null;for(const n of s.fieldTransforms){const a=e.data.field(n.field),l=vj(n.transform,a||null);l!=null&&(t===null&&(t=as.empty()),t.set(n.field,l))}return t||null}function GN(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!(function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&Dc(n,a,((l,u)=>_4(l,u)))})(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class lu extends mg{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class ri extends mg{constructor(e,t,n,a,l=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function Tj(s){const e=new Map;return s.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}})),e}function $N(s,e,t){const n=new Map;De(s.length===t.length,32656,{Re:t.length,Ve:s.length});for(let a=0;a<t.length;a++){const l=s[a],u=l.transform,h=e.data.field(l.field);n.set(l.field,w4(u,h,t[a]))}return n}function KN(s,e,t){const n=new Map;for(const a of s){const l=a.transform,u=t.data.field(a.field);n.set(a.field,b4(l,u,e))}return n}class cu extends mg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ev extends mg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&T4(l,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=qd(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=qd(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=pj();return this.mutations.forEach((a=>{const l=e.get(a.key),u=l.overlayedDocument;let h=this.applyToLocalView(u,l.mutatedFields);h=t.has(a.key)?null:h;const m=Nj(u,h);m!==null&&n.set(a.key,m),u.isValidDocument()||u.convertToNoDocument(Oe.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Xe())}isEqual(e){return this.batchId===e.batchId&&Dc(this.mutations,e.mutations,((t,n)=>GN(t,n)))&&Dc(this.baseMutations,e.baseMutations,((t,n)=>GN(t,n)))}}class jv{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){De(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let a=(function(){return y4})();const l=e.mutations;for(let u=0;u<l.length;u++)a=a.insert(l[u].key,n[u].version);return new jv(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _n,mt;function Sj(s){switch(s){case re.OK:return Se(64938);case re.CANCELLED:case re.UNKNOWN:case re.DEADLINE_EXCEEDED:case re.RESOURCE_EXHAUSTED:case re.INTERNAL:case re.UNAVAILABLE:case re.UNAUTHENTICATED:return!1;case re.INVALID_ARGUMENT:case re.NOT_FOUND:case re.ALREADY_EXISTS:case re.PERMISSION_DENIED:case re.FAILED_PRECONDITION:case re.ABORTED:case re.OUT_OF_RANGE:case re.UNIMPLEMENTED:case re.DATA_LOSS:return!0;default:return Se(15467,{code:s})}}function jj(s){if(s===void 0)return yn("GRPC error has no .code"),re.UNKNOWN;switch(s){case _n.OK:return re.OK;case _n.CANCELLED:return re.CANCELLED;case _n.UNKNOWN:return re.UNKNOWN;case _n.DEADLINE_EXCEEDED:return re.DEADLINE_EXCEEDED;case _n.RESOURCE_EXHAUSTED:return re.RESOURCE_EXHAUSTED;case _n.INTERNAL:return re.INTERNAL;case _n.UNAVAILABLE:return re.UNAVAILABLE;case _n.UNAUTHENTICATED:return re.UNAUTHENTICATED;case _n.INVALID_ARGUMENT:return re.INVALID_ARGUMENT;case _n.NOT_FOUND:return re.NOT_FOUND;case _n.ALREADY_EXISTS:return re.ALREADY_EXISTS;case _n.PERMISSION_DENIED:return re.PERMISSION_DENIED;case _n.FAILED_PRECONDITION:return re.FAILED_PRECONDITION;case _n.ABORTED:return re.ABORTED;case _n.OUT_OF_RANGE:return re.OUT_OF_RANGE;case _n.UNIMPLEMENTED:return re.UNIMPLEMENTED;case _n.DATA_LOSS:return re.DATA_LOSS;default:return Se(39323,{code:s})}}(mt=_n||(_n={}))[mt.OK=0]="OK",mt[mt.CANCELLED=1]="CANCELLED",mt[mt.UNKNOWN=2]="UNKNOWN",mt[mt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",mt[mt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",mt[mt.NOT_FOUND=5]="NOT_FOUND",mt[mt.ALREADY_EXISTS=6]="ALREADY_EXISTS",mt[mt.PERMISSION_DENIED=7]="PERMISSION_DENIED",mt[mt.UNAUTHENTICATED=16]="UNAUTHENTICATED",mt[mt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",mt[mt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",mt[mt.ABORTED=10]="ABORTED",mt[mt.OUT_OF_RANGE=11]="OUT_OF_RANGE",mt[mt.UNIMPLEMENTED=12]="UNIMPLEMENTED",mt[mt.INTERNAL=13]="INTERNAL",mt[mt.UNAVAILABLE=14]="UNAVAILABLE",mt[mt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kx=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aj(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j4=new Qi([4294967295,4294967295],0);function QN(s){const e=Aj().encode(s),t=new gS;return t.update(e),new Uint8Array(t.digest())}function YN(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new Qi([t,n],0),new Qi([a,l],0)]}class Cv{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Id(`Invalid padding: ${t}`);if(n<0)throw new Id(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Id(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Id(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Qi.fromNumber(this.ge)}ye(e,t,n){let a=e.add(t.multiply(Qi.fromNumber(n)));return a.compare(j4)===1&&(a=new Qi([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=QN(e),[n,a]=YN(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,a,l);if(!this.we(u))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new Cv(l,a,t);return n.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const t=QN(e),[n,a]=YN(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,a,l);this.Se(u)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Id extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e,t,n,a,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,bh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new vh(Oe.min(),a,new qt(qe),ks(),Xe())}}class bh{constructor(e,t,n,a,l){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new bh(n,t,Xe(),Xe(),Xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,t,n,a){this.be=e,this.removedTargetIds=t,this.key=n,this.De=a}}class Cj{constructor(e,t){this.targetId=e,this.Ce=t}}class Ij{constructor(e,t,n=ln.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class XN{constructor(){this.ve=0,this.Fe=WN(),this.Me=ln.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Xe(),t=Xe(),n=Xe();return this.Fe.forEach(((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:Se(38017,{changeType:l})}})),new bh(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=WN()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,De(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class A4{constructor(e){this.Ge=e,this.ze=new Map,this.je=ks(),this.Je=$f(),this.He=$f(),this.Ye=new qt(qe)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Se(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,a)=>{this.rt(a)&&t(a)}))}st(e){const t=e.targetId,n=e.Ce.count,a=this.ot(t);if(a){const l=a.target;if(Rm(l))if(n===0){const u=new _e(l.path);this.et(t,u,zt.newNoDocument(u,Oe.min()))}else De(n===1,20013,{expectedCount:n});else{const u=this._t(t);if(u!==n){const h=this.ut(e),m=h?this.ct(h,e,u):1;if(m!==0){this.it(t);const p=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}kx?.lt((function(x,w,b,E,k){const R={localCacheCount:x,existenceFilterCount:w.count,databaseId:b.database,projectId:b.projectId},U=w.unchangedNames;return U&&(R.bloomFilter={applied:k===0,hashCount:U?.hashCount??0,bitmapLength:U?.bits?.bitmap?.length??0,padding:U?.bits?.padding??0,mightContain:z=>E?.mightContain(z)??!1}),R})(u,e.Ce,this.Ge.ht(),h,m))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:l=0}=t;let u,h;try{u=Za(n).toUint8Array()}catch(m){if(m instanceof $S)return Zs("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{h=new Cv(u,a,l)}catch(m){return Zs(m instanceof Id?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return h.ge===0?null:h}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let a=0;return n.forEach((l=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(h)||(this.et(t,l,null),a++)})),a}Tt(e){const t=new Map;this.ze.forEach(((l,u)=>{const h=this.ot(u);if(h){if(l.current&&Rm(h.target)){const m=new _e(h.target.path);this.It(m).has(u)||this.Et(u,m)||this.et(u,m,zt.newNoDocument(m,e))}l.Be&&(t.set(u,l.ke()),l.qe())}}));let n=Xe();this.He.forEach(((l,u)=>{let h=!0;u.forEachWhile((m=>{const p=this.ot(m);return!p||p.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(n=n.add(l))})),this.je.forEach(((l,u)=>u.setReadTime(e)));const a=new vh(e,t,this.Ye,this.je,n);return this.je=ks(),this.Je=$f(),this.He=$f(),this.Ye=new qt(qe),a}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,t)?a.Qe(t,1):a.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new XN,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new kt(qe),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new kt(qe),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||pe("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new XN),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function $f(){return new qt(_e.comparator)}function WN(){return new qt(_e.comparator)}const C4={asc:"ASCENDING",desc:"DESCENDING"},I4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},k4={and:"AND",or:"OR"};class R4{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Rx(s,e){return s.useProto3Json||fh(e)?e:{value:e}}function $c(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function kj(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function D4(s,e){return $c(s,e.toTimestamp())}function xn(s){return De(!!s,49232),Oe.fromTimestamp((function(t){const n=Ja(t);return new Nt(n.seconds,n.nanos)})(s))}function Iv(s,e){return Dx(s,e).canonicalString()}function Dx(s,e){const t=(function(a){return new tt(["projects",a.projectId,"databases",a.database])})(s).child("documents");return e===void 0?t:t.child(e)}function Rj(s){const e=tt.fromString(s);return De(Bj(e),10190,{key:e.toString()}),e}function rh(s,e){return Iv(s.databaseId,e.path)}function ma(s,e){const t=Rj(e);if(t.get(1)!==s.databaseId.projectId)throw new he(re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new he(re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new _e(Mj(t))}function Dj(s,e){return Iv(s.databaseId,e)}function Pj(s){const e=Rj(s);return e.length===4?tt.emptyPath():Mj(e)}function Px(s){return new tt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function Mj(s){return De(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function JN(s,e,t){return{name:rh(s,e),fields:t.value.mapValue.fields}}function gg(s,e,t){const n=ma(s,e.name),a=xn(e.updateTime),l=e.createTime?xn(e.createTime):Oe.min(),u=new as({mapValue:{fields:e.fields}}),h=zt.newFoundDocument(n,a,l,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function P4(s,e){return"found"in e?(function(n,a){De(!!a.found,43571),a.found.name,a.found.updateTime;const l=ma(n,a.found.name),u=xn(a.found.updateTime),h=a.found.createTime?xn(a.found.createTime):Oe.min(),m=new as({mapValue:{fields:a.found.fields}});return zt.newFoundDocument(l,u,h,m)})(s,e):"missing"in e?(function(n,a){De(!!a.missing,3894),De(!!a.readTime,22933);const l=ma(n,a.missing),u=xn(a.readTime);return zt.newNoDocument(l,u)})(s,e):Se(7234,{result:e})}function M4(s,e){let t;if("targetChange"in e){e.targetChange;const n=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:Se(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=(function(p,x){return p.useProto3Json?(De(x===void 0||typeof x=="string",58123),ln.fromBase64String(x||"")):(De(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),ln.fromUint8Array(x||new Uint8Array))})(s,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(p){const x=p.code===void 0?re.UNKNOWN:jj(p.code);return new he(x,p.message||"")})(u);t=new Ij(n,a,l,h||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=ma(s,n.document.name),l=xn(n.document.updateTime),u=n.document.createTime?xn(n.document.createTime):Oe.min(),h=new as({mapValue:{fields:n.document.fields}}),m=zt.newFoundDocument(a,l,u,h),p=n.targetIds||[],x=n.removedTargetIds||[];t=new fm(p,x,m.key,m)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=ma(s,n.document),l=n.readTime?xn(n.readTime):Oe.min(),u=zt.newNoDocument(a,l),h=n.removedTargetIds||[];t=new fm([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=ma(s,n.document),l=n.removedTargetIds||[];t=new fm([],l,a,null)}else{if(!("filter"in e))return Se(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:l}=n,u=new S4(a,l),h=n.targetId;t=new Cj(h,u)}}return t}function ah(s,e){let t;if(e instanceof lu)t={update:JN(s,e.key,e.value)};else if(e instanceof cu)t={delete:rh(s,e.key)};else if(e instanceof ri)t={update:JN(s,e.key,e.data),updateMask:B4(e.fieldMask)};else{if(!(e instanceof Ev))return Se(16599,{Vt:e.type});t={verify:rh(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(l,u){const h=u.transform;if(h instanceof Hc)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof ul)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof dl)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Gc)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw Se(20930,{transform:u.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(a,l){return l.updateTime!==void 0?{updateTime:D4(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Se(27497)})(s,e.precondition)),t}function Mx(s,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?Jt.updateTime(xn(l.updateTime)):l.exists!==void 0?Jt.exists(l.exists):Jt.none()})(e.currentDocument):Jt.none(),n=e.updateTransforms?e.updateTransforms.map((a=>(function(u,h){let m=null;if("setToServerValue"in h)De(h.setToServerValue==="REQUEST_TIME",16630,{proto:h}),m=new Hc;else if("appendMissingElements"in h){const x=h.appendMissingElements.values||[];m=new ul(x)}else if("removeAllFromArray"in h){const x=h.removeAllFromArray.values||[];m=new dl(x)}else"increment"in h?m=new Gc(u,h.increment):Se(16584,{proto:h});const p=Ht.fromServerFormat(h.fieldPath);return new xh(p,m)})(s,a))):[];if(e.update){e.update.name;const a=ma(s,e.update.name),l=new as({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=(function(m){const p=m.fieldPaths||[];return new Is(p.map((x=>Ht.fromServerFormat(x))))})(e.updateMask);return new ri(a,l,u,t,n)}return new lu(a,l,t,n)}if(e.delete){const a=ma(s,e.delete);return new cu(a,t)}if(e.verify){const a=ma(s,e.verify);return new Ev(a,t)}return Se(1463,{proto:e})}function O4(s,e){return s&&s.length>0?(De(e!==void 0,14353),s.map((t=>(function(a,l){let u=a.updateTime?xn(a.updateTime):xn(l);return u.isEqual(Oe.min())&&(u=xn(l)),new N4(u,a.transformResults||[])})(t,e)))):[]}function Oj(s,e){return{documents:[Dj(s,e.path)]}}function pg(s,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Dj(s,a);const l=(function(p){if(p.length!==0)return Uj(Ct.create(p,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const u=(function(p){if(p.length!==0)return p.map((x=>(function(b){return{field:Ui(b.field),direction:L4(b.dir)}})(x)))})(e.orderBy);u&&(t.structuredQuery.orderBy=u);const h=Rx(s,e.limit);return h!==null&&(t.structuredQuery.limit=h),e.startAt&&(t.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:t,parent:a}}function Vj(s,e,t,n){const{ft:a,parent:l}=pg(s,e),u={},h=[];let m=0;return t.forEach((p=>{const x=n?p.alias:"aggregate_"+m++;u[x]=p.alias,p.aggregateType==="count"?h.push({alias:x,count:{}}):p.aggregateType==="avg"?h.push({alias:x,avg:{field:Ui(p.fieldPath)}}):p.aggregateType==="sum"&&h.push({alias:x,sum:{field:Ui(p.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:a.structuredQuery},parent:a.parent},gt:u,parent:l}}function Lj(s){let e=Pj(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){De(n===1,65062);const x=t.from[0];x.allDescendants?a=x.collectionId:e=e.child(x.collectionId)}let l=[];t.where&&(l=(function(w){const b=Fj(w);return b instanceof Ct&&wv(b)?b.getFilters():[b]})(t.where));let u=[];t.orderBy&&(u=(function(w){return w.map((b=>(function(k){return new sh(Nc(k.field),(function(U){switch(U){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(b)))})(t.orderBy));let h=null;t.limit&&(h=(function(w){let b;return b=typeof w=="object"?w.value:w,fh(b)?null:b})(t.limit));let m=null;t.startAt&&(m=(function(w){const b=!!w.before,E=w.values||[];return new to(E,b)})(t.startAt));let p=null;return t.endAt&&(p=(function(w){const b=!w.before,E=w.values||[];return new to(E,b)})(t.endAt)),lj(e,a,u,l,h,"F",m,p)}function V4(s,e){const t=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Se(28987,{purpose:a})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Fj(s){return s.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Nc(t.unaryFilter.field);return ct.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=Nc(t.unaryFilter.field);return ct.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=Nc(t.unaryFilter.field);return ct.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=Nc(t.unaryFilter.field);return ct.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Se(61313);default:return Se(60726)}})(s):s.fieldFilter!==void 0?(function(t){return ct.create(Nc(t.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Se(58110);default:return Se(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(s):s.compositeFilter!==void 0?(function(t){return Ct.create(t.compositeFilter.filters.map((n=>Fj(n))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Se(1026)}})(t.compositeFilter.op))})(s):Se(30097,{filter:s})}function L4(s){return C4[s]}function F4(s){return I4[s]}function U4(s){return k4[s]}function Ui(s){return{fieldPath:s.canonicalString()}}function Nc(s){return Ht.fromServerFormat(s.fieldPath)}function Uj(s){return s instanceof ct?(function(t){if(t.op==="=="){if(ON(t.value))return{unaryFilter:{field:Ui(t.field),op:"IS_NAN"}};if(MN(t.value))return{unaryFilter:{field:Ui(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ON(t.value))return{unaryFilter:{field:Ui(t.field),op:"IS_NOT_NAN"}};if(MN(t.value))return{unaryFilter:{field:Ui(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ui(t.field),op:F4(t.op),value:t.value}}})(s):s instanceof Ct?(function(t){const n=t.getFilters().map((a=>Uj(a)));return n.length===1?n[0]:{compositeFilter:{op:U4(t.op),filters:n}}})(s):Se(54877,{filter:s})}function B4(s){const e=[];return s.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Bj(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e,t,n,a,l=Oe.min(),u=Oe.min(),h=ln.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=m}withSequenceNumber(e){return new Ha(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ha(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj{constructor(e){this.yt=e}}function q4(s,e){let t;if(e.document)t=gg(s.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=_e.fromSegments(e.noDocument.path),a=fl(e.noDocument.readTime);t=zt.newNoDocument(n,a),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Se(56709);{const n=_e.fromSegments(e.unknownDocument.path),a=fl(e.unknownDocument.version);t=zt.newUnknownDocument(n,a)}}return e.readTime&&t.setReadTime((function(a){const l=new Nt(a[0],a[1]);return Oe.fromTimestamp(l)})(e.readTime)),t}function ZN(s,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Mm(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(l,u){return{name:rh(l,u.key),fields:u.data.value.mapValue.fields,updateTime:$c(l,u.version.toTimestamp()),createTime:$c(l,u.createTime.toTimestamp())}})(s.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:hl(e.version)};else{if(!e.isUnknownDocument())return Se(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:hl(e.version)}}return n}function Mm(s){const e=s.toTimestamp();return[e.seconds,e.nanoseconds]}function hl(s){const e=s.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function fl(s){const e=new Nt(s.seconds,s.nanoseconds);return Oe.fromTimestamp(e)}function Yo(s,e){const t=(e.baseMutations||[]).map((l=>Mx(s.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const u=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const h=e.mutations[l+1];u.updateTransforms=h.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const n=e.mutations.map((l=>Mx(s.yt,l))),a=Nt.fromMillis(e.localWriteTimeMs);return new Sv(e.batchId,a,t,n)}function kd(s){const e=fl(s.readTime),t=s.lastLimboFreeSnapshotVersion!==void 0?fl(s.lastLimboFreeSnapshotVersion):Oe.min();let n;return n=(function(l){return l.documents!==void 0})(s.query)?(function(l){const u=l.documents.length;return De(u===1,1966,{count:u}),ms(ou(Pj(l.documents[0])))})(s.query):(function(l){return ms(Lj(l))})(s.query),new Ha(n,s.targetId,"TargetPurposeListen",s.lastListenSequenceNumber,e,t,ln.fromBase64String(s.resumeToken))}function zj(s,e){const t=hl(e.snapshotVersion),n=hl(e.lastLimboFreeSnapshotVersion);let a;a=Rm(e.target)?Oj(s.yt,e.target):pg(s.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:cl(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:a}}function yg(s){const e=Lj({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Pm(e,e.limit,"L"):e}function Gy(s,e){return new Av(e.largestBatchId,Mx(s.yt,e.overlayMutation))}function eT(s,e){const t=e.path.lastSegment();return[s,fs(e.path.popLast()),t]}function tT(s,e,t,n){return{indexId:s,uid:e,sequenceNumber:t,readTime:hl(n.readTime),documentKey:fs(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{getBundleMetadata(e,t){return nT(e).get(t).next((n=>{if(n)return(function(l){return{id:l.bundleId,createTime:fl(l.createTime),version:l.version}})(n)}))}saveBundleMetadata(e,t){return nT(e).put((function(a){return{bundleId:a.id,createTime:hl(xn(a.createTime)),version:a.version}})(t))}getNamedQuery(e,t){return sT(e).get(t).next((n=>{if(n)return(function(l){return{name:l.name,query:yg(l.bundledQuery),readTime:fl(l.readTime)}})(n)}))}saveNamedQuery(e,t){return sT(e).put((function(a){return{name:a.name,readTime:hl(xn(a.readTime)),bundledQuery:a.bundledQuery}})(t))}}function nT(s){return On(s,og)}function sT(s){return On(s,lg)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new xg(e,n)}getOverlay(e,t){return xd(e).get(eT(this.userId,t)).next((n=>n?Gy(this.serializer,n):null))}getOverlays(e,t){const n=da();return J.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&n.set(a,l)})))).next((()=>n))}saveOverlays(e,t,n){const a=[];return n.forEach(((l,u)=>{const h=new Av(t,u);a.push(this.St(e,h))})),J.waitFor(a)}removeOverlaysForBatchId(e,t,n){const a=new Set;t.forEach((u=>a.add(fs(u.getCollectionPath()))));const l=[];return a.forEach((u=>{const h=IDBKeyRange.bound([this.userId,u,n],[this.userId,u,n+1],!1,!0);l.push(xd(e).Z(Nx,h))})),J.waitFor(l)}getOverlaysForCollection(e,t,n){const a=da(),l=fs(t),u=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,Number.POSITIVE_INFINITY],!0);return xd(e).J(Nx,u).next((h=>{for(const m of h){const p=Gy(this.serializer,m);a.set(p.getKey(),p)}return a}))}getOverlaysForCollectionGroup(e,t,n,a){const l=da();let u;const h=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return xd(e).ee({index:FS,range:h},((m,p,x)=>{const w=Gy(this.serializer,p);l.size()<a||w.largestBatchId===u?(l.set(w.getKey(),w),u=w.largestBatchId):x.done()})).next((()=>l))}St(e,t){return xd(e).put((function(a,l,u){const[h,m,p]=eT(l,u.mutation.key);return{userId:l,collectionPath:m,documentId:p,collectionGroup:u.mutation.key.getCollectionGroup(),largestBatchId:u.largestBatchId,overlayMutation:ah(a.yt,u.mutation)}})(this.serializer,this.userId,t))}}function xd(s){return On(s,cg)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{bt(e){return On(e,yv)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const n=t?.value;return n?ln.fromUint8Array(n):ln.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Xt(e.integerValue));else if("doubleValue"in e){const n=Xt(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Yd(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=Ja(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Za(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?JS(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):hg(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Se(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const a of Object.keys(n))this.Ot(a,t),this.Ct(n[a],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const a=Bc,l=n[a].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Xt(l)),this.Ot(a,t),this.Ct(n[a],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const a of n)this.Ct(a,t)}Lt(e,t){this.Ft(t,37),_e.fromName(e).path.forEach((n=>{this.Ft(t,60),this.Ut(n,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Xo.Kt=new Xo;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pc=255;function G4(s){if(s===0)return 8;let e=0;return s>>4||(e+=4,s<<=4),s>>6||(e+=2,s<<=2),s>>7||(e+=1),e}function rT(s){const e=64-(function(n){let a=0;for(let l=0;l<8;++l){const u=G4(255&n[l]);if(a+=u,u!==8)break}return a})(s);return Math.ceil(e/8)}class $4{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const a=t.codePointAt(0);this.Gt(240|a>>>18),this.Gt(128|63&a>>>12),this.Gt(128|63&a>>>6),this.Gt(128|63&a)}}this.zt()}Zt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const a=t.codePointAt(0);this.Jt(240|a>>>18),this.Jt(128|63&a>>>12),this.Jt(128|63&a>>>6),this.Jt(128|63&a)}}this.Ht()}Xt(e){const t=this.en(e),n=rT(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let a=t.length-n;a<t.length;++a)this.buffer[this.position++]=255&t[a]}nn(e){const t=this.en(e),n=rT(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let a=t.length-n;a<t.length;++a)this.buffer[this.position++]=~(255&t[a])}rn(){this.sn(pc),this.sn(255)}_n(){this.an(pc),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const u=new DataView(new ArrayBuffer(8));return u.setFloat64(0,l,!1),new Uint8Array(u.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let a=1;a<t.length;++a)t[a]^=n?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===pc?(this.sn(pc),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===pc?(this.an(pc),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const a=new Uint8Array(n);a.set(this.buffer),this.buffer=a}}class K4{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class Q4{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class vd{constructor(){this.cn=new $4,this.ln=new K4(this.cn),this.hn=new Q4(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,t,n,a){this.Tn=e,this.In=t,this.En=n,this.dn=a}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new Wo(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:mm(this.En),directionalValue:mm(this.dn),orderedDocumentKey:mm(t),documentKey:n.path.toArray()}}Vn(e,t,n){const a=this.Rn(e,t,n);return[a.indexId,a.uid,a.arrayValue,a.directionalValue,a.orderedDocumentKey,a.documentKey]}}function Pi(s,e){let t=s.Tn-e.Tn;return t!==0?t:(t=aT(s.En,e.En),t!==0?t:(t=aT(s.dn,e.dn),t!==0?t:_e.comparator(s.In,e.In)))}function aT(s,e){for(let t=0;t<s.length&&t<e.length;++t){const n=s[t]-e[t];if(n!==0)return n}return s.length-e.length}function mm(s){return jE()?(function(t){let n="";for(let a=0;a<t.length;a++)n+=String.fromCharCode(t[a]);return n})(s):s}function iT(s){return typeof s!="string"?s:(function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n})(s)}class oT{constructor(e){this.mn=new kt(((t,n)=>Ht.comparator(t.field,n.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(De(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=bx(e);if(t!==void 0&&!this.wn(t))return!1;const n=$o(e);let a=new Set,l=0,u=0;for(;l<n.length&&this.wn(n[l]);++l)a=a.add(n[l].fieldPath.canonicalString());if(l===n.length)return!0;if(this.mn.size>0){const h=this.mn.getIterator().getNext();if(!a.has(h.field.canonicalString())){const m=n[l];if(!this.Sn(h,m)||!this.bn(this.fn[u++],m))return!1}++l}for(;l<n.length;++l){const h=n[l];if(u>=this.fn.length||!this.bn(this.fn[u++],h))return!1}return!0}Dn(){if(this.pn)return null;let e=new kt(Ht.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new tl(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new tl(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new tl(n.field,n.dir==="asc"?0:1)));return new Mc(Mc.UNKNOWN_ID,this.collectionId,t,Oc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hj(s){if(De(s instanceof ct||s instanceof Ct,20012),s instanceof ct){if(s instanceof oj){const t=s.value.arrayValue?.values?.map((n=>ct.create(s.field,"==",n)))||[];return Ct.create(t,"or")}return s}const e=s.filters.map((t=>Hj(t)));return Ct.create(e,s.op)}function Y4(s){if(s.getFilters().length===0)return[];const e=Lx(Hj(s));return De(Gj(e),7391),Ox(e)||Vx(e)?[e]:e.getFilters()}function Ox(s){return s instanceof ct}function Vx(s){return s instanceof Ct&&wv(s)}function Gj(s){return Ox(s)||Vx(s)||(function(t){if(t instanceof Ct&&jx(t)){for(const n of t.getFilters())if(!Ox(n)&&!Vx(n))return!1;return!0}return!1})(s)}function Lx(s){if(De(s instanceof ct||s instanceof Ct,34018),s instanceof ct)return s;if(s.filters.length===1)return Lx(s.filters[0]);const e=s.filters.map((n=>Lx(n)));let t=Ct.create(e,s.op);return t=Om(t),Gj(t)?t:(De(t instanceof Ct,64498),De(zc(t),40251),De(t.filters.length>1,57927),t.filters.reduce(((n,a)=>kv(n,a))))}function kv(s,e){let t;return De(s instanceof ct||s instanceof Ct,38388),De(e instanceof ct||e instanceof Ct,25473),t=s instanceof ct?e instanceof ct?(function(a,l){return Ct.create([a,l],"and")})(s,e):lT(s,e):e instanceof ct?lT(e,s):(function(a,l){if(De(a.filters.length>0&&l.filters.length>0,48005),zc(a)&&zc(l))return rj(a,l.getFilters());const u=jx(a)?a:l,h=jx(a)?l:a,m=u.filters.map((p=>kv(p,h)));return Ct.create(m,"or")})(s,e),Om(t)}function lT(s,e){if(zc(e))return rj(e,s.getFilters());{const t=e.filters.map((n=>kv(s,n)));return Ct.create(t,"or")}}function Om(s){if(De(s instanceof ct||s instanceof Ct,11850),s instanceof ct)return s;const e=s.getFilters();if(e.length===1)return Om(e[0]);if(nj(s))return s;const t=e.map((a=>Om(a))),n=[];return t.forEach((a=>{a instanceof ct?n.push(a):a instanceof Ct&&(a.op===s.op?n.push(...a.filters):n.push(a))})),n.length===1?n[0]:Ct.create(n,s.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(){this.Cn=new Rv}addToCollectionParentIndex(e,t){return this.Cn.add(t),J.resolve()}getCollectionParents(e,t){return J.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return J.resolve()}deleteFieldIndex(e,t){return J.resolve()}deleteAllFieldIndexes(e){return J.resolve()}createTargetIndexes(e,t){return J.resolve()}getDocumentsMatchingTarget(e,t){return J.resolve(null)}getIndexType(e,t){return J.resolve(0)}getFieldIndexes(e,t){return J.resolve([])}getNextCollectionGroupToUpdate(e){return J.resolve(null)}getMinOffset(e,t){return J.resolve(er.min())}getMinOffsetFromCollectionGroup(e,t){return J.resolve(er.min())}updateCollectionGroup(e,t,n){return J.resolve()}updateIndexEntries(e,t){return J.resolve()}}class Rv{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new kt(tt.comparator),l=!a.has(n);return this.index[t]=a.add(n),l}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new kt(tt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cT="IndexedDbIndexManager",Kf=new Uint8Array(0);class W4{constructor(e,t){this.databaseId=t,this.vn=new Rv,this.Fn=new si((n=>cl(n)),((n,a)=>gh(n,a))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),a=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:n,parent:fs(a)};return uT(e).put(l)}return J.resolve()}getCollectionParents(e,t){const n=[],a=IDBKeyRange.bound([t,""],[TS(t),""],!1,!0);return uT(e).J(a).next((l=>{for(const u of l){if(u.collectionId!==t)break;n.push(ua(u.parent))}return n}))}addFieldIndex(e,t){const n=bd(e),a=(function(h){return{indexId:h.indexId,collectionGroup:h.collectionGroup,fields:h.fields.map((m=>[m.fieldPath.canonicalString(),m.kind]))}})(t);delete a.indexId;const l=n.add(a);if(t.indexState){const u=xc(e);return l.next((h=>{u.put(tT(h,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const n=bd(e),a=xc(e),l=yc(e);return n.delete(t.indexId).next((()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=bd(e),n=yc(e),a=xc(e);return t.Z().next((()=>n.Z())).next((()=>a.Z()))}createTargetIndexes(e,t){return J.forEach(this.Mn(t),(n=>this.getIndexType(e,n).next((a=>{if(a===0||a===1){const l=new oT(n).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const n=yc(e);let a=!0;const l=new Map;return J.forEach(this.Mn(t),(u=>this.xn(e,u).next((h=>{a&&(a=!!h),l.set(u,h)})))).next((()=>{if(a){let u=Xe();const h=[];return J.forEach(l,((m,p)=>{pe(cT,`Using index ${(function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map((G=>`${G.fieldPath}:${G.kind}`)).join(",")}`})(m)} to execute ${cl(t)}`);const x=(function(q,G){const Q=bx(G);if(Q===void 0)return null;for(const L of Dm(q,Q.fieldPath))switch(L.op){case"array-contains-any":return L.value.arrayValue.values||[];case"array-contains":return[L.value]}return null})(p,m),w=(function(q,G){const Q=new Map;for(const L of $o(G))for(const P of Dm(q,L.fieldPath))switch(P.op){case"==":case"in":Q.set(L.fieldPath.canonicalString(),P.value);break;case"not-in":case"!=":return Q.set(L.fieldPath.canonicalString(),P.value),Array.from(Q.values())}return null})(p,m),b=(function(q,G){const Q=[];let L=!0;for(const P of $o(G)){const T=P.kind===0?BN(q,P.fieldPath,q.startAt):qN(q,P.fieldPath,q.startAt);Q.push(T.value),L&&(L=T.inclusive)}return new to(Q,L)})(p,m),E=(function(q,G){const Q=[];let L=!0;for(const P of $o(G)){const T=P.kind===0?qN(q,P.fieldPath,q.endAt):BN(q,P.fieldPath,q.endAt);Q.push(T.value),L&&(L=T.inclusive)}return new to(Q,L)})(p,m),k=this.On(m,p,b),R=this.On(m,p,E),U=this.Nn(m,p,w),z=this.Bn(m.indexId,x,k,b.inclusive,R,E.inclusive,U);return J.forEach(z,(B=>n.Y(B,t.limit).next((q=>{q.forEach((G=>{const Q=_e.fromSegments(G.documentKey);u.has(Q)||(u=u.add(Q),h.push(Q))}))}))))})).next((()=>h))}return J.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=Y4(Ct.create(e.filters,"and")).map((n=>Cx(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,n,a,l,u,h){const m=(t!=null?t.length:1)*Math.max(n.length,l.length),p=m/(t!=null?t.length:1),x=[];for(let w=0;w<m;++w){const b=t?this.Ln(t[w/p]):Kf,E=this.kn(e,b,n[w%p],a),k=this.qn(e,b,l[w%p],u),R=h.map((U=>this.kn(e,b,U,!0)));x.push(...this.createRange(E,k,R))}return x}kn(e,t,n,a){const l=new Wo(e,_e.empty(),t,n);return a?l:l.An()}qn(e,t,n,a){const l=new Wo(e,_e.empty(),t,n);return a?l.An():l}xn(e,t){const n=new oT(t),a=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,a).next((l=>{let u=null;for(const h of l)n.yn(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u}))}getIndexType(e,t){let n=2;const a=this.Mn(t);return J.forEach(a,(l=>this.xn(e,l).next((u=>{u?n!==0&&u.fields.length<(function(m){let p=new kt(Ht.comparator),x=!1;for(const w of m.filters)for(const b of w.getFlattenedFilters())b.field.isKeyField()||(b.op==="array-contains"||b.op==="array-contains-any"?x=!0:p=p.add(b.field));for(const w of m.orderBy)w.field.isKeyField()||(p=p.add(w.field));return p.size+(x?1:0)})(l)&&(n=1):n=0})))).next((()=>(function(u){return u.limit!==null})(t)&&a.length>1&&n===2?1:n))}Qn(e,t){const n=new vd;for(const a of $o(e)){const l=t.data.field(a.fieldPath);if(l==null)return null;const u=n.Pn(a.kind);Xo.Kt.Dt(l,u)}return n.un()}Ln(e){const t=new vd;return Xo.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new vd;return Xo.Kt.Dt(ll(this.databaseId,t),n.Pn((function(l){const u=$o(l);return u.length===0?0:u[u.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let a=[];a.push(new vd);let l=0;for(const u of $o(e)){const h=n[l++];for(const m of a)if(this.Un(t,u.fieldPath)&&nh(h))a=this.Kn(a,u,h);else{const p=m.Pn(u.kind);Xo.Kt.Dt(h,p)}}return this.Wn(a)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const a=[...e],l=[];for(const u of n.arrayValue.values||[])for(const h of a){const m=new vd;m.seed(h.un()),Xo.Kt.Dt(u,m.Pn(t.kind)),l.push(m)}return l}Un(e,t){return!!e.filters.find((n=>n instanceof ct&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(e,t){const n=bd(e),a=xc(e);return(t?n.J(_x,IDBKeyRange.bound(t,t)):n.J()).next((l=>{const u=[];return J.forEach(l,(h=>a.get([h.indexId,this.uid]).next((m=>{u.push((function(x,w){const b=w?new Oc(w.sequenceNumber,new er(fl(w.readTime),new _e(ua(w.documentKey)),w.largestBatchId)):Oc.empty(),E=x.fields.map((([k,R])=>new tl(Ht.fromServerFormat(k),R)));return new Mc(x.indexId,x.collectionGroup,E,b)})(h,m))})))).next((()=>u))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((n,a)=>{const l=n.indexState.sequenceNumber-a.indexState.sequenceNumber;return l!==0?l:qe(n.collectionGroup,a.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,n){const a=bd(e),l=xc(e);return this.Gn(e).next((u=>a.J(_x,IDBKeyRange.bound(t,t)).next((h=>J.forEach(h,(m=>l.put(tT(m.indexId,this.uid,u,n))))))))}updateIndexEntries(e,t){const n=new Map;return J.forEach(t,((a,l)=>{const u=n.get(a.collectionGroup);return(u?J.resolve(u):this.getFieldIndexes(e,a.collectionGroup)).next((h=>(n.set(a.collectionGroup,h),J.forEach(h,(m=>this.zn(e,a,m).next((p=>{const x=this.jn(l,m);return p.isEqual(x)?J.resolve():this.Jn(e,l,m,p,x)})))))))}))}Hn(e,t,n,a){return yc(e).put(a.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,a){return yc(e).delete(a.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const a=yc(e);let l=new kt(Pi);return a.ee({index:LS,range:IDBKeyRange.only([n.indexId,this.uid,mm(this.$n(n,t))])},((u,h)=>{l=l.add(new Wo(n.indexId,t,iT(h.arrayValue),iT(h.directionalValue)))})).next((()=>l))}jn(e,t){let n=new kt(Pi);const a=this.Qn(t,e);if(a==null)return n;const l=bx(t);if(l!=null){const u=e.data.field(l.fieldPath);if(nh(u))for(const h of u.arrayValue.values||[])n=n.add(new Wo(t.indexId,e.key,this.Ln(h),a))}else n=n.add(new Wo(t.indexId,e.key,Kf,a));return n}Jn(e,t,n,a,l){pe(cT,"Updating index entries for document '%s'",t.key);const u=[];return(function(m,p,x,w,b){const E=m.getIterator(),k=p.getIterator();let R=gc(E),U=gc(k);for(;R||U;){let z=!1,B=!1;if(R&&U){const q=x(R,U);q<0?B=!0:q>0&&(z=!0)}else R!=null?B=!0:z=!0;z?(w(U),U=gc(k)):B?(b(R),R=gc(E)):(R=gc(E),U=gc(k))}})(a,l,Pi,(h=>{u.push(this.Hn(e,t,n,h))}),(h=>{u.push(this.Yn(e,t,n,h))})),J.waitFor(u)}Gn(e){let t=1;return xc(e).ee({index:VS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,a,l)=>{l.done(),t=a.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((u,h)=>Pi(u,h))).filter(((u,h,m)=>!h||Pi(u,m[h-1])!==0));const a=[];a.push(e);for(const u of n){const h=Pi(u,e),m=Pi(u,t);if(h===0)a[0]=e.An();else if(h>0&&m<0)a.push(u),a.push(u.An());else if(m>0)break}a.push(t);const l=[];for(let u=0;u<a.length;u+=2){if(this.Zn(a[u],a[u+1]))return[];const h=a[u].Vn(this.uid,Kf,_e.empty()),m=a[u+1].Vn(this.uid,Kf,_e.empty());l.push(IDBKeyRange.bound(h,m))}return l}Zn(e,t){return Pi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(dT)}getMinOffset(e,t){return J.mapArray(this.Mn(t),(n=>this.xn(e,n).next((a=>a||Se(44426))))).next(dT)}}function uT(s){return On(s,Jd)}function yc(s){return On(s,Fd)}function bd(s){return On(s,pv)}function xc(s){return On(s,Ld)}function dT(s){De(s.length!==0,28825);let e=s[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<s.length;n++){const a=s[n].indexState.offset;fv(a,e)<0&&(e=a),t<a.largestBatchId&&(t=a.largestBatchId)}return new er(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$j=41943040;class ds{static withCacheSize(e){return new ds(e,ds.DEFAULT_COLLECTION_PERCENTILE,ds.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kj(s,e,t){const n=s.store(Pr),a=s.store(Vc),l=[],u=IDBKeyRange.only(t.batchId);let h=0;const m=n.ee({range:u},((x,w,b)=>(h++,b.delete())));l.push(m.next((()=>{De(h===1,47070,{batchId:t.batchId})})));const p=[];for(const x of t.mutations){const w=PS(e,x.key.path,t.batchId);l.push(a.delete(w)),p.push(x.key)}return J.waitFor(l).next((()=>p))}function Vm(s){if(!s)return 0;let e;if(s.document)e=s.document;else if(s.unknownDocument)e=s.unknownDocument;else{if(!s.noDocument)throw Se(14731);e=s.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ds.DEFAULT_COLLECTION_PERCENTILE=10,ds.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ds.DEFAULT=new ds($j,ds.DEFAULT_COLLECTION_PERCENTILE,ds.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ds.DISABLED=new ds(-1,0,0);class vg{constructor(e,t,n,a){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=a,this.Xn={}}static wt(e,t,n,a){De(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new vg(l,t,n,a)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).ee({index:Zo,range:n},((a,l,u)=>{t=!1,u.done()})).next((()=>t))}addMutationBatch(e,t,n,a){const l=Tc(e),u=Mi(e);return u.add({}).next((h=>{De(typeof h=="number",49019);const m=new Sv(h,t,n,a),p=(function(E,k,R){const U=R.baseMutations.map((B=>ah(E.yt,B))),z=R.mutations.map((B=>ah(E.yt,B)));return{userId:k,batchId:R.batchId,localWriteTimeMs:R.localWriteTime.toMillis(),baseMutations:U,mutations:z}})(this.serializer,this.userId,m),x=[];let w=new kt(((b,E)=>qe(b.canonicalString(),E.canonicalString())));for(const b of a){const E=PS(this.userId,b.key.path,h);w=w.add(b.key.path.popLast()),x.push(u.put(p)),x.push(l.put(E,RD))}return w.forEach((b=>{x.push(this.indexManager.addToCollectionParentIndex(e,b))})),e.addOnCommittedListener((()=>{this.Xn[h]=m.keys()})),J.waitFor(x).next((()=>m))}))}lookupMutationBatch(e,t){return Mi(e).get(t).next((n=>n?(De(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),Yo(this.serializer,n)):null))}er(e,t){return this.Xn[t]?J.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((n=>{if(n){const a=n.keys();return this.Xn[t]=a,a}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=IDBKeyRange.lowerBound([this.userId,n]);let l=null;return Mi(e).ee({index:Zo,range:a},((u,h,m)=>{h.userId===this.userId&&(De(h.batchId>=n,47524,{tr:n}),l=Yo(this.serializer,h)),m.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Yi;return Mi(e).ee({index:Zo,range:t,reverse:!0},((a,l,u)=>{n=l.batchId,u.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Yi],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).J(Zo,t).next((n=>n.map((a=>Yo(this.serializer,a)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=om(this.userId,t.path),a=IDBKeyRange.lowerBound(n),l=[];return Tc(e).ee({range:a},((u,h,m)=>{const[p,x,w]=u,b=ua(x);if(p===this.userId&&t.path.isEqual(b))return Mi(e).get(w).next((E=>{if(!E)throw Se(61480,{nr:u,batchId:w});De(E.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:E.userId,batchId:w}),l.push(Yo(this.serializer,E))}));m.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new kt(qe);const a=[];return t.forEach((l=>{const u=om(this.userId,l.path),h=IDBKeyRange.lowerBound(u),m=Tc(e).ee({range:h},((p,x,w)=>{const[b,E,k]=p,R=ua(E);b===this.userId&&l.path.isEqual(R)?n=n.add(k):w.done()}));a.push(m)})),J.waitFor(a).next((()=>this.rr(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1,l=om(this.userId,n),u=IDBKeyRange.lowerBound(l);let h=new kt(qe);return Tc(e).ee({range:u},((m,p,x)=>{const[w,b,E]=m,k=ua(b);w===this.userId&&n.isPrefixOf(k)?k.length===a&&(h=h.add(E)):x.done()})).next((()=>this.rr(e,h)))}rr(e,t){const n=[],a=[];return t.forEach((l=>{a.push(Mi(e).get(l).next((u=>{if(u===null)throw Se(35274,{batchId:l});De(u.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:u.userId,batchId:l}),n.push(Yo(this.serializer,u))})))})),J.waitFor(a).next((()=>n))}removeMutationBatch(e,t){return Kj(e.le,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),J.forEach(n,(a=>this.referenceDelegate.markPotentiallyOrphaned(e,a))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return J.resolve();const n=IDBKeyRange.lowerBound((function(u){return[u]})(this.userId)),a=[];return Tc(e).ee({range:n},((l,u,h)=>{if(l[0]===this.userId){const m=ua(l[1]);a.push(m)}else h.done()})).next((()=>{De(a.length===0,56720,{sr:a.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return Qj(e,this.userId,t)}_r(e){return Yj(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Yi,lastStreamToken:""}))}}function Qj(s,e,t){const n=om(e,t.path),a=n[1],l=IDBKeyRange.lowerBound(n);let u=!1;return Tc(s).ee({range:l,X:!0},((h,m,p)=>{const[x,w,b]=h;x===e&&w===a&&(u=!0),p.done()})).next((()=>u))}function Mi(s){return On(s,Pr)}function Tc(s){return On(s,Vc)}function Yj(s){return On(s,Xd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ml(0)}static cr(){return new ml(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const n=new ml(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>Oe.fromTimestamp(new Nt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.lr(e).next((a=>(a.highestListenSequenceNumber=t,n&&(a.lastRemoteSnapshotVersion=n.toTimestamp()),t>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=t),this.hr(e,a))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>vc(e).delete(t.targetId))).next((()=>this.lr(e))).next((n=>(De(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n))))}removeTargets(e,t,n){let a=0;const l=[];return vc(e).ee(((u,h)=>{const m=kd(h);m.sequenceNumber<=t&&n.get(m.targetId)===null&&(a++,l.push(this.removeTargetData(e,m)))})).next((()=>J.waitFor(l))).next((()=>a))}forEachTarget(e,t){return vc(e).ee(((n,a)=>{const l=kd(a);t(l)}))}lr(e){return fT(e).get(km).next((t=>(De(t!==null,2888),t)))}hr(e,t){return fT(e).put(km,t)}Pr(e,t){return vc(e).put(zj(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const n=cl(t),a=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let l=null;return vc(e).ee({range:a,index:OS},((u,h,m)=>{const p=kd(h);gh(t,p.target)&&(l=p,m.done())})).next((()=>l))}addMatchingKeys(e,t,n){const a=[],l=Bi(e);return t.forEach((u=>{const h=fs(u.path);a.push(l.put({targetId:n,path:h})),a.push(this.referenceDelegate.addReference(e,n,u))})),J.waitFor(a)}removeMatchingKeys(e,t,n){const a=Bi(e);return J.forEach(t,(l=>{const u=fs(l.path);return J.waitFor([a.delete([n,u]),this.referenceDelegate.removeReference(e,n,l)])}))}removeMatchingKeysForTargetId(e,t){const n=Bi(e),a=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(a)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),a=Bi(e);let l=Xe();return a.ee({range:n,X:!0},((u,h,m)=>{const p=ua(u[1]),x=new _e(p);l=l.add(x)})).next((()=>l))}containsKey(e,t){const n=fs(t.path),a=IDBKeyRange.bound([n],[TS(n)],!1,!0);let l=0;return Bi(e).ee({index:gv,X:!0,range:a},(([u,h],m,p)=>{u!==0&&(l++,p.done())})).next((()=>l>0))}At(e,t){return vc(e).get(t).next((n=>n?kd(n):null))}}function vc(s){return On(s,Lc)}function fT(s){return On(s,nl)}function Bi(s){return On(s,Fc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mT="LruGarbageCollector",Xj=1048576;function gT([s,e],[t,n]){const a=qe(s,t);return a===0?qe(e,n):a}class Z4{constructor(e){this.Ir=e,this.buffer=new kt(gT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();gT(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Wj{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){pe(mT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){io(t)?pe(mT,"Ignoring IndexedDB error during garbage collection: ",t):await ao(t)}await this.Vr(3e5)}))}}class eP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return J.resolve(Cs.ce);const n=new Z4(t);return this.mr.forEachTarget(e,(a=>n.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>n.Ar(a))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),J.resolve(hT)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hT):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,a,l,u,h,m,p;const x=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((w=>(w>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),a=this.params.maximumSequenceNumbersToCollect):a=w,u=Date.now(),this.nthSequenceNumber(e,a)))).next((w=>(n=w,h=Date.now(),this.removeTargets(e,n,t)))).next((w=>(l=w,m=Date.now(),this.removeOrphanedDocuments(e,n)))).next((w=>(p=Date.now(),wc()<=lt.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-x}ms
	Determined least recently used ${a} in `+(h-u)+`ms
	Removed ${l} targets in `+(m-h)+`ms
	Removed ${w} documents in `+(p-m)+`ms
Total Duration: ${p-x}ms`),J.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:w}))))}}function Jj(s,e){return new eP(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e,t){this.db=e,this.garbageCollector=Jj(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((n=>t.next((a=>n+a))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((n,a)=>t(a)))}addReference(e,t,n){return Qf(e,n)}removeReference(e,t,n){return Qf(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Qf(e,t)}br(e,t){return(function(a,l){let u=!1;return Yj(a).te((h=>Qj(a,h,l).next((m=>(m&&(u=!0),J.resolve(!m)))))).next((()=>u))})(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[];let l=0;return this.Sr(e,((u,h)=>{if(h<=t){const m=this.br(e,u).next((p=>{if(!p)return l++,n.getEntry(e,u).next((()=>(n.removeEntry(u,Oe.min()),Bi(e).delete((function(w){return[0,fs(w.path)]})(u)))))}));a.push(m)}})).next((()=>J.waitFor(a))).next((()=>n.apply(e))).next((()=>l))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Qf(e,t)}Sr(e,t){const n=Bi(e);let a,l=Cs.ce;return n.ee({index:gv},(([u,h],{path:m,sequenceNumber:p})=>{u===0?(l!==Cs.ce&&t(new _e(ua(a)),l),l=p,a=m):l=Cs.ce})).next((()=>{l!==Cs.ce&&t(new _e(ua(a)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Qf(s,e){return Bi(s).put((function(n,a){return{targetId:0,path:fs(n.path),sequenceNumber:a}})(e,s.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(){this.changes=new si((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,zt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?J.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return zo(e).put(n)}removeEntry(e,t,n){return zo(e).delete((function(l,u){const h=l.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],Mm(u),h[h.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Dr(e,n))))}getEntry(e,t){let n=zt.newInvalidDocument(t);return zo(e).ee({index:lm,range:IDBKeyRange.only(wd(t))},((a,l)=>{n=this.Cr(t,l)})).next((()=>n))}vr(e,t){let n={size:0,document:zt.newInvalidDocument(t)};return zo(e).ee({index:lm,range:IDBKeyRange.only(wd(t))},((a,l)=>{n={document:this.Cr(t,l),size:Vm(l)}})).next((()=>n))}getEntries(e,t){let n=ks();return this.Fr(e,t,((a,l)=>{const u=this.Cr(a,l);n=n.insert(a,u)})).next((()=>n))}Mr(e,t){let n=ks(),a=new qt(_e.comparator);return this.Fr(e,t,((l,u)=>{const h=this.Cr(l,u);n=n.insert(l,h),a=a.insert(l,Vm(u))})).next((()=>({documents:n,Or:a})))}Fr(e,t,n){if(t.isEmpty())return J.resolve();let a=new kt(xT);t.forEach((m=>a=a.add(m)));const l=IDBKeyRange.bound(wd(a.first()),wd(a.last())),u=a.getIterator();let h=u.getNext();return zo(e).ee({index:lm,range:l},((m,p,x)=>{const w=_e.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;h&&xT(h,w)<0;)n(h,null),h=u.getNext();h&&h.isEqual(w)&&(n(h,p),h=u.hasNext()?u.getNext():null),h?x.j(wd(h)):x.done()})).next((()=>{for(;h;)n(h,null),h=u.hasNext()?u.getNext():null}))}getDocumentsMatchingQuery(e,t,n,a,l){const u=t.path,h=[u.popLast().toArray(),u.lastSegment(),Mm(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],m=[u.popLast().toArray(),u.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return zo(e).J(IDBKeyRange.bound(h,m,!0)).next((p=>{l?.incrementDocumentReadCount(p.length);let x=ks();for(const w of p){const b=this.Cr(_e.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);b.isFoundDocument()&&(yh(t,b)||a.has(b.key))&&(x=x.insert(b.key,b))}return x}))}getAllFromCollectionGroup(e,t,n,a){let l=ks();const u=yT(t,n),h=yT(t,er.max());return zo(e).ee({index:MS,range:IDBKeyRange.bound(u,h,!0)},((m,p,x)=>{const w=this.Cr(_e.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);l=l.insert(w.key,w),l.size===a&&x.done()})).next((()=>l))}newChangeBuffer(e){return new sP(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return pT(e).get(wx).next((t=>(De(!!t,20021),t)))}Dr(e,t){return pT(e).put(wx,t)}Cr(e,t){if(t){const n=q4(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Oe.min())))return n}return zt.newInvalidDocument(e)}}function eA(s){return new nP(s)}class sP extends Zj{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new si((n=>n.toString()),((n,a)=>n.isEqual(a)))}applyChanges(e){const t=[];let n=0,a=new kt(((l,u)=>qe(l.canonicalString(),u.canonicalString())));return this.changes.forEach(((l,u)=>{const h=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,h.readTime)),u.isValidDocument()){const m=ZN(this.Nr.serializer,u);a=a.add(l.path.popLast());const p=Vm(m);n+=p-h.size,t.push(this.Nr.addEntry(e,l,m))}else if(n-=h.size,this.trackRemovals){const m=ZN(this.Nr.serializer,u.convertToNoDocument(Oe.min()));t.push(this.Nr.addEntry(e,l,m))}})),a.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,n)),J.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:n,Or:a})=>(a.forEach(((l,u)=>{this.Br.set(l,{size:u,readTime:n.get(l).readTime})})),n)))}}function pT(s){return On(s,Wd)}function zo(s){return On(s,Im)}function wd(s){const e=s.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yT(s,e){const t=e.documentKey.path.toArray();return[s,Mm(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function xT(s,e){const t=s.path.toArray(),n=e.path.toArray();let a=0;for(let l=0;l<t.length-2&&l<n.length-2;++l)if(a=qe(t[l],n[l]),a)return a;return a=qe(t.length,n.length),a||(a=qe(t[t.length-2],n[n.length-2]),a||qe(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tA{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((a=>(n=a,this.remoteDocumentCache.getEntry(e,t)))).next((a=>(n!==null&&qd(n.mutation,a,Is.empty(),Nt.now()),a)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,Xe()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=Xe()){const a=da();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,n).next((l=>{let u=Cd();return l.forEach(((h,m)=>{u=u.insert(h,m.overlayedDocument)})),u}))))}getOverlayedDocuments(e,t){const n=da();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Xe())))}populateOverlays(e,t,n){const a=[];return n.forEach((l=>{t.has(l)||a.push(l)})),this.documentOverlayCache.getOverlays(e,a).next((l=>{l.forEach(((u,h)=>{t.set(u,h)}))}))}computeViews(e,t,n,a){let l=ks();const u=Bd(),h=(function(){return Bd()})();return t.forEach(((m,p)=>{const x=n.get(p.key);a.has(p.key)&&(x===void 0||x.mutation instanceof ri)?l=l.insert(p.key,p):x!==void 0?(u.set(p.key,x.mutation.getFieldMask()),qd(x.mutation,p,x.mutation.getFieldMask(),Nt.now())):u.set(p.key,Is.empty())})),this.recalculateAndSaveOverlays(e,l).next((m=>(m.forEach(((p,x)=>u.set(p,x))),t.forEach(((p,x)=>h.set(p,new rP(x,u.get(p)??null)))),h)))}recalculateAndSaveOverlays(e,t){const n=Bd();let a=new qt(((u,h)=>u-h)),l=Xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((u=>{for(const h of u)h.keys().forEach((m=>{const p=t.get(m);if(p===null)return;let x=n.get(m)||Is.empty();x=h.applyToLocalView(p,x),n.set(m,x);const w=(a.get(h.batchId)||Xe()).add(m);a=a.insert(h.batchId,w)}))})).next((()=>{const u=[],h=a.getReverseIterator();for(;h.hasNext();){const m=h.getNext(),p=m.key,x=m.value,w=pj();x.forEach((b=>{if(!l.has(b)){const E=Nj(t.get(b),n.get(b));E!==null&&w.set(b,E),l=l.add(b)}})),u.push(this.documentOverlayCache.saveOverlays(e,p,w))}return J.waitFor(u)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,a){return(function(u){return _e.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):_v(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next((l=>{const u=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-l.size):J.resolve(da());let h=Pc,m=l;return u.next((p=>J.forEach(p,((x,w)=>(h<w.largestBatchId&&(h=w.largestBatchId),l.get(x)?J.resolve():this.remoteDocumentCache.getEntry(e,x).next((b=>{m=m.insert(x,b)}))))).next((()=>this.populateOverlays(e,p,l))).next((()=>this.computeViews(e,m,p,Xe()))).next((x=>({batchId:h,changes:gj(x)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new _e(t)).next((n=>{let a=Cd();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const l=t.collectionGroup;let u=Cd();return this.indexManager.getCollectionParents(e,l).next((h=>J.forEach(h,(m=>{const p=(function(w,b){return new ni(b,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)})(t,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,n,a).next((x=>{x.forEach(((w,b)=>{u=u.insert(w,b)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,t,n,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,l,a)))).next((u=>{l.forEach(((m,p)=>{const x=p.getKey();u.get(x)===null&&(u=u.insert(x,zt.newInvalidDocument(x)))}));let h=Cd();return u.forEach(((m,p)=>{const x=l.get(m);x!==void 0&&qd(x.mutation,p,Is.empty(),Nt.now()),yh(t,p)&&(h=h.insert(m,p))})),h}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aP{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return J.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(a){return{id:a.id,version:a.version,createTime:xn(a.createTime)}})(t)),J.resolve()}getNamedQuery(e,t){return J.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(a){return{name:a.name,query:yg(a.bundledQuery),readTime:xn(a.readTime)}})(t)),J.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(){this.overlays=new qt(_e.comparator),this.qr=new Map}getOverlay(e,t){return J.resolve(this.overlays.get(t))}getOverlays(e,t){const n=da();return J.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&n.set(a,l)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((a,l)=>{this.St(e,t,l)})),J.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.qr.get(n);return a!==void 0&&(a.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(n)),J.resolve()}getOverlaysForCollection(e,t,n){const a=da(),l=t.length+1,u=new _e(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const m=h.getNext().value,p=m.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&m.largestBatchId>n&&a.set(m.getKey(),m)}return J.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let l=new qt(((p,x)=>p-x));const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>n){let x=l.get(p.largestBatchId);x===null&&(x=da(),l=l.insert(p.largestBatchId,x)),x.set(p.getKey(),p)}}const h=da(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach(((p,x)=>h.set(p,x))),!(h.size()>=a)););return J.resolve(h)}St(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const u=this.qr.get(a.largestBatchId).delete(n.key);this.qr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(n.key,new Av(t,n));let l=this.qr.get(t);l===void 0&&(l=Xe(),this.qr.set(t,l)),this.qr.set(t,l.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(){this.sessionToken=ln.EMPTY_BYTE_STRING}getSessionToken(e){return J.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,J.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(){this.Qr=new kt(Qn.$r),this.Ur=new kt(Qn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Qn(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new Qn(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new _e(new tt([])),n=new Qn(t,e),a=new Qn(t,e+1),l=[];return this.Ur.forEachInRange([n,a],(u=>{this.Gr(u),l.push(u.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new _e(new tt([])),n=new Qn(t,e),a=new Qn(t,e+1);let l=Xe();return this.Ur.forEachInRange([n,a],(u=>{l=l.add(u.key)})),l}containsKey(e){const t=new Qn(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Qn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return _e.comparator(e.key,t.key)||qe(e.Yr,t.Yr)}static Kr(e,t){return qe(e.Yr,t.Yr)||_e.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new kt(Qn.$r)}checkEmpty(e){return J.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new Sv(l,t,n,a);this.mutationQueue.push(u);for(const h of a)this.Zr=this.Zr.add(new Qn(h.key,l)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return J.resolve(u)}lookupMutationBatch(e,t){return J.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.ei(n),l=a<0?0:a;return J.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return J.resolve(this.mutationQueue.length===0?Yi:this.tr-1)}getAllMutationBatches(e){return J.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Qn(t,0),a=new Qn(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([n,a],(u=>{const h=this.Xr(u.Yr);l.push(h)})),J.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new kt(qe);return t.forEach((a=>{const l=new Qn(a,0),u=new Qn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,u],(h=>{n=n.add(h.Yr)}))})),J.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let l=n;_e.isDocumentKey(l)||(l=l.child(""));const u=new Qn(new _e(l),0);let h=new kt(qe);return this.Zr.forEachWhile((m=>{const p=m.key.path;return!!n.isPrefixOf(p)&&(p.length===a&&(h=h.add(m.Yr)),!0)}),u),J.resolve(this.ti(h))}ti(e){const t=[];return e.forEach((n=>{const a=this.Xr(n);a!==null&&t.push(a)})),t}removeMutationBatch(e,t){De(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return J.forEach(t.mutations,(a=>{const l=new Qn(a.key,t.batchId);return n=n.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new Qn(t,0),a=this.Zr.firstAfterOrEqual(n);return J.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,J.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.ri=e,this.docs=(function(){return new qt(_e.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),l=a?a.size:0,u=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return J.resolve(n?n.document.mutableCopy():zt.newInvalidDocument(t))}getEntries(e,t){let n=ks();return t.forEach((a=>{const l=this.docs.get(a);n=n.insert(a,l?l.document.mutableCopy():zt.newInvalidDocument(a))})),J.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let l=ks();const u=t.path,h=new _e(u.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(h);for(;m.hasNext();){const{key:p,value:{document:x}}=m.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||fv(CS(x),n)<=0||(a.has(x.key)||yh(t,x))&&(l=l.insert(x.key,x.mutableCopy()))}return J.resolve(l)}getAllFromCollectionGroup(e,t,n,a){Se(9500)}ii(e,t){return J.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new uP(this)}getSize(e){return J.resolve(this.size)}}class uP extends Zj{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,a)=>{a.isValidDocument()?t.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(n)})),J.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dP{constructor(e){this.persistence=e,this.si=new si((t=>cl(t)),gh),this.lastRemoteSnapshotVersion=Oe.min(),this.highestTargetId=0,this.oi=0,this._i=new Dv,this.targetCount=0,this.ai=ml.ur()}forEachTarget(e,t){return this.si.forEach(((n,a)=>t(a))),J.resolve()}getLastRemoteSnapshotVersion(e){return J.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return J.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),J.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),J.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new ml(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,J.resolve()}updateTargetData(e,t){return this.Pr(t),J.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,J.resolve()}removeTargets(e,t,n){let a=0;const l=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=t&&n.get(h.targetId)===null&&(this.si.delete(u),l.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),J.waitFor(l).next((()=>a))}getTargetCount(e){return J.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return J.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),J.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const a=this.persistence.referenceDelegate,l=[];return a&&t.forEach((u=>{l.push(a.markPotentiallyOrphaned(e,u))})),J.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),J.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return J.resolve(n)}containsKey(e,t){return J.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{constructor(e,t){this.ui={},this.overlays={},this.ci=new Cs(0),this.li=!1,this.li=!0,this.hi=new oP,this.referenceDelegate=e(this),this.Pi=new dP(this),this.indexManager=new X4,this.remoteDocumentCache=(function(a){return new cP(a)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new qj(t),this.Ii=new aP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new iP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new lP(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){pe("MemoryPersistence","Starting transaction:",e);const a=new hP(this.ci.next());return this.referenceDelegate.Ei(),n(a).next((l=>this.referenceDelegate.di(a).next((()=>l)))).toPromise().then((l=>(a.raiseOnCommittedEvent(),l)))}Ai(e,t){return J.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class hP extends kS{constructor(e){super(),this.currentSequenceNumber=e}}class bg{constructor(e){this.persistence=e,this.Ri=new Dv,this.Vi=null}static mi(e){return new bg(e)}get fi(){if(this.Vi)return this.Vi;throw Se(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),J.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),J.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),J.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((a=>this.fi.add(a.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((a=>{a.forEach((l=>this.fi.add(l.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return J.forEach(this.fi,(n=>{const a=_e.fromPath(n);return this.gi(e,a).next((l=>{l||t.removeEntry(a,Oe.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return J.or([()=>J.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Lm{constructor(e,t){this.persistence=e,this.pi=new si((n=>fs(n.path)),((n,a)=>n.isEqual(a))),this.garbageCollector=Jj(this,t)}static mi(e,t){return new Lm(e,t)}Ei(){}di(e){return J.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((a=>n+a))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return J.forEach(this.pi,((n,a)=>this.br(e,n,a).next((l=>l?J.resolve():t(a)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ii(e,(u=>this.br(e,u,t).next((h=>{h||(n++,l.removeEntry(u,Oe.min()))})))).next((()=>l.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),J.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),J.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),J.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),J.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=um(e.data.value)),t}br(e,t,n){return J.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const a=this.pi.get(t);return J.resolve(a!==void 0&&a>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e){this.serializer=e}k(e,t,n,a){const l=new ig("createOrUpgrade",t);n<1&&a>=1&&((function(m){m.createObjectStore(mh)})(e),(function(m){m.createObjectStore(Xd,{keyPath:kD}),m.createObjectStore(Pr,{keyPath:CN,autoIncrement:!0}).createIndex(Zo,IN,{unique:!0}),m.createObjectStore(Vc)})(e),vT(e),(function(m){m.createObjectStore(Ko)})(e));let u=J.resolve();return n<3&&a>=3&&(n!==0&&((function(m){m.deleteObjectStore(Fc),m.deleteObjectStore(Lc),m.deleteObjectStore(nl)})(e),vT(e)),u=u.next((()=>(function(m){const p=m.store(nl),x={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Oe.min().toTimestamp(),targetCount:0};return p.put(km,x)})(l)))),n<4&&a>=4&&(n!==0&&(u=u.next((()=>(function(m,p){return p.store(Pr).J().next((w=>{m.deleteObjectStore(Pr),m.createObjectStore(Pr,{keyPath:CN,autoIncrement:!0}).createIndex(Zo,IN,{unique:!0});const b=p.store(Pr),E=w.map((k=>b.put(k)));return J.waitFor(E)}))})(e,l)))),u=u.next((()=>{(function(m){m.createObjectStore(Uc,{keyPath:UD})})(e)}))),n<5&&a>=5&&(u=u.next((()=>this.yi(l)))),n<6&&a>=6&&(u=u.next((()=>((function(m){m.createObjectStore(Wd)})(e),this.wi(l))))),n<7&&a>=7&&(u=u.next((()=>this.Si(l)))),n<8&&a>=8&&(u=u.next((()=>this.bi(e,l)))),n<9&&a>=9&&(u=u.next((()=>{(function(m){m.objectStoreNames.contains("remoteDocumentChanges")&&m.deleteObjectStore("remoteDocumentChanges")})(e)}))),n<10&&a>=10&&(u=u.next((()=>this.Di(l)))),n<11&&a>=11&&(u=u.next((()=>{(function(m){m.createObjectStore(og,{keyPath:BD})})(e),(function(m){m.createObjectStore(lg,{keyPath:qD})})(e)}))),n<12&&a>=12&&(u=u.next((()=>{(function(m){const p=m.createObjectStore(cg,{keyPath:YD});p.createIndex(Nx,XD,{unique:!1}),p.createIndex(FS,WD,{unique:!1})})(e)}))),n<13&&a>=13&&(u=u.next((()=>(function(m){const p=m.createObjectStore(Im,{keyPath:DD});p.createIndex(lm,PD),p.createIndex(MS,MD)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(Ko)))),n<14&&a>=14&&(u=u.next((()=>this.Fi(e,l)))),n<15&&a>=15&&(u=u.next((()=>(function(m){m.createObjectStore(pv,{keyPath:zD,autoIncrement:!0}).createIndex(_x,HD,{unique:!1}),m.createObjectStore(Ld,{keyPath:GD}).createIndex(VS,$D,{unique:!1}),m.createObjectStore(Fd,{keyPath:KD}).createIndex(LS,QD,{unique:!1})})(e)))),n<16&&a>=16&&(u=u.next((()=>{t.objectStore(Ld).clear()})).next((()=>{t.objectStore(Fd).clear()}))),n<17&&a>=17&&(u=u.next((()=>{(function(m){m.createObjectStore(yv,{keyPath:JD})})(e)}))),n<18&&a>=18&&jE()&&(u=u.next((()=>{t.objectStore(Ld).clear()})).next((()=>{t.objectStore(Fd).clear()}))),u}wi(e){let t=0;return e.store(Ko).ee(((n,a)=>{t+=Vm(a)})).next((()=>{const n={byteSize:t};return e.store(Wd).put(wx,n)}))}yi(e){const t=e.store(Xd),n=e.store(Pr);return t.J().next((a=>J.forEach(a,(l=>{const u=IDBKeyRange.bound([l.userId,Yi],[l.userId,l.lastAcknowledgedBatchId]);return n.J(Zo,u).next((h=>J.forEach(h,(m=>{De(m.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:m.batchId});const p=Yo(this.serializer,m);return Kj(e,l.userId,p).next((()=>{}))}))))}))))}Si(e){const t=e.store(Fc),n=e.store(Ko);return e.store(nl).get(km).next((a=>{const l=[];return n.ee(((u,h)=>{const m=new tt(u),p=(function(w){return[0,fs(w)]})(m);l.push(t.get(p).next((x=>x?J.resolve():(w=>t.put({targetId:0,path:fs(w),sequenceNumber:a.highestListenSequenceNumber}))(m))))})).next((()=>J.waitFor(l)))}))}bi(e,t){e.createObjectStore(Jd,{keyPath:FD});const n=t.store(Jd),a=new Rv,l=u=>{if(a.add(u)){const h=u.lastSegment(),m=u.popLast();return n.put({collectionId:h,parent:fs(m)})}};return t.store(Ko).ee({X:!0},((u,h)=>{const m=new tt(u);return l(m.popLast())})).next((()=>t.store(Vc).ee({X:!0},(([u,h,m],p)=>{const x=ua(h);return l(x.popLast())}))))}Di(e){const t=e.store(Lc);return t.ee(((n,a)=>{const l=kd(a),u=zj(this.serializer,l);return t.put(u)}))}Ci(e,t){const n=t.store(Ko),a=[];return n.ee(((l,u)=>{const h=t.store(Im),m=(function(w){return w.document?new _e(tt.fromString(w.document.name).popFirst(5)):w.noDocument?_e.fromSegments(w.noDocument.path):w.unknownDocument?_e.fromSegments(w.unknownDocument.path):Se(36783)})(u).path.toArray(),p={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};a.push(h.put(p))})).next((()=>J.waitFor(a)))}Fi(e,t){const n=t.store(Pr),a=eA(this.serializer),l=new Pv(bg.mi,this.serializer.yt);return n.J().next((u=>{const h=new Map;return u.forEach((m=>{let p=h.get(m.userId)??Xe();Yo(this.serializer,m).keys().forEach((x=>p=p.add(x))),h.set(m.userId,p)})),J.forEach(h,((m,p)=>{const x=new Yn(p),w=xg.wt(this.serializer,x),b=l.getIndexManager(x),E=vg.wt(x,this.serializer,b,l.referenceDelegate);return new tA(a,E,w,b).recalculateAndSaveOverlaysForDocumentKeys(new Tx(t,Cs.ce),m).next()}))}))}}function vT(s){s.createObjectStore(Fc,{keyPath:VD}).createIndex(gv,LD,{unique:!0}),s.createObjectStore(Lc,{keyPath:"targetId"}).createIndex(OS,OD,{unique:!0}),s.createObjectStore(nl)}const Oi="IndexedDbPersistence",$y=18e5,Ky=5e3,Qy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",nA="main";class Mv{constructor(e,t,n,a,l,u,h,m,p,x,w=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=l,this.window=u,this.document=h,this.xi=p,this.Oi=x,this.Ni=w,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=b=>Promise.resolve(),!Mv.v())throw new he(re.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new tP(this,a),this.$i=t+nA,this.serializer=new qj(m),this.Ui=new fa(this.$i,this.Ni,new fP(this.serializer)),this.hi=new H4,this.Pi=new J4(this.referenceDelegate,this.serializer),this.remoteDocumentCache=eA(this.serializer),this.Ii=new z4,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,x===!1&&yn(Oi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new he(re.FAILED_PRECONDITION,Qy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new Cs(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Yf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(io(e))return pe(Oi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return pe(Oi,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return _d(e).get(mc).next((t=>J.resolve(this.es(t))))}ts(e){return Yf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,$y)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const n=On(t,Uc);return n.J().next((a=>{const l=this.ss(a,$y),u=a.filter((h=>l.indexOf(h)===-1));return J.forEach(u,(h=>n.delete(h.clientId))).next((()=>u))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?J.resolve(!0):_d(e).get(mc).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Ky)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new he(re.FAILED_PRECONDITION,Qy);return!1}}return!(!this.networkEnabled||!this.inForeground)||Yf(e).J().next((n=>this.ss(n,Ky).find((a=>{if(this.clientId!==a.clientId){const l=!this.networkEnabled&&a.networkEnabled,u=!this.inForeground&&a.inForeground,h=this.networkEnabled===a.networkEnabled;if(l||u&&h)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&pe(Oi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[mh,Uc],(e=>{const t=new Tx(e,Cs.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>Yf(e).J().next((t=>this.ss(t,$y).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return vg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new W4(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return xg.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){pe(Oi,"Starting transaction:",e);const a=t==="readonly"?"readonly":"readwrite",l=(function(m){return m===18?t4:m===17?zS:m===16?e4:m===15?xv:m===14?qS:m===13?BS:m===12?ZD:m===11?US:void Se(60245)})(this.Ni);let u;return this.Ui.runTransaction(e,a,l,(h=>(u=new Tx(h,this.ci?this.ci.next():Cs.ce),t==="readwrite-primary"?this.Hi(u).next((m=>!!m||this.Yi(u))).next((m=>{if(!m)throw yn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new he(re.FAILED_PRECONDITION,IS);return n(u)})).next((m=>this.Xi(u).next((()=>m)))):this.Is(u).next((()=>n(u)))))).then((h=>(u.raiseOnCommittedEvent(),h)))}Is(e){return _d(e).get(mc).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Ky)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new he(re.FAILED_PRECONDITION,Qy)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _d(e).put(mc,t)}static v(){return fa.v()}Zi(e){const t=_d(e);return t.get(mc).next((n=>this.es(n)?(pe(Oi,"Releasing primary lease."),t.delete(mc)):J.resolve()))}rs(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(yn(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;SE()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return pe(Oi,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return yn(Oi,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){yn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function _d(s){return On(s,mh)}function Yf(s){return On(s,Uc)}function Ov(s,e){let t=s.projectId;return s.isDefaultDatabase||(t+="."+s.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=a}static As(e,t){let n=Xe(),a=Xe();for(const l of t.docChanges)switch(l.type){case 0:n=n.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new Vv(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return SE()?8:RS(Pn())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,a){const l={result:null};return this.ys(e,t).next((u=>{l.result=u})).next((()=>{if(!l.result)return this.ws(e,t,a,n).next((u=>{l.result=u}))})).next((()=>{if(l.result)return;const u=new mP;return this.Ss(e,t,u).next((h=>{if(l.result=h,this.Vs)return this.bs(e,t,u,h.size)}))})).next((()=>l.result))}bs(e,t,n,a){return n.documentReadCount<this.fs?(wc()<=lt.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",_c(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),J.resolve()):(wc()<=lt.DEBUG&&pe("QueryEngine","Query:",_c(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.gs*a?(wc()<=lt.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",_c(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ms(t))):J.resolve())}ys(e,t){if(zN(t))return J.resolve(null);let n=ms(t);return this.indexManager.getIndexType(e,n).next((a=>a===0?null:(t.limit!==null&&a===1&&(t=Pm(t,null,"F"),n=ms(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((l=>{const u=Xe(...l);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,n).next((m=>{const p=this.Ds(t,h);return this.Cs(t,p,u,m.readTime)?this.ys(e,Pm(t,null,"F")):this.vs(e,p,t,m)}))))})))))}ws(e,t,n,a){return zN(t)||a.isEqual(Oe.min())?J.resolve(null):this.ps.getDocuments(e,n).next((l=>{const u=this.Ds(t,l);return this.Cs(t,u,n,a)?J.resolve(null):(wc()<=lt.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),_c(t)),this.vs(e,u,t,AS(a,Pc)).next((h=>h)))}))}Ds(e,t){let n=new kt(fj(e));return t.forEach(((a,l)=>{yh(e,l)&&(n=n.add(l))})),n}Cs(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Ss(e,t,n){return wc()<=lt.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",_c(t)),this.ps.getDocumentsMatchingQuery(e,t,er.min(),n)}vs(e,t,n,a){return this.ps.getDocumentsMatchingQuery(e,n,a).next((l=>(t.forEach((u=>{l=l.insert(u.key,u)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv="LocalStore",gP=3e8;class pP{constructor(e,t,n,a){this.persistence=e,this.Fs=t,this.serializer=a,this.Ms=new qt(qe),this.xs=new si((l=>cl(l)),gh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tA(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function rA(s,e,t,n){return new pP(s,e,t,n)}async function aA(s,e){const t=Ne(s);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next((l=>(a=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((l=>{const u=[],h=[];let m=Xe();for(const p of a){u.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}for(const p of l){h.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}return t.localDocuments.getDocuments(n,m).next((p=>({Ls:p,removedBatchIds:u,addedBatchIds:h})))}))}))}function yP(s,e){const t=Ne(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const a=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,m,p,x){const w=p.batch,b=w.keys();let E=J.resolve();return b.forEach((k=>{E=E.next((()=>x.getEntry(m,k))).next((R=>{const U=p.docVersions.get(k);De(U!==null,48541),R.version.compareTo(U)<0&&(w.applyToRemoteDocument(R,p),R.isValidDocument()&&(R.setReadTime(p.commitVersion),x.addEntry(R)))}))})),E.next((()=>h.mutationQueue.removeMutationBatch(m,w)))})(t,n,e,l).next((()=>l.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(h){let m=Xe();for(let p=0;p<h.mutationResults.length;++p)h.mutationResults[p].transformResults.length>0&&(m=m.add(h.batch.mutations[p].key));return m})(e)))).next((()=>t.localDocuments.getDocuments(n,a)))}))}function iA(s){const e=Ne(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function xP(s,e){const t=Ne(s),n=e.snapshotVersion;let a=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const u=t.Ns.newChangeBuffer({trackRemovals:!0});a=t.Ms;const h=[];e.targetChanges.forEach(((x,w)=>{const b=a.get(w);if(!b)return;h.push(t.Pi.removeMatchingKeys(l,x.removedDocuments,w).next((()=>t.Pi.addMatchingKeys(l,x.addedDocuments,w))));let E=b.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(w)!==null?E=E.withResumeToken(ln.EMPTY_BYTE_STRING,Oe.min()).withLastLimboFreeSnapshotVersion(Oe.min()):x.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(x.resumeToken,n)),a=a.insert(w,E),(function(R,U,z){return R.resumeToken.approximateByteSize()===0||U.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=gP?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0})(b,E,x)&&h.push(t.Pi.updateTargetData(l,E))}));let m=ks(),p=Xe();if(e.documentUpdates.forEach((x=>{e.resolvedLimboDocuments.has(x)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(l,x))})),h.push(oA(l,u,e.documentUpdates).next((x=>{m=x.ks,p=x.qs}))),!n.isEqual(Oe.min())){const x=t.Pi.getLastRemoteSnapshotVersion(l).next((w=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,n)));h.push(x)}return J.waitFor(h).next((()=>u.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,m,p))).next((()=>m))})).then((l=>(t.Ms=a,l)))}function oA(s,e,t){let n=Xe(),a=Xe();return t.forEach((l=>n=n.add(l))),e.getEntries(s,n).next((l=>{let u=ks();return t.forEach(((h,m)=>{const p=l.get(h);m.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(h)),m.isNoDocument()&&m.version.isEqual(Oe.min())?(e.removeEntry(h,m.readTime),u=u.insert(h,m)):!p.isValidDocument()||m.version.compareTo(p.version)>0||m.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(m),u=u.insert(h,m)):pe(Lv,"Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",m.version)})),{ks:u,qs:a}}))}function vP(s,e){const t=Ne(s);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Yi),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function Kc(s,e){const t=Ne(s);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let a;return t.Pi.getTargetData(n,e).next((l=>l?(a=l,J.resolve(a)):t.Pi.allocateTargetId(n).next((u=>(a=new Ha(e,u,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,a).next((()=>a)))))))})).then((n=>{const a=t.Ms.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function Qc(s,e,t){const n=Ne(s),a=n.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",l,(u=>n.persistence.referenceDelegate.removeTarget(u,a)))}catch(u){if(!io(u))throw u;pe(Lv,`Failed to update sequence numbers for target ${e}: ${u}`)}n.Ms=n.Ms.remove(e),n.xs.delete(a.target)}function Fm(s,e,t){const n=Ne(s);let a=Oe.min(),l=Xe();return n.persistence.runTransaction("Execute query","readwrite",(u=>(function(m,p,x){const w=Ne(m),b=w.xs.get(x);return b!==void 0?J.resolve(w.Ms.get(b)):w.Pi.getTargetData(p,x)})(n,u,ms(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(u,h.targetId).next((m=>{l=m}))})).next((()=>n.Fs.getDocumentsMatchingQuery(u,e,t?a:Oe.min(),t?l:Xe()))).next((h=>(uA(n,hj(e),h),{documents:h,Qs:l})))))}function lA(s,e){const t=Ne(s),n=Ne(t.Pi),a=t.Ms.get(e);return a?Promise.resolve(a.target):t.persistence.runTransaction("Get target data","readonly",(l=>n.At(l,e).next((u=>u?u.target:null))))}function cA(s,e){const t=Ne(s),n=t.Os.get(e)||Oe.min();return t.persistence.runTransaction("Get new document changes","readonly",(a=>t.Ns.getAllFromCollectionGroup(a,e,AS(n,Pc),Number.MAX_SAFE_INTEGER))).then((a=>(uA(t,e,a),a)))}function uA(s,e,t){let n=s.Os.get(e)||Oe.min();t.forEach(((a,l)=>{l.readTime.compareTo(n)>0&&(n=l.readTime)})),s.Os.set(e,n)}async function bP(s,e,t,n){const a=Ne(s);let l=Xe(),u=ks();for(const p of t){const x=e.$s(p.metadata.name);p.document&&(l=l.add(x));const w=e.Us(p);w.setReadTime(e.Ks(p.metadata.readTime)),u=u.insert(x,w)}const h=a.Ns.newChangeBuffer({trackRemovals:!0}),m=await Kc(a,(function(x){return ms(ou(tt.fromString(`__bundle__/docs/${x}`)))})(n));return a.persistence.runTransaction("Apply bundle documents","readwrite",(p=>oA(p,h,u).next((x=>(h.apply(p),x))).next((x=>a.Pi.removeMatchingKeysForTargetId(p,m.targetId).next((()=>a.Pi.addMatchingKeys(p,l,m.targetId))).next((()=>a.localDocuments.getLocalViewOfDocuments(p,x.ks,x.qs))).next((()=>x.ks))))))}async function wP(s,e,t=Xe()){const n=await Kc(s,ms(yg(e.bundledQuery))),a=Ne(s);return a.persistence.runTransaction("Save named query","readwrite",(l=>{const u=xn(e.readTime);if(n.snapshotVersion.compareTo(u)>=0)return a.Ii.saveNamedQuery(l,e);const h=n.withResumeToken(ln.EMPTY_BYTE_STRING,u);return a.Ms=a.Ms.insert(h.targetId,h),a.Pi.updateTargetData(l,h).next((()=>a.Pi.removeMatchingKeysForTargetId(l,n.targetId))).next((()=>a.Pi.addMatchingKeys(l,t,n.targetId))).next((()=>a.Ii.saveNamedQuery(l,e)))}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dA="firestore_clients";function bT(s,e){return`${dA}_${s}_${e}`}const hA="firestore_mutations";function wT(s,e,t){let n=`${hA}_${s}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}const fA="firestore_targets";function Yy(s,e){return`${fA}_${s}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ia="SharedClientState";class Um{constructor(e,t,n,a){this.user=e,this.batchId=t,this.state=n,this.error=a}static Ws(e,t,n){const a=JSON.parse(n);let l,u=typeof a=="object"&&["pending","acknowledged","rejected"].indexOf(a.state)!==-1&&(a.error===void 0||typeof a.error=="object");return u&&a.error&&(u=typeof a.error.message=="string"&&typeof a.error.code=="string",u&&(l=new he(a.error.code,a.error.message))),u?new Um(e,t,a.state,l):(yn(ia,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zd{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ws(e,t){const n=JSON.parse(t);let a,l=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return l&&n.error&&(l=typeof n.error.message=="string"&&typeof n.error.code=="string",l&&(a=new he(n.error.code,n.error.message))),l?new zd(e,n.state,a):(yn(ia,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Bm{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const n=JSON.parse(t);let a=typeof n=="object"&&n.activeTargetIds instanceof Array,l=Nv();for(let u=0;a&&u<n.activeTargetIds.length;++u)a=DS(n.activeTargetIds[u]),l=l.add(n.activeTargetIds[u]);return a?new Bm(e,l):(yn(ia,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Fv{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Fv(t.clientId,t.onlineState):(yn(ia,`Failed to parse online state: ${e}`),null)}}class Fx{constructor(){this.activeTargetIds=Nv()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Xy{constructor(e,t,n,a,l){this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=a,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new qt(qe),this.started=!1,this.Xs=[];const u=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.eo=bT(this.persistenceKey,this.Js),this.no=(function(m){return`firestore_sequence_number_${m}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Fx),this.ro=new RegExp(`^${dA}_${u}_([^_]*)$`),this.io=new RegExp(`^${hA}_${u}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${fA}_${u}_(\\d+)$`),this.oo=(function(m){return`firestore_online_state_${m}`})(this.persistenceKey),this._o=(function(m){return`firestore_bundle_loaded_v2_${m}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const n of e){if(n===this.Js)continue;const a=this.getItem(bT(this.persistenceKey,n));if(a){const l=Bm.Ws(n,a);l&&(this.Zs=this.Zs.insert(l.clientId,l))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const n=this.uo(t);n&&this.co(n)}for(const n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((n,a)=>{a.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const a=this.storage.getItem(Yy(this.persistenceKey,e));if(a){const l=zd.Ws(e,a);l&&(n=l.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Yy(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach((a=>{this.Po(a)})),this.currentUser=e,n.forEach((a=>{this.addPendingMutation(a)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return pe(ia,"READ",e,t),t}setItem(e,t){pe(ia,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){pe(ia,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(pe(ia,"EVENT",t.key,t.newValue),t.key===this.eo)return void yn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const n=this.Ro(t.key);return this.Vo(n,null)}{const n=this.mo(t.key,t.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(t.key)){if(t.newValue!==null){const n=this.fo(t.key,t.newValue);if(n)return this.po(n)}}else if(this.so.test(t.key)){if(t.newValue!==null){const n=this.yo(t.key,t.newValue);if(n)return this.wo(n)}}else if(t.key===this.oo){if(t.newValue!==null){const n=this.uo(t.newValue);if(n)return this.co(n)}}else if(t.key===this.no){const n=(function(l){let u=Cs.ce;if(l!=null)try{const h=JSON.parse(l);De(typeof h=="number",30636,{So:l}),u=h}catch(h){yn(ia,"Failed to read sequence number from WebStorage",h)}return u})(t.newValue);n!==Cs.ce&&this.sequenceNumberHandler(n)}else if(t.key===this._o){const n=this.bo(t.newValue);await Promise.all(n.map((a=>this.syncEngine.Do(a))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){const a=new Um(this.currentUser,e,t,n),l=wT(this.persistenceKey,this.currentUser,e);this.setItem(l,a.Gs())}Po(e){const t=wT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){const a=Yy(this.persistenceKey,e),l=new zd(e,t,n);this.setItem(a,l.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const n=this.Ro(e);return Bm.Ws(n,t)}fo(e,t){const n=this.io.exec(e),a=Number(n[1]),l=n[2]!==void 0?n[2]:null;return Um.Ws(new Yn(l),a,t)}yo(e,t){const n=this.so.exec(e),a=Number(n[1]);return zd.Ws(a,t)}uo(e){return Fv.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);pe(ia,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const n=t?this.Zs.insert(e,t):this.Zs.remove(e),a=this.lo(this.Zs),l=this.lo(n),u=[],h=[];return l.forEach((m=>{a.has(m)||u.push(m)})),a.forEach((m=>{l.has(m)||h.push(m)})),this.syncEngine.Fo(u,h).then((()=>{this.Zs=n}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=Nv();return e.forEach(((n,a)=>{t=t.unionWith(a.activeTargetIds)})),t}}class mA{constructor(){this.Mo=new Fx,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Fx,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T="ConnectivityMonitor";class NT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){pe(_T,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){pe(_T,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xf=null;function Ux(){return Xf===null?Xf=(function(){return 268435456+Math.round(2147483648*Math.random())})():Xf++,"0x"+Xf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy="RestConnection",NP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class TP{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${a}`,this.Wo=this.databaseId.database===eh?`project_id=${n}`:`project_id=${n}&database_id=${a}`}Go(e,t,n,a,l){const u=Ux(),h=this.zo(e,t.toUriEncodedString());pe(Wy,`Sending RPC '${e}' ${u}:`,h,n);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,a,l);const{host:p}=new URL(h),x=ti(p);return this.Jo(e,h,m,n,x).then((w=>(pe(Wy,`Received RPC '${e}' ${u}: `,w),w)),(w=>{throw Zs(Wy,`RPC '${e}' ${u} failed with error: `,w,"url: ",h,"request:",n),w}))}Ho(e,t,n,a,l,u){return this.Go(e,t,n,a,l)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+iu})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((a,l)=>e[l]=a)),n&&n.headers.forEach(((a,l)=>e[l]=a))}zo(e,t){const n=NP[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const us="WebChannelConnection";class SP extends TP{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,a,l){const u=Ux();return new Promise(((h,m)=>{const p=new pS;p.setWithCredentials(!0),p.listenOnce(yS.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case im.NO_ERROR:const w=p.getResponseJson();pe(us,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(w)),h(w);break;case im.TIMEOUT:pe(us,`RPC '${e}' ${u} timed out`),m(new he(re.DEADLINE_EXCEEDED,"Request time out"));break;case im.HTTP_ERROR:const b=p.getStatus();if(pe(us,`RPC '${e}' ${u} failed with status:`,b,"response text:",p.getResponseText()),b>0){let E=p.getResponseJson();Array.isArray(E)&&(E=E[0]);const k=E?.error;if(k&&k.status&&k.message){const R=(function(z){const B=z.toLowerCase().replace(/_/g,"-");return Object.values(re).indexOf(B)>=0?B:re.UNKNOWN})(k.status);m(new he(R,k.message))}else m(new he(re.UNKNOWN,"Server responded with status "+p.getStatus()))}else m(new he(re.UNAVAILABLE,"Connection failed."));break;default:Se(9055,{l_:e,streamId:u,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{pe(us,`RPC '${e}' ${u} completed.`)}}));const x=JSON.stringify(a);pe(us,`RPC '${e}' ${u} sending request:`,a),p.send(t,"POST",x,n,15)}))}T_(e,t,n){const a=Ux(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=bS(),h=vS(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(m.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,n),m.encodeInitMessageHeaders=!0;const x=l.join("");pe(us,`Creating RPC '${e}' stream ${a}: ${x}`,m);const w=u.createWebChannel(x,m);this.I_(w);let b=!1,E=!1;const k=new EP({Yo:U=>{E?pe(us,`Not sending because RPC '${e}' stream ${a} is closed:`,U):(b||(pe(us,`Opening RPC '${e}' stream ${a} transport.`),w.open(),b=!0),pe(us,`RPC '${e}' stream ${a} sending:`,U),w.send(U))},Zo:()=>w.close()}),R=(U,z,B)=>{U.listen(z,(q=>{try{B(q)}catch(G){setTimeout((()=>{throw G}),0)}}))};return R(w,Ad.EventType.OPEN,(()=>{E||(pe(us,`RPC '${e}' stream ${a} transport opened.`),k.o_())})),R(w,Ad.EventType.CLOSE,(()=>{E||(E=!0,pe(us,`RPC '${e}' stream ${a} transport closed`),k.a_(),this.E_(w))})),R(w,Ad.EventType.ERROR,(U=>{E||(E=!0,Zs(us,`RPC '${e}' stream ${a} transport errored. Name:`,U.name,"Message:",U.message),k.a_(new he(re.UNAVAILABLE,"The operation could not be completed")))})),R(w,Ad.EventType.MESSAGE,(U=>{if(!E){const z=U.data[0];De(!!z,16349);const B=z,q=B?.error||B[0]?.error;if(q){pe(us,`RPC '${e}' stream ${a} received error:`,q);const G=q.status;let Q=(function(T){const A=_n[T];if(A!==void 0)return jj(A)})(G),L=q.message;Q===void 0&&(Q=re.INTERNAL,L="Unknown error status: "+G+" with message "+q.message),E=!0,k.a_(new he(Q,L)),w.close()}else pe(us,`RPC '${e}' stream ${a} received:`,z),k.u_(z)}})),R(h,xS.STAT_EVENT,(U=>{U.stat===px.PROXY?pe(us,`RPC '${e}' stream ${a} detected buffering proxy`):U.stat===px.NOPROXY&&pe(us,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{k.__()}),0),k}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gA(){return typeof window<"u"?window:null}function gm(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(s){return new R4(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(e,t,n=1e3,a=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=a,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),a=Math.max(0,t-n);a>0&&pe("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TT="PersistentStream";class pA{constructor(e,t,n,a,l,u,h,m){this.Mi=e,this.S_=n,this.b_=a,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Uv(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===re.RESOURCE_EXHAUSTED?(yn(t.toString()),yn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===re.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,a])=>{this.D_===t&&this.G_(n,a)}),(n=>{e((()=>{const a=new he(re.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(a)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{n((()=>this.z_(a)))})),this.stream.onMessage((a=>{n((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return pe(TT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(pe(TT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class jP extends pA{constructor(e,t,n,a,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,u),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=M4(this.serializer,e),n=(function(l){if(!("targetChange"in l))return Oe.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?Oe.min():u.readTime?xn(u.readTime):Oe.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Px(this.serializer),t.addTarget=(function(l,u){let h;const m=u.target;if(h=Rm(m)?{documents:Oj(l,m)}:{query:pg(l,m).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=kj(l,u.resumeToken);const p=Rx(l,u.expectedCount);p!==null&&(h.expectedCount=p)}else if(u.snapshotVersion.compareTo(Oe.min())>0){h.readTime=$c(l,u.snapshotVersion.toTimestamp());const p=Rx(l,u.expectedCount);p!==null&&(h.expectedCount=p)}return h})(this.serializer,e);const n=V4(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Px(this.serializer),t.removeTarget=e,this.q_(t)}}class AP extends pA{constructor(e,t,n,a,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,u),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return De(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,De(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){De(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=O4(e.writeResults,e.commitTime),n=xn(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Px(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>ah(this.serializer,n)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{}class IP extends CP{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new he(re.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Go(e,Dx(t,n),a,l,u))).catch((l=>{throw l.name==="FirebaseError"?(l.code===re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new he(re.UNKNOWN,l.toString())}))}Ho(e,t,n,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,Dx(t,n),a,u,h,l))).catch((u=>{throw u.name==="FirebaseError"?(u.code===re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new he(re.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class kP{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(yn(t),this.aa=!1):pe("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl="RemoteStore";class RP{constructor(e,t,n,a,l){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((u=>{n.enqueueAndForget((async()=>{lo(this)&&(pe(gl,"Restarting streams for network reachability change."),await(async function(m){const p=Ne(m);p.Ea.add(4),await uu(p),p.Ra.set("Unknown"),p.Ea.delete(4),await wh(p)})(this))}))})),this.Ra=new kP(n,a)}}async function wh(s){if(lo(s))for(const e of s.da)await e(!0)}async function uu(s){for(const e of s.da)await e(!1)}function wg(s,e){const t=Ne(s);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),zv(t)?qv(t):hu(t).O_()&&Bv(t,e))}function Yc(s,e){const t=Ne(s),n=hu(t);t.Ia.delete(e),n.O_()&&yA(t,e),t.Ia.size===0&&(n.O_()?n.L_():lo(t)&&t.Ra.set("Unknown"))}function Bv(s,e){if(s.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Oe.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}hu(s).Y_(e)}function yA(s,e){s.Va.Ue(e),hu(s).Z_(e)}function qv(s){s.Va=new A4({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),At:e=>s.Ia.get(e)||null,ht:()=>s.datastore.serializer.databaseId}),hu(s).start(),s.Ra.ua()}function zv(s){return lo(s)&&!hu(s).x_()&&s.Ia.size>0}function lo(s){return Ne(s).Ea.size===0}function xA(s){s.Va=void 0}async function DP(s){s.Ra.set("Online")}async function PP(s){s.Ia.forEach(((e,t)=>{Bv(s,e)}))}async function MP(s,e){xA(s),zv(s)?(s.Ra.ha(e),qv(s)):s.Ra.set("Unknown")}async function OP(s,e,t){if(s.Ra.set("Online"),e instanceof Ij&&e.state===2&&e.cause)try{await(async function(a,l){const u=l.cause;for(const h of l.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,u),a.Ia.delete(h),a.Va.removeTarget(h))})(s,e)}catch(n){pe(gl,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await qm(s,n)}else if(e instanceof fm?s.Va.Ze(e):e instanceof Cj?s.Va.st(e):s.Va.tt(e),!t.isEqual(Oe.min()))try{const n=await iA(s.localStore);t.compareTo(n)>=0&&await(function(l,u){const h=l.Va.Tt(u);return h.targetChanges.forEach(((m,p)=>{if(m.resumeToken.approximateByteSize()>0){const x=l.Ia.get(p);x&&l.Ia.set(p,x.withResumeToken(m.resumeToken,u))}})),h.targetMismatches.forEach(((m,p)=>{const x=l.Ia.get(m);if(!x)return;l.Ia.set(m,x.withResumeToken(ln.EMPTY_BYTE_STRING,x.snapshotVersion)),yA(l,m);const w=new Ha(x.target,m,p,x.sequenceNumber);Bv(l,w)})),l.remoteSyncer.applyRemoteEvent(h)})(s,t)}catch(n){pe(gl,"Failed to raise snapshot:",n),await qm(s,n)}}async function qm(s,e,t){if(!io(e))throw e;s.Ea.add(1),await uu(s),s.Ra.set("Offline"),t||(t=()=>iA(s.localStore)),s.asyncQueue.enqueueRetryable((async()=>{pe(gl,"Retrying IndexedDB access"),await t(),s.Ea.delete(1),await wh(s)}))}function vA(s,e){return e().catch((t=>qm(s,t,e)))}async function du(s){const e=Ne(s),t=no(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Yi;for(;VP(e);)try{const a=await vP(e.localStore,n);if(a===null){e.Ta.length===0&&t.L_();break}n=a.batchId,LP(e,a)}catch(a){await qm(e,a)}bA(e)&&wA(e)}function VP(s){return lo(s)&&s.Ta.length<10}function LP(s,e){s.Ta.push(e);const t=no(s);t.O_()&&t.X_&&t.ea(e.mutations)}function bA(s){return lo(s)&&!no(s).x_()&&s.Ta.length>0}function wA(s){no(s).start()}async function FP(s){no(s).ra()}async function UP(s){const e=no(s);for(const t of s.Ta)e.ea(t.mutations)}async function BP(s,e,t){const n=s.Ta.shift(),a=jv.from(n,e,t);await vA(s,(()=>s.remoteSyncer.applySuccessfulWrite(a))),await du(s)}async function qP(s,e){e&&no(s).X_&&await(async function(n,a){if((function(u){return Sj(u)&&u!==re.ABORTED})(a.code)){const l=n.Ta.shift();no(n).B_(),await vA(n,(()=>n.remoteSyncer.rejectFailedWrite(l.batchId,a))),await du(n)}})(s,e),bA(s)&&wA(s)}async function ET(s,e){const t=Ne(s);t.asyncQueue.verifyOperationInProgress(),pe(gl,"RemoteStore received new credentials");const n=lo(t);t.Ea.add(3),await uu(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await wh(t)}async function Bx(s,e){const t=Ne(s);e?(t.Ea.delete(2),await wh(t)):e||(t.Ea.add(2),await uu(t),t.Ra.set("Unknown"))}function hu(s){return s.ma||(s.ma=(function(t,n,a){const l=Ne(t);return l.sa(),new jP(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(s.datastore,s.asyncQueue,{Xo:DP.bind(null,s),t_:PP.bind(null,s),r_:MP.bind(null,s),H_:OP.bind(null,s)}),s.da.push((async e=>{e?(s.ma.B_(),zv(s)?qv(s):s.Ra.set("Unknown")):(await s.ma.stop(),xA(s))}))),s.ma}function no(s){return s.fa||(s.fa=(function(t,n,a){const l=Ne(t);return l.sa(),new AP(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(s.datastore,s.asyncQueue,{Xo:()=>Promise.resolve(),t_:FP.bind(null,s),r_:qP.bind(null,s),ta:UP.bind(null,s),na:BP.bind(null,s)}),s.da.push((async e=>{e?(s.fa.B_(),await du(s)):(await s.fa.stop(),s.Ta.length>0&&(pe(gl,`Stopping write stream with ${s.Ta.length} pending writes`),s.Ta=[]))}))),s.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e,t,n,a,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=l,this.deferred=new Xn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,l){const u=Date.now()+n,h=new Hv(e,t,u,a,l);return h.start(n),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(re.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fu(s,e){if(yn("AsyncQueue",`${e}: ${s}`),io(s))return new he(re.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{static emptySet(e){return new sl(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||_e.comparator(t.key,n.key):(t,n)=>_e.comparator(t.key,n.key),this.keyedMap=Cd(),this.sortedSet=new qt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sl)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=n.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new sl;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{constructor(){this.ga=new qt(_e.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Se(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class pl{constructor(e,t,n,a,l,u,h,m,p){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=m,this.hasCachedResults=p}static fromInitialDocuments(e,t,n,a,l){const u=[];return t.forEach((h=>{u.push({type:0,doc:h})})),new pl(e,t,sl.emptySet(t),u,n,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ph(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zP{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class HP{constructor(){this.queries=jT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const a=Ne(t),l=a.queries;a.queries=jT(),l.forEach(((u,h)=>{for(const m of h.Sa)m.onError(n)}))})(this,new he(re.ABORTED,"Firestore shutting down"))}}function jT(){return new si((s=>dj(s)),ph)}async function Gv(s,e){const t=Ne(s);let n=3;const a=e.query;let l=t.queries.get(a);l?!l.ba()&&e.Da()&&(n=2):(l=new zP,n=e.Da()?0:1);try{switch(n){case 0:l.wa=await t.onListen(a,!0);break;case 1:l.wa=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(u){const h=fu(u,`Initialization of query '${_c(e.query)}' failed`);return void e.onError(h)}t.queries.set(a,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&Kv(t)}async function $v(s,e){const t=Ne(s),n=e.query;let a=3;const l=t.queries.get(n);if(l){const u=l.Sa.indexOf(e);u>=0&&(l.Sa.splice(u,1),l.Sa.length===0?a=e.Da()?0:1:!l.ba()&&e.Da()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function GP(s,e){const t=Ne(s);let n=!1;for(const a of e){const l=a.query,u=t.queries.get(l);if(u){for(const h of u.Sa)h.Fa(a)&&(n=!0);u.wa=a}}n&&Kv(t)}function $P(s,e,t){const n=Ne(s),a=n.queries.get(e);if(a)for(const l of a.Sa)l.onError(t);n.queries.delete(e)}function Kv(s){s.Ca.forEach((e=>{e.next()}))}var qx,AT;(AT=qx||(qx={})).Ma="default",AT.Cache="cache";class Qv{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new pl(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==qx.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(e){this.serializer=e}$s(e){return ma(this.serializer,e)}Us(e){return e.metadata.exists?gg(this.serializer,e.document,!1):zt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return xn(e)}}class Yv{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=NA(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const n=tt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,n=new CT(this.serializer);for(const a of e)if(a.metadata.queries){const l=n.$s(a.metadata.name);for(const u of a.metadata.queries){const h=(t.get(u)||Xe()).add(l);t.set(u,h)}}return t}async ja(e){const t=await bP(e,new CT(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(const a of this.Ka)await wP(e,a,n.get(a.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function NA(s){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e){this.key=e}}class EA{constructor(e){this.key=e}}class SA{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Xe(),this.mutatedKeys=Xe(),this.eu=fj(e),this.tu=new sl(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new ST,a=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,u=a,h=!1;const m=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((x,w)=>{const b=a.get(x),E=yh(this.query,w)?w:null,k=!!b&&this.mutatedKeys.has(b.key),R=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations);let U=!1;b&&E?b.data.isEqual(E.data)?k!==R&&(n.track({type:3,doc:E}),U=!0):this.su(b,E)||(n.track({type:2,doc:E}),U=!0,(m&&this.eu(E,m)>0||p&&this.eu(E,p)<0)&&(h=!0)):!b&&E?(n.track({type:0,doc:E}),U=!0):b&&!E&&(n.track({type:1,doc:b}),U=!0,(m||p)&&(h=!0)),U&&(E?(u=u.add(E),l=R?l.add(x):l.delete(x)):(u=u.delete(x),l=l.delete(x)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const x=this.query.limitType==="F"?u.last():u.first();u=u.delete(x.key),l=l.delete(x.key),n.track({type:1,doc:x})}return{tu:u,iu:n,Cs:h,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((x,w)=>(function(E,k){const R=U=>{switch(U){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Se(20277,{Rt:U})}};return R(E)-R(k)})(x.type,w.type)||this.eu(x.doc,w.doc))),this.ou(n),a=a??!1;const h=t&&!a?this._u():[],m=this.Xa.size===0&&this.current&&!a?1:0,p=m!==this.Za;return this.Za=m,u.length!==0||p?{snapshot:new pl(this.query,e.tu,l,u,e.mutatedKeys,m===0,p,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ST,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Xe(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new EA(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new TA(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=Xe();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const co="SyncEngine";class KP{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class QP{constructor(e){this.key=e,this.hu=!1}}class YP{constructor(e,t,n,a,l,u){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new si((h=>dj(h)),ph),this.Iu=new Map,this.Eu=new Set,this.du=new qt(_e.comparator),this.Au=new Map,this.Ru=new Dv,this.Vu={},this.mu=new Map,this.fu=ml.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function XP(s,e,t=!0){const n=_g(s);let a;const l=n.Tu.get(e);return l?(n.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await jA(n,e,t,!0),a}async function WP(s,e){const t=_g(s);await jA(t,e,!0,!1)}async function jA(s,e,t,n){const a=await Kc(s.localStore,ms(e)),l=a.targetId,u=s.sharedClientState.addLocalQueryTarget(l,t);let h;return n&&(h=await Xv(s,e,l,u==="current",a.resumeToken)),s.isPrimaryClient&&t&&wg(s.remoteStore,a),h}async function Xv(s,e,t,n,a){s.pu=(w,b,E)=>(async function(R,U,z,B){let q=U.view.ru(z);q.Cs&&(q=await Fm(R.localStore,U.query,!1).then((({documents:P})=>U.view.ru(P,q))));const G=B&&B.targetChanges.get(U.targetId),Q=B&&B.targetMismatches.get(U.targetId)!=null,L=U.view.applyChanges(q,R.isPrimaryClient,G,Q);return zx(R,U.targetId,L.au),L.snapshot})(s,w,b,E);const l=await Fm(s.localStore,e,!0),u=new SA(e,l.Qs),h=u.ru(l.documents),m=bh.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",a),p=u.applyChanges(h,s.isPrimaryClient,m);zx(s,t,p.au);const x=new KP(e,t,u);return s.Tu.set(e,x),s.Iu.has(t)?s.Iu.get(t).push(e):s.Iu.set(t,[e]),p.snapshot}async function JP(s,e,t){const n=Ne(s),a=n.Tu.get(e),l=n.Iu.get(a.targetId);if(l.length>1)return n.Iu.set(a.targetId,l.filter((u=>!ph(u,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await Qc(n.localStore,a.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(a.targetId),t&&Yc(n.remoteStore,a.targetId),Xc(n,a.targetId)})).catch(ao)):(Xc(n,a.targetId),await Qc(n.localStore,a.targetId,!0))}async function ZP(s,e){const t=Ne(s),n=t.Tu.get(e),a=t.Iu.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Yc(t.remoteStore,n.targetId))}async function e6(s,e,t){const n=e0(s);try{const a=await(function(u,h){const m=Ne(u),p=Nt.now(),x=h.reduce(((E,k)=>E.add(k.key)),Xe());let w,b;return m.persistence.runTransaction("Locally write mutations","readwrite",(E=>{let k=ks(),R=Xe();return m.Ns.getEntries(E,x).next((U=>{k=U,k.forEach(((z,B)=>{B.isValidDocument()||(R=R.add(z))}))})).next((()=>m.localDocuments.getOverlayedDocuments(E,k))).next((U=>{w=U;const z=[];for(const B of h){const q=E4(B,w.get(B.key).overlayedDocument);q!=null&&z.push(new ri(B.key,q,ej(q.value.mapValue),Jt.exists(!0)))}return m.mutationQueue.addMutationBatch(E,p,z,h)})).next((U=>{b=U;const z=U.applyToLocalDocumentSet(w,R);return m.documentOverlayCache.saveOverlays(E,U.batchId,z)}))})).then((()=>({batchId:b.batchId,changes:gj(w)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),(function(u,h,m){let p=u.Vu[u.currentUser.toKey()];p||(p=new qt(qe)),p=p.insert(h,m),u.Vu[u.currentUser.toKey()]=p})(n,a.batchId,t),await ai(n,a.changes),await du(n.remoteStore)}catch(a){const l=fu(a,"Failed to persist write");t.reject(l)}}async function AA(s,e){const t=Ne(s);try{const n=await xP(t.localStore,e);e.targetChanges.forEach(((a,l)=>{const u=t.Au.get(l);u&&(De(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?u.hu=!0:a.modifiedDocuments.size>0?De(u.hu,14607):a.removedDocuments.size>0&&(De(u.hu,42227),u.hu=!1))})),await ai(t,n,e)}catch(n){await ao(n)}}function IT(s,e,t){const n=Ne(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Tu.forEach(((l,u)=>{const h=u.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(u,h){const m=Ne(u);m.onlineState=h;let p=!1;m.queries.forEach(((x,w)=>{for(const b of w.Sa)b.va(h)&&(p=!0)})),p&&Kv(m)})(n.eventManager,e),a.length&&n.Pu.H_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function t6(s,e,t){const n=Ne(s);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Au.get(e),l=a&&a.key;if(l){let u=new qt(_e.comparator);u=u.insert(l,zt.newNoDocument(l,Oe.min()));const h=Xe().add(l),m=new vh(Oe.min(),new Map,new qt(qe),u,h);await AA(n,m),n.du=n.du.remove(l),n.Au.delete(e),Zv(n)}else await Qc(n.localStore,e,!1).then((()=>Xc(n,e,t))).catch(ao)}async function n6(s,e){const t=Ne(s),n=e.batch.batchId;try{const a=await yP(t.localStore,e);Jv(t,n,null),Wv(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await ai(t,a)}catch(a){await ao(a)}}async function s6(s,e,t){const n=Ne(s);try{const a=await(function(u,h){const m=Ne(u);return m.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let x;return m.mutationQueue.lookupMutationBatch(p,h).next((w=>(De(w!==null,37113),x=w.keys(),m.mutationQueue.removeMutationBatch(p,w)))).next((()=>m.mutationQueue.performConsistencyCheck(p))).next((()=>m.documentOverlayCache.removeOverlaysForBatchId(p,x,h))).next((()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,x))).next((()=>m.localDocuments.getDocuments(p,x)))}))})(n.localStore,e);Jv(n,e,t),Wv(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await ai(n,a)}catch(a){await ao(a)}}async function r6(s,e){const t=Ne(s);lo(t.remoteStore)||pe(co,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=await(function(u){const h=Ne(u);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(m=>h.mutationQueue.getHighestUnacknowledgedBatchId(m)))})(t.localStore);if(n===Yi)return void e.resolve();const a=t.mu.get(n)||[];a.push(e),t.mu.set(n,a)}catch(n){const a=fu(n,"Initialization of waitForPendingWrites() operation failed");e.reject(a)}}function Wv(s,e){(s.mu.get(e)||[]).forEach((t=>{t.resolve()})),s.mu.delete(e)}function Jv(s,e,t){const n=Ne(s);let a=n.Vu[n.currentUser.toKey()];if(a){const l=a.get(e);l&&(t?l.reject(t):l.resolve(),a=a.remove(e)),n.Vu[n.currentUser.toKey()]=a}}function Xc(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Iu.get(e))s.Tu.delete(n),t&&s.Pu.yu(n,t);s.Iu.delete(e),s.isPrimaryClient&&s.Ru.jr(e).forEach((n=>{s.Ru.containsKey(n)||CA(s,n)}))}function CA(s,e){s.Eu.delete(e.path.canonicalString());const t=s.du.get(e);t!==null&&(Yc(s.remoteStore,t),s.du=s.du.remove(e),s.Au.delete(t),Zv(s))}function zx(s,e,t){for(const n of t)n instanceof TA?(s.Ru.addReference(n.key,e),a6(s,n)):n instanceof EA?(pe(co,"Document no longer in limbo: "+n.key),s.Ru.removeReference(n.key,e),s.Ru.containsKey(n.key)||CA(s,n.key)):Se(19791,{wu:n})}function a6(s,e){const t=e.key,n=t.path.canonicalString();s.du.get(t)||s.Eu.has(n)||(pe(co,"New document in limbo: "+t),s.Eu.add(n),Zv(s))}function Zv(s){for(;s.Eu.size>0&&s.du.size<s.maxConcurrentLimboResolutions;){const e=s.Eu.values().next().value;s.Eu.delete(e);const t=new _e(tt.fromString(e)),n=s.fu.next();s.Au.set(n,new QP(t)),s.du=s.du.insert(t,n),wg(s.remoteStore,new Ha(ms(ou(t.path)),n,"TargetPurposeLimboResolution",Cs.ce))}}async function ai(s,e,t){const n=Ne(s),a=[],l=[],u=[];n.Tu.isEmpty()||(n.Tu.forEach(((h,m)=>{u.push(n.pu(m,e,t).then((p=>{if((p||t)&&n.isPrimaryClient){const x=p?!p.fromCache:t?.targetChanges.get(m.targetId)?.current;n.sharedClientState.updateQueryState(m.targetId,x?"current":"not-current")}if(p){a.push(p);const x=Vv.As(m.targetId,p);l.push(x)}})))})),await Promise.all(u),n.Pu.H_(a),await(async function(m,p){const x=Ne(m);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",(w=>J.forEach(p,(b=>J.forEach(b.Es,(E=>x.persistence.referenceDelegate.addReference(w,b.targetId,E))).next((()=>J.forEach(b.ds,(E=>x.persistence.referenceDelegate.removeReference(w,b.targetId,E)))))))))}catch(w){if(!io(w))throw w;pe(Lv,"Failed to update sequence numbers: "+w)}for(const w of p){const b=w.targetId;if(!w.fromCache){const E=x.Ms.get(b),k=E.snapshotVersion,R=E.withLastLimboFreeSnapshotVersion(k);x.Ms=x.Ms.insert(b,R)}}})(n.localStore,l))}async function i6(s,e){const t=Ne(s);if(!t.currentUser.isEqual(e)){pe(co,"User change. New user:",e.toKey());const n=await aA(t.localStore,e);t.currentUser=e,(function(l,u){l.mu.forEach((h=>{h.forEach((m=>{m.reject(new he(re.CANCELLED,u))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await ai(t,n.Ls)}}function o6(s,e){const t=Ne(s),n=t.Au.get(e);if(n&&n.hu)return Xe().add(n.key);{let a=Xe();const l=t.Iu.get(e);if(!l)return a;for(const u of l){const h=t.Tu.get(u);a=a.unionWith(h.view.nu)}return a}}async function l6(s,e){const t=Ne(s),n=await Fm(t.localStore,e.query,!0),a=e.view.cu(n);return t.isPrimaryClient&&zx(t,e.targetId,a.au),a}async function c6(s,e){const t=Ne(s);return cA(t.localStore,e).then((n=>ai(t,n)))}async function u6(s,e,t,n){const a=Ne(s),l=await(function(h,m){const p=Ne(h),x=Ne(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",(w=>x.er(w,m).next((b=>b?p.localDocuments.getDocuments(w,b):J.resolve(null)))))})(a.localStore,e);l!==null?(t==="pending"?await du(a.remoteStore):t==="acknowledged"||t==="rejected"?(Jv(a,e,n||null),Wv(a,e),(function(h,m){Ne(Ne(h).mutationQueue).ir(m)})(a.localStore,e)):Se(6720,"Unknown batchState",{Su:t}),await ai(a,l)):pe(co,"Cannot apply mutation batch with id: "+e)}async function d6(s,e){const t=Ne(s);if(_g(t),e0(t),e===!0&&t.gu!==!0){const n=t.sharedClientState.getAllActiveQueryTargets(),a=await kT(t,n.toArray());t.gu=!0,await Bx(t.remoteStore,!0);for(const l of a)wg(t.remoteStore,l)}else if(e===!1&&t.gu!==!1){const n=[];let a=Promise.resolve();t.Iu.forEach(((l,u)=>{t.sharedClientState.isLocalQueryTarget(u)?n.push(u):a=a.then((()=>(Xc(t,u),Qc(t.localStore,u,!0)))),Yc(t.remoteStore,u)})),await a,await kT(t,n),(function(u){const h=Ne(u);h.Au.forEach(((m,p)=>{Yc(h.remoteStore,p)})),h.Ru.Jr(),h.Au=new Map,h.du=new qt(_e.comparator)})(t),t.gu=!1,await Bx(t.remoteStore,!1)}}async function kT(s,e,t){const n=Ne(s),a=[],l=[];for(const u of e){let h;const m=n.Iu.get(u);if(m&&m.length!==0){h=await Kc(n.localStore,ms(m[0]));for(const p of m){const x=n.Tu.get(p),w=await l6(n,x);w.snapshot&&l.push(w.snapshot)}}else{const p=await lA(n.localStore,u);h=await Kc(n.localStore,p),await Xv(n,IA(p),u,!1,h.resumeToken)}a.push(h)}return n.Pu.H_(l),a}function IA(s){return lj(s.path,s.collectionGroup,s.orderBy,s.filters,s.limit,"F",s.startAt,s.endAt)}function h6(s){return(function(t){return Ne(Ne(t).persistence).Ts()})(Ne(s).localStore)}async function f6(s,e,t,n){const a=Ne(s);if(a.gu)return void pe(co,"Ignoring unexpected query state notification.");const l=a.Iu.get(e);if(l&&l.length>0)switch(t){case"current":case"not-current":{const u=await cA(a.localStore,hj(l[0])),h=vh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ln.EMPTY_BYTE_STRING);await ai(a,u,h);break}case"rejected":await Qc(a.localStore,e,!0),Xc(a,e,n);break;default:Se(64155,t)}}async function m6(s,e,t){const n=_g(s);if(n.gu){for(const a of e){if(n.Iu.has(a)&&n.sharedClientState.isActiveQueryTarget(a)){pe(co,"Adding an already active target "+a);continue}const l=await lA(n.localStore,a),u=await Kc(n.localStore,l);await Xv(n,IA(l),u.targetId,!1,u.resumeToken),wg(n.remoteStore,u)}for(const a of t)n.Iu.has(a)&&await Qc(n.localStore,a,!1).then((()=>{Yc(n.remoteStore,a),Xc(n,a)})).catch(ao)}}function _g(s){const e=Ne(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=AA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=o6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=t6.bind(null,e),e.Pu.H_=GP.bind(null,e.eventManager),e.Pu.yu=$P.bind(null,e.eventManager),e}function e0(s){const e=Ne(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=n6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=s6.bind(null,e),e}function g6(s,e,t){const n=Ne(s);(async function(l,u,h){try{const m=await u.getMetadata();if(await(function(E,k){const R=Ne(E),U=xn(k.createTime);return R.persistence.runTransaction("hasNewerBundle","readonly",(z=>R.Ii.getBundleMetadata(z,k.id))).then((z=>!!z&&z.createTime.compareTo(U)>=0))})(l.localStore,m))return await u.close(),h._completeWith((function(E){return{taskState:"Success",documentsLoaded:E.totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}})(m)),Promise.resolve(new Set);h._updateProgress(NA(m));const p=new Yv(m,u.serializer);let x=await u.bu();for(;x;){const b=await p.Ga(x);b&&h._updateProgress(b),x=await u.bu()}const w=await p.ja(l.localStore);return await ai(l,w.Ha,void 0),await(function(E,k){const R=Ne(E);return R.persistence.runTransaction("Save bundle","readwrite",(U=>R.Ii.saveBundleMetadata(U,k)))})(l.localStore,m),h._completeWith(w.progress),Promise.resolve(w.Ja)}catch(m){return Zs(co,`Loading bundle failed with ${m}`),h._failWith(m),Promise.resolve(new Set)}})(n,e,t).then((a=>{n.sharedClientState.notifyBundleLoaded(a)}))}class Wc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=wl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return rA(this.persistence,new sA,e.initialUser,this.serializer)}Cu(e){return new Pv(bg.mi,this.serializer)}Du(e){return new mA}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Wc.provider={build:()=>new Wc};class t0 extends Wc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){De(this.persistence.referenceDelegate instanceof Lm,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Wj(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ds.withCacheSize(this.cacheSizeBytes):ds.DEFAULT;return new Pv((n=>Lm.mi(n,t)),this.serializer)}}class n0 extends Wc{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await e0(this.xu.syncEngine),await du(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return rA(this.persistence,new sA,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Wj(n,e.asyncQueue,t)}Mu(e,t){const n=new CD(t,this.persistence);return new AD(e.asyncQueue,n)}Cu(e){const t=Ov(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?ds.withCacheSize(this.cacheSizeBytes):ds.DEFAULT;return new Mv(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,gA(),gm(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new mA}}class kA extends n0{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Xy&&(this.sharedClientState.syncEngine={Co:u6.bind(null,t),vo:f6.bind(null,t),Fo:m6.bind(null,t),Ts:h6.bind(null,t),Do:c6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async n=>{await d6(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))}Du(e){const t=gA();if(!Xy.v(t))throw new he(re.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ov(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Xy(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class so{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>IT(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=i6.bind(null,this.syncEngine),await Bx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new HP})()}createDatastore(e){const t=wl(e.databaseInfo.databaseId),n=(function(l){return new SP(l)})(e.databaseInfo);return(function(l,u,h,m){return new IP(l,u,h,m)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,a,l,u,h){return new RP(n,a,l,u,h)})(this.localStore,this.datastore,e.asyncQueue,(t=>IT(this.syncEngine,t,0)),(function(){return NT.v()?new NT:new _P})())}createSyncEngine(e,t){return(function(a,l,u,h,m,p,x){const w=new YP(a,l,u,h,m,p);return x&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=Ne(t);pe(gl,"RemoteStore shutting down."),n.Ea.add(5),await uu(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}so.provider={build:()=>new so};function RT(s,e=10240){let t=0;return{async read(){if(t<s.byteLength){const n={value:s.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):yn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Xn,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((n=>{n&&n.$a()?this.metadata.resolve(n.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.Qa)}`))}),(n=>this.metadata.reject(n)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),n=Number(t);isNaN(n)&&this.Qu(`length string (${t}) is not valid number`);const a=await this.$u(n);return new _A(JSON.parse(a),e.length+n)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y6{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.Qa)}`);this.metadata=n;do n=this.bu(),n!==null&&this.elements.push(n);while(n!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new _A(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new he(re.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new he(re.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(a,l){const u=Ne(a),h={documents:l.map((w=>rh(u.serializer,w)))},m=await u.Ho("BatchGetDocuments",u.serializer.databaseId,tt.emptyPath(),h,l.length),p=new Map;m.forEach((w=>{const b=P4(u.serializer,w);p.set(b.key.toString(),b)}));const x=[];return l.forEach((w=>{const b=p.get(w.toString());De(!!b,55234,{key:w}),x.push(b)})),x})(this.datastore,e);return t.forEach((n=>this.recordVersion(n))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new cu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,n)=>{const a=_e.fromPath(n);this.mutations.push(new Ev(a,this.precondition(a)))})),await(async function(n,a){const l=Ne(n),u={writes:a.map((h=>ah(l.serializer,h)))};await l.Go("Commit",l.serializer.databaseId,tt.emptyPath(),u)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Se(50498,{Gu:e.constructor.name});t=Oe.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new he(re.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Oe.min())?Jt.exists(!1):Jt.updateTime(t):Jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Oe.min()))throw new he(re.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jt.updateTime(t)}return Jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(e,t,n,a,l){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=a,this.deferred=l,this.zu=n.maxAttempts,this.M_=new Uv(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new x6(this.datastore),t=this.Hu(e);t&&t.then((n=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(n)})).catch((a=>{this.Yu(a)}))))})).catch((n=>{this.Yu(n)}))}))}Hu(e){try{const t=this.updateFunction(e);return!fh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Sj(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ro="FirestoreClient";class b6{constructor(e,t,n,a,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=Yn.UNAUTHENTICATED,this.clientId=rg.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(n,(async u=>{pe(ro,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(n,(u=>(pe(ro,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Xn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=fu(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Jy(s,e){s.asyncQueue.verifyOperationInProgress(),pe(ro,"Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener((async a=>{n.isEqual(a)||(await aA(e.localStore,a),n=a)})),e.persistence.setDatabaseDeletedListener((()=>s.terminate())),s._offlineComponents=e}async function DT(s,e){s.asyncQueue.verifyOperationInProgress();const t=await s0(s);pe(ro,"Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener((n=>ET(e.remoteStore,n))),s.setAppCheckTokenChangeListener(((n,a)=>ET(e.remoteStore,a))),s._onlineComponents=e}async function s0(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){pe(ro,"Using user provided OfflineComponentProvider");try{await Jy(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(a){return a.name==="FirebaseError"?a.code===re.FAILED_PRECONDITION||a.code===re.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(t))throw t;Zs("Error using user provided cache. Falling back to memory cache: "+t),await Jy(s,new Wc)}}else pe(ro,"Using default OfflineComponentProvider"),await Jy(s,new t0(void 0));return s._offlineComponents}async function Tg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(pe(ro,"Using user provided OnlineComponentProvider"),await DT(s,s._uninitializedComponentsProvider._online)):(pe(ro,"Using default OnlineComponentProvider"),await DT(s,new so))),s._onlineComponents}function RA(s){return s0(s).then((e=>e.persistence))}function mu(s){return s0(s).then((e=>e.localStore))}function DA(s){return Tg(s).then((e=>e.remoteStore))}function r0(s){return Tg(s).then((e=>e.syncEngine))}function PA(s){return Tg(s).then((e=>e.datastore))}async function Jc(s){const e=await Tg(s),t=e.eventManager;return t.onListen=XP.bind(null,e.syncEngine),t.onUnlisten=JP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=WP.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ZP.bind(null,e.syncEngine),t}function w6(s){return s.asyncQueue.enqueue((async()=>{const e=await RA(s),t=await DA(s);return e.setNetworkEnabled(!0),(function(a){const l=Ne(a);return l.Ea.delete(0),wh(l)})(t)}))}function _6(s){return s.asyncQueue.enqueue((async()=>{const e=await RA(s),t=await DA(s);return e.setNetworkEnabled(!1),(async function(a){const l=Ne(a);l.Ea.add(0),await uu(l),l.Ra.set("Offline")})(t)}))}function N6(s,e){const t=new Xn;return s.asyncQueue.enqueueAndForget((async()=>(async function(a,l,u){try{const h=await(function(p,x){const w=Ne(p);return w.persistence.runTransaction("read document","readonly",(b=>w.localDocuments.getDocument(b,x)))})(a,l);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new he(re.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const m=fu(h,`Failed to get document '${l} from cache`);u.reject(m)}})(await mu(s),e,t))),t.promise}function MA(s,e,t={}){const n=new Xn;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new Ng({next:b=>{x.Nu(),u.enqueueAndForget((()=>$v(l,w)));const E=b.docs.has(h);!E&&b.fromCache?p.reject(new he(re.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&b.fromCache&&m&&m.source==="server"?p.reject(new he(re.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(b)},error:b=>p.reject(b)}),w=new Qv(ou(h.path),x,{includeMetadataChanges:!0,qa:!0});return Gv(l,w)})(await Jc(s),s.asyncQueue,e,t,n))),n.promise}function T6(s,e){const t=new Xn;return s.asyncQueue.enqueueAndForget((async()=>(async function(a,l,u){try{const h=await Fm(a,l,!0),m=new SA(l,h.Qs),p=m.ru(h.documents),x=m.applyChanges(p,!1);u.resolve(x.snapshot)}catch(h){const m=fu(h,`Failed to execute query '${l} against cache`);u.reject(m)}})(await mu(s),e,t))),t.promise}function OA(s,e,t={}){const n=new Xn;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new Ng({next:b=>{x.Nu(),u.enqueueAndForget((()=>$v(l,w))),b.fromCache&&m.source==="server"?p.reject(new he(re.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(b)},error:b=>p.reject(b)}),w=new Qv(h,x,{includeMetadataChanges:!0,qa:!0});return Gv(l,w)})(await Jc(s),s.asyncQueue,e,t,n))),n.promise}function E6(s,e,t){const n=new Xn;return s.asyncQueue.enqueueAndForget((async()=>{try{const a=await PA(s);n.resolve((async function(u,h,m){const p=Ne(u),{request:x,gt:w,parent:b}=Vj(p.serializer,cj(h),m);p.connection.$o||delete x.parent;const E=(await p.Ho("RunAggregationQuery",p.serializer.databaseId,b,x,1)).filter((R=>!!R.result));De(E.length===1,64727);const k=E[0].result?.aggregateFields;return Object.keys(k).reduce(((R,U)=>(R[w[U]]=k[U],R)),{})})(a,e,t))}catch(a){n.reject(a)}})),n.promise}function S6(s,e){const t=new Ng(e);return s.asyncQueue.enqueueAndForget((async()=>(function(a,l){Ne(a).Ca.add(l),l.next()})(await Jc(s),t))),()=>{t.Nu(),s.asyncQueue.enqueueAndForget((async()=>(function(a,l){Ne(a).Ca.delete(l)})(await Jc(s),t)))}}function j6(s,e,t,n){const a=(function(u,h){let m;return m=typeof u=="string"?Aj().encode(u):u,(function(x,w){return new p6(x,w)})((function(x,w){if(x instanceof Uint8Array)return RT(x,w);if(x instanceof ArrayBuffer)return RT(new Uint8Array(x),w);if(x instanceof ReadableStream)return x.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(m),h)})(t,wl(e));s.asyncQueue.enqueueAndForget((async()=>{g6(await r0(s),a,n)}))}function A6(s,e){return s.asyncQueue.enqueue((async()=>(function(n,a){const l=Ne(n);return l.persistence.runTransaction("Get named query","readonly",(u=>l.Ii.getNamedQuery(u,a)))})(await mu(s),e)))}function VA(s,e){return(function(n,a){return new y6(n,a)})(s,e)}function C6(s,e){return s.asyncQueue.enqueue((async()=>(async function(n,a){const l=Ne(n),u=l.indexManager,h=[];return l.persistence.runTransaction("Configure indexes","readwrite",(m=>u.getFieldIndexes(m).next((p=>(function(w,b,E,k,R){w=[...w],b=[...b],w.sort(E),b.sort(E);const U=w.length,z=b.length;let B=0,q=0;for(;B<z&&q<U;){const G=E(w[q],b[B]);G<0?R(w[q++]):G>0?k(b[B++]):(B++,q++)}for(;B<z;)k(b[B++]);for(;q<U;)R(w[q++])})(p,a,TD,(x=>{h.push(u.addFieldIndex(m,x))}),(x=>{h.push(u.deleteFieldIndex(m,x))})))).next((()=>J.waitFor(h)))))})(await mu(s),e)))}function I6(s,e){return s.asyncQueue.enqueue((async()=>(function(n,a){Ne(n).Fs.Vs=a})(await mu(s),e)))}function k6(s){return s.asyncQueue.enqueue((async()=>(function(t){const n=Ne(t),a=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",(l=>a.deleteAllFieldIndexes(l)))})(await mu(s))))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LA(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA="firestore.googleapis.com",MT=!0;class OT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new he(re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=FA,this.ssl=MT}else this.host=e.host,this.ssl=e.ssl??MT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=$j;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Xj)throw new he(re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ES("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LA(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new he(re.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new he(re.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new he(re.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,a){return n.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class _h{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new OT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new OT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new NS;switch(n.type){case"firstParty":return new yD(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new he(re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=PT.get(t);n&&(pe("ComponentProvider","Removing Datastore"),PT.delete(t),n.terminate())})(this),Promise.resolve()}}function UA(s,e,t,n={}){s=nt(s,_h);const a=ti(e),l=s._getSettings(),u={...l,emulatorOptions:s._getEmulatorOptions()},h=`${e}:${t}`;a&&(Jm(`https://${h}`),Jx("Firestore",!0)),l.host!==FA&&l.host!==h&&Zs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...l,host:h,ssl:a,emulatorOptions:n};if(!br(m,u)&&(s._setSettings(m),n.mockUserToken)){let p,x;if(typeof n.mockUserToken=="string")p=n.mockUserToken,x=Yn.MOCK_USER;else{p=VC(n.mockUserToken,s._app?.options.projectId);const w=n.mockUserToken.sub||n.mockUserToken.user_id;if(!w)throw new he(re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new Yn(w)}s._authCredentials=new mD(new _S(p,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Mn(this.firestore,e,this._query)}}class It{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ur(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new It(this.firestore,e,this._key)}toJSON(){return{type:It._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(bl(t,It._jsonSchema))return new It(e,n||null,new _e(tt.fromString(t.referencePath)))}}It._jsonSchemaVersion="firestore/documentReference/1.0",It._jsonSchema={type:En("string",It._jsonSchemaVersion),referencePath:En("string")};class Ur extends Mn{constructor(e,t,n){super(e,t,ou(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new It(this.firestore,null,new _e(e))}withConverter(e){return new Ur(this.firestore,e,this._path)}}function Ie(s,e,...t){if(s=yt(s),hv("collection","path",e),s instanceof _h){const n=tt.fromString(e,...t);return TN(n),new Ur(s,null,n)}{if(!(s instanceof It||s instanceof Ur))throw new he(re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(tt.fromString(e,...t));return TN(n),new Ur(s.firestore,null,n)}}function R6(s,e){if(s=nt(s,_h),hv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new he(re.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Mn(s,null,(function(n){return new ni(tt.emptyPath(),n)})(e))}function be(s,e,...t){if(s=yt(s),arguments.length===1&&(e=rg.newId()),hv("doc","path",e),s instanceof _h){const n=tt.fromString(e,...t);return NN(n),new It(s,null,new _e(n))}{if(!(s instanceof It||s instanceof Ur))throw new he(re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(tt.fromString(e,...t));return NN(n),new It(s.firestore,s instanceof Ur?s.converter:null,new _e(n))}}function D6(s,e){return s=yt(s),e=yt(e),(s instanceof It||s instanceof Ur)&&(e instanceof It||e instanceof Ur)&&s.firestore===e.firestore&&s.path===e.path&&s.converter===e.converter}function a0(s,e){return s=yt(s),e=yt(e),s instanceof Mn&&e instanceof Mn&&s.firestore===e.firestore&&ph(s._query,e._query)&&s.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VT="AsyncQueue";class LT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Uv(this,"async_queue_retry"),this._c=()=>{const n=gm();n&&pe(VT,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=gm();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=gm();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Xn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!io(e))throw e;pe(VT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,yn("INTERNAL UNHANDLED ERROR: ",FT(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const a=Hv.createAndSchedule(this,e,t,n,(l=>this.hc(l)));return this.tc.push(a),a}uc(){this.nc&&Se(47125,{Pc:FT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function FT(s){let e=s.message||"";return s.stack&&(e=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ic(s){return(function(t,n){if(typeof t!="object"||t===null)return!1;const a=t;for(const l of n)if(l in a&&typeof a[l]=="function")return!0;return!1})(s,["next","error","complete"])}class BA{constructor(){this._progressObserver={},this._taskCompletionResolver=new Xn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P6=-1;class Vt extends _h{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new LT,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new LT(e),this._firestoreClient=void 0,await e}}}function M6(s,e,t){t||(t=eh);const n=ya(s,"firestore");if(n.isInitialized(t)){const a=n.getImmediate({identifier:t}),l=n.getOptions(t);if(br(l,e))return a;throw new he(re.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new he(re.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Xj)throw new he(re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&ti(e.host)&&Jm(e.host),n.initialize({options:e,instanceIdentifier:t})}function qA(s,e){const t=typeof s=="object"?s:eg(),n=typeof s=="string"?s:e||eh,a=ya(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const l=wE("firestore");l&&UA(a,...l)}return a}function Zt(s){if(s._terminated)throw new he(re.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||zA(s),s._firestoreClient}function zA(s){const e=s._freezeSettings(),t=(function(a,l,u,h){return new r4(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,LA(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(s._databaseId,s._app?.options.appId||"",s._persistenceKey,e);s._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(s._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),s._firestoreClient=new b6(s._authCredentials,s._appCheckCredentials,s._queue,t,s._componentsProvider&&(function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}})(s._componentsProvider))}function O6(s,e){Zs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=s._freezeSettings();return HA(s,so.provider,{build:n=>new n0(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function V6(s){Zs("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=s._freezeSettings();HA(s,so.provider,{build:t=>new kA(t,e.cacheSizeBytes)})}function HA(s,e,t){if((s=nt(s,Vt))._firestoreClient||s._terminated)throw new he(re.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(s._componentsProvider||s._getSettings().localCache)throw new he(re.FAILED_PRECONDITION,"SDK cache is already specified.");s._componentsProvider={_online:e,_offline:t},zA(s)}function L6(s){if(s._initialized&&!s._terminated)throw new he(re.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Xn;return s._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(n){if(!fa.v())return Promise.resolve();const a=n+nA;await fa.delete(a)})(Ov(s._databaseId,s._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function F6(s){return(function(t){const n=new Xn;return t.asyncQueue.enqueueAndForget((async()=>r6(await r0(t),n))),n.promise})(Zt(s=nt(s,Vt)))}function U6(s){return w6(Zt(s=nt(s,Vt)))}function B6(s){return _6(Zt(s=nt(s,Vt)))}function q6(s){return WI(s.app,"firestore",s._databaseId.database),s._delete()}function Hx(s,e){const t=Zt(s=nt(s,Vt)),n=new BA;return j6(t,s._databaseId,e,n),n}function GA(s,e){return A6(Zt(s=nt(s,Vt)),e).then((t=>t?new Mn(s,null,t.query):null))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class $A{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e){this._byteString=e}static fromBase64String(e){try{return new As(ln.fromBase64String(e))}catch(t){throw new he(re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new As(ln.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:As._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(bl(e,As._jsonSchema))return As.fromBase64String(e.bytes)}}As._jsonSchemaVersion="firestore/bytes/1.0",As._jsonSchema={type:En("string",As._jsonSchemaVersion),bytes:En("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ht(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function z6(){return new uo(vx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return qe(this._lat,e._lat)||qe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Br._jsonSchemaVersion}}static fromJSON(e){if(bl(e,Br._jsonSchema))return new Br(e.latitude,e.longitude)}}Br._jsonSchemaVersion="firestore/geoPoint/1.0",Br._jsonSchema={type:En("string",Br._jsonSchemaVersion),latitude:En("number"),longitude:En("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,a){if(n.length!==a.length)return!1;for(let l=0;l<n.length;++l)if(n[l]!==a[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:vr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(bl(e,vr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new vr(e.vectorValues);throw new he(re.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}vr._jsonSchemaVersion="firestore/vectorValue/1.0",vr._jsonSchema={type:En("string",vr._jsonSchemaVersion),vectorValues:En("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H6=/^__.*__$/;class G6{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new ri(e,this.data,this.fieldMask,t,this.fieldTransforms):new lu(e,this.data,t,this.fieldTransforms)}}class KA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ri(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function QA(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Se(40011,{Ac:s})}}class Eg{constructor(e,t,n,a,l,u){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Eg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return zm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(QA(this.Ac)&&H6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class $6{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||wl(e)}Cc(e,t,n,a=!1){return new Eg({Ac:e,methodName:t,Dc:n,path:Ht.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _l(s){const e=s._freezeSettings(),t=wl(s._databaseId);return new $6(s._databaseId,!!e.ignoreUndefinedProperties,t)}function Sg(s,e,t,n,a,l={}){const u=s.Cc(l.merge||l.mergeFields?2:0,e,t,a);h0("Data must be an object, but it was:",u,n);const h=WA(n,u);let m,p;if(l.merge)m=new Is(u.fieldMask),p=u.fieldTransforms;else if(l.mergeFields){const x=[];for(const w of l.mergeFields){const b=ih(e,w,t);if(!u.contains(b))throw new he(re.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);ZA(x,b)||x.push(b)}m=new Is(x),p=u.fieldTransforms.filter((w=>m.covers(w.field)))}else m=null,p=u.fieldTransforms;return new G6(new as(h),m,p)}class Nh extends ho{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Nh}}function YA(s,e,t){return new Eg({Ac:3,Dc:e.settings.Dc,methodName:s._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class i0 extends ho{_toFieldTransform(e){return new xh(e.path,new Hc)}isEqual(e){return e instanceof i0}}class o0 extends ho{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=YA(this,e,!0),n=this.vc.map((l=>Nl(l,t))),a=new ul(n);return new xh(e.path,a)}isEqual(e){return e instanceof o0&&br(this.vc,e.vc)}}class l0 extends ho{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=YA(this,e,!0),n=this.vc.map((l=>Nl(l,t))),a=new dl(n);return new xh(e.path,a)}isEqual(e){return e instanceof l0&&br(this.vc,e.vc)}}class c0 extends ho{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Gc(e.serializer,xj(e.serializer,this.Fc));return new xh(e.path,t)}isEqual(e){return e instanceof c0&&this.Fc===e.Fc}}function u0(s,e,t,n){const a=s.Cc(1,e,t);h0("Data must be an object, but it was:",a,n);const l=[],u=as.empty();oo(n,((m,p)=>{const x=jg(e,m,t);p=yt(p);const w=a.yc(x);if(p instanceof Nh)l.push(x);else{const b=Nl(p,w);b!=null&&(l.push(x),u.set(x,b))}}));const h=new Is(l);return new KA(u,h,a.fieldTransforms)}function d0(s,e,t,n,a,l){const u=s.Cc(1,e,t),h=[ih(e,n,t)],m=[a];if(l.length%2!=0)throw new he(re.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<l.length;b+=2)h.push(ih(e,l[b])),m.push(l[b+1]);const p=[],x=as.empty();for(let b=h.length-1;b>=0;--b)if(!ZA(p,h[b])){const E=h[b];let k=m[b];k=yt(k);const R=u.yc(E);if(k instanceof Nh)p.push(E);else{const U=Nl(k,R);U!=null&&(p.push(E),x.set(E,U))}}const w=new Is(p);return new KA(x,w,u.fieldTransforms)}function XA(s,e,t,n=!1){return Nl(t,s.Cc(n?4:3,e))}function Nl(s,e){if(JA(s=yt(s)))return h0("Unsupported field value:",e,s),WA(s,e);if(s instanceof ho)return(function(n,a){if(!QA(a.Ac))throw a.Sc(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${n._methodName}() is not currently supported inside arrays`);const l=n._toFieldTransform(a);l&&a.fieldTransforms.push(l)})(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,a){const l=[];let u=0;for(const h of n){let m=Nl(h,a.wc(u));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),u++}return{arrayValue:{values:l}}})(s,e)}return(function(n,a){if((n=yt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return xj(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const l=Nt.fromDate(n);return{timestampValue:$c(a.serializer,l)}}if(n instanceof Nt){const l=new Nt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:$c(a.serializer,l)}}if(n instanceof Br)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof As)return{bytesValue:kj(a.serializer,n._byteString)};if(n instanceof It){const l=a.databaseId,u=n.firestore._databaseId;if(!u.isEqual(l))throw a.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:Iv(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof vr)return(function(u,h){return{mapValue:{fields:{[vv]:{stringValue:bv},[Bc]:{arrayValue:{values:u.toArray().map((p=>{if(typeof p!="number")throw h.Sc("VectorValues must only contain numeric values.");return Tv(h.serializer,p)}))}}}}}})(n,a);throw a.Sc(`Unsupported field value: ${ag(n)}`)})(s,e)}function WA(s,e){const t={};return GS(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oo(s,((n,a)=>{const l=Nl(a,e.mc(n));l!=null&&(t[n]=l)})),{mapValue:{fields:t}}}function JA(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof Nt||s instanceof Br||s instanceof As||s instanceof It||s instanceof ho||s instanceof vr)}function h0(s,e,t){if(!JA(t)||!SS(t)){const n=ag(t);throw n==="an object"?e.Sc(s+" a custom object"):e.Sc(s+" "+n)}}function ih(s,e,t){if((e=yt(e))instanceof uo)return e._internalPath;if(typeof e=="string")return jg(s,e);throw zm("Field path arguments must be of type string or ",s,!1,void 0,t)}const K6=new RegExp("[~\\*/\\[\\]]");function jg(s,e,t){if(e.search(K6)>=0)throw zm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new uo(...e.split("."))._internalPath}catch{throw zm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function zm(s,e,t,n,a){const l=n&&!n.isEmpty(),u=a!==void 0;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let m="";return(l||u)&&(m+=" (found",l&&(m+=` in field ${n}`),u&&(m+=` in document ${a}`),m+=")"),new he(re.INVALID_ARGUMENT,h+s+m)}function ZA(s,e){return s.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e,t,n,a,l){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new It(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Q6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ag("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Q6 extends oh{data(){return super.data()}}function Ag(s,e){return typeof e=="string"?jg(s,e):e instanceof uo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e1(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new he(re.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class f0{}class gu extends f0{}function Fe(s,e,...t){let n=[];e instanceof f0&&n.push(e),n=n.concat(t),(function(l){const u=l.filter((m=>m instanceof Tl)).length,h=l.filter((m=>m instanceof pu)).length;if(u>1||u>0&&h>0)throw new he(re.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const a of n)s=a._apply(s);return s}class pu extends gu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new pu(e,t,n)}_apply(e){const t=this._parse(e);return n1(e._query,t),new Mn(e.firestore,e.converter,Ix(e._query,t))}_parse(e){const t=_l(e.firestore);return(function(l,u,h,m,p,x,w){let b;if(p.isKeyField()){if(x==="array-contains"||x==="array-contains-any")throw new he(re.INVALID_ARGUMENT,`Invalid Query. You can't perform '${x}' queries on documentId().`);if(x==="in"||x==="not-in"){BT(w,x);const k=[];for(const R of w)k.push(UT(m,l,R));b={arrayValue:{values:k}}}else b=UT(m,l,w)}else x!=="in"&&x!=="not-in"&&x!=="array-contains-any"||BT(w,x),b=XA(h,u,w,x==="in"||x==="not-in");return ct.create(p,x,b)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ye(s,e,t){const n=e,a=Ag("where",s);return pu._create(a,n,t)}class Tl extends f0{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Tl(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:Ct.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(a,l){let u=a;const h=l.getFlattenedFilters();for(const m of h)n1(u,m),u=Ix(u,m)})(e._query,t),new Mn(e.firestore,e.converter,Ix(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Y6(...s){return s.forEach((e=>s1("or",e))),Tl._create("or",s)}function X6(...s){return s.forEach((e=>s1("and",e))),Tl._create("and",s)}class Cg extends gu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Cg(e,t)}_apply(e){const t=(function(a,l,u){if(a.startAt!==null)throw new he(re.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new he(re.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sh(l,u)})(e._query,this._field,this._direction);return new Mn(e.firestore,e.converter,(function(a,l){const u=a.explicitOrderBy.concat([l]);return new ni(a.path,a.collectionGroup,u,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)})(e._query,t))}}function an(s,e="asc"){const t=e,n=Ag("orderBy",s);return Cg._create(n,t)}class Th extends gu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Th(e,t,n)}_apply(e){return new Mn(e.firestore,e.converter,Pm(e._query,this._limit,this._limitType))}}function on(s){return jS("limit",s),Th._create("limit",s,"F")}function W6(s){return jS("limitToLast",s),Th._create("limitToLast",s,"L")}class Eh extends gu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Eh(e,t,n)}_apply(e){const t=t1(e,this.type,this._docOrFields,this._inclusive);return new Mn(e.firestore,e.converter,(function(a,l){return new ni(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,l,a.endAt)})(e._query,t))}}function J6(...s){return Eh._create("startAt",s,!0)}function Z6(...s){return Eh._create("startAfter",s,!1)}class Sh extends gu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Sh(e,t,n)}_apply(e){const t=t1(e,this.type,this._docOrFields,this._inclusive);return new Mn(e.firestore,e.converter,(function(a,l){return new ni(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,l)})(e._query,t))}}function e3(...s){return Sh._create("endBefore",s,!1)}function t3(...s){return Sh._create("endAt",s,!0)}function t1(s,e,t,n){if(t[0]=yt(t[0]),t[0]instanceof oh)return(function(l,u,h,m,p){if(!m)throw new he(re.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const x=[];for(const w of Cc(l))if(w.field.isKeyField())x.push(ll(u,m.key));else{const b=m.data.field(w.field);if(ug(b))throw new he(re.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+w.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(b===null){const E=w.field.canonicalString();throw new he(re.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}x.push(b)}return new to(x,p)})(s._query,s.firestore._databaseId,e,t[0]._document,n);{const a=_l(s.firestore);return(function(u,h,m,p,x,w){const b=u.explicitOrderBy;if(x.length>b.length)throw new he(re.INVALID_ARGUMENT,`Too many arguments provided to ${p}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const E=[];for(let k=0;k<x.length;k++){const R=x[k];if(b[k].field.isKeyField()){if(typeof R!="string")throw new he(re.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${p}(), but got a ${typeof R}`);if(!_v(u)&&R.indexOf("/")!==-1)throw new he(re.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${p}() must be a plain document ID, but '${R}' contains a slash.`);const U=u.path.child(tt.fromString(R));if(!_e.isDocumentKey(U))throw new he(re.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${p}() must result in a valid document path, but '${U}' is not because it contains an odd number of segments.`);const z=new _e(U);E.push(ll(h,z))}else{const U=XA(m,p,R);E.push(U)}}return new to(E,w)})(s._query,s.firestore._databaseId,a,e,t,n)}}function UT(s,e,t){if(typeof(t=yt(t))=="string"){if(t==="")throw new he(re.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!_v(e)&&t.indexOf("/")!==-1)throw new he(re.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(tt.fromString(t));if(!_e.isDocumentKey(n))throw new he(re.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ll(s,new _e(n))}if(t instanceof It)return ll(s,t._key);throw new he(re.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ag(t)}.`)}function BT(s,e){if(!Array.isArray(s)||s.length===0)throw new he(re.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function n1(s,e){const t=(function(a,l){for(const u of a)for(const h of u.getFlattenedFilters())if(l.indexOf(h.op)>=0)return h.op;return null})(s.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new he(re.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new he(re.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function s1(s,e){if(!(e instanceof pu||e instanceof Tl))throw new he(re.INVALID_ARGUMENT,`Function ${s}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class m0{convertValue(e,t="none"){switch(Zi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Xt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Za(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Se(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return oo(e,((a,l)=>{n[a]=this.convertValue(l,t)})),n}convertVectorValue(e){const t=e.fields?.[Bc].arrayValue?.values?.map((n=>Xt(n.doubleValue)));return new vr(t)}convertGeoPoint(e){return new Br(Xt(e.latitude),Xt(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=dg(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Zd(e));default:return null}}convertTimestamp(e){const t=Ja(e);return new Nt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=tt.fromString(e);De(Bj(n),9688,{name:e});const a=new Ji(n.get(1),n.get(3)),l=new _e(n.popFirst(5));return a.isEqual(t)||yn(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(s,e,t){let n;return n=s?t&&(t.merge||t.mergeFields)?s.toFirestore(e,t):s.toFirestore(e):e,n}class g0 extends m0{constructor(e){super(),this.firestore=e}convertBytes(e){return new As(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new It(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n3(s){return new Zc("sum",ih("sum",s))}function s3(s){return new Zc("avg",ih("average",s))}function r1(){return new Zc("count")}function r3(s,e){return s instanceof Zc&&e instanceof Zc&&s.aggregateType===e.aggregateType&&s._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function a3(s,e){return a0(s.query,e.query)&&br(s.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a1="NOT SUPPORTED";class Ga{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ps extends oh{constructor(e,t,n,a,l,u){super(e,t,n,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Hd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ag("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new he(re.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ps._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function i3(s,e,t){if(bl(e,Ps._jsonSchema)){if(e.bundle===a1)throw new he(re.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=wl(s._databaseId),a=VA(e.bundle,n),l=a.Wu(),u=new Yv(a.getMetadata(),n);for(const x of l)u.Ga(x);const h=u.documents;if(h.length!==1)throw new he(re.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);const m=gg(n,h[0].document),p=new _e(tt.fromString(e.bundleName));return new Ps(s,new g0(s),p,m,new Ga(!1,!1),t||null)}}Ps._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ps._jsonSchema={type:En("string",Ps._jsonSchemaVersion),bundleSource:En("string","DocumentSnapshot"),bundleName:En("string"),bundle:En("string")};class Hd extends Ps{data(e={}){return super.data(e)}}class Ms{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new Ga(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Hd(this._firestore,this._userDataWriter,n.key,n,new Ga(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(re.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(a,l){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map((h=>{const m=new Hd(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Ga(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:m,oldIndex:-1,newIndex:u++}}))}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>l||h.type!==3)).map((h=>{const m=new Hd(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Ga(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,x=-1;return h.type!==0&&(p=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),x=u.indexOf(h.doc.key)),{type:l3(h.type),doc:m,oldIndex:p,newIndex:x}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new he(re.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ms._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rg.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],a=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),n.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function o3(s,e,t){if(bl(e,Ms._jsonSchema)){if(e.bundle===a1)throw new he(re.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=wl(s._databaseId),a=VA(e.bundle,n),l=a.Wu(),u=new Yv(a.getMetadata(),n);for(const b of l)u.Ga(b);if(u.queries.length!==1)throw new he(re.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${u.queries.length} queries.`);const h=yg(u.queries[0].bundledQuery),m=u.documents;let p=new sl;m.map((b=>{const E=gg(n,b.document);p=p.add(E)}));const x=pl.fromInitialDocuments(h,p,Xe(),!1,!1),w=new Mn(s,t||null,h);return new Ms(s,new g0(s),w,x)}}function l3(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Se(61501,{type:s})}}function c3(s,e){return s instanceof Ps&&e instanceof Ps?s._firestore===e._firestore&&s._key.isEqual(e._key)&&(s._document===null?e._document===null:s._document.isEqual(e._document))&&s._converter===e._converter:s instanceof Ms&&e instanceof Ms&&s._firestore===e._firestore&&a0(s.query,e.query)&&s.metadata.isEqual(e.metadata)&&s._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bt(s){s=nt(s,It);const e=nt(s.firestore,Vt);return MA(Zt(e),s._key).then((t=>p0(e,s,t)))}Ms._jsonSchemaVersion="firestore/querySnapshot/1.0",Ms._jsonSchema={type:En("string",Ms._jsonSchemaVersion),bundleSource:En("string","QuerySnapshot"),bundleName:En("string"),bundle:En("string")};class fo extends m0{constructor(e){super(),this.firestore=e}convertBytes(e){return new As(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new It(this.firestore,null,t)}}function u3(s){s=nt(s,It);const e=nt(s.firestore,Vt),t=Zt(e),n=new fo(e);return N6(t,s._key).then((a=>new Ps(e,n,s._key,a,new Ga(a!==null&&a.hasLocalMutations,!0),s.converter)))}function d3(s){s=nt(s,It);const e=nt(s.firestore,Vt);return MA(Zt(e),s._key,{source:"server"}).then((t=>p0(e,s,t)))}function Ke(s){s=nt(s,Mn);const e=nt(s.firestore,Vt),t=Zt(e),n=new fo(e);return e1(s._query),OA(t,s._query).then((a=>new Ms(e,n,s,a)))}function h3(s){s=nt(s,Mn);const e=nt(s.firestore,Vt),t=Zt(e),n=new fo(e);return T6(t,s._query).then((a=>new Ms(e,n,s,a)))}function f3(s){s=nt(s,Mn);const e=nt(s.firestore,Vt),t=Zt(e),n=new fo(e);return OA(t,s._query,{source:"server"}).then((a=>new Ms(e,n,s,a)))}function Os(s,e,t){s=nt(s,It);const n=nt(s.firestore,Vt),a=Ig(s.converter,e,t);return yu(n,[Sg(_l(n),"setDoc",s._key,a,s.converter!==null,t).toMutation(s._key,Jt.none())])}function Wt(s,e,t,...n){s=nt(s,It);const a=nt(s.firestore,Vt),l=_l(a);let u;return u=typeof(e=yt(e))=="string"||e instanceof uo?d0(l,"updateDoc",s._key,e,t,n):u0(l,"updateDoc",s._key,e),yu(a,[u.toMutation(s._key,Jt.exists(!0))])}function rl(s){return yu(nt(s.firestore,Vt),[new cu(s._key,Jt.none())])}function Ws(s,e){const t=nt(s.firestore,Vt),n=be(s),a=Ig(s.converter,e);return yu(t,[Sg(_l(s.firestore),"addDoc",n._key,a,s.converter!==null,{}).toMutation(n._key,Jt.exists(!1))]).then((()=>n))}function Hm(s,...e){s=yt(s);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||Ic(e[n])||(t=e[n++]);const a={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Ic(e[n])){const m=e[n];e[n]=m.next?.bind(m),e[n+1]=m.error?.bind(m),e[n+2]=m.complete?.bind(m)}let l,u,h;if(s instanceof It)u=nt(s.firestore,Vt),h=ou(s._key.path),l={next:m=>{e[n]&&e[n](p0(u,s,m))},error:e[n+1],complete:e[n+2]};else{const m=nt(s,Mn);u=nt(m.firestore,Vt),h=m._query;const p=new fo(u);l={next:x=>{e[n]&&e[n](new Ms(u,p,m,x))},error:e[n+1],complete:e[n+2]},e1(s._query)}return(function(p,x,w,b){const E=new Ng(b),k=new Qv(x,E,w);return p.asyncQueue.enqueueAndForget((async()=>Gv(await Jc(p),k))),()=>{E.Nu(),p.asyncQueue.enqueueAndForget((async()=>$v(await Jc(p),k)))}})(Zt(u),h,a,l)}function m3(s,e,...t){const n=yt(s),a=(function(m){const p={bundle:"",bundleName:"",bundleSource:""},x=["bundle","bundleName","bundleSource"];for(const w of x){if(!(w in m)){p.error=`snapshotJson missing required field: ${w}`;break}const b=m[w];if(typeof b!="string"){p.error=`snapshotJson field '${w}' must be a string.`;break}if(b.length===0){p.error=`snapshotJson field '${w}' cannot be an empty string.`;break}w==="bundle"?p.bundle=b:w==="bundleName"?p.bundleName=b:w==="bundleSource"&&(p.bundleSource=b)}return p})(e);if(a.error)throw new he(re.INVALID_ARGUMENT,a.error);let l,u=0;if(typeof t[u]!="object"||Ic(t[u])||(l=t[u++]),a.bundleSource==="QuerySnapshot"){let h=null;if(typeof t[u]=="object"&&Ic(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,w,b,E){let k,R=!1;return Hx(p,x.bundle).then((()=>GA(p,x.bundleName))).then((z=>{z&&!R&&(E&&z.withConverter(E),k=Hm(z,w||{},b))})).catch((z=>(b.error&&b.error(z),()=>{}))),()=>{R||(R=!0,k&&k())}})(n,a,l,h,t[u])}if(a.bundleSource==="DocumentSnapshot"){let h=null;if(typeof t[u]=="object"&&Ic(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,w,b,E){let k,R=!1;return Hx(p,x.bundle).then((()=>{if(!R){const z=new It(p,E||null,_e.fromPath(x.bundleName));k=Hm(z,w||{},b)}})).catch((z=>(b.error&&b.error(z),()=>{}))),()=>{R||(R=!0,k&&k())}})(n,a,l,h,t[u])}throw new he(re.INVALID_ARGUMENT,`unsupported bundle source: ${a.bundleSource}`)}function g3(s,e){return S6(Zt(s=nt(s,Vt)),Ic(e)?e:{next:e})}function yu(s,e){return(function(n,a){const l=new Xn;return n.asyncQueue.enqueueAndForget((async()=>e6(await r0(n),a,l))),l.promise})(Zt(s),e)}function p0(s,e,t){const n=t.docs.get(e._key),a=new fo(s);return new Ps(s,a,e._key,n,new Ga(t.hasPendingWrites,t.fromCache),e.converter)}function p3(s){return i1(s,{count:r1()})}function i1(s,e){const t=nt(s.firestore,Vt),n=Zt(t),a=HS(e,((l,u)=>new Ej(u,l.aggregateType,l._internalFieldPath)));return E6(n,s._query,a).then((l=>(function(h,m,p){const x=new fo(h);return new $A(m,x,p)})(t,s,l)))}class y3{constructor(e){this.kind="memory",this._onlineComponentProvider=so.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new t0(void 0)}}toJSON(){return{kind:this.kind}}}class x3{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=o1(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class v3{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Wc.provider}toJSON(){return{kind:this.kind}}}class b3{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new t0(e)}}toJSON(){return{kind:this.kind}}}function w3(){return new v3}function _3(s){return new b3(s?.cacheSizeBytes)}function N3(s){return new y3(s)}function T3(s){return new x3(s)}class E3{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=so.provider,this._offlineComponentProvider={build:t=>new n0(t,e?.cacheSizeBytes,this.forceOwnership)}}}class S3{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=so.provider,this._offlineComponentProvider={build:t=>new kA(t,e?.cacheSizeBytes)}}}function o1(s){return new E3(s?.forceOwnership)}function j3(){return new S3}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A3={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=_l(e)}set(e,t,n){this._verifyNotCommitted();const a=Hi(e,this._firestore),l=Ig(a.converter,t,n),u=Sg(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,n);return this._mutations.push(u.toMutation(a._key,Jt.none())),this}update(e,t,n,...a){this._verifyNotCommitted();const l=Hi(e,this._firestore);let u;return u=typeof(t=yt(t))=="string"||t instanceof uo?d0(this._dataReader,"WriteBatch.update",l._key,t,n,a):u0(this._dataReader,"WriteBatch.update",l._key,t),this._mutations.push(u.toMutation(l._key,Jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Hi(e,this._firestore);return this._mutations=this._mutations.concat(new cu(t._key,Jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new he(re.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Hi(s,e){if((s=yt(s)).firestore!==e)throw new he(re.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=_l(e)}get(e){const t=Hi(e,this._firestore),n=new g0(this._firestore);return this._transaction.lookup([t._key]).then((a=>{if(!a||a.length!==1)return Se(24041);const l=a[0];if(l.isFoundDocument())return new oh(this._firestore,n,l.key,l,t.converter);if(l.isNoDocument())return new oh(this._firestore,n,t._key,null,t.converter);throw Se(18433,{doc:l})}))}set(e,t,n){const a=Hi(e,this._firestore),l=Ig(a.converter,t,n),u=Sg(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,n);return this._transaction.set(a._key,u),this}update(e,t,n,...a){const l=Hi(e,this._firestore);let u;return u=typeof(t=yt(t))=="string"||t instanceof uo?d0(this._dataReader,"Transaction.update",l._key,t,n,a):u0(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,u),this}delete(e){const t=Hi(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1 extends C3{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Hi(e,this._firestore),n=new fo(this._firestore);return super.get(e).then((a=>new Ps(this._firestore,n,t._key,a._document,new Ga(!1,!1),t.converter)))}}function Rd(s,e,t){s=nt(s,Vt);const n={...A3,...t};return(function(l){if(l.maxAttempts<1)throw new he(re.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(l,u,h){const m=new Xn;return l.asyncQueue.enqueueAndForget((async()=>{const p=await PA(l);new v6(l.asyncQueue,p,h,u,m).ju()})),m.promise})(Zt(s),(a=>e(new c1(s,a))),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I3(){return new Nh("deleteField")}function Me(){return new i0("serverTimestamp")}function eu(...s){return new o0("arrayUnion",s)}function Gm(...s){return new l0("arrayRemove",s)}function pm(s){return new c0("increment",s)}function k3(s){return new vr(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function al(s){return Zt(s=nt(s,Vt)),new l1(s,(e=>yu(s,e)))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R3(s,e){const t=Zt(s=nt(s,Vt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Zs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const n=(function(l){const u=typeof l=="string"?(function(p){try{return JSON.parse(p)}catch(x){throw new he(re.INVALID_ARGUMENT,"Failed to parse JSON: "+x?.message)}})(l):l,h=[];if(Array.isArray(u.indexes))for(const m of u.indexes){const p=qT(m,"collectionGroup"),x=[];if(Array.isArray(m.fields))for(const w of m.fields){const b=jg("setIndexConfiguration",qT(w,"fieldPath"));w.arrayConfig==="CONTAINS"?x.push(new tl(b,2)):w.order==="ASCENDING"?x.push(new tl(b,0)):w.order==="DESCENDING"&&x.push(new tl(b,1))}h.push(new Mc(Mc.UNKNOWN_ID,p,x,Oc.empty()))}return h})(e);return C6(t,n)}function qT(s,e){if(typeof s[e]!="string")throw new he(re.INVALID_ARGUMENT,"Missing string value for: "+e);return s[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function D3(s){s=nt(s,Vt);const e=zT.get(s);if(e)return e;if(Zt(s)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const n=new u1(s);return zT.set(s,n),n}function P3(s){d1(s,!0)}function M3(s){d1(s,!1)}function O3(s){k6(Zt(s._firestore)).then((e=>pe("deleting all persistent cache indexes succeeded"))).catch((e=>Zs("deleting all persistent cache indexes failed",e)))}function d1(s,e){I6(Zt(s._firestore),e).then((t=>pe(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>Zs(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const zT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V3(s){const e=Zt(nt(s.firestore,Vt)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:pg(t,ms(s._query)).ft}function L3(s,e){const t=HS(e,((l,u)=>new Ej(u,l.aggregateType,l._internalFieldPath))),n=Zt(nt(s.firestore,Vt)),a=n._onlineComponents?.datastore.serializer;return a===void 0?null:Vj(a,cj(s._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return y0.instance.onExistenceFilterMismatch(e)}}class y0{constructor(){this.Mc=new Map}static get instance(){return Wf||(Wf=new y0,(function(t){if(kx)throw new Error("a TestingHooksSpi instance is already set");kx=t})(Wf)),Wf}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.Mc;return n.set(t,e),()=>n.delete(t)}}let Wf=null;(function(e,t=!0){(function(a){iu=a})(ru),qr(new wr("firestore",((n,{instanceIdentifier:a,options:l})=>{const u=n.getProvider("app").getImmediate(),h=new Vt(new gD(n.getProvider("auth-internal")),new xD(u,n.getProvider("app-check-internal")),(function(p,x){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new he(re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ji(p.options.projectId,x)})(u,a),u);return l={useFetchStreams:t,...l},h._setSettings(l),h}),"PUBLIC").setMultipleInstances(!0)),Ds(wN,_N,e),Ds(wN,_N,"esm2020")})();const Mr=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:m0,AggregateField:Zc,AggregateQuerySnapshot:$A,Bytes:As,CACHE_SIZE_UNLIMITED:P6,CollectionReference:Ur,DocumentReference:It,DocumentSnapshot:Ps,FieldPath:uo,FieldValue:ho,Firestore:Vt,FirestoreError:he,GeoPoint:Br,LoadBundleTask:BA,PersistentCacheIndexManager:u1,Query:Mn,QueryCompositeFilterConstraint:Tl,QueryConstraint:gu,QueryDocumentSnapshot:Hd,QueryEndAtConstraint:Sh,QueryFieldFilterConstraint:pu,QueryLimitConstraint:Th,QueryOrderByConstraint:Cg,QuerySnapshot:Ms,QueryStartAtConstraint:Eh,SnapshotMetadata:Ga,Timestamp:Nt,Transaction:c1,VectorValue:vr,WriteBatch:l1,_AutoId:rg,_ByteString:ln,_DatabaseId:Ji,_DocumentKey:_e,_EmptyAppCheckTokenProvider:vD,_EmptyAuthCredentialsProvider:NS,_FieldPath:Ht,_TestingHooks:F3,_cast:nt,_debugAssert:fD,_internalAggregationQueryToProtoRunAggregationQueryRequest:L3,_internalQueryToProtoQueryTarget:V3,_isBase64Available:n4,_logWarn:Zs,_validateIsNotUsedTogether:ES,addDoc:Ws,aggregateFieldEqual:r3,aggregateQuerySnapshotEqual:a3,and:X6,arrayRemove:Gm,arrayUnion:eu,average:s3,clearIndexedDbPersistence:L6,collection:Ie,collectionGroup:R6,connectFirestoreEmulator:UA,count:r1,deleteAllPersistentCacheIndexes:O3,deleteDoc:rl,deleteField:I3,disableNetwork:B6,disablePersistentCacheIndexAutoCreation:M3,doc:be,documentId:z6,documentSnapshotFromJSON:i3,enableIndexedDbPersistence:O6,enableMultiTabIndexedDbPersistence:V6,enableNetwork:U6,enablePersistentCacheIndexAutoCreation:P3,endAt:t3,endBefore:e3,ensureFirestoreConfigured:Zt,executeWrite:yu,getAggregateFromServer:i1,getCountFromServer:p3,getDoc:bt,getDocFromCache:u3,getDocFromServer:d3,getDocs:Ke,getDocsFromCache:h3,getDocsFromServer:f3,getFirestore:qA,getPersistentCacheIndexManager:D3,increment:pm,initializeFirestore:M6,limit:on,limitToLast:W6,loadBundle:Hx,memoryEagerGarbageCollector:w3,memoryLocalCache:N3,memoryLruGarbageCollector:_3,namedQuery:GA,onSnapshot:Hm,onSnapshotResume:m3,onSnapshotsInSync:g3,or:Y6,orderBy:an,persistentLocalCache:T3,persistentMultipleTabManager:j3,persistentSingleTabManager:o1,query:Fe,queryEqual:a0,querySnapshotFromJSON:o3,refEqual:D6,runTransaction:Rd,serverTimestamp:Me,setDoc:Os,setIndexConfiguration:R3,setLogLevel:hD,snapshotEqual:c3,startAfter:Z6,startAt:J6,sum:n3,terminate:q6,updateDoc:Wt,vector:k3,waitForPendingWrites:F6,where:Ye,writeBatch:al},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U3="type.googleapis.com/google.protobuf.Int64Value",B3="type.googleapis.com/google.protobuf.UInt64Value";function h1(s,e){const t={};for(const n in s)s.hasOwnProperty(n)&&(t[n]=e(s[n]));return t}function $m(s){if(s==null)return null;if(s instanceof Number&&(s=s.valueOf()),typeof s=="number"&&isFinite(s)||s===!0||s===!1||Object.prototype.toString.call(s)==="[object String]")return s;if(s instanceof Date)return s.toISOString();if(Array.isArray(s))return s.map(e=>$m(e));if(typeof s=="function"||typeof s=="object")return h1(s,e=>$m(e));throw new Error("Data cannot be encoded in JSON: "+s)}function tu(s){if(s==null)return s;if(s["@type"])switch(s["@type"]){case U3:case B3:{const e=Number(s.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+s);return e}default:throw new Error("Data cannot be decoded from JSON: "+s)}return Array.isArray(s)?s.map(e=>tu(e)):typeof s=="function"||typeof s=="object"?h1(s,e=>tu(e)):s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x0="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ws extends Nr{constructor(e,t,n){super(`${x0}/${e}`,t||""),this.details=n,Object.setPrototypeOf(this,ws.prototype)}}function q3(s){if(s>=200&&s<300)return"ok";switch(s){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Km(s,e){let t=q3(s),n=t,a;try{const l=e&&e.error;if(l){const u=l.status;if(typeof u=="string"){if(!HT[u])return new ws("internal","internal");t=HT[u],n=u}const h=l.message;typeof h=="string"&&(n=h),a=l.details,a!==void 0&&(a=tu(a))}}catch{}return t==="ok"?null:new ws(t,n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z3{constructor(e,t,n,a){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Xs(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(l=>this.auth=l,()=>{}),this.messaging||n.get().then(l=>this.messaging=l,()=>{}),this.appCheck||a?.get().then(l=>this.appCheck=l,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),n=await this.getMessagingToken(),a=await this.getAppCheckToken(e);return{authToken:t,messagingToken:n,appCheckToken:a}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx="us-central1",H3=/^data: (.*?)(?:\n|$)/;function G3(s){let e=null;return{promise:new Promise((t,n)=>{e=setTimeout(()=>{n(new ws("deadline-exceeded","deadline-exceeded"))},s)}),cancel:()=>{e&&clearTimeout(e)}}}class $3{constructor(e,t,n,a,l=Gx,u=(...h)=>fetch(...h)){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new z3(e,t,n,a),this.cancelAllRequests=new Promise(h=>{this.deleteService=()=>Promise.resolve(h())});try{const h=new URL(l);this.customDomain=h.origin+(h.pathname==="/"?"":h.pathname),this.region=Gx}catch{this.customDomain=null,this.region=l}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function K3(s,e,t){const n=ti(e);s.emulatorOrigin=`http${n?"s":""}://${e}:${t}`,n&&(Jm(s.emulatorOrigin+"/backends"),Jx("Functions",!0))}function Q3(s,e,t){const n=a=>X3(s,e,a,t||{});return n.stream=(a,l)=>J3(s,e,a,l),n}function f1(s){return s.emulatorOrigin&&ti(s.emulatorOrigin)?"include":void 0}async function Y3(s,e,t,n,a){t["Content-Type"]="application/json";let l;try{l=await n(s,{method:"POST",body:JSON.stringify(e),headers:t,credentials:f1(a)})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function m1(s,e){const t={},n=await s.contextProvider.getContext(e.limitedUseAppCheckTokens);return n.authToken&&(t.Authorization="Bearer "+n.authToken),n.messagingToken&&(t["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=n.appCheckToken),t}function X3(s,e,t,n){const a=s._url(e);return W3(s,a,t,n)}async function W3(s,e,t,n){t=$m(t);const a={data:t},l=await m1(s,n),u=n.timeout||7e4,h=G3(u),m=await Promise.race([Y3(e,a,l,s.fetchImpl,s),h.promise,s.cancelAllRequests]);if(h.cancel(),!m)throw new ws("cancelled","Firebase Functions instance was deleted.");const p=Km(m.status,m.json);if(p)throw p;if(!m.json)throw new ws("internal","Response is not valid JSON object.");let x=m.json.data;if(typeof x>"u"&&(x=m.json.result),typeof x>"u")throw new ws("internal","Response is missing data field.");return{data:tu(x)}}function J3(s,e,t,n){const a=s._url(e);return Z3(s,a,t,n||{})}async function Z3(s,e,t,n){t=$m(t);const a={data:t},l=await m1(s,n);l["Content-Type"]="application/json",l.Accept="text/event-stream";let u;try{u=await s.fetchImpl(e,{method:"POST",body:JSON.stringify(a),headers:l,signal:n?.signal,credentials:f1(s)})}catch(b){if(b instanceof Error&&b.name==="AbortError"){const k=new ws("cancelled","Request was cancelled.");return{data:Promise.reject(k),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(k)}}}}}}const E=Km(0,null);return{data:Promise.reject(E),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(E)}}}}}}let h,m;const p=new Promise((b,E)=>{h=b,m=E});n?.signal?.addEventListener("abort",()=>{const b=new ws("cancelled","Request was cancelled.");m(b)});const x=u.body.getReader(),w=e5(x,h,m,n?.signal);return{stream:{[Symbol.asyncIterator](){const b=w.getReader();return{async next(){const{value:E,done:k}=await b.read();return{value:E,done:k}},async return(){return await b.cancel(),{done:!0,value:void 0}}}}},data:p}}function e5(s,e,t,n){const a=(u,h)=>{const m=u.match(H3);if(!m)return;const p=m[1];try{const x=JSON.parse(p);if("result"in x){e(tu(x.result));return}if("message"in x){h.enqueue(tu(x.message));return}if("error"in x){const w=Km(0,x);h.error(w),t(w);return}}catch(x){if(x instanceof ws){h.error(x),t(x);return}}},l=new TextDecoder;return new ReadableStream({start(u){let h="";return m();async function m(){if(n?.aborted){const p=new ws("cancelled","Request was cancelled");return u.error(p),t(p),Promise.resolve()}try{const{value:p,done:x}=await s.read();if(x){h.trim()&&a(h.trim(),u),u.close();return}if(n?.aborted){const b=new ws("cancelled","Request was cancelled");u.error(b),t(b),await s.cancel();return}h+=l.decode(p,{stream:!0});const w=h.split(`
`);h=w.pop()||"";for(const b of w)b.trim()&&a(b.trim(),u);return m()}catch(p){const x=p instanceof ws?p:Km(0,null);u.error(x),t(x)}}},cancel(){return s.cancel()}})}const GT="@firebase/functions",$T="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5="auth-internal",n5="app-check-internal",s5="messaging-internal";function r5(s){const e=(t,{instanceIdentifier:n})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider(t5),u=t.getProvider(s5),h=t.getProvider(n5);return new $3(a,l,u,h,n)};qr(new wr(x0,e,"PUBLIC").setMultipleInstances(!0)),Ds(GT,$T,s),Ds(GT,$T,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g1(s=eg(),e=Gx){const n=ya(yt(s),x0).getImmediate({identifier:e}),a=wE("functions");return a&&p1(n,...a),n}function p1(s,e,t){K3(yt(s),e,t)}function $a(s,e,t){return Q3(yt(s),e,t)}r5();const a5=Object.freeze(Object.defineProperty({__proto__:null,FunctionsError:ws,connectFunctionsEmulator:p1,getFunctions:g1,httpsCallable:$a},Symbol.toStringTag,{value:"Module"})),y1="@firebase/installations",v0="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x1=1e4,v1=`w:${v0}`,b1="FIS_v2",i5="https://firebaseinstallations.googleapis.com/v1",o5=3600*1e3,l5="installations",c5="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u5={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},yl=new vl(l5,c5,u5);function w1(s){return s instanceof Nr&&s.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1({projectId:s}){return`${i5}/projects/${s}/installations`}function N1(s){return{token:s.token,requestStatus:2,expiresIn:h5(s.expiresIn),creationTime:Date.now()}}async function T1(s,e){const n=(await e.json()).error;return yl.create("request-failed",{requestName:s,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function E1({apiKey:s}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":s})}function d5(s,{refreshToken:e}){const t=E1(s);return t.append("Authorization",f5(e)),t}async function S1(s){const e=await s();return e.status>=500&&e.status<600?s():e}function h5(s){return Number(s.replace("s","000"))}function f5(s){return`${b1} ${s}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m5({appConfig:s,heartbeatServiceProvider:e},{fid:t}){const n=_1(s),a=E1(s),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&a.append("x-firebase-client",p)}const u={fid:t,authVersion:b1,appId:s.appId,sdkVersion:v1},h={method:"POST",headers:a,body:JSON.stringify(u)},m=await S1(()=>fetch(n,h));if(m.ok){const p=await m.json();return{fid:p.fid||t,registrationStatus:2,refreshToken:p.refreshToken,authToken:N1(p.authToken)}}else throw await T1("Create Installation",m)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(s){return new Promise(e=>{setTimeout(e,s)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g5(s){return btoa(String.fromCharCode(...s)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5=/^[cdef][\w-]{21}$/,$x="";function y5(){try{const s=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(s),s[0]=112+s[0]%16;const t=x5(s);return p5.test(t)?t:$x}catch{return $x}}function x5(s){return g5(s).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kg(s){return`${s.appName}!${s.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A1=new Map;function C1(s,e){const t=kg(s);I1(t,e),v5(t,e)}function I1(s,e){const t=A1.get(s);if(t)for(const n of t)n(e)}function v5(s,e){const t=b5();t&&t.postMessage({key:s,fid:e}),w5()}let el=null;function b5(){return!el&&"BroadcastChannel"in self&&(el=new BroadcastChannel("[Firebase] FID Change"),el.onmessage=s=>{I1(s.data.key,s.data.fid)}),el}function w5(){A1.size===0&&el&&(el.close(),el=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="firebase-installations-database",N5=1,xl="firebase-installations-store";let Zy=null;function b0(){return Zy||(Zy=kE(_5,N5,{upgrade:(s,e)=>{switch(e){case 0:s.createObjectStore(xl)}}})),Zy}async function Qm(s,e){const t=kg(s),a=(await b0()).transaction(xl,"readwrite"),l=a.objectStore(xl),u=await l.get(t);return await l.put(e,t),await a.done,(!u||u.fid!==e.fid)&&C1(s,e.fid),e}async function k1(s){const e=kg(s),n=(await b0()).transaction(xl,"readwrite");await n.objectStore(xl).delete(e),await n.done}async function Rg(s,e){const t=kg(s),a=(await b0()).transaction(xl,"readwrite"),l=a.objectStore(xl),u=await l.get(t),h=e(u);return h===void 0?await l.delete(t):await l.put(h,t),await a.done,h&&(!u||u.fid!==h.fid)&&C1(s,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w0(s){let e;const t=await Rg(s.appConfig,n=>{const a=T5(n),l=E5(s,a);return e=l.registrationPromise,l.installationEntry});return t.fid===$x?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function T5(s){const e=s||{fid:y5(),registrationStatus:0};return R1(e)}function E5(s,e){if(e.registrationStatus===0){if(!navigator.onLine){const a=Promise.reject(yl.create("app-offline"));return{installationEntry:e,registrationPromise:a}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=S5(s,t);return{installationEntry:t,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:j5(s)}:{installationEntry:e}}async function S5(s,e){try{const t=await m5(s,e);return Qm(s.appConfig,t)}catch(t){throw w1(t)&&t.customData.serverCode===409?await k1(s.appConfig):await Qm(s.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function j5(s){let e=await KT(s.appConfig);for(;e.registrationStatus===1;)await j1(100),e=await KT(s.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:n}=await w0(s);return n||t}return e}function KT(s){return Rg(s,e=>{if(!e)throw yl.create("installation-not-found");return R1(e)})}function R1(s){return A5(s)?{fid:s.fid,registrationStatus:0}:s}function A5(s){return s.registrationStatus===1&&s.registrationTime+x1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C5({appConfig:s,heartbeatServiceProvider:e},t){const n=I5(s,t),a=d5(s,t),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&a.append("x-firebase-client",p)}const u={installation:{sdkVersion:v1,appId:s.appId}},h={method:"POST",headers:a,body:JSON.stringify(u)},m=await S1(()=>fetch(n,h));if(m.ok){const p=await m.json();return N1(p)}else throw await T1("Generate Auth Token",m)}function I5(s,{fid:e}){return`${_1(s)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _0(s,e=!1){let t;const n=await Rg(s.appConfig,l=>{if(!D1(l))throw yl.create("not-registered");const u=l.authToken;if(!e&&D5(u))return l;if(u.requestStatus===1)return t=k5(s,e),l;{if(!navigator.onLine)throw yl.create("app-offline");const h=M5(l);return t=R5(s,h),h}});return t?await t:n.authToken}async function k5(s,e){let t=await QT(s.appConfig);for(;t.authToken.requestStatus===1;)await j1(100),t=await QT(s.appConfig);const n=t.authToken;return n.requestStatus===0?_0(s,e):n}function QT(s){return Rg(s,e=>{if(!D1(e))throw yl.create("not-registered");const t=e.authToken;return O5(t)?{...e,authToken:{requestStatus:0}}:e})}async function R5(s,e){try{const t=await C5(s,e),n={...e,authToken:t};return await Qm(s.appConfig,n),t}catch(t){if(w1(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await k1(s.appConfig);else{const n={...e,authToken:{requestStatus:0}};await Qm(s.appConfig,n)}throw t}}function D1(s){return s!==void 0&&s.registrationStatus===2}function D5(s){return s.requestStatus===2&&!P5(s)}function P5(s){const e=Date.now();return e<s.creationTime||s.creationTime+s.expiresIn<e+o5}function M5(s){const e={requestStatus:1,requestTime:Date.now()};return{...s,authToken:e}}function O5(s){return s.requestStatus===1&&s.requestTime+x1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V5(s){const e=s,{installationEntry:t,registrationPromise:n}=await w0(e);return n?n.catch(console.error):_0(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L5(s,e=!1){const t=s;return await F5(t),(await _0(t,e)).token}async function F5(s){const{registrationPromise:e}=await w0(s);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U5(s){if(!s||!s.options)throw ex("App Configuration");if(!s.name)throw ex("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!s.options[t])throw ex(t);return{appName:s.name,projectId:s.options.projectId,apiKey:s.options.apiKey,appId:s.options.appId}}function ex(s){return yl.create("missing-app-config-values",{valueName:s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P1="installations",B5="installations-internal",q5=s=>{const e=s.getProvider("app").getImmediate(),t=U5(e),n=ya(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},z5=s=>{const e=s.getProvider("app").getImmediate(),t=ya(e,P1).getImmediate();return{getId:()=>V5(t),getToken:a=>L5(t,a)}};function H5(){qr(new wr(P1,q5,"PUBLIC")),qr(new wr(B5,z5,"PRIVATE"))}H5();Ds(y1,v0);Ds(y1,v0,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ym="analytics",G5="firebase_id",$5="origin",K5=60*1e3,Q5="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",N0="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vs=new Zm("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y5={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Js=new vl("analytics","Analytics",Y5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X5(s){if(!s.startsWith(N0)){const e=Js.create("invalid-gtag-resource",{gtagURL:s});return Vs.warn(e.message),""}return s}function M1(s){return Promise.all(s.map(e=>e.catch(t=>t)))}function W5(s,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(s,e)),t}function J5(s,e){const t=W5("firebase-js-sdk-policy",{createScriptURL:X5}),n=document.createElement("script"),a=`${N0}?l=${s}&id=${e}`;n.src=t?t?.createScriptURL(a):a,n.async=!0,document.head.appendChild(n)}function Z5(s){let e=[];return Array.isArray(window[s])?e=window[s]:window[s]=e,e}async function eM(s,e,t,n,a,l){const u=n[a];try{if(u)await e[u];else{const m=(await M1(t)).find(p=>p.measurementId===a);m&&await e[m.appId]}}catch(h){Vs.error(h)}s("config",a,l)}async function tM(s,e,t,n,a){try{let l=[];if(a&&a.send_to){let u=a.send_to;Array.isArray(u)||(u=[u]);const h=await M1(t);for(const m of u){const p=h.find(w=>w.measurementId===m),x=p&&e[p.appId];if(x)l.push(x);else{l=[];break}}}l.length===0&&(l=Object.values(e)),await Promise.all(l),s("event",n,a||{})}catch(l){Vs.error(l)}}function nM(s,e,t,n){async function a(l,...u){try{if(l==="event"){const[h,m]=u;await tM(s,e,t,h,m)}else if(l==="config"){const[h,m]=u;await eM(s,e,t,n,h,m)}else if(l==="consent"){const[h,m]=u;s("consent",h,m)}else if(l==="get"){const[h,m,p]=u;s("get",h,m,p)}else if(l==="set"){const[h]=u;s("set",h)}else s(l,...u)}catch(h){Vs.error(h)}}return a}function sM(s,e,t,n,a){let l=function(...u){window[n].push(arguments)};return window[a]&&typeof window[a]=="function"&&(l=window[a]),window[a]=nM(l,s,e,t),{gtagCore:l,wrappedGtag:window[a]}}function rM(s){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(N0)&&t.src.includes(s))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aM=30,iM=1e3;class oM{constructor(e={},t=iM){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const O1=new oM;function lM(s){return new Headers({Accept:"application/json","x-goog-api-key":s})}async function cM(s){const{appId:e,apiKey:t}=s,n={method:"GET",headers:lM(t)},a=Q5.replace("{app-id}",e),l=await fetch(a,n);if(l.status!==200&&l.status!==304){let u="";try{const h=await l.json();h.error?.message&&(u=h.error.message)}catch{}throw Js.create("config-fetch-failed",{httpStatus:l.status,responseMessage:u})}return l.json()}async function uM(s,e=O1,t){const{appId:n,apiKey:a,measurementId:l}=s.options;if(!n)throw Js.create("no-app-id");if(!a){if(l)return{measurementId:l,appId:n};throw Js.create("no-api-key")}const u=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new fM;return setTimeout(async()=>{h.abort()},K5),V1({appId:n,apiKey:a,measurementId:l},u,h,e)}async function V1(s,{throttleEndTimeMillis:e,backoffCount:t},n,a=O1){const{appId:l,measurementId:u}=s;try{await dM(n,e)}catch(h){if(u)return Vs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:l,measurementId:u};throw h}try{const h=await cM(s);return a.deleteThrottleMetadata(l),h}catch(h){const m=h;if(!hM(m)){if(a.deleteThrottleMetadata(l),u)return Vs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${m?.message}]`),{appId:l,measurementId:u};throw h}const p=Number(m?.customData?.httpStatus)===503?Q_(t,a.intervalMillis,aM):Q_(t,a.intervalMillis),x={throttleEndTimeMillis:Date.now()+p,backoffCount:t+1};return a.setThrottleMetadata(l,x),Vs.debug(`Calling attemptFetch again in ${p} millis`),V1(s,x,n,a)}}function dM(s,e){return new Promise((t,n)=>{const a=Math.max(e-Date.now(),0),l=setTimeout(t,a);s.addEventListener(()=>{clearTimeout(l),n(Js.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function hM(s){if(!(s instanceof Nr)||!s.customData)return!1;const e=Number(s.customData.httpStatus);return e===429||e===500||e===503||e===504}class fM{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function mM(s,e,t,n,a){if(a&&a.global){s("event",t,n);return}else{const l=await e,u={...n,send_to:l};s("event",t,u)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gM(){if(Zx())try{await AE()}catch(s){return Vs.warn(Js.create("indexeddb-unavailable",{errorInfo:s?.toString()}).message),!1}else return Vs.warn(Js.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function pM(s,e,t,n,a,l,u){const h=uM(s);h.then(b=>{t[b.measurementId]=b.appId,s.options.measurementId&&b.measurementId!==s.options.measurementId&&Vs.warn(`The measurement ID in the local Firebase config (${s.options.measurementId}) does not match the measurement ID fetched from the server (${b.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(b=>Vs.error(b)),e.push(h);const m=gM().then(b=>{if(b)return n.getId()}),[p,x]=await Promise.all([h,m]);rM(l)||J5(l,p.measurementId),a("js",new Date);const w=u?.config??{};return w[$5]="firebase",w.update=!0,x!=null&&(w[G5]=x),a("config",p.measurementId,w),p.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yM=class{constructor(e){this.app=e}_delete(){return delete Gd[this.app.options.appId],Promise.resolve()}},Gd={},YT=[];const XT={};let tx="dataLayer",xM="gtag",WT,L1,JT=!1;function vM(){const s=[];if(EE()&&s.push("This is a browser extension environment."),HC()||s.push("Cookies are not available."),s.length>0){const e=s.map((n,a)=>`(${a+1}) ${n}`).join(" "),t=Js.create("invalid-analytics-context",{errorInfo:e});Vs.warn(t.message)}}function bM(s,e,t){vM();const n=s.options.appId;if(!n)throw Js.create("no-app-id");if(!s.options.apiKey)if(s.options.measurementId)Vs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${s.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Js.create("no-api-key");if(Gd[n]!=null)throw Js.create("already-exists",{id:n});if(!JT){Z5(tx);const{wrappedGtag:l,gtagCore:u}=sM(Gd,YT,XT,tx,xM);L1=l,WT=u,JT=!0}return Gd[n]=pM(s,YT,XT,e,WT,tx,t),new yM(s)}function wM(s=eg()){s=yt(s);const e=ya(s,Ym);return e.isInitialized()?e.getImmediate():_M(s)}function _M(s,e={}){const t=ya(s,Ym);if(t.isInitialized()){const a=t.getImmediate();if(br(e,t.getOptions()))return a;throw Js.create("already-initialized")}return t.initialize({options:e})}function oa(s,e,t,n){s=yt(s),mM(L1,Gd[s.app.options.appId],e,t,n).catch(a=>Vs.error(a))}const ZT="@firebase/analytics",eE="0.10.18";function NM(){qr(new wr(Ym,(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("installations-internal").getImmediate();return bM(n,a,t)},"PUBLIC")),qr(new wr("analytics-internal",s,"PRIVATE")),Ds(ZT,eE),Ds(ZT,eE,"esm2020");function s(e){try{const t=e.getProvider(Ym).getImmediate();return{logEvent:(n,a,l)=>oa(t,n,a,l)}}catch(t){throw Js.create("interop-component-reg-failed",{reason:t})}}}NM();const TM={apiKey:"AIzaSyDQnrbvsx52ikiWELf6hc4YiXQTC1G5tpY",authDomain:"three-sided-flashcard-app.firebaseapp.com",projectId:"three-sided-flashcard-app",storageBucket:"three-sided-flashcard-app.firebasestorage.app",messagingSenderId:"47503676879",appId:"1:47503676879:web:27fb875159cc4459a12eba",measurementId:"G-PBP1G21Q29"},Dg=RE(TM),js=lD(Dg),te=qA(Dg),Ka=g1(Dg),Dn=wM(Dg),la=Object.freeze(Object.defineProperty({__proto__:null,analytics:Dn,auth:js,db:te,functions:Ka},Symbol.toStringTag,{value:"Module"}));class Ys{static sanitizeInput(e,t={}){if(!e||typeof e!="string")return"";const{maxLength:n=1e4,allowHtml:a=!1,allowLatex:l=!0,stripScripts:u=!0,stripUrls:h=!1}=t;let m=e;return m.length>n&&(m=m.substring(0,n)),(!a||u)&&(m=m.replace(/<script[^>]*>.*?<\/script>/gi,""),m=m.replace(/on\w+\s*=\s*["'][^"']*["']/gi,""),m=m.replace(/javascript:/gi,""),a||(m=m.replace(/data:/gi,"")),["script","iframe","object","embed","form","input","textarea","button"].forEach(x=>{const w=new RegExp(`<${x}[^>]*>.*?</${x}>`,"gi");m=m.replace(w,"");const b=new RegExp(`<${x}[^>]*/?>`,"gi");m=m.replace(b,"")})),h&&(m=m.replace(/https?:\/\/[^\s]+/gi,"[URL_REMOVED]")),m.trim()}static validateFlashcardInput(e){const t=[],n={};if(!e.statement||typeof e.statement!="string"?t.push("Statement is required and must be text"):e.statement.length<3?t.push("Statement must be at least 3 characters long"):e.statement.length>5e3?t.push("Statement must be less than 5000 characters"):n.statement=this.sanitizeInput(e.statement,{maxLength:5e3,allowLatex:!0,allowHtml:!1}),e.hints&&typeof e.hints=="string"&&(e.hints.length>5e3?t.push("Hints must be less than 5000 characters"):n.hints=this.sanitizeInput(e.hints,{maxLength:5e3,allowLatex:!0,allowHtml:!1})),e.proof&&typeof e.proof=="string"&&(e.proof.length>1e4?t.push("Proof must be less than 10000 characters"):n.proof=this.sanitizeInput(e.proof,{maxLength:1e4,allowLatex:!0,allowHtml:!1})),e.tags)if(typeof e.tags=="string"){const a=e.tags.split(",").map(l=>l.trim()).filter(l=>l);a.length>20&&t.push("Maximum 20 tags allowed"),n.tags=a.map(l=>this.sanitizeInput(l,{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(l=>l&&/^[a-zA-Z0-9\s\-_]+$/.test(l))}else Array.isArray(e.tags)&&(e.tags.length>20&&t.push("Maximum 20 tags allowed"),n.tags=e.tags.slice(0,20).map(a=>this.sanitizeInput(String(a),{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(a=>a&&/^[a-zA-Z0-9\s\-_]+$/.test(a)));return e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),n.isPublic=!!e.isPublic,{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static validateProfileInput(e){const t=[],n={};return!e.displayName||typeof e.displayName!="string"?t.push("Display name is required"):e.displayName.length<2?t.push("Display name must be at least 2 characters"):e.displayName.length>50?t.push("Display name must be less than 50 characters"):/^[a-zA-Z0-9\s\-_\.]+$/.test(e.displayName)?n.displayName=this.sanitizeInput(e.displayName,{maxLength:50,allowLatex:!1,allowHtml:!1}):t.push("Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods"),e.bio&&typeof e.bio=="string"&&(e.bio.length>500?t.push("Bio must be less than 500 characters"):n.bio=this.sanitizeInput(e.bio,{maxLength:500,allowLatex:!1,allowHtml:!1})),e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static rateLimiter=new Map;static checkRateLimit(e,t=10,n=6e4){const a=Date.now(),u=(this.rateLimiter.get(e)||[]).filter(h=>a-h<n);return u.length>=t?{allowed:!1,retryAfter:n-(a-u[0]),message:`Rate limit exceeded. Try again in ${Math.ceil((n-(a-u[0]))/1e3)} seconds.`}:(u.push(a),this.rateLimiter.set(e,u),{allowed:!0,remaining:t-u.length})}static getPublicErrorMessage(e,t=!0){if(!t)return e.message||"Unknown error";const n={"auth/user-not-found":"Invalid email or password","auth/wrong-password":"Invalid email or password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password should be at least 6 characters","auth/invalid-email":"Please enter a valid email address","auth/user-disabled":"This account has been disabled","auth/too-many-requests":"Too many failed attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","auth/popup-closed-by-user":"Sign-in was cancelled","auth/popup-blocked":"Sign-in popup was blocked. Please disable popup blockers","permission-denied":"You don't have permission to perform this action","not-found":"The requested item was not found","already-exists":"This item already exists","resource-exhausted":"Service temporarily unavailable. Please try again","failed-precondition":"Unable to complete request. Please try again",aborted:"Request was cancelled. Please try again","out-of-range":"Request parameters are invalid",unimplemented:"This feature is not yet available",internal:"Internal error. Please try again",unavailable:"Service temporarily unavailable. Please try again","data-loss":"Data error occurred. Please contact support","functions/invalid-argument":"Invalid request parameters","functions/failed-precondition":"Unable to process request","functions/out-of-range":"Request parameters are out of range","functions/unauthenticated":"Please sign in to continue","functions/permission-denied":"You don't have permission for this action","functions/not-found":"Requested service not found","functions/already-exists":"Resource already exists","functions/resource-exhausted":"Service limit reached. Please try again later","functions/cancelled":"Request was cancelled","functions/unknown":"An unexpected error occurred","functions/deadline-exceeded":"Request timed out. Please try again","validation-error":"Please check your input and try again","rate-limit-exceeded":"Too many requests. Please wait and try again","content-too-long":"Content is too long. Please shorten and try again","invalid-content":"Content contains invalid characters","network-error":"Network error. Please check your connection"},a=e.code||e.name||"unknown";return n[a]||"Something went wrong. Please try again"}static INACTIVITY_TIMEOUT=7200*1e3;static lastActivity=Date.now();static timeoutWarningShown=!1;static updateActivity(){this.lastActivity=Date.now(),this.timeoutWarningShown=!1}static checkInactivity(e,t){const n=Date.now()-this.lastActivity;return n>this.INACTIVITY_TIMEOUT*.83&&!this.timeoutWarningShown&&(this.timeoutWarningShown=!0,e&&e()),n>this.INACTIVITY_TIMEOUT?(t&&t(),!0):!1}static setupActivityTracking(e,t){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(a=>{document.addEventListener(a,this.updateActivity.bind(this),{passive:!0})}),setInterval(()=>{this.checkInactivity(e,t)},6e4)}static detectSuspiciousContent(e){const t=[/<script[\s\S]*?>[\s\S]*?<\/script>/gi,/javascript:/gi,/vbscript:/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/union\s+select/gi,/drop\s+table/gi,/delete\s+from/gi,/data:text\/html/gi,/data:application/gi,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g],n=[];return t.forEach((a,l)=>{const u=e.match(a);u&&n.push({pattern:l,matches:u.length,content:u[0]})}),{isSuspicious:n.length>0,findings:n}}static generateSecureId(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";const a=new Uint8Array(e);crypto.getRandomValues(a);for(let l=0;l<e;l++)n+=t[a[l]%t.length];return n}static async hashForLogging(e){const n=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(a)).map(u=>u.toString(16).padStart(2,"0")).join("")}}const F1=M.createContext(void 0),tE=s=>{switch(s){case"auth/popup-closed-by-user":return"Sign-in popup was closed.";case"auth/cancelled-popup-request":return"Another sign-in is in progress.";case"auth/popup-blocked":return"Popup blocked by the browser. Try again or disable the blocker.";case"auth/network-request-failed":return"Network error. Check your connection and try again.";case"auth/user-disabled":return"This account has been disabled.";default:return"Sign-in failed. Please try again."}},Sn=()=>{const s=M.useContext(F1);if(!s)throw new Error("useAuth must be used within <AuthProvider>");return s},EM=({children:s,fallback:e=null})=>{const[t,n]=M.useState(null),[a,l]=M.useState(null),[u,h]=M.useState(!0),[m,p]=M.useState(null),[x,w]=M.useState(!1),b=M.useRef(!1);M.useEffect(()=>{Qk(js,rS).catch(B=>{console.warn("Auth persistence failed, falling back to default:",B)})},[]),M.useEffect(()=>{const B=Xk(js,G=>{n(G),b.current||(b.current=!0,h(!1))}),q=tS(js,async G=>{if(G)try{const Q=await G.getIdToken(!1);l(Q)}catch(Q){console.warn("Failed to get ID token:",Q),l(null)}else l(null)});return()=>{B(),q()}},[]);const E=async()=>{if(!js.currentUser)return null;try{const B=await js.currentUser.getIdToken(!0);return l(B),B}catch(B){return console.warn("getFreshIdToken error:",B),null}},k=async()=>{p(null);const B=new Ua;B.setCustomParameters({prompt:"select_account"});try{return(await pR(js,B)).user}catch(q){if(q?.code==="auth/popup-blocked"||q?.code==="auth/popup-closed-by-user"||q?.code==="auth/cancelled-popup-request")try{return await _R(js,B),null}catch(G){throw p(tE(G.code)),G}throw p(tE(q.code)),q}},R=async()=>{p(null);try{await Wk(js)}catch(B){throw p("Error signing out. Please try again."),B}};M.useEffect(()=>{if(t){const B=()=>{w(!0)},q=()=>{alert("Your session has expired due to inactivity. Please sign in again."),R()};Ys.setupActivityTracking(B,q)}},[t]);const U=()=>{w(!1),Ys.updateActivity()},z=M.useMemo(()=>({user:t,idToken:a,loading:u,authError:m,sessionWarning:x,dismissSessionWarning:U,signInWithGoogle:k,logout:R,getFreshIdToken:E}),[t,a,u,m,x]);return i.jsx(F1.Provider,{value:z,children:u?e:s})},SM="modulepreload",jM=function(s){return"/new/"+s},nE={},rn=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let p=function(x){return Promise.all(x.map(w=>Promise.resolve(w).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var u=p;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),m=h?.nonce||h?.getAttribute("nonce");a=p(t.map(x=>{if(x=jM(x),x in nE)return;nE[x]=!0;const w=x.endsWith(".css"),b=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${b}`))return;const E=document.createElement("link");if(E.rel=w?"stylesheet":SM,w||(E.as="script"),E.crossOrigin="",E.href=x,m&&E.setAttribute("nonce",m),document.head.appendChild(E),w)return new Promise((k,R)=>{E.addEventListener("load",k),E.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${x}`)))})}))}function l(h){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=h,window.dispatchEvent(m),!m.defaultPrevented)throw h}return a.then(h=>{for(const m of h||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})};class Rs{static async isSlugTaken(e){try{return(await bt(be(te,"profiles",e))).exists()}catch(t){throw console.error("Error checking slug availability:",t),t}}static slugify(e){if(!e||typeof e!="string")return"";const n=e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").slice(0,30);return n.length>=3?n:""}static async createProfile(e,t,n){try{const{displayName:a,bio:l="",institution:u="",email:h}=n;if(await this.isSlugTaken(t))throw new Error(`Slug '${t}' is already taken`);const m={userId:e,displayName:a,bio:l,institution:u,email:h,createdAt:Me(),updatedAt:Me(),flashcardCount:0,upvotesReceived:0,loginStreak:0,lastLoginDate:Me()};await Os(be(te,"profiles",t),m),await Os(be(te,"userToSlug",e),{slug:t}),console.log(" Profile created successfully:",{userId:e,slug:t})}catch(a){throw console.error(" Error creating profile:",a),a}}static async getProfileBySlug(e){try{const t=await bt(be(te,"profiles",e));return t.exists()?{id:t.id,slug:t.id,...t.data()}:null}catch(t){throw console.error("Error getting profile by slug:",t),t}}static async getProfileByUserId(e){try{const t=await bt(be(te,"userToSlug",e));if(!t.exists())return null;const{slug:n}=t.data();return await this.getProfileBySlug(n)}catch(t){throw console.error("Error getting profile by user ID:",t),t}}static async updateProfile(e,t){try{const n={...t,updatedAt:Me()};await Wt(be(te,"profiles",e),n),console.log(" Profile updated successfully:",e)}catch(n){throw console.error(" Error updating profile:",n),n}}static async searchProfiles(e,t=20){try{const n=e.toLowerCase().trim();if(!n)return[];const a=Fe(Ie(te,"profiles")),l=await Ke(a),u=[];return l.docs.forEach(h=>{const m=h.data(),p=(m.displayName||"").toLowerCase(),x=(m.email||"").toLowerCase();(p.includes(n)||x.includes(n))&&u.push({slug:h.id,userId:m.userId,displayName:m.displayName,email:m.email,institution:m.institution,flashcardCount:m.flashcardCount||0})}),u.slice(0,t)}catch(n){throw console.error("Error searching profiles:",n),n}}static async getUserSlug(e){try{const t=await bt(be(te,"userToSlug",e));return t.exists()?t.data().slug:null}catch(t){return console.error("Error getting user slug:",t),null}}static async hasProfile(e){try{return!!await this.getUserSlug(e)}catch(t){return console.error("Error checking if user has profile:",t),!1}}static async updateUserStats(e,t){try{const n=await this.getUserSlug(e);if(!n)return;await this.updateProfile(n,t)}catch(n){throw console.error("Error updating user stats:",n),n}}}class hs{static async createDeck(e,t){try{const n=await Ws(Ie(te,"decks"),{name:t.name||"Untitled Deck",description:t.description||"",userId:e,isPublic:t.isPublic||!1,isDefault:t.isDefault||!1,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,color:t.color||"#635BFF",icon:t.icon||"",createdAt:Me(),updatedAt:Me(),authorSlug:t.authorSlug||null,slug:t.slug||null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0});return t.isPublic&&t.slug&&t.authorSlug&&await Ws(Ie(te,"publicDecks"),{deckId:n.id,name:t.name,description:t.description,authorSlug:t.authorSlug,slug:t.slug,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,likeCount:0,importCount:0,createdAt:Me()}),n.id}catch(n){throw console.error("Error creating deck:",n),n}}static async getUserDecks(e,t=!0){try{let n=Fe(Ie(te,"decks"),Ye("userId","==",e),an("updatedAt","desc"));return t||(n=Fe(Ie(te,"decks"),Ye("userId","==",e),Ye("isDefault","==",!1),an("updatedAt","desc"))),(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user decks:",n),n}}static async getDeck(e){try{const t=await bt(be(te,"decks",e));if(!t.exists())throw new Error("Deck not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching deck:",t),t}}static async updateDeck(e,t){try{const n={...t,updatedAt:Me()};await Wt(be(te,"decks",e),n);const a=await this.getDeck(e);if(a.isPublic&&a.slug){const l=Fe(Ie(te,"publicDecks"),Ye("deckId","==",e),on(1)),u=await Ke(l);if(!u.empty){const h=u.docs[0];await Wt(be(te,"publicDecks",h.id),{name:t.name||a.name,description:t.description||a.description,subject:t.subject||a.subject,difficulty:t.difficulty||a.difficulty,tags:t.tags||a.tags})}}return!0}catch(n){throw console.error("Error updating deck:",n),n}}static async deleteDeck(e){try{const t=al(te),n=Fe(Ie(te,"deckCards"),Ye("deckId","==",e)),a=await Ke(n);for(const h of a.docs){t.delete(be(te,"deckCards",h.id));const m=h.data().cardId,p=be(te,"cards",m);t.update(p,{deckIds:Gm(e)})}t.delete(be(te,"decks",e));const l=Fe(Ie(te,"publicDecks"),Ye("deckId","==",e)),u=await Ke(l);for(const h of u.docs)t.delete(be(te,"publicDecks",h.id));return await t.commit(),!0}catch(t){throw console.error("Error deleting deck:",t),t}}static async addCardToDeck(e,t,n=null){try{return await Rd(te,async a=>{const l=be(te,"decks",e),u=await a.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data().cardCount||0,m=n!==null?n:h+1,p=be(Ie(te,"deckCards"));a.set(p,{deckId:e,cardId:t,position:m,addedAt:Me(),addedBy:u.data().userId});const x=be(te,"cards",t);return a.update(x,{deckIds:eu(e)}),a.update(l,{cardCount:h+1,updatedAt:Me()}),p.id})}catch(a){throw console.error("Error adding card to deck:",a),a}}static async removeCardFromDeck(e,t){try{return await Rd(te,async n=>{const a=Fe(Ie(te,"deckCards"),Ye("deckId","==",e),Ye("cardId","==",t),on(1)),l=await Ke(a);if(l.empty)throw new Error("Card not found in deck");const u=l.docs[0];n.delete(be(te,"deckCards",u.id));const h=be(te,"cards",t);n.update(h,{deckIds:Gm(e)});const m=be(te,"decks",e),x=(await n.get(m)).data().cardCount||0;return n.update(m,{cardCount:Math.max(0,x-1),updatedAt:Me()}),!0})}catch(n){throw console.error("Error removing card from deck:",n),n}}static async getDeckCards(e,t=100){try{const n=Fe(Ie(te,"deckCards"),Ye("deckId","==",e),an("position","asc"),on(t)),l=(await Ke(n)).docs.map(h=>h.data().cardId);if(l.length===0)return[];const u=[];for(const h of l)try{const m=await bt(be(te,"cards",h));m.exists()&&u.push({id:m.id,...m.data()})}catch(m){console.warn(`Failed to fetch card ${h}:`,m)}return u}catch(n){throw console.error("Error fetching deck cards:",n),n}}static async reorderCardsInDeck(e,t){try{const n=al(te);for(const{cardId:a,position:l}of t){const u=Fe(Ie(te,"deckCards"),Ye("deckId","==",e),Ye("cardId","==",a),on(1)),h=await Ke(u);if(!h.empty){const m=h.docs[0];n.update(be(te,"deckCards",m.id),{position:l})}}return await n.commit(),!0}catch(n){throw console.error("Error reordering deck cards:",n),n}}static async createDefaultDeck(e){try{const t={name:"My Flashcards",description:"Your complete collection - contains all your flashcards",isDefault:!0,isPublic:!1,subject:"",difficulty:"mixed",tags:[],color:"#635BFF",icon:""};return{id:await this.createDeck(e,t),...t}}catch(t){throw console.error("Error creating default deck:",t),t}}static async getOrCreateDefaultDeck(e){try{const t=Fe(Ie(te,"decks"),Ye("userId","==",e),Ye("isDefault","==",!0),on(1)),n=await Ke(t);if(!n.empty){const a=n.docs[0];return{id:a.id,...a.data()}}return await this.createDefaultDeck(e)}catch(t){throw console.error("Error getting or creating default deck:",t),t}}static async migrateCardsToDefaultDeck(e){try{console.log(` Starting deck migration for user: ${e}`);const t=await this.getOrCreateDefaultDeck(e);console.log(` Default deck: ${t.name} (${t.id})`);const[n,a]=await Promise.all([this.getUserCardsFromCollection("cards",e),this.getUserCardsFromCollection("flashcards",e)]),l=[...n,...a];if(console.log(` Found ${l.length} cards to migrate`),l.length===0)return console.log(" No cards to migrate"),{migratedCount:0,defaultDeck:t};let u=0;const h=al(te);for(const m of l)try{const p=be(Ie(te,"deckCards"));h.set(p,{deckId:t.id,cardId:m.id,position:u+1,addedAt:Me(),addedBy:e});const x=be(te,m.collection,m.id),w=m.deckIds||[],b=w.includes(t.id)?w:[...w,t.id];h.update(x,{deckIds:b,defaultDeckId:t.id}),u++}catch(p){console.warn(`Failed to migrate card ${m.id}:`,p)}if(u>0){const m=be(te,"decks",t.id);h.update(m,{cardCount:u,updatedAt:Me()}),await h.commit()}return console.log(` Migration complete: ${u} cards migrated`),{migratedCount:u,defaultDeck:t}}catch(t){throw console.error("Error migrating cards to default deck:",t),t}}static async getUserCardsFromCollection(e,t){try{const n=Fe(Ie(te,e),Ye("userId","==",t),an("createdAt","desc"));return(await Ke(n)).docs.map(l=>({id:l.id,collection:e,...l.data()}))}catch(n){return console.error(`Error fetching cards from ${e}:`,n),[]}}static async makeDeckPublic(e,t,n){try{return await Rd(te,async a=>{const l=be(te,"decks",e),u=await a.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data();a.update(l,{isPublic:!0,authorSlug:t,slug:n,updatedAt:Me()});const m=be(Ie(te,"publicDecks"));return a.set(m,{deckId:e,name:h.name,description:h.description,authorSlug:t,slug:n,subject:h.subject||"",difficulty:h.difficulty||"beginner",tags:h.tags||[],cardCount:h.cardCount||0,likeCount:0,importCount:0,createdAt:h.createdAt}),!0})}catch(a){throw console.error("Error making deck public:",a),a}}static async getPublicDecks(e={},t=50){try{let n=Fe(Ie(te,"publicDecks"));return e.subject&&(n=Fe(n,Ye("subject","==",e.subject))),e.difficulty&&(n=Fe(n,Ye("difficulty","==",e.difficulty))),e.tag&&(n=Fe(n,Ye("tags","array-contains",e.tag))),e.sortBy==="popular"?n=Fe(n,an("likeCount","desc"),an("createdAt","desc")):e.sortBy==="imported"?n=Fe(n,an("importCount","desc"),an("createdAt","desc")):n=Fe(n,an("createdAt","desc")),n=Fe(n,on(t)),(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching public decks:",n),n}}static async importPublicDeck(e,t){try{return await Rd(te,async n=>{const a=be(te,"decks",e),l=await n.get(a);if(!l.exists())throw new Error("Source deck not found");const u=l.data(),h=be(Ie(te,"decks"));n.set(h,{...u,userId:t,isPublic:!1,isDefault:!1,name:`${u.name} (Imported)`,authorSlug:null,slug:null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0,createdAt:Me(),updatedAt:Me()});const m=Fe(Ie(te,"deckCards"),Ye("deckId","==",e)),p=await Ke(m);for(const b of p.docs){const E=b.data(),k=be(te,"cards",E.cardId),R=await n.get(k);if(R.exists()){const U=R.data(),z=be(Ie(te,"cards"));n.set(z,{...U,userId:t,isPublic:!1,deckIds:[h.id],defaultDeckId:h.id,createdAt:Me(),originalCardId:E.cardId});const B=be(Ie(te,"deckCards"));n.set(B,{deckId:h.id,cardId:z.id,position:E.position,addedAt:Me(),addedBy:t})}}const x=Fe(Ie(te,"publicDecks"),Ye("deckId","==",e),on(1)),w=await Ke(x);if(!w.empty){const b=w.docs[0];n.update(be(te,"publicDecks",b.id),{importCount:(b.data().importCount||0)+1})}return h.id})}catch(n){throw console.error("Error importing public deck:",n),n}}static async updateDeckStats(e,t){try{const n=be(te,"decks",e);return await Wt(n,{...t,lastStudied:Me(),updatedAt:Me()}),!0}catch(n){throw console.error("Error updating deck stats:",n),n}}static async getDeckAnalytics(e){try{const t=await this.getDeck(e),n=await this.getDeckCards(e);return{cardCount:n.length,studyStreak:t.studyStreak||0,averageScore:t.averageScore||0,lastStudied:t.lastStudied,createdAt:t.createdAt,subjects:[...new Set(n.map(a=>a.subject).filter(Boolean))],tags:[...new Set(n.flatMap(a=>a.tags||[]))]}}catch(t){throw console.error("Error getting deck analytics:",t),t}}static async generateUniqueSlug(e,t){try{const n=`${e.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,30)}-${t}`;let a=n,l=0;for(;l<5;){const u=Fe(Ie(te,"publicDecks"),Ye("slug","==",a),on(1));if((await Ke(u)).empty)return a;a=`${n}-${Math.floor(Math.random()*1e4)}`,l++}throw new Error("Failed to generate unique slug")}catch(n){throw console.error("Error generating unique slug:",n),n}}}class AM{constructor(){this.cache=new Map,this.lastCleanup=Date.now(),this.cleanupInterval=300*1e3,this.cacheDurations={userProfile:600*1e3,userFlashcards:120*1e3,publicCards:300*1e3,userUpvotes:60*1e3,userImports:60*1e3,leaderboard:300*1e3,communityStats:600*1e3,userDecks:180*1e3,deckCards:120*1e3,tags:900*1e3},this.startAutoCleanup()}get(e){this.maybeCleanup();const t=this.cache.get(e);if(!t)return null;const n=Date.now();return n-t.timestamp>t.duration?(this.cache.delete(e),null):(t.lastAccessed=n,console.log(` Cache HIT for: ${e}`),t.data)}set(e,t,n="default"){const a=this.cacheDurations[n]||3e5,l=Date.now();this.cache.set(e,{data:t,timestamp:l,lastAccessed:l,duration:a,type:n}),console.log(` Cache SET for: ${e} (${n}, ${a/1e3}s TTL)`)}invalidate(e){if(typeof e=="string"){this.cache.delete(e),console.log(` Cache INVALIDATED: ${e}`);return}const t=[];for(const[n]of this.cache)e.test(n)&&t.push(n);t.forEach(n=>{this.cache.delete(n),console.log(` Cache INVALIDATED: ${n}`)})}invalidateUser(e){this.invalidate(new RegExp(`^user_${e}_`))}invalidatePublic(){this.invalidate(new RegExp("^public_"))}getStats(){const e=Date.now();let t=0,n=0,a=0;for(const[l,u]of this.cache)e-u.timestamp>u.duration?n++:t++,a+=JSON.stringify(u.data).length;return{totalEntries:this.cache.size,validEntries:t,expiredEntries:n,totalSizeKB:Math.round(a/1024),hitRate:this.hitCount/(this.hitCount+this.missCount)||0}}clear(){this.cache.clear(),console.log(" Cache CLEARED")}startAutoCleanup(){setInterval(()=>{this.cleanup()},this.cleanupInterval)}cleanup(){const e=Date.now(),t=[];for(const[n,a]of this.cache)e-a.timestamp>a.duration&&t.push(n);t.forEach(n=>this.cache.delete(n)),t.length>0&&console.log(` Cache cleanup: removed ${t.length} expired entries`),this.lastCleanup=e}maybeCleanup(){Date.now()-this.lastCleanup>this.cleanupInterval&&this.cleanup()}userKey(e,t,n=""){return`user_${e}_${t}${n?"_"+n:""}`}publicKey(e,t=""){return`public_${e}${t?"_"+t:""}`}async getOrFetch(e,t,n="default"){const a=this.get(e);if(a!==null)return a;console.log(` Cache MISS for: ${e} - fetching fresh data`);try{const l=await t();return this.set(e,l,n),l}catch(l){throw console.error(` Failed to fetch data for cache key: ${e}`,l),l}}}const rs=new AM,{get:dV,set:hV,invalidate:fV,invalidateUser:mV,invalidatePublic:gV,clear:pV,getStats:yV,userKey:xV,publicKey:vV,getOrFetch:bV}=rs;class ym{static async getUserProfile(e){const t=rs.userKey(e,"profile");return rs.getOrFetch(t,async()=>{try{return await Rs.getProfileByUserId(e)}catch(n){throw console.error("Error fetching user profile:",n),n}},"userProfile")}static async createUserProfile(e,t){try{const n=be(te,"users",e);return await Os(n,{...t,createdAt:Me(),updatedAt:Me(),isPremium:!1,flashcardCount:0,upvotes:0,streak:0}),e}catch(n){throw console.error("Error creating user profile:",n),n}}static async updateUserProfile(e,t){try{const n=be(te,"users",e);await Wt(n,{...t,updatedAt:Me()})}catch(n){throw console.error("Error updating user profile:",n),n}}static async getUserStats(e){try{const t=await this.getUserProfile(e);if(!t)return null;const n=[Fe(Ie(te,"cards"),Ye("userId","==",e)),Fe(Ie(te,"flashcards"),Ye("userId","==",e)),Fe(Ie(te,"publicCards"),Ye("userId","==",e))],[a,l,u]=await Promise.all(n.map(p=>Ke(p))),h=a.size+l.size+u.size,m=[];return h>0&&m.push("first_card"),h>=10&&m.push("ten_cards"),h>=100&&m.push("hundred_cards"),t.upvotesReceived>50&&m.push("popular_creator"),{...t,flashcardCount:h,achievements:m,studySessions:Math.floor(Math.random()*20)+1,followers:Math.floor(Math.random()*100),rating:(Math.random()*2+3).toFixed(1)}}catch(t){throw console.error("Error fetching user stats:",t),t}}static async checkOnboardingStatus(e){try{const t=await this.getUserProfile(e);if(!t)return{hasProfile:!1,hasCards:!1};const n=Fe(Ie(te,"flashcards"),Ye("authorId","==",e),on(1));return{hasProfile:!0,hasCards:!(await Ke(n)).empty,profile:t}}catch(t){throw console.error("Error checking onboarding status:",t),t}}static async getTopUsers(e=20,t="allTime"){try{const n=Fe(Ie(te,"users"),an("flashcardCount","desc"),an("upvotes","desc"),on(e));return(await Ke(n)).docs.map(l=>({uid:l.id,...l.data()}))}catch(n){return console.error("Error fetching top users:",n),[]}}static async getStudyHistory(e){try{const{AnalyticsService:t}=await rn(async()=>{const{AnalyticsService:l}=await Promise.resolve().then(()=>QM);return{AnalyticsService:l}},void 0),a=(await t.getRecentSessions(e,"month")).map(l=>({date:(l.startTime?.toDate?l.startTime.toDate():new Date(l.startTime)).toISOString().split("T")[0],duration:l.duration||0,cardsStudied:l.cardsStudied||0,accuracy:Math.round((l.accuracy||0)*100)}));return a.sort((l,u)=>new Date(u.date)-new Date(l.date)),a}catch(t){return console.error("Error fetching study history:",t),[]}}static async needsDeckMigration(e){try{if((await hs.getUserDecks(e)).length>0)return!1;const n=Fe(Ie(te,"cards"),Ye("userId","==",e),on(1)),a=await Ke(n),l=Fe(Ie(te,"flashcards"),Ye("userId","==",e),on(1)),u=await Ke(l);return!a.empty||!u.empty}catch(t){return console.error("Error checking deck migration status:",t),!1}}static async migrateUserToDecks(e){try{if(console.log(` Starting deck migration for user: ${e}`),!await this.needsDeckMigration(e))return console.log(" User already migrated or has no cards"),{success:!0,message:"No migration needed"};const n=await hs.migrateCardsToDefaultDeck(e),a=be(te,"users",e);return await Os(a,{deckMigrationCompleted:!0,deckMigrationDate:Me(),updatedAt:Me()},{merge:!0}),console.log(` Deck migration completed for user: ${e}`),console.log(" Migration stats:",n),{success:!0,message:`Successfully migrated ${n.migratedCount} cards`,migrationResult:n}}catch(t){console.error("Error migrating user to decks:",t);try{const n=be(te,"users",e);await Os(n,{deckMigrationFailed:!0,deckMigrationError:t.message,deckMigrationAttemptDate:Me(),updatedAt:Me()},{merge:!0})}catch(n){console.error("Failed to log migration error:",n)}return{success:!1,message:`Migration failed: ${t.message}`,error:t}}}static async autoMigrateUserDecks(e){try{const t=await bt(be(te,"users",e)),n=t.exists()?t.data():{};if(n.deckMigrationCompleted)return{success:!0,message:"Already migrated"};if(n.deckMigrationFailed&&n.deckMigrationAttemptDate){const a=n.deckMigrationAttemptDate.toMillis();if((Date.now()-a)/(1e3*60*60)<24)return{success:!1,message:"Migration failed recently, will retry later"}}return await this.migrateUserToDecks(e)}catch(t){return console.error("Error in auto-migration:",t),{success:!1,message:"Auto-migration failed",error:t}}}}class is{static async getUserFlashcards(e,t=50){const n=rs.userKey(e,"flashcards",`limit_${t}`);return rs.getOrFetch(n,async()=>{try{const a=Fe(Ie(te,"cards"),Ye("userId","==",e),an("createdAt","desc"),on(t));return(await Ke(a)).docs.map(u=>({id:u.id,...u.data()}))}catch(a){throw console.error("Error fetching user flashcards:",a),a}},"userFlashcards")}static async getPublicFlashcards(e=50){const t=rs.publicKey("cards",`limit_${e}`);return rs.getOrFetch(t,async()=>{try{const n=Fe(Ie(te,"publicCards"),an("createdAt","desc"),on(e));return(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching public flashcards:",n),n}},"publicCards")}static async getPublicFlashcardsByUser(e,t=50){try{const n=Fe(Ie(te,"publicCards"),Ye("userId","==",e),an("createdAt","desc"),on(t));return(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user public flashcards:",n),n}}static async createFlashcard(e,t,n=null){try{if(console.log(" Creating flashcard for user:",t,"with data:",e),!t||typeof t!="string")throw new Error("Valid user ID is required to create flashcard");const a=await hs.getOrCreateDefaultDeck(t);console.log(" Default deck obtained:",a.id);const l=n||a.id,u=n&&n!==a.id?[a.id,l]:[a.id],h={statement:e.statement||e.question||"",hints:e.hints||e.answer||"",proof:e.proof||"",tags:Array.isArray(e.tags)?e.tags:typeof e.tags=="string"?e.tags.split(",").map(p=>p.trim()).filter(p=>p):[],subject:e.subject||"",userId:t,createdAt:Me(),isPublic:e.isPublic||!1,defaultDeckId:a.id,deckIds:u};console.log(" Creating card document:",h);const m=await Ws(Ie(te,"cards"),h);if(e.isPublic){let p=null;const x=await bt(be(te,"userToSlug",t));if(x.exists())p=x.data().slug;else{const E=await bt(be(te,"users",t));if(E.exists()&&E.data().username)p=E.data().username;else throw new Error("You must create a profile before posting public cards. Please create your profile first.")}const w=(e.question||e.statement).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,50),b=await this.ensureUniqueCardSlug(w);await Os(be(te,"publicCards",b),{statement:e.question||e.statement,hints:e.hints||e.answer,proof:e.proof||e.answer,tags:e.tags||[],userId:t,authorSlug:p,slug:b,id:b,createdAt:Me(),likeCount:0,viewCount:0,importCount:0})}for(const p of u)await hs.addCardToDeck(p,m.id);return rs.invalidateUser(t),e.isPublic&&rs.invalidatePublic(),m.id}catch(a){throw console.error("Error creating flashcard:",a),a}}static async updateCardDeck(e,t){try{const n=be(te,"cards",e),a=await bt(n);if(!a.exists())throw new Error("Card not found");const u=a.data().deckIds||[];if(!u.includes(t)){const h=[...u,t];await Wt(n,{deckIds:h})}return!0}catch(n){throw console.error("Error updating card deck:",n),n}}static async ensureUniqueCardSlug(e){let t=e,n=0;for(;n<5;){const a=be(te,"publicCards",t);if(!(await bt(a)).exists())return t;t=e+"-"+Math.floor(Math.random()*1e4),n++}throw new Error("Failed to generate unique card slug after multiple attempts.")}static async updateFlashcard(e,t){try{const n=be(te,"cards",e);await Wt(n,{...t,updatedAt:Me()})}catch(n){throw console.error("Error updating flashcard:",n),n}}static async deleteFlashcard(e){try{const t=be(te,"cards",e);await rl(t)}catch(t){throw console.error("Error deleting flashcard:",t),t}}static async searchFlashcards(e,t={},n=20){try{const a=[Ye("isPublic","==",!0)];t.subject&&a.push(Ye("subject","==",t.subject));let l="createdAt",u="desc";t.sortBy==="oldest"?(l="createdAt",u="asc"):t.sortBy==="popular"&&(l="upvotes",u="desc");const h=Fe(Ie(te,"flashcards"),...a,an(l,u),on(n*3));let p=(await Ke(h)).docs.map(x=>({id:x.id,...x.data()}));if(e&&e.trim()){const x=e.toLowerCase();p=p.filter(w=>w.question?.toLowerCase().includes(x)||w.answer?.toLowerCase().includes(x)||Array.isArray(w.hints)&&w.hints.some(b=>b.toLowerCase().includes(x))||Array.isArray(w.tags)&&w.tags.some(b=>b.toLowerCase().includes(x)))}return p.slice(0,n)}catch(a){return console.error("Error searching flashcards:",a),await this.getPublicFlashcards(n)}}static async getSubjects(){try{const e=await this.getPublicFlashcards(1e3),t=new Set;return e.forEach(n=>{n.subject&&t.add(n.subject)}),Array.from(t).sort()}catch(e){return console.error("Error fetching subjects:",e),["Mathematics","Physics","Chemistry","Biology","Computer Science"]}}static async getPopularTags(e=20){try{const t=await this.getPublicFlashcards(1e3),n={};return t.forEach(a=>{a.tags&&a.tags.forEach(l=>{n[l]=(n[l]||0)+1})}),Object.entries(n).sort(([,a],[,l])=>l-a).slice(0,e).map(([a])=>a)}catch(t){return console.error("Error fetching popular tags:",t),["calculus","algebra","geometry","trigonometry","statistics"]}}static async getUserFavorites(e){try{return(await this.getPublicFlashcards(20)).slice(0,10)}catch(t){return console.error("Error fetching user favorites:",t),[]}}static async removeFromFavorites(e,t){try{return!0}catch(n){throw console.error("Error removing from favorites:",n),n}}static async getDeckFlashcards(e,t=100){try{return await hs.getDeckCards(e,t)}catch(n){throw console.error("Error fetching deck flashcards:",n),n}}static async moveCardToDeck(e,t,n){try{return t&&await hs.removeCardFromDeck(t,e),await hs.addCardToDeck(n,e),await Wt(be(te,"cards",e),{defaultDeckId:n,deckIds:eu(n)}),t&&await Wt(be(te,"cards",e),{deckIds:Gm(t)}),!0}catch(a){throw console.error("Error moving card to deck:",a),a}}static async getUserFlashcardsByDeck(e){try{const t=await hs.getUserDecks(e),n={};for(const a of t)n[a.id]={deck:a,cards:await this.getDeckFlashcards(a.id)};return n}catch(t){throw console.error("Error fetching user flashcards by deck:",t),t}}static async createFlashcardInDeck(e,t,n){try{return await this.createFlashcard(e,t,n)}catch(a){throw console.error("Error creating flashcard in deck:",a),a}}static async getFlashcardsFromDecks(e,t=200){try{const n=[];for(const l of e){const u=await this.getDeckFlashcards(l,t);n.push(...u)}return n.reduce((l,u)=>(l.find(h=>h.id===u.id)||l.push(u),l),[]).sort((l,u)=>{const h=l.createdAt?.toMillis?.()||l.createdAt?.getTime?.()||0;return(u.createdAt?.toMillis?.()||u.createdAt?.getTime?.()||0)-h})}catch(n){throw console.error("Error fetching flashcards from multiple decks:",n),n}}static async getPublicFlashcard(e){try{const t=await bt(be(te,"publicCards",e));if(!t.exists())throw new Error("Public flashcard not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching public flashcard:",t),t}}static async updatePublicFlashcard(e,t,n){try{const a=await bt(be(te,"publicCards",e));if(!a.exists())throw new Error("Public flashcard not found");if(a.data().userId!==n)throw new Error("You can only edit your own public flashcards");const u=be(te,"publicCards",e);return await Wt(u,{...t,updatedAt:Me()}),{success:!0}}catch(a){throw console.error("Error updating public flashcard:",a),a}}static async deletePublicFlashcard(e,t){try{const n=await bt(be(te,"publicCards",e));if(!n.exists())throw new Error("Public flashcard not found");if(n.data().userId!==t)throw new Error("You can only delete your own public flashcards");return await rl(be(te,"publicCards",e)),{success:!0}}catch(n){throw console.error("Error deleting public flashcard:",n),n}}static async toggleFlashcardPublic(e,t,n=!0){try{return n?await this.makeFlashcardPublic(e,t):await this.makeFlashcardPrivate(e,t),{success:!0}}catch(a){throw console.error("Error toggling flashcard public status:",a),a}}static async makeFlashcardPublic(e,t){try{const n=await this.getFlashcard(e,t),a=await bt(be(te,"userToSlug",t));if(!a.exists())throw new Error("You must create a profile before making cards public");const l=a.data().slug,u=this.generateSlugFromStatement(n.statement),h=await this.ensureUniqueSlug(u),m={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,authorSlug:l,slug:h,createdAt:n.createdAt||Me(),updatedAt:Me(),likeCount:0,viewCount:0,importCount:0};return await Os(be(te,"publicCards",h),m),await Wt(be(te,"cards",e),{isPublic:!0,publicSlug:h,updatedAt:Me()}),{success:!0,publicSlug:h,publicUrl:`/card/${h}`}}catch(n){throw console.error("Error making flashcard public:",n),n}}static async makeFlashcardPrivate(e,t){try{const n=await bt(be(te,"cards",e));if(!n.exists())throw new Error("Private flashcard not found");const a=n.data();if(a.userId!==t)throw new Error("You can only modify your own flashcards");return a.publicSlug&&await rl(be(te,"publicCards",a.publicSlug)),await Wt(be(te,"cards",e),{isPublic:!1,publicSlug:null,updatedAt:Me()}),{success:!0}}catch(n){throw console.error("Error making flashcard private:",n),n}}static async importPublicFlashcard(e,t){try{const n=await this.getPublicFlashcard(e),a={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,createdAt:Me(),isPublic:!1,originalCardId:e,originalAuthor:n.userId,importedAt:Me()},l=await Ws(Ie(te,"cards"),a);return await Wt(be(te,"publicCards",e),{importCount:increment(1)}),{success:!0,cardId:l.id}}catch(n){throw console.error("Error importing public flashcard:",n),n}}static generateSlugFromStatement(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().replace(/\s+/g,"-").slice(0,50)}static async ensureUniqueSlug(e){let t=e,n=0;const a=10;for(;n<a;){if(!(await bt(be(te,"publicCards",t))).exists())return t;n++,t=`${e}-${Math.floor(Math.random()*1e4)}`}throw new Error("Failed to generate unique slug after multiple attempts")}}class xm{static async autoFillFromStatement(e){try{const t=await js.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/deepseekAutofill",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}const a=await n.json();return{hints:a.hints||"",proof:a.proof||"",tags:a.tags||[]}}catch(t){throw console.error("Error with AI autofill:",t),t}}static async autoTagOnly(e){try{const t=await js.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/autoTagOnly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).tags||[]}catch(t){throw console.error("Error with AI auto-tagging:",t),t}}static async convertToLaTeX(e){try{const t=await js.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/convertToLatex",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({input:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).latex||e}catch(t){throw console.error("Error converting to LaTeX:",t),t}}}const CM=({value:s,onChange:e,className:t="",placeholder:n="Type tags here or click existing tags below"})=>{const{user:a}=Sn(),[l,u]=M.useState([]),[h,m]=M.useState(!0),[p,x]=M.useState(!1),[w,b]=M.useState([]),E=M.useRef(null);M.useEffect(()=>{const Q=s?s.split(",").map(L=>L.trim()).filter(L=>L):[];b(Q)},[s]);const k=()=>{if(!s)return l;const Q=s.split(",").map(P=>P.trim()),L=Q[Q.length-1].toLowerCase();return L?l.filter(P=>P.toLowerCase().includes(L)&&!w.includes(P)).sort((P,T)=>{const A=P.toLowerCase().startsWith(L),F=T.toLowerCase().startsWith(L);return A&&!F?-1:!A&&F?1:P.localeCompare(T)}):l};M.useEffect(()=>{R()},[a]);const R=async()=>{if(!a?.uid){m(!1);return}try{m(!0);const Q=await is.getUserFlashcards(a.uid,200),{collection:L,query:P,where:T,getDocs:A}=await rn(async()=>{const{collection:ie,query:$,where:ge,getDocs:I}=await Promise.resolve().then(()=>Mr);return{collection:ie,query:$,where:ge,getDocs:I}},void 0),{db:F}=await rn(async()=>{const{db:ie}=await Promise.resolve().then(()=>la);return{db:ie}},void 0),S=P(L(F,"flashcards"),T("userId","==",a.uid)),D=(await A(S)).docs.map(ie=>ie.data()),ke=[...Q,...D],ne=new Set;ke.forEach(ie=>{ie.tags&&Array.isArray(ie.tags)?ie.tags.forEach($=>{$&&typeof $=="string"&&ne.add($.trim())}):typeof ie.tags=="string"&&ie.tags.split(",").forEach($=>{const ge=$.trim();ge&&ne.add(ge)})});const O=Array.from(ne).sort();u(O)}catch(Q){console.error("Error loading existing tags:",Q),u([])}finally{m(!1)}},U=Q=>{const L=w.slice();if(L.includes(Q))return;const P=[...L,Q],T=P.join(", ");b(P),e(T)},z=Q=>{const L=w.filter(T=>T!==Q),P=L.join(", ");b(L),e(P)},B=Q=>{e(Q.target.value)},q=Q=>{if(Q.key==="Tab"){const L=k();L.length>0&&(Q.preventDefault(),U(L[0]))}},G=()=>{x(!p)};return i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"mb-3",children:i.jsx("textarea",{ref:E,value:s,onChange:B,onKeyDown:q,placeholder:n,className:`claude-input w-full resize-none ${t}`,rows:"2"})}),w.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Selected tags:"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((Q,L)=>i.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:["#",Q,i.jsx("button",{onClick:()=>z(Q),className:"ml-1 hover:bg-white/20 rounded-full w-4 h-4 flex items-center justify-center text-xs",title:"Remove tag",children:""})]},L))})]}),i.jsxs("div",{className:"existing-tags-section",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"text-sm claude-text-secondary",children:s?`Filtered tags (${k().length}):`:"Click to add existing tags:"}),l.length>6&&i.jsxs("button",{onClick:G,className:"text-sm px-2 py-1 rounded",style:{color:"var(--claude-accent)",backgroundColor:"var(--claude-accent-bg)"},children:["View All (",l.length,")"]})]}),i.jsx("div",{className:"existing-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",maxHeight:"120px",overflowY:"auto",padding:"0.75rem",backgroundColor:"var(--claude-surface)",border:"1px solid var(--claude-border)",borderRadius:"8px"},children:h?i.jsx("div",{className:"claude-text-muted italic",children:"Loading existing tags..."}):l.length===0?i.jsx("div",{className:"claude-text-muted italic",children:"No existing tags found. Create your first card to see tags here!"}):k().length===0&&s?i.jsxs("div",{className:"claude-text-muted italic",children:['No tags match your search. Press Enter to add "',s.split(",").pop()?.trim(),'" as a new tag.']}):k().slice(0,p?k().length:12).map(Q=>{const L=w.includes(Q);return i.jsxs("button",{onClick:()=>U(Q),className:`tag-btn transition-all duration-200 ${L?"selected":""}`,style:{backgroundColor:L?"var(--claude-accent)":"var(--claude-subtle)",color:L?"white":"var(--claude-primary-text)",border:"none",padding:"0.25rem 0.75rem",borderRadius:"20px",fontSize:"0.85rem",cursor:"pointer",whiteSpace:"nowrap",opacity:L?.7:1},onMouseEnter:P=>{L||(P.target.style.backgroundColor="var(--claude-border)",P.target.style.color="var(--claude-heading)")},onMouseLeave:P=>{L||(P.target.style.backgroundColor="var(--claude-subtle)",P.target.style.color="var(--claude-primary-text)")},title:L?"Already selected":`Add "${Q}" tag`,children:["#",Q]},Q)})})]}),p&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"claude-card max-w-2xl w-full mx-4 p-6 max-h-[80vh] overflow-hidden",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Select Tags"}),i.jsx("button",{onClick:()=>x(!1),className:"claude-text-muted hover:claude-text-secondary transition-colors text-2xl",style:{color:"var(--claude-text-muted)"},onMouseEnter:Q=>Q.target.style.color="var(--claude-text-secondary)",onMouseLeave:Q=>Q.target.style.color="var(--claude-text-muted)",children:""})]}),i.jsx("div",{className:"mb-4",children:i.jsx("p",{className:"claude-text-secondary",children:"Click tags to add them to your flashcard:"})}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-96 overflow-y-auto p-2",children:l.map(Q=>{const L=w.includes(Q);return i.jsxs("button",{onClick:()=>{U(Q)},className:`p-3 rounded-lg border text-left transition-all duration-200 ${L?"border-purple-500 bg-purple-500/20":"border-gray-600 hover:border-purple-500 hover:bg-purple-500/10"}`,children:[i.jsxs("div",{className:"font-medium",style:{color:L?"var(--claude-accent)":"var(--claude-primary-text)"},children:["#",Q]}),i.jsx("div",{className:"text-sm claude-text-secondary",children:L?" Selected":"Click to add"})]},Q)})}),i.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:i.jsxs("button",{onClick:()=>x(!1),className:"claude-button-primary flex-1",children:["Done (",w.length," selected)"]})})]})})]})},IM=({value:s,onChange:e,className:t="",placeholder:n="Select or type a subject"})=>{const{user:a}=Sn(),[l,u]=M.useState([]),[h,m]=M.useState(!0),[p,x]=M.useState(!1),[w,b]=M.useState(!1),E=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Statistics","Calculus","Linear Algebra","Differential Equations","Organic Chemistry","Molecular Biology","Machine Learning","Data Science","Literature","World History","European History","American History","Political Science"];M.useEffect(()=>{k()},[a]);const k=async()=>{if(!a?.uid){m(!1);return}try{m(!0);const L=await is.getUserFlashcards(a.uid,200),{collection:P,query:T,where:A,getDocs:F}=await rn(async()=>{const{collection:$,query:ge,where:I,getDocs:W}=await Promise.resolve().then(()=>Mr);return{collection:$,query:ge,where:I,getDocs:W}},void 0),{db:S}=await rn(async()=>{const{db:$}=await Promise.resolve().then(()=>la);return{db:$}},void 0),V=T(P(S,"flashcards"),A("userId","==",a.uid)),ke=(await F(V)).docs.map($=>$.data()),ne=[...L,...ke],O=new Set;ne.forEach($=>{if($.subject&&typeof $.subject=="string"){const ge=$.subject.trim();ge&&ge!=="General"&&O.add(ge)}});const ie=Array.from(O).sort();u(ie)}catch(L){console.error("Error loading existing subjects:",L),u([])}finally{m(!1)}},R=()=>{const L=new Set([...E,...l]),P=s?.toLowerCase()||"";return P?Array.from(L).filter(T=>T.toLowerCase().includes(P)).sort((T,A)=>{const F=T.toLowerCase().startsWith(P),S=A.toLowerCase().startsWith(P);return F&&!S?-1:!F&&S?1:T.localeCompare(A)}):Array.from(L).sort()},U=L=>{e(L),x(!1)},z=L=>{e(L.target.value),x(!0)},B=()=>{b(!0),x(!0)},q=()=>{b(!1),setTimeout(()=>x(!1),150)},G=R(),Q=l.length>0;return i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",value:s||"",onChange:z,onFocus:B,onBlur:q,placeholder:n,className:`claude-input w-full ${t}`}),p&&(w||s)&&i.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:h?i.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading subjects..."}):i.jsxs(i.Fragment,{children:[Q&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-purple-400",children:" Your Subjects"})}),l.filter(L=>!s||L.toLowerCase().includes(s.toLowerCase())).slice(0,5).map(L=>i.jsx("button",{onClick:()=>U(L),className:"w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-purple-400",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:L}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"From your cards"})]})]})},`existing-${L}`))]}),i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-blue-400",children:" Popular Subjects"})}),G.filter(L=>!l.includes(L)).slice(0,8).map(L=>i.jsx("button",{onClick:()=>U(L),className:"w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-blue-400",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:L}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Popular choice"})]})]})},`popular-${L}`)),G.length===0&&s&&i.jsxs("div",{className:"p-4 text-center",children:[i.jsx("div",{className:"claude-text-muted mb-2",children:"No matching subjects found"}),i.jsxs("button",{onClick:()=>U(s),className:"px-4 py-2 rounded text-sm",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:['Create "',s,'"']})]}),s&&!G.some(L=>L.toLowerCase()===s.toLowerCase())&&i.jsx("button",{onClick:()=>U(s),className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-green-500/10 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:['Create "',s,'"']}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"New custom subject"})]})]})})]})}),!w&&!s&&Q&&i.jsxs("div",{className:"mt-3",children:[i.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Recent subjects:"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:l.slice(0,6).map(L=>i.jsx("button",{onClick:()=>U(L),className:"px-3 py-1 rounded-full text-sm font-medium transition-all duration-200",style:{backgroundColor:"#e2e8f0",color:"#4a5568"},onMouseEnter:P=>{P.target.style.backgroundColor="var(--claude-accent)",P.target.style.color="white"},onMouseLeave:P=>{P.target.style.backgroundColor="#e2e8f0",P.target.style.color="#4a5568"},children:L},L))})]})]})},kM=({value:s,onChange:e,className:t="",placeholder:n="Select a deck for this card",rememberSelection:a=!0})=>{const{user:l}=Sn(),[u,h]=M.useState([]),[m,p]=M.useState(!0),[x,w]=M.useState(!1),[b,E]=M.useState(null);M.useEffect(()=>{k(),R()},[l]);const k=async()=>{if(!l?.uid){p(!1);return}try{p(!0);const G=await hs.getUserDecks(l.uid,!0);h(G)}catch(G){console.error("Error loading user decks:",G),h([])}finally{p(!1)}},R=()=>{if(!a||!l?.uid)return;const G=localStorage.getItem(`selectedDeck_${l.uid}`);if(G&&!s){const Q=u.find(L=>L.id===G);Q&&(E(Q),e(G))}};M.useEffect(()=>{if(u.length>0&&!s&&a&&l?.uid){const G=localStorage.getItem(`selectedDeck_${l.uid}`);if(G){const Q=u.find(L=>L.id===G);Q&&(E(Q),e(G))}}},[u,s,a,l?.uid,e]),M.useEffect(()=>{if(s&&u.length>0){const G=u.find(Q=>Q.id===s);E(G||null)}else E(null)},[s,u]);const U=G=>{E(G),e(G.id),w(!1),a&&l?.uid&&localStorage.setItem(`selectedDeck_${l.uid}`,G.id)},z=()=>{E(null),e(""),a&&l?.uid&&localStorage.removeItem(`selectedDeck_${l.uid}`)},B=u.find(G=>G.isDefault),q=u.filter(G=>!G.isDefault);return i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:`relative ${t}`,onClick:()=>w(!x),children:i.jsxs("div",{className:"claude-input w-full cursor-pointer flex items-center justify-between",style:{minHeight:"44px"},children:[b?i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:b.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:b.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[b.cardCount||0," cards  ",b.subject||"General"]})]})]}):i.jsx("span",{className:"claude-text-muted",children:n}),i.jsxs("div",{className:"flex items-center gap-2",children:[b&&i.jsx("button",{onClick:G=>{G.stopPropagation(),z()},className:"transition-colors p-1",style:{color:"var(--claude-text-muted)"},onMouseEnter:G=>G.target.style.color="var(--claude-primary-text)",onMouseLeave:G=>G.target.style.color="var(--claude-text-muted)",title:"Clear selection",children:""}),i.jsx("span",{className:"text-gray-400",children:x?"":""})]})]})}),x&&i.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:m?i.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading decks..."}):u.length===0?i.jsxs("div",{className:"p-4 text-center",children:[i.jsx("div",{className:"claude-text-muted mb-3",children:"No decks found"}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Create a deck first to organize your cards"})]}):i.jsxs(i.Fragment,{children:[B&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-blue-400",children:" Default Collection"})}),i.jsx("button",{onClick:()=>U(B),className:`w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 ${b?.id===B.id?"bg-blue-500/20":""}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:B.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:B.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[B.cardCount||0," cards  All your flashcards"]})]})]})})]}),q.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-purple-400",children:" Your Decks"})}),q.map(G=>i.jsx("button",{onClick:()=>U(G),className:`w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0 ${b?.id===G.id?"bg-purple-500/20":""}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:G.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:G.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[G.cardCount||0," cards  ",G.subject||"General"]})]})]})},G.id))]}),i.jsx("button",{onClick:()=>{z(),w(!1)},className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-gray-500/10 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-gray-400",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"text-gray-300 font-medium",children:"No specific deck"}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Just use default collection"})]})]})})]})}),a&&b&&i.jsxs("div",{className:"mt-2 text-xs claude-text-secondary flex items-center gap-1",children:[i.jsx("span",{children:""}),i.jsx("span",{children:"This deck will be remembered for future cards"})]}),x&&i.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>w(!1)})]})},Nn=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 19H21"}),i.jsx("rect",{x:"5",y:"13",width:"4",height:"6",rx:"2",ry:"2"}),i.jsx("rect",{x:"10",y:"9",width:"4",height:"10",rx:"2",ry:"2"}),i.jsx("rect",{x:"15",y:"5",width:"4",height:"14",rx:"2",ry:"2"})]})})},Xi=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"8",r:"3"}),i.jsx("path",{d:"M4 19c0-3.314 3.134-6 8-6s8 2.686 8 6"})]})})},Qa=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"5",y:"5",width:"12",height:"14",rx:"2",ry:"2"}),i.jsx("rect",{x:"7",y:"3",width:"12",height:"14",rx:"2",ry:"2"}),i.jsx("rect",{x:"3",y:"7",width:"12",height:"14",rx:"2",ry:"2"})]})})},xr=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"}),i.jsx("path",{d:"M14.06 6.19l3.75 3.75 1.41-1.41c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.41 1.41z"})]})})},T0=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M8 6h8"}),i.jsx("path",{d:"M5 8h14"}),i.jsx("rect",{x:"6",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),i.jsx("path",{d:"M10 12v6"}),i.jsx("path",{d:"M14 12v6"})]})})},ca=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"}),i.jsx("circle",{cx:"12",cy:"12",r:"2"})]})})},U1=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"3",r:"1"}),i.jsx("path",{d:"M12 4v2"}),i.jsx("rect",{x:"5",y:"6",width:"14",height:"12",rx:"3",ry:"3"}),i.jsx("circle",{cx:"9",cy:"12",r:"1.25"}),i.jsx("circle",{cx:"15",cy:"12",r:"1.25"}),i.jsx("path",{d:"M9 15h6"})]})})},kc=({size:s=20,color:e="success",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"success-dark":return"#4A9B7F";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#5BC8A2"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M8 12l3 3 5-6"})]})})},Pg=({size:s=20,color:e="error",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"error-dark":return"#E55555";case"default":return"#606164";default:return"#FF6363"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M9 9l6 6M15 9l-6 6"})]})})},B1=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"warning-dark":return"#FFB800";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3l-8.47-14.14a2 2 0 0 0-3.42 0z"}),i.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),i.jsx("circle",{cx:"12",cy:"16",r:"1"})]})})},RM=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"warning-dark":return"#FFB800";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M9 18h6M10 21h4"}),i.jsx("path",{d:"M12 2a7 7 0 0 0-4 12c.67.67 1 1.33 1 2h6c0-.67.33-1.33 1-2a7 7 0 0 0-4-12z"})]})})},DM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"}),i.jsx("line",{x1:"8",y1:"13",x2:"16",y2:"13"}),i.jsx("line",{x1:"8",y1:"17",x2:"16",y2:"17"})]})})},PM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M10 4a3 3 0 0 0-6 2v3a3 3 0 0 0 0 6v3a3 3 0 0 0 6 2"}),i.jsx("path",{d:"M14 4a3 3 0 0 1 6 2v3a3 3 0 0 1 0 6v3a3 3 0 0 1-6 2"}),i.jsx("path",{d:"M12 2v20"})]})})},il=({size:s=24,color:e="success",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":return"#606164";default:return"#5BC8A2"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("circle",{cx:"12",cy:"12",r:"5"}),i.jsx("circle",{cx:"12",cy:"12",r:"1.5"})]})})},MM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M12 7v5"}),i.jsx("path",{d:"M12 12l3 3"})]})})},Ec=({size:s=20,color:e="success",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#5BC8A2"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 3v18h18"}),i.jsx("path",{d:"M19 9l-5 5-4-4-4 5"})]})})},OM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M21 12a9 9 0 1 1-2.64-6.36L21 8"}),i.jsx("path",{d:"M21 3v5h-5"})]})})},q1=({size:s=20,color:e="secondary",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#445AFF"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M20 12l-8-8H4v8l8 8 8-8z"}),i.jsx("circle",{cx:"7.5",cy:"7.5",r:"1.5"})]})})},$d=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 21h18L3 3v18z"}),i.jsx("path",{d:"M7 17h7L7 10v7z"})]})})},VM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"7",y:"3",width:"10",height:"18",rx:"2.5",ry:"2.5"}),i.jsx("line",{x1:"10",y1:"6",x2:"14",y2:"6"})]})})},LM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"4",y:"5",width:"16",height:"10",rx:"2",ry:"2"}),i.jsx("path",{d:"M2 17h20"}),i.jsx("path",{d:"M10 19h4"})]})})},FM=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"6",y:"5",width:"4",height:"14",rx:"1"}),i.jsx("rect",{x:"14",y:"5",width:"4",height:"14",rx:"1"})]})})},nu=({size:s=16,color:e="error",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#FF6363"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:i.jsx("path",{d:"M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-7.6 1-1a5.5 5.5 0 0 0 0-7.8z"})})})},UM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M4 12a8 8 0 0 1 16 0"}),i.jsx("rect",{x:"3",y:"12",width:"3",height:"6",rx:"1.5"}),i.jsx("rect",{x:"18",y:"12",width:"3",height:"6",rx:"1.5"})]})})},Dd=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M5 3h11l5 5v13H5V3z"}),i.jsx("rect",{x:"7",y:"3",width:"7",height:"5"}),i.jsx("rect",{x:"9",y:"13",width:"6",height:"6"})]})})},BM=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 6l6-2 6 2 6-2v14l-6 2-6-2-6 2V6z"}),i.jsx("path",{d:"M9 4v14M15 6v14"}),i.jsx("path",{d:"M16.5 10.5a2.5 2.5 0 1 0 5 0c0-1.38-1.12-2.5-2.5-2.5s-2.5 1.12-2.5 2.5z"}),i.jsx("path",{d:"M19 13.5v0"})]})})},qM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:i.jsx("path",{d:"M6 4l6 14 2-6 6-2L6 4z"})})})},Xm=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"warning-dark":return"#FFB800";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:i.jsx("path",{d:"M13 2L5 13h6l-2 9 10-13h-6l2-7z"})})})},Or=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M8 4h8v3a4 4 0 0 1-4 4 4 4 0 0 1-4-4V4z"}),i.jsx("path",{d:"M8 5H5a2 2 0 0 0 2 3"}),i.jsx("path",{d:"M16 5h3a2 2 0 0 1-2 3"}),i.jsx("path",{d:"M12 11v4"}),i.jsx("rect",{x:"9",y:"15",width:"6",height:"2",rx:"1"}),i.jsx("rect",{x:"8",y:"17",width:"8",height:"2",rx:"1"})]})})},zM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M12 4a8 8 0 1 0 8 8c0-1.7-1.3-3-3-3h-1a2 2 0 0 1-2-2V7c0-1.7-1.3-3-3-3z"}),i.jsx("circle",{cx:"10",cy:"14",r:"1.5"})]})})},Ba=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"11",cy:"11",r:"6"}),i.jsx("line",{x1:"16",y1:"16",x2:"20",y2:"20"})]})})},HM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"2"}),i.jsx("rect",{x:"8",y:"5",width:"8",height:"4",rx:"1"}),i.jsx("circle",{cx:"9",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"15",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"9",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"15",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"9",cy:"18",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"18",r:"0.8"}),i.jsx("circle",{cx:"15",cy:"18",r:"0.8"})]})})},GM=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"5",y:"19",width:"14",height:"2",rx:"1"}),i.jsx("line",{x1:"8",y1:"19",x2:"8",y2:"13"}),i.jsx("line",{x1:"8",y1:"13",x2:"14",y2:"7"}),i.jsx("rect",{x:"13",y:"5",width:"4",height:"2",rx:"1"}),i.jsx("line",{x1:"9",y1:"15",x2:"13",y2:"15"})]})})},$M=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 9l9-4 9 4-9 4-9-4z"}),i.jsx("path",{d:"M12 13v3"}),i.jsx("path",{d:"M7 12v2c0 1.66 3 3 5 3s5-1.34 5-3v-2"}),i.jsx("path",{d:"M21 9v4"}),i.jsx("circle",{cx:"21",cy:"14",r:"0.8"})]})})},ei=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 5h7a3 3 0 0 1 3 3v11a3 3 0 0 0-3-3H3z"}),i.jsx("path",{d:"M21 5h-7a3 3 0 0 0-3 3v11a3 3 0 0 1 3-3h7z"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"19"})]})})},z1=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("line",{x1:"4",y1:"20",x2:"20",y2:"20"}),i.jsx("line",{x1:"4",y1:"20",x2:"4",y2:"4"}),i.jsx("path",{d:"M4 16l4-4 4 3 5-5 3 2"}),i.jsx("circle",{cx:"4",cy:"16",r:"0.8"}),i.jsx("circle",{cx:"8",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"17",cy:"10",r:"0.8"}),i.jsx("circle",{cx:"20",cy:"12",r:"0.8"})]})})},Kx=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"white":return"#FFFFFF";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"9",cy:"8",r:"3"}),i.jsx("path",{d:"M4 20v-1a5 5 0 0 1 10 0v1"}),i.jsx("circle",{cx:"17",cy:"10",r:"3"}),i.jsx("path",{d:"M12 20v-1a5 5 0 0 1 10 0v1"})]})})},KM=({onCardCreated:s,onClose:e})=>{const{user:t}=Sn(),[n,a]=M.useState({statement:"",hints:"",proof:"",tags:"",subject:"",isPublic:!0,deckId:""}),[l,u]=M.useState(!1),[h,m]=M.useState(""),[p,x]=M.useState(!1),[w,b]=M.useState({autoFill:!1,autoTag:!1,convertLatex:!1});M.useEffect(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},[n]),M.useEffect(()=>{if(!t?.uid)return;const B=localStorage.getItem(`flashcard_draft_${t.uid}`);if(B)try{const q=JSON.parse(B);Date.now()-(q.timestamp||0)<1440*60*1e3?a(Q=>({...Q,...q.data})):localStorage.removeItem(`flashcard_draft_${t.uid}`)}catch(q){console.warn("Failed to restore draft:",q),localStorage.removeItem(`flashcard_draft_${t.uid}`)}},[t?.uid]),M.useEffect(()=>{if(!t?.uid||!(n.statement.trim()||n.hints.trim()||n.proof.trim()))return;const q=setTimeout(()=>{const G={data:n,timestamp:Date.now()};localStorage.setItem(`flashcard_draft_${t.uid}`,JSON.stringify(G))},2e3);return()=>clearTimeout(q)},[n,t?.uid]);const E=(B,q)=>{a(G=>({...G,[B]:q})),m("")},k=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}b(B=>({...B,autoFill:!0})),m("");try{const B=await xm.autoFillFromStatement(n.statement);a(q=>({...q,hints:B.hints||q.hints,proof:B.proof||q.proof,tags:B.tags?B.tags.join(", "):q.tags})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(B){console.error("AI autofill error:",B),m(`AI autofill failed: ${B.message}`)}finally{b(B=>({...B,autoFill:!1}))}},R=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}b(B=>({...B,autoTag:!0})),m("");try{const B=await xm.autoTagOnly(n.statement);a(q=>({...q,tags:B.join(", ")}))}catch(B){console.error("AI auto-tag error:",B),m(`AI auto-tag failed: ${B.message}`)}finally{b(B=>({...B,autoTag:!1}))}},U=async B=>{const q=n[B];if(!q.trim()){m(`Please enter some ${B} content first`);return}b(G=>({...G,convertLatex:!0})),m("");try{const G=await xm.convertToLaTeX(q);a(Q=>({...Q,[B]:G})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(G){console.error("LaTeX conversion error:",G),m(`LaTeX conversion failed: ${G.message}`)}finally{b(G=>({...G,convertLatex:!1}))}},z=async B=>{if(B.preventDefault(),!t){m("Please sign in to create flashcards");return}const q=Ys.checkRateLimit(`flashcard_create_${t.uid}`,5,3e5);if(!q.allowed){m(q.message);return}const G=Ys.validateFlashcardInput(n);if(!G.isValid){m(G.errors[0]);return}const Q=Ys.detectSuspiciousContent(`${n.statement} ${n.hints} ${n.proof}`);if(Q.isSuspicious){m("Content contains potentially unsafe elements. Please review and try again."),console.warn("Suspicious content detected:",Q.findings);return}u(!0),m("");try{const L={...G.sanitizedData,createdAt:new Date};await is.createFlashcard(L,t.uid,n.deckId||null),localStorage.removeItem(`flashcard_draft_${t.uid}`),a(P=>({statement:"",hints:"",proof:"",tags:P.tags,subject:P.subject,isPublic:P.isPublic,deckId:P.deckId})),x(!0),s&&s(),setTimeout(()=>{x(!1)},2e3)}catch(L){console.error("Error creating flashcard:",L);const P=Ys.getPublicErrorMessage(L,!0);m(P)}finally{u(!1)}};return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl text-white shadow-lg",style:{background:"linear-gradient(135deg, #8B7355 0%, #7A6245 100%)"},children:i.jsx(xr,{size:32,color:"white"})}),i.jsx("h1",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:"Create Flashcard"})]}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Build a three-sided flashcard with statement, hints, and proof"}),p&&i.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 border border-green-200 rounded-xl text-sm shadow-md",children:[i.jsx(kc,{size:16,color:"green"}),i.jsx("span",{className:"font-medium",children:"Flashcard created successfully! Ready to create another?"})]}),t&&!p&&(n.statement.trim()||n.hints.trim()||n.proof.trim())&&i.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm",children:[i.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),i.jsx("span",{children:"Auto-saving draft..."})]})]}),i.jsxs("form",{onSubmit:z,className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"w-10 h-10 claude-gradient rounded-xl flex items-center justify-center text-white font-bold",children:"1"}),i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Statement"}),i.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),i.jsx("textarea",{value:n.statement,onChange:B=>E("statement",B.target.value),placeholder:`Enter the problem statement, theorem, or question here...

Example: Prove that the derivative of sin(x) is cos(x)`,className:"claude-input w-full h-32 resize-none",required:!0}),n.statement.trim()&&i.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[i.jsxs("button",{type:"button",onClick:k,disabled:w.autoFill,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:w.autoFill?"var(--claude-muted)":"linear-gradient(135deg, #8B7355 0%, #7A6245 100%)"},children:[w.autoFill?i.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx(xr,{size:16,color:"white"}),i.jsx("span",{children:w.autoFill?"Generating...":"Autofill Hints, Proof & Tags"})]}),i.jsxs("button",{type:"button",onClick:R,disabled:w.autoTag,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:w.autoTag?"var(--claude-muted)":"linear-gradient(135deg, #10B981 0%, #059669 100%)"},children:[w.autoTag?i.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx(q1,{size:16,color:"white"}),i.jsx("span",{children:w.autoTag?"Generating...":"Auto Tag Only"})]})]}),n.statement&&i.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[i.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),i.jsx("div",{style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.statement}})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, #9333ea 0%, #a855f7 100%)"},children:"2"}),i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Hints"}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Optional"})]}),i.jsx("textarea",{value:n.hints,onChange:B=>E("hints",B.target.value),placeholder:`Provide helpful hints or guidance...

Example: Start by using the definition of derivative as a limit. Consider the addition formula for sine.`,className:"claude-input w-full h-24 resize-none"}),n.hints.trim()&&i.jsx("div",{className:"mt-3",children:i.jsxs("button",{type:"button",onClick:()=>U("hints"),disabled:w.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:w.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[w.convertLatex?i.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx($d,{size:14,color:"white"}),i.jsx("span",{children:w.convertLatex?"Converting...":"Convert to LaTeX"})]})})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, var(--claude-success) 0%, #10b981 100%)"},children:"3"}),i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Proof / Answer"}),i.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),i.jsx("textarea",{value:n.proof,onChange:B=>E("proof",B.target.value),placeholder:`Provide the complete proof, solution, or detailed answer...

Example: Using the definition of derivative:
f'(x) = lim(h0) [sin(x+h) - sin(x)]/h
= lim(h0) [sin(x)cos(h) + cos(x)sin(h) - sin(x)]/h
...`,className:"claude-input w-full h-40 resize-none",required:!0}),n.proof.trim()&&i.jsx("div",{className:"mt-3",children:i.jsxs("button",{type:"button",onClick:()=>U("proof"),disabled:w.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:w.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[w.convertLatex?i.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx($d,{size:14,color:"white"}),i.jsx("span",{children:w.convertLatex?"Converting...":"Convert to LaTeX"})]})}),n.proof&&i.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[i.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),i.jsx("div",{className:"whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.proof}})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Card Details"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),i.jsx(IM,{value:n.subject,onChange:B=>E("subject",B),placeholder:"Select or type a subject (e.g. Calculus, Physics)"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),i.jsx(CM,{value:n.tags,onChange:B=>E("tags",B),placeholder:"Type tags here or click existing tags below"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck ",i.jsx("span",{className:"text-sm claude-text-muted",children:"(optional)"})]}),i.jsx(kM,{value:n.deckId,onChange:B=>E("deckId",B),placeholder:"Choose a deck to organize this card",rememberSelection:!0})]})]}),i.jsx("div",{className:"mt-6",children:i.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:n.isPublic,onChange:B=>E("isPublic",B.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--claude-accent)",backgroundColor:n.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),i.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this flashcard public (others can discover and study it)"})]})})]}),h&&i.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:i.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[i.jsx(Pg,{size:16,color:"red"}),i.jsx("span",{children:h})]})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&i.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{type:"submit",disabled:l||!n.statement.trim()||!n.proof.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:l||!n.statement.trim()||!n.proof.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:l?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(xr,{size:16,color:"white"}),"Create Flashcard"]})})]})]}),i.jsxs("div",{className:"mt-8 p-6 rounded-2xl",style:{backgroundColor:"rgba(68, 90, 255, 0.1)",border:"1px solid var(--claude-accent-blue)"},children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--claude-accent-blue)"},children:[i.jsx($d,{size:20,color:"blue"}),"LaTeX Math Support"]}),i.jsxs("div",{className:"claude-text-secondary text-sm space-y-2",children:[i.jsx("p",{children:"Use LaTeX for mathematical expressions:"}),i.jsxs("div",{className:"claude-card p-3 font-mono text-xs",children:[i.jsxs("div",{children:["Inline: ",i.jsx("code",{children:"$f(x) = x^2 + 2x + 1$"})]}),i.jsxs("div",{children:["Block: ",i.jsxs("code",{children:["$$\\int_0^1 x^2 dx = \\frac",1,3,"$$"]})]})]})]})]})]})})};class Ya{static isPermissionOrIndexError(e){const t=e.message||"";return t.includes("Missing or insufficient permissions")||t.includes("requires an index")||t.includes("permission-denied")}static async startStudySession(e,t={}){try{const n={userId:e,sessionId:this.generateSessionId(),startTime:Me(),mode:t.mode||"study",deckId:t.deckId||null,deckName:t.deckName||null,cardsStudied:0,cardsCorrect:0,cardsIncorrect:0,cardResults:[],isActive:!0},a=await Ws(Ie(te,"studySessions"),n);if(Dn)try{oa(Dn,"study_session_start",{mode:t.mode,deck_id:t.deckId,user_id:e})}catch(l){console.warn("Firebase Analytics not available:",l)}return{id:a.id,...n}}catch(n){throw console.error("Error starting study session:",n),n}}static async endStudySession(e,t){try{const n=be(te,"studySessions",e),a=await bt(n);if(!a.exists())throw new Error("Session not found");const l=a.data(),u=l.startTime.toMillis(),h=Date.now(),m=Math.round((h-u)/1e3),p=l.cardsStudied>0?l.cardsCorrect/l.cardsStudied:0,x=l.cardsStudied>0?m/l.cardsStudied:0;if(await Wt(n,{endTime:Me(),duration:m,accuracy:p,averageTimePerCard:x,isActive:!1}),await this.updateUserAnalytics(t,{sessionDuration:m,cardsStudied:l.cardsStudied,accuracy:p,deckId:l.deckId}),await this.updateDailyStats(t,{studyTime:m,sessionsCount:1,cardsStudied:l.cardsStudied,accuracy:p}),Dn)try{oa(Dn,"study_session_end",{duration:m,cards_studied:l.cardsStudied,accuracy:p,user_id:t})}catch(w){console.warn("Firebase Analytics not available:",w)}return{duration:m,cardsStudied:l.cardsStudied,accuracy:p,averageTimePerCard:x}}catch(n){if(this.isPermissionOrIndexError(n))return{duration:0,cardsStudied:0,accuracy:0,averageTimePerCard:0};throw console.error("Error ending study session:",n),n}}static async recordCardAnswer(e,t){try{const n=be(te,"studySessions",e),a=await bt(n);if(!a.exists())throw new Error("Session not found");const l=al(te),u={cardId:t.cardId,timeSpent:t.timeSpent,wasCorrect:t.wasCorrect,attempts:t.attempts||1,difficulty:t.difficulty||"medium",confidenceLevel:t.confidenceLevel||3,timestamp:Me()};if(l.update(n,{cardResults:eu(u),cardsStudied:(a.data().cardsStudied||0)+1,[`cards${t.wasCorrect?"Correct":"Incorrect"}`]:(a.data()[`cards${t.wasCorrect?"Correct":"Incorrect"}`]||0)+1}),await this.updateCardProgress(t.userId,t.cardId,{wasCorrect:t.wasCorrect,timeSpent:t.timeSpent,confidenceLevel:t.confidenceLevel}),await l.commit(),Dn)try{oa(Dn,"card_answered",{card_id:t.cardId,was_correct:t.wasCorrect,time_spent:t.timeSpent,user_id:t.userId})}catch(h){console.warn("Firebase Analytics not available:",h)}return!0}catch(n){throw console.error("Error recording card answer:",n),n}}static async updateCardProgress(e,t,n){try{const a=be(te,"learningProgress",e,"cards",t),l=await bt(a);let u;l.exists()?u=l.data():u={cardId:t,userId:e,totalReviews:0,correctReviews:0,accuracy:0,averageTimeToAnswer:0,fastestTime:1/0,slowestTime:0,masteryLevel:0,improvementRate:0,createdAt:Me()},u.totalReviews+=1,n.wasCorrect&&(u.correctReviews+=1),u.accuracy=u.correctReviews/u.totalReviews;const h=n.timeSpent;u.averageTimeToAnswer=(u.averageTimeToAnswer*(u.totalReviews-1)+h)/u.totalReviews,u.fastestTime=Math.min(u.fastestTime,h),u.slowestTime=Math.max(u.slowestTime,h);const m=u.accuracy,p=1-(u.slowestTime-u.fastestTime)/u.slowestTime,x=(n.confidenceLevel||3)/5;return u.masteryLevel=m*.5+p*.3+x*.2,u.lastMasteryUpdate=Me(),await Os(a,u,{merge:!0}),u}catch(a){throw console.error("Error updating card progress:",a),a}}static async getCardProgress(e,t=null){try{const n=Ie(te,"learningProgress",e,"cards");let a=n;t&&t.length>0&&(a=Fe(n,Ye("cardId","in",t)));const l=await Ke(a),u={};return l.docs.forEach(h=>{const m=h.data();u[m.cardId]=m}),u}catch(n){if(this.isPermissionOrIndexError(n))return{};throw console.error("Error getting card progress:",n),n}}static async updateUserAnalytics(e,t){try{const n=be(te,"userAnalytics",e),a=await bt(n);let l;if(a.exists()?l=a.data():l={userId:e,totalStudyTime:0,totalSessions:0,studyStreak:0,longestStreak:0,overallAccuracy:0,improvementRate:0,subjectStats:{},deckStats:{},createdAt:Me()},l.totalStudyTime+=t.sessionDuration,l.totalSessions+=1,l.overallAccuracy=(l.overallAccuracy*(l.totalSessions-1)+t.accuracy)/l.totalSessions,t.deckId){l.deckStats[t.deckId]||(l.deckStats[t.deckId]={studyTime:0,sessions:0,accuracy:0});const u=l.deckStats[t.deckId];u.studyTime+=t.sessionDuration,u.sessions+=1,u.accuracy=(u.accuracy*(u.sessions-1)+t.accuracy)/u.sessions}return l.lastUpdated=Me(),await Os(n,l,{merge:!0}),l}catch(n){throw console.error("Error updating user analytics:",n),n}}static async updateDailyStats(e,t){try{const n=new Date().toISOString().split("T")[0],a=be(te,"dailyStats",e,"days",n),l=await bt(a);let u;return l.exists()?u=l.data():u={date:n,userId:e,studyTime:0,sessionsCount:0,cardsStudied:0,accuracy:0,decksStudied:[],subjectsStudied:[]},u.studyTime+=t.studyTime,u.sessionsCount+=t.sessionsCount,u.cardsStudied+=t.cardsStudied,u.sessionsCount>0&&(u.accuracy=(u.accuracy*(u.sessionsCount-1)+t.accuracy)/u.sessionsCount),await Os(a,u,{merge:!0}),u}catch(n){throw console.error("Error updating daily stats:",n),n}}static async getUserInsights(e,t="week"){try{const[n,a,l]=await Promise.all([this.getUserAnalytics(e),this.getRecentSessions(e,t),this.getCardProgress(e)]);return{accuracyTrend:this.calculateTrend(a,"accuracy"),studyTimeTrend:this.calculateTrend(a,"duration"),masteryProgress:this.calculateMasteryProgress(l),strugglingCards:this.identifyStrugglingCards(l),strongSubjects:this.identifyStrongSubjects(n.subjectStats),optimalStudyTime:this.identifyOptimalStudyTime(a),consistencyScore:this.calculateConsistencyScore(a),recommendations:this.generateRecommendations(n,l)}}catch(n){if(this.isPermissionOrIndexError(n))return{studyStreaks:{current:0,longest:0},totalStudyTime:0,averageAccuracy:0,cardsStudied:0,sessionsCompleted:0,improvementTrend:"stable",weeklyProgress:[],strongSubjects:[],weakSubjects:[]};throw console.error("Error getting user insights:",n),n}}static async getRecentSessions(e,t="week"){try{const n=t==="week"?7:t==="month"?30:1,a=new Date(Date.now()-n*24*60*60*1e3),l=Fe(Ie(te,"studySessions"),Ye("userId","==",e),Ye("startTime",">=",a),Ye("isActive","==",!1),an("startTime","desc"),on(100));return(await Ke(l)).docs.map(h=>({id:h.id,...h.data()}))}catch(n){return this.isPermissionOrIndexError(n)?[]:(console.error("Error getting recent sessions:",n),[])}}static async getUserAnalytics(e){try{const t=be(te,"userAnalytics",e),n=await bt(t);return n.exists()?n.data():{totalStudyTime:0,totalSessions:0,overallAccuracy:0,studyStreak:0,subjectStats:{},deckStats:{}}}catch(t){throw console.error("Error getting user analytics:",t),t}}static generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static calculateTrend(e,t){if(e.length<2)return 0;const n=e.slice(0,Math.floor(e.length/2)),a=e.slice(Math.floor(e.length/2)),l=n.reduce((h,m)=>h+(m[t]||0),0)/n.length,u=a.reduce((h,m)=>h+(m[t]||0),0)/a.length;return u>0?(l-u)/u:0}static calculateMasteryProgress(e){const t=Object.values(e);return t.length===0?0:t.reduce((n,a)=>n+(a.masteryLevel||0),0)/t.length}static identifyStrugglingCards(e){return Object.values(e).filter(t=>t.accuracy<.6&&t.totalReviews>=3).sort((t,n)=>t.accuracy-n.accuracy).slice(0,5)}static identifyStrongSubjects(e){return Object.entries(e).filter(([t,n])=>n.accuracy>.8).sort(([t,n],[a,l])=>l.accuracy-n.accuracy).slice(0,3).map(([t,n])=>t)}static identifyOptimalStudyTime(e){const t={morning:[],afternoon:[],evening:[]};e.forEach(l=>{const u=new Date(l.startTime.toMillis()).getHours();let h="afternoon";u<12?h="morning":u>18&&(h="evening"),t[h].push(l.accuracy||0)});let n="afternoon",a=0;return Object.entries(t).forEach(([l,u])=>{if(u.length>0){const h=u.reduce((m,p)=>m+p)/u.length;h>a&&(a=h,n=l)}}),n}static calculateConsistencyScore(e){if(e.length<3)return 0;const t=e.map(u=>u.duration||0),n=t.reduce((u,h)=>u+h)/t.length,a=t.reduce((u,h)=>u+Math.pow(h-n,2),0)/t.length,l=Math.sqrt(a);return Math.max(0,1-l/n)}static generateRecommendations(e,t){const n=[];e.totalStudyTime<3600&&n.push({type:"study_time",title:"Increase Study Time",description:"Try to study for at least 20 minutes per day to see better results.",priority:"high"}),e.overallAccuracy<.7&&n.push({type:"accuracy",title:"Focus on Understanding",description:"Review the hints and explanations more carefully before answering.",priority:"high"});const a=this.identifyStrugglingCards(t);return a.length>0&&n.push({type:"struggling_cards",title:"Review Difficult Cards",description:`You have ${a.length} cards that need extra attention.`,priority:"medium"}),n}}const QM=Object.freeze(Object.defineProperty({__proto__:null,AnalyticsService:Ya},Symbol.toStringTag,{value:"Module"})),su=(s=[],e)=>{M.useEffect(()=>{let t=!1;const n=()=>{if(!window.MathJax?.typesetPromise)return;const a=typeof e=="string"?document.querySelector(e):e||document.body;if(!a||!a.nodeType||a.nodeType!==Node.ELEMENT_NODE){console.warn("Invalid target element for MathJax rendering");return}if(window.MathJax.typesetClear&&a.contains)try{window.MathJax.typesetClear([a])}catch(l){console.warn("MathJax typesetClear error:",l)}window.MathJax.typesetPromise([a]).catch(l=>{t||console.error("MathJax typeset error:",l)})};if(window.MathJax&&window.MathJax.typesetPromise)n();else if(window.MathJaxReady)n();else{const a=()=>{t||(window.MathJax?.typesetPromise||window.MathJaxReady?n():requestAnimationFrame(a))},l=()=>!t&&n();return document.addEventListener("mathjax:ready",l),a(),()=>{t=!0,document.removeEventListener("mathjax:ready",l)}}return()=>{t=!0}},s)},YM=()=>{const{user:s}=Sn(),[e,t]=M.useState([]),[n,a]=M.useState(0),[l,u]=M.useState(0),[h,m]=M.useState(!0),[p,x]=M.useState(""),[w,b]=M.useState(null),[E,k]=M.useState(null),[R,U]=M.useState(!1),[z,B]=M.useState({}),q=M.useRef(null),G=M.useRef(!1),Q=M.useRef(null),L=e[n],P=M.useMemo(()=>{const I=L?.statement??L?.question??"No statement available",W=Array.isArray(L?.hints)?L.hints.join(`
`):L?.hints??L?.hint??"No hint available",ve=L?.proof??L?.answer??"No proof available";return[I,W,ve]},[L?.statement,L?.question,L?.hints,L?.hint,L?.proof,L?.answer]),T=["Statement","Hint","Proof"];su([n,l],Q?.current),M.useEffect(()=>{V()},[s]),M.useEffect(()=>{s&&e.length>0&&!w&&A()},[s,e.length,w]),M.useEffect(()=>{L&&k(Date.now())},[n]),M.useEffect(()=>()=>{w&&F()},[w]);const A=async()=>{try{const I=await Ya.startStudySession(s.uid,{mode:"study",deckId:null,deckName:"All Cards"});b(I),console.log("Study session started:",I.sessionId)}catch(I){console.error("Failed to start study session:",I)}},F=async()=>{if(w)try{const I=await Ya.endStudySession(w.sessionId,s.uid);console.log("Study session ended:",I),b(null)}catch(I){console.warn("Analytics not available for session end:",I),b(null)}},S=async(I,W=3)=>{if(!w||!L||!E)return;const ve=Math.round((Date.now()-E)/1e3);try{await Ya.recordCardAnswer(w.sessionId,{cardId:L.id,userId:s.uid,timeSpent:ve,wasCorrect:I,attempts:1,difficulty:"medium",confidenceLevel:W}),B(de=>({...de,[L.id]:I})),setTimeout(()=>{D()},1e3)}catch(de){console.warn("Analytics not available, but rating recorded locally:",de),B(Ce=>({...Ce,[L.id]:I})),setTimeout(()=>{D()},1e3)}},V=M.useCallback(async()=>{try{m(!0),x("");let I=[];if(s)try{const W=await is.getUserFlashcards(s.uid,50),{collection:ve,query:de,where:Ce,orderBy:ye,limit:Ee,getDocs:We}=await rn(async()=>{const{collection:st,query:ce,where:Ae,orderBy:Te,limit:$e,getDocs:Qe}=await Promise.resolve().then(()=>Mr);return{collection:st,query:ce,where:Ae,orderBy:Te,limit:$e,getDocs:Qe}},void 0),{db:Le}=await rn(async()=>{const{db:st}=await Promise.resolve().then(()=>la);return{db:st}},void 0),wt=de(ve(Le,"flashcards"),Ce("userId","==",s.uid),ye("createdAt","desc"),Ee(50)),Gt=(await We(wt)).docs.map(st=>({id:st.id,...st.data()}));I=[...W,...Gt].sort((st,ce)=>{const Ae=st.createdAt?.toMillis?.()||st.createdAt?.getTime?.()||0;return(ce.createdAt?.toMillis?.()||ce.createdAt?.getTime?.()||0)-Ae})}catch(W){console.warn("Failed to load user cards, falling back to public:",W)}I.length||(I=await is.getPublicFlashcards(50)),Array.isArray(I)&&I.length>0?(t(I),a(0),u(0)):(t([]),a(0),u(0))}catch(I){x("Failed to load flashcards"),console.error("Error loading flashcards:",I),t([])}finally{m(!1)}},[s]),D=M.useCallback(()=>{e.length>0&&(a(I=>Math.min(I+1,e.length-1)),u(0))},[e.length]),ke=M.useCallback(()=>{e.length>0&&(a(I=>Math.max(I-1,0)),u(0))},[e.length]),ne=M.useCallback(()=>{u(I=>(I+1)%3)},[]),O=M.useCallback(I=>{if(l===2&&w)switch(I.key){case"1":I.preventDefault(),S(!1,1);return;case"2":I.preventDefault(),S(!1,2);return;case"3":I.preventDefault(),S(!0,4);return;case"4":I.preventDefault(),S(!0,5);return}I.key==="ArrowRight"?D():I.key==="ArrowLeft"?ke():(I.key===" "||I.code==="Space")&&(I.preventDefault(),ne())},[D,ke,ne,l,w,S]),ie=I=>{q.current=I.touches[0].clientX,G.current=!1},$=I=>{G.current=!0},ge=I=>{if(!q.current)return;const W=q.current-I.changedTouches[0].clientX;if(q.current=null,Math.abs(W)>50)return W>0?D():ke();G.current||ne()};return M.useEffect(()=>(window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)),[O]),h?i.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:i.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[i.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-6"}),i.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center justify-center gap-2",children:[i.jsx(ei,{size:24,color:"white"}),"Loading Flashcards..."]}),i.jsx("p",{className:"text-slate-300",children:"Please wait while we load your study materials."})]})}):p?i.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:i.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-3xl p-12 text-center max-w-lg",children:[i.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-4",children:" Error Loading Flashcards"}),i.jsx("p",{className:"text-red-300 mb-6",children:p}),i.jsx("button",{onClick:V,className:"px-6 py-3 text-white font-semibold rounded-xl transition-all duration-200",style:{background:"linear-gradient(135deg, #A86240 0%, #97552B 100%)"},onMouseEnter:I=>I.target.style.background="linear-gradient(135deg, #97552B 0%, #86481A 100%)",onMouseLeave:I=>I.target.style.background="linear-gradient(135deg, #A86240 0%, #97552B 100)",children:"Try Again"})]})}):e.length===0?i.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:i.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[i.jsx("div",{className:"mb-6",children:i.jsx(ei,{size:64,color:"white"})}),i.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"No Flashcards Available"}),i.jsx("p",{className:"text-slate-300",children:"Create your first flashcard to start studying!"})]})}):L?i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},role:"main",children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-8",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl text-white shadow-lg",style:{background:"linear-gradient(135deg, #A86240 0%, #97552B 100%)"},children:i.jsx(il,{size:32,color:"white"})}),i.jsx("h2",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:"Study Mode"})]}),i.jsx("div",{className:"claude-card px-4 py-2",children:i.jsxs("span",{className:"claude-text-secondary font-medium",children:[n+1," of ",e.length]})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"flex justify-center mb-6",children:i.jsx("div",{className:"flex claude-card p-2",children:T.map((I,W)=>i.jsx("button",{onClick:()=>u(W),className:`px-6 py-2 rounded-xl font-medium transition-colors duration-200 ${l===W?"bg-[var(--claude-accent)] text-white":"text-[var(--claude-secondary-text)] hover:bg-[var(--claude-surface-hover)] hover:text-[var(--claude-primary-text)]"}`,"aria-pressed":l===W,"aria-label":`Show ${I} (${W+1} of ${T.length})`,children:I},W))})}),i.jsxs("div",{onClick:ne,onTouchStart:ie,onTouchMove:$,onTouchEnd:ge,onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),ne())},className:"claude-card p-12 min-h-[400px] flex flex-col justify-center items-center cursor-pointer transition-all duration-300 group hover:-translate-y-0.5 hover:border-[var(--claude-accent)] focus:outline-none focus:ring-2 focus:ring-[var(--claude-accent)] focus:ring-opacity-50",style:{borderRadius:"24px"},tabIndex:0,role:"button","aria-label":`Show ${T[l]} content. Press Space or Enter to continue.`,children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-sm font-medium mb-4 uppercase tracking-wider",style:{color:"var(--claude-accent)"},children:T[l]}),i.jsx("div",{ref:Q,className:"text-xl leading-relaxed transition-colors whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},children:P[l]})]}),i.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 claude-text-muted text-sm",children:l<2?"Tap to see next side":"Tap to restart"})]}),i.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[L.subject&&i.jsx("span",{className:"claude-tag",children:L.subject}),L.slug?i.jsxs("a",{href:`/card/${L.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-primary inline-flex items-center gap-2 text-sm",children:[i.jsx("span",{children:""}),"View Public Card"]}):i.jsxs("div",{className:"claude-button-secondary inline-flex items-center gap-2 text-sm opacity-50 cursor-not-allowed",children:[i.jsx("span",{children:""}),"Private Card"]})]}),l===2&&w&&i.jsxs("div",{className:"mt-6 claude-card p-6",style:{background:"linear-gradient(135deg, #A86240 0%, #97552B 100%)",color:"white"},children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("h4",{className:"font-semibold text-white mb-2 text-lg",children:"How well did you know this?"}),i.jsx("p",{className:"text-sm text-white/90 mb-4",children:"This helps track your learning progress"}),i.jsxs("div",{className:"text-xs text-white/80 bg-white/10 rounded-lg px-3 py-2 inline-block",children:[" ",i.jsx("strong",{children:"Keyboard shortcuts:"})," Press ",i.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"1"}),", ",i.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"2"}),", ",i.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"3"}),", or ",i.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"4"})," to rate quickly"]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[i.jsxs("button",{onClick:()=>S(!1,1),onKeyDown:I=>I.key==="1"&&S(!1,1),className:"flex flex-col items-center gap-2 px-4 py-3 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 hover:border-red-400/50 text-white rounded-lg transition-all text-sm font-medium group",children:[i.jsx(Pg,{size:20,color:"white"}),i.jsx("span",{children:"Struggled"}),i.jsx("span",{className:"text-xs opacity-70",children:"(1)"})]}),i.jsxs("button",{onClick:()=>S(!1,2),onKeyDown:I=>I.key==="2"&&S(!1,2),className:"flex flex-col items-center gap-2 px-4 py-3 bg-yellow-500/20 hover:bg-yellow-500/30 border border-yellow-400/30 hover:border-yellow-400/50 text-white rounded-lg transition-all text-sm font-medium group",children:[i.jsx(B1,{size:20,color:"white"}),i.jsx("span",{children:"Unsure"}),i.jsx("span",{className:"text-xs opacity-70",children:"(2)"})]}),i.jsxs("button",{onClick:()=>S(!0,4),onKeyDown:I=>I.key==="3"&&S(!0,4),className:"flex flex-col items-center gap-2 px-4 py-3 bg-green-500/20 hover:bg-green-500/30 border border-green-400/30 hover:border-green-400/50 text-white rounded-lg transition-all text-sm font-medium group",children:[i.jsx(kc,{size:20,color:"white"}),i.jsx("span",{children:"Good"}),i.jsx("span",{className:"text-xs opacity-70",children:"(3)"})]}),i.jsxs("button",{onClick:()=>S(!0,5),onKeyDown:I=>I.key==="4"&&S(!0,5),className:"flex flex-col items-center gap-2 px-4 py-3 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 hover:border-blue-400/50 text-white rounded-lg transition-all text-sm font-medium group",children:[i.jsx(Xm,{size:20,color:"white"}),i.jsx("span",{children:"Perfect"}),i.jsx("span",{className:"text-xs opacity-70",children:"(4)"})]})]}),z[L.id]!==void 0&&i.jsx("div",{className:"mt-3 text-center",children:i.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${z[L.id]?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z[L.id]?" Recorded as correct":" Recorded as incorrect"})})]})]}),i.jsxs("div",{className:"flex justify-between items-center mt-8",children:[i.jsx("button",{onClick:ke,disabled:n===0,className:"claude-button-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:" Previous"}),i.jsxs("div",{className:"claude-text-muted text-sm",children:[i.jsx("div",{className:"mb-2",children:"Use arrow keys or swipe to navigate  Space to flip sides"}),i.jsxs("div",{className:"text-xs bg-white/10 rounded-lg px-3 py-2 inline-block",children:[" ",i.jsx("strong",{children:"Rating shortcuts:"})," Press ",i.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"1-4"})," when reviewing to rate quickly"]})]}),i.jsx("button",{onClick:D,disabled:n===e.length-1,className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:n===e.length-1?"var(--claude-muted)":"var(--claude-accent)"},children:"Next "})]}),i.jsx("span",{className:"sr-only","aria-live":"polite",children:T[l]})]})}):i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[i.jsx("div",{className:"text-6xl mb-6",children:""}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Card Not Found"}),i.jsx("p",{className:"claude-text-secondary",children:"Unable to load the requested flashcard."}),i.jsx("button",{onClick:V,className:"claude-button-primary mt-6",children:"Reload Cards"})]})})},XM=()=>{const{user:s}=Sn(),[e,t]=M.useState(""),[n,a]=M.useState(""),[l,u]=M.useState(!0),[h,m]=M.useState([]),[p,x]=M.useState("recent"),[w,b]=M.useState(""),[E,k]=M.useState(new Set),[R,U]=M.useState(1),[z,B]=M.useState(new Set),[q,G]=M.useState(new Set),[Q,L]=M.useState(new Set),[P,T]=M.useState(new Set),[A,F]=M.useState(""),[S,V]=M.useState(null),[D,ke]=M.useState(!1),ne=12;M.useEffect(()=>{const ce=setTimeout(()=>a(e),200);return()=>clearTimeout(ce)},[e]);const O=M.useCallback(ce=>ce?.toMillis?ce.toMillis():ce||0,[]),ie=M.useCallback(ce=>{if(!ce)return"Unknown date";const Ae=ce.toDate?ce.toDate():new Date(ce);return Number.isNaN(Ae.getTime())?"Unknown date":Ae.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},[]),$=M.useCallback(async ce=>{try{const{getFunctions:Ae,httpsCallable:Te}=await rn(async()=>{const{getFunctions:Tt,httpsCallable:gt}=await Promise.resolve().then(()=>a5);return{getFunctions:Tt,httpsCallable:gt}},void 0),$e=Ae();await Te($e,"trackCardView")({cardId:ce}),m(Tt=>Tt.map(gt=>gt.id===ce?{...gt,viewCount:(gt.viewCount||0)+1}:gt))}catch(Ae){console.error("Error tracking view:",Ae)}},[]),ge=M.useCallback(ce=>{V(ce),ke(!0),$(ce.id)},[$]);su([S?.id],D);const I=M.useCallback(async()=>{const ce=await rn(()=>Promise.resolve().then(()=>Mr),void 0),{db:Ae}=await rn(async()=>{const{db:Te}=await Promise.resolve().then(()=>la);return{db:Te}},void 0);return{db:Ae,firestore:ce}},[]),W=M.useMemo(()=>{const ce=n.trim().toLowerCase(),Ae=h.filter(Te=>{const $e=Array.isArray(Te.hints)?Te.hints.join(" "):typeof Te.hints=="string"?Te.hints:"",Qe=!ce||(Te.statement||"").toLowerCase().includes(ce)||$e.toLowerCase().includes(ce)||(Te.proof||"").toLowerCase().includes(ce)||(Te.authorSlug||"").toLowerCase().includes(ce)||(Te.tags||[]).some(gt=>(gt||"").toLowerCase().includes(ce)),Tt=!w||(Te.tags||[]).includes(w);return Qe&&Tt});switch(p){case"upvotes":Ae.sort((Te,$e)=>($e.likeCount||0)-(Te.likeCount||0));break;case"oldest":Ae.sort((Te,$e)=>O(Te.createdAt)-O($e.createdAt));break;case"alphabetical":Ae.sort((Te,$e)=>(Te.statement||"").localeCompare($e.statement||""));break;default:Ae.sort((Te,$e)=>O($e.createdAt)-O(Te.createdAt))}return Ae},[h,n,p,w]);su([W,R]),M.useEffect(()=>{de(),s&&ve()},[s]);const ve=M.useCallback(async()=>{if(s)try{const[ce,Ae]=await Promise.all([rs.getOrFetch(rs.userKey(s.uid,"upvotes"),async()=>{const{collection:Te,query:$e,where:Qe,getDocs:Tt}=await rn(async()=>{const{collection:Ge,query:$t,where:en,getDocs:Et}=await Promise.resolve().then(()=>Mr);return{collection:Ge,query:$t,where:en,getDocs:Et}},void 0),{db:gt}=await rn(async()=>{const{db:Ge}=await Promise.resolve().then(()=>la);return{db:Ge}},void 0),ot=await Tt($e(Te(gt,"userUpvotes"),Qe("userId","==",s.uid)));return new Set(ot.docs.map(Ge=>Ge.data().cardId))},"userUpvotes"),rs.getOrFetch(rs.userKey(s.uid,"imports"),async()=>{const{collection:Te,query:$e,where:Qe,getDocs:Tt}=await rn(async()=>{const{collection:$t,query:en,where:Et,getDocs:Wn}=await Promise.resolve().then(()=>Mr);return{collection:$t,query:en,where:Et,getDocs:Wn}},void 0),{db:gt}=await rn(async()=>{const{db:$t}=await Promise.resolve().then(()=>la);return{db:$t}},void 0),ot=await Tt($e(Te(gt,"flashcards"),Qe("userId","==",s.uid))),Ge=new Set;return ot.docs.forEach($t=>{Ge.add($t.data().statement)}),Ge},"userImports")]);B(ce),G(Ae)}catch(ce){console.error("Error loading user data:",ce)}},[s]),de=M.useCallback(async()=>{try{u(!0),console.log(" Loading public cards...");const ce=await is.getPublicFlashcards(200),Ae=await rs.getOrFetch(rs.publicKey("tags"),()=>{const Te=new Set;return ce.forEach($e=>{$e.tags&&Array.isArray($e.tags)&&$e.tags.forEach(Qe=>Te.add(Qe))}),Te},"tags");console.log(" Loaded public cards:",ce.length,ce.slice(0,3)),m(ce),k(Ae)}catch(ce){console.error(" Error loading public cards:",ce),m([]),k(new Set)}finally{u(!1)}},[]);M.useEffect(()=>{U(1)},[n,p,w]);const Ce=M.useCallback(async ce=>{if(s&&!Q.has(ce)){L(Ae=>new Set(Ae).add(ce));try{const{runTransaction:Ae,doc:Te,serverTimestamp:$e}=await rn(async()=>{const{runTransaction:ot,doc:Ge,serverTimestamp:$t}=await Promise.resolve().then(()=>Mr);return{runTransaction:ot,doc:Ge,serverTimestamp:$t}},void 0),{db:Qe}=await rn(async()=>{const{db:ot}=await Promise.resolve().then(()=>la);return{db:ot}},void 0),Tt=Te(Qe,"userUpvotes",`${s.uid}_${ce}`),gt=Te(Qe,"publicCards",ce);await Ae(Qe,async ot=>{const Ge=await ot.get(Tt),en=(await ot.get(gt)).data()?.likeCount||0;Ge.exists()?(ot.delete(Tt),ot.update(gt,{likeCount:Math.max(0,en-1)})):(ot.set(Tt,{userId:s.uid,cardId:ce,createdAt:$e()}),ot.update(gt,{likeCount:en+1}))}),B(ot=>{const Ge=new Set(ot);return Ge.has(ce)?Ge.delete(ce):Ge.add(ce),Ge}),m(ot=>ot.map(Ge=>Ge.id===ce?{...Ge,likeCount:Math.max(0,(Ge.likeCount||0)+(z.has(ce)?-1:1))}:Ge))}catch(Ae){console.error("Error upvoting card:",Ae),F("Error upvoting card. Please try again."),setTimeout(()=>F(""),5e3)}finally{L(Ae=>{const Te=new Set(Ae);return Te.delete(ce),Te})}}},[s,z,Q,m]),ye=M.useCallback(async ce=>{if(!s||P.has(ce))return;const Ae=h.find(Te=>Te.id===ce);if(Ae){if(q.has(Ae.statement)){F("Card already imported"),setTimeout(()=>F(""),3e3);return}T(Te=>new Set(Te).add(ce));try{const{collection:Te,addDoc:$e,doc:Qe,updateDoc:Tt,increment:gt}=await rn(async()=>{const{collection:Et,addDoc:Wn,doc:pt,updateDoc:ut,increment:Vn}=await Promise.resolve().then(()=>Mr);return{collection:Et,addDoc:Wn,doc:pt,updateDoc:ut,increment:Vn}},void 0),{serverTimestamp:ot}=await rn(async()=>{const{serverTimestamp:Et}=await Promise.resolve().then(()=>Mr);return{serverTimestamp:Et}},void 0),{db:Ge}=await rn(async()=>{const{db:Et}=await Promise.resolve().then(()=>la);return{db:Et}},void 0);await $e(Te(Ge,"flashcards"),{userId:s.uid,statement:Ae.statement,hints:Ae.hints,proof:Ae.proof||"",tags:Ae.tags||[],createdAt:ot(),updatedAt:ot(),importedFrom:ce}),await Tt(Qe(Ge,"publicCards",ce),{importCount:gt(1)});const $t=new Set(q);$t.add(Ae.statement),G($t);const en=h.map(Et=>Et.id===ce?{...Et,importCount:(Et.importCount||0)+1}:Et);m(en),F("Card imported successfully!"),setTimeout(()=>F(""),3e3)}catch(Te){console.error("Error importing card:",Te),F("Error importing card. Please try again."),setTimeout(()=>F(""),5e3)}finally{T(Te=>{const $e=new Set(Te);return $e.delete(ce),$e})}}},[s,h,q,I,P]),Ee=ce=>{if(!ce)return"";const Ae=document.createElement("div");return Ae.textContent=ce,Ae.innerHTML},We=ce=>{const Ae=s&&z.has(ce.id),Te=s&&q.has(ce.statement),$e=Q.has(ce.id),Qe=P.has(ce.id),Tt=ie(ce.createdAt),gt=ce.authorSlug?ce.authorSlug.charAt(0).toUpperCase():"U";return i.jsxs("div",{className:"claude-card p-6 hover:shadow-lg transition-all duration-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:gt}),i.jsxs("div",{children:[ce.authorSlug?i.jsx("a",{href:`/profile/${ce.authorSlug}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium hover:underline",style:{color:"#9B8B73"},children:ce.authorSlug}):i.jsx("span",{className:"font-medium claude-text-secondary",children:"Anonymous User"}),i.jsx("div",{className:"claude-text-muted text-sm",children:Tt})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Statement"}),i.jsx("div",{className:"text-sm leading-relaxed",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:Ee(ce.statement)}})]}),ce.hints&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-1 claude-text-secondary text-sm",children:"Hints"}),i.jsx("div",{className:"text-sm claude-text-secondary",dangerouslySetInnerHTML:{__html:Ee(ce.hints)}})]}),ce.proof&&i.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",borderLeft:"4px solid #9B8B73"},children:[i.jsx("div",{className:"text-xs font-semibold claude-text-secondary mb-1 uppercase tracking-wider",children:"Proof Preview"}),i.jsx("div",{className:"text-sm",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:Ee(ce.proof.substring(0,150)+(ce.proof.length>150?"...":""))}})]}),i.jsxs("div",{className:"flex gap-4 mb-4 text-sm claude-text-muted",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(ca,{size:16,color:"default"}),i.jsxs("span",{children:[Math.max(0,ce.viewCount||0)," views"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Dd,{size:16,color:"default"}),i.jsxs("span",{children:[Math.max(0,ce.importCount||0)," imports"]})]})]}),ce.tags&&ce.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ce.tags.map(ot=>i.jsx("span",{className:"cursor-pointer hover:opacity-80",style:{backgroundColor:"rgba(155, 139, 115, 0.1)",color:"#9B8B73",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"500"},onClick:()=>b(ot),children:ot},ot))}),i.jsxs("div",{className:"flex gap-3 items-center",children:[i.jsxs("button",{onClick:()=>Ce(ce.id),disabled:!s||$e,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${Ae?"text-white":"claude-button-secondary"} ${!s||$e?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:Ae?"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)":void 0,border:Ae?"none":void 0},title:s?`${Ae?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards","aria-label":s?`${Ae?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards",children:[$e?i.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx(nu,{size:16,color:Ae?"white":"default"}),Math.max(0,ce.likeCount||0)]}),i.jsxs("button",{onClick:()=>ye(ce.id),disabled:!s||Te||Qe,className:`text-sm flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${!s||Te||Qe?"opacity-50 cursor-not-allowed":""}`,style:{background:Te?"var(--claude-success)":"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)",color:"white"},title:s?Te?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards","aria-label":s?Te?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards",children:[i.jsx(Dd,{size:16,color:"white"}),Qe?"Importing...":Te?"Imported":"Import"]}),i.jsxs("button",{onClick:()=>ge(ce),className:"claude-button-secondary text-sm flex items-center gap-2",children:[i.jsx(ca,{size:16,color:"default"}),"View"]}),i.jsxs("a",{href:`/card/${ce.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary text-sm flex items-center gap-2",onClick:()=>$(ce.id),children:[i.jsxs("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[i.jsx("path",{d:"M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"}),i.jsx("path",{d:"M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"})]}),"Share"]})]})]},ce.id)},Le=Math.ceil(W.length/ne),wt=(R-1)*ne,Rt=wt+ne,Gt=W.slice(wt,Rt),st=M.useCallback(ce=>{ce<1||ce>Le||(U(ce),window.scrollTo({top:0,behavior:"smooth"}))},[Le]);return i.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[i.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl text-white shadow-lg",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:i.jsx(Ba,{size:32,color:"white"})}),i.jsx("h1",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:"Search Flashcards"})]}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Discover and import flashcards from the community"})]}),A&&i.jsx("div",{className:`mb-6 p-4 rounded-lg border ${A.includes("successfully")?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{children:A}),i.jsx("button",{onClick:()=>F(""),className:"ml-2 text-lg font-bold opacity-60 hover:opacity-100",children:""})]})}),!s&&i.jsxs("div",{className:"text-center p-4 mb-6 rounded-2xl",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)",color:"white"},children:[i.jsx("p",{className:"mb-3",children:"Unlock the full experience!"}),i.jsx("a",{href:"/index.html",className:"inline-block px-6 py-2 rounded-lg font-semibold transition-all hover:scale-105",style:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",textDecoration:"none"},onMouseEnter:ce=>ce.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:ce=>ce.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Sign in"}),i.jsx("span",{children:" to upvote and import flashcards to your account."})]}),i.jsx("div",{className:"claude-card p-6 mb-8",children:i.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[i.jsxs("div",{className:"relative flex-1 w-full",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:i.jsx(Ba,{size:16,color:"default"})}),i.jsx("input",{type:"text",value:e,onChange:ce=>t(ce.target.value),placeholder:"Search flashcards, tags, or authors...",className:"claude-input w-full pl-10"}),e&&i.jsx("button",{onClick:()=>t(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center claude-text-muted hover:opacity-70",children:""})]}),i.jsxs("div",{className:"flex gap-3 items-center",children:[i.jsxs("select",{value:p,onChange:ce=>x(ce.target.value),className:"claude-input",children:[i.jsx("option",{value:"recent",children:"Most Recent"}),i.jsx("option",{value:"upvotes",children:"Most Upvoted"}),i.jsx("option",{value:"oldest",children:"Oldest First"}),i.jsx("option",{value:"alphabetical",children:"Alphabetical"})]}),i.jsxs("select",{value:w,onChange:ce=>b(ce.target.value),className:"claude-input",children:[i.jsx("option",{value:"",children:"All Tags"}),Array.from(E).sort().map(ce=>i.jsx("option",{value:ce,children:ce},ce))]})]})]})}),W.length>0&&i.jsx("div",{className:"claude-card p-4 mb-6",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{className:"claude-text-secondary",children:[i.jsx("span",{className:"font-semibold",children:W.length})," flashcards found"]}),i.jsxs("div",{className:"claude-text-muted text-sm",children:["Showing ",wt+1,"-",Math.min(Rt,W.length)," of ",W.length]})]})}),l&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"w-10 h-10 border-4 border-t-4 rounded-full animate-spin mx-auto mb-4",style:{borderColor:"var(--claude-border)",borderTopColor:"#9B8B73"}}),i.jsx("div",{className:"claude-text-secondary",children:"Loading flashcards..."})]}),!l&&W.length===0&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Ba,{size:64,color:"default",className:"mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No flashcards found"}),i.jsx("p",{className:"claude-text-muted",children:"Try adjusting your search terms or filters"})]}),!l&&Gt.length>0&&i.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:Gt.map(We)}),Le>1&&i.jsxs("div",{className:"flex justify-center items-center gap-2",children:[i.jsx("button",{onClick:()=>st(R-1),disabled:R===1,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:" Previous"}),Array.from({length:Math.min(5,Le)},(ce,Ae)=>{const Te=Ae+1;return i.jsx("button",{onClick:()=>st(Te),className:`px-4 py-2 rounded-lg font-medium transition-all ${Te===R?"text-white":"claude-button-secondary"}`,style:{backgroundColor:Te===R?"#9B8B73":void 0},children:Te},Te)}),i.jsx("button",{onClick:()=>st(R+1),disabled:R===Le,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Next "})]})]}),D&&S&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:()=>ke(!1),children:i.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-4xl w-[90%] max-h-[80vh] overflow-y-auto m-4 relative",onClick:ce=>ce.stopPropagation(),style:{color:"var(--claude-primary-text)",backgroundColor:"var(--claude-surface)"},children:[i.jsx("button",{onClick:()=>ke(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors",style:{color:"var(--claude-muted-text)"},children:i.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:i.jsx("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})}),i.jsxs("div",{className:"pr-8",children:[i.jsx("div",{className:"mb-6",children:i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:S.authorSlug?S.authorSlug.charAt(0).toUpperCase():"U"}),i.jsxs("div",{children:[i.jsx("a",{href:`/profile/${S.authorSlug}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium hover:underline",style:{color:"#9B8B73"},children:S.authorSlug}),i.jsx("div",{className:"text-sm claude-text-muted",children:ie(S.createdAt)})]})]})}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Statement"}),i.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)"},dangerouslySetInnerHTML:{__html:S.statement}})]}),S.hints&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Hints"}),i.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)"},dangerouslySetInnerHTML:{__html:S.hints}})]}),S.proof&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Proof / Answer"}),i.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)"},dangerouslySetInnerHTML:{__html:S.proof}})]}),S.tags&&S.tags.length>0&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:S.tags.map(ce=>i.jsx("span",{className:"cursor-pointer hover:opacity-80 transition-opacity",style:{backgroundColor:"rgba(155, 139, 115, 0.1)",color:"#9B8B73",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"500"},onClick:()=>{b(ce),ke(!1)},children:ce},ce))})]}),i.jsxs("div",{className:"flex gap-4 mb-6 text-sm claude-text-muted",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(ca,{size:16,color:"default"}),i.jsxs("span",{children:[Math.max(0,S.viewCount||0)," views"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Dd,{size:16,color:"default"}),i.jsxs("span",{children:[Math.max(0,S.importCount||0)," imports"]})]})]}),i.jsxs("div",{className:"flex gap-3 pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[i.jsxs("button",{onClick:()=>{Ce(S.id)},disabled:!s||Q.has(S.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${z.has(S.id)?"text-white":"claude-button-secondary"} ${!s||Q.has(S.id)?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:z.has(S.id)?"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)":void 0,border:z.has(S.id)?"none":void 0},children:[Q.has(S.id)?i.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx(nu,{size:16,color:z.has(S.id)?"white":"default"}),Math.max(0,S.likeCount||0)]}),i.jsxs("button",{onClick:()=>{ye(S.id),ke(!1)},disabled:!s||q.has(S.statement)||P.has(S.id),className:`text-sm flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${!s||q.has(S.statement)||P.has(S.id)?"opacity-50 cursor-not-allowed":""}`,style:{background:q.has(S.statement)?"var(--claude-success)":"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)",color:"white"},children:[i.jsx(Dd,{size:16,color:"white"}),P.has(S.id)?"Importing...":q.has(S.statement)?"Imported":"Import"]}),i.jsxs("a",{href:`/card/${S.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary text-sm flex items-center gap-2",onClick:()=>$(S.id),children:[i.jsxs("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[i.jsx("path",{d:"M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"}),i.jsx("path",{d:"M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"})]}),"Share"]})]})]})]})})]})},sE=new Map,WM=300*1e3,JM=()=>{const{user:s}=Sn(),[e,t]=M.useState([]),[n,a]=M.useState({totalUsers:0,totalCards:0,totalViews:0}),[l,u]=M.useState(!0),[h,m]=M.useState("creators"),[p,x]=M.useState(!1);M.useEffect(()=>{w(),b()},[h]);const w=async(R=!1)=>{try{u(!0);let U="upvotes";h==="creators"?U="flashcards":h==="streak"&&(U="streak");const z=`leaderboard_${U}`;if(!R){const G=sE.get(z);if(G&&Date.now()-G.timestamp<WM){console.log(" Using cached leaderboard data for:",U),t(G.data),x(!0),u(!1);return}}console.log(" Loading leaderboard using backend API for:",U);const B=await fetch(`https://us-central1-three-sided-flashcard-app.cloudfunctions.net/getLeaderboard?sort=${encodeURIComponent(U)}`);if(!B.ok)throw new Error(`HTTP error! status: ${B.status}`);const q=await B.json();if(console.log(" Leaderboard data loaded:",q),!q.leaderboard||!Array.isArray(q.leaderboard))throw new Error("Invalid leaderboard data format");sE.set(z,{data:q.leaderboard,timestamp:Date.now()}),t(q.leaderboard),x(!1),console.log(" Leaderboard loaded:",q.leaderboard.length,"entries")}catch(U){console.error(" Error loading leaderboard:",U),t([])}finally{u(!1)}},b=async()=>{try{const R=Fe(Ie(te,"profiles")),U=await Ke(R),z=Fe(Ie(te,"publicCards")),B=await Ke(z);let q=0;B.docs.forEach(G=>{const Q=G.data();q+=Q.viewCount||0}),a({totalUsers:U.size,totalCards:B.size,totalViews:q})}catch(R){console.error("Error loading community stats:",R)}},E=R=>R?R.split(" ").map(U=>U.charAt(0)).join("").toUpperCase().slice(0,2):"?",k=R=>{switch(R){case 0:return i.jsx(Or,{size:20,color:"white"});case 1:return i.jsx(Or,{size:20,color:"white"});case 2:return i.jsx(Or,{size:20,color:"white"});default:return`#${R+1}`}};return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl text-white shadow-lg",style:{background:"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)"},children:i.jsx(Or,{size:32,color:"white"})}),i.jsx("h1",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:"Community Leaderboard"})]}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Celebrating our top contributors and creators"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx(Xi,{size:32,color:"default",className:"mx-auto mb-2"}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:n.totalUsers.toLocaleString()}),i.jsx("div",{className:"claude-text-secondary",children:"Community Members"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx(Or,{size:32,color:"default",className:"mx-auto mb-2"}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:n.totalCards.toLocaleString()}),i.jsx("div",{className:"claude-text-secondary",children:"Total Flashcards"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx(ca,{size:32,color:"default",className:"mx-auto mb-2"}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:n.totalViews.toLocaleString()}),i.jsx("div",{className:"claude-text-secondary",children:"Total Views"})]})]}),i.jsx("div",{className:"claude-card p-2 mb-8",children:i.jsx("div",{className:"flex",children:[{id:"popular",label:"Most Upvoted",icon:"heart"},{id:"creators",label:"Top Creators",icon:"target"},{id:"streak",label:"Login Streak",icon:"fast"}].map(R=>i.jsxs("button",{onClick:()=>m(R.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200",style:{backgroundColor:h===R.id?"var(--claude-accent)":"transparent",color:h===R.id?"white":"var(--claude-secondary-text)"},onMouseEnter:U=>{h!==R.id&&(U.target.style.backgroundColor="var(--claude-surface-hover)",U.target.style.color="var(--claude-primary-text)")},onMouseLeave:U=>{h!==R.id&&(U.target.style.backgroundColor="transparent",U.target.style.color="var(--claude-secondary-text)")},children:[R.icon==="heart"?i.jsx(nu,{size:20,color:h===R.id?"white":"default"}):R.icon==="target"?i.jsx(il,{size:20,color:h===R.id?"white":"default"}):i.jsx(Xm,{size:20,color:h===R.id?"white":"default"}),R.label]},R.id))})}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",style:{color:"var(--claude-heading)"},children:h==="creators"?i.jsxs(i.Fragment,{children:[i.jsx(il,{size:24,color:"default"}),"Top Creators"]}):h==="popular"?i.jsxs(i.Fragment,{children:[i.jsx(nu,{size:24,color:"default"}),"Most Upvoted"]}):i.jsxs(i.Fragment,{children:[i.jsx(Xm,{size:24,color:"default"}),"Login Streak Champions"]})}),i.jsxs("div",{className:"flex items-center gap-3",children:[p&&i.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:" Cached"}),i.jsx("button",{onClick:()=>w(!0),className:"claude-button-primary",title:"Force refresh from server (bypasses cache)",children:"Refresh"})]})]}),l?i.jsx("div",{className:"space-y-4",children:Array.from({length:10}).map((R,U)=>i.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl animate-pulse",style:{backgroundColor:"var(--claude-subtle)"},children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),i.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]},U))}):e.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx(Or,{size:64,color:"default",className:"mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),i.jsx("p",{className:"claude-text-muted",children:"Be the first to create some flashcards!"})]}):i.jsx("div",{className:"space-y-3",children:e.map((R,U)=>i.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:scale-105",style:{backgroundColor:U<3?"rgba(255, 215, 0, 0.1)":"var(--claude-subtle)",border:`1px solid ${U<3?"rgba(255, 215, 0, 0.3)":"var(--claude-border)"}`},children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg",style:{background:U<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:U<3?"white":"var(--claude-background)"},children:k(U)}),i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:E(R.displayName)}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:R.displayName||"Anonymous"}),R.slug&&i.jsxs("a",{href:`/profile/${R.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",R.slug]})]}),i.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?`${R.flashcardCount||0} flashcards created`:h==="popular"?`${R.upvotesReceived||0} upvotes received`:`${R.loginStreak||0} day login streak`})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:U<3?"#B8860B":"var(--claude-accent-blue)"},children:h==="creators"?R.flashcardCount||0:h==="popular"?R.upvotesReceived||0:R.loginStreak||0}),i.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?"cards":h==="popular"?"upvotes":"day streak"})]})]},R.slug||R.id))})]}),s&&i.jsxs("div",{className:"mt-8 bg-slate-800/30 border border-slate-700 rounded-2xl p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Your Position"}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)"},children:E(s.displayName)}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-white",children:s.displayName}),i.jsx("div",{className:"text-slate-400 text-sm",children:"That's you!"})]})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-xl font-bold text-blue-400",children:["#",e.findIndex(R=>R.id===s.uid)+1||"Unranked"]}),i.jsx("div",{className:"text-slate-400 text-sm",children:"Position"})]})]})]})]})})},ZM=({onClose:s,refreshCallback:e})=>{const{user:t}=Sn(),[n,a]=M.useState([]),[l,u]=M.useState(!0),[h,m]=M.useState(""),[p,x]=M.useState(null),[w,b]=M.useState(null),[E,k]=M.useState({statement:"",hints:"",proof:"",subject:"",tags:""});M.useEffect(()=>{t&&R()},[t]);const R=async()=>{try{u(!0);const T=await is.getPublicFlashcardsByUser(t.uid);a(T),m("")}catch(T){console.error("Error loading public cards:",T),m("Failed to load your public flashcards")}finally{u(!1)}},U=T=>{x(T),k({statement:T.statement||"",hints:Array.isArray(T.hints)?T.hints.join(`
`):T.hints||"",proof:T.proof||"",subject:T.subject||"",tags:Array.isArray(T.tags)?T.tags.join(", "):""})},z=async()=>{if(p)try{const T=Ys.checkRateLimit(`edit_public_${t.uid}`,10,3e5);if(!T.allowed){m(T.message);return}const A=Ys.validateFlashcardInput(E);if(!A.isValid){m(A.errors[0]);return}await is.updatePublicFlashcard(p.id,A.sanitizedData,t.uid),x(null),m(""),await R(),e&&e()}catch(T){console.error("Error updating public card:",T);const A=Ys.getPublicErrorMessage(T,!0);m(A)}},B=async T=>{try{const A=Ys.checkRateLimit(`delete_public_${t.uid}`,5,3e5);if(!A.allowed){m(A.message);return}await is.deletePublicFlashcard(T,t.uid),b(null),m(""),await R(),e&&e()}catch(A){console.error("Error deleting public card:",A);const F=Ys.getPublicErrorMessage(A,!0);m(F)}},q=async T=>{try{const A=Ys.checkRateLimit(`toggle_public_${t.uid}`,10,3e5);if(!A.allowed){m(A.message);return}await is.toggleFlashcardPublic(T,t.uid,!1),m(""),await R(),e&&e()}catch(A){console.error("Error making card private:",A);const F=Ys.getPublicErrorMessage(A,!0);m(F)}},G=(T,A)=>{k(F=>({...F,[T]:A}))},Q=T=>T?(T.toDate?T.toDate():new Date(T)).toLocaleDateString():"Unknown",L=T=>`${window.location.origin}/card/${T.slug}`,P=T=>{const A=L(T);navigator.clipboard.writeText(A).then(()=>{alert("Card URL copied to clipboard!")})};return l?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsx("div",{className:"claude-card p-8 rounded-2xl shadow-2xl max-w-md",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading your public flashcards..."})]})})}):i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:" Manage Public Flashcards"}),i.jsx("button",{onClick:s,className:"claude-text-muted hover:text-gray-700 text-3xl transition-colors","aria-label":"Close manager",children:""})]}),h&&i.jsx("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-700 text-sm",children:h})}),i.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:n.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No Public Flashcards Yet"}),i.jsx("p",{className:"claude-text-secondary mb-4",children:"Create flashcards and make them public to share your knowledge with the world!"}),i.jsx("button",{onClick:s,className:"claude-button-primary",children:"Create Your First Public Card"})]}):i.jsx("div",{className:"space-y-4",children:n.map(T=>i.jsxs("div",{className:"claude-card p-6 rounded-xl border-l-4 border-l-blue-500",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-lg mb-2",style:{color:"var(--claude-heading)"},children:T.statement?.length>100?`${T.statement.slice(0,100)}...`:T.statement}),i.jsxs("div",{className:"flex gap-4 text-sm claude-text-secondary",children:[i.jsxs("span",{children:["Created: ",Q(T.createdAt)]}),i.jsxs("span",{children:[" ",T.likeCount||0," likes"]}),i.jsxs("span",{children:[" ",T.viewCount||0," views"]}),i.jsxs("span",{children:[" ",T.importCount||0," imports"]})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>P(T),className:"claude-button-secondary text-sm px-3 py-1",title:"Copy public URL",children:" Copy Link"}),i.jsx("button",{onClick:()=>U(T),className:"claude-button-secondary text-sm px-3 py-1",children:" Edit"}),i.jsx("button",{onClick:()=>q(T.id),className:"claude-button-secondary text-sm px-3 py-1 text-orange-600",title:"Make private (remove from public)",children:" Make Private"}),i.jsx("button",{onClick:()=>b(T.id),className:"claude-button-secondary text-sm px-3 py-1 text-red-600",children:" Delete"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Subject & Tags:"}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx("span",{className:"claude-tag",children:T.subject||"General"}),T.tags?.map((A,F)=>i.jsx("span",{className:"claude-tag",children:A},F))]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Public URL:"}),i.jsx("a",{href:L(T),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 text-xs break-all",children:L(T)})]})]})]},T.id))})}),p&&i.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Edit Public Flashcard"}),i.jsx("button",{onClick:()=>x(null),className:"claude-text-muted hover:text-gray-700 text-2xl",children:""})]}),i.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-140px)]",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Statement *"}),i.jsx("textarea",{value:E.statement,onChange:T=>G("statement",T.target.value),className:"claude-input w-full h-24 resize-none",placeholder:"Enter the main statement or question...",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Hints"}),i.jsx("textarea",{value:E.hints,onChange:T=>G("hints",T.target.value),className:"claude-input w-full h-20 resize-none",placeholder:"Helpful hints (optional)..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Proof/Answer *"}),i.jsx("textarea",{value:E.proof,onChange:T=>G("proof",T.target.value),className:"claude-input w-full h-32 resize-none",placeholder:"Enter the proof, solution, or answer...",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Subject"}),i.jsx("input",{type:"text",value:E.subject,onChange:T=>G("subject",T.target.value),className:"claude-input w-full",placeholder:"Mathematics, Physics, etc."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Tags"}),i.jsx("input",{type:"text",value:E.tags,onChange:T=>G("tags",T.target.value),className:"claude-input w-full",placeholder:"algebra, calculus, geometry (comma-separated)"})]})]})]})}),i.jsxs("div",{className:"px-6 py-4 border-t border-gray-300 flex justify-end gap-3",children:[i.jsx("button",{onClick:()=>x(null),className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{onClick:z,className:"claude-button-primary",disabled:!E.statement.trim()||!E.proof.trim(),children:"Save Changes"})]})]})}),w&&i.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:i.jsx("div",{className:"claude-card rounded-2xl shadow-2xl max-w-md w-full mx-4",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-bold mb-2 text-red-600",children:"Delete Public Flashcard?"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:"This will permanently delete this flashcard from the public collection. This action cannot be undone."}),i.jsxs("div",{className:"flex gap-3 justify-center",children:[i.jsx("button",{onClick:()=>b(null),className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{onClick:()=>B(w),className:"claude-button-secondary bg-red-100 text-red-800 hover:bg-red-200 border-red-300",children:"Delete Forever"})]})]})})})]})})},Ho=(...s)=>!1,Qx=s=>{if(!s)return null;if(typeof s?.toDate=="function")return s.toDate();const e=new Date(s);return Number.isNaN(e.getTime())?null:e},eO=(s,e=0)=>({id:s.id??`card-${e}`,subject:s.subject??"General",question:s.question??s.statement??"",answer:s.answer??s.proof??"",createdAt:Qx(s.createdAt)??new Date(0),...s}),rE=(s,e)=>typeof s=="string"?s.length>e?s.slice(0,e)+"":s:"",tO=()=>{const{user:s}=Sn(),[e,t]=M.useState(null),[n,a]=M.useState([]),[l,u]=M.useState([]),[h,m]=M.useState(!0),[p,x]=M.useState(!1),[w,b]=M.useState("overview"),[E,k]=M.useState(null),[R,U]=M.useState(!1),[z,B]=M.useState(!1),[q,G]=M.useState(null),[Q,L]=M.useState([]),[P,T]=M.useState(!1);M.useEffect(()=>{if(!s?.uid){t(null),a([]),u([]),m(!1);return}A()},[s?.uid]);const A=M.useCallback(async()=>{let $=!0;m(!0),b(ge=>ge);try{const ge=s.uid;Ho(" Loading user data for:",ge);const I=[ym.getUserProfile(ge),(async()=>{try{const Le=rs.userKey(ge,"allCards");return rs.getOrFetch(Le,async()=>{try{const wt=await is.getUserFlashcards(ge,100),{collection:Rt,query:Gt,where:st,orderBy:ce,limit:Ae,getDocs:Te}=await rn(async()=>{const{collection:Ge,query:$t,where:en,orderBy:Et,limit:Wn,getDocs:pt}=await Promise.resolve().then(()=>Mr);return{collection:Ge,query:$t,where:en,orderBy:Et,limit:Wn,getDocs:pt}},void 0),{db:$e}=await rn(async()=>{const{db:Ge}=await Promise.resolve().then(()=>la);return{db:Ge}},void 0),Qe=Gt(Rt($e,"flashcards"),st("userId","==",ge),ce("createdAt","desc"),Ae(100)),gt=(await Te(Qe)).docs.map(Ge=>({id:Ge.id,...Ge.data()}));return[...wt,...gt].sort((Ge,$t)=>{const en=Ge.createdAt?.toMillis?.()||Ge.createdAt?.getTime?.()||0;return($t.createdAt?.toMillis?.()||$t.createdAt?.getTime?.()||0)-en})}catch(wt){return Ho("Failed to load user cards:",wt),[]}},"userFlashcards")}catch(Le){return Ho("Failed to load user cards:",Le),[]}})(),(async()=>{try{const{collection:Le,query:wt,where:Rt,getDocs:Gt}=await rn(async()=>{const{collection:Te,query:$e,where:Qe,getDocs:Tt}=await Promise.resolve().then(()=>Mr);return{collection:Te,query:$e,where:Qe,getDocs:Tt}},void 0),{db:st}=await rn(async()=>{const{db:Te}=await Promise.resolve().then(()=>la);return{db:Te}},void 0),ce=wt(Le(st,"cards"),Rt("userId","==",ge),Rt("originalCardId","!=",null));return(await Gt(ce)).docs.map(Te=>({id:Te.id,...Te.data()}))}catch(Le){return Ho("Failed to load imported cards:",Le),[]}})()],[W,ve,de]=await Promise.allSettled(I);if(!$)return;const Ce=W.status==="fulfilled"?W.value:null,Ee=(ve.status==="fulfilled"?ve.value??[]:[]).map(eO),We=de.status==="fulfilled"?de.value??[]:[];Ho(" User profile:",Ce),Ho(" Private cards found:",Ee.length),Ho(" Imported cards found:",We.length),t(Ce),a(Ee),u(We)}catch(ge){console.error(" Error loading user data:",ge)}finally{$&&m(!1)}return()=>{$=!1}},[s?.uid]),F=async $=>{if(!confirm("Delete this card? This cannot be undone."))return;const ge=n;a(I=>I.filter(W=>W.id!==$));try{await is.deleteFlashcard($)}catch(I){console.error("Error deleting card:",I),a(ge)}},S=M.useCallback(async()=>{try{if(!s?.uid)return;const $=await hs.getUserDecks(s.uid,!0);L($)}catch($){console.error("Error loading user decks:",$)}},[s?.uid]);M.useEffect(()=>{S()},[S]);const V=$=>{G($),T(!0)},D=async $=>{if(q)try{await hs.addCardToDeck($,q.id),await is.updateCardDeck(q.id,$),T(!1),G(null),await A()}catch(ge){console.error("Error moving card to deck:",ge),alert("Failed to move card. Please try again.")}},ke=async()=>{x(!0),await A(),x(!1)},ne=M.useCallback($=>{k($),U(!0)},[]),O=M.useCallback(()=>{U(!1),k(null)},[]);su([E]);const ie=M.useMemo(()=>!n||n.length===0?0:new Set(n.map(ge=>ge.subject??"General")).size,[n]);return h?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[i.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-t-transparent rounded-full mx-auto mb-6",style:{borderColor:"var(--claude-accent)",borderTopColor:"transparent"}}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Loading Dashboard..."}),i.jsx("p",{className:"claude-text-secondary",children:"Fetching your data"})]})}):i.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:[i.jsx(Nn,{size:32,color:"primary"}),"Your Dashboard"]}),i.jsxs("p",{className:"claude-text-secondary text-lg",children:["Welcome back, ",s?.displayName||"Student","!"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"claude-card p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:i.jsx(Qa,{size:24,color:"primary"})}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Total"})]}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:n.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards Created"})]}),i.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:i.jsx(Ec,{size:24,color:"success"})}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Imported"})]}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:l.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported"})]}),i.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"p-3 bg-green-500/20 rounded-xl",children:i.jsx(Or,{size:24,color:"warning"})}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Streak"})]}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:e?.loginStreak||0}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]}),i.jsx("div",{role:"tablist","aria-label":"Dashboard sections",className:"flex claude-card rounded-2xl p-2 mb-8",children:[{id:"overview",label:"Overview",icon:"dashboard"},{id:"profile",label:"My Profile",icon:"user"},{id:"cards",label:"My Cards",icon:"cards"},{id:"public",label:"Public Cards",icon:"view"},{id:"imported",label:"Imported Cards",icon:"progress"}].map(($,ge)=>{const I=[{id:"overview",label:"Overview",icon:"dashboard"},{id:"profile",label:"My Profile",icon:"user"},{id:"cards",label:"My Cards",icon:"cards"},{id:"public",label:"Public Cards",icon:"view"},{id:"imported",label:"Imported Cards",icon:"progress"}],W=w===$.id;return i.jsxs("button",{role:"tab","aria-selected":W,"aria-controls":`${$.id}-panel`,id:`${$.id}-tab`,tabIndex:W?0:-1,onKeyDown:ve=>{ve.key==="ArrowRight"&&b(I[(ge+1)%I.length].id),ve.key==="ArrowLeft"&&b(I[(ge-1+I.length)%I.length].id)},onClick:()=>b($.id),className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 ${W?"text-white":"claude-text-secondary hover:text-gray-700 hover:bg-gray-100"}`,style:W?{background:"linear-gradient(135deg, #7E6B5A 0%, #6D5A4A 100%)"}:{},children:[$.icon==="dashboard"?i.jsx(Nn,{size:20,color:W?"primary":"default"}):$.icon==="user"?i.jsx(Xi,{size:20,color:W?"primary":"default"}):$.icon==="cards"?i.jsx(Qa,{size:20,color:W?"primary":"default"}):$.icon==="view"?i.jsx(ca,{size:20,color:W?"primary":"default"}):$.icon==="progress"?i.jsx(Ec,{size:20,color:W?"primary":"default"}):i.jsx("span",{children:$.icon}),$.label]},$.id)})}),w==="overview"&&i.jsxs("div",{role:"tabpanel",id:"overview-panel","aria-labelledby":"overview-tab",className:"space-y-8",children:[i.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Ec,{size:24,color:"success"}),"Recent Activity"]}),i.jsxs("div",{className:"space-y-4",children:[n.slice(0,5).map($=>i.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/30 rounded-xl",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:[$.question?.slice(0,60),"..."]}),i.jsxs("p",{className:"claude-text-muted text-sm",children:["Created ",new Date($.createdAt?.toDate?.()||$.createdAt).toLocaleDateString()]})]}),i.jsx("span",{className:"text-blue-400 text-sm",children:$.subject||"General"})]},$.id)),n.length===0&&i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-4xl mb-4",children:i.jsx(xr,{size:48,color:"default"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards yet"}),i.jsx("p",{className:"claude-text-muted",children:"Create your first flashcard to get started!"})]})]})]}),i.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Nn,{size:24,color:"default"}),"Quick Stats"]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:n.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Total Cards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:"#7E6B5A"},children:l.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported Cards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:ie}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Subjects"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:e?.loginStreak||0}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]})]})]}),w==="profile"&&i.jsxs("div",{role:"tabpanel",id:"profile-panel","aria-labelledby":"profile-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Xi,{size:24,color:"default"}),"My Profile"]}),e?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Display Name"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsx("span",{className:"claude-text-primary",children:e.displayName||"Not set"})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Profile URL"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsxs("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 transition-colors",children:["three-sided.com/profile/",e.slug]})})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Bio"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsx("span",{className:"claude-text-primary",children:e.bio||"No bio added yet"})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Institution"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsx("span",{className:"claude-text-primary",children:e.institution||"Not specified"})})]}),i.jsxs("div",{className:"flex gap-4 pt-4",children:[i.jsxs("button",{onClick:()=>{console.log("Edit profile")},className:"claude-button-primary",style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:[i.jsx(xr,{size:16,color:"white"}),"Edit Profile"]}),i.jsxs("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary",children:[i.jsx(ca,{size:16,color:"default"}),"View Public Profile"]})]})]}):i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"mb-4",children:i.jsx(Xi,{size:48,color:"default"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No profile yet"}),i.jsx("p",{className:"claude-text-muted mb-6",children:"Create a profile to share your flashcards publicly and connect with other students."}),i.jsx("button",{onClick:()=>{console.log("Create profile")},className:"claude-button-primary",style:{background:"linear-gradient(135deg, #B8A082 0%, #A68B5B 100%)"},children:"Create My Profile"})]})]}),w==="cards"&&i.jsxs("div",{role:"tabpanel",id:"cards-panel","aria-labelledby":"cards-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Qa,{size:24,color:"primary"}),"My Cards (",n.length,")"]}),i.jsx("button",{onClick:ke,disabled:p,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-60 rounded-lg transition-all duration-200",style:{color:"white"},children:p?"Refreshing":"Refresh"})]}),n.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(xr,{size:64,color:"default"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards found"}),i.jsx("p",{className:"claude-text-muted mb-6",children:"It looks like you haven't created any flashcards yet, or there might be a connection issue."}),i.jsxs("div",{className:"space-x-4",children:[i.jsx("a",{href:"#",onClick:$=>{$.preventDefault(),window.location.href="/#create"},className:"inline-block px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-xl transition-all duration-200",style:{color:"white"},children:"Create a Flashcard"}),i.jsx("button",{onClick:ke,disabled:p,className:"px-6 py-3 disabled:opacity-60 font-semibold rounded-xl transition-all duration-200",style:{background:"linear-gradient(135deg, #7E6B5A 0%, #6D5A4A 100%)",color:"white"},children:p?"Refreshing":"Try Loading Again"})]})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map($=>i.jsxs("div",{className:"group claude-card border hover:border-blue-500/50 rounded-2xl p-6 transition-all duration-300",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsx("span",{className:"text-sm text-blue-400 font-medium",children:$.subject||"General"}),i.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-200",children:[i.jsx("button",{onClick:()=>V($),className:"text-sm px-2 py-1 rounded transition-all duration-200",style:{color:"#7E6B5A",backgroundColor:"rgba(126, 107, 90, 0.1)"},onMouseEnter:ge=>{ge.target.style.backgroundColor="rgba(126, 107, 90, 0.2)",ge.target.style.color="#6D5A4A"},onMouseLeave:ge=>{ge.target.style.backgroundColor="rgba(126, 107, 90, 0.1)",ge.target.style.color="#7E6B5A"},title:"Move to deck",children:i.jsx(ei,{size:16,color:"current"})}),i.jsx("button",{onClick:()=>F($.id),className:"text-red-400 hover:text-red-300",title:"Delete card",children:i.jsx(T0,{size:16,color:"error"})})]})]}),i.jsx("h3",{className:"font-semibold mb-3 group-hover:text-blue-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:rE($.question,80)}),i.jsx("p",{className:"claude-text-secondary text-sm mb-4 leading-relaxed",children:rE($.answer,100)}),i.jsxs("div",{className:"flex justify-between items-center text-sm",children:[i.jsx("span",{className:"claude-text-muted",children:Qx($.createdAt)?.toLocaleDateString()??""}),i.jsx("div",{className:"flex gap-2",children:$.slug?i.jsx("a",{href:`/card/${$.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"View Public "}):i.jsxs("button",{onClick:()=>ne($),className:"text-blue-400 hover:text-blue-300 font-medium transition-colors cursor-pointer",children:[i.jsx(ca,{size:16,color:"primary"}),"Inspect"]})})]})]},$.id))})]}),w==="public"&&i.jsxs("div",{role:"tabpanel",id:"public-panel","aria-labelledby":"public-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(ca,{size:24,color:"primary"}),"Your Public Cards"]}),i.jsx("button",{onClick:()=>B(!0),className:"claude-button-primary",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:" Manage Public Cards"})]}),i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(ca,{size:64,color:"primary"})}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Public Flashcard Management"}),i.jsx("p",{className:"claude-text-muted mb-6",children:"View, edit, and manage all your public flashcards in one place. Control what the world sees and track engagement."}),i.jsx("button",{onClick:()=>B(!0),className:"claude-button-primary",style:{background:"linear-gradient(135deg, #7E6B5A 0%, #6D5A4A 100%)"},children:"Open Public Card Manager"})]})]}),w==="imported"&&i.jsxs("div",{role:"tabpanel",id:"imported-panel","aria-labelledby":"imported-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Ec,{size:24,color:"success"}),"Imported Cards (",l.length,")"]}),l.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(Qa,{size:64,color:"primary"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No imported cards yet"}),i.jsx("p",{className:"claude-text-muted",children:"Import useful cards from the public library!"})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map($=>i.jsxs("div",{className:"group claude-card border rounded-2xl p-6 transition-all duration-300",style:{"&:hover":{borderColor:"rgba(126, 107, 90, 0.5)"}},children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsx("span",{className:"text-sm font-medium",style:{color:"#7E6B5A"},children:$.subject||"General"}),i.jsx(Ec,{size:16,color:"success"})]}),i.jsx("h3",{className:"font-semibold mb-3 transition-colors",style:{color:"var(--claude-primary-text)"},children:$.question?.length>80?$.question.slice(0,80)+"...":$.question}),i.jsx("p",{className:"claude-text-secondary text-sm leading-relaxed",children:$.answer?.length>100?$.answer.slice(0,100)+"...":$.answer})]},$.id))})]})]}),R&&E&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[i.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Card Inspector"}),i.jsx("button",{onClick:O,className:"claude-text-muted hover:text-gray-700 text-2xl transition-colors","aria-label":"Close inspector",children:""})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:[i.jsxs("div",{className:"flex gap-4 mb-6",children:[i.jsx("span",{className:"claude-tag",children:E.subject||"General"}),i.jsxs("span",{className:"claude-text-muted text-sm",children:["Created: ",Qx(E.createdAt)?.toLocaleDateString()??"Unknown"]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:"#7E6B5A"},children:"Statement"}),i.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:E.statement||E.question||"No statement available"})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-3",children:"Hints"}),i.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:Array.isArray(E.hints)?E.hints.join(`
`):E.hints||E.hint||"No hints available"})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-green-400 mb-3",children:"Proof"}),i.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:E.proof||E.answer||"No proof available"})]}),E.tags&&E.tags.length>0&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-orange-400 mb-3",children:"Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:E.tags.map(($,ge)=>i.jsx("span",{className:"claude-tag",children:$},ge))})]}),i.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-300",children:[i.jsx("button",{onClick:()=>{console.log("Edit card:",E.id)},className:"claude-button-secondary",children:" Edit Card"}),i.jsx("button",{onClick:async()=>{await F(E.id),O()},className:"claude-button-danger",children:" Delete Card"}),i.jsx("button",{onClick:O,className:"claude-button-primary ml-auto",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:" Close"})]})]})]})}),z&&i.jsx(ZM,{onClose:()=>B(!1),refreshCallback:A}),P&&q&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"claude-card max-w-md w-full mx-4 p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Move Card to Deck"}),i.jsx("button",{onClick:()=>T(!1),className:"transition-colors",style:{color:"var(--claude-text-muted)"},onMouseEnter:$=>$.target.style.color="var(--claude-primary-text)",onMouseLeave:$=>$.target.style.color="var(--claude-text-muted)",children:""})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"claude-text-secondary mb-2",children:"Moving card:"}),i.jsx("p",{className:"font-medium truncate",style:{color:"var(--claude-primary-text)"},children:q.statement||q.question||"Untitled Card"})]}),i.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[Q.map($=>i.jsx("button",{onClick:()=>D($.id),className:"w-full text-left p-3 rounded-lg border border-gray-600 transition-all duration-200",style:{"&:hover":{borderColor:"#7E6B5A",backgroundColor:"rgba(126, 107, 90, 0.1)"}},onMouseEnter:ge=>{ge.target.style.borderColor="#7E6B5A",ge.target.style.backgroundColor="rgba(126, 107, 90, 0.1)"},onMouseLeave:ge=>{ge.target.style.borderColor="#4a5568",ge.target.style.backgroundColor="transparent"},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:$.icon||i.jsx(ei,{size:24,color:"default"})}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:$.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[$.cardCount||0," cards  ",$.subject||"General"]})]})]})},$.id)),Q.length===0&&i.jsxs("div",{className:"text-center py-8",children:[i.jsx("p",{className:"claude-text-secondary",children:"No decks available"}),i.jsx("p",{className:"text-sm claude-text-muted mt-2",children:"Create a deck first to organize your cards"})]})]}),i.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:i.jsx("button",{onClick:()=>T(!1),className:"claude-button-secondary flex-1",children:"Cancel"})})]})})]})},nO="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20d='M20%2012l-8-8H4v8l8%208%208-8z'/%3e%3ccircle%20cx='7.5'%20cy='7.5'%20r='1.5'/%3e%3c/svg%3e",bc=s=>s.trim().toLowerCase().replace(/[\s_]+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,40),sO=(s,e=200)=>{const[t,n]=M.useState(s);return M.useEffect(()=>{const a=setTimeout(()=>n(s),e);return()=>clearTimeout(a)},[s,e]),t},rO=({selectedTags:s=[],onTagsChange:e,onClose:t,isVisible:n=!1,maxSelected:a})=>{const[l,u]=M.useState([]),[h,m]=M.useState(""),[p,x]=M.useState(!0),[w,b]=M.useState(""),[E,k]=M.useState(""),R=M.useRef(null),U=sO(E,150);M.useEffect(()=>{if(!n)return;const T=document.body.style.overflow;document.body.style.overflow="hidden",setTimeout(()=>R.current?.focus(),0);const A=F=>{F.key==="Escape"&&t?.()};return window.addEventListener("keydown",A),()=>{document.body.style.overflow=T,window.removeEventListener("keydown",A)}},[n,t]),M.useEffect(()=>{if(!n)return;let T=!0;return(async()=>{x(!0),b("");try{const A=await is.getPopularTags(100);if(!T)return;const F=Array.from(new Set((A||[]).map(S=>bc(String(S||""))).filter(Boolean))).sort((S,V)=>S.localeCompare(V));u(F.length?F:z())}catch(A){if(console.error("Error loading tags:",A),!T)return;u(z()),b("Could not load popular tags. Showing common tags.")}finally{T&&x(!1)}})(),()=>{T=!1}},[n]);const z=()=>["calculus","algebra","geometry","trigonometry","statistics","physics","chemistry","biology","computer-science","mathematics","linear-algebra","differential-equations","real-analysis","abstract-algebra","topology","number-theory","combinatorics","probability","optimization"],B=M.useMemo(()=>Array.from(new Set(s.map(T=>bc(T)).filter(Boolean))),[s]),q=T=>typeof a=="number"?T<=a:!0,G=M.useCallback(T=>{const A=bc(T),S=B.includes(A)?B.filter(V=>V!==A):[...B,A];q(S.length)&&e?.(S)},[B,e,a]),Q=M.useCallback(()=>{const T=bc(h);if(T){if(!l.includes(T)){const A=[...l,T].sort((F,S)=>F.localeCompare(S));u(A)}if(!B.includes(T)){const A=[...B,T];q(A.length)&&e?.(A)}m("")}},[h,l,B,e,a]),L=M.useCallback(T=>{const A=bc(T),F=B.filter(S=>S!==A);e?.(F)},[B,e]),P=M.useMemo(()=>{const T=U.trim().toLowerCase();return T?l.filter(A=>A.includes(T)):l},[l,U]);return n?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:i.jsxs("div",{ref:R,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"tags-title",className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden outline-none",children:[i.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:nO,alt:"Tags",className:"w-6 h-6"}),i.jsx("h2",{id:"tags-title",className:"text-2xl font-bold",children:" Tag Management"})]}),i.jsx("button",{onClick:t,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Organize your flashcards with tags"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:[w&&i.jsx("div",{className:"mb-4 p-3 rounded-lg border border-yellow-200 bg-yellow-50 text-yellow-900",children:w}),B.length>0&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Selected Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(T=>i.jsxs("span",{className:"inline-flex items-center gap-2 bg-primary-100 text-primary-800 px-3 py-2 rounded-full text-sm font-medium",children:["#",T,i.jsx("button",{onClick:()=>L(T),className:"text-primary-600 hover:text-primary-800 transition-colors","aria-label":`Remove tag ${T}`,children:""})]},T))})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Add Custom Tag"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"text",value:h,onChange:T=>m(T.target.value),placeholder:"Enter new tag (e.g., linear-algebra)",className:"input flex-1",onKeyDown:T=>T.key==="Enter"&&Q(),"aria-label":"New tag"}),i.jsx("button",{onClick:Q,className:"btn btn-primary whitespace-nowrap",disabled:!bc(h),children:"Add Tag"})]}),!!a&&i.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[B.length,"/",a," selected"]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Browse Tags"}),i.jsx("input",{type:"text",value:E,onChange:T=>k(T.target.value),placeholder:"Search tags",className:"input","aria-label":"Search tags"})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:["Available Tags (",P.length,")"]}),p?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-neutral-600",children:"Loading tags"})]}):P.length===0?i.jsxs("div",{className:"text-center py-8 text-neutral-600",children:['No tags found matching "',U,'"']}):i.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-4",children:P.map(T=>{const A=B.includes(T),F=!A&&a&&B.length>=a;return i.jsxs("button",{onClick:()=>G(T),disabled:F,className:`p-3 rounded-lg text-sm font-medium transition-all duration-200 text-left
                        ${A?"bg-primary-100 text-primary-800 border-2 border-primary-300":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200 border-2 border-transparent"}
                        ${F?"opacity-50 cursor-not-allowed":""}`,"aria-pressed":A,"aria-label":`Tag ${T}`,title:F?"Maximum selected":`#${T}`,children:["#",T]},T)})})]})]}),i.jsx("div",{className:"bg-neutral-50 px-6 py-4 border-t border-neutral-200",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-sm text-neutral-600",children:[B.length," tag",B.length!==1?"s":""," selected",a?`  max ${a}`:""]}),i.jsx("button",{onClick:t,className:"btn btn-primary",children:"Done"})]})})]})}):null},aO=1.3;function iO(s,e,t){const n={repetition:s.repetition??0,interval:s.interval??0,easeFactor:s.easeFactor??2.5};let{repetition:a,interval:l,easeFactor:u}=n;if(e<3)a=0,l=1;else{a===0?l=1:a===1?l=6:l=Math.round(l*u),a+=1;const p=.1-(5-e)*(.08+(5-e)*.02);u=Math.max(aO,parseFloat((u+p).toFixed(2)))}const h=new Date(t+l*24*60*60*1e3);return{next:{...s,repetition:a,interval:l,easeFactor:u,reviewCount:(s.reviewCount??0)+1,lastReviewed:new Date(t),nextReview:h}}}const oO=({onClose:s,isVisible:e=!1})=>{const{user:t}=Sn(),[n,a]=M.useState([]),[l,u]=M.useState(0),[h,m]=M.useState(!1),[p,x]=M.useState(!0),[w,b]=M.useState({total:0,due:0,new:0,learning:0,reviewing:0}),[E,k]=M.useState(null),[R,U]=M.useState(null),z=M.useRef(!0);M.useEffect(()=>(z.current=!0,e&&Q(),()=>{z.current=!1}),[e]),M.useEffect(()=>{t&&n.length>0&&!E&&e&&B()},[t,n.length,E,e]),M.useEffect(()=>{n[l]&&U(Date.now())},[l]),M.useEffect(()=>()=>{E&&q()},[E]),M.useEffect(()=>{if(!e)return;const V=D=>{if(D.key==="Escape")return s?.();if(n.length){if(!h&&(D.key===" "||D.key==="Enter")){D.preventDefault(),m(!0);return}h&&"12345".includes(D.key)&&(D.preventDefault(),P(parseInt(D.key,10))),D.key.toLowerCase()==="r"&&T()}};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[e,n.length,h]),M.useEffect(()=>{if(!e)return;const V=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=V}},[e]);const B=async()=>{if(t)try{const V=await Ya.startStudySession(t.uid,{mode:"spaced_repetition",deckId:null,deckName:"Spaced Repetition"});k(V),console.log("Spaced repetition session started:",V.sessionId)}catch(V){console.error("Failed to start spaced repetition session:",V)}},q=async()=>{if(!(!E||!t))try{const V=await Ya.endStudySession(E.sessionId,t.uid);console.log("Spaced repetition session ended:",V),k(null)}catch(V){console.warn("Analytics not available for session end:",V),k(null)}},G=async(V,D)=>{if(!E||!t||!R)return;const ke=Math.round((Date.now()-R)/1e3),ne=V>=3;try{await Ya.recordCardAnswer(E.sessionId,{cardId:D.id,userId:t.uid,timeSpent:ke,wasCorrect:ne,attempts:1,difficulty:"medium",confidenceLevel:V})}catch(O){console.warn("Analytics not available for card answer:",O)}},Q=async()=>{try{x(!0);const V=await is.getPublicFlashcards(50);if(!z.current)return;const D=Date.now(),ne=V.map((O,ie)=>({...O,id:O.id||`card-${ie}`,repetition:O.repetition??0,interval:O.interval??0,easeFactor:O.easeFactor??2.5,reviewCount:O.reviewCount??0,nextReview:O.nextReview?new Date(O.nextReview):new Date(D),difficulty:O.difficulty??3,lastReviewed:O.lastReviewed?new Date(O.lastReviewed):null,question:O.statement??O.question??"",answer:O.proof??O.answer??"",hints:Array.isArray(O.hints)?O.hints:O.hints?[O.hints]:[]})).sort((O,ie)=>O.nextReview-ie.nextReview);if(!z.current)return;a(ne),L(ne)}catch(V){console.error("Error loading cards:",V),z.current&&a([])}finally{z.current&&x(!1)}},L=V=>{const D=Date.now(),ke=V.length,ne=V.filter($=>($.nextReview?.getTime?.()??$.nextReview)<=D).length,O=$=>$.reviewCount??0,ie={total:ke,due:ne,new:V.filter($=>O($)===0).length,learning:V.filter($=>O($)>0&&O($)<5).length,reviewing:V.filter($=>O($)>=5).length};b(ie)},P=async V=>{const D=Date.now(),ke=n[l];ke&&await G(V,ke),a(ne=>{if(!ne.length)return ne;const O=ne[l];if(!O)return ne;const{next:ie}=iO(O,V,D),$=[...ne];$[l]=ie;const ge=[...$].sort((I,W)=>I.nextReview-W.nextReview);return L(ge),ge}),u(ne=>Math.min(ne+1,n.length-1)),m(!1)},T=()=>{u(0),m(!1)},A=()=>n[l]||null,F=A();su([F,h]);const S=()=>[{value:1,label:"Again",color:"bg-danger-500 hover:bg-danger-600"},{value:2,label:"Hard",color:"bg-warning-500 hover:bg-warning-600"},{value:3,label:"Good",color:"bg-success-500 hover:bg-success-600"},{value:4,label:"Easy",color:"bg-primary-500 hover:bg-primary-600"},{value:5,label:"Perfect",color:"bg-accent-500 hover:bg-accent-600"}];return e?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:i.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"sr-title",className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",tabIndex:-1,children:[i.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"sr-title",className:"text-2xl font-bold",children:" Spaced Repetition"}),i.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close spaced repetition",title:"Close (Esc)",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Intelligent study scheduling for optimal learning"})]}),i.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:p?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-neutral-600 text-lg",children:"Loading your study session..."})]}):n.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"No cards available"}),i.jsx("p",{className:"text-neutral-600",children:"Create some flashcards to start studying!"})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-primary-600",children:w.total}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Total"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-danger-600",children:w.due}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Due"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-accent-600",children:w.new}),i.jsx("div",{className:"text-sm text-neutral-600",children:"New"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-warning-600",children:w.learning}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Learning"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-success-600",children:w.reviewing}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Reviewing"})]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:["Card ",l+1," of ",n.length]}),i.jsxs("span",{className:"text-sm text-neutral-500",children:[Math.round((l+1)/n.length*100),"% complete"]})]}),i.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:i.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-secondary-500 h-2 rounded-full transition-all duration-300",style:{width:`${(l+1)/n.length*100}%`}})})]}),i.jsx("div",{className:"card p-8 mb-8",children:i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"flex justify-center gap-4 mb-6 text-sm text-neutral-600",children:[i.jsxs("span",{children:["Interval: ",A()?.interval||0," days"]}),i.jsxs("span",{children:["Reviews: ",A()?.reviewCount||0]}),i.jsxs("span",{children:["Ease: ",A()?.easeFactor?.toFixed(1)||"2.5"]})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Question"}),i.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:A()?.question||"Loading..."})]}),h&&i.jsxs("div",{className:"mb-8 animate-fade-in",children:[i.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Answer"}),i.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:A()?.answer||"No answer available"}),A()?.hints&&A().hints.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("h4",{className:"text-lg font-medium text-neutral-700 mb-2",children:"Hints"}),i.jsx("div",{className:"space-y-2",children:A().hints.map((V,D)=>i.jsxs("div",{className:"bg-accent-50 p-3 rounded-lg text-neutral-700",children:[" ",V]},D))})]})]}),h?i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-lg font-semibold text-neutral-800",children:"How well did you know this?"}),i.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:S().map(({value:V,label:D,color:ke})=>i.jsxs("button",{onClick:()=>P(V),className:`btn text-white px-6 py-3 ${ke}`,title:`${D} (${V})`,"aria-label":`Rate as ${D} (Press ${V})`,children:[V,". ",D]},V))})]}):i.jsx("button",{onClick:()=>m(!0),className:"btn btn-primary text-lg px-8 py-4",title:"Show Answer (Space or Enter)",children:"Show Answer"})]})}),i.jsxs("div",{className:"text-center mt-6 p-4 bg-gray-50 rounded-lg",children:[i.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:" Keyboard Shortcuts"}),i.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-2 gap-2",children:[i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Space"})," Show Answer"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"1-5"})," Rate Quality"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"R"})," Reset Session"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Esc"})," Close"]})]})]}),i.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[i.jsx("button",{onClick:T,className:"btn btn-secondary",title:"Reset Session (R)",children:" Reset Session"}),i.jsx("button",{onClick:s,className:"btn btn-primary",title:"Finish Session (Esc)",children:"Finish Session"})]})]})})]})}):null},lO=(s,e=200)=>{const[t,n]=M.useState(s);return M.useEffect(()=>{const a=setTimeout(()=>n(s),e);return()=>clearTimeout(a)},[s,e]),t},cO=({onClose:s,isVisible:e=!1})=>{const[t,n]=M.useState(""),[a,l]=M.useState(""),[u,h]=M.useState(!1),[m,p]=M.useState(!1),[x,w]=M.useState(""),b=M.useRef(null),E=M.useRef(null),[k]=M.useState(["A direct sum B","The integral from 0 to infinity of x squared dx","The limit as x approaches 0 of sin x over x","The matrix with rows [1,2] and [3,4]","The set of all real numbers x such that x is greater than 0","The derivative of f with respect to x","The sum from n equals 1 to infinity of 1 over n squared","The product from i equals 1 to n of i","The square root of a squared plus b squared","The absolute value of x minus 3"]),R=lO(a,150);M.useEffect(()=>{e&&setTimeout(()=>b.current?.focus(),0)},[e]),M.useEffect(()=>{if(!e)return;const Q=L=>{L.key==="Escape"&&s?.()};return window.addEventListener("keydown",Q),()=>window.removeEventListener("keydown",Q)},[e,s]),su([R],E.current);const U=M.useCallback(async()=>{if(!(!t.trim()||u)){h(!0),w(""),p(!1);try{const Q=await xm.convertToLaTeX(t);l(Q||"")}catch(Q){console.error("Error converting to LaTeX:",Q),w("Could not convert to LaTeX. Please try again.")}finally{h(!1)}}},[t,u]),z=async Q=>{n(Q),setTimeout(()=>{U()},0)},B=async()=>{if(a)try{await navigator.clipboard.writeText(a),p(!0),setTimeout(()=>p(!1),1500)}catch(Q){console.error("Failed to copy:",Q),p(!1)}},q=()=>{n(""),l(""),p(!1),w(""),h(!1)},G=Q=>{(Q.ctrlKey||Q.metaKey)&&Q.key==="Enter"&&(Q.preventDefault(),U())};return e?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},role:"dialog","aria-modal":"true","aria-labelledby":"latex-converter-title",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"latex-converter-title",className:"text-2xl font-bold",children:" LaTeX Converter"}),i.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Convert natural language to beautiful mathematical notation"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Input"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{htmlFor:"nl-input",className:"block text-sm font-medium claude-text-secondary mb-2",children:"Natural Language Description"}),i.jsx("textarea",{id:"nl-input",ref:b,value:t,onChange:Q=>n(Q.target.value),placeholder:"e.g., A direct sum B, The integral from 0 to infinity of x squared dx...",className:"claude-input h-32",onKeyDown:G}),i.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Press Ctrl/ + Enter to convert"})]}),i.jsx("button",{onClick:U,disabled:!t.trim()||u,className:"claude-button-primary w-full mb-4 disabled:opacity-60",children:u?i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Converting..."]}):" Convert to LaTeX"}),x&&i.jsxs("div",{className:"claude-alert claude-alert-error mb-4",children:[x," ",i.jsx("button",{className:"underline ml-1 font-medium",onClick:U,disabled:u,children:"Retry"})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-medium claude-text-secondary mb-3",children:"Quick Examples"}),i.jsx("div",{className:"space-y-2",children:k.map((Q,L)=>i.jsx("button",{onClick:()=>z(Q),className:"claude-card block w-full text-left p-3 text-sm claude-text-secondary transition-all hover:shadow-md","aria-label":`Use example: ${Q}`,children:Q},L))})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Output"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{htmlFor:"latex-output",className:"block text-sm font-medium claude-text-secondary mb-2",children:"LaTeX Code"}),i.jsxs("div",{className:"relative",children:[i.jsx("textarea",{id:"latex-output",value:a,readOnly:!0,placeholder:"LaTeX will appear here...",className:"claude-input h-32 font-mono",style:{backgroundColor:"var(--background-modal)"}}),i.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[a&&i.jsx("button",{onClick:B,className:"claude-button-secondary p-2",title:"Copy to clipboard","aria-label":"Copy LaTeX to clipboard",children:""}),m&&i.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},role:"status","aria-live":"polite",children:"Copied!"})]})]})]}),a&&i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Preview"}),i.jsxs("div",{className:"claude-card p-4 min-h-[100px]",style:{border:"2px dashed var(--border-light)"},children:[i.jsx("div",{ref:E,className:"prose max-w-none",children:R}),!window.MathJax&&i.jsx("div",{className:"text-center mt-2 claude-text-muted text-xs",children:"(MathJax not loaded  preview shows raw TeX)"})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("button",{onClick:q,disabled:!t&&!a&&!x,className:"claude-button-secondary w-full disabled:opacity-60",children:" Clear All"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm claude-text-secondary",children:" Tip: Use this tool to quickly convert mathematical expressions"}),i.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Perfect for creating flashcards with LaTeX support"})]})]})]})]}),i.jsxs("div",{className:"mt-8 p-4 rounded-xl",style:{background:"linear-gradient(to right, var(--background-modal), rgba(68, 90, 255, 0.05))"},children:[i.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--heading)"},children:"How to use LaTeX in Three-Sided:"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm claude-text-secondary",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Inline math:"})," Wrap with ",i.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$ $"}),i.jsx("br",{}),i.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",i.jsx("code",{children:"$x^2 + y^2 = z^2$"})]})]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Block math:"})," Wrap with ",i.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$$ $$"}),i.jsx("br",{}),i.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",i.jsxs("code",{children:["$$\\int_0^\\infty e^","{-x}"," \\, dx = 1$$"]})]})]})]})]})]})]})}):null};class nx{static async createCheckoutSession(){try{const e=await js.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to create checkout session")}return(await t.json()).id}catch(e){throw console.error("Error creating checkout session:",e),e}}static async createPortalLink(){try{const e=await js.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createPortalLink",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to create portal link")}return(await t.json()).url}catch(e){throw console.error("Error creating portal link:",e),e}}static async redirectToCheckout(e){const t=window.Stripe?window.Stripe("pk_live_51RUu9KE3qmOAkttRGqw7Cr2wJ6qRHtCz9qXpHJHO0Bv4Q7gGHg5QXI9GFdXGh4IhQD5Xf9XUvLFCr9G2PHK0003w0Q"):null;if(!t)throw new Error("Stripe.js not loaded. Please include the Stripe script in your HTML.");const{error:n}=await t.redirectToCheckout({sessionId:e});if(n)throw new Error(n.message)}}const La={monthly:{label:"Monthly",displayPrice:"5",period:"month",savings:null,popular:!1,priceId:"price_1RUvcJE3qmOAkttR2Rh4YzOY",interval:"month"},yearly:{label:"Yearly",displayPrice:"50",period:"year",savings:"10",popular:!0,priceId:"price_YEARLY_REPLACE_ME",interval:"year"}},uO=[{name:"Spaced Repetition Mode",description:"Advanced algorithm for optimal learning",free:"",premium:"",icon:""},{name:"AI Autofill (Hint, Proof, Tags)",description:"Generate content with AI assistance",free:" Limited (1/day)",premium:" Unlimited",icon:""},{name:"AI Auto-Tagging",description:"Automatic tag suggestions",free:" Limited (1/day)",premium:" Unlimited",icon:""},{name:"AI LaTeX Conversion",description:"Convert text to mathematical notation",free:" Unlimited",premium:" Unlimited",icon:""},{name:"Public Profile & Sharing",description:"Share your flashcards with the community",free:"",premium:" + Custom Themes",icon:""},{name:"Advanced Analytics",description:"Detailed learning progress tracking",free:"",premium:"",icon:""},{name:"Priority Support",description:"Get help when you need it most",free:"",premium:"",icon:""},{name:"Export & Backup",description:"Download your data anytime",free:"",premium:"",icon:""}],dO=({onClose:s,isVisible:e=!1})=>{const[t,n]=M.useState("monthly"),[a,l]=M.useState(!1),[u,h]=M.useState(!1),[m,p]=M.useState(""),x=M.useRef(null);M.useEffect(()=>{if(e){const E=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=E}}},[e]),M.useEffect(()=>{if(!e)return;setTimeout(()=>x.current?.focus(),0);const E=k=>{k.key==="Escape"&&s?.()};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[e,s]);const w=M.useCallback(async()=>{p("");try{l(!0);const E=await nx.createCheckoutSession();await nx.redirectToCheckout(E)}catch(E){console.error("Error creating subscription:",E),p("Failed to start subscription. Please check your connection and try again.")}finally{l(!1)}},[t]),b=M.useCallback(async()=>{p("");try{h(!0);const E=await nx.createPortalLink();window.location.href=E}catch(E){console.error("Error accessing subscription management:",E),p("Failed to open the billing portal. Please try again.")}finally{h(!1)}},[]);return e?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:i.jsxs("div",{ref:x,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"premium-title",className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden outline-none",children:[i.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"premium-title",className:"text-2xl font-bold",children:" Premium Features"}),i.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Unlock the full potential of Three-Sided"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[m&&i.jsx("div",{className:"claude-alert claude-alert-error mb-4",children:m}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Choose Your Plan"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto",role:"radiogroup","aria-label":"Billing plan",children:[i.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 ${t==="monthly"?"claude-card-elevated":""}`,style:{border:t==="monthly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="monthly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[i.jsx("input",{type:"radio",name:"plan",value:"monthly",className:"sr-only",checked:t==="monthly",onChange:()=>n("monthly"),"aria-label":"Monthly plan"}),i.jsxs("div",{className:"text-center",children:[i.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:La.monthly.label}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:La.monthly.displayPrice}),i.jsxs("div",{className:"claude-text-secondary mb-4",children:["per ",La.monthly.period]}),i.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto border-2",style:{backgroundColor:t==="monthly"?"var(--accent-primary)":"transparent",borderColor:t==="monthly"?"var(--accent-primary)":"var(--border-light)"}})]})]}),i.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 relative ${t==="yearly"?"claude-card-elevated":""}`,style:{border:t==="yearly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="yearly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[i.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:i.jsx("span",{className:"text-white px-3 py-1 rounded-full text-xs font-bold",style:{backgroundColor:"var(--accent-secondary)"},children:"MOST POPULAR"})}),i.jsx("input",{type:"radio",name:"plan",value:"yearly",className:"sr-only",checked:t==="yearly",onChange:()=>n("yearly"),"aria-label":"Yearly plan"}),i.jsxs("div",{className:"text-center",children:[i.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:La.yearly.label}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:La.yearly.displayPrice}),i.jsxs("div",{className:"claude-text-secondary mb-2",children:["per ",La.yearly.period]}),i.jsxs("div",{className:"font-bold mb-4",style:{color:"var(--success)"},children:["Save ",La.yearly.savings,"!"]}),i.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto",style:{backgroundColor:t==="yearly"?"var(--accent-primary)":"transparent",borderColor:t==="yearly"?"var(--accent-primary)":"var(--border-light)"}})]})]})]})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Feature Comparison"}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{children:i.jsxs("tr",{style:{borderBottom:"2px solid var(--border-light)"},children:[i.jsx("th",{className:"text-left p-4 font-semibold",style:{color:"var(--heading)"},children:"Feature"}),i.jsx("th",{className:"text-center p-4 font-semibold",style:{color:"var(--heading)"},children:"Free"}),i.jsx("th",{className:"text-center p-4 font-semibold rounded-lg",style:{color:"var(--heading)",background:"linear-gradient(to right, rgba(99, 91, 255, 0.1), rgba(68, 90, 255, 0.1))"},children:"Premium"})]})}),i.jsx("tbody",{children:uO.map((E,k)=>i.jsxs("tr",{className:"claude-card hover:shadow-sm transition-all",style:{border:"none",marginBottom:"4px"},children:[i.jsx("td",{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:E.icon}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--heading)"},children:E.name}),i.jsx("div",{className:"text-sm claude-text-secondary",children:E.description})]})]})}),i.jsx("td",{className:"p-4 text-center",children:i.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:E.free===""?"rgba(91, 200, 162, 0.1)":E.free.startsWith("")?"rgba(255, 213, 84, 0.1)":"var(--background-modal)",color:E.free===""?"var(--success)":E.free.startsWith("")?"var(--warning)":"var(--text-secondary)"},children:E.free})}),i.jsx("td",{className:"p-4 text-center",style:{background:"linear-gradient(to right, rgba(99, 91, 255, 0.05), rgba(68, 90, 255, 0.05))"},children:i.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:E.premium})})]},k))})]})})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Why Go Premium?"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Accelerate Learning"}),i.jsx("p",{className:"claude-text-secondary",children:"Unlimited AI assistance helps you create better flashcards faster"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Track Progress"}),i.jsx("p",{className:"claude-text-secondary",children:"Advanced analytics show your learning journey and improvement"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Study Smarter"}),i.jsx("p",{className:"claude-text-secondary",children:"Spaced repetition algorithm optimizes your study schedule"})]})]})]}),i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("button",{onClick:w,disabled:a,className:"claude-button-primary text-lg px-12 py-4 disabled:opacity-60 disabled:cursor-not-allowed",style:{boxShadow:"0 0 20px rgba(99, 91, 255, 0.3)"},children:a?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):`Go Premium - ${La[t].displayPrice}/${La[t].period}`}),i.jsxs("div",{className:"flex justify-center gap-4",children:[i.jsx("button",{onClick:b,disabled:u,className:"claude-button-secondary disabled:opacity-60 disabled:cursor-not-allowed",children:u?"Opening":"Manage Subscription"}),i.jsx("button",{onClick:s,className:"claude-button-secondary",children:"Maybe Later"})]})]}),i.jsx("div",{className:"mt-8 p-4 rounded-xl text-center",style:{backgroundColor:"var(--background-modal)"},children:i.jsx("p",{className:"text-sm claude-text-secondary",children:" Secure payment powered by Stripe  Cancel anytime  30-day money-back guarantee"})})]})]})}):null},hO=({onProfileCreated:s,onClose:e})=>{const{user:t}=Sn(),[n,a]=M.useState({displayName:"",bio:"",institution:""}),[l,u]=M.useState(""),[h,m]=M.useState({state:"idle",message:""}),[p,x]=M.useState(!1),[w,b]=M.useState(null),E={displayName:50,bio:1e3,institution:100},k=M.useCallback(async q=>{const G=Rs.slugify(q);if(u(G),!G){m({state:"idle",message:""});return}m({state:"checking",message:"Checking availability..."});try{const Q=await Rs.isSlugTaken(G);m(Q?{state:"taken",message:` ${G} is already taken`}:{state:"available",message:` ${G} is available!`})}catch{m({state:"error",message:" Error checking availability. Please try again."})}},[]),R=q=>{a(Q=>({...Q,displayName:q})),w&&clearTimeout(w);const G=setTimeout(()=>{k(q)},400);b(G)},U=async q=>{if(q.preventDefault(),!t){alert("You must be logged in to create a profile.");return}if(n.displayName.length<2||n.displayName.length>E.displayName){alert(`Display name must be between 2 and ${E.displayName} characters.`);return}if(n.bio.length>E.bio){alert(`Bio must be ${E.bio} characters or less.`);return}if(n.institution.length>E.institution){alert(`Institution must be ${E.institution} characters or less.`);return}if(!l||h.state!=="available"){alert("Please wait for slug availability check or choose a different name.");return}x(!0);try{if(await Rs.isSlugTaken(l)){alert(`Username "${l}" was just taken. Please choose another name.`),await k(n.displayName);return}await Rs.createProfile(t.uid,l,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim(),email:t.email}),s&&s()}catch(G){console.error("Error creating profile:",G),alert("Something went wrong. Please try again.")}finally{x(!1)}},z=({current:q,max:G,label:Q})=>{const L=q/G*100;let P="text-sm ";return L>90?P+="text-red-500":L>70?P+="text-yellow-500":P+="text-gray-500",i.jsxs("div",{className:P,children:[q,"/",G," ",Q]})};M.useEffect(()=>()=>{w&&clearTimeout(w)},[w]);const B=n.displayName.length>=2&&n.displayName.length<=E.displayName&&n.bio.length<=E.bio&&n.institution.length<=E.institution&&h.state==="available";return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Create Your Profile"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Set up your public profile to connect with others"})]}),i.jsx("div",{className:"claude-card p-8",children:i.jsxs("form",{onSubmit:U,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),i.jsx("input",{type:"text",value:n.displayName,onChange:q=>R(q.target.value),placeholder:"Enter your display name",maxLength:E.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:q=>{q.target.style.borderColor="var(--claude-accent)",q.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:q=>{q.target.style.borderColor="var(--claude-border)",q.target.style.boxShadow="none"}}),i.jsx("div",{className:"flex justify-between items-center mt-2",children:i.jsx(z,{current:n.displayName.length,max:E.displayName,label:"characters"})}),i.jsxs("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[i.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your profile URL: ",i.jsxs("strong",{children:["three-sided.app/profile/",i.jsx("span",{className:"font-mono",children:l||"..."})]})]}),h.message&&i.jsxs("div",{className:`text-sm mt-1 ${h.state==="checking"?"text-blue-500":h.state==="available"?"text-green-500":(h.state==="taken","text-red-500")}`,children:[h.state==="checking"&&i.jsxs("span",{className:"inline-flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),h.message]}),h.state!=="checking"&&h.message]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Short Bio"}),i.jsx("textarea",{value:n.bio,onChange:q=>a(G=>({...G,bio:q.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:E.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:q=>{q.target.style.borderColor="var(--claude-accent)",q.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:q=>{q.target.style.borderColor="var(--claude-border)",q.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),i.jsx(z,{current:n.bio.length,max:E.bio,label:"characters"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),i.jsx("input",{type:"text",value:n.institution,onChange:q=>a(G=>({...G,institution:q.target.value})),placeholder:"University, company, or organization (optional)",maxLength:E.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:q=>{q.target.style.borderColor="var(--claude-accent)",q.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:q=>{q.target.style.borderColor="var(--claude-border)",q.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{}),i.jsx(z,{current:n.institution.length,max:E.institution,label:"characters"})]})]}),i.jsxs("div",{className:"flex gap-4 pt-4",children:[i.jsx("button",{type:"submit",disabled:!B||p,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:p?i.jsxs("span",{className:"flex items-center justify-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Profile..."]}):"Create Profile"}),e&&i.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 rounded-xl font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:q=>{q.target.style.backgroundColor="var(--claude-surface-hover)"},onMouseLeave:q=>{q.target.style.backgroundColor="var(--claude-subtle)"},children:"Cancel"})]})]})})]})})};class Tn{static async getFriendRequests(e){try{const t=Fe(Ie(te,"friendRequests"),Ye("to","==",e),an("timestamp","desc")),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data(),h=u.from,m=await Rs.getProfileByUserId(h);a.push({id:l.id,fromId:h,toId:u.to,timestamp:u.timestamp,senderProfile:m||{displayName:"Unknown User",slug:null}})}return a}catch(t){throw console.error("Error getting friend requests:",t),t}}static async sendFriendRequest(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs");const[n,a]=await Promise.all([this.checkExistingRequest(e,t),this.checkExistingRequest(t,e)]);if(n)throw new Error("Friend request already sent");if(a)throw new Error("This user has already sent you a friend request");if(await this.areFriends(e,t))throw new Error("You are already friends");const u=3;let h;for(let m=1;m<=u;m++)try{await Ws(Ie(te,"friendRequests"),{from:e,to:t,timestamp:Me(),status:"pending"}),console.log(" Friend request sent:",{fromId:e,toId:t});return}catch(p){h=p,m<u&&(console.warn(`Retry ${m}/${u} for friend request:`,p.message),await new Promise(x=>setTimeout(x,1e3*m)))}throw h}catch(n){throw console.error(" Error sending friend request:",n),n}}static async acceptFriendRequest(e,t,n){try{if(!e||!t||!n||t===n)throw new Error("Invalid parameters for accepting friend request");const a=await bt(be(te,"friendRequests",e));if(!a.exists())throw new Error("Friend request not found");const l=a.data();if(l.from!==t||l.to!==n)throw new Error("Friend request does not match the specified users");if(await this.areFriends(t,n)){await rl(be(te,"friendRequests",e)),console.log("Users were already friends, cleaned up request");return}const h=al(te),m=be(te,"userFriends",n,"friends",t),p=be(te,"userFriends",t,"friends",n),x={addedAt:Me(),requestAcceptedAt:Me(),status:"active"};h.set(m,x),h.set(p,x);const w=be(te,"friendRequests",e);h.delete(w);const b=3;let E;for(let k=1;k<=b;k++)try{await h.commit(),console.log(" Friend request accepted:",{fromId:t,toId:n,requestId:e});return}catch(R){E=R,k<b&&(console.warn(`Retry ${k}/${b} for accepting friend request:`,R.message),await new Promise(U=>setTimeout(U,1e3*k)))}throw E}catch(a){throw console.error(" Error accepting friend request:",a),a}}static async rejectFriendRequest(e){try{await rl(be(te,"friendRequests",e)),console.log(" Friend request rejected:",e)}catch(t){throw console.error(" Error rejecting friend request:",t),t}}static async removeFriend(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs for removing friend");if(!await this.areFriends(e,t)){console.log("Users are not friends, nothing to remove");return}const a=al(te),l=be(te,"userFriends",e,"friends",t),u=be(te,"userFriends",t,"friends",e);a.delete(l),a.delete(u);const h=3;let m;for(let p=1;p<=h;p++)try{await a.commit(),console.log(" Friend removed:",{userId:e,friendId:t});return}catch(x){m=x,p<h&&(console.warn(`Retry ${p}/${h} for removing friend:`,x.message),await new Promise(w=>setTimeout(w,1e3*p)))}throw m}catch(n){throw console.error(" Error removing friend:",n),n}}static async getFriends(e){try{const t=Fe(Ie(te,"userFriends",e,"friends")),n=await Ke(t),a=[];for(const l of n.docs){const u=l.id,h=l.data(),m=await Rs.getProfileByUserId(u);m&&a.push({userId:u,addedAt:h.addedAt,...m})}return a}catch(t){throw console.error("Error getting friends:",t),t}}static async getFriendshipStatus(e,t){try{const n=await this.areFriends(e,t),a=await this.checkExistingRequest(e,t),l=await this.checkExistingRequest(t,e);return{areFriends:n,sentRequest:!!a,receivedRequest:!!l,receivedRequestId:l?.id||null}}catch(n){return console.error("Error getting friendship status:",n),{areFriends:!1,sentRequest:!1,receivedRequest:!1,receivedRequestId:null}}}static async areFriends(e,t){try{return(await bt(be(te,"userFriends",e,"friends",t))).exists()}catch(n){return console.error("Error checking friendship:",n),!1}}static async checkExistingRequest(e,t){try{const n=Fe(Ie(te,"friendRequests"),Ye("from","==",e),Ye("to","==",t)),a=await Ke(n);if(!a.empty){const l=a.docs[0];return{id:l.id,...l.data()}}return null}catch(n){return console.error("Error checking existing request:",n),null}}static async getMutualFriends(e,t){try{const[n,a]=await Promise.all([this.getFriendIds(e),this.getFriendIds(t)]),l=n.filter(h=>a.includes(h)),u=[];for(let h=0;h<Math.min(3,l.length);h++){const m=await Rs.getProfileByUserId(l[h]);m&&u.push(m)}return{total:l.length,profiles:u,hasMore:l.length>3}}catch(n){return console.error("Error getting mutual friends:",n),{total:0,profiles:[],hasMore:!1}}}static async getFriendCount(e){try{const t=Fe(Ie(te,"userFriends",e,"friends"));return(await Ke(t)).size}catch(t){return console.error("Error getting friend count:",t),0}}static async getFriendIds(e){try{const t=Fe(Ie(te,"userFriends",e,"friends"));return(await Ke(t)).docs.map(a=>a.id)}catch(t){return console.error("Error getting friend IDs:",t),[]}}}const fO=({onViewProfile:s})=>{const{user:e}=Sn(),[t,n]=M.useState("friends"),[a,l]=M.useState([]),[u,h]=M.useState([]),[m,p]=M.useState([]),[x,w]=M.useState(""),[b,E]=M.useState(!1),[k,R]=M.useState([]),[U,z]=M.useState({friendCount:0,requestCount:0,sharedCardsCount:0,mutualConnections:0});M.useEffect(()=>{e&&B()},[e]),M.useEffect(()=>{switch(t){case"friends":q();break;case"requests":G();break;case"leaderboard":F();break}},[t]);const B=async()=>{try{const[ne,O,ie]=await Promise.all([Tn.getFriendCount(e.uid),Tn.getFriendRequests(e.uid),is.getPublicFlashcardsByUser(e.uid)]);z($=>({...$,friendCount:ne,requestCount:O.length,sharedCardsCount:ie.length}))}catch(ne){console.error("Error loading initial data:",ne)}},q=async()=>{E(!0);try{const ne=await Tn.getFriends(e.uid);l(ne),z(O=>({...O,friendCount:ne.length}))}catch(ne){console.error("Error loading friends:",ne)}finally{E(!1)}},G=async()=>{E(!0);try{const ne=await Tn.getFriendRequests(e.uid);h(ne),z(O=>({...O,requestCount:ne.length}))}catch(ne){console.error("Error loading friend requests:",ne)}finally{E(!1)}},Q=async()=>{if(x.trim()){E(!0);try{const O=(await Rs.searchProfiles(x)).filter($=>$.userId!==e.uid),ie=await Promise.all(O.map(async $=>{const ge=await Tn.getFriendshipStatus(e.uid,$.userId),I=await Tn.getMutualFriends(e.uid,$.userId);return{...$,friendshipStatus:ge,mutualFriends:I}}));p(ie)}catch(ne){console.error("Error searching users:",ne)}finally{E(!1)}}},L=async ne=>{try{await Tn.sendFriendRequest(e.uid,ne),S("Friend request sent!"),x&&await Q(),await B()}catch(O){console.error("Error sending friend request:",O),S("Failed to send friend request",!0)}},P=async ne=>{try{await Tn.acceptFriendRequest(ne.id,ne.fromId,e.uid),S("Friend request accepted!"),await G(),await B(),t==="friends"&&await q()}catch(O){console.error("Error accepting friend request:",O),S("Failed to accept friend request",!0)}},T=async ne=>{try{await Tn.rejectFriendRequest(ne),S("Friend request declined"),await G(),await B()}catch(O){console.error("Error rejecting friend request:",O),S("Failed to reject friend request",!0)}},A=async(ne,O)=>{if(confirm(`Remove ${O} from your friends?`))try{await Tn.removeFriend(e.uid,ne),S("Friend removed"),await q(),await B()}catch(ie){console.error("Error removing friend:",ie),S("Failed to remove friend",!0)}},F=async()=>{E(!0);try{const ne=await Tn.getFriendIds(e.uid),O=[e.uid,...ne],ie=[];for(const ge of O){const I=await Rs.getProfileByUserId(ge);I&&ie.push({...I,userId:ge})}const $=await Promise.all(ie.map(async ge=>{const I=await Tn.getFriendCount(ge.userId);return{...ge,friendCount:I,isCurrentUser:ge.userId===e.uid}}));$.sort((ge,I)=>I.friendCount-ge.friendCount),R($)}catch(ne){console.error("Error loading leaderboard:",ne)}finally{E(!1)}},S=(ne,O=!1)=>{const ie=document.createElement("div");ie.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",ie.style.backgroundColor=O?"#ef4444":"#10b981",ie.textContent=ne,document.body.appendChild(ie),setTimeout(()=>{ie.style.transform="translateX(0)"},100),setTimeout(()=>{ie.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(ie)},300)},3e3)},V=ne=>ne?ne.split(" ").map(O=>O.charAt(0)).join("").toUpperCase().slice(0,2):"?",D=(ne,O,ie,$=!0)=>{const ge=()=>$?O?.areFriends?i.jsx("button",{onClick:()=>A(ne.userId,ne.displayName),className:"px-3 py-1 rounded-lg text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove"}):O?.sentRequest?i.jsx("span",{className:"px-3 py-1 rounded-lg text-sm font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):O?.receivedRequest?i.jsx("button",{onClick:()=>P({id:O.receivedRequestId,fromId:ne.userId}),className:"px-3 py-1 rounded-lg text-sm font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}):i.jsx("button",{onClick:()=>L(ne.userId),className:"px-3 py-1 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}):null,I=()=>O?.areFriends?i.jsx("span",{className:"px-2 py-1 rounded text-xs bg-green-100 text-green-800",children:"Friends"}):O?.sentRequest?i.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"Pending"}):O?.receivedRequest?i.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"Wants to connect"}):null;return i.jsx("div",{className:"claude-card p-4 hover:scale-[1.02] transition-transform",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:V(ne.displayName)}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:s&&ne.slug?i.jsx("button",{onClick:()=>s(ne.slug),className:"hover:underline transition-colors",style:{color:"var(--claude-heading)"},children:ne.displayName||"Unknown User"}):ne.displayName||"Unknown User"}),I()]}),i.jsxs("div",{className:"text-sm claude-text-secondary space-y-1",children:[ne.email&&i.jsx("div",{children:ne.email}),ne.institution&&i.jsxs("div",{children:[" ",ne.institution]}),ie?.total>0&&i.jsxs("div",{className:"text-green-600 font-medium",children:[ie.total," mutual friend",ie.total>1?"s":""]})]})]})]}),i.jsx("div",{className:"flex items-center gap-2",children:ge()})]})},ne.userId)},ke=[{id:"friends",label:"My Friends",icon:""},{id:"discover",label:"Discover",icon:""},{id:"requests",label:"Requests",icon:"",badge:U.requestCount},{id:"leaderboard",label:"Leaderboard",icon:""}];return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Friends & Social"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Connect with fellow learners and share your progress"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:U.friendCount}),i.jsx("div",{className:"claude-text-secondary",children:"Friends"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:U.sharedCardsCount}),i.jsx("div",{className:"claude-text-secondary",children:"Cards Shared"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:U.requestCount}),i.jsx("div",{className:"claude-text-secondary",children:"Pending Requests"})]})]}),i.jsx("div",{className:"claude-card p-2 mb-8",children:i.jsx("div",{className:"flex",children:ke.map(ne=>i.jsxs("button",{onClick:()=>n(ne.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 relative",style:{backgroundColor:t===ne.id?"var(--claude-accent)":"transparent",color:t===ne.id?"white":"var(--claude-secondary-text)"},children:[i.jsx("span",{children:ne.icon}),ne.label,ne.badge>0&&i.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:ne.badge})]},ne.id))})}),i.jsxs("div",{className:"claude-card p-8",children:[t==="friends"&&i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" My Friends (",U.friendCount,")"]}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ne,O)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},O))}):a.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No friends yet"}),i.jsx("p",{className:"claude-text-secondary",children:"Search for users to add your first friend!"})]}):i.jsx("div",{className:"space-y-4",children:a.map(ne=>D(ne,{areFriends:!0},null,!0))})]}),t==="discover"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Discover Users"}),i.jsxs("div",{className:"flex gap-4 mb-6",children:[i.jsx("input",{type:"text",value:x,onChange:ne=>w(ne.target.value),onKeyPress:ne=>ne.key==="Enter"&&Q(),placeholder:"Search by email or display name...",className:"flex-1 px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"}}),i.jsxs("button",{onClick:Q,disabled:!x.trim()||b,className:"claude-button-primary disabled:opacity-50",children:[b?"":""," Search"]})]}),i.jsx("p",{className:"text-sm claude-text-secondary mb-6",children:" Tip: Search by email address or display name for best results"}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ne,O)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},O))}):m.length===0&&x?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),i.jsx("p",{className:"claude-text-secondary",children:"Try searching with a different email or username"})]}):m.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Discover new friends"}),i.jsx("p",{className:"claude-text-secondary",children:"Search for users to connect with and share your learning journey!"})]}):i.jsx("div",{className:"space-y-4",children:m.map(ne=>D(ne,ne.friendshipStatus,ne.mutualFriends,!0))})]}),t==="requests"&&i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" Friend Requests (",U.requestCount,")"]}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:2}).map((ne,O)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},O))}):u.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No pending requests"}),i.jsx("p",{className:"claude-text-secondary",children:"You're all caught up! New friend requests will appear here."})]}):i.jsx("div",{className:"space-y-4",children:u.map(ne=>i.jsx("div",{className:"claude-card p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:V(ne.senderProfile.displayName)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:ne.senderProfile.displayName||"Unknown User"}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Wants to connect with you"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>P(ne),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}),i.jsx("button",{onClick:()=>T(ne.id),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Decline"})]})]})},ne.id))})]}),t==="leaderboard"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Friends Leaderboard"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:"Top learners among you and your friends"}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((ne,O)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),i.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]})},O))}):k.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No leaderboard data"}),i.jsx("p",{className:"claude-text-secondary",children:"Add some friends to see the leaderboard!"})]}):i.jsx("div",{className:"space-y-3",children:k.map((ne,O)=>i.jsx("div",{className:`claude-card p-4 transition-all duration-300 hover:scale-[1.02] ${ne.isCurrentUser?"ring-2 ring-blue-500 bg-blue-50/10":""}`,style:{backgroundColor:O<3&&!ne.isCurrentUser?"rgba(255, 215, 0, 0.1)":ne.isCurrentUser?"rgba(59, 130, 246, 0.1)":"var(--claude-surface)",border:`1px solid ${O<3&&!ne.isCurrentUser?"rgba(255, 215, 0, 0.3)":ne.isCurrentUser?"rgba(59, 130, 246, 0.3)":"var(--claude-border)"}`},children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm",style:{background:O<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:O<3?"white":"var(--claude-text)"},children:O===0?"":O===1?"":O===2?"":O+1}),i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:V(ne.displayName)}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:[ne.displayName||"Unknown User",ne.isCurrentUser&&i.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"You"})]}),ne.slug&&i.jsxs("button",{onClick:()=>s&&s(ne.slug),className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",ne.slug]})]}),i.jsx("div",{className:"claude-text-secondary text-sm",children:ne.institution&&` ${ne.institution}`})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xl font-bold",style:{color:O<3?"#FFD700":"var(--claude-accent-blue)"},children:ne.friendCount}),i.jsxs("div",{className:"claude-text-secondary text-sm",children:["friend",ne.friendCount!==1?"s":""]})]})]})},ne.userId))})]})]})]})})},mO=({profile:s,onSave:e,onCancel:t})=>{const[n,a]=M.useState({displayName:"",bio:"",institution:""}),[l,u]=M.useState(!1),h={displayName:50,bio:1e3,institution:100};M.useEffect(()=>{s&&a({displayName:s.displayName||"",bio:s.bio||"",institution:s.institution||""})},[s]);const m=async x=>{if(x.preventDefault(),n.displayName.length<2||n.displayName.length>h.displayName){alert(`Display name must be between 2 and ${h.displayName} characters.`);return}if(n.bio.length>h.bio){alert(`Bio must be ${h.bio} characters or less.`);return}if(n.institution.length>h.institution){alert(`Institution must be ${h.institution} characters or less.`);return}u(!0);try{await Rs.updateProfile(s.slug,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()}),e&&e({...s,displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()})}catch(w){console.error("Error updating profile:",w),alert("Something went wrong. Please try again.")}finally{u(!1)}},p=({current:x,max:w,label:b})=>{const E=x/w*100;let k="text-sm ";return E>90?k+="text-red-500":E>70?k+="text-yellow-500":k+="text-gray-500",i.jsxs("div",{className:k,children:[x,"/",w," ",b]})};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"claude-card p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-3xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Edit Profile"}),i.jsx("p",{className:"claude-text-secondary",children:"Update your public profile information"})]}),i.jsxs("form",{onSubmit:m,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),i.jsx("input",{type:"text",value:n.displayName,onChange:x=>a(w=>({...w,displayName:x.target.value})),placeholder:"Enter your display name",maxLength:h.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your username @",s?.slug," cannot be changed"]}),i.jsx(p,{current:n.displayName.length,max:h.displayName,label:"characters"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Bio"}),i.jsx("textarea",{value:n.bio,onChange:x=>a(w=>({...w,bio:x.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:h.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),i.jsx(p,{current:n.bio.length,max:h.bio,label:"characters"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),i.jsx("input",{type:"text",value:n.institution,onChange:x=>a(w=>({...w,institution:x.target.value})),placeholder:"University, company, or organization (optional)",maxLength:h.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{}),i.jsx(p,{current:n.institution.length,max:h.institution,label:"characters"})]})]}),i.jsxs("div",{className:"flex gap-4 pt-4",children:[i.jsx("button",{type:"submit",disabled:l,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?i.jsxs("span",{className:"flex items-center justify-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"}),i.jsx("button",{type:"button",onClick:t,disabled:l,className:"px-6 py-3 rounded-xl font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:x=>{l||(x.target.style.backgroundColor="var(--claude-surface-hover)")},onMouseLeave:x=>{l||(x.target.style.backgroundColor="var(--claude-subtle)")},children:"Cancel"})]})]})]})})},gO=({profileSlug:s,onClose:e})=>{const{user:t}=Sn(),[n,a]=M.useState(null),[l,u]=M.useState([]),[h,m]=M.useState(null),[p,x]=M.useState(null),[w,b]=M.useState({cardCount:0,friendCount:0}),[E,k]=M.useState(!0),[R,U]=M.useState("upvotes"),[z,B]=M.useState(!1),[q,G]=M.useState(null);M.useEffect(()=>{s&&Q()},[s]),M.useEffect(()=>{n&&n.userId&&L()},[n,R]);const Q=async()=>{k(!0);try{const O=await Rs.getProfileBySlug(s);if(!O)throw new Error("Profile not found");a(O)}catch(O){console.error("Error loading profile:",O),alert("Profile not found or error loading profile"),e&&e()}finally{k(!1)}},L=async()=>{try{const[O,ie,$,ge]=await Promise.all([P(),Tn.getFriendCount(n.userId),t?Tn.getFriendshipStatus(t.uid,n.userId):null,t?Tn.getMutualFriends(t.uid,n.userId):null]);b({cardCount:O.length,friendCount:ie}),m($),x(ge)}catch(O){console.error("Error loading profile data:",O)}},P=async()=>{try{const ie=(await is.getPublicFlashcardsByUser(n.userId)).sort(($,ge)=>{switch(R){case"upvotes":return(ge.upvotes||0)-($.upvotes||0);case"date":return new Date(ge.createdAt)-new Date($.createdAt);default:return 0}});return u(ie),ie}catch(O){return console.error("Error loading public cards:",O),[]}},T=async O=>{if(!t){alert("Please sign in to connect with friends");return}try{switch(O){case"send_request":await Tn.sendFriendRequest(t.uid,n.userId),A("Friend request sent!");break;case"accept_request":await Tn.acceptFriendRequest(h.receivedRequestId,n.userId,t.uid),A("Friend request accepted!");break;case"remove_friend":confirm(`Remove ${n.displayName} from your friends?`)&&(await Tn.removeFriend(t.uid,n.userId),A("Friend removed"));break}const ie=await Tn.getFriendshipStatus(t.uid,n.userId);m(ie);const $=await Tn.getFriendCount(n.userId);b(ge=>({...ge,friendCount:$}))}catch(ie){console.error("Error with friend action:",ie),A("Failed to perform action",!0)}},A=(O,ie=!1)=>{const $=document.createElement("div");$.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",$.style.backgroundColor=ie?"#ef4444":"#10b981",$.textContent=O,document.body.appendChild($),setTimeout(()=>{$.style.transform="translateX(0)"},100),setTimeout(()=>{$.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild($)},300)},3e3)},F=O=>O?O.split(" ").map(ie=>ie.charAt(0)).join("").toUpperCase().slice(0,2):"?",S=()=>!t||!h?null:h.areFriends?i.jsx("button",{onClick:()=>T("remove_friend"),className:"px-4 py-2 rounded-lg font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove Friend"}):h.sentRequest?i.jsx("span",{className:"px-4 py-2 rounded-lg font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):h.receivedRequest?i.jsx("button",{onClick:()=>T("accept_request"),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept Friend Request"}):i.jsx("button",{onClick:()=>T("send_request"),className:"px-4 py-2 rounded-lg font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}),V=O=>O?(O.toDate?O.toDate():new Date(O)).toLocaleDateString():"Unknown",D=O=>{a(O),B(!1),A("Profile updated successfully!")},ke=()=>{B(!1)};if(E)return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading profile..."})]})})});if(!n)return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:"Profile not found"}),i.jsx("p",{className:"claude-text-secondary mb-4",children:"The profile you're looking for doesn't exist or has been removed."}),e&&i.jsx("button",{onClick:e,className:"claude-button-primary",children:"Go Back"})]})})});const ne=t&&t.uid===n.userId;return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e&&i.jsx("button",{onClick:e,className:"mb-4 px-4 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},children:" Back"}),i.jsx("div",{className:"claude-card p-8 mb-8",children:i.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[i.jsxs("div",{className:"text-center md:text-left",children:[i.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto md:mx-0 mb-4",style:{background:"var(--claude-accent)"},children:F(n.displayName)}),i.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:n.displayName||"Anonymous User"}),i.jsxs("p",{className:"claude-text-secondary text-lg mb-2",children:["@",n.slug]}),n.institution&&i.jsxs("p",{className:"claude-text-secondary",children:[" ",n.institution]})]}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[n.bio&&i.jsx("div",{className:"mb-4",children:i.jsx("p",{className:"claude-text-primary",children:n.bio})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent-blue)"},children:w.cardCount}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent)"},children:w.friendCount}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Friends"})]})]}),p&&p.total>0&&i.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[i.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--claude-heading)"},children:[p.total," mutual friend",p.total>1?"s":""]}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[p.profiles.map(O=>O.displayName).join(", "),p.hasMore&&` and ${p.total-p.profiles.length} more`]})]}),i.jsxs("div",{className:"flex gap-3",children:[S(),ne&&i.jsx("button",{onClick:()=>B(!0),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Edit Profile"})]})]})]})}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:["Public Flashcards (",w.cardCount,")"]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("label",{className:"text-sm font-medium",style:{color:"var(--claude-secondary-text)"},children:"Sort by:"}),i.jsxs("select",{value:R,onChange:O=>U(O.target.value),className:"px-3 py-1 rounded-lg border",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},children:[i.jsx("option",{value:"upvotes",children:"Upvotes"}),i.jsx("option",{value:"date",children:"Date Created"})]})]})]}),l.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No public flashcards"}),i.jsx("p",{className:"claude-text-secondary",children:ne?"You haven't shared any flashcards publicly yet.":`${n.displayName} hasn't shared any flashcards publicly yet.`})]}):i.jsx("div",{className:"grid gap-4",children:l.map(O=>i.jsxs("div",{className:"border rounded-xl p-6 transition-all hover:shadow-md",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)"},children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:O.statement||O.question||"Untitled Card"}),O.subject&&i.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 mb-2",children:O.subject}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:["Created ",V(O.createdAt)]})]}),i.jsxs("div",{className:"flex items-center gap-3 text-sm claude-text-secondary",children:[i.jsxs("span",{children:[" ",O.upvotes||0]}),i.jsxs("span",{children:[" ",O.viewCount||0]})]})]}),O.tags&&O.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2",children:O.tags.map((ie,$)=>i.jsxs("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:"var(--claude-border)",color:"var(--claude-secondary-text)"},children:["#",ie]},$))})]},O.id))})]}),z&&i.jsx(mO,{profile:n,onSave:D,onCancel:ke})]})})},aE=({onDeckCreated:s,onClose:e,editingDeck:t=null})=>{const{user:n}=Sn(),[a,l]=M.useState({name:"",description:"",subject:"",difficulty:"beginner",tags:"",color:"#635BFF",icon:"",isPublic:!1}),[u,h]=M.useState(!1),[m,p]=M.useState(""),[x,w]=M.useState(!1),b=["#635BFF","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"],E=["","","","","","","","","","","","","","","",""],k=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Other"];M.useEffect(()=>{t&&l({name:t.name||"",description:t.description||"",subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:(t.tags||[]).join(", "),color:t.color||"#635BFF",icon:t.icon||"",isPublic:t.isPublic||!1})},[t]);const R=(z,B)=>{l(q=>({...q,[z]:B})),p("")},U=async z=>{if(z.preventDefault(),!n){p("Please sign in to create decks");return}if(!a.name.trim()){p("Deck name is required");return}h(!0),p("");try{const B={name:a.name.trim(),description:a.description.trim(),subject:a.subject,difficulty:a.difficulty,tags:a.tags.split(",").map(G=>G.trim()).filter(G=>G),color:a.color,icon:a.icon,isPublic:a.isPublic};if(a.isPublic){const G=await Rs.getUserSlug(n.uid);if(!G){p("You must create a profile before making public decks."),h(!1);return}B.authorSlug=G,B.slug=await hs.generateUniqueSlug(a.name,G)}let q;t?(await hs.updateDeck(t.id,B),q=t.id):q=await hs.createDeck(n.uid,B),w(!0),setTimeout(()=>{s&&s(q),e&&e()},1500)}catch(B){console.error("Error saving deck:",B),p(B.message||"Failed to save deck. Please try again.")}finally{h(!1)}};return x?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-2xl font-bold claude-success mb-4",children:t?"Deck Updated!":"Deck Created!"}),i.jsxs("p",{className:"claude-text-secondary",children:["Your deck has been ",t?"updated":"created"," successfully."]})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:t?" Edit Deck":" Create New Deck"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:t?"Update your deck details":"Organize your flashcards into a themed collection"})]}),i.jsxs("form",{onSubmit:U,className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Basic Information"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck Name ",i.jsx("span",{className:"claude-error",children:"*"})]}),i.jsx("input",{type:"text",value:a.name,onChange:z=>R("name",z.target.value),placeholder:"e.g. Calculus I - Derivatives",className:"claude-input w-full",maxLength:100,required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Description"}),i.jsx("textarea",{value:a.description,onChange:z=>R("description",z.target.value),placeholder:"Brief description of what this deck covers...",className:"claude-input w-full h-24 resize-none",maxLength:300}),i.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:[a.description.length,"/300 characters"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),i.jsxs("select",{value:a.subject,onChange:z=>R("subject",z.target.value),className:"claude-input w-full",children:[i.jsx("option",{value:"",children:"Select a subject"}),k.map(z=>i.jsx("option",{value:z,children:z},z))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Difficulty Level"}),i.jsxs("select",{value:a.difficulty,onChange:z=>R("difficulty",z.target.value),className:"claude-input w-full",children:[i.jsx("option",{value:"beginner",children:"Beginner"}),i.jsx("option",{value:"intermediate",children:"Intermediate"}),i.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),i.jsx("input",{type:"text",value:a.tags,onChange:z=>R("tags",z.target.value),placeholder:"e.g. calculus, derivatives, math (comma-separated)",className:"claude-input w-full"}),i.jsx("div",{className:"text-xs claude-text-muted mt-1",children:"Separate tags with commas"})]})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Appearance"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Color"}),i.jsx("div",{className:"flex flex-wrap gap-3",children:b.map(z=>i.jsx("button",{type:"button",onClick:()=>R("color",z),className:`w-12 h-12 rounded-xl border-4 transition-all duration-200 ${a.color===z?"border-white shadow-lg scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:z},title:z},z))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Icon"}),i.jsx("div",{className:"flex flex-wrap gap-3",children:E.map(z=>i.jsx("button",{type:"button",onClick:()=>R("icon",z),className:`w-12 h-12 rounded-xl text-2xl flex items-center justify-center transition-all duration-200 ${a.icon===z?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg scale-110":"claude-card hover:scale-105"}`,title:z,children:z},z))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Preview"}),i.jsxs("div",{className:"claude-card p-6 max-w-xs rounded-2xl shadow-lg",style:{borderLeft:`6px solid ${a.color}`},children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{backgroundColor:a.color,color:"white"},children:a.icon}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold claude-text-primary",children:a.name||"Deck Name"}),i.jsx("p",{className:"text-sm claude-text-muted",children:a.subject||"Subject"})]})]}),a.description&&i.jsx("p",{className:"text-sm claude-text-secondary",children:a.description})]})]})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Privacy & Sharing"}),i.jsx("div",{className:"space-y-4",children:i.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:a.isPublic,onChange:z=>R("isPublic",z.target.checked),className:"w-5 h-5 rounded mt-1",style:{accentColor:"var(--claude-accent)",backgroundColor:a.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),i.jsxs("div",{children:[i.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this deck public"}),i.jsx("p",{className:"text-sm claude-text-muted mt-1",children:"Public decks can be discovered and imported by other users. You need a profile to create public decks."})]})]})})]}),m&&i.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:i.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[i.jsx("span",{children:""}),i.jsx("span",{children:m})]})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&i.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{type:"submit",disabled:u||!a.name.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:u||!a.name.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t?"Updating...":"Creating..."]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:t?"":""}),t?"Update Deck":"Create Deck"]})})]})]})]})})},pO=({onCreateDeck:s,onEditDeck:e,onSelectDeck:t})=>{const{user:n}=Sn(),[a,l]=M.useState([]),[u,h]=M.useState(!0),[m,p]=M.useState(""),[x,w]=M.useState(""),[b,E]=M.useState("all");M.useEffect(()=>{n&&k()},[n]);const k=async()=>{try{h(!0),p("");const z=await hs.getUserDecks(n.uid);l(z)}catch(z){console.error("Error loading decks:",z),p("Failed to load decks. Please try again.")}finally{h(!1)}},R=async(z,B)=>{if(window.confirm(`Are you sure you want to delete "${B}"? This action cannot be undone.`))try{await hs.deleteDeck(z),l(a.filter(q=>q.id!==z))}catch(q){console.error("Error deleting deck:",q),p("Failed to delete deck. Please try again.")}},U=a.filter(z=>{const B=!x||z.name.toLowerCase().includes(x.toLowerCase())||z.description.toLowerCase().includes(x.toLowerCase())||z.subject&&z.subject.toLowerCase().includes(x.toLowerCase()),q=b==="all"||b==="public"&&z.isPublic||b==="private"&&!z.isPublic;return B&&q});return u?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading your decks..."})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4 md:mb-0",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl text-white shadow-lg",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:i.jsx(ei,{size:32,color:"white"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:"My Decks"}),i.jsx("p",{className:"claude-text-secondary",children:"Organize and manage your flashcard collections"})]})]}),i.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary mt-4 md:mt-0 flex items-center gap-2",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:[i.jsx("span",{className:"text-lg",children:"+"}),"Create New Deck"]})]}),i.jsxs("div",{className:"claude-card p-6 mb-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[i.jsx("div",{className:"flex-1",children:i.jsx("input",{type:"text",value:x,onChange:z=>w(z.target.value),placeholder:"Search decks by name, subject, or description...",className:"claude-input w-full"})}),i.jsx("div",{className:"md:w-48",children:i.jsxs("select",{value:b,onChange:z=>E(z.target.value),className:"claude-input w-full",children:[i.jsx("option",{value:"all",children:"All Decks"}),i.jsx("option",{value:"private",children:"Private Only"}),i.jsx("option",{value:"public",children:"Public Only"})]})})]}),i.jsxs("div",{className:"flex flex-wrap gap-6 mt-4 pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.length}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Total Decks"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.reduce((z,B)=>z+(B.cardCount||0),0)}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Total Cards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.filter(z=>z.isPublic).length}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Public Decks"})]})]})]}),m&&i.jsx("div",{className:"p-4 rounded-2xl mb-6",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:i.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[i.jsx(Pg,{size:16,color:"red"}),i.jsx("span",{children:m})]})}),U.length===0?i.jsxs("div",{className:"claude-card p-12 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-2xl mb-4",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:i.jsx(ei,{size:40,color:"white"})}),i.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:x||b!=="all"?"No matching decks found":"No decks yet"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:x||b!=="all"?"Try adjusting your search or filter criteria":"Create your first deck to start organizing your flashcards"}),!x&&b==="all"&&i.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary flex items-center gap-2 mx-auto",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:[i.jsx("span",{className:"text-lg",children:"+"}),"Create Your First Deck"]})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:U.map(z=>i.jsx(yO,{deck:z,onEdit:()=>e&&e(z),onDelete:()=>R(z.id,z.name),onSelect:()=>t&&t(z)},z.id))})]})})},yO=({deck:s,onEdit:e,onDelete:t,onSelect:n})=>{const a=l=>l?(l.toDate?l.toDate():new Date(l)).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"Unknown";return i.jsxs("div",{className:"claude-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer relative group",style:{borderLeft:`6px solid ${s.color||"#6B5B4A"}`},onClick:()=>n&&n(),children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white",style:{backgroundColor:s.color||"#6B5B4A"},children:s.icon?i.jsx("span",{className:"text-2xl",children:s.icon}):i.jsx(ei,{size:24,color:"white"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"font-bold claude-text-primary truncate",children:s.name}),i.jsx("p",{className:"text-sm claude-text-muted",children:s.subject||"No subject"})]})]}),i.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:l=>{l.stopPropagation(),e()},className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 hover:text-gray-800",title:"Edit deck",children:i.jsx(xr,{size:16,color:"default"})}),!s.isDefault&&i.jsx("button",{onClick:l=>{l.stopPropagation(),t()},className:"p-2 rounded-lg hover:bg-red-100 text-red-600 hover:text-red-800",title:"Delete deck",children:i.jsx(T0,{size:16,color:"red"})})]})})]}),s.description&&i.jsx("p",{className:"text-sm claude-text-secondary mb-4 line-clamp-2",children:s.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm claude-text-muted mb-4",children:[i.jsxs("span",{children:[s.cardCount||0," cards"]}),i.jsx("span",{children:s.difficulty||"Mixed"})]}),s.tags&&s.tags.length>0&&i.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[s.tags.slice(0,3).map((l,u)=>i.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${s.color||"#6B5B4A"}20`,color:s.color||"#6B5B4A"},children:l},u)),s.tags.length>3&&i.jsxs("span",{className:"px-2 py-1 rounded-full text-xs claude-text-muted",children:["+",s.tags.length-3]})]}),i.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[i.jsxs("div",{className:"flex items-center gap-2",children:[s.isPublic&&i.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700",children:"Public"}),s.isDefault&&i.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700",children:"Default"})]}),i.jsx("span",{className:"text-xs claude-text-muted",children:a(s.updatedAt||s.createdAt)})]})]})},xO=({onClose:s})=>{const{user:e}=Sn(),[t,n]=M.useState(null),[a,l]=M.useState(null),[u,h]=M.useState("week"),[m,p]=M.useState(!0),[x,w]=M.useState("overview");M.useEffect(()=>{e&&b()},[e,u]);const b=async()=>{try{p(!0);const[R,U]=await Promise.all([Ya.getUserAnalytics(e.uid),Ya.getUserInsights(e.uid,u)]);n(R),l(U)}catch(R){console.error("Error loading analytics:",R)}finally{p(!1)}},E=R=>{const U=Math.floor(R/3600),z=Math.floor(R%3600/60);return U>0?`${U}h ${z}m`:`${z}m`},k=R=>`${Math.round(R*100)}%`;return m?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading your analytics..."})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" Learning Analytics"}),i.jsx("p",{className:"claude-text-secondary",children:"Track your progress, identify patterns, and optimize your learning"})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[i.jsxs("select",{value:u,onChange:R=>h(R.target.value),className:"claude-input",children:[i.jsx("option",{value:"day",children:"Today"}),i.jsx("option",{value:"week",children:"This Week"}),i.jsx("option",{value:"month",children:"This Month"})]}),s&&i.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close"})]})]}),i.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"performance",label:" Performance",icon:""},{id:"insights",label:" Insights",icon:""},{id:"progress",label:" Progress",icon:""}].map(R=>i.jsxs("button",{onClick:()=>w(R.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===R.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[i.jsx("span",{className:"mr-2",children:R.icon}),i.jsx("span",{className:"hidden sm:inline",children:R.label.replace(/^.+\s/,"")})]},R.id))}),x==="overview"&&i.jsx(vO,{analytics:t,insights:a,formatTime:E,formatPercentage:k}),x==="performance"&&i.jsx(bO,{analytics:t,insights:a,formatPercentage:k}),x==="insights"&&i.jsx(wO,{insights:a,formatTime:E}),x==="progress"&&i.jsx(_O,{analytics:t,insights:a,formatPercentage:k})]})})},vO=({analytics:s,insights:e,formatTime:t,formatPercentage:n})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Jf,{title:"Total Study Time",value:t(s?.totalStudyTime||0),icon:"",color:"blue",trend:e?.studyTimeTrend}),i.jsx(Jf,{title:"Study Sessions",value:s?.totalSessions||0,icon:"",color:"green"}),i.jsx(Jf,{title:"Overall Accuracy",value:n(s?.overallAccuracy||0),icon:"",color:"purple",trend:e?.accuracyTrend}),i.jsx(Jf,{title:"Study Streak",value:`${s?.studyStreak||0} days`,icon:"",color:"orange"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),i.jsxs("div",{className:"space-y-4",children:[s?.deckStats&&Object.entries(s.deckStats).slice(0,5).map(([a,l])=>i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",children:["Deck ",a.slice(-6)]}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[l.sessions," sessions"]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-bold text-green-600",children:n(l.accuracy)}),i.jsx("div",{className:"text-sm claude-text-muted",children:t(l.studyTime)})]})]},a)),(!s?.deckStats||Object.keys(s.deckStats).length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No study activity yet. Start studying to see your progress!"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Performance Trends"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(iE,{label:"Accuracy Trend",value:e?.accuracyTrend||0,description:"How your accuracy has changed recently"}),i.jsx(iE,{label:"Study Time Trend",value:e?.studyTimeTrend||0,description:"How your study duration has changed"}),i.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[i.jsx("div",{className:"font-medium text-blue-800",children:"Mastery Progress"}),i.jsxs("div",{className:"text-sm text-blue-600 mb-2",children:["Overall understanding: ",n(e?.masteryProgress||0)]}),i.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:i.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(e?.masteryProgress||0)*100}%`}})})]})]})]})]})]}),bO=({analytics:s,insights:e,formatPercentage:t})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Subject Performance"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s?.subjectStats&&Object.entries(s.subjectStats).map(([n,a])=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsx("div",{className:"font-medium mb-2",children:n||"General"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm claude-text-muted",children:"Accuracy:"}),i.jsx("span",{className:"font-medium",children:t(a.accuracy)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm claude-text-muted",children:"Mastery:"}),i.jsx("span",{className:"font-medium",children:t(a.masteryLevel||0)})]}),i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${a.accuracy*100}%`}})})]})]},n)),(!s?.subjectStats||Object.keys(s.subjectStats).length===0)&&i.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"No subject data available yet. Study more to see subject breakdown!"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Cards Needing Attention"}),i.jsx("div",{className:"space-y-4",children:e?.strugglingCards&&e.strugglingCards.length>0?e.strugglingCards.map((n,a)=>i.jsxs("div",{className:"flex items-center justify-between p-4 border-l-4 border-red-500 bg-red-50",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",children:["Card ",n.cardId.slice(-6)]}),i.jsxs("div",{className:"text-sm text-red-600",children:[n.totalReviews," attempts"]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-red-700 font-bold",children:t(n.accuracy)}),i.jsx("div",{className:"text-sm text-red-600",children:"accuracy"})]})]},n.cardId)):i.jsx("div",{className:"text-center py-8 text-green-600",children:" Great job! No cards need special attention right now."})})]})]}),wO=({insights:s,formatTime:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Personalized Recommendations"}),i.jsx("div",{className:"space-y-4",children:s?.recommendations&&s.recommendations.length>0?s.recommendations.map((t,n)=>i.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${t.priority==="high"?"border-red-500 bg-red-50":t.priority==="medium"?"border-yellow-500 bg-yellow-50":"border-blue-500 bg-blue-50"}`,children:[i.jsx("div",{className:`font-medium ${t.priority==="high"?"text-red-800":t.priority==="medium"?"text-yellow-800":"text-blue-800"}`,children:t.title}),i.jsx("div",{className:`text-sm mt-1 ${t.priority==="high"?"text-red-600":t.priority==="medium"?"text-yellow-600":"text-blue-600"}`,children:t.description})]},n)):i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"Keep studying to get personalized recommendations!"})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Optimal Study Time"}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:s?.optimalStudyTime==="morning"?"":s?.optimalStudyTime==="afternoon"?"":""}),i.jsx("div",{className:"text-lg font-medium capitalize",children:s?.optimalStudyTime||"Not enough data"}),i.jsx("div",{className:"text-sm claude-text-muted mt-2",children:"You perform best during this time"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Consistency Score"}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:[Math.round((s?.consistencyScore||0)*100),"%"]}),i.jsx("div",{className:"text-sm claude-text-muted",children:"How consistent your study sessions are"}),i.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-3",children:i.jsx("div",{className:"claude-gradient h-3 rounded-full transition-all duration-300",style:{width:`${(s?.consistencyScore||0)*100}%`}})})]})]})]})]}),_O=({analytics:s,insights:e,formatPercentage:t})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Learning Progress"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-success)"},children:t(e?.masteryProgress||0)}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Overall Mastery"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:s?.studyStreak||0}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Day Streak"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-warning)"},children:s?.longestStreak||0}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Longest Streak"})]})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Your Strongest Subjects"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e?.strongSubjects&&e.strongSubjects.length>0?e.strongSubjects.map((n,a)=>i.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border-2 border-green-200",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"font-medium text-green-800",children:n}),i.jsx("div",{className:"text-sm text-green-600",children:"Strong performance"})]},n)):i.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"Keep studying to identify your strongest subjects!"})})]})]}),Jf=({title:s,value:e,icon:t,color:n,trend:a})=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl relative overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"text-2xl",children:t}),a!==void 0&&i.jsxs("div",{className:`text-sm font-medium ${a>0?"text-green-600":a<0?"text-red-600":"text-gray-600"}`,children:[a>0?"":a<0?"":""," ",Math.abs(a*100).toFixed(1),"%"]})]}),i.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),i.jsx("div",{className:"text-sm claude-text-muted",children:s})]}),iE=({label:s,value:e,description:t})=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:s}),i.jsx("div",{className:"text-sm claude-text-muted",children:t})]}),i.jsxs("div",{className:`text-right ${e>0?"text-green-600":e<0?"text-red-600":"text-gray-600"}`,children:[i.jsxs("div",{className:"font-bold",children:[e>0?"":e<0?"":""," ",Math.abs(e*100).toFixed(1),"%"]}),i.jsx("div",{className:"text-sm",children:e>0?"Improving":e<0?"Declining":"Stable"})]})]});class Kn{static async initializeSession(e=null){try{const t=this.generateSessionId(),n={sessionId:t,userId:e||null,startTime:Me(),isActive:!0,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},referrer:document.referrer||null,initialUrl:window.location.href,pageViews:0,clicks:0,timeSpent:0,pagesVisited:[],actionsPerformed:[],isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isTablet:/iPad/i.test(navigator.userAgent),platform:navigator.platform};if(await Os(be(te,"websiteSessions",t),n),localStorage.setItem("website_session_id",t),Dn)try{oa(Dn,"session_start",{session_id:t,user_id:e,is_mobile:n.isMobile})}catch(a){console.warn("Firebase Analytics not available:",a)}return this.setupVisibilityTracking(t),this.setupUnloadTracking(t),t}catch(t){throw console.error("Error initializing session:",t),t}}static async trackPageView(e,t=null,n=null){try{const a=t||localStorage.getItem("website_session_id");if(!a)return;const l={sessionId:a,userId:n||null,page:e,url:window.location.href,timestamp:Me(),referrer:document.referrer||null,timeOnPage:0,scrollDepth:0,interactions:0},u=await Ws(Ie(te,"pageViews"),l),h=be(te,"websiteSessions",a);if(await Wt(h,{pageViews:pm(1),pagesVisited:eu(e),lastPageView:Me(),currentPage:e}),Dn)try{oa(Dn,"page_view",{page_title:document.title,page_location:window.location.href,session_id:a,user_id:n})}catch(m){console.warn("Firebase Analytics not available:",m)}return this.startPageTimeTracking(u.id,a),u.id}catch(a){console.error("Error tracking page view:",a)}}static async trackInteraction(e,t=null,n=null){try{const a=t||localStorage.getItem("website_session_id");if(!a)return;const l={sessionId:a,userId:n||null,timestamp:Me(),page:window.location.pathname,...e};await Ws(Ie(te,"interactions"),l);const u=be(te,"websiteSessions",a);if(await Wt(u,{clicks:pm(1),actionsPerformed:eu(e.action||"unknown"),lastActivity:Me()}),Dn)try{oa(Dn,"user_interaction",{action:e.action,element:e.element,session_id:a,user_id:n})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(a){console.error("Error tracking interaction:",a)}}static async trackScrollDepth(e,t=null){try{const n=t||localStorage.getItem("website_session_id");if(!n)return;const a=Fe(Ie(te,"pageViews"),Ye("sessionId","==",n),an("timestamp","desc"),on(1)),l=await Ke(a);if(!l.empty){const u=l.docs[0];await Wt(u.ref,{scrollDepth:Math.max(e,u.data().scrollDepth||0)})}}catch(n){if(n.message&&(n.message.includes("requires an index")||n.message.includes("Missing or insufficient permissions")||n.message.includes("permission-denied")))return;console.error("Error tracking scroll depth:",n)}}static async trackFeatureUsage(e,t,n={},a=null){try{const l=localStorage.getItem("website_session_id"),u={sessionId:l,userId:a||null,feature:e,action:t,metadata:n,timestamp:Me(),page:window.location.pathname};if(await Ws(Ie(te,"featureUsage"),u),Dn)try{oa(Dn,"feature_usage",{feature_name:e,action_type:t,session_id:l,user_id:a})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(l){console.error("Error tracking feature usage:",l)}}static async trackConversion(e,t=null,n=null){try{const a=localStorage.getItem("website_session_id"),l={sessionId:a,userId:n||null,conversionType:e,value:t,timestamp:Me(),page:window.location.pathname};if(await Ws(Ie(te,"conversions"),l),Dn)try{oa(Dn,"conversion",{conversion_type:e,conversion_value:t,session_id:a,user_id:n})}catch(u){console.warn("Firebase Analytics not available:",u)}}catch(a){console.error("Error tracking conversion:",a)}}static async trackUserFlow(e,t,n="navigation",a=null){try{const u={sessionId:localStorage.getItem("website_session_id"),userId:a||null,fromPage:e,toPage:t,action:n,timestamp:Me()};await Ws(Ie(te,"userFlows"),u)}catch(l){console.error("Error tracking user flow:",l)}}static async trackClick(e,t={},n=null){try{await this.trackInteraction({action:"click",element:e,context:t,elementText:t.text||"",elementId:t.id||"",elementClass:t.className||""},null,n)}catch(a){console.error("Error tracking click:",a)}}static async trackFormInteraction(e,t,n=null,a=null){try{await this.trackInteraction({action:"form_interaction",element:"form",formName:e,formAction:t,field:n},null,a)}catch(l){console.error("Error tracking form interaction:",l)}}static startPageTimeTracking(e,t){window.pageTimeTracking||(window.pageTimeTracking={}),window.pageTimeTracking[e]={startTime:Date.now(),sessionId:t,pageViewId:e}}static async endPageTimeTracking(e){try{if(!window.pageTimeTracking||!window.pageTimeTracking[e])return;const t=window.pageTimeTracking[e],n=Math.round((Date.now()-t.startTime)/1e3),a=be(te,"pageViews",e);await Wt(a,{timeOnPage:n});const l=be(te,"websiteSessions",t.sessionId);await Wt(l,{timeSpent:pm(n)}),delete window.pageTimeTracking[e]}catch(t){console.error("Error ending page time tracking:",t)}}static async endSession(e=null){try{const t=e||localStorage.getItem("website_session_id");if(!t)return;if(window.pageTimeTracking)for(const a of Object.keys(window.pageTimeTracking))await this.endPageTimeTracking(a);const n=be(te,"websiteSessions",t);if(await Wt(n,{endTime:Me(),isActive:!1}),localStorage.removeItem("website_session_id"),Dn)try{oa(Dn,"session_end",{session_id:t})}catch(a){console.warn("Firebase Analytics not available:",a)}}catch(t){console.error("Error ending session:",t)}}static async getAnalyticsSummary(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),a=Fe(Ie(te,"websiteSessions"),Ye("startTime",">=",n)),u=(await Ke(a)).docs.map(L=>({id:L.id,...L.data()})),h=Fe(Ie(te,"pageViews"),Ye("timestamp",">=",n)),p=(await Ke(h)).docs.map(L=>({id:L.id,...L.data()})),x=Fe(Ie(te,"interactions"),Ye("timestamp",">=",n)),b=(await Ke(x)).docs.map(L=>({id:L.id,...L.data()})),E=new Set(u.filter(L=>L.userId).map(L=>L.userId)).size,k=u.length,R=p.length,U=b.length,z=u.reduce((L,P)=>L+(P.timeSpent||0),0)/u.length,B=R/k,q={};p.forEach(L=>{const P=L.page||"unknown";q[P]||(q[P]={views:0,totalTime:0,interactions:0}),q[P].views++,q[P].totalTime+=L.timeOnPage||0}),b.forEach(L=>{const P=L.page||"unknown";q[P]&&q[P].interactions++});const G=Object.entries(q).map(([L,P])=>({page:L,...P,avgTimeOnPage:P.totalTime/P.views})).sort((L,P)=>P.views-L.views).slice(0,10),Q={mobile:u.filter(L=>L.isMobile).length,tablet:u.filter(L=>L.isTablet).length,desktop:u.filter(L=>!L.isMobile&&!L.isTablet).length};return{summary:{uniqueUsers:E,totalSessions:k,totalPageViews:R,totalInteractions:U,avgSessionDuration:Math.round(z),avgPagesPerSession:Math.round(B*10)/10},popularPages:G,deviceStats:Q,sessions:u,timeframe:e}}catch(t){throw console.error("Error getting analytics summary:",t),t}}static async getUserJourneyAnalytics(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),a=Fe(Ie(te,"userFlows"),Ye("timestamp",">=",n)),u=(await Ke(a)).docs.map(w=>({id:w.id,...w.data()})),h={};u.forEach(w=>{const b=`${w.fromPage}  ${w.toPage}`;h[b]=(h[b]||0)+1});const m=Object.entries(h).map(([w,b])=>({path:w,count:b})).sort((w,b)=>b.count-w.count).slice(0,10),p={},x={};return u.forEach(w=>{p[w.fromPage]=(p[w.fromPage]||0)+1,x[w.toPage]=(x[w.toPage]||0)+1}),{commonPaths:m,entryPoints:Object.entries(p).map(([w,b])=>({page:w,count:b})).sort((w,b)=>b.count-w.count).slice(0,5),exitPoints:Object.entries(x).map(([w,b])=>({page:w,count:b})).sort((w,b)=>b.count-w.count).slice(0,5)}}catch(t){throw console.error("Error getting user journey analytics:",t),t}}static generateSessionId(){return`ws_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static setupVisibilityTracking(e){let t=!document.hidden,n=Date.now();const a=()=>{const l=Date.now();if(document.hidden&&t){const u=l-n;this.trackInteraction({action:"page_hidden",element:"page",timeVisible:u},e),t=!1}else!document.hidden&&!t&&(this.trackInteraction({action:"page_visible",element:"page"},e),t=!0,n=l)};document.addEventListener("visibilitychange",a)}static setupUnloadTracking(e){const t=()=>{this.endSession(e)};window.addEventListener("beforeunload",t)}static setupScrollTracking(){let e=0,t;const n=()=>{const a=window.pageYOffset||document.documentElement.scrollTop,l=document.documentElement.scrollHeight-window.innerHeight,u=l>0?a/l*100:0;e=Math.max(e,u),clearTimeout(t),t=setTimeout(()=>{this.trackScrollDepth(Math.round(e))},1e3)};window.addEventListener("scroll",n,{passive:!0})}static setupAutoClickTracking(){document.addEventListener("click",e=>{const t=e.target.closest("[data-track]");if(t){const n={action:t.getAttribute("data-track"),text:t.textContent.trim(),id:t.id,className:t.className};this.trackClick(t.tagName.toLowerCase(),n)}})}static initializeAutoTracking(e=null){this.initializeSession(e),this.setupScrollTracking(),this.setupAutoClickTracking(),setTimeout(()=>{this.trackPageView(window.location.pathname,null,e)},100)}}const NO=({onClose:s})=>{const{user:e}=Sn(),[t,n]=M.useState(null),[a,l]=M.useState(null),[u,h]=M.useState("week"),[m,p]=M.useState(!0),[x,w]=M.useState("overview"),[b,E]=M.useState({activeSessions:0,currentPageViews:0,recentInteractions:[]});M.useEffect(()=>{if(e){k();const z=setInterval(k,3e4);return()=>clearInterval(z)}},[e,u]);const k=async()=>{try{p(!0);const[z,B]=await Promise.all([Kn.getAnalyticsSummary(u),Kn.getUserJourneyAnalytics(u)]);n(z),l(B);const q=z.sessions.filter(Q=>Q.isActive).length,G=z.sessions.flatMap(Q=>Q.actionsPerformed||[]).slice(-10);E({activeSessions:q,currentPageViews:z.summary.totalPageViews,recentInteractions:G})}catch(z){console.error("Error loading analytics:",z)}finally{p(!1)}},R=z=>{const B=Math.floor(z/3600),q=Math.floor(z%3600/60),G=z%60;return B>0?`${B}h ${q}m ${G}s`:q>0?`${q}m ${G}s`:`${G}s`},U=z=>`${Math.round(z*100)}%`;return m?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading website analytics..."})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" Website Analytics"}),i.jsx("p",{className:"claude-text-secondary",children:"Track growth, engagement, and user behavior across your platform"})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[i.jsxs("select",{value:u,onChange:z=>h(z.target.value),className:"claude-input",children:[i.jsx("option",{value:"day",children:"Today"}),i.jsx("option",{value:"week",children:"This Week"}),i.jsx("option",{value:"month",children:"This Month"})]}),i.jsx("button",{onClick:k,className:"claude-button-secondary",children:" Refresh"}),s&&i.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close"})]})]}),i.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-6",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),i.jsx("span",{className:"font-medium",children:"Live Now"})]}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[b.activeSessions," active sessions  ",b.currentPageViews," page views today"]})]}),i.jsxs("div",{className:"text-xs claude-text-muted",children:["Last updated: ",new Date().toLocaleTimeString()]})]})}),i.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"traffic",label:" Traffic",icon:""},{id:"engagement",label:" Engagement",icon:""},{id:"journeys",label:" User Journeys",icon:""},{id:"realtime",label:" Real-time",icon:""}].map(z=>i.jsxs("button",{onClick:()=>w(z.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===z.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[i.jsx("span",{className:"mr-2",children:z.icon}),i.jsx("span",{className:"hidden sm:inline",children:z.label.replace(/^.+\s/,"")})]},z.id))}),x==="overview"&&i.jsx(TO,{analytics:t,formatDuration:R,formatPercentage:U}),x==="traffic"&&i.jsx(EO,{analytics:t,formatDuration:R}),x==="engagement"&&i.jsx(SO,{analytics:t,formatDuration:R}),x==="journeys"&&i.jsx(jO,{userJourney:a}),x==="realtime"&&i.jsx(AO,{realTimeData:b,analytics:t})]})})},TO=({analytics:s,formatDuration:e,formatPercentage:t})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Lr,{title:"Unique Users",value:s?.summary?.uniqueUsers||0,icon:"",color:"blue",description:"Distinct users this period"}),i.jsx(Lr,{title:"Total Sessions",value:s?.summary?.totalSessions||0,icon:"",color:"green",description:"User sessions tracked"}),i.jsx(Lr,{title:"Page Views",value:s?.summary?.totalPageViews||0,icon:"",color:"purple",description:"Total pages visited"}),i.jsx(Lr,{title:"Avg Session Duration",value:e(s?.summary?.avgSessionDuration||0),icon:"",color:"orange",description:"Average time per session"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Popular Pages"}),i.jsxs("div",{className:"space-y-4",children:[s?.popularPages?.slice(0,8).map((n,a)=>i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-bold text-blue-800",children:a+1}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:n.page}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[n.views," views"]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-bold text-blue-600",children:e(n.avgTimeOnPage||0)}),i.jsx("div",{className:"text-sm claude-text-muted",children:"avg time"})]})]},n.page)),(!s?.popularPages||s.popularPages.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No page data available yet"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Device Breakdown"}),i.jsx("div",{className:"space-y-4",children:s?.deviceStats&&Object.entries(s.deviceStats).map(([n,a])=>{const l=Object.values(s.deviceStats).reduce((m,p)=>m+p,0),u=l>0?a/l*100:0,h=n==="mobile"?"":n==="tablet"?"":"";return i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:h}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium capitalize",children:n}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[a," sessions"]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("div",{className:"font-bold text-green-600",children:[Math.round(u),"%"]}),i.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2 mt-1",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})]})]},n)})})]})]})]}),EO=({analytics:s,formatDuration:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsx(Lr,{title:"Pages per Session",value:s?.summary?.avgPagesPerSession||0,icon:"",color:"blue",description:"Average pages viewed per session"}),i.jsx(Lr,{title:"Total Interactions",value:s?.summary?.totalInteractions||0,icon:"",color:"green",description:"Total clicks and interactions"}),i.jsx(Lr,{title:"Bounce Rate",value:`${Math.round(((s?.summary?.totalSessions-s?.summary?.totalPageViews)/s?.summary?.totalSessions||0)*100)}%`,icon:"",color:"orange",description:"Single page sessions"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Detailed Page Analytics"}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b",children:[i.jsx("th",{className:"text-left py-3 px-4 font-medium claude-text-secondary",children:"Page"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Views"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Avg Time"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Interactions"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Engagement"})]})}),i.jsx("tbody",{children:s?.popularPages?.map((t,n)=>{const a=t.views>0?t.interactions/t.views*100:0;return i.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[i.jsx("td",{className:"py-3 px-4",children:i.jsx("div",{className:"font-medium",children:t.page})}),i.jsx("td",{className:"text-right py-3 px-4 font-medium",children:t.views}),i.jsx("td",{className:"text-right py-3 px-4",children:e(t.avgTimeOnPage||0)}),i.jsx("td",{className:"text-right py-3 px-4",children:t.interactions}),i.jsx("td",{className:"text-right py-3 px-4",children:i.jsxs("span",{className:`font-medium ${a>50?"text-green-600":a>20?"text-yellow-600":"text-red-600"}`,children:[Math.round(a),"%"]})})]},t.page)})})]})})]})]}),SO=({analytics:s,formatDuration:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Lr,{title:"Click Rate",value:`${Math.round((s?.summary?.totalInteractions/s?.summary?.totalPageViews||0)*100)}%`,icon:"",color:"blue",description:"Interactions per page view"}),i.jsx(Lr,{title:"Session Depth",value:s?.summary?.avgPagesPerSession||0,icon:"",color:"green",description:"Pages explored per session"}),i.jsx(Lr,{title:"Return Rate",value:`${Math.round((s?.summary?.uniqueUsers/s?.summary?.totalSessions||0)*100)}%`,icon:"",color:"purple",description:"Users who return"}),i.jsx(Lr,{title:"Engagement Score",value:Math.round((s?.summary?.avgSessionDuration||0)/60*(s?.summary?.avgPagesPerSession||0)),icon:"",color:"orange",description:"Overall engagement rating"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Engaging Content"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s?.popularPages?.slice(0,6).map((t,n)=>{const a=(t.avgTimeOnPage||0)*(t.interactions||0)/100;return i.jsxs("div",{className:"p-4 border rounded-lg hover:border-blue-500 transition-colors",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("h4",{className:"font-medium",children:t.page}),i.jsxs("span",{className:"text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["#",n+1]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Time on Page"}),i.jsx("div",{className:"font-medium",children:e(t.avgTimeOnPage||0)})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Interactions"}),i.jsx("div",{className:"font-medium",children:t.interactions||0})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Views"}),i.jsx("div",{className:"font-medium",children:t.views})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Engagement"}),i.jsx("div",{className:"font-medium text-green-600",children:Math.round(a)})]})]})]},t.page)})})]})]}),jO=({userJourney:s})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Common User Paths"}),i.jsxs("div",{className:"space-y-4",children:[s?.commonPaths?.slice(0,8).map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-800",children:t+1}),i.jsx("div",{className:"font-mono text-sm",children:e.path})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-bold text-purple-600",children:e.count}),i.jsx("div",{className:"text-sm claude-text-muted",children:"transitions"})]})]},e.path)),(!s?.commonPaths||s.commonPaths.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No user journey data available yet"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Top Entry Points"}),i.jsxs("div",{className:"space-y-3",children:[s?.entryPoints?.map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[i.jsx("div",{className:"font-medium",children:e.page}),i.jsx("div",{className:"text-green-700 font-bold",children:e.count})]},e.page)),(!s?.entryPoints||s.entryPoints.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No entry data"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Top Exit Points"}),i.jsxs("div",{className:"space-y-3",children:[s?.exitPoints?.map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[i.jsx("div",{className:"font-medium",children:e.page}),i.jsx("div",{className:"text-red-700 font-bold",children:e.count})]},e.page)),(!s?.exitPoints||s.exitPoints.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No exit data"})]})]})]})]}),AO=({realTimeData:s,analytics:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full animate-pulse"}),i.jsx("h3",{className:"font-bold text-green-800",children:"Active Now"})]}),i.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:s.activeSessions}),i.jsx("div",{className:"text-sm text-green-700",children:"Active sessions"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"font-bold text-blue-800",children:"Page Views"})]}),i.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:s.currentPageViews}),i.jsx("div",{className:"text-sm text-blue-700",children:"Total today"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"font-bold text-purple-800",children:"Interactions"})]}),i.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:e?.summary?.totalInteractions||0}),i.jsx("div",{className:"text-sm text-purple-700",children:"Total clicks"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),i.jsxs("div",{className:"space-y-3",children:[s.recentInteractions.slice(0,10).map((t,n)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),i.jsx("span",{className:"font-medium",children:t})]}),i.jsx("span",{className:"text-sm claude-text-muted",children:"Just now"})]},n)),s.recentInteractions.length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No recent interactions"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Active Sessions Detail"}),i.jsxs("div",{className:"space-y-4",children:[e?.sessions?.filter(t=>t.isActive).slice(0,5).map((t,n)=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"font-medium",children:["Session ",t.sessionId.slice(-6)]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),i.jsx("span",{className:"text-sm text-green-600",children:"Active"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Device"}),i.jsx("div",{children:t.isMobile?" Mobile":t.isTablet?" Tablet":" Desktop"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Page Views"}),i.jsx("div",{children:t.pageViews||0})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Duration"}),i.jsxs("div",{children:[Math.round((t.timeSpent||0)/60),"m"]})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Current Page"}),i.jsx("div",{className:"truncate",children:t.currentPage||"Unknown"})]})]})]},t.sessionId)),e?.sessions?.filter(t=>t.isActive).length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No active sessions"})]})]})]}),Lr=({title:s,value:e,icon:t,color:n,description:a})=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("div",{className:"flex items-center justify-between mb-4",children:i.jsx("div",{className:"text-2xl",children:t})}),i.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),i.jsx("div",{className:"text-sm font-medium mb-1",children:s}),a&&i.jsx("div",{className:"text-xs claude-text-muted",children:a})]}),CO=()=>i.jsx("div",{className:"min-h-screen bg-[#F6F5EC] p-8",children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("h1",{className:"text-4xl font-bold mb-8",style:{color:"var(--claude-heading)"},children:" Icon System Test"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Size Variants"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:16,color:"default"}),i.jsx("span",{children:"16px - Small"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:20,color:"default"}),i.jsx("span",{children:"20px - Medium"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"default"}),i.jsx("span",{children:"24px - Large"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Color Variants"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"default"}),i.jsx("span",{children:"Default (#606164)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"primary"}),i.jsx("span",{children:"Primary (#635BFF)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"secondary"}),i.jsx("span",{children:"Secondary (#445AFF)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"success"}),i.jsx("span",{children:"Success (#5BC8A2)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"warning"}),i.jsx("span",{children:"Warning (#FFD554)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(Nn,{size:24,color:"error"}),i.jsx("span",{children:"Error (#FF6363)"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Usage Examples"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[i.jsx(Nn,{size:20,color:"primary"}),i.jsx("span",{children:"Active Tab"})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[i.jsx(Nn,{size:20,color:"default"}),i.jsx("span",{children:"Inactive Tab"})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[i.jsx(Nn,{size:24,color:"default"}),i.jsx("span",{children:"Section Header"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card md:col-span-2 lg:col-span-3",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Before vs After"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2 text-red-600",children:"Before (Emoji)"}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("span",{children:"Dashboard Overview"})]}),i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Inconsistent rendering across devices and browsers"})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2 text-green-600",children:"After (SVG Icon)"}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[i.jsx(Nn,{size:24,color:"primary"}),i.jsx("span",{children:"Dashboard Overview"})]}),i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Consistent, scalable, and matches your design theme"})]})]})]})]}),i.jsxs("div",{className:"mt-8 space-y-8",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 1 - Critical Icons (10/10) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Nn,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Dashboard"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Xi,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"User"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Qa,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Cards"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(xr,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Edit"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(T0,{size:20,color:"error"}),i.jsx("span",{className:"text-sm",children:"Delete"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(ca,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"View"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(U1,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"AI/Bot"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(kc,{size:20,color:"success"}),i.jsx("span",{className:"text-sm",children:"Success"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Pg,{size:20,color:"error"}),i.jsx("span",{className:"text-sm",children:"Error"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(B1,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Warning"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 2 - Important Icons (10/10) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(RM,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Hint"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(DM,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Proof"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(PM,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Brain"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(il,{size:24,color:"success"}),i.jsx("span",{className:"text-sm",children:"Target"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(MM,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Time"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Ec,{size:20,color:"success"}),i.jsx("span",{className:"text-sm",children:"Progress"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(OM,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Refresh"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(q1,{size:20,color:"secondary"}),i.jsx("span",{className:"text-sm",children:"Tags"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx($d,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Math"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(VM,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Mobile"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 3 - Nice to Have Icons (7/7) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(LM,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Desktop"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(FM,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Pause"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(nu,{size:16,color:"error"}),i.jsx("span",{className:"text-sm",children:"Heart"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(UM,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Support"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Dd,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Save"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(BM,{size:24,color:"default"}),i.jsx("span",{className:"text-sm",children:"Map"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(qM,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Click"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 3+ Extension - Comprehensive Icons (11/11) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Xm,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Fast"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Or,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Trophy"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(zM,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Palette"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Ba,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Search"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(HM,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Calculator"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(GM,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Microscope"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx($M,{size:20,color:"success"}),i.jsx("span",{className:"text-sm",children:"Graduation"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(ei,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Book"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(z1,{size:24,color:"success"}),i.jsx("span",{className:"text-sm",children:"Analytics"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Kx,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Social"})]})]})]}),i.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-2xl",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:" ULTIMATE ICON SYSTEM - 38 ICONS COMPLETE!"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{children:"38 Professional Icons -  Complete"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{children:"110+ SVG Assets -  Created"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{children:"All React Components -  Ready"})]})]}),i.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-4 gap-4 text-sm bg-white/50 rounded-lg p-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-green-600",children:"10"}),i.jsx("div",{className:"text-gray-600",children:"Critical Icons"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-blue-600",children:"10"}),i.jsx("div",{className:"text-gray-600",children:"Important Icons"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-purple-600",children:"8"}),i.jsx("div",{className:"text-gray-600",children:"Nice-to-Have Icons"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-orange-600",children:"11"}),i.jsx("div",{className:"text-gray-600",children:"Extension Icons"})]})]}),i.jsx("p",{className:"mt-4 text-gray-700",children:"Your comprehensive professional icon system is now complete with 39 icons covering every use case! Each icon is scalable, consistent, and matches your Claude theme perfectly. From critical UI elements to specialized features like learning analytics, scientific tools, and social community features - you have everything you need to replace emojis throughout your React application."})]})]})]})}),IO=()=>{const[s,e]=M.useState(null),[t,n]=M.useState(!1);return M.useEffect(()=>{},[]),null};class Rr{static ADMIN_EMAILS=["three.dash.sided@gmail.com"];static isAdmin(e){return!e||!e.email?!1:this.ADMIN_EMAILS.includes(e.email)}static async getAdminStatus(e){try{const n=(await bt(be(te,"users",e))).data();return{isAdmin:n?.isAdmin||!1,adminLevel:n?.adminLevel||"none",permissions:n?.adminPermissions||[]}}catch(t){return console.error("Error getting admin status:",t),{isAdmin:!1,adminLevel:"none",permissions:[]}}}static async verifyAdminAccess(e){return!e||!this.isAdmin(e)?!1:(await this.getAdminStatus(e.uid)).isAdmin}static async getAllUsers(e=100){try{const t=Fe(Ie(te,"users"),an("createdAt","desc"),on(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await bt(l(te,"profiles",l.id));m.exists()&&(h=m.data())}catch{console.warn("Could not load profile for user:",l.id)}a.push({id:l.id,...u,profile:h,displayName:h.displayName||u.displayName||u.email?.split("@")[0]||"Unknown",joinDate:u.createdAt?.toDate?.()||new Date,lastSeen:u.lastLogin?.toDate?.()||u.createdAt?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting all users:",t),t}}static async updateUserPremium(e,t){try{return await Wt(be(te,"users",e),{isPremium:t,premiumUpdatedAt:new Date,premiumUpdatedBy:"admin"}),!0}catch(n){throw console.error("Error updating user premium status:",n),n}}static async updateUserAdmin(e,t,n="admin"){try{const a={isAdmin:t,adminUpdatedAt:new Date,adminUpdatedBy:"super_admin"};return t?(a.adminLevel=n,a.adminPermissions=this.getDefaultPermissions(n)):(a.adminLevel="none",a.adminPermissions=[]),await Wt(be(te,"users",e),a),!0}catch(a){throw console.error("Error updating user admin status:",a),a}}static getDefaultPermissions(e){switch(e){case"super":return["user_management","content_moderation","system_settings","analytics_access","data_export","admin_management"];case"admin":return["user_management","content_moderation","analytics_access"];case"moderator":return["content_moderation"];default:return[]}}static async getPublicCardsForModeration(e=50){try{const t=Fe(Ie(te,"publicCards"),an("createdAt","desc"),on(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{if(u.userId){const m=await bt(l(te,"users",u.userId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}}catch{console.warn("Could not load author info for card:",l.id)}a.push({id:l.id,...u,author:h,createdDate:u.createdAt?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting public cards:",t),t}}static async moderateCard(e,t,n=""){try{const a={moderatedAt:new Date,moderatedBy:"admin",moderationAction:t,moderationReason:n};return t==="hide"?a.isHidden=!0:t==="remove"&&(a.isRemoved=!0),await Wt(be(te,"publicCards",e),a),!0}catch(a){throw console.error("Error moderating card:",a),a}}static async getSystemStats(){try{const[e,t,n]=await Promise.all([Ke(Ie(te,"users")),Ke(Ie(te,"cards")),Ke(Ie(te,"publicCards"))]),a=e.docs.map(k=>k.data()),l=a.length,u=a.filter(k=>k.isPremium).length,h=a.filter(k=>k.isAdmin).length,m=new Date(Date.now()-10080*60*1e3),p=a.filter(k=>k.createdAt?.toDate?.()>m||k.lastLogin?.toDate?.()>m).length,x=t.size,w=n.size,E=n.docs.map(k=>k.data()).filter(k=>k.createdAt?.toDate?.()>m).length;return{users:{total:l,premium:u,admin:h,recentlyActive:p,conversionRate:l>0?(u/l*100).toFixed(1):0},content:{totalPrivateCards:x,totalPublicCards:w,totalCards:x+w,recentPublicCards:E,avgCardsPerUser:l>0?((x+w)/l).toFixed(1):0},system:{lastUpdated:new Date,status:"operational"}}}catch(e){throw console.error("Error getting system stats:",e),e}}static async logAdminAction(e,t,n={}){try{await Ws(Ie(te,"adminLogs"),{adminUserId:e,action:t,details:n,timestamp:new Date,userAgent:navigator.userAgent,ip:null})}catch(a){console.error("Error logging admin action:",a)}}static async getAdminActivity(e=50){try{const t=Fe(Ie(te,"adminLogs"),an("timestamp","desc"),on(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await bt(l(te,"users",u.adminUserId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}catch{console.warn("Could not load admin info for log:",l.id)}a.push({id:l.id,...u,admin:h,timestamp:u.timestamp?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting admin activity:",t),t}}}const kO=()=>{const[s,e]=M.useState([]),[t,n]=M.useState(!1),[a,l]=M.useState(0),[u,h]=M.useState(new Set),m=async()=>{n(!0);try{const k=(await $a(Ka,"findBrokenCards")()).data;e(k.brokenCards||[]),l(k.totalCards||0)}catch(b){console.error("Error finding broken cards:",b),alert(` Failed to find broken cards: ${b.message}`)}finally{n(!1)}},p=async(b,E)=>{if(confirm(`Are you sure you want to delete this card?

ID: ${b}
Slug: ${E||"MISSING"}

This action cannot be undone.`)){h(k=>new Set(k).add(b));try{await $a(Ka,"deleteCard")({cardId:b,cardSlug:E}),e(R=>R.filter(U=>U.id!==b))}catch(k){console.error("Error deleting card:",k),alert(` Failed to delete card: ${k.message}`)}finally{h(k=>{const R=new Set(k);return R.delete(b),R})}}},x=b=>{if(!b)return"Unknown";try{const E=b.toDate?b.toDate():new Date(b);return E.toLocaleDateString()+" "+E.toLocaleTimeString()}catch{return"Invalid date"}},w=async()=>{if(s.length===0||!confirm(` DANGER: Delete ALL ${s.length} broken cards?

This will permanently delete all cards with missing/broken slugs.

This action cannot be undone. Are you absolutely sure?`))return;n(!0);let b=0,E=0;for(const k of s)try{await $a(Ka,"deleteCard")({cardId:k.id,cardSlug:k.slug}),b++}catch(R){console.error(`Failed to delete card ${k.id}:`,R),E++}e([]),n(!1),alert(` Bulk delete completed!

 Deleted: ${b}
 Failed: ${E}`)};return M.useEffect(()=>{m()},[]),i.jsx("div",{className:"space-y-6",children:i.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:" Broken Cards Review"}),i.jsx("button",{onClick:m,disabled:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Searching...":" Refresh"})]}),i.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:i.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a}),i.jsx("div",{className:"text-sm text-gray-600",children:"Total Cards"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.length}),i.jsx("div",{className:"text-sm text-gray-600",children:"Broken Cards"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:a-s.length}),i.jsx("div",{className:"text-sm text-gray-600",children:"Healthy Cards"})]})]})}),s.length>0&&i.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-medium text-yellow-800",children:[" Found ",s.length," broken cards"]}),i.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:'These cards have missing or invalid slugs and show as "undefined" when users try to view them.'})]}),i.jsx("button",{onClick:w,disabled:t,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:" Delete All Broken"})]})}),t&&s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Searching for broken cards..."})]}):s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-4xl mb-2",children:""}),i.jsx("h4",{className:"text-lg font-medium text-green-600 mb-1",children:"No broken cards found!"}),i.jsx("p",{className:"text-gray-600",children:"All cards have valid slugs and are working properly."})]}):i.jsx("div",{className:"space-y-4",children:s.map(b=>i.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded text-red-600",children:["ID: ",b.id]}),i.jsxs("span",{className:"text-sm font-mono bg-red-100 px-2 py-1 rounded text-red-700",children:["Slug: ",b.slug||"MISSING"]}),b.isBotPost&&i.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:" Bot Post"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("strong",{className:"text-sm text-gray-700",children:"Statement:"}),i.jsx("p",{className:"text-sm text-gray-900 mt-1 bg-gray-50 p-2 rounded",children:b.statement.length>200?b.statement.substring(0,200)+"...":b.statement})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-600",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Views:"})," ",b.viewCount]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Likes:"})," ",b.likeCount]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Author:"})," ",b.authorId?.substring(0,8)||"Unknown","..."]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Created:"})," ",x(b.createdAt)]})]})]})]}),i.jsx("button",{onClick:()=>p(b.id,b.slug),disabled:u.has(b.id),className:"ml-4 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 flex items-center gap-1",children:u.has(b.id)?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Deleting..."]}):i.jsx(i.Fragment,{children:" Delete"})})]})},b.id))})]})})},RO=()=>{const[s,e]=M.useState([]),[t,n]=M.useState(!0),[a,l]=M.useState(!0);M.useEffect(()=>{if(!a)return;const b=Fe(Ie(te,"automationLogs"),an("timestamp","desc"),on(50)),E=Hm(b,k=>{const R=k.docs.map(U=>({id:U.id,...U.data(),timestamp:U.data().timestamp?.toDate()}));e(R),n(!1)},k=>{console.error("Error listening to automation logs:",k),n(!1)});return()=>E()},[a]);const u=b=>b?b.toLocaleString():"Unknown",h=b=>{switch(b){case"started":return"";case"step_success":return"";case"step_failed":return"";case"success":return"";case"failed":return"";case"skipped":return"";case"retry_scheduled":return"";case"retrying":return"";default:return""}},m=b=>{switch(b){case"started":return"text-blue-600 bg-blue-50 border-blue-200";case"step_success":return"text-green-600 bg-green-50 border-green-200";case"step_failed":return"text-red-600 bg-red-50 border-red-200";case"success":return"text-green-700 bg-green-100 border-green-300";case"failed":return"text-red-700 bg-red-100 border-red-300";case"skipped":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"retry_scheduled":return"text-orange-600 bg-orange-50 border-orange-200";case"retrying":return"text-blue-700 bg-blue-100 border-blue-300";default:return"text-gray-600 bg-gray-50 border-gray-200"}},p=b=>{const E=s.filter(B=>B.details?.runId===b);if(E.length===0)return{total:0,completed:0,status:"unknown"};const k=E.some(B=>B.status==="started"),R=E.some(B=>B.status==="success"),U=E.some(B=>B.status==="failed"),z=E.filter(B=>B.status==="step_success").length;return{total:k?6:0,completed:z,status:U?"failed":R?"success":k?"running":"unknown"}},x=s.reduce((b,E)=>{const k=E.details?.runId||"unknown";return b[k]||(b[k]=[]),b[k].push(E),b},{}),w=Object.entries(x).sort((b,E)=>{const k=Math.max(...b[1].map(U=>U.timestamp?.getTime()||0));return Math.max(...E[1].map(U=>U.timestamp?.getTime()||0))-k});return t?i.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Loading Automation Monitor..."})]})}):i.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:" Automation Monitor"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`h-2 w-2 rounded-full ${a?"bg-green-500 animate-pulse":"bg-gray-400"}`}),i.jsx("span",{className:"text-sm text-gray-600",children:a?"Live":"Paused"}),i.jsx("button",{onClick:()=>l(!a),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${a?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a?"Pause":"Resume"})]})]}),s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-4xl mb-2",children:""}),i.jsx("h4",{className:"text-lg font-medium text-gray-600 mb-1",children:"No automation logs yet"}),i.jsx("p",{className:"text-gray-500",children:"Logs will appear here when the automation runs"})]}):i.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.slice(0,10).map(([b,E])=>{const k=p(b),R=E[0],U=R.timestamp&&Date.now()-R.timestamp.getTime()<300*1e3;return i.jsxs("div",{className:`border rounded-lg p-4 ${U?"ring-2 ring-blue-200 border-blue-300":"border-gray-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:[b.substring(0,12),"..."]}),i.jsxs("span",{className:`text-xs px-2 py-1 rounded border ${m(k.status)}`,children:[h(k.status)," ",k.status.toUpperCase()]}),k.total>0&&i.jsxs("span",{className:"text-xs text-gray-500",children:[k.completed,"/",k.total," steps"]})]}),i.jsx("span",{className:"text-xs text-gray-500",children:u(R.timestamp)})]}),k.total>0&&i.jsx("div",{className:"mb-3",children:i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${k.status==="failed"?"bg-red-500":k.status==="success"?"bg-green-500":"bg-blue-500"}`,style:{width:`${k.completed/k.total*100}%`}})})}),i.jsxs("div",{className:"space-y-1",children:[E.slice(0,3).map((z,B)=>i.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[i.jsx("span",{className:"text-xs",children:h(z.status)}),i.jsxs("div",{className:"flex-1",children:[i.jsx("span",{className:"text-gray-700",children:z.details?.message||"No message"}),z.details?.error&&i.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Error: ",z.details.error]}),z.details?.step&&i.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["[",z.details.step,"]"]})]}),i.jsx("span",{className:"text-xs text-gray-400",children:u(z.timestamp)})]},z.id)),E.length>3&&i.jsxs("div",{className:"text-xs text-gray-500 pl-4",children:["+",E.length-3," more logs..."]})]})]},b)})}),i.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:i.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[i.jsx("span",{children:"Showing last 50 automation logs"}),i.jsx("span",{children:"Updates automatically every few seconds"})]})})]})};class qi{static async getBotAccounts(){try{const e=Ie(te,"botAccounts");return(await Ke(e)).docs.map(n=>({id:n.id,...n.data()}))}catch(e){throw console.error("Error getting bot accounts:",e),e}}static async getAutomationSettings(){try{const e=be(te,"automation","settings"),t=await bt(e);return t.exists()?t.data():{enabled:!1,interval:24,maxPostsPerDay:5,tags:["math","mathematics"],subjects:["mathematics"]}}catch(e){throw console.error("Error getting automation settings:",e),e}}static async updateAutomationSettings(e){try{const t=be(te,"automation","settings");await Os(t,{...e,updatedAt:Me()})}catch(t){throw console.error("Error updating automation settings:",t),t}}static async createBotAccount(e){try{const t=be(Ie(te,"botAccounts"));return await Os(t,{...e,createdAt:Me(),isActive:!0}),t.id}catch(t){throw console.error("Error creating bot account:",t),t}}static async deleteBotAccount(e){try{const t=be(te,"botAccounts",e);await rl(t)}catch(t){throw console.error("Error deleting bot account:",t),t}}}/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:H1,setPrototypeOf:oE,isFrozen:DO,getPrototypeOf:PO,getOwnPropertyDescriptor:MO}=Object;let{freeze:_s,seal:_r,create:G1}=Object,{apply:Yx,construct:Xx}=typeof Reflect<"u"&&Reflect;_s||(_s=function(e){return e});_r||(_r=function(e){return e});Yx||(Yx=function(e,t,n){return e.apply(t,n)});Xx||(Xx=function(e,t){return new e(...t)});const Zf=Ns(Array.prototype.forEach),OO=Ns(Array.prototype.lastIndexOf),lE=Ns(Array.prototype.pop),Nd=Ns(Array.prototype.push),VO=Ns(Array.prototype.splice),vm=Ns(String.prototype.toLowerCase),sx=Ns(String.prototype.toString),cE=Ns(String.prototype.match),Td=Ns(String.prototype.replace),LO=Ns(String.prototype.indexOf),FO=Ns(String.prototype.trim),Dr=Ns(Object.prototype.hasOwnProperty),bs=Ns(RegExp.prototype.test),Ed=UO(TypeError);function Ns(s){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return Yx(s,e,n)}}function UO(s){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Xx(s,t)}}function it(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vm;oE&&oE(s,null);let n=e.length;for(;n--;){let a=e[n];if(typeof a=="string"){const l=t(a);l!==a&&(DO(e)||(e[n]=l),a=l)}s[a]=!0}return s}function BO(s){for(let e=0;e<s.length;e++)Dr(s,e)||(s[e]=null);return s}function Fa(s){const e=G1(null);for(const[t,n]of H1(s))Dr(s,t)&&(Array.isArray(n)?e[t]=BO(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=Fa(n):e[t]=n);return e}function Sd(s,e){for(;s!==null;){const n=MO(s,e);if(n){if(n.get)return Ns(n.get);if(typeof n.value=="function")return Ns(n.value)}s=PO(s)}function t(){return null}return t}const uE=_s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),rx=_s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ax=_s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),qO=_s(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ix=_s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),zO=_s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),dE=_s(["#text"]),hE=_s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ox=_s(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),fE=_s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),em=_s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),HO=_r(/\{\{[\w\W]*|[\w\W]*\}\}/gm),GO=_r(/<%[\w\W]*|[\w\W]*%>/gm),$O=_r(/\$\{[\w\W]*/gm),KO=_r(/^data-[\-\w.\u00B7-\uFFFF]+$/),QO=_r(/^aria-[\-\w]+$/),$1=_r(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),YO=_r(/^(?:\w+script|data):/i),XO=_r(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),K1=_r(/^html$/i),WO=_r(/^[a-z][.\w]*(-[.\w]+)+$/i);var mE=Object.freeze({__proto__:null,ARIA_ATTR:QO,ATTR_WHITESPACE:XO,CUSTOM_ELEMENT:WO,DATA_ATTR:KO,DOCTYPE_NAME:K1,ERB_EXPR:GO,IS_ALLOWED_URI:$1,IS_SCRIPT_OR_DATA:YO,MUSTACHE_EXPR:HO,TMPLIT_EXPR:$O});const jd={element:1,text:3,progressingInstruction:7,comment:8,document:9},JO=function(){return typeof window>"u"?null:window},ZO=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const a="data-tt-policy-suffix";t&&t.hasAttribute(a)&&(n=t.getAttribute(a));const l="dompurify"+(n?"#"+n:"");try{return e.createPolicy(l,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},gE=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Q1(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:JO();const e=Pe=>Q1(Pe);if(e.version="3.2.6",e.removed=[],!s||!s.document||s.document.nodeType!==jd.document||!s.Element)return e.isSupported=!1,e;let{document:t}=s;const n=t,a=n.currentScript,{DocumentFragment:l,HTMLTemplateElement:u,Node:h,Element:m,NodeFilter:p,NamedNodeMap:x=s.NamedNodeMap||s.MozNamedAttrMap,HTMLFormElement:w,DOMParser:b,trustedTypes:E}=s,k=m.prototype,R=Sd(k,"cloneNode"),U=Sd(k,"remove"),z=Sd(k,"nextSibling"),B=Sd(k,"childNodes"),q=Sd(k,"parentNode");if(typeof u=="function"){const Pe=t.createElement("template");Pe.content&&Pe.content.ownerDocument&&(t=Pe.content.ownerDocument)}let G,Q="";const{implementation:L,createNodeIterator:P,createDocumentFragment:T,getElementsByTagName:A}=t,{importNode:F}=n;let S=gE();e.isSupported=typeof H1=="function"&&typeof q=="function"&&L&&L.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:V,ERB_EXPR:D,TMPLIT_EXPR:ke,DATA_ATTR:ne,ARIA_ATTR:O,IS_SCRIPT_OR_DATA:ie,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:ge}=mE;let{IS_ALLOWED_URI:I}=mE,W=null;const ve=it({},[...uE,...rx,...ax,...ix,...dE]);let de=null;const Ce=it({},[...hE,...ox,...fE,...em]);let ye=Object.seal(G1(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ee=null,We=null,Le=!0,wt=!0,Rt=!1,Gt=!0,st=!1,ce=!0,Ae=!1,Te=!1,$e=!1,Qe=!1,Tt=!1,gt=!1,ot=!0,Ge=!1;const $t="user-content-";let en=!0,Et=!1,Wn={},pt=null;const ut=it({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Vn=null;const jn=it({},["audio","video","img","source","image","track"]);let ii=null;const El=it({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),tr="http://www.w3.org/1998/Math/MathML",nr="http://www.w3.org/2000/svg",Jn="http://www.w3.org/1999/xhtml";let Ln=Jn,zr=!1,Tr=null;const mo=it({},[tr,nr,Jn],sx);let Hr=it({},["mi","mo","mn","ms","mtext"]),Gr=it({},["annotation-xml"]);const Er=it({},["title","style","font","a","script"]);let gs=null;const go=["application/xhtml+xml","text/html"],sr="text/html";let Kt=null,ps=null;const oi=t.createElement("form"),Sr=function(Y){return Y instanceof RegExp||Y instanceof Function},li=function(){let Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ps&&ps===Y)){if((!Y||typeof Y!="object")&&(Y={}),Y=Fa(Y),gs=go.indexOf(Y.PARSER_MEDIA_TYPE)===-1?sr:Y.PARSER_MEDIA_TYPE,Kt=gs==="application/xhtml+xml"?sx:vm,W=Dr(Y,"ALLOWED_TAGS")?it({},Y.ALLOWED_TAGS,Kt):ve,de=Dr(Y,"ALLOWED_ATTR")?it({},Y.ALLOWED_ATTR,Kt):Ce,Tr=Dr(Y,"ALLOWED_NAMESPACES")?it({},Y.ALLOWED_NAMESPACES,sx):mo,ii=Dr(Y,"ADD_URI_SAFE_ATTR")?it(Fa(El),Y.ADD_URI_SAFE_ATTR,Kt):El,Vn=Dr(Y,"ADD_DATA_URI_TAGS")?it(Fa(jn),Y.ADD_DATA_URI_TAGS,Kt):jn,pt=Dr(Y,"FORBID_CONTENTS")?it({},Y.FORBID_CONTENTS,Kt):ut,Ee=Dr(Y,"FORBID_TAGS")?it({},Y.FORBID_TAGS,Kt):Fa({}),We=Dr(Y,"FORBID_ATTR")?it({},Y.FORBID_ATTR,Kt):Fa({}),Wn=Dr(Y,"USE_PROFILES")?Y.USE_PROFILES:!1,Le=Y.ALLOW_ARIA_ATTR!==!1,wt=Y.ALLOW_DATA_ATTR!==!1,Rt=Y.ALLOW_UNKNOWN_PROTOCOLS||!1,Gt=Y.ALLOW_SELF_CLOSE_IN_ATTR!==!1,st=Y.SAFE_FOR_TEMPLATES||!1,ce=Y.SAFE_FOR_XML!==!1,Ae=Y.WHOLE_DOCUMENT||!1,Qe=Y.RETURN_DOM||!1,Tt=Y.RETURN_DOM_FRAGMENT||!1,gt=Y.RETURN_TRUSTED_TYPE||!1,$e=Y.FORCE_BODY||!1,ot=Y.SANITIZE_DOM!==!1,Ge=Y.SANITIZE_NAMED_PROPS||!1,en=Y.KEEP_CONTENT!==!1,Et=Y.IN_PLACE||!1,I=Y.ALLOWED_URI_REGEXP||$1,Ln=Y.NAMESPACE||Jn,Hr=Y.MATHML_TEXT_INTEGRATION_POINTS||Hr,Gr=Y.HTML_INTEGRATION_POINTS||Gr,ye=Y.CUSTOM_ELEMENT_HANDLING||{},Y.CUSTOM_ELEMENT_HANDLING&&Sr(Y.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ye.tagNameCheck=Y.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Y.CUSTOM_ELEMENT_HANDLING&&Sr(Y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ye.attributeNameCheck=Y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Y.CUSTOM_ELEMENT_HANDLING&&typeof Y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ye.allowCustomizedBuiltInElements=Y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),st&&(wt=!1),Tt&&(Qe=!0),Wn&&(W=it({},dE),de=[],Wn.html===!0&&(it(W,uE),it(de,hE)),Wn.svg===!0&&(it(W,rx),it(de,ox),it(de,em)),Wn.svgFilters===!0&&(it(W,ax),it(de,ox),it(de,em)),Wn.mathMl===!0&&(it(W,ix),it(de,fE),it(de,em))),Y.ADD_TAGS&&(W===ve&&(W=Fa(W)),it(W,Y.ADD_TAGS,Kt)),Y.ADD_ATTR&&(de===Ce&&(de=Fa(de)),it(de,Y.ADD_ATTR,Kt)),Y.ADD_URI_SAFE_ATTR&&it(ii,Y.ADD_URI_SAFE_ATTR,Kt),Y.FORBID_CONTENTS&&(pt===ut&&(pt=Fa(pt)),it(pt,Y.FORBID_CONTENTS,Kt)),en&&(W["#text"]=!0),Ae&&it(W,["html","head","body"]),W.table&&(it(W,["tbody"]),delete Ee.tbody),Y.TRUSTED_TYPES_POLICY){if(typeof Y.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ed('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Y.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ed('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');G=Y.TRUSTED_TYPES_POLICY,Q=G.createHTML("")}else G===void 0&&(G=ZO(E,a)),G!==null&&typeof Q=="string"&&(Q=G.createHTML(""));_s&&_s(Y),ps=Y}},Lt=it({},[...rx,...ax,...qO]),cn=it({},[...ix,...zO]),un=function(Y){let xe=q(Y);(!xe||!xe.tagName)&&(xe={namespaceURI:Ln,tagName:"template"});const je=vm(Y.tagName),St=vm(xe.tagName);return Tr[Y.namespaceURI]?Y.namespaceURI===nr?xe.namespaceURI===Jn?je==="svg":xe.namespaceURI===tr?je==="svg"&&(St==="annotation-xml"||Hr[St]):!!Lt[je]:Y.namespaceURI===tr?xe.namespaceURI===Jn?je==="math":xe.namespaceURI===nr?je==="math"&&Gr[St]:!!cn[je]:Y.namespaceURI===Jn?xe.namespaceURI===nr&&!Gr[St]||xe.namespaceURI===tr&&!Hr[St]?!1:!cn[je]&&(Er[je]||!Lt[je]):!!(gs==="application/xhtml+xml"&&Tr[Y.namespaceURI]):!1},tn=function(Y){Nd(e.removed,{element:Y});try{q(Y).removeChild(Y)}catch{U(Y)}},rr=function(Y,xe){try{Nd(e.removed,{attribute:xe.getAttributeNode(Y),from:xe})}catch{Nd(e.removed,{attribute:null,from:xe})}if(xe.removeAttribute(Y),Y==="is")if(Qe||Tt)try{tn(xe)}catch{}else try{xe.setAttribute(Y,"")}catch{}},Sl=function(Y){let xe=null,je=null;if($e)Y="<remove></remove>"+Y;else{const Ft=cE(Y,/^[\r\n\t ]+/);je=Ft&&Ft[0]}gs==="application/xhtml+xml"&&Ln===Jn&&(Y='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Y+"</body></html>");const St=G?G.createHTML(Y):Y;if(Ln===Jn)try{xe=new b().parseFromString(St,gs)}catch{}if(!xe||!xe.documentElement){xe=L.createDocument(Ln,"template",null);try{xe.documentElement.innerHTML=zr?Q:St}catch{}}const fn=xe.body||xe.documentElement;return Y&&je&&fn.insertBefore(t.createTextNode(je),fn.childNodes[0]||null),Ln===Jn?A.call(xe,Ae?"html":"body")[0]:Ae?xe.documentElement:fn},jr=function(Y){return P.call(Y.ownerDocument||Y,Y,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},ci=function(Y){return Y instanceof w&&(typeof Y.nodeName!="string"||typeof Y.textContent!="string"||typeof Y.removeChild!="function"||!(Y.attributes instanceof x)||typeof Y.removeAttribute!="function"||typeof Y.setAttribute!="function"||typeof Y.namespaceURI!="string"||typeof Y.insertBefore!="function"||typeof Y.hasChildNodes!="function")},$r=function(Y){return typeof h=="function"&&Y instanceof h};function Fn(Pe,Y,xe){Zf(Pe,je=>{je.call(e,Y,xe,ps)})}const ar=function(Y){let xe=null;if(Fn(S.beforeSanitizeElements,Y,null),ci(Y))return tn(Y),!0;const je=Kt(Y.nodeName);if(Fn(S.uponSanitizeElement,Y,{tagName:je,allowedTags:W}),ce&&Y.hasChildNodes()&&!$r(Y.firstElementChild)&&bs(/<[/\w!]/g,Y.innerHTML)&&bs(/<[/\w!]/g,Y.textContent)||Y.nodeType===jd.progressingInstruction||ce&&Y.nodeType===jd.comment&&bs(/<[/\w]/g,Y.data))return tn(Y),!0;if(!W[je]||Ee[je]){if(!Ee[je]&&Fs(je)&&(ye.tagNameCheck instanceof RegExp&&bs(ye.tagNameCheck,je)||ye.tagNameCheck instanceof Function&&ye.tagNameCheck(je)))return!1;if(en&&!pt[je]){const St=q(Y)||Y.parentNode,fn=B(Y)||Y.childNodes;if(fn&&St){const Ft=fn.length;for(let An=Ft-1;An>=0;--An){const Bn=R(fn[An],!0);Bn.__removalCount=(Y.__removalCount||0)+1,St.insertBefore(Bn,z(Y))}}}return tn(Y),!0}return Y instanceof m&&!un(Y)||(je==="noscript"||je==="noembed"||je==="noframes")&&bs(/<\/no(script|embed|frames)/i,Y.innerHTML)?(tn(Y),!0):(st&&Y.nodeType===jd.text&&(xe=Y.textContent,Zf([V,D,ke],St=>{xe=Td(xe,St," ")}),Y.textContent!==xe&&(Nd(e.removed,{element:Y.cloneNode()}),Y.textContent=xe)),Fn(S.afterSanitizeElements,Y,null),!1)},Ls=function(Y,xe,je){if(ot&&(xe==="id"||xe==="name")&&(je in t||je in oi))return!1;if(!(wt&&!We[xe]&&bs(ne,xe))){if(!(Le&&bs(O,xe))){if(!de[xe]||We[xe]){if(!(Fs(Y)&&(ye.tagNameCheck instanceof RegExp&&bs(ye.tagNameCheck,Y)||ye.tagNameCheck instanceof Function&&ye.tagNameCheck(Y))&&(ye.attributeNameCheck instanceof RegExp&&bs(ye.attributeNameCheck,xe)||ye.attributeNameCheck instanceof Function&&ye.attributeNameCheck(xe))||xe==="is"&&ye.allowCustomizedBuiltInElements&&(ye.tagNameCheck instanceof RegExp&&bs(ye.tagNameCheck,je)||ye.tagNameCheck instanceof Function&&ye.tagNameCheck(je))))return!1}else if(!ii[xe]){if(!bs(I,Td(je,$,""))){if(!((xe==="src"||xe==="xlink:href"||xe==="href")&&Y!=="script"&&LO(je,"data:")===0&&Vn[Y])){if(!(Rt&&!bs(ie,Td(je,$,"")))){if(je)return!1}}}}}}return!0},Fs=function(Y){return Y!=="annotation-xml"&&cE(Y,ge)},Un=function(Y){Fn(S.beforeSanitizeAttributes,Y,null);const{attributes:xe}=Y;if(!xe||ci(Y))return;const je={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:de,forceKeepAttr:void 0};let St=xe.length;for(;St--;){const fn=xe[St],{name:Ft,namespaceURI:An,value:Bn}=fn,os=Kt(Ft),mn=Bn;let Qt=Ft==="value"?mn:FO(mn);if(je.attrName=os,je.attrValue=Qt,je.keepAttr=!0,je.forceKeepAttr=void 0,Fn(S.uponSanitizeAttribute,Y,je),Qt=je.attrValue,Ge&&(os==="id"||os==="name")&&(rr(Ft,Y),Qt=$t+Qt),ce&&bs(/((--!?|])>)|<\/(style|title)/i,Qt)){rr(Ft,Y);continue}if(je.forceKeepAttr)continue;if(!je.keepAttr){rr(Ft,Y);continue}if(!Gt&&bs(/\/>/i,Qt)){rr(Ft,Y);continue}st&&Zf([V,D,ke],ir=>{Qt=Td(Qt,ir," ")});const po=Kt(Y.nodeName);if(!Ls(po,os,Qt)){rr(Ft,Y);continue}if(G&&typeof E=="object"&&typeof E.getAttributeType=="function"&&!An)switch(E.getAttributeType(po,os)){case"TrustedHTML":{Qt=G.createHTML(Qt);break}case"TrustedScriptURL":{Qt=G.createScriptURL(Qt);break}}if(Qt!==mn)try{An?Y.setAttributeNS(An,Ft,Qt):Y.setAttribute(Ft,Qt),ci(Y)?tn(Y):lE(e.removed)}catch{rr(Ft,Y)}}Fn(S.afterSanitizeAttributes,Y,null)},nn=function Pe(Y){let xe=null;const je=jr(Y);for(Fn(S.beforeSanitizeShadowDOM,Y,null);xe=je.nextNode();)Fn(S.uponSanitizeShadowNode,xe,null),ar(xe),Un(xe),xe.content instanceof l&&Pe(xe.content);Fn(S.afterSanitizeShadowDOM,Y,null)};return e.sanitize=function(Pe){let Y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},xe=null,je=null,St=null,fn=null;if(zr=!Pe,zr&&(Pe="<!-->"),typeof Pe!="string"&&!$r(Pe))if(typeof Pe.toString=="function"){if(Pe=Pe.toString(),typeof Pe!="string")throw Ed("dirty is not a string, aborting")}else throw Ed("toString is not a function");if(!e.isSupported)return Pe;if(Te||li(Y),e.removed=[],typeof Pe=="string"&&(Et=!1),Et){if(Pe.nodeName){const Bn=Kt(Pe.nodeName);if(!W[Bn]||Ee[Bn])throw Ed("root node is forbidden and cannot be sanitized in-place")}}else if(Pe instanceof h)xe=Sl("<!---->"),je=xe.ownerDocument.importNode(Pe,!0),je.nodeType===jd.element&&je.nodeName==="BODY"||je.nodeName==="HTML"?xe=je:xe.appendChild(je);else{if(!Qe&&!st&&!Ae&&Pe.indexOf("<")===-1)return G&&gt?G.createHTML(Pe):Pe;if(xe=Sl(Pe),!xe)return Qe?null:gt?Q:""}xe&&$e&&tn(xe.firstChild);const Ft=jr(Et?Pe:xe);for(;St=Ft.nextNode();)ar(St),Un(St),St.content instanceof l&&nn(St.content);if(Et)return Pe;if(Qe){if(Tt)for(fn=T.call(xe.ownerDocument);xe.firstChild;)fn.appendChild(xe.firstChild);else fn=xe;return(de.shadowroot||de.shadowrootmode)&&(fn=F.call(n,fn,!0)),fn}let An=Ae?xe.outerHTML:xe.innerHTML;return Ae&&W["!doctype"]&&xe.ownerDocument&&xe.ownerDocument.doctype&&xe.ownerDocument.doctype.name&&bs(K1,xe.ownerDocument.doctype.name)&&(An="<!DOCTYPE "+xe.ownerDocument.doctype.name+`>
`+An),st&&Zf([V,D,ke],Bn=>{An=Td(An,Bn," ")}),G&&gt?G.createHTML(An):An},e.setConfig=function(){let Pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};li(Pe),Te=!0},e.clearConfig=function(){ps=null,Te=!1},e.isValidAttribute=function(Pe,Y,xe){ps||li({});const je=Kt(Pe),St=Kt(Y);return Ls(je,St,xe)},e.addHook=function(Pe,Y){typeof Y=="function"&&Nd(S[Pe],Y)},e.removeHook=function(Pe,Y){if(Y!==void 0){const xe=OO(S[Pe],Y);return xe===-1?void 0:VO(S[Pe],xe,1)[0]}return lE(S[Pe])},e.removeHooks=function(Pe){S[Pe]=[]},e.removeAllHooks=function(){S=gE()},e}var lx=Q1();const eV=()=>{const{user:s}=Sn(),[e,t]=M.useState(""),[n,a]=M.useState(!1),[l,u]=M.useState(null),[h,m]=M.useState(!1),[p,x]=M.useState([]),[w,b]=M.useState(!1),[E,k]=M.useState(""),[R,U]=M.useState({enabled:!1,interval:24,lastRun:null,nextRun:null});M.useEffect(()=>{z(),B()},[]);const z=async()=>{try{const S=await qi.getBotAccounts();x(S)}catch(S){console.error("Error loading bots:",S)}},B=async()=>{try{const S=await qi.getAutomationSettings();U(S)}catch(S){console.error("Error loading automation settings:",S)}},q=async()=>{a(!0);try{const D=(await $a(Ka,"getRandomMathPost")()).data;t(D.url),confirm(`Found: "${D.question.title}" (${D.question.score} votes)

Auto-convert to flashcard?`)&&await G(D.url)}catch(S){console.error("Error getting random post:",S),alert("Failed to get random math post: "+S.message)}finally{a(!1)}},G=async(S=null)=>{const V=S||e;if(!V){alert("Please enter a Stack Exchange URL");return}a(!0);try{const ke=await $a(Ka,"convertStackExchangePost")({url:V});u(ke.data),m(!1)}catch(D){console.error("Error converting post:",D),alert("Failed to convert post: "+D.message)}finally{a(!1)}},Q=(S,V)=>{u(D=>({...D,[S]:V}))},L=async()=>{if(!E){alert("Please select a bot account");return}if(!l){alert("No conversion data available");return}a(!0);try{const V=await $a(Ka,"publishStackExchangeFlashcard")({conversion:l,botId:E});alert("Flashcard published successfully!"),u(null),t(""),k("")}catch(S){console.error("Error publishing flashcard:",S),alert("Failed to publish flashcard: "+S.message)}finally{a(!1)}},P=async()=>{try{const S={...R,enabled:!R.enabled};await qi.updateAutomationSettings(S),U(S)}catch(S){console.error("Error updating automation:",S),alert("Failed to update automation settings")}},T=async S=>{try{const V={...R,interval:parseInt(S)};await qi.updateAutomationSettings(V),U(V)}catch(V){console.error("Error updating automation interval:",V),alert("Failed to update automation interval")}},A=async()=>{if(p.length===0){alert(` No bots available!

You need to create at least one bot account before triggering automation.

Go to the "Bots" tab to create a bot first.`);return}const S=p.filter(V=>V.isActive);if(S.length===0){alert(` No active bots!

You have bots, but none are currently active.

Activate at least one bot in the "Bots" tab before triggering automation.`);return}if(confirm(`This will trigger the full automation pipeline:

1. Select random bot (from ${S.length} active bots)
2. Get random StackExchange post
3. Convert to flashcard with DeepSeek AI
4. Publish as bot
5. Bot likes own post

Continue?`)){a(!0);try{const ke=(await $a(Ka,"triggerAutomation")()).data;alert(` Automation completed successfully!

Bot: ${ke.botName}
Post ID: ${ke.postId}
Card URL: ${ke.cardUrl||"Not available"}
Source: ${ke.stackExchangeUrl}

Check the Cloud Functions logs for detailed execution info.`),z(),B()}catch(V){console.error("Error triggering automation:",V);let D=V.message;D.includes("Failed to get random math post")?D="StackExchange API issue - likely rate limited. Try again in a few minutes.":D.includes("No active bot accounts")?D="No active bots found. Create and activate a bot first.":D.includes("DeepSeek")&&(D="AI conversion failed. Check DeepSeek API key and credits."),alert(` Automation failed: ${D}

Check the browser console and Cloud Functions logs for more details.`)}finally{a(!1)}}},F=async()=>{if(confirm("Are you sure you want to stop the automation? This will disable all scheduled automated posting."))try{const S={...R,enabled:!1,lastStopped:new Date().toISOString()};await qi.updateAutomationSettings(S),U(S),alert(" Automation has been stopped. No more automated posts will be created.")}catch(S){console.error("Error stopping automation:",S),alert("Failed to stop automation: "+S.message)}};return i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[i.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:" StackExchange to Flashcard Converter"}),i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:" Automation Settings"}),i.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${R.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${R.enabled?"bg-green-500":"bg-gray-400"}`}),R.enabled?"ACTIVE":"STOPPED"]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Automated Posting Control:"}),i.jsx("div",{className:"flex gap-2",children:R.enabled?i.jsx("button",{onClick:F,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:" Stop Automation"}):i.jsxs("button",{onClick:P,disabled:n||p.length===0||p.filter(S=>S.isActive).length===0,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[i.jsx("span",{className:"animate-pulse",children:""}),"Start Automation"]})})]}),p.length===0&&i.jsx("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-1 rounded",children:" Create bots first"}),p.length>0&&p.filter(S=>S.isActive).length===0&&i.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:" Activate bots first"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Post every:"}),i.jsxs("select",{value:R.interval,onChange:S=>T(S.target.value),disabled:!R.enabled,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",children:[i.jsx("option",{value:15,children:"15 minutes"}),i.jsx("option",{value:30,children:"30 minutes"}),i.jsx("option",{value:60,children:"1 hour"}),i.jsx("option",{value:180,children:"3 hours"}),i.jsx("option",{value:360,children:"6 hours"}),i.jsx("option",{value:720,children:"12 hours"}),i.jsx("option",{value:1440,children:"24 hours"})]})]}),R.lastRun&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Last run: ",new Date(R.lastRun).toLocaleString()]}),R.nextRun&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Next run: ",new Date(R.nextRun).toLocaleString()]})]})]}),i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Manual Conversion"}),i.jsxs("div",{className:"flex gap-3 mb-4",children:[i.jsx("input",{type:"url",value:e,onChange:S=>t(S.target.value),placeholder:"https://math.stackexchange.com/questions/...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("button",{onClick:()=>G(),disabled:n||!e,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:n?"Converting...":"Convert to Flashcard"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:q,disabled:n,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:" Test: Get Random Math Post"}),i.jsxs("button",{onClick:()=>b(!w),disabled:n,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:[w?" Hide":" Review"," Broken Cards"]})]}),i.jsxs("div",{className:"border-t pt-3",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Manual Testing:"}),p.length===0&&i.jsx("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-1 rounded",children:" Create bots first"}),p.length>0&&p.filter(S=>S.isActive).length===0&&i.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:" Activate bots first"})]}),i.jsx("button",{onClick:A,disabled:n||p.length===0||p.filter(S=>S.isActive).length===0,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:" Test Full Pipeline Once"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This runs the entire automation once for testing. The scheduled automation above runs automatically."})]})]})]}),l&&i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Conversion Result"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Statement:"}),h?i.jsx("textarea",{value:l.statement,onChange:S=>Q("statement",S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4}):i.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:lx.sanitize(l.statement)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hints:"}),h?i.jsx("textarea",{value:l.hints,onChange:S=>Q("hints",S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}):i.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:lx.sanitize(l.hints)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof:"}),h?i.jsx("textarea",{value:l.proof,onChange:S=>Q("proof",S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4}):i.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:lx.sanitize(l.proof)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags:"}),h?i.jsx("input",{type:"text",value:l.tags?.join(", ")||"",onChange:S=>Q("tags",S.target.value.split(",").map(V=>V.trim())),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"tag1, tag2, tag3"}):i.jsx("div",{className:"flex flex-wrap gap-2",children:l.tags?.map(S=>i.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:["#",S]},S))})]})]}),i.jsxs("div",{className:"flex gap-3 mt-6",children:[i.jsx("button",{onClick:()=>m(!h),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:h?"Preview":"Edit"}),i.jsx("button",{onClick:()=>G(),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Regenerate"})]})]}),l&&i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Publish Flashcard"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bot Account:"}),i.jsxs("select",{value:E,onChange:S=>k(S.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Choose a bot..."}),p.map(S=>i.jsxs("option",{value:S.id,children:[S.displayName," (",S.email,")"]},S.id))]})]}),i.jsx("button",{onClick:L,disabled:n||!E,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:n?"Publishing...":"Publish Flashcard"})]}),w&&i.jsx(kO,{}),i.jsx(RO,{})]})},tV=()=>{const[s,e]=M.useState([]),[t,n]=M.useState(!1),[a,l]=M.useState({displayName:"",email:"",password:"",bio:"",avatar:""}),[u,h]=M.useState(!1);M.useEffect(()=>{m()},[]);const m=async()=>{n(!0);try{const b=await qi.getBotAccounts();e(b)}catch(b){console.error("Error loading bots:",b),alert("Failed to load bot accounts")}finally{n(!1)}},p=async()=>{if(!a.displayName||!a.email||!a.password){alert("Please fill in all required fields");return}n(!0);try{const b=await qi.createBotAccount(a);alert("Bot account created successfully!"),l({displayName:"",email:"",password:"",bio:"",avatar:""}),h(!1),m()}catch(b){console.error("Error creating bot:",b),alert("Failed to create bot account: "+b.message)}finally{n(!1)}},x=async b=>{if(confirm("Are you sure you want to delete this bot account? This action cannot be undone.")){n(!0);try{await qi.deleteBotAccount(b),alert("Bot account deleted successfully!"),m()}catch(E){console.error("Error deleting bot:",E),alert("Failed to delete bot account: "+E.message)}finally{n(!1)}}},w=async(b,E)=>{n(!0);try{await $a(Ka,"updateBotStatus")({botId:b,isActive:!E}),m()}catch(k){console.error("Error updating bot status:",k),alert("Failed to update bot status: "+k.message)}finally{n(!1)}};return i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[i.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:" Bot Account Management"}),i.jsxs("div",{className:"flex gap-4 mb-6",children:[i.jsx("button",{onClick:()=>h(!u),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:u?"Cancel":"+ Create New Bot"}),i.jsx("button",{onClick:m,disabled:t,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Loading...":"Refresh"})]}),u&&i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Bot Account"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name:"}),i.jsx("input",{type:"text",value:a.displayName,onChange:b=>l({...a,displayName:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., MathBot Pro"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email:"}),i.jsx("input",{type:"email",value:a.email,onChange:b=>l({...a,email:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., mathbot1@example.com"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password:"}),i.jsx("input",{type:"password",value:a.password,onChange:b=>l({...a,password:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Strong password"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar URL (optional):"}),i.jsx("input",{type:"url",value:a.avatar,onChange:b=>l({...a,avatar:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/avatar.jpg"})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio:"}),i.jsx("textarea",{value:a.bio,onChange:b=>l({...a,bio:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Brief description of this bot..."})]}),a.avatar&&i.jsxs("div",{className:"mt-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar Preview:"}),i.jsx("img",{src:a.avatar,alt:"Avatar preview",className:"w-16 h-16 rounded-full object-cover border border-gray-300",onError:b=>{b.target.style.display="none"}})]}),i.jsxs("div",{className:"flex gap-3 mt-6",children:[i.jsx("button",{onClick:p,disabled:t,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Creating...":"Create Bot"}),i.jsx("button",{onClick:()=>h(!1),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"})]})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Bot Accounts (",s.length,")"]}),t&&i.jsx("div",{className:"text-gray-600 py-4",children:"Loading bot accounts..."}),s.length===0&&!t&&i.jsx("div",{className:"text-gray-600 py-8 text-center",children:i.jsx("p",{children:"No bot accounts found. Create your first bot to get started!"})}),i.jsx("div",{className:"grid gap-4",children:s.map(b=>i.jsx("div",{className:`p-4 rounded-lg border ${b.isActive?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:b.displayName}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${b.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:b.isActive?"Active":"Inactive"})]}),i.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Email:"})," ",b.email]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Bio:"})," ",b.bio||"No bio set"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Created:"})," ",b.createdAt?b.createdAt.toDate?b.createdAt.toDate().toLocaleDateString():new Date(b.createdAt).toLocaleDateString():"Unknown"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Posts:"})," ",b.postCount||0]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Last Active:"})," ",b.lastActive?new Date(b.lastActive).toLocaleString():"Never"]})]})]}),i.jsxs("div",{className:"flex gap-2 ml-4",children:[i.jsx("button",{onClick:()=>w(b.id,b.isActive),disabled:t,className:`px-3 py-1 rounded text-sm font-medium transition-colors ${b.isActive?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:b.isActive?"Deactivate":"Activate"}),i.jsx("button",{onClick:()=>x(b.id),disabled:t,className:"px-3 py-1 rounded text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition-colors",children:"Delete"})]})]})},b.id))})]})]})},nV=({onClose:s})=>{const{user:e}=Sn(),[t,n]=M.useState(null),[a,l]=M.useState(!0),[u,h]=M.useState("overview"),[m,p]=M.useState(null),[x,w]=M.useState([]),[b,E]=M.useState([]),[k,R]=M.useState([]);M.useEffect(()=>{e&&U()},[e]);const U=async()=>{try{if(l(!0),!await Rr.verifyAdminAccess(e)){console.log(" No admin access, closing dashboard"),s&&s();return}const A=await Rr.getAdminStatus(e.uid);n(A),await z()}catch(T){console.error(" Error checking admin access:",T),s&&s()}finally{l(!1)}},z=async()=>{try{const T=await Rr.getSystemStats();p(T)}catch(T){console.error("Error loading system stats:",T)}},B=async()=>{try{const T=await Rr.getAllUsers(100);w(T)}catch(T){console.error("Error loading users:",T)}},q=async()=>{try{const T=await Rr.getPublicCardsForModeration(50);E(T)}catch(T){console.error("Error loading public cards:",T)}},G=async()=>{try{const T=await Rr.getAdminActivity(30);R(T)}catch(T){console.error("Error loading admin activity:",T)}},Q=async T=>{switch(h(T),T){case"users":await B();break;case"content":await q();break;case"activity":await G();break}},L=async(T,A)=>{try{await Rr.updateUserPremium(T,A),await Rr.logAdminAction(e.uid,"user_premium_update",{targetUserId:T,newStatus:A}),await B()}catch(F){console.error("Error updating user premium:",F),alert("Failed to update user premium status")}},P=async(T,A,F="")=>{try{await Rr.moderateCard(T,A,F),await Rr.logAdminAction(e.uid,"content_moderation",{cardId:T,action:A,reason:F}),await q()}catch(S){console.error("Error moderating card:",S),alert("Failed to moderate content")}};return a?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-red-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Verifying admin access..."})]})}):t?.isAdmin?i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2 text-red-600",children:" Admin Dashboard"}),i.jsx("p",{className:"claude-text-secondary",children:"System management and content moderation"}),i.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[i.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[t.adminLevel.toUpperCase()," ADMIN"]}),i.jsxs("span",{className:"text-sm claude-text-muted",children:["Logged in as: ",e.email]})]})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[i.jsx("button",{onClick:z,className:"claude-button-secondary",children:" Refresh Data"}),s&&i.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close Admin"})]})]}),i.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-red-50 to-orange-50 border-red-200",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-semibold text-red-800",children:"Administrator Mode Active"}),i.jsx("div",{className:"text-sm text-red-600",children:"All actions are logged. Use admin privileges responsibly."})]})]})}),i.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"users",label:" Users",icon:""},{id:"content",label:" Content",icon:""},{id:"activity",label:" Activity",icon:""},{id:"stackexchange",label:" StackExchange",icon:""},{id:"bots",label:" Bots",icon:""}].map(T=>i.jsxs("button",{onClick:()=>Q(T.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${u===T.id?"bg-blue-500 text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[i.jsx("span",{className:"mr-2",children:T.icon}),i.jsx("span",{className:"hidden sm:inline",children:T.label.replace(/^.+\s/,"")})]},T.id))}),u==="overview"&&i.jsx(sV,{systemStats:m}),u==="users"&&i.jsx(rV,{users:x,onPremiumToggle:L}),u==="content"&&i.jsx(aV,{publicCards:b,onModerate:P}),u==="stackexchange"&&i.jsxs("div",{className:"admin-section",children:[i.jsx("h3",{children:" StackExchange Integration"}),i.jsx(eV,{})]}),u==="bots"&&i.jsxs("div",{className:"admin-section",children:[i.jsx("h3",{children:" Bot Management"}),i.jsx(tV,{})]}),u==="activity"&&i.jsx(iV,{adminActivity:k})]})}):i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center max-w-md",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Access Denied"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:"You don't have administrator privileges to access this dashboard."}),i.jsx("button",{onClick:s,className:"claude-button-primary",children:"Return to App"})]})})},sV=({systemStats:s})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(tm,{title:"Total Users",value:s?.users?.total||0,icon:"",color:"blue",subtitle:`${s?.users?.recentlyActive||0} active this week`}),i.jsx(tm,{title:"Premium Users",value:s?.users?.premium||0,icon:"",color:"gold",subtitle:`${s?.users?.conversionRate||0}% conversion rate`}),i.jsx(tm,{title:"Total Content",value:s?.content?.totalCards||0,icon:"",color:"green",subtitle:`${s?.content?.totalPublicCards||0} public cards`}),i.jsx(tm,{title:"Recent Activity",value:s?.content?.recentPublicCards||0,icon:"",color:"purple",subtitle:"New public cards this week"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),"System Status"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Database"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Authentication"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"File Storage"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Analytics"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",children:" Usage Statistics"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Avg Cards per User"}),i.jsx("span",{className:"font-medium",children:s?.content?.avgCardsPerUser||0})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Admin Users"}),i.jsx("span",{className:"font-medium",children:s?.users?.admin||0})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Public vs Private"}),i.jsxs("span",{className:"font-medium",children:[s?.content?.totalPublicCards||0," / ",s?.content?.totalPrivateCards||0]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Last Updated"}),i.jsx("span",{className:"font-medium text-sm",children:s?.system?.lastUpdated?new Date(s.system.lastUpdated).toLocaleTimeString():"Never"})]})]})]})]})]}),rV=({users:s,onPremiumToggle:e})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",children:"User Management"}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," users loaded"]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold",children:t.displayName}),i.jsx("p",{className:"text-sm claude-text-muted",children:t.email}),i.jsxs("p",{className:"text-xs claude-text-muted",children:["Joined: ",t.joinDate.toLocaleDateString()]})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[t.isPremium&&i.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"Premium"}),t.isAdmin&&i.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Admin"})]})]}),i.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Profile:"}),i.jsx("span",{children:t.profile?.displayName?"Complete":"Incomplete"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Last Seen:"}),i.jsx("span",{children:t.lastSeen.toLocaleDateString()})]})]}),i.jsx("div",{className:"space-y-2",children:i.jsx("button",{onClick:()=>e(t.id,!t.isPremium),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t.isPremium?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.isPremium?" Remove Premium":" Grant Premium"})})]},t.id))})]}),aV=({publicCards:s,onModerate:e})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",children:"Content Moderation"}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," public cards"]})]}),i.jsxs("div",{className:"space-y-4",children:[s.map(t=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("h4",{className:"font-bold mb-2",children:[t.statement?.substring(0,100),"..."]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm claude-text-muted",children:[i.jsxs("span",{children:["By: ",t.author?.displayName||t.author?.email||"Unknown"]}),i.jsxs("span",{children:["Created: ",t.createdDate.toLocaleDateString()]}),i.jsxs("span",{children:["Likes: ",t.likeCount||0]}),i.jsxs("span",{children:["Views: ",t.viewCount||0]})]})]}),i.jsxs("div",{className:"flex gap-2 ml-4",children:[i.jsx("button",{onClick:()=>e(t.id,"hide","Hidden by admin"),className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-sm hover:bg-yellow-200",children:" Hide"}),i.jsx("button",{onClick:()=>e(t.id,"remove","Removed by admin"),className:"px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200",children:" Remove"})]})]}),t.isHidden&&i.jsx("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:" This card is currently hidden from public view"}),t.isRemoved&&i.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:" This card has been removed"})]},t.id)),s.length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No public cards found"})]})]}),iV=({adminActivity:s})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",children:"Admin Activity Log"}),i.jsxs("div",{className:"text-sm claude-text-muted",children:["Recent ",s.length," actions"]})]}),i.jsxs("div",{className:"space-y-3",children:[s.map(e=>i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:e.action.replace(/_/g," ").toUpperCase()}),i.jsxs("div",{className:"text-sm claude-text-muted",children:["By: ",e.admin?.displayName||e.admin?.email||"Unknown"]}),e.details&&Object.keys(e.details).length>0&&i.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:["Details: ",JSON.stringify(e.details,null,2)]})]}),i.jsx("div",{className:"text-xs claude-text-muted",children:e.timestamp.toLocaleString()})]})},e.id)),s.length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No admin activity recorded"})]})]}),tm=({title:s,value:e,icon:t,color:n,subtitle:a})=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"text-2xl",children:t}),i.jsx("div",{className:`w-3 h-3 rounded-full bg-${n}-500`})]}),i.jsx("div",{className:`text-2xl font-bold mb-1 text-${n}-600`,children:e}),i.jsx("div",{className:"text-sm font-medium mb-1",children:s}),a&&i.jsx("div",{className:"text-xs claude-text-muted",children:a})]});function oV(){const[s,e]=M.useState("home"),[t,n]=M.useState(null),[a,l]=M.useState(null),[u,h]=M.useState(null),[m,p]=M.useState({hasProfile:!1,hasCards:!1}),[x,w]=M.useState(!1),[b,E]=M.useState(!1),[k,R]=M.useState(!1),[U,z]=M.useState(!1),[B,q]=M.useState(0),[G,Q]=M.useState(!1),{user:L,signInWithGoogle:P,logout:T,authError:A,getFreshIdToken:F,sessionWarning:S,dismissSessionWarning:V}=Sn();M.useEffect(()=>{L&&ke()},[L]),M.useEffect(()=>{Kn.initializeAutoTracking(L?.uid),Kn.trackFeatureUsage("app","loaded",{userLoggedIn:!!L},L?.uid)},[]),M.useEffect(()=>{if(s){Kn.trackPageView(`/new/${s}`,null,L?.uid),Kn.trackUserFlow(localStorage.getItem("lastMode")||"home",s,"navigation",L?.uid),localStorage.setItem("lastMode",s);const ye=new URL(window.location);ye.searchParams.set("mode",s),window.history.replaceState({mode:s},"",ye.toString())}},[s]),M.useEffect(()=>{const ye=Le=>{const Rt=new URLSearchParams(window.location.search).get("mode")||Le.state?.mode||"home";e(Rt)};window.addEventListener("popstate",ye);const We=new URLSearchParams(window.location.search).get("mode");return We&&e(We),()=>window.removeEventListener("popstate",ye)},[]),M.useEffect(()=>{L?(Kn.trackConversion("user_login",1,L.uid),Kn.trackFeatureUsage("auth","login_success",{},L.uid),D()):Q(!1)},[L]);const D=async()=>{try{const ye=await Rr.verifyAdminAccess(L);Q(ye)}catch(ye){console.error("Error checking admin status:",ye),Q(!1)}},ke=async()=>{try{const ye=await ym.checkOnboardingStatus(L.uid),Ee=await Rs.hasProfile(L.uid);try{const We=await ym.autoMigrateUserDecks(L.uid);We.success&&We.migrationResult&&console.log(" Deck migration completed:",We.message)}catch(We){console.warn("Deck migration failed:",We)}p({...ye,hasProfile:ye.hasProfile||Ee})}catch(ye){console.error("Error checking onboarding status:",ye)}},ne=async()=>{try{await P()}catch(ye){console.error("Error signing in:",ye)}},O=async()=>{try{await T()}catch(ye){console.error("Error signing out:",ye)}},ie=async()=>{if(!L){await ne();return}try{const ye=await ym.getUserProfile(L.uid);e(ye?"dashboard":"create-profile")}catch(ye){console.error("Error checking profile:",ye),e("create-profile")}},$=async ye=>{if(!L){await ne();return}ye==="profile"&&!m.hasProfile&&e("create-profile")},ge=async()=>{await ke(),e("home")},I=ye=>{n(ye),e("profile")},W=()=>{q(ye=>ye+1),L&&ke()},ve=()=>{switch(s){case"create":return i.jsx(KM,{onCardCreated:W,onClose:()=>e("home")});case"study":return i.jsx(YM,{},B);case"search":return i.jsx(XM,{});case"decks":return i.jsx(pO,{onCreateDeck:()=>e("create-deck"),onEditDeck:ye=>{l(ye),e("edit-deck")},onSelectDeck:ye=>{h(ye),e("study")}});case"create-deck":return i.jsx(aE,{onDeckCreated:()=>e("decks"),onClose:()=>e("decks")});case"edit-deck":return i.jsx(aE,{editingDeck:a,onDeckCreated:()=>{l(null),e("decks")},onClose:()=>{l(null),e("decks")}});case"analytics":return i.jsx(xO,{onClose:()=>e("home")});case"admin-analytics":return i.jsx(NO,{onClose:()=>e("home")});case"admin-dashboard":return i.jsx(nV,{onClose:()=>e("home")});case"leaderboard":return i.jsx(JM,{});case"dashboard":return i.jsx(tO,{});case"icon-test":return i.jsx(CO,{});case"create-profile":return i.jsx(hO,{onProfileCreated:ge,onClose:()=>e("home")});case"social":return i.jsx(fO,{onViewProfile:I});case"profile":return i.jsx(gO,{profileSlug:t,onClose:()=>e("home")});default:return Ce()}},de=()=>{const[ye,Ee]=M.useState(!1),[We,Le]=M.useState(!1),[wt,Rt]=M.useState(!1),[Gt,st]=M.useState(!1);return i.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-md border-b",style:{backgroundColor:"rgba(246, 245, 236, 0.8)",borderBottomColor:"var(--border-light)"},children:[i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3 group cursor-pointer",onClick:()=>e("home"),children:[i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"40",height:"40",className:"rounded-xl shadow-lg group-hover:shadow-blue-500/25 transition-all duration-300 group-hover:scale-105"}),i.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"})]}),i.jsx("span",{className:"text-xl md:text-2xl font-extrabold tracking-tight",style:{color:"var(--claude-heading)"},children:"ThreeSided"})]}),s==="home"&&L&&i.jsxs("div",{className:"hidden lg:flex items-center gap-3",children:[i.jsxs("button",{className:"claude-button-secondary flex items-center gap-2",onClick:()=>e("search"),children:[i.jsx(Ba,{size:16,color:"default"}),"Search"]}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>Le(!We),onBlur:()=>setTimeout(()=>Le(!1),200),children:[i.jsx(Qa,{size:16,color:"default"}),"Study "]}),We&&i.jsxs("div",{className:"absolute top-full mt-1 left-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),Le(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Qa,{size:16,color:"default"}),"My Decks"]})}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),Le(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(il,{size:16,color:"default"}),"Study Mode"]})}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),Le(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(xr,{size:16,color:"default"}),"Create Flashcard"]})})]})]}),i.jsxs("button",{className:"claude-button-secondary flex items-center gap-2",onClick:()=>e("social"),children:[i.jsx(Kx,{size:16,color:"default"}),"Social"]}),i.jsxs("button",{className:"claude-button-secondary flex items-center gap-2",onClick:()=>e("leaderboard"),children:[i.jsx(Or,{size:16,color:"default"}),"Leaderboard"]}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>Rt(!wt),onBlur:()=>setTimeout(()=>Rt(!1),200),children:[i.jsx(Xi,{size:16,color:"default"}),"Account "]}),wt&&i.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Rt(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Nn,{size:16,color:"default"}),"My Dashboard"]})}),i.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors flex items-center gap-2",onClick:()=>{ie(),Rt(!1)},children:[i.jsx(Xi,{size:16,color:"default"}),"My Profile"]}),i.jsx("div",{className:"border-t border-gray-200 my-1"}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Rt(!1),Kn.trackClick("button",{text:"Analytics",action:"view_analytics"},L?.uid)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(z1,{size:16,color:"default"}),"Learning Analytics"]})})]})]}),G&&i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"claude-button-secondary bg-red-50 text-red-700 hover:bg-red-100 border-red-200 flex items-center gap-1",onClick:()=>st(!Gt),onBlur:()=>setTimeout(()=>st(!1),200),children:" Admin "}),Gt&&i.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("admin-analytics"),st(!1),Kn.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},L?.uid)},children:" Website Analytics"}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors text-red-600",onClick:()=>{e("admin-dashboard"),st(!1),Kn.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},L?.uid)},children:" Admin Dashboard"})]})]})]}),s!=="home"&&i.jsx("div",{className:"hidden md:block",children:i.jsxs("span",{className:"text-lg font-bold",style:{color:"var(--claude-heading)"},children:[s==="create"&&" Create Flashcard",s==="study"&&" Study Mode",s==="search"&&"Search & Discovery",s==="decks"&&" My Decks",s==="create-deck"&&" Create Deck",s==="edit-deck"&&" Edit Deck",s==="analytics"&&" Learning Analytics",s==="admin-analytics"&&" Website Analytics",s==="admin-dashboard"&&" Admin Dashboard",s==="leaderboard"&&" Leaderboard & Stats",s==="dashboard"&&" My Dashboard",t&&" Profile",!t&&s==="social"&&" Social Hub",!t&&s==="create-profile"&&" Create Profile"]})}),i.jsxs("div",{className:"flex items-center gap-3",children:[L&&i.jsx("button",{className:"lg:hidden claude-button-secondary",onClick:()=>Ee(!ye),children:""}),L?i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-2 rounded-xl",style:{backgroundColor:"rgba(91, 200, 162, 0.15)",border:"1px solid var(--success)",color:"var(--success)"},children:[i.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),i.jsx("span",{className:"text-sm font-medium",children:L.displayName?.split(" ")[0]||"User"})]}),i.jsx("button",{className:"claude-button-secondary",style:{borderColor:"var(--error)",color:"var(--error)"},onClick:O,children:"Sign Out"})]}):i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[A&&i.jsx("div",{className:"text-xs text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200 max-w-xs text-right",children:A}),i.jsx("button",{className:"claude-button-primary transform hover:scale-105 transition-all duration-200",onClick:ne,style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:"Sign In"})]})]})]}),L&&ye&&i.jsx("div",{className:"lg:hidden bg-white border-t border-gray-200 shadow-lg",children:i.jsxs("div",{className:"px-4 py-3 space-y-2",children:[i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("search"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ba,{size:16,color:"default"}),"Search"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Qa,{size:16,color:"default"}),"My Decks"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(il,{size:16,color:"default"}),"Study Mode"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(xr,{size:16,color:"default"}),"Create Flashcard"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("social"),Ee(!1)},children:" Social"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("leaderboard"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Or,{size:16,color:"default"}),"Leaderboard"]})}),i.jsx("div",{className:"border-t border-gray-200 my-2"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Nn,{size:16,color:"default"}),"My Dashboard"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{ie(),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Xi,{size:16,color:"default"}),"My Profile"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Ee(!1),Kn.trackClick("button",{text:"Analytics",action:"view_analytics"},L?.uid)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Nn,{size:16,color:"default"}),"Learning Analytics"]})}),G&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"border-t border-red-200 my-2"}),i.jsx("div",{className:"px-3 py-1 text-xs font-semibold text-red-600 bg-red-50 rounded-lg mb-2",children:" ADMIN CONTROLS"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-analytics"),Ee(!1),Kn.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},L?.uid)},children:" Website Analytics"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-dashboard"),Ee(!1),Kn.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},L?.uid)},children:" Admin Dashboard"})]})]})})]})},Ce=()=>i.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[!L&&i.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[i.jsxs("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, var(--claude-background) 0%, var(--claude-subtle) 50%, var(--claude-surface) 100%)"},children:[i.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234B284E' fill-opacity='0.05'%3E%3Cpath d='m36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),i.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(99, 91, 255, 0.08)"}}),i.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(68, 90, 255, 0.08)",animationDelay:"1s"}}),i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full blur-2xl animate-pulse",style:{backgroundColor:"rgba(91, 194, 162, 0.08)",animationDelay:"2s"}})]}),i.jsxs("div",{className:"max-w-7xl mx-auto px-4 relative z-10 text-center py-16",children:[i.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full mb-6",style:{backgroundColor:"rgba(91, 194, 162, 0.15)",border:"1px solid var(--claude-success)",color:"var(--claude-success)"},children:[i.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--claude-success)"}}),i.jsx("span",{className:"text-sm font-semibold",children:"New React Version - Live Now"})]}),i.jsxs("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-extrabold tracking-tight mb-8",style:{color:"var(--heading)"},children:["Master Any Subject",i.jsx("br",{}),i.jsx("span",{style:{color:"var(--accent-primary)"},children:"with ThreeSided"})]}),i.jsxs("p",{className:"text-xl md:text-2xl max-w-4xl mx-auto mb-12 leading-relaxed claude-text-secondary",children:["Create, study, and share flashcards with ",i.jsx("span",{style:{color:"var(--claude-accent)",fontWeight:"600"},children:"AI assistance"}),". Learn faster with ",i.jsx("span",{style:{color:"var(--claude-accent-blue)",fontWeight:"600"},children:"spaced repetition"})," and a",i.jsx("span",{style:{color:"var(--claude-success)",fontWeight:"600"},children:" community library"}),"."]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[i.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group relative min-w-[200px] transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)",boxShadow:"0 8px 32px rgba(155, 139, 115, 0.25)"},children:[i.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[i.jsx(Ba,{size:20,color:"white"}),i.jsx("span",{children:"Search Flashcards"})]}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),i.jsx("button",{onClick:()=>e("leaderboard"),className:"claude-button-secondary group transform hover:scale-105 transition-all duration-300 min-w-[200px]",children:i.jsxs("span",{className:"flex items-center gap-3",children:[i.jsx(Or,{size:20,color:"default"}),i.jsx("span",{children:"View Leaderboard"})]})})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-8 justify-center items-center mt-16",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"500+"}),i.jsx("div",{className:"claude-text-muted",children:"Flashcards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),i.jsx("div",{className:"claude-text-muted",children:"Students"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"250+"}),i.jsx("div",{className:"claude-text-muted",children:"Public"})]})]})]}),i.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce",children:i.jsx("div",{className:"w-6 h-10 border-2 border-neutral-400 rounded-full flex justify-center",children:i.jsx("div",{className:"w-1 h-3 bg-neutral-400 rounded-full mt-2 animate-pulse"})})})]}),i.jsxs("div",{className:`max-w-7xl mx-auto px-4 ${L?"py-8":"py-16"}`,children:[L&&i.jsxs("div",{className:"relative p-8 mb-16 rounded-3xl bg-neutral-800/50 border border-neutral-700 backdrop-blur-sm shadow-2xl",children:[i.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r from-blue-500/5 to-purple-500/5"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--claude-heading)"},children:"Quick Actions"}),i.jsx("p",{className:"text-neutral-300 text-lg",children:"Jump into your learning journey"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6",children:[i.jsxs("button",{onClick:()=>{e("create"),Kn.trackClick("homepage_action",{action:"create_flashcard",location:"quick_actions"},L?.uid),Kn.trackFeatureUsage("flashcard","create_started",{},L?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(xr,{size:32,color:"white"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Create"}),i.jsx("div",{className:"text-white/90 text-sm",children:"New Flashcard"})]})]}),i.jsxs("button",{onClick:()=>{e("study"),Kn.trackClick("homepage_action",{action:"study_mode",location:"quick_actions"},L?.uid),Kn.trackFeatureUsage("study","session_started",{},L?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #B8A082 0%, #A68B5B 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(ei,{size:32,color:"white"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Study"}),i.jsx("div",{className:"text-white/90 text-sm",children:"Practice Mode"})]})]}),i.jsxs("button",{onClick:()=>e("search"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(Ba,{size:32,color:"white"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Search"}),i.jsx("div",{className:"text-white/90 text-sm",children:"& Discover"})]})]}),i.jsxs("button",{onClick:()=>e("dashboard"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #7E6B5A 0%, #6D5A4A 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(il,{size:32,color:"white"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Dashboard"}),i.jsx("div",{className:"text-white/90 text-sm",children:"My Progress"})]})]}),i.jsxs("button",{onClick:()=>e("decks"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(Qa,{size:32,color:"white"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Decks"}),i.jsx("div",{className:"text-white/90 text-sm",children:"Organize Cards"})]})]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 gap-8 mb-16 lg:grid-cols-3",children:[i.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#D4A574] to-[#C19A6B] rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:i.jsx(Kx,{size:32,color:"white"})}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"CommunityDriven"}),i.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Discover and share flashcards with students worldwide. Learn from the community's collective knowledge and contribute your own."})]})]}),i.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#B8A082] to-[#A68B5B] rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:i.jsx(U1,{size:32,color:"white"})}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"AIPowered Assistance"}),i.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Get AIgenerated hints, proofs, and suggestions to help you create better flashcards faster and study more effectively."})]})]}),i.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#9B8B73] to-[#8A7A63] rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:i.jsx($d,{size:32,color:"white"})}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"LaTeX Support"}),i.jsxs("p",{className:"claude-text-secondary leading-relaxed",children:["Beautiful mathematical notation with full LaTeX rendering. Use ",i.jsx("code",{children:"$...$"})," for inline math and ",i.jsx("code",{children:"$$...$$"})," for display blocks."]})]})]})]}),i.jsxs("div",{className:"claude-card relative p-8 mb-16 backdrop-blur-sm shadow-2xl",children:[i.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-success-500/5 to-accent-500/5"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--heading)"},children:"Get Started"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Complete these quick steps to join our community"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 cursor-pointer ${L?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10"}`,onClick:()=>$("login"),children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${L?"bg-success-500 text-white":"bg-primary-500"}`,children:L?i.jsx(kc,{size:16,color:"success"}):"1"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:L?"Signed In":"Sign In"}),i.jsx("div",{className:"claude-text-secondary text-sm",children:L?`Welcome, ${L.displayName?.split(" ")[0]||"User"}!`:"Use Google to get started"})]})]})}),i.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasProfile?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":L?"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10 cursor-pointer":"bg-white/5 border-white/10 opacity-50"}`,onClick:L&&!m.hasProfile?()=>$("profile"):void 0,children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasProfile?"bg-success-500 text-white":"bg-primary-500"}`,children:m.hasProfile?i.jsx(kc,{size:16,color:"success"}):"2"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasProfile?"Profile Created":"Create Profile"}),i.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasProfile?"Profile is ready!":"Set display name & avatar"})]})]})}),i.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasCards?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":L?"bg-white/5 border-white/20":"bg-white/5 border-white/10 opacity-50"}`,children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasCards?"bg-success-500 text-white":"bg-primary-500"}`,children:m.hasCards?i.jsx(kc,{size:16,color:"success"}):"3"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasCards?"First Card Published":"Publish First Card"}),i.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasCards?"Nice work!":"Share with the community"})]})]})})]}),L&&!m.hasCards&&i.jsx("div",{className:"text-center mt-8",children:i.jsxs("button",{onClick:()=>e("create"),className:"claude-button-primary px-8 py-4 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:[i.jsx(xr,{size:20,color:"white"}),"Create Your First Card"]})})]})]}),i.jsxs("div",{className:"relative overflow-hidden p-16 mb-16 rounded-3xl bg-gradient-to-br from-accent-500/20 via-primary-500/20 to-secondary-500/20 border border-white/20 text-center group hover:scale-105 transition-all duration-500",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-accent-500/10 to-primary-500/10"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("h2",{className:"text-4xl md:text-5xl font-extrabold mb-6",style:{color:"var(--heading)"},children:"Looking for something specific?"}),i.jsxs("p",{className:"text-xl claude-text-secondary max-w-3xl mx-auto mb-8 leading-relaxed",children:["Search our community database of ",i.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"600"},children:"250+ flashcards"})," from",i.jsx("span",{style:{color:"var(--accent-secondary)",fontWeight:"600"},children:" students worldwide"}),". Find exactly what you need to ace your studies."]}),i.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group/btn relative overflow-hidden px-12 py-6 font-semibold text-lg shadow-2xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:[i.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[i.jsx(Ba,{size:20,color:"white"}),i.jsx("span",{children:"Search Community Flashcards"})]}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 opacity-0 group-hover/btn:opacity-100 transition-opacity duration-300"})]})]})]}),i.jsx("footer",{className:"claude-card relative overflow-hidden mt-24 py-16",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"inline-flex items-center gap-3 mb-4",children:[i.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"48",height:"48",className:"rounded-xl shadow-lg"}),i.jsx("span",{className:"text-3xl font-extrabold",style:{color:"var(--heading)"},children:"ThreeSided"})]}),i.jsx("p",{className:"claude-text-secondary text-lg max-w-2xl mx-auto",children:"Empowering students worldwide with AI-enhanced flashcards and collaborative learning."})]}),i.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-8 pt-8",style:{borderTop:"1px solid var(--border-light)"},children:[i.jsxs("div",{className:"claude-text-muted",children:[" ",new Date().getFullYear()," ThreeSided. Made with ",i.jsx(nu,{size:16,color:"error"})," for students."]}),i.jsxs("div",{className:"flex items-center gap-8",children:[i.jsx("a",{href:"mailto:amirbattye@gmail.com",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-primary)"},children:"Contact"}),i.jsx("a",{href:"/latex_guide.html",target:"_blank",rel:"noreferrer",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-secondary)"},children:"LaTeX Guide"}),i.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:[i.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),i.jsx("span",{className:"font-medium",children:"Beta"})]})]})]})]})})]})]});return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(de,{}),ve(),i.jsx(rO,{isVisible:x,onClose:()=>w(!1),selectedTags:[],onTagsChange:()=>{}}),i.jsx(oO,{isVisible:b,onClose:()=>E(!1)}),i.jsx(cO,{isVisible:k,onClose:()=>R(!1)}),i.jsx(dO,{isVisible:U,onClose:()=>z(!1)}),S&&i.jsx("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4 shadow-2xl",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"text-lg font-bold text-orange-600",children:"Session Timeout Warning"})]}),i.jsx("p",{className:"text-gray-700 mb-6",children:`Your session will expire soon due to inactivity. Click "Stay Active" to continue, or you'll be signed out automatically.`}),i.jsxs("div",{className:"flex gap-3 justify-end",children:[i.jsx("button",{onClick:()=>{V(),T()},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Sign Out"}),i.jsx("button",{onClick:V,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Stay Active"})]})]})}),i.jsx(IO,{})]})}const lV=()=>i.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"var(--background-main)"},children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-t-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-lg font-medium",style:{color:"var(--text-main)"},children:"Loading Three-Sided..."})]})});AC.createRoot(document.getElementById("root")).render(i.jsx(M.StrictMode,{children:i.jsx(EM,{fallback:i.jsx(lV,{}),children:i.jsx(oV,{})})}));
