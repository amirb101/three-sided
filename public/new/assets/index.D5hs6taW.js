(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();var Ey={exports:{}},ld={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A_;function dI(){if(A_)return ld;A_=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,a,l){var u=null;if(l!==void 0&&(u=""+l),a.key!==void 0&&(u=""+a.key),"key"in a){l={};for(var h in a)h!=="key"&&(l[h]=a[h])}else l=a;return a=l.ref,{$$typeof:s,type:n,key:u,ref:a!==void 0?a:null,props:l}}return ld.Fragment=e,ld.jsx=t,ld.jsxs=t,ld}var j_;function hI(){return j_||(j_=1,Ey.exports=dI()),Ey.exports}var i=hI(),Sy={exports:{}},We={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I_;function fI(){if(I_)return We;I_=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),w=Symbol.iterator;function b(D){return D===null||typeof D!="object"?null:(D=w&&D[w]||D["@@iterator"],typeof D=="function"?D:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,k={};function L(D,te,xe){this.props=D,this.context=te,this.refs=k,this.updater=xe||E}L.prototype.isReactComponent={},L.prototype.setState=function(D,te){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,te,"setState")},L.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function U(){}U.prototype=L.prototype;function F(D,te,xe){this.props=D,this.context=te,this.refs=k,this.updater=xe||E}var B=F.prototype=new U;B.constructor=F,C(B,L.prototype),B.isPureReactComponent=!0;var H=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},M=Object.prototype.hasOwnProperty;function R(D,te,xe,ue,Ie,pe){return xe=pe.ref,{$$typeof:s,type:D,key:te,ref:xe!==void 0?xe:null,props:pe}}function N(D,te){return R(D.type,te,void 0,void 0,void 0,D.props)}function A(D){return typeof D=="object"&&D!==null&&D.$$typeof===s}function V(D){var te={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(xe){return te[xe]})}var I=/\/+/g;function G(D,te){return typeof D=="object"&&D!==null&&D.key!=null?V(""+D.key):te.toString(36)}function O(){}function Ve(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(O,O):(D.status="pending",D.then(function(te){D.status==="pending"&&(D.status="fulfilled",D.value=te)},function(te){D.status==="pending"&&(D.status="rejected",D.reason=te)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function ae(D,te,xe,ue,Ie){var pe=typeof D;(pe==="undefined"||pe==="boolean")&&(D=null);var Ee=!1;if(D===null)Ee=!0;else switch(pe){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(D.$$typeof){case s:case e:Ee=!0;break;case x:return Ee=D._init,ae(Ee(D._payload),te,xe,ue,Ie)}}if(Ee)return Ie=Ie(D),Ee=ue===""?"."+G(D,0):ue,H(Ie)?(xe="",Ee!=null&&(xe=Ee.replace(I,"$&/")+"/"),ae(Ie,te,xe,"",function(Se){return Se})):Ie!=null&&(A(Ie)&&(Ie=N(Ie,xe+(Ie.key==null||D&&D.key===Ie.key?"":(""+Ie.key).replace(I,"$&/")+"/")+Ee)),te.push(Ie)),1;Ee=0;var ce=ue===""?".":ue+":";if(H(D))for(var we=0;we<D.length;we++)ue=D[we],pe=ce+G(ue,we),Ee+=ae(ue,te,xe,pe,Ie);else if(we=b(D),typeof we=="function")for(D=we.call(D),we=0;!(ue=D.next()).done;)ue=ue.value,pe=ce+G(ue,we++),Ee+=ae(ue,te,xe,pe,Ie);else if(pe==="object"){if(typeof D.then=="function")return ae(Ve(D),te,xe,ue,Ie);throw te=String(D),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function z(D,te,xe){if(D==null)return D;var ue=[],Ie=0;return ae(D,ue,"","",function(pe){return te.call(xe,pe,Ie++)}),ue}function oe(D){if(D._status===-1){var te=D._result;te=te(),te.then(function(xe){(D._status===0||D._status===-1)&&(D._status=1,D._result=xe)},function(xe){(D._status===0||D._status===-1)&&(D._status=2,D._result=xe)}),D._status===-1&&(D._status=0,D._result=te)}if(D._status===1)return D._result.default;throw D._result}var Y=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var te=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(te))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)};function be(){}return We.Children={map:z,forEach:function(D,te,xe){z(D,function(){te.apply(this,arguments)},xe)},count:function(D){var te=0;return z(D,function(){te++}),te},toArray:function(D){return z(D,function(te){return te})||[]},only:function(D){if(!A(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},We.Component=L,We.Fragment=t,We.Profiler=a,We.PureComponent=F,We.StrictMode=n,We.Suspense=m,We.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,We.__COMPILER_RUNTIME={__proto__:null,c:function(D){return $.H.useMemoCache(D)}},We.cache=function(D){return function(){return D.apply(null,arguments)}},We.cloneElement=function(D,te,xe){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var ue=C({},D.props),Ie=D.key,pe=void 0;if(te!=null)for(Ee in te.ref!==void 0&&(pe=void 0),te.key!==void 0&&(Ie=""+te.key),te)!M.call(te,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&te.ref===void 0||(ue[Ee]=te[Ee]);var Ee=arguments.length-2;if(Ee===1)ue.children=xe;else if(1<Ee){for(var ce=Array(Ee),we=0;we<Ee;we++)ce[we]=arguments[we+2];ue.children=ce}return R(D.type,Ie,void 0,void 0,pe,ue)},We.createContext=function(D){return D={$$typeof:u,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:l,_context:D},D},We.createElement=function(D,te,xe){var ue,Ie={},pe=null;if(te!=null)for(ue in te.key!==void 0&&(pe=""+te.key),te)M.call(te,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Ie[ue]=te[ue]);var Ee=arguments.length-2;if(Ee===1)Ie.children=xe;else if(1<Ee){for(var ce=Array(Ee),we=0;we<Ee;we++)ce[we]=arguments[we+2];Ie.children=ce}if(D&&D.defaultProps)for(ue in Ee=D.defaultProps,Ee)Ie[ue]===void 0&&(Ie[ue]=Ee[ue]);return R(D,pe,void 0,void 0,null,Ie)},We.createRef=function(){return{current:null}},We.forwardRef=function(D){return{$$typeof:h,render:D}},We.isValidElement=A,We.lazy=function(D){return{$$typeof:x,_payload:{_status:-1,_result:D},_init:oe}},We.memo=function(D,te){return{$$typeof:p,type:D,compare:te===void 0?null:te}},We.startTransition=function(D){var te=$.T,xe={};$.T=xe;try{var ue=D(),Ie=$.S;Ie!==null&&Ie(xe,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(be,Y)}catch(pe){Y(pe)}finally{$.T=te}},We.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},We.use=function(D){return $.H.use(D)},We.useActionState=function(D,te,xe){return $.H.useActionState(D,te,xe)},We.useCallback=function(D,te){return $.H.useCallback(D,te)},We.useContext=function(D){return $.H.useContext(D)},We.useDebugValue=function(){},We.useDeferredValue=function(D,te){return $.H.useDeferredValue(D,te)},We.useEffect=function(D,te,xe){var ue=$.H;if(typeof xe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ue.useEffect(D,te)},We.useId=function(){return $.H.useId()},We.useImperativeHandle=function(D,te,xe){return $.H.useImperativeHandle(D,te,xe)},We.useInsertionEffect=function(D,te){return $.H.useInsertionEffect(D,te)},We.useLayoutEffect=function(D,te){return $.H.useLayoutEffect(D,te)},We.useMemo=function(D,te){return $.H.useMemo(D,te)},We.useOptimistic=function(D,te){return $.H.useOptimistic(D,te)},We.useReducer=function(D,te,xe){return $.H.useReducer(D,te,xe)},We.useRef=function(D){return $.H.useRef(D)},We.useState=function(D){return $.H.useState(D)},We.useSyncExternalStore=function(D,te,xe){return $.H.useSyncExternalStore(D,te,xe)},We.useTransition=function(){return $.H.useTransition()},We.version="19.1.1",We}var C_;function Hx(){return C_||(C_=1,Sy.exports=fI()),Sy.exports}var P=Hx(),Ay={exports:{}},cd={},jy={exports:{}},Iy={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R_;function mI(){return R_||(R_=1,(function(s){function e(z,oe){var Y=z.length;z.push(oe);e:for(;0<Y;){var be=Y-1>>>1,D=z[be];if(0<a(D,oe))z[be]=oe,z[Y]=D,Y=be;else break e}}function t(z){return z.length===0?null:z[0]}function n(z){if(z.length===0)return null;var oe=z[0],Y=z.pop();if(Y!==oe){z[0]=Y;e:for(var be=0,D=z.length,te=D>>>1;be<te;){var xe=2*(be+1)-1,ue=z[xe],Ie=xe+1,pe=z[Ie];if(0>a(ue,Y))Ie<D&&0>a(pe,ue)?(z[be]=pe,z[Ie]=Y,be=Ie):(z[be]=ue,z[xe]=Y,be=xe);else if(Ie<D&&0>a(pe,Y))z[be]=pe,z[Ie]=Y,be=Ie;else break e}}return oe}function a(z,oe){var Y=z.sortIndex-oe.sortIndex;return Y!==0?Y:z.id-oe.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;s.unstable_now=function(){return l.now()}}else{var u=Date,h=u.now();s.unstable_now=function(){return u.now()-h}}var m=[],p=[],x=1,w=null,b=3,E=!1,C=!1,k=!1,L=!1,U=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function H(z){for(var oe=t(p);oe!==null;){if(oe.callback===null)n(p);else if(oe.startTime<=z)n(p),oe.sortIndex=oe.expirationTime,e(m,oe);else break;oe=t(p)}}function $(z){if(k=!1,H(z),!C)if(t(m)!==null)C=!0,M||(M=!0,G());else{var oe=t(p);oe!==null&&ae($,oe.startTime-z)}}var M=!1,R=-1,N=5,A=-1;function V(){return L?!0:!(s.unstable_now()-A<N)}function I(){if(L=!1,M){var z=s.unstable_now();A=z;var oe=!0;try{e:{C=!1,k&&(k=!1,F(R),R=-1),E=!0;var Y=b;try{t:{for(H(z),w=t(m);w!==null&&!(w.expirationTime>z&&V());){var be=w.callback;if(typeof be=="function"){w.callback=null,b=w.priorityLevel;var D=be(w.expirationTime<=z);if(z=s.unstable_now(),typeof D=="function"){w.callback=D,H(z),oe=!0;break t}w===t(m)&&n(m),H(z)}else n(m);w=t(m)}if(w!==null)oe=!0;else{var te=t(p);te!==null&&ae($,te.startTime-z),oe=!1}}break e}finally{w=null,b=Y,E=!1}oe=void 0}}finally{oe?G():M=!1}}}var G;if(typeof B=="function")G=function(){B(I)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,Ve=O.port2;O.port1.onmessage=I,G=function(){Ve.postMessage(null)}}else G=function(){U(I,0)};function ae(z,oe){R=U(function(){z(s.unstable_now())},oe)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(z){z.callback=null},s.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<z?Math.floor(1e3/z):5},s.unstable_getCurrentPriorityLevel=function(){return b},s.unstable_next=function(z){switch(b){case 1:case 2:case 3:var oe=3;break;default:oe=b}var Y=b;b=oe;try{return z()}finally{b=Y}},s.unstable_requestPaint=function(){L=!0},s.unstable_runWithPriority=function(z,oe){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var Y=b;b=z;try{return oe()}finally{b=Y}},s.unstable_scheduleCallback=function(z,oe,Y){var be=s.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?be+Y:be):Y=be,z){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=Y+D,z={id:x++,callback:oe,priorityLevel:z,startTime:Y,expirationTime:D,sortIndex:-1},Y>be?(z.sortIndex=Y,e(p,z),t(m)===null&&z===t(p)&&(k?(F(R),R=-1):k=!0,ae($,Y-be))):(z.sortIndex=D,e(m,z),C||E||(C=!0,M||(M=!0,G()))),z},s.unstable_shouldYield=V,s.unstable_wrapCallback=function(z){var oe=b;return function(){var Y=b;b=oe;try{return z.apply(this,arguments)}finally{b=Y}}}})(Iy)),Iy}var k_;function gI(){return k_||(k_=1,jy.exports=mI()),jy.exports}var Cy={exports:{}},ss={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D_;function pI(){if(D_)return ss;D_=1;var s=Hx();function e(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(m,p,x){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:w==null?null:""+w,children:m,containerInfo:p,implementation:x}}var u=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return ss.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,ss.createPortal=function(m,p){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(m,p,null,x)},ss.flushSync=function(m){var p=u.T,x=n.p;try{if(u.T=null,n.p=2,m)return m()}finally{u.T=p,n.p=x,n.d.f()}},ss.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,n.d.C(m,p))},ss.prefetchDNS=function(m){typeof m=="string"&&n.d.D(m)},ss.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var x=p.as,w=h(x,p.crossOrigin),b=typeof p.integrity=="string"?p.integrity:void 0,E=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;x==="style"?n.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:w,integrity:b,fetchPriority:E}):x==="script"&&n.d.X(m,{crossOrigin:w,integrity:b,fetchPriority:E,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},ss.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var x=h(p.as,p.crossOrigin);n.d.M(m,{crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&n.d.M(m)},ss.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var x=p.as,w=h(x,p.crossOrigin);n.d.L(m,x,{crossOrigin:w,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},ss.preloadModule=function(m,p){if(typeof m=="string")if(p){var x=h(p.as,p.crossOrigin);n.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else n.d.m(m)},ss.requestFormReset=function(m){n.d.r(m)},ss.unstable_batchedUpdates=function(m,p){return m(p)},ss.useFormState=function(m,p,x){return u.H.useFormState(m,p,x)},ss.useFormStatus=function(){return u.H.useHostTransitionStatus()},ss.version="19.1.1",ss}var P_;function yI(){if(P_)return Cy.exports;P_=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Cy.exports=pI(),Cy.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M_;function xI(){if(M_)return cd;M_=1;var s=gI(),e=Hx(),t=yI();function n(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function u(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(l(r)!==r)throw Error(n(188))}function m(r){var o=r.alternate;if(!o){if(o=l(r),o===null)throw Error(n(188));return o!==r?null:r}for(var c=r,d=o;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(d=g.return,d!==null){c=d;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return h(g),r;if(y===d)return h(g),o;y=y.sibling}throw Error(n(188))}if(c.return!==d.return)c=g,d=y;else{for(var T=!1,S=g.child;S;){if(S===c){T=!0,c=g,d=y;break}if(S===d){T=!0,d=g,c=y;break}S=S.sibling}if(!T){for(S=y.child;S;){if(S===c){T=!0,c=y,d=g;break}if(S===d){T=!0,d=y,c=g;break}S=S.sibling}if(!T)throw Error(n(189))}}if(c.alternate!==d)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?r:o}function p(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=p(r),o!==null)return o;r=r.sibling}return null}var x=Object.assign,w=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),U=Symbol.for("react.provider"),F=Symbol.for("react.consumer"),B=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function G(r){return r===null||typeof r!="object"?null:(r=I&&r[I]||r["@@iterator"],typeof r=="function"?r:null)}var O=Symbol.for("react.client.reference");function Ve(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===O?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case C:return"Fragment";case L:return"Profiler";case k:return"StrictMode";case $:return"Suspense";case M:return"SuspenseList";case A:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case E:return"Portal";case B:return(r.displayName||"Context")+".Provider";case F:return(r._context.displayName||"Context")+".Consumer";case H:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case R:return o=r.displayName||null,o!==null?o:Ve(r.type)||"Memo";case N:o=r._payload,r=r._init;try{return Ve(r(o))}catch{}}return null}var ae=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},be=[],D=-1;function te(r){return{current:r}}function xe(r){0>D||(r.current=be[D],be[D]=null,D--)}function ue(r,o){D++,be[D]=r.current,r.current=o}var Ie=te(null),pe=te(null),Ee=te(null),ce=te(null);function we(r,o){switch(ue(Ee,o),ue(pe,r),ue(Ie,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?t_(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=t_(o),r=n_(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}xe(Ie),ue(Ie,r)}function Se(){xe(Ie),xe(pe),xe(Ee)}function Fe(r){r.memoizedState!==null&&ue(ce,r);var o=Ie.current,c=n_(o,r.type);o!==c&&(ue(pe,r),ue(Ie,c))}function Ze(r){pe.current===r&&(xe(Ie),xe(pe)),ce.current===r&&(xe(ce),sd._currentValue=Y)}var Ge=Object.prototype.hasOwnProperty,lt=s.unstable_scheduleCallback,ze=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,gt=s.unstable_requestPaint,ct=s.unstable_now,It=s.unstable_getCurrentPriorityLevel,Gn=s.unstable_ImmediatePriority,an=s.unstable_UserBlockingPriority,$n=s.unstable_NormalPriority,wr=s.unstable_LowPriority,Ds=s.unstable_IdlePriority,Ps=s.log,Ms=s.unstable_setDisableYieldValue,_t=null,pt=null;function es(r){if(typeof Ps=="function"&&Ms(r),pt&&typeof pt.setStrictMode=="function")try{pt.setStrictMode(_t,r)}catch{}}var bn=Math.clz32?Math.clz32:Zs,Ja=Math.log,yl=Math.LN2;function Zs(r){return r>>>=0,r===0?32:31-(Ja(r)/yl|0)|0}var er=256,Kn=4194304;function kn(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Fr(r,o,c){var d=r.pendingLanes;if(d===0)return 0;var g=0,y=r.suspendedLanes,T=r.pingedLanes;r=r.warmLanes;var S=d&134217727;return S!==0?(d=S&~y,d!==0?g=kn(d):(T&=S,T!==0?g=kn(T):c||(c=S&~r,c!==0&&(g=kn(c))))):(S=d&~y,S!==0?g=kn(S):T!==0?g=kn(T):c||(c=d&~r,c!==0&&(g=kn(c)))),g===0?0:o!==0&&o!==g&&(o&y)===0&&(y=g&-g,c=o&-o,y>=c||y===32&&(c&4194048)!==0)?o:g}function _r(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function oo(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ur(){var r=er;return er<<=1,(er&4194048)===0&&(er=256),r}function Br(){var r=Kn;return Kn<<=1,(Kn&62914560)===0&&(Kn=4194304),r}function Nr(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function us(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function lo(r,o,c,d,g,y){var T=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var S=r.entanglements,q=r.expirationTimes,ne=r.hiddenUpdates;for(c=T&~c;0<c;){var de=31-bn(c),me=1<<de;S[de]=0,q[de]=-1;var re=ne[de];if(re!==null)for(ne[de]=null,de=0;de<re.length;de++){var ie=re[de];ie!==null&&(ie.lane&=-536870913)}c&=~me}d!==0&&tr(r,d,0),y!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=y&~(T&~o))}function tr(r,o,c){r.pendingLanes|=o,r.suspendedLanes&=~o;var d=31-bn(o);r.entangledLanes|=o,r.entanglements[d]=r.entanglements[d]|1073741824|c&4194090}function qt(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var d=31-bn(c),g=1<<d;g&o|r[d]&o&&(r[d]|=o),c&=~g}}function ds(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Za(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Tr(){var r=oe.p;return r!==0?r:(r=window.event,r===void 0?32:w_(r.type))}function ei(r,o){var c=oe.p;try{return oe.p=r,o()}finally{oe.p=c}}var Mt=Math.random().toString(36).slice(2),tn="__reactFiber$"+Mt,nn="__reactProps$"+Mt,Yt="__reactContainer$"+Mt,nr="__reactEvents$"+Mt,xl="__reactListeners$"+Mt,Er="__reactHandles$"+Mt,ti="__reactResources$"+Mt,qr="__reactMarker$"+Mt;function Dn(r){delete r[tn],delete r[nn],delete r[nr],delete r[xl],delete r[Er]}function sr(r){var o=r[tn];if(o)return o;for(var c=r.parentNode;c;){if(o=c[Yt]||c[tn]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=i_(r);r!==null;){if(c=r[tn])return c;r=i_(r)}return o}r=c,c=r.parentNode}return null}function Os(r){if(r=r[tn]||r[Yt]){var o=r.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return r}return null}function Vs(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(n(33))}function Pn(r){var o=r[ti];return o||(o=r[ti]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Xt(r){r[qr]=!0}var De=new Set,Q={};function ye(r,o){je(r,o),je(r+"Capture",o)}function je(r,o){for(Q[r]=o,r=0;r<o.length;r++)De.add(o[r])}var Nt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),on={},Ot={};function wn(r){return Ge.call(Ot,r)?!0:Ge.call(on,r)?!1:Nt.test(r)?Ot[r]=!0:(on[r]=!0,!1)}function Mn(r,o,c){if(wn(o))if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var d=o.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+c)}}function ts(r,o,c){if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+c)}}function ln(r,o,c,d){if(d===null)r.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(o,c,""+d)}}var zt,co;function rr(r){if(zt===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);zt=o&&o[1]||"",co=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zt+r+co}var vl=!1;function bl(r,o){if(!r||vl)return"";vl=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(o){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(ie){var re=ie}Reflect.construct(r,[],me)}else{try{me.call()}catch(ie){re=ie}r.call(me.prototype)}}else{try{throw Error()}catch(ie){re=ie}(me=r())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(ie){if(ie&&re&&typeof ie.stack=="string")return[ie.stack,re.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),T=y[0],S=y[1];if(T&&S){var q=T.split(`
`),ne=S.split(`
`);for(g=d=0;d<q.length&&!q[d].includes("DetermineComponentFrameRoot");)d++;for(;g<ne.length&&!ne[g].includes("DetermineComponentFrameRoot");)g++;if(d===q.length||g===ne.length)for(d=q.length-1,g=ne.length-1;1<=d&&0<=g&&q[d]!==ne[g];)g--;for(;1<=d&&0<=g;d--,g--)if(q[d]!==ne[g]){if(d!==1||g!==1)do if(d--,g--,0>g||q[d]!==ne[g]){var de=`
`+q[d].replace(" at new "," at ");return r.displayName&&de.includes("<anonymous>")&&(de=de.replace("<anonymous>",r.displayName)),de}while(1<=d&&0<=g);break}}}finally{vl=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?rr(c):""}function uu(r){switch(r.tag){case 26:case 27:case 5:return rr(r.type);case 16:return rr("Lazy");case 13:return rr("Suspense");case 19:return rr("SuspenseList");case 0:case 15:return bl(r.type,!1);case 11:return bl(r.type.render,!1);case 1:return bl(r.type,!0);case 31:return rr("Activity");default:return""}}function wl(r){try{var o="";do o+=uu(r),r=r.return;while(r);return o}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function hs(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function du(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ig(r){var o=du(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),d=""+r[o];if(!r.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,y=c.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return g.call(this)},set:function(T){d=""+T,y.call(this,T)}}),Object.defineProperty(r,o,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(T){d=""+T},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function _l(r){r._valueTracker||(r._valueTracker=Ig(r))}function hu(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),d="";return r&&(d=du(r)?r.checked?"true":"false":r.value),r=d,r!==c?(o.setValue(r),!0):!1}function uo(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Cg=/[\n"\\]/g;function mn(r){return r.replace(Cg,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Ls(r,o,c,d,g,y,T,S){r.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?r.type=T:r.removeAttribute("type"),o!=null?T==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+hs(o)):r.value!==""+hs(o)&&(r.value=""+hs(o)):T!=="submit"&&T!=="reset"||r.removeAttribute("value"),o!=null?ni(r,T,hs(o)):c!=null?ni(r,T,hs(c)):d!=null&&r.removeAttribute("value"),g==null&&y!=null&&(r.defaultChecked=!!y),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?r.name=""+hs(S):r.removeAttribute("name")}function ho(r,o,c,d,g,y,T,S){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(r.type=y),o!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||o!=null))return;c=c!=null?""+hs(c):"",o=o!=null?""+hs(o):c,S||o===r.value||(r.value=o),r.defaultValue=o}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=S?r.checked:!!d,r.defaultChecked=!!d,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(r.name=T)}function ni(r,o,c){o==="number"&&uo(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function fa(r,o,c,d){if(r=r.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=o.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&d&&(r[c].defaultSelected=!0)}else{for(c=""+hs(c),o=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,d&&(r[g].defaultSelected=!0);return}o!==null||r[g].disabled||(o=r[g])}o!==null&&(o.selected=!0)}}function Ct(r,o,c){if(o!=null&&(o=""+hs(o),o!==r.value&&(r.value=o),c==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=c!=null?""+hs(c):""}function fo(r,o,c,d){if(o==null){if(d!=null){if(c!=null)throw Error(n(92));if(ae(d)){if(1<d.length)throw Error(n(93));d=d[0]}c=d}c==null&&(c=""),o=c}c=hs(o),r.defaultValue=c,d=r.textContent,d===c&&d!==""&&d!==null&&(r.value=d)}function ar(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var mo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bh(r,o,c){var d=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":d?r.setProperty(o,c):typeof c!="number"||c===0||mo.has(o)?o==="float"?r.cssFloat=c:r[o]=(""+c).trim():r[o]=c+"px"}function fu(r,o,c){if(o!=null&&typeof o!="object")throw Error(n(62));if(r=r.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||o!=null&&o.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var g in o)d=o[g],o.hasOwnProperty(g)&&c[g]!==d&&bh(r,g,d)}else for(var y in o)o.hasOwnProperty(y)&&bh(r,y,o[y])}function mu(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Nl(r){return kg.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var ma=null;function ir(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ga=null,pa=null;function gu(r){var o=Os(r);if(o&&(r=o.stateNode)){var c=r[nn]||null;e:switch(r=o.stateNode,o.type){case"input":if(Ls(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+mn(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var d=c[o];if(d!==r&&d.form===r.form){var g=d[nn]||null;if(!g)throw Error(n(90));Ls(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)d=c[o],d.form===r.form&&hu(d)}break e;case"textarea":Ct(r,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&fa(r,!!c.multiple,o,!1)}}}var zr=!1;function wh(r,o,c){if(zr)return r(o,c);zr=!0;try{var d=r(o);return d}finally{if(zr=!1,(ga!==null||pa!==null)&&(gf(),ga&&(o=ga,r=pa,pa=ga=null,gu(o),r)))for(o=0;o<r.length;o++)gu(r[o])}}function go(r,o){var c=r.stateNode;if(c===null)return null;var d=c[nn]||null;if(d===null)return null;c=d[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(n(231,o,typeof c));return c}var Sr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),or=!1;if(Sr)try{var po={};Object.defineProperty(po,"passive",{get:function(){or=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{or=!1}var Hr=null,si=null,ya=null;function pu(){if(ya)return ya;var r,o=si,c=o.length,d,g="value"in Hr?Hr.value:Hr.textContent,y=g.length;for(r=0;r<c&&o[r]===g[r];r++);var T=c-r;for(d=1;d<=T&&o[c-d]===g[y-d];d++);return ya=g.slice(r,1<d?1-d:void 0)}function Gr(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function $r(){return!0}function yu(){return!1}function On(r){function o(c,d,g,y,T){this._reactName=c,this._targetInst=g,this.type=d,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var S in r)r.hasOwnProperty(S)&&(c=r[S],this[S]=c?c(y):y[S]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?$r:yu,this.isPropagationStopped=yu,this}return x(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=$r)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=$r)},persist:function(){},isPersistent:$r}),o}var bt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tl=On(bt),yo=x({},bt,{view:0,detail:0}),_h=On(yo),El,Sl,Kr,xo=x({},yo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Kr&&(Kr&&r.type==="mousemove"?(El=r.screenX-Kr.screenX,Sl=r.screenY-Kr.screenY):Sl=El=0,Kr=r),El)},movementY:function(r){return"movementY"in r?r.movementY:Sl}}),lr=On(xo),Nh=x({},xo,{dataTransfer:0}),Dg=On(Nh),vo=x({},yo,{relatedTarget:0}),Al=On(vo),xu=x({},bt,{animationName:0,elapsedTime:0,pseudoElement:0}),jl=On(xu),Th=x({},bt,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Il=On(Th),Pg=x({},bt,{data:0}),vu=On(Pg),bo={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Eh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bu(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=Sh[r])?!!o[r]:!1}function wo(){return bu}var Ah=x({},yo,{key:function(r){if(r.key){var o=bo[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Gr(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Eh[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wo,charCode:function(r){return r.type==="keypress"?Gr(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Gr(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Cl=On(Ah),jh=x({},xo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wu=On(jh),xa=x({},yo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wo}),Ih=On(xa),Ch=x({},bt,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rh=On(Ch),kh=x({},xo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Rl=On(kh),fs=x({},bt,{newState:0,oldState:0}),Dh=On(fs),Ph=[9,13,27,32],Qr=Sr&&"CompositionEvent"in window,f=null;Sr&&"documentMode"in document&&(f=document.documentMode);var v=Sr&&"TextEvent"in window&&!f,_=Sr&&(!Qr||f&&8<f&&11>=f),j=" ",J=!1;function le(r,o){switch(r){case"keyup":return Ph.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _e(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ut=!1;function _n(r,o){switch(r){case"compositionend":return _e(o);case"keypress":return o.which!==32?null:(J=!0,j);case"textInput":return r=o.data,r===j&&J?null:r;default:return null}}function dt(r,o){if(ut)return r==="compositionend"||!Qr&&le(r,o)?(r=pu(),ya=si=Hr=null,ut=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return _&&o.locale!=="ko"?null:o.data;default:return null}}var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nn(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!Vn[r.type]:o==="textarea"}function va(r,o,c,d){ga?pa?pa.push(d):pa=[d]:ga=d,o=wf(o,"onChange"),0<o.length&&(c=new Tl("onChange","change",null,c,d),r.push({event:c,listeners:o}))}var Qn=null,Yr=null;function _u(r){Xw(r,0)}function Mh(r){var o=Vs(r);if(hu(o))return r}function yb(r,o){if(r==="change")return o}var xb=!1;if(Sr){var Mg;if(Sr){var Og="oninput"in document;if(!Og){var vb=document.createElement("div");vb.setAttribute("oninput","return;"),Og=typeof vb.oninput=="function"}Mg=Og}else Mg=!1;xb=Mg&&(!document.documentMode||9<document.documentMode)}function bb(){Qn&&(Qn.detachEvent("onpropertychange",wb),Yr=Qn=null)}function wb(r){if(r.propertyName==="value"&&Mh(Yr)){var o=[];va(o,Yr,r,ir(r)),wh(_u,o)}}function B1(r,o,c){r==="focusin"?(bb(),Qn=o,Yr=c,Qn.attachEvent("onpropertychange",wb)):r==="focusout"&&bb()}function q1(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Mh(Yr)}function z1(r,o){if(r==="click")return Mh(o)}function H1(r,o){if(r==="input"||r==="change")return Mh(o)}function G1(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Fs=typeof Object.is=="function"?Object.is:G1;function Nu(r,o){if(Fs(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),d=Object.keys(o);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var g=c[d];if(!Ge.call(o,g)||!Fs(r[g],o[g]))return!1}return!0}function _b(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Nb(r,o){var c=_b(r);r=0;for(var d;c;){if(c.nodeType===3){if(d=r+c.textContent.length,r<=o&&d>=o)return{node:c,offset:o-r};r=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=_b(c)}}function Tb(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?Tb(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function Eb(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=uo(r.document);o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=uo(r.document)}return o}function Vg(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var $1=Sr&&"documentMode"in document&&11>=document.documentMode,kl=null,Lg=null,Tu=null,Fg=!1;function Sb(r,o,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Fg||kl==null||kl!==uo(d)||(d=kl,"selectionStart"in d&&Vg(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Tu&&Nu(Tu,d)||(Tu=d,d=wf(Lg,"onSelect"),0<d.length&&(o=new Tl("onSelect","select",null,o,c),r.push({event:o,listeners:d}),o.target=kl)))}function _o(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var Dl={animationend:_o("Animation","AnimationEnd"),animationiteration:_o("Animation","AnimationIteration"),animationstart:_o("Animation","AnimationStart"),transitionrun:_o("Transition","TransitionRun"),transitionstart:_o("Transition","TransitionStart"),transitioncancel:_o("Transition","TransitionCancel"),transitionend:_o("Transition","TransitionEnd")},Ug={},Ab={};Sr&&(Ab=document.createElement("div").style,"AnimationEvent"in window||(delete Dl.animationend.animation,delete Dl.animationiteration.animation,delete Dl.animationstart.animation),"TransitionEvent"in window||delete Dl.transitionend.transition);function No(r){if(Ug[r])return Ug[r];if(!Dl[r])return r;var o=Dl[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in Ab)return Ug[r]=o[c];return r}var jb=No("animationend"),Ib=No("animationiteration"),Cb=No("animationstart"),K1=No("transitionrun"),Q1=No("transitionstart"),Y1=No("transitioncancel"),Rb=No("transitionend"),kb=new Map,Bg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bg.push("scrollEnd");function Ar(r,o){kb.set(r,o),ye(o,[r])}var Db=new WeakMap;function cr(r,o){if(typeof r=="object"&&r!==null){var c=Db.get(r);return c!==void 0?c:(o={value:r,source:o,stack:wl(o)},Db.set(r,o),o)}return{value:r,source:o,stack:wl(o)}}var ur=[],Pl=0,qg=0;function Oh(){for(var r=Pl,o=qg=Pl=0;o<r;){var c=ur[o];ur[o++]=null;var d=ur[o];ur[o++]=null;var g=ur[o];ur[o++]=null;var y=ur[o];if(ur[o++]=null,d!==null&&g!==null){var T=d.pending;T===null?g.next=g:(g.next=T.next,T.next=g),d.pending=g}y!==0&&Pb(c,g,y)}}function Vh(r,o,c,d){ur[Pl++]=r,ur[Pl++]=o,ur[Pl++]=c,ur[Pl++]=d,qg|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function zg(r,o,c,d){return Vh(r,o,c,d),Lh(r)}function Ml(r,o){return Vh(r,null,null,o),Lh(r)}function Pb(r,o,c){r.lanes|=c;var d=r.alternate;d!==null&&(d.lanes|=c);for(var g=!1,y=r.return;y!==null;)y.childLanes|=c,d=y.alternate,d!==null&&(d.childLanes|=c),y.tag===22&&(r=y.stateNode,r===null||r._visibility&1||(g=!0)),r=y,y=y.return;return r.tag===3?(y=r.stateNode,g&&o!==null&&(g=31-bn(c),r=y.hiddenUpdates,d=r[g],d===null?r[g]=[o]:d.push(o),o.lane=c|536870912),y):null}function Lh(r){if(50<Yu)throw Yu=0,Yp=null,Error(n(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var Ol={};function X1(r,o,c,d){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(r,o,c,d){return new X1(r,o,c,d)}function Hg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ba(r,o){var c=r.alternate;return c===null?(c=Us(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Mb(r,o){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,o=c.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Fh(r,o,c,d,g,y){var T=0;if(d=r,typeof r=="function")Hg(r)&&(T=1);else if(typeof r=="string")T=J2(r,c,Ie.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case A:return r=Us(31,c,o,g),r.elementType=A,r.lanes=y,r;case C:return To(c.children,g,y,o);case k:T=8,g|=24;break;case L:return r=Us(12,c,o,g|2),r.elementType=L,r.lanes=y,r;case $:return r=Us(13,c,o,g),r.elementType=$,r.lanes=y,r;case M:return r=Us(19,c,o,g),r.elementType=M,r.lanes=y,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case U:case B:T=10;break e;case F:T=9;break e;case H:T=11;break e;case R:T=14;break e;case N:T=16,d=null;break e}T=29,c=Error(n(130,r===null?"null":typeof r,"")),d=null}return o=Us(T,c,o,g),o.elementType=r,o.type=d,o.lanes=y,o}function To(r,o,c,d){return r=Us(7,r,d,o),r.lanes=c,r}function Gg(r,o,c){return r=Us(6,r,null,o),r.lanes=c,r}function $g(r,o,c){return o=Us(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var Vl=[],Ll=0,Uh=null,Bh=0,dr=[],hr=0,Eo=null,wa=1,_a="";function So(r,o){Vl[Ll++]=Bh,Vl[Ll++]=Uh,Uh=r,Bh=o}function Ob(r,o,c){dr[hr++]=wa,dr[hr++]=_a,dr[hr++]=Eo,Eo=r;var d=wa;r=_a;var g=32-bn(d)-1;d&=~(1<<g),c+=1;var y=32-bn(o)+g;if(30<y){var T=g-g%5;y=(d&(1<<T)-1).toString(32),d>>=T,g-=T,wa=1<<32-bn(o)+g|c<<g|d,_a=y+r}else wa=1<<y|c<<g|d,_a=r}function Kg(r){r.return!==null&&(So(r,1),Ob(r,1,0))}function Qg(r){for(;r===Uh;)Uh=Vl[--Ll],Vl[Ll]=null,Bh=Vl[--Ll],Vl[Ll]=null;for(;r===Eo;)Eo=dr[--hr],dr[hr]=null,_a=dr[--hr],dr[hr]=null,wa=dr[--hr],dr[hr]=null}var ms=null,sn=null,xt=!1,Ao=null,Xr=!1,Yg=Error(n(519));function jo(r){var o=Error(n(418,""));throw Au(cr(o,r)),Yg}function Vb(r){var o=r.stateNode,c=r.type,d=r.memoizedProps;switch(o[tn]=r,o[nn]=d,c){case"dialog":rt("cancel",o),rt("close",o);break;case"iframe":case"object":case"embed":rt("load",o);break;case"video":case"audio":for(c=0;c<Wu.length;c++)rt(Wu[c],o);break;case"source":rt("error",o);break;case"img":case"image":case"link":rt("error",o),rt("load",o);break;case"details":rt("toggle",o);break;case"input":rt("invalid",o),ho(o,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),_l(o);break;case"select":rt("invalid",o);break;case"textarea":rt("invalid",o),fo(o,d.value,d.defaultValue,d.children),_l(o)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||d.suppressHydrationWarning===!0||e_(o.textContent,c)?(d.popover!=null&&(rt("beforetoggle",o),rt("toggle",o)),d.onScroll!=null&&rt("scroll",o),d.onScrollEnd!=null&&rt("scrollend",o),d.onClick!=null&&(o.onclick=_f),o=!0):o=!1,o||jo(r)}function Lb(r){for(ms=r.return;ms;)switch(ms.tag){case 5:case 13:Xr=!1;return;case 27:case 3:Xr=!0;return;default:ms=ms.return}}function Eu(r){if(r!==ms)return!1;if(!xt)return Lb(r),xt=!0,!1;var o=r.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||dy(r.type,r.memoizedProps)),c=!c),c&&sn&&jo(r),Lb(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(o===0){sn=Ir(r.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++;r=r.nextSibling}sn=null}}else o===27?(o=sn,vi(r.type)?(r=gy,gy=null,sn=r):sn=o):sn=ms?Ir(r.stateNode.nextSibling):null;return!0}function Su(){sn=ms=null,xt=!1}function Fb(){var r=Ao;return r!==null&&(bs===null?bs=r:bs.push.apply(bs,r),Ao=null),r}function Au(r){Ao===null?Ao=[r]:Ao.push(r)}var Xg=te(null),Io=null,Na=null;function ri(r,o,c){ue(Xg,o._currentValue),o._currentValue=c}function Ta(r){r._currentValue=Xg.current,xe(Xg)}function Wg(r,o,c){for(;r!==null;){var d=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),r===c)break;r=r.return}}function Jg(r,o,c,d){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var y=g.dependencies;if(y!==null){var T=g.child;y=y.firstContext;e:for(;y!==null;){var S=y;y=g;for(var q=0;q<o.length;q++)if(S.context===o[q]){y.lanes|=c,S=y.alternate,S!==null&&(S.lanes|=c),Wg(y.return,c,r),d||(T=null);break e}y=S.next}}else if(g.tag===18){if(T=g.return,T===null)throw Error(n(341));T.lanes|=c,y=T.alternate,y!==null&&(y.lanes|=c),Wg(T,c,r),T=null}else T=g.child;if(T!==null)T.return=g;else for(T=g;T!==null;){if(T===r){T=null;break}if(g=T.sibling,g!==null){g.return=T.return,T=g;break}T=T.return}g=T}}function ju(r,o,c,d){r=null;for(var g=o,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var T=g.alternate;if(T===null)throw Error(n(387));if(T=T.memoizedProps,T!==null){var S=g.type;Fs(g.pendingProps.value,T.value)||(r!==null?r.push(S):r=[S])}}else if(g===ce.current){if(T=g.alternate,T===null)throw Error(n(387));T.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(sd):r=[sd])}g=g.return}r!==null&&Jg(o,r,c,d),o.flags|=262144}function qh(r){for(r=r.firstContext;r!==null;){if(!Fs(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Co(r){Io=r,Na=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ns(r){return Ub(Io,r)}function zh(r,o){return Io===null&&Co(r),Ub(r,o)}function Ub(r,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},Na===null){if(r===null)throw Error(n(308));Na=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else Na=Na.next=o;return c}var W1=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(c,d){r.push(d)}};this.abort=function(){o.aborted=!0,r.forEach(function(c){return c()})}},J1=s.unstable_scheduleCallback,Z1=s.unstable_NormalPriority,Tn={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zg(){return{controller:new W1,data:new Map,refCount:0}}function Iu(r){r.refCount--,r.refCount===0&&J1(Z1,function(){r.controller.abort()})}var Cu=null,ep=0,Fl=0,Ul=null;function e2(r,o){if(Cu===null){var c=Cu=[];ep=0,Fl=ny(),Ul={status:"pending",value:void 0,then:function(d){c.push(d)}}}return ep++,o.then(Bb,Bb),o}function Bb(){if(--ep===0&&Cu!==null){Ul!==null&&(Ul.status="fulfilled");var r=Cu;Cu=null,Fl=0,Ul=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function t2(r,o){var c=[],d={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){d.status="fulfilled",d.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(d.status="rejected",d.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),d}var qb=z.S;z.S=function(r,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&e2(r,o),qb!==null&&qb(r,o)};var Ro=te(null);function tp(){var r=Ro.current;return r!==null?r:Lt.pooledCache}function Hh(r,o){o===null?ue(Ro,Ro.current):ue(Ro,o.pool)}function zb(){var r=tp();return r===null?null:{parent:Tn._currentValue,pool:r}}var Ru=Error(n(460)),Hb=Error(n(474)),Gh=Error(n(542)),np={then:function(){}};function Gb(r){return r=r.status,r==="fulfilled"||r==="rejected"}function $h(){}function $b(r,o,c){switch(c=r[c],c===void 0?r.push(o):c!==o&&(o.then($h,$h),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Qb(r),r;default:if(typeof o.status=="string")o.then($h,$h);else{if(r=Lt,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=o,r.status="pending",r.then(function(d){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=d}},function(d){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=d}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Qb(r),r}throw ku=o,Ru}}var ku=null;function Kb(){if(ku===null)throw Error(n(459));var r=ku;return ku=null,r}function Qb(r){if(r===Ru||r===Gh)throw Error(n(483))}var ai=!1;function sp(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rp(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ii(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function oi(r,o,c){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(Tt&2)!==0){var g=d.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),d.pending=o,o=Lh(r),Pb(r,null,c),o}return Vh(r,d,o,c),Lh(r)}function Du(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var d=o.lanes;d&=r.pendingLanes,c|=d,o.lanes=c,qt(r,c)}}function ap(r,o){var c=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var T={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=T:y=y.next=T,c=c.next}while(c!==null);y===null?g=y=o:y=y.next=o}else g=y=o;c={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}var ip=!1;function Pu(){if(ip){var r=Ul;if(r!==null)throw r}}function Mu(r,o,c,d){ip=!1;var g=r.updateQueue;ai=!1;var y=g.firstBaseUpdate,T=g.lastBaseUpdate,S=g.shared.pending;if(S!==null){g.shared.pending=null;var q=S,ne=q.next;q.next=null,T===null?y=ne:T.next=ne,T=q;var de=r.alternate;de!==null&&(de=de.updateQueue,S=de.lastBaseUpdate,S!==T&&(S===null?de.firstBaseUpdate=ne:S.next=ne,de.lastBaseUpdate=q))}if(y!==null){var me=g.baseState;T=0,de=ne=q=null,S=y;do{var re=S.lane&-536870913,ie=re!==S.lane;if(ie?(ht&re)===re:(d&re)===re){re!==0&&re===Fl&&(ip=!0),de!==null&&(de=de.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var He=r,Ue=S;re=o;var Dt=c;switch(Ue.tag){case 1:if(He=Ue.payload,typeof He=="function"){me=He.call(Dt,me,re);break e}me=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Ue.payload,re=typeof He=="function"?He.call(Dt,me,re):He,re==null)break e;me=x({},me,re);break e;case 2:ai=!0}}re=S.callback,re!==null&&(r.flags|=64,ie&&(r.flags|=8192),ie=g.callbacks,ie===null?g.callbacks=[re]:ie.push(re))}else ie={lane:re,tag:S.tag,payload:S.payload,callback:S.callback,next:null},de===null?(ne=de=ie,q=me):de=de.next=ie,T|=re;if(S=S.next,S===null){if(S=g.shared.pending,S===null)break;ie=S,S=ie.next,ie.next=null,g.lastBaseUpdate=ie,g.shared.pending=null}}while(!0);de===null&&(q=me),g.baseState=q,g.firstBaseUpdate=ne,g.lastBaseUpdate=de,y===null&&(g.shared.lanes=0),gi|=T,r.lanes=T,r.memoizedState=me}}function Yb(r,o){if(typeof r!="function")throw Error(n(191,r));r.call(o)}function Xb(r,o){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Yb(c[r],o)}var Bl=te(null),Kh=te(0);function Wb(r,o){r=Ra,ue(Kh,r),ue(Bl,o),Ra=r|o.baseLanes}function op(){ue(Kh,Ra),ue(Bl,Bl.current)}function lp(){Ra=Kh.current,xe(Bl),xe(Kh)}var li=0,Je=null,Rt=null,gn=null,Qh=!1,ql=!1,ko=!1,Yh=0,Ou=0,zl=null,n2=0;function cn(){throw Error(n(321))}function cp(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!Fs(r[c],o[c]))return!1;return!0}function up(r,o,c,d,g,y){return li=y,Je=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,z.H=r===null||r.memoizedState===null?P0:M0,ko=!1,y=c(d,g),ko=!1,ql&&(y=Zb(o,c,d,g)),Jb(r),y}function Jb(r){z.H=tf;var o=Rt!==null&&Rt.next!==null;if(li=0,gn=Rt=Je=null,Qh=!1,Ou=0,zl=null,o)throw Error(n(300));r===null||Ln||(r=r.dependencies,r!==null&&qh(r)&&(Ln=!0))}function Zb(r,o,c,d){Je=r;var g=0;do{if(ql&&(zl=null),Ou=0,ql=!1,25<=g)throw Error(n(301));if(g+=1,gn=Rt=null,r.updateQueue!=null){var y=r.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}z.H=c2,y=o(c,d)}while(ql);return y}function s2(){var r=z.H,o=r.useState()[0];return o=typeof o.then=="function"?Vu(o):o,r=r.useState()[0],(Rt!==null?Rt.memoizedState:null)!==r&&(Je.flags|=1024),o}function dp(){var r=Yh!==0;return Yh=0,r}function hp(r,o,c){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~c}function fp(r){if(Qh){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Qh=!1}li=0,gn=Rt=Je=null,ql=!1,Ou=Yh=0,zl=null}function xs(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?Je.memoizedState=gn=r:gn=gn.next=r,gn}function pn(){if(Rt===null){var r=Je.alternate;r=r!==null?r.memoizedState:null}else r=Rt.next;var o=gn===null?Je.memoizedState:gn.next;if(o!==null)gn=o,Rt=r;else{if(r===null)throw Je.alternate===null?Error(n(467)):Error(n(310));Rt=r,r={memoizedState:Rt.memoizedState,baseState:Rt.baseState,baseQueue:Rt.baseQueue,queue:Rt.queue,next:null},gn===null?Je.memoizedState=gn=r:gn=gn.next=r}return gn}function mp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vu(r){var o=Ou;return Ou+=1,zl===null&&(zl=[]),r=$b(zl,r,o),o=Je,(gn===null?o.memoizedState:gn.next)===null&&(o=o.alternate,z.H=o===null||o.memoizedState===null?P0:M0),r}function Xh(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Vu(r);if(r.$$typeof===B)return ns(r)}throw Error(n(438,String(r)))}function gp(r){var o=null,c=Je.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var d=Je.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(o={data:d.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=mp(),Je.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(r),d=0;d<r;d++)c[d]=V;return o.index++,c}function Ea(r,o){return typeof o=="function"?o(r):o}function Wh(r){var o=pn();return pp(o,Rt,r)}function pp(r,o,c){var d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=c;var g=r.baseQueue,y=d.pending;if(y!==null){if(g!==null){var T=g.next;g.next=y.next,y.next=T}o.baseQueue=g=y,d.pending=null}if(y=r.baseState,g===null)r.memoizedState=y;else{o=g.next;var S=T=null,q=null,ne=o,de=!1;do{var me=ne.lane&-536870913;if(me!==ne.lane?(ht&me)===me:(li&me)===me){var re=ne.revertLane;if(re===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null}),me===Fl&&(de=!0);else if((li&re)===re){ne=ne.next,re===Fl&&(de=!0);continue}else me={lane:0,revertLane:ne.revertLane,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null},q===null?(S=q=me,T=y):q=q.next=me,Je.lanes|=re,gi|=re;me=ne.action,ko&&c(y,me),y=ne.hasEagerState?ne.eagerState:c(y,me)}else re={lane:me,revertLane:ne.revertLane,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null},q===null?(S=q=re,T=y):q=q.next=re,Je.lanes|=me,gi|=me;ne=ne.next}while(ne!==null&&ne!==o);if(q===null?T=y:q.next=S,!Fs(y,r.memoizedState)&&(Ln=!0,de&&(c=Ul,c!==null)))throw c;r.memoizedState=y,r.baseState=T,r.baseQueue=q,d.lastRenderedState=y}return g===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function yp(r){var o=pn(),c=o.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=r;var d=c.dispatch,g=c.pending,y=o.memoizedState;if(g!==null){c.pending=null;var T=g=g.next;do y=r(y,T.action),T=T.next;while(T!==g);Fs(y,o.memoizedState)||(Ln=!0),o.memoizedState=y,o.baseQueue===null&&(o.baseState=y),c.lastRenderedState=y}return[y,d]}function e0(r,o,c){var d=Je,g=pn(),y=xt;if(y){if(c===void 0)throw Error(n(407));c=c()}else c=o();var T=!Fs((Rt||g).memoizedState,c);T&&(g.memoizedState=c,Ln=!0),g=g.queue;var S=s0.bind(null,d,g,r);if(Lu(2048,8,S,[r]),g.getSnapshot!==o||T||gn!==null&&gn.memoizedState.tag&1){if(d.flags|=2048,Hl(9,Jh(),n0.bind(null,d,g,c,o),null),Lt===null)throw Error(n(349));y||(li&124)!==0||t0(d,o,c)}return c}function t0(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=Je.updateQueue,o===null?(o=mp(),Je.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function n0(r,o,c,d){o.value=c,o.getSnapshot=d,r0(o)&&a0(r)}function s0(r,o,c){return c(function(){r0(o)&&a0(r)})}function r0(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!Fs(r,c)}catch{return!0}}function a0(r){var o=Ml(r,2);o!==null&&Gs(o,r,2)}function xp(r){var o=xs();if(typeof r=="function"){var c=r;if(r=c(),ko){es(!0);try{c()}finally{es(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:r},o}function i0(r,o,c,d){return r.baseState=c,pp(r,Rt,typeof d=="function"?d:Ea)}function r2(r,o,c,d,g){if(ef(r))throw Error(n(485));if(r=o.action,r!==null){var y={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){y.listeners.push(T)}};z.T!==null?c(!0):y.isTransition=!1,d(y),c=o.pending,c===null?(y.next=o.pending=y,o0(o,y)):(y.next=c.next,o.pending=c.next=y)}}function o0(r,o){var c=o.action,d=o.payload,g=r.state;if(o.isTransition){var y=z.T,T={};z.T=T;try{var S=c(g,d),q=z.S;q!==null&&q(T,S),l0(r,o,S)}catch(ne){vp(r,o,ne)}finally{z.T=y}}else try{y=c(g,d),l0(r,o,y)}catch(ne){vp(r,o,ne)}}function l0(r,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){c0(r,o,d)},function(d){return vp(r,o,d)}):c0(r,o,c)}function c0(r,o,c){o.status="fulfilled",o.value=c,u0(o),r.state=c,o=r.pending,o!==null&&(c=o.next,c===o?r.pending=null:(c=c.next,o.next=c,o0(r,c)))}function vp(r,o,c){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do o.status="rejected",o.reason=c,u0(o),o=o.next;while(o!==d)}r.action=null}function u0(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function d0(r,o){return o}function h0(r,o){if(xt){var c=Lt.formState;if(c!==null){e:{var d=Je;if(xt){if(sn){t:{for(var g=sn,y=Xr;g.nodeType!==8;){if(!y){g=null;break t}if(g=Ir(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){sn=Ir(g.nextSibling),d=g.data==="F!";break e}}jo(d)}d=!1}d&&(o=c[0])}}return c=xs(),c.memoizedState=c.baseState=o,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d0,lastRenderedState:o},c.queue=d,c=R0.bind(null,Je,d),d.dispatch=c,d=xp(!1),y=Tp.bind(null,Je,!1,d.queue),d=xs(),g={state:o,dispatch:null,action:r,pending:null},d.queue=g,c=r2.bind(null,Je,g,y,c),g.dispatch=c,d.memoizedState=r,[o,c,!1]}function f0(r){var o=pn();return m0(o,Rt,r)}function m0(r,o,c){if(o=pp(r,o,d0)[0],r=Wh(Ea)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var d=Vu(o)}catch(T){throw T===Ru?Gh:T}else d=o;o=pn();var g=o.queue,y=g.dispatch;return c!==o.memoizedState&&(Je.flags|=2048,Hl(9,Jh(),a2.bind(null,g,c),null)),[d,y,r]}function a2(r,o){r.action=o}function g0(r){var o=pn(),c=Rt;if(c!==null)return m0(o,c,r);pn(),o=o.memoizedState,c=pn();var d=c.queue.dispatch;return c.memoizedState=r,[o,d,!1]}function Hl(r,o,c,d){return r={tag:r,create:c,deps:d,inst:o,next:null},o=Je.updateQueue,o===null&&(o=mp(),Je.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=r.next=r:(d=c.next,c.next=r,r.next=d,o.lastEffect=r),r}function Jh(){return{destroy:void 0,resource:void 0}}function p0(){return pn().memoizedState}function Zh(r,o,c,d){var g=xs();d=d===void 0?null:d,Je.flags|=r,g.memoizedState=Hl(1|o,Jh(),c,d)}function Lu(r,o,c,d){var g=pn();d=d===void 0?null:d;var y=g.memoizedState.inst;Rt!==null&&d!==null&&cp(d,Rt.memoizedState.deps)?g.memoizedState=Hl(o,y,c,d):(Je.flags|=r,g.memoizedState=Hl(1|o,y,c,d))}function y0(r,o){Zh(8390656,8,r,o)}function x0(r,o){Lu(2048,8,r,o)}function v0(r,o){return Lu(4,2,r,o)}function b0(r,o){return Lu(4,4,r,o)}function w0(r,o){if(typeof o=="function"){r=r();var c=o(r);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function _0(r,o,c){c=c!=null?c.concat([r]):null,Lu(4,4,w0.bind(null,o,r),c)}function bp(){}function N0(r,o){var c=pn();o=o===void 0?null:o;var d=c.memoizedState;return o!==null&&cp(o,d[1])?d[0]:(c.memoizedState=[r,o],r)}function T0(r,o){var c=pn();o=o===void 0?null:o;var d=c.memoizedState;if(o!==null&&cp(o,d[1]))return d[0];if(d=r(),ko){es(!0);try{r()}finally{es(!1)}}return c.memoizedState=[d,o],d}function wp(r,o,c){return c===void 0||(li&1073741824)!==0?r.memoizedState=o:(r.memoizedState=c,r=Aw(),Je.lanes|=r,gi|=r,c)}function E0(r,o,c,d){return Fs(c,o)?c:Bl.current!==null?(r=wp(r,c,d),Fs(r,o)||(Ln=!0),r):(li&42)===0?(Ln=!0,r.memoizedState=c):(r=Aw(),Je.lanes|=r,gi|=r,o)}function S0(r,o,c,d,g){var y=oe.p;oe.p=y!==0&&8>y?y:8;var T=z.T,S={};z.T=S,Tp(r,!1,o,c);try{var q=g(),ne=z.S;if(ne!==null&&ne(S,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var de=t2(q,d);Fu(r,o,de,Hs(r))}else Fu(r,o,d,Hs(r))}catch(me){Fu(r,o,{then:function(){},status:"rejected",reason:me},Hs())}finally{oe.p=y,z.T=T}}function i2(){}function _p(r,o,c,d){if(r.tag!==5)throw Error(n(476));var g=A0(r).queue;S0(r,g,o,Y,c===null?i2:function(){return j0(r),c(d)})}function A0(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:Y},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:c},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function j0(r){var o=A0(r).next.queue;Fu(r,o,{},Hs())}function Np(){return ns(sd)}function I0(){return pn().memoizedState}function C0(){return pn().memoizedState}function o2(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var c=Hs();r=ii(c);var d=oi(o,r,c);d!==null&&(Gs(d,o,c),Du(d,o,c)),o={cache:Zg()},r.payload=o;return}o=o.return}}function l2(r,o,c){var d=Hs();c={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},ef(r)?k0(o,c):(c=zg(r,o,c,d),c!==null&&(Gs(c,r,d),D0(c,o,d)))}function R0(r,o,c){var d=Hs();Fu(r,o,c,d)}function Fu(r,o,c,d){var g={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(ef(r))k0(o,g);else{var y=r.alternate;if(r.lanes===0&&(y===null||y.lanes===0)&&(y=o.lastRenderedReducer,y!==null))try{var T=o.lastRenderedState,S=y(T,c);if(g.hasEagerState=!0,g.eagerState=S,Fs(S,T))return Vh(r,o,g,0),Lt===null&&Oh(),!1}catch{}finally{}if(c=zg(r,o,g,d),c!==null)return Gs(c,r,d),D0(c,o,d),!0}return!1}function Tp(r,o,c,d){if(d={lane:2,revertLane:ny(),action:d,hasEagerState:!1,eagerState:null,next:null},ef(r)){if(o)throw Error(n(479))}else o=zg(r,c,d,2),o!==null&&Gs(o,r,2)}function ef(r){var o=r.alternate;return r===Je||o!==null&&o===Je}function k0(r,o){ql=Qh=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function D0(r,o,c){if((c&4194048)!==0){var d=o.lanes;d&=r.pendingLanes,c|=d,o.lanes=c,qt(r,c)}}var tf={readContext:ns,use:Xh,useCallback:cn,useContext:cn,useEffect:cn,useImperativeHandle:cn,useLayoutEffect:cn,useInsertionEffect:cn,useMemo:cn,useReducer:cn,useRef:cn,useState:cn,useDebugValue:cn,useDeferredValue:cn,useTransition:cn,useSyncExternalStore:cn,useId:cn,useHostTransitionStatus:cn,useFormState:cn,useActionState:cn,useOptimistic:cn,useMemoCache:cn,useCacheRefresh:cn},P0={readContext:ns,use:Xh,useCallback:function(r,o){return xs().memoizedState=[r,o===void 0?null:o],r},useContext:ns,useEffect:y0,useImperativeHandle:function(r,o,c){c=c!=null?c.concat([r]):null,Zh(4194308,4,w0.bind(null,o,r),c)},useLayoutEffect:function(r,o){return Zh(4194308,4,r,o)},useInsertionEffect:function(r,o){Zh(4,2,r,o)},useMemo:function(r,o){var c=xs();o=o===void 0?null:o;var d=r();if(ko){es(!0);try{r()}finally{es(!1)}}return c.memoizedState=[d,o],d},useReducer:function(r,o,c){var d=xs();if(c!==void 0){var g=c(o);if(ko){es(!0);try{c(o)}finally{es(!1)}}}else g=o;return d.memoizedState=d.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},d.queue=r,r=r.dispatch=l2.bind(null,Je,r),[d.memoizedState,r]},useRef:function(r){var o=xs();return r={current:r},o.memoizedState=r},useState:function(r){r=xp(r);var o=r.queue,c=R0.bind(null,Je,o);return o.dispatch=c,[r.memoizedState,c]},useDebugValue:bp,useDeferredValue:function(r,o){var c=xs();return wp(c,r,o)},useTransition:function(){var r=xp(!1);return r=S0.bind(null,Je,r.queue,!0,!1),xs().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,c){var d=Je,g=xs();if(xt){if(c===void 0)throw Error(n(407));c=c()}else{if(c=o(),Lt===null)throw Error(n(349));(ht&124)!==0||t0(d,o,c)}g.memoizedState=c;var y={value:c,getSnapshot:o};return g.queue=y,y0(s0.bind(null,d,y,r),[r]),d.flags|=2048,Hl(9,Jh(),n0.bind(null,d,y,c,o),null),c},useId:function(){var r=xs(),o=Lt.identifierPrefix;if(xt){var c=_a,d=wa;c=(d&~(1<<32-bn(d)-1)).toString(32)+c,o=""+o+"R"+c,c=Yh++,0<c&&(o+="H"+c.toString(32)),o+=""}else c=n2++,o=""+o+"r"+c.toString(32)+"";return r.memoizedState=o},useHostTransitionStatus:Np,useFormState:h0,useActionState:h0,useOptimistic:function(r){var o=xs();o.memoizedState=o.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=Tp.bind(null,Je,!0,c),c.dispatch=o,[r,o]},useMemoCache:gp,useCacheRefresh:function(){return xs().memoizedState=o2.bind(null,Je)}},M0={readContext:ns,use:Xh,useCallback:N0,useContext:ns,useEffect:x0,useImperativeHandle:_0,useInsertionEffect:v0,useLayoutEffect:b0,useMemo:T0,useReducer:Wh,useRef:p0,useState:function(){return Wh(Ea)},useDebugValue:bp,useDeferredValue:function(r,o){var c=pn();return E0(c,Rt.memoizedState,r,o)},useTransition:function(){var r=Wh(Ea)[0],o=pn().memoizedState;return[typeof r=="boolean"?r:Vu(r),o]},useSyncExternalStore:e0,useId:I0,useHostTransitionStatus:Np,useFormState:f0,useActionState:f0,useOptimistic:function(r,o){var c=pn();return i0(c,Rt,r,o)},useMemoCache:gp,useCacheRefresh:C0},c2={readContext:ns,use:Xh,useCallback:N0,useContext:ns,useEffect:x0,useImperativeHandle:_0,useInsertionEffect:v0,useLayoutEffect:b0,useMemo:T0,useReducer:yp,useRef:p0,useState:function(){return yp(Ea)},useDebugValue:bp,useDeferredValue:function(r,o){var c=pn();return Rt===null?wp(c,r,o):E0(c,Rt.memoizedState,r,o)},useTransition:function(){var r=yp(Ea)[0],o=pn().memoizedState;return[typeof r=="boolean"?r:Vu(r),o]},useSyncExternalStore:e0,useId:I0,useHostTransitionStatus:Np,useFormState:g0,useActionState:g0,useOptimistic:function(r,o){var c=pn();return Rt!==null?i0(c,Rt,r,o):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:gp,useCacheRefresh:C0},Gl=null,Uu=0;function nf(r){var o=Uu;return Uu+=1,Gl===null&&(Gl=[]),$b(Gl,r,o)}function Bu(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function sf(r,o){throw o.$$typeof===w?Error(n(525)):(r=Object.prototype.toString.call(o),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function O0(r){var o=r._init;return o(r._payload)}function V0(r){function o(X,K){if(r){var Z=X.deletions;Z===null?(X.deletions=[K],X.flags|=16):Z.push(K)}}function c(X,K){if(!r)return null;for(;K!==null;)o(X,K),K=K.sibling;return null}function d(X){for(var K=new Map;X!==null;)X.key!==null?K.set(X.key,X):K.set(X.index,X),X=X.sibling;return K}function g(X,K){return X=ba(X,K),X.index=0,X.sibling=null,X}function y(X,K,Z){return X.index=Z,r?(Z=X.alternate,Z!==null?(Z=Z.index,Z<K?(X.flags|=67108866,K):Z):(X.flags|=67108866,K)):(X.flags|=1048576,K)}function T(X){return r&&X.alternate===null&&(X.flags|=67108866),X}function S(X,K,Z,fe){return K===null||K.tag!==6?(K=Gg(Z,X.mode,fe),K.return=X,K):(K=g(K,Z),K.return=X,K)}function q(X,K,Z,fe){var Re=Z.type;return Re===C?de(X,K,Z.props.children,fe,Z.key):K!==null&&(K.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===N&&O0(Re)===K.type)?(K=g(K,Z.props),Bu(K,Z),K.return=X,K):(K=Fh(Z.type,Z.key,Z.props,null,X.mode,fe),Bu(K,Z),K.return=X,K)}function ne(X,K,Z,fe){return K===null||K.tag!==4||K.stateNode.containerInfo!==Z.containerInfo||K.stateNode.implementation!==Z.implementation?(K=$g(Z,X.mode,fe),K.return=X,K):(K=g(K,Z.children||[]),K.return=X,K)}function de(X,K,Z,fe,Re){return K===null||K.tag!==7?(K=To(Z,X.mode,fe,Re),K.return=X,K):(K=g(K,Z),K.return=X,K)}function me(X,K,Z){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return K=Gg(""+K,X.mode,Z),K.return=X,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case b:return Z=Fh(K.type,K.key,K.props,null,X.mode,Z),Bu(Z,K),Z.return=X,Z;case E:return K=$g(K,X.mode,Z),K.return=X,K;case N:var fe=K._init;return K=fe(K._payload),me(X,K,Z)}if(ae(K)||G(K))return K=To(K,X.mode,Z,null),K.return=X,K;if(typeof K.then=="function")return me(X,nf(K),Z);if(K.$$typeof===B)return me(X,zh(X,K),Z);sf(X,K)}return null}function re(X,K,Z,fe){var Re=K!==null?K.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Re!==null?null:S(X,K,""+Z,fe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case b:return Z.key===Re?q(X,K,Z,fe):null;case E:return Z.key===Re?ne(X,K,Z,fe):null;case N:return Re=Z._init,Z=Re(Z._payload),re(X,K,Z,fe)}if(ae(Z)||G(Z))return Re!==null?null:de(X,K,Z,fe,null);if(typeof Z.then=="function")return re(X,K,nf(Z),fe);if(Z.$$typeof===B)return re(X,K,zh(X,Z),fe);sf(X,Z)}return null}function ie(X,K,Z,fe,Re){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return X=X.get(Z)||null,S(K,X,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case b:return X=X.get(fe.key===null?Z:fe.key)||null,q(K,X,fe,Re);case E:return X=X.get(fe.key===null?Z:fe.key)||null,ne(K,X,fe,Re);case N:var et=fe._init;return fe=et(fe._payload),ie(X,K,Z,fe,Re)}if(ae(fe)||G(fe))return X=X.get(Z)||null,de(K,X,fe,Re,null);if(typeof fe.then=="function")return ie(X,K,Z,nf(fe),Re);if(fe.$$typeof===B)return ie(X,K,Z,zh(K,fe),Re);sf(K,fe)}return null}function He(X,K,Z,fe){for(var Re=null,et=null,Oe=K,Be=K=0,Un=null;Oe!==null&&Be<Z.length;Be++){Oe.index>Be?(Un=Oe,Oe=null):Un=Oe.sibling;var yt=re(X,Oe,Z[Be],fe);if(yt===null){Oe===null&&(Oe=Un);break}r&&Oe&&yt.alternate===null&&o(X,Oe),K=y(yt,K,Be),et===null?Re=yt:et.sibling=yt,et=yt,Oe=Un}if(Be===Z.length)return c(X,Oe),xt&&So(X,Be),Re;if(Oe===null){for(;Be<Z.length;Be++)Oe=me(X,Z[Be],fe),Oe!==null&&(K=y(Oe,K,Be),et===null?Re=Oe:et.sibling=Oe,et=Oe);return xt&&So(X,Be),Re}for(Oe=d(Oe);Be<Z.length;Be++)Un=ie(Oe,X,Be,Z[Be],fe),Un!==null&&(r&&Un.alternate!==null&&Oe.delete(Un.key===null?Be:Un.key),K=y(Un,K,Be),et===null?Re=Un:et.sibling=Un,et=Un);return r&&Oe.forEach(function(Ti){return o(X,Ti)}),xt&&So(X,Be),Re}function Ue(X,K,Z,fe){if(Z==null)throw Error(n(151));for(var Re=null,et=null,Oe=K,Be=K=0,Un=null,yt=Z.next();Oe!==null&&!yt.done;Be++,yt=Z.next()){Oe.index>Be?(Un=Oe,Oe=null):Un=Oe.sibling;var Ti=re(X,Oe,yt.value,fe);if(Ti===null){Oe===null&&(Oe=Un);break}r&&Oe&&Ti.alternate===null&&o(X,Oe),K=y(Ti,K,Be),et===null?Re=Ti:et.sibling=Ti,et=Ti,Oe=Un}if(yt.done)return c(X,Oe),xt&&So(X,Be),Re;if(Oe===null){for(;!yt.done;Be++,yt=Z.next())yt=me(X,yt.value,fe),yt!==null&&(K=y(yt,K,Be),et===null?Re=yt:et.sibling=yt,et=yt);return xt&&So(X,Be),Re}for(Oe=d(Oe);!yt.done;Be++,yt=Z.next())yt=ie(Oe,X,Be,yt.value,fe),yt!==null&&(r&&yt.alternate!==null&&Oe.delete(yt.key===null?Be:yt.key),K=y(yt,K,Be),et===null?Re=yt:et.sibling=yt,et=yt);return r&&Oe.forEach(function(uI){return o(X,uI)}),xt&&So(X,Be),Re}function Dt(X,K,Z,fe){if(typeof Z=="object"&&Z!==null&&Z.type===C&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case b:e:{for(var Re=Z.key;K!==null;){if(K.key===Re){if(Re=Z.type,Re===C){if(K.tag===7){c(X,K.sibling),fe=g(K,Z.props.children),fe.return=X,X=fe;break e}}else if(K.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===N&&O0(Re)===K.type){c(X,K.sibling),fe=g(K,Z.props),Bu(fe,Z),fe.return=X,X=fe;break e}c(X,K);break}else o(X,K);K=K.sibling}Z.type===C?(fe=To(Z.props.children,X.mode,fe,Z.key),fe.return=X,X=fe):(fe=Fh(Z.type,Z.key,Z.props,null,X.mode,fe),Bu(fe,Z),fe.return=X,X=fe)}return T(X);case E:e:{for(Re=Z.key;K!==null;){if(K.key===Re)if(K.tag===4&&K.stateNode.containerInfo===Z.containerInfo&&K.stateNode.implementation===Z.implementation){c(X,K.sibling),fe=g(K,Z.children||[]),fe.return=X,X=fe;break e}else{c(X,K);break}else o(X,K);K=K.sibling}fe=$g(Z,X.mode,fe),fe.return=X,X=fe}return T(X);case N:return Re=Z._init,Z=Re(Z._payload),Dt(X,K,Z,fe)}if(ae(Z))return He(X,K,Z,fe);if(G(Z)){if(Re=G(Z),typeof Re!="function")throw Error(n(150));return Z=Re.call(Z),Ue(X,K,Z,fe)}if(typeof Z.then=="function")return Dt(X,K,nf(Z),fe);if(Z.$$typeof===B)return Dt(X,K,zh(X,Z),fe);sf(X,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint"?(Z=""+Z,K!==null&&K.tag===6?(c(X,K.sibling),fe=g(K,Z),fe.return=X,X=fe):(c(X,K),fe=Gg(Z,X.mode,fe),fe.return=X,X=fe),T(X)):c(X,K)}return function(X,K,Z,fe){try{Uu=0;var Re=Dt(X,K,Z,fe);return Gl=null,Re}catch(Oe){if(Oe===Ru||Oe===Gh)throw Oe;var et=Us(29,Oe,null,X.mode);return et.lanes=fe,et.return=X,et}finally{}}}var $l=V0(!0),L0=V0(!1),fr=te(null),Wr=null;function ci(r){var o=r.alternate;ue(En,En.current&1),ue(fr,r),Wr===null&&(o===null||Bl.current!==null||o.memoizedState!==null)&&(Wr=r)}function F0(r){if(r.tag===22){if(ue(En,En.current),ue(fr,r),Wr===null){var o=r.alternate;o!==null&&o.memoizedState!==null&&(Wr=r)}}else ui()}function ui(){ue(En,En.current),ue(fr,fr.current)}function Sa(r){xe(fr),Wr===r&&(Wr=null),xe(En)}var En=te(0);function rf(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||my(c)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Ep(r,o,c,d){o=r.memoizedState,c=c(d,o),c=c==null?o:x({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Sp={enqueueSetState:function(r,o,c){r=r._reactInternals;var d=Hs(),g=ii(d);g.payload=o,c!=null&&(g.callback=c),o=oi(r,g,d),o!==null&&(Gs(o,r,d),Du(o,r,d))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var d=Hs(),g=ii(d);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=oi(r,g,d),o!==null&&(Gs(o,r,d),Du(o,r,d))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=Hs(),d=ii(c);d.tag=2,o!=null&&(d.callback=o),o=oi(r,d,c),o!==null&&(Gs(o,r,c),Du(o,r,c))}};function U0(r,o,c,d,g,y,T){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,y,T):o.prototype&&o.prototype.isPureReactComponent?!Nu(c,d)||!Nu(g,y):!0}function B0(r,o,c,d){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,d),o.state!==r&&Sp.enqueueReplaceState(o,o.state,null)}function Do(r,o){var c=o;if("ref"in o){c={};for(var d in o)d!=="ref"&&(c[d]=o[d])}if(r=r.defaultProps){c===o&&(c=x({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}var af=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function q0(r){af(r)}function z0(r){console.error(r)}function H0(r){af(r)}function of(r,o){try{var c=r.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(d){setTimeout(function(){throw d})}}function G0(r,o,c){try{var d=r.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Ap(r,o,c){return c=ii(c),c.tag=3,c.payload={element:null},c.callback=function(){of(r,o)},c}function $0(r){return r=ii(r),r.tag=3,r}function K0(r,o,c,d){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=d.value;r.payload=function(){return g(y)},r.callback=function(){G0(o,c,d)}}var T=c.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(r.callback=function(){G0(o,c,d),typeof g!="function"&&(pi===null?pi=new Set([this]):pi.add(this));var S=d.stack;this.componentDidCatch(d.value,{componentStack:S!==null?S:""})})}function u2(r,o,c,d,g){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(o=c.alternate,o!==null&&ju(o,c,g,!0),c=fr.current,c!==null){switch(c.tag){case 13:return Wr===null?Wp():c.alternate===null&&rn===0&&(rn=3),c.flags&=-257,c.flags|=65536,c.lanes=g,d===np?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([d]):o.add(d),Zp(r,d,g)),!1;case 22:return c.flags|=65536,d===np?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([d]):c.add(d)),Zp(r,d,g)),!1}throw Error(n(435,c.tag))}return Zp(r,d,g),Wp(),!1}if(xt)return o=fr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,d!==Yg&&(r=Error(n(422),{cause:d}),Au(cr(r,c)))):(d!==Yg&&(o=Error(n(423),{cause:d}),Au(cr(o,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,d=cr(d,c),g=Ap(r.stateNode,d,g),ap(r,g),rn!==4&&(rn=2)),!1;var y=Error(n(520),{cause:d});if(y=cr(y,c),Qu===null?Qu=[y]:Qu.push(y),rn!==4&&(rn=2),o===null)return!0;d=cr(d,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=Ap(c.stateNode,d,r),ap(c,r),!1;case 1:if(o=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(pi===null||!pi.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=$0(g),K0(g,r,c,d),ap(c,g),!1}c=c.return}while(c!==null);return!1}var Q0=Error(n(461)),Ln=!1;function Yn(r,o,c,d){o.child=r===null?L0(o,null,c,d):$l(o,r.child,c,d)}function Y0(r,o,c,d,g){c=c.render;var y=o.ref;if("ref"in d){var T={};for(var S in d)S!=="ref"&&(T[S]=d[S])}else T=d;return Co(o),d=up(r,o,c,T,y,g),S=dp(),r!==null&&!Ln?(hp(r,o,g),Aa(r,o,g)):(xt&&S&&Kg(o),o.flags|=1,Yn(r,o,d,g),o.child)}function X0(r,o,c,d,g){if(r===null){var y=c.type;return typeof y=="function"&&!Hg(y)&&y.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=y,W0(r,o,y,d,g)):(r=Fh(c.type,null,d,o,o.mode,g),r.ref=o.ref,r.return=o,o.child=r)}if(y=r.child,!Mp(r,g)){var T=y.memoizedProps;if(c=c.compare,c=c!==null?c:Nu,c(T,d)&&r.ref===o.ref)return Aa(r,o,g)}return o.flags|=1,r=ba(y,d),r.ref=o.ref,r.return=o,o.child=r}function W0(r,o,c,d,g){if(r!==null){var y=r.memoizedProps;if(Nu(y,d)&&r.ref===o.ref)if(Ln=!1,o.pendingProps=d=y,Mp(r,g))(r.flags&131072)!==0&&(Ln=!0);else return o.lanes=r.lanes,Aa(r,o,g)}return jp(r,o,c,d,g)}function J0(r,o,c){var d=o.pendingProps,g=d.children,y=r!==null?r.memoizedState:null;if(d.mode==="hidden"){if((o.flags&128)!==0){if(d=y!==null?y.baseLanes|c:c,r!==null){for(g=o.child=r.child,y=0;g!==null;)y=y|g.lanes|g.childLanes,g=g.sibling;o.childLanes=y&~d}else o.childLanes=0,o.child=null;return Z0(r,o,d,c)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&Hh(o,y!==null?y.cachePool:null),y!==null?Wb(o,y):op(),F0(o);else return o.lanes=o.childLanes=536870912,Z0(r,o,y!==null?y.baseLanes|c:c,c)}else y!==null?(Hh(o,y.cachePool),Wb(o,y),ui(),o.memoizedState=null):(r!==null&&Hh(o,null),op(),ui());return Yn(r,o,g,c),o.child}function Z0(r,o,c,d){var g=tp();return g=g===null?null:{parent:Tn._currentValue,pool:g},o.memoizedState={baseLanes:c,cachePool:g},r!==null&&Hh(o,null),op(),F0(o),r!==null&&ju(r,o,d,!0),null}function lf(r,o){var c=o.ref;if(c===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(r===null||r.ref!==c)&&(o.flags|=4194816)}}function jp(r,o,c,d,g){return Co(o),c=up(r,o,c,d,void 0,g),d=dp(),r!==null&&!Ln?(hp(r,o,g),Aa(r,o,g)):(xt&&d&&Kg(o),o.flags|=1,Yn(r,o,c,g),o.child)}function ew(r,o,c,d,g,y){return Co(o),o.updateQueue=null,c=Zb(o,d,c,g),Jb(r),d=dp(),r!==null&&!Ln?(hp(r,o,y),Aa(r,o,y)):(xt&&d&&Kg(o),o.flags|=1,Yn(r,o,c,y),o.child)}function tw(r,o,c,d,g){if(Co(o),o.stateNode===null){var y=Ol,T=c.contextType;typeof T=="object"&&T!==null&&(y=ns(T)),y=new c(d,y),o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Sp,o.stateNode=y,y._reactInternals=o,y=o.stateNode,y.props=d,y.state=o.memoizedState,y.refs={},sp(o),T=c.contextType,y.context=typeof T=="object"&&T!==null?ns(T):Ol,y.state=o.memoizedState,T=c.getDerivedStateFromProps,typeof T=="function"&&(Ep(o,c,T,d),y.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(T=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),T!==y.state&&Sp.enqueueReplaceState(y,y.state,null),Mu(o,d,y,g),Pu(),y.state=o.memoizedState),typeof y.componentDidMount=="function"&&(o.flags|=4194308),d=!0}else if(r===null){y=o.stateNode;var S=o.memoizedProps,q=Do(c,S);y.props=q;var ne=y.context,de=c.contextType;T=Ol,typeof de=="object"&&de!==null&&(T=ns(de));var me=c.getDerivedStateFromProps;de=typeof me=="function"||typeof y.getSnapshotBeforeUpdate=="function",S=o.pendingProps!==S,de||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(S||ne!==T)&&B0(o,y,d,T),ai=!1;var re=o.memoizedState;y.state=re,Mu(o,d,y,g),Pu(),ne=o.memoizedState,S||re!==ne||ai?(typeof me=="function"&&(Ep(o,c,me,d),ne=o.memoizedState),(q=ai||U0(o,c,q,d,re,ne,T))?(de||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(o.flags|=4194308)):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=ne),y.props=d,y.state=ne,y.context=T,d=q):(typeof y.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{y=o.stateNode,rp(r,o),T=o.memoizedProps,de=Do(c,T),y.props=de,me=o.pendingProps,re=y.context,ne=c.contextType,q=Ol,typeof ne=="object"&&ne!==null&&(q=ns(ne)),S=c.getDerivedStateFromProps,(ne=typeof S=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==me||re!==q)&&B0(o,y,d,q),ai=!1,re=o.memoizedState,y.state=re,Mu(o,d,y,g),Pu();var ie=o.memoizedState;T!==me||re!==ie||ai||r!==null&&r.dependencies!==null&&qh(r.dependencies)?(typeof S=="function"&&(Ep(o,c,S,d),ie=o.memoizedState),(de=ai||U0(o,c,de,d,re,ie,q)||r!==null&&r.dependencies!==null&&qh(r.dependencies))?(ne||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,ie,q),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,ie,q)),typeof y.componentDidUpdate=="function"&&(o.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===r.memoizedProps&&re===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===r.memoizedProps&&re===r.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=ie),y.props=d,y.state=ie,y.context=q,d=de):(typeof y.componentDidUpdate!="function"||T===r.memoizedProps&&re===r.memoizedState||(o.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===r.memoizedProps&&re===r.memoizedState||(o.flags|=1024),d=!1)}return y=d,lf(r,o),d=(o.flags&128)!==0,y||d?(y=o.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:y.render(),o.flags|=1,r!==null&&d?(o.child=$l(o,r.child,null,g),o.child=$l(o,null,c,g)):Yn(r,o,c,g),o.memoizedState=y.state,r=o.child):r=Aa(r,o,g),r}function nw(r,o,c,d){return Su(),o.flags|=256,Yn(r,o,c,d),o.child}var Ip={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Cp(r){return{baseLanes:r,cachePool:zb()}}function Rp(r,o,c){return r=r!==null?r.childLanes&~c:0,o&&(r|=mr),r}function sw(r,o,c){var d=o.pendingProps,g=!1,y=(o.flags&128)!==0,T;if((T=y)||(T=r!==null&&r.memoizedState===null?!1:(En.current&2)!==0),T&&(g=!0,o.flags&=-129),T=(o.flags&32)!==0,o.flags&=-33,r===null){if(xt){if(g?ci(o):ui(),xt){var S=sn,q;if(q=S){e:{for(q=S,S=Xr;q.nodeType!==8;){if(!S){S=null;break e}if(q=Ir(q.nextSibling),q===null){S=null;break e}}S=q}S!==null?(o.memoizedState={dehydrated:S,treeContext:Eo!==null?{id:wa,overflow:_a}:null,retryLane:536870912,hydrationErrors:null},q=Us(18,null,null,0),q.stateNode=S,q.return=o,o.child=q,ms=o,sn=null,q=!0):q=!1}q||jo(o)}if(S=o.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return my(S)?o.lanes=32:o.lanes=536870912,null;Sa(o)}return S=d.children,d=d.fallback,g?(ui(),g=o.mode,S=cf({mode:"hidden",children:S},g),d=To(d,g,c,null),S.return=o,d.return=o,S.sibling=d,o.child=S,g=o.child,g.memoizedState=Cp(c),g.childLanes=Rp(r,T,c),o.memoizedState=Ip,d):(ci(o),kp(o,S))}if(q=r.memoizedState,q!==null&&(S=q.dehydrated,S!==null)){if(y)o.flags&256?(ci(o),o.flags&=-257,o=Dp(r,o,c)):o.memoizedState!==null?(ui(),o.child=r.child,o.flags|=128,o=null):(ui(),g=d.fallback,S=o.mode,d=cf({mode:"visible",children:d.children},S),g=To(g,S,c,null),g.flags|=2,d.return=o,g.return=o,d.sibling=g,o.child=d,$l(o,r.child,null,c),d=o.child,d.memoizedState=Cp(c),d.childLanes=Rp(r,T,c),o.memoizedState=Ip,o=g);else if(ci(o),my(S)){if(T=S.nextSibling&&S.nextSibling.dataset,T)var ne=T.dgst;T=ne,d=Error(n(419)),d.stack="",d.digest=T,Au({value:d,source:null,stack:null}),o=Dp(r,o,c)}else if(Ln||ju(r,o,c,!1),T=(c&r.childLanes)!==0,Ln||T){if(T=Lt,T!==null&&(d=c&-c,d=(d&42)!==0?1:ds(d),d=(d&(T.suspendedLanes|c))!==0?0:d,d!==0&&d!==q.retryLane))throw q.retryLane=d,Ml(r,d),Gs(T,r,d),Q0;S.data==="$?"||Wp(),o=Dp(r,o,c)}else S.data==="$?"?(o.flags|=192,o.child=r.child,o=null):(r=q.treeContext,sn=Ir(S.nextSibling),ms=o,xt=!0,Ao=null,Xr=!1,r!==null&&(dr[hr++]=wa,dr[hr++]=_a,dr[hr++]=Eo,wa=r.id,_a=r.overflow,Eo=o),o=kp(o,d.children),o.flags|=4096);return o}return g?(ui(),g=d.fallback,S=o.mode,q=r.child,ne=q.sibling,d=ba(q,{mode:"hidden",children:d.children}),d.subtreeFlags=q.subtreeFlags&65011712,ne!==null?g=ba(ne,g):(g=To(g,S,c,null),g.flags|=2),g.return=o,d.return=o,d.sibling=g,o.child=d,d=g,g=o.child,S=r.child.memoizedState,S===null?S=Cp(c):(q=S.cachePool,q!==null?(ne=Tn._currentValue,q=q.parent!==ne?{parent:ne,pool:ne}:q):q=zb(),S={baseLanes:S.baseLanes|c,cachePool:q}),g.memoizedState=S,g.childLanes=Rp(r,T,c),o.memoizedState=Ip,d):(ci(o),c=r.child,r=c.sibling,c=ba(c,{mode:"visible",children:d.children}),c.return=o,c.sibling=null,r!==null&&(T=o.deletions,T===null?(o.deletions=[r],o.flags|=16):T.push(r)),o.child=c,o.memoizedState=null,c)}function kp(r,o){return o=cf({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function cf(r,o){return r=Us(22,r,null,o),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Dp(r,o,c){return $l(o,r.child,null,c),r=kp(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function rw(r,o,c){r.lanes|=o;var d=r.alternate;d!==null&&(d.lanes|=o),Wg(r.return,o,c)}function Pp(r,o,c,d,g){var y=r.memoizedState;y===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:g}:(y.isBackwards=o,y.rendering=null,y.renderingStartTime=0,y.last=d,y.tail=c,y.tailMode=g)}function aw(r,o,c){var d=o.pendingProps,g=d.revealOrder,y=d.tail;if(Yn(r,o,d.children,c),d=En.current,(d&2)!==0)d=d&1|2,o.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&rw(r,c,o);else if(r.tag===19)rw(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}switch(ue(En,d),g){case"forwards":for(c=o.child,g=null;c!==null;)r=c.alternate,r!==null&&rf(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),Pp(o,!1,g,c,y);break;case"backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(r=g.alternate,r!==null&&rf(r)===null){o.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}Pp(o,!0,c,null,y);break;case"together":Pp(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Aa(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),gi|=o.lanes,(c&o.childLanes)===0)if(r!==null){if(ju(r,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(n(153));if(o.child!==null){for(r=o.child,c=ba(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=ba(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function Mp(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&qh(r)))}function d2(r,o,c){switch(o.tag){case 3:we(o,o.stateNode.containerInfo),ri(o,Tn,r.memoizedState.cache),Su();break;case 27:case 5:Fe(o);break;case 4:we(o,o.stateNode.containerInfo);break;case 10:ri(o,o.type,o.memoizedProps.value);break;case 13:var d=o.memoizedState;if(d!==null)return d.dehydrated!==null?(ci(o),o.flags|=128,null):(c&o.child.childLanes)!==0?sw(r,o,c):(ci(o),r=Aa(r,o,c),r!==null?r.sibling:null);ci(o);break;case 19:var g=(r.flags&128)!==0;if(d=(c&o.childLanes)!==0,d||(ju(r,o,c,!1),d=(c&o.childLanes)!==0),g){if(d)return aw(r,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ue(En,En.current),d)break;return null;case 22:case 23:return o.lanes=0,J0(r,o,c);case 24:ri(o,Tn,r.memoizedState.cache)}return Aa(r,o,c)}function iw(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps)Ln=!0;else{if(!Mp(r,c)&&(o.flags&128)===0)return Ln=!1,d2(r,o,c);Ln=(r.flags&131072)!==0}else Ln=!1,xt&&(o.flags&1048576)!==0&&Ob(o,Bh,o.index);switch(o.lanes=0,o.tag){case 16:e:{r=o.pendingProps;var d=o.elementType,g=d._init;if(d=g(d._payload),o.type=d,typeof d=="function")Hg(d)?(r=Do(d,r),o.tag=1,o=tw(null,o,d,r,c)):(o.tag=0,o=jp(null,o,d,r,c));else{if(d!=null){if(g=d.$$typeof,g===H){o.tag=11,o=Y0(null,o,d,r,c);break e}else if(g===R){o.tag=14,o=X0(null,o,d,r,c);break e}}throw o=Ve(d)||d,Error(n(306,o,""))}}return o;case 0:return jp(r,o,o.type,o.pendingProps,c);case 1:return d=o.type,g=Do(d,o.pendingProps),tw(r,o,d,g,c);case 3:e:{if(we(o,o.stateNode.containerInfo),r===null)throw Error(n(387));d=o.pendingProps;var y=o.memoizedState;g=y.element,rp(r,o),Mu(o,d,null,c);var T=o.memoizedState;if(d=T.cache,ri(o,Tn,d),d!==y.cache&&Jg(o,[Tn],c,!0),Pu(),d=T.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:T.cache},o.updateQueue.baseState=y,o.memoizedState=y,o.flags&256){o=nw(r,o,d,c);break e}else if(d!==g){g=cr(Error(n(424)),o),Au(g),o=nw(r,o,d,c);break e}else{switch(r=o.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(sn=Ir(r.firstChild),ms=o,xt=!0,Ao=null,Xr=!0,c=L0(o,null,d,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Su(),d===g){o=Aa(r,o,c);break e}Yn(r,o,d,c)}o=o.child}return o;case 26:return lf(r,o),r===null?(c=u_(o.type,null,o.pendingProps,null))?o.memoizedState=c:xt||(c=o.type,r=o.pendingProps,d=Nf(Ee.current).createElement(c),d[tn]=o,d[nn]=r,Wn(d,c,r),Xt(d),o.stateNode=d):o.memoizedState=u_(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return Fe(o),r===null&&xt&&(d=o.stateNode=o_(o.type,o.pendingProps,Ee.current),ms=o,Xr=!0,g=sn,vi(o.type)?(gy=g,sn=Ir(d.firstChild)):sn=g),Yn(r,o,o.pendingProps.children,c),lf(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&xt&&((g=d=sn)&&(d=F2(d,o.type,o.pendingProps,Xr),d!==null?(o.stateNode=d,ms=o,sn=Ir(d.firstChild),Xr=!1,g=!0):g=!1),g||jo(o)),Fe(o),g=o.type,y=o.pendingProps,T=r!==null?r.memoizedProps:null,d=y.children,dy(g,y)?d=null:T!==null&&dy(g,T)&&(o.flags|=32),o.memoizedState!==null&&(g=up(r,o,s2,null,null,c),sd._currentValue=g),lf(r,o),Yn(r,o,d,c),o.child;case 6:return r===null&&xt&&((r=c=sn)&&(c=U2(c,o.pendingProps,Xr),c!==null?(o.stateNode=c,ms=o,sn=null,r=!0):r=!1),r||jo(o)),null;case 13:return sw(r,o,c);case 4:return we(o,o.stateNode.containerInfo),d=o.pendingProps,r===null?o.child=$l(o,null,d,c):Yn(r,o,d,c),o.child;case 11:return Y0(r,o,o.type,o.pendingProps,c);case 7:return Yn(r,o,o.pendingProps,c),o.child;case 8:return Yn(r,o,o.pendingProps.children,c),o.child;case 12:return Yn(r,o,o.pendingProps.children,c),o.child;case 10:return d=o.pendingProps,ri(o,o.type,d.value),Yn(r,o,d.children,c),o.child;case 9:return g=o.type._context,d=o.pendingProps.children,Co(o),g=ns(g),d=d(g),o.flags|=1,Yn(r,o,d,c),o.child;case 14:return X0(r,o,o.type,o.pendingProps,c);case 15:return W0(r,o,o.type,o.pendingProps,c);case 19:return aw(r,o,c);case 31:return d=o.pendingProps,c=o.mode,d={mode:d.mode,children:d.children},r===null?(c=cf(d,c),c.ref=o.ref,o.child=c,c.return=o,o=c):(c=ba(r.child,d),c.ref=o.ref,o.child=c,c.return=o,o=c),o;case 22:return J0(r,o,c);case 24:return Co(o),d=ns(Tn),r===null?(g=tp(),g===null&&(g=Lt,y=Zg(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),o.memoizedState={parent:d,cache:g},sp(o),ri(o,Tn,g)):((r.lanes&c)!==0&&(rp(r,o),Mu(o,null,null,c),Pu()),g=r.memoizedState,y=o.memoizedState,g.parent!==d?(g={parent:d,cache:d},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),ri(o,Tn,d)):(d=y.cache,ri(o,Tn,d),d!==g.cache&&Jg(o,[Tn],c,!0))),Yn(r,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(n(156,o.tag))}function ja(r){r.flags|=4}function ow(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!g_(o)){if(o=fr.current,o!==null&&((ht&4194048)===ht?Wr!==null:(ht&62914560)!==ht&&(ht&536870912)===0||o!==Wr))throw ku=np,Hb;r.flags|=8192}}function uf(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?Br():536870912,r.lanes|=o,Xl|=o)}function qu(r,o){if(!xt)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function Wt(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,d=0;if(o)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=d,r.childLanes=c,o}function h2(r,o,c){var d=o.pendingProps;switch(Qg(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(o),null;case 1:return Wt(o),null;case 3:return c=o.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),Ta(Tn),Se(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Eu(o)?ja(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Fb())),Wt(o),null;case 26:return c=o.memoizedState,r===null?(ja(o),c!==null?(Wt(o),ow(o,c)):(Wt(o),o.flags&=-16777217)):c?c!==r.memoizedState?(ja(o),Wt(o),ow(o,c)):(Wt(o),o.flags&=-16777217):(r.memoizedProps!==d&&ja(o),Wt(o),o.flags&=-16777217),null;case 27:Ze(o),c=Ee.current;var g=o.type;if(r!==null&&o.stateNode!=null)r.memoizedProps!==d&&ja(o);else{if(!d){if(o.stateNode===null)throw Error(n(166));return Wt(o),null}r=Ie.current,Eu(o)?Vb(o):(r=o_(g,d,c),o.stateNode=r,ja(o))}return Wt(o),null;case 5:if(Ze(o),c=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==d&&ja(o);else{if(!d){if(o.stateNode===null)throw Error(n(166));return Wt(o),null}if(r=Ie.current,Eu(o))Vb(o);else{switch(g=Nf(Ee.current),r){case 1:r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof d.is=="string"?g.createElement("select",{is:d.is}):g.createElement("select"),d.multiple?r.multiple=!0:d.size&&(r.size=d.size);break;default:r=typeof d.is=="string"?g.createElement(c,{is:d.is}):g.createElement(c)}}r[tn]=o,r[nn]=d;e:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)r.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break e;for(;g.sibling===null;){if(g.return===null||g.return===o)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=r;e:switch(Wn(r,c,d),c){case"button":case"input":case"select":case"textarea":r=!!d.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&ja(o)}}return Wt(o),o.flags&=-16777217,null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==d&&ja(o);else{if(typeof d!="string"&&o.stateNode===null)throw Error(n(166));if(r=Ee.current,Eu(o)){if(r=o.stateNode,c=o.memoizedProps,d=null,g=ms,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}r[tn]=o,r=!!(r.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||e_(r.nodeValue,c)),r||jo(o)}else r=Nf(r).createTextNode(d),r[tn]=o,o.stateNode=r}return Wt(o),null;case 13:if(d=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Eu(o),d!==null&&d.dehydrated!==null){if(r===null){if(!g)throw Error(n(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(n(317));g[tn]=o}else Su(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Wt(o),g=!1}else g=Fb(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Sa(o),o):(Sa(o),null)}if(Sa(o),(o.flags&128)!==0)return o.lanes=c,o;if(c=d!==null,r=r!==null&&r.memoizedState!==null,c){d=o.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool);var y=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==g&&(d.flags|=2048)}return c!==r&&c&&(o.child.flags|=8192),uf(o,o.updateQueue),Wt(o),null;case 4:return Se(),r===null&&iy(o.stateNode.containerInfo),Wt(o),null;case 10:return Ta(o.type),Wt(o),null;case 19:if(xe(En),g=o.memoizedState,g===null)return Wt(o),null;if(d=(o.flags&128)!==0,y=g.rendering,y===null)if(d)qu(g,!1);else{if(rn!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(y=rf(r),y!==null){for(o.flags|=128,qu(g,!1),r=y.updateQueue,o.updateQueue=r,uf(o,r),o.subtreeFlags=0,r=c,c=o.child;c!==null;)Mb(c,r),c=c.sibling;return ue(En,En.current&1|2),o.child}r=r.sibling}g.tail!==null&&ct()>ff&&(o.flags|=128,d=!0,qu(g,!1),o.lanes=4194304)}else{if(!d)if(r=rf(y),r!==null){if(o.flags|=128,d=!0,r=r.updateQueue,o.updateQueue=r,uf(o,r),qu(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!xt)return Wt(o),null}else 2*ct()-g.renderingStartTime>ff&&c!==536870912&&(o.flags|=128,d=!0,qu(g,!1),o.lanes=4194304);g.isBackwards?(y.sibling=o.child,o.child=y):(r=g.last,r!==null?r.sibling=y:o.child=y,g.last=y)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=ct(),o.sibling=null,r=En.current,ue(En,d?r&1|2:r&1),o):(Wt(o),null);case 22:case 23:return Sa(o),lp(),d=o.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(o.flags|=8192):d&&(o.flags|=8192),d?(c&536870912)!==0&&(o.flags&128)===0&&(Wt(o),o.subtreeFlags&6&&(o.flags|=8192)):Wt(o),c=o.updateQueue,c!==null&&uf(o,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),d=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048),r!==null&&xe(Ro),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),Ta(Tn),Wt(o),null;case 25:return null;case 30:return null}throw Error(n(156,o.tag))}function f2(r,o){switch(Qg(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Ta(Tn),Se(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Ze(o),null;case 13:if(Sa(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(n(340));Su()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return xe(En),null;case 4:return Se(),null;case 10:return Ta(o.type),null;case 22:case 23:return Sa(o),lp(),r!==null&&xe(Ro),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return Ta(Tn),null;case 25:return null;default:return null}}function lw(r,o){switch(Qg(o),o.tag){case 3:Ta(Tn),Se();break;case 26:case 27:case 5:Ze(o);break;case 4:Se();break;case 13:Sa(o);break;case 19:xe(En);break;case 10:Ta(o.type);break;case 22:case 23:Sa(o),lp(),r!==null&&xe(Ro);break;case 24:Ta(Tn)}}function zu(r,o){try{var c=o.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var g=d.next;c=g;do{if((c.tag&r)===r){d=void 0;var y=c.create,T=c.inst;d=y(),T.destroy=d}c=c.next}while(c!==g)}}catch(S){Vt(o,o.return,S)}}function di(r,o,c){try{var d=o.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var y=g.next;d=y;do{if((d.tag&r)===r){var T=d.inst,S=T.destroy;if(S!==void 0){T.destroy=void 0,g=o;var q=c,ne=S;try{ne()}catch(de){Vt(g,q,de)}}}d=d.next}while(d!==y)}}catch(de){Vt(o,o.return,de)}}function cw(r){var o=r.updateQueue;if(o!==null){var c=r.stateNode;try{Xb(o,c)}catch(d){Vt(r,r.return,d)}}}function uw(r,o,c){c.props=Do(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(d){Vt(r,o,d)}}function Hu(r,o){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof c=="function"?r.refCleanup=c(d):c.current=d}}catch(g){Vt(r,o,g)}}function Jr(r,o){var c=r.ref,d=r.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(g){Vt(r,o,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Vt(r,o,g)}else c.current=null}function dw(r){var o=r.type,c=r.memoizedProps,d=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break e;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(g){Vt(r,r.return,g)}}function Op(r,o,c){try{var d=r.stateNode;P2(d,r.type,c,o),d[nn]=o}catch(g){Vt(r,r.return,g)}}function hw(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&vi(r.type)||r.tag===4}function Vp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||hw(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&vi(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Lp(r,o,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(r),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=_f));else if(d!==4&&(d===27&&vi(r.type)&&(c=r.stateNode,o=null),r=r.child,r!==null))for(Lp(r,o,c),r=r.sibling;r!==null;)Lp(r,o,c),r=r.sibling}function df(r,o,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(d!==4&&(d===27&&vi(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(df(r,o,c),r=r.sibling;r!==null;)df(r,o,c),r=r.sibling}function fw(r){var o=r.stateNode,c=r.memoizedProps;try{for(var d=r.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);Wn(o,d,c),o[tn]=r,o[nn]=c}catch(y){Vt(r,r.return,y)}}var Ia=!1,un=!1,Fp=!1,mw=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function m2(r,o){if(r=r.containerInfo,cy=If,r=Eb(r),Vg(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var g=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var T=0,S=-1,q=-1,ne=0,de=0,me=r,re=null;t:for(;;){for(var ie;me!==c||g!==0&&me.nodeType!==3||(S=T+g),me!==y||d!==0&&me.nodeType!==3||(q=T+d),me.nodeType===3&&(T+=me.nodeValue.length),(ie=me.firstChild)!==null;)re=me,me=ie;for(;;){if(me===r)break t;if(re===c&&++ne===g&&(S=T),re===y&&++de===d&&(q=T),(ie=me.nextSibling)!==null)break;me=re,re=me.parentNode}me=ie}c=S===-1||q===-1?null:{start:S,end:q}}else c=null}c=c||{start:0,end:0}}else c=null;for(uy={focusedElem:r,selectionRange:c},If=!1,Fn=o;Fn!==null;)if(o=Fn,r=o.child,(o.subtreeFlags&1024)!==0&&r!==null)r.return=o,Fn=r;else for(;Fn!==null;){switch(o=Fn,y=o.alternate,r=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&y!==null){r=void 0,c=o,g=y.memoizedProps,y=y.memoizedState,d=c.stateNode;try{var He=Do(c.type,g,c.elementType===c.type);r=d.getSnapshotBeforeUpdate(He,y),d.__reactInternalSnapshotBeforeUpdate=r}catch(Ue){Vt(c,c.return,Ue)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,c=r.nodeType,c===9)fy(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":fy(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=o.sibling,r!==null){r.return=o.return,Fn=r;break}Fn=o.return}}function gw(r,o,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:hi(r,c),d&4&&zu(5,c);break;case 1:if(hi(r,c),d&4)if(r=c.stateNode,o===null)try{r.componentDidMount()}catch(T){Vt(c,c.return,T)}else{var g=Do(c.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(g,o,r.__reactInternalSnapshotBeforeUpdate)}catch(T){Vt(c,c.return,T)}}d&64&&cw(c),d&512&&Hu(c,c.return);break;case 3:if(hi(r,c),d&64&&(r=c.updateQueue,r!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Xb(r,o)}catch(T){Vt(c,c.return,T)}}break;case 27:o===null&&d&4&&fw(c);case 26:case 5:hi(r,c),o===null&&d&4&&dw(c),d&512&&Hu(c,c.return);break;case 12:hi(r,c);break;case 13:hi(r,c),d&4&&xw(r,c),d&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=N2.bind(null,c),B2(r,c))));break;case 22:if(d=c.memoizedState!==null||Ia,!d){o=o!==null&&o.memoizedState!==null||un,g=Ia;var y=un;Ia=d,(un=o)&&!y?fi(r,c,(c.subtreeFlags&8772)!==0):hi(r,c),Ia=g,un=y}break;case 30:break;default:hi(r,c)}}function pw(r){var o=r.alternate;o!==null&&(r.alternate=null,pw(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&Dn(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Ht=null,vs=!1;function Ca(r,o,c){for(c=c.child;c!==null;)yw(r,o,c),c=c.sibling}function yw(r,o,c){if(pt&&typeof pt.onCommitFiberUnmount=="function")try{pt.onCommitFiberUnmount(_t,c)}catch{}switch(c.tag){case 26:un||Jr(c,o),Ca(r,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:un||Jr(c,o);var d=Ht,g=vs;vi(c.type)&&(Ht=c.stateNode,vs=!1),Ca(r,o,c),Zu(c.stateNode),Ht=d,vs=g;break;case 5:un||Jr(c,o);case 6:if(d=Ht,g=vs,Ht=null,Ca(r,o,c),Ht=d,vs=g,Ht!==null)if(vs)try{(Ht.nodeType===9?Ht.body:Ht.nodeName==="HTML"?Ht.ownerDocument.body:Ht).removeChild(c.stateNode)}catch(y){Vt(c,o,y)}else try{Ht.removeChild(c.stateNode)}catch(y){Vt(c,o,y)}break;case 18:Ht!==null&&(vs?(r=Ht,a_(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),od(r)):a_(Ht,c.stateNode));break;case 4:d=Ht,g=vs,Ht=c.stateNode.containerInfo,vs=!0,Ca(r,o,c),Ht=d,vs=g;break;case 0:case 11:case 14:case 15:un||di(2,c,o),un||di(4,c,o),Ca(r,o,c);break;case 1:un||(Jr(c,o),d=c.stateNode,typeof d.componentWillUnmount=="function"&&uw(c,o,d)),Ca(r,o,c);break;case 21:Ca(r,o,c);break;case 22:un=(d=un)||c.memoizedState!==null,Ca(r,o,c),un=d;break;default:Ca(r,o,c)}}function xw(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{od(r)}catch(c){Vt(o,o.return,c)}}function g2(r){switch(r.tag){case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new mw),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new mw),o;default:throw Error(n(435,r.tag))}}function Up(r,o){var c=g2(r);o.forEach(function(d){var g=T2.bind(null,r,d);c.has(d)||(c.add(d),d.then(g,g))})}function Bs(r,o){var c=o.deletions;if(c!==null)for(var d=0;d<c.length;d++){var g=c[d],y=r,T=o,S=T;e:for(;S!==null;){switch(S.tag){case 27:if(vi(S.type)){Ht=S.stateNode,vs=!1;break e}break;case 5:Ht=S.stateNode,vs=!1;break e;case 3:case 4:Ht=S.stateNode.containerInfo,vs=!0;break e}S=S.return}if(Ht===null)throw Error(n(160));yw(y,T,g),Ht=null,vs=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)vw(o,r),o=o.sibling}var jr=null;function vw(r,o){var c=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Bs(o,r),qs(r),d&4&&(di(3,r,r.return),zu(3,r),di(5,r,r.return));break;case 1:Bs(o,r),qs(r),d&512&&(un||c===null||Jr(c,c.return)),d&64&&Ia&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var g=jr;if(Bs(o,r),qs(r),d&512&&(un||c===null||Jr(c,c.return)),d&4){var y=c!==null?c.memoizedState:null;if(d=r.memoizedState,c===null)if(d===null)if(r.stateNode===null){e:{d=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(d){case"title":y=g.getElementsByTagName("title")[0],(!y||y[qr]||y[tn]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(d),g.head.insertBefore(y,g.querySelector("head > title"))),Wn(y,d,c),y[tn]=r,Xt(y),d=y;break e;case"link":var T=f_("link","href",g).get(d+(c.href||""));if(T){for(var S=0;S<T.length;S++)if(y=T[S],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){T.splice(S,1);break t}}y=g.createElement(d),Wn(y,d,c),g.head.appendChild(y);break;case"meta":if(T=f_("meta","content",g).get(d+(c.content||""))){for(S=0;S<T.length;S++)if(y=T[S],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){T.splice(S,1);break t}}y=g.createElement(d),Wn(y,d,c),g.head.appendChild(y);break;default:throw Error(n(468,d))}y[tn]=r,Xt(y),d=y}r.stateNode=d}else m_(g,r.type,r.stateNode);else r.stateNode=h_(g,d,r.memoizedProps);else y!==d?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,d===null?m_(g,r.type,r.stateNode):h_(g,d,r.memoizedProps)):d===null&&r.stateNode!==null&&Op(r,r.memoizedProps,c.memoizedProps)}break;case 27:Bs(o,r),qs(r),d&512&&(un||c===null||Jr(c,c.return)),c!==null&&d&4&&Op(r,r.memoizedProps,c.memoizedProps);break;case 5:if(Bs(o,r),qs(r),d&512&&(un||c===null||Jr(c,c.return)),r.flags&32){g=r.stateNode;try{ar(g,"")}catch(ie){Vt(r,r.return,ie)}}d&4&&r.stateNode!=null&&(g=r.memoizedProps,Op(r,g,c!==null?c.memoizedProps:g)),d&1024&&(Fp=!0);break;case 6:if(Bs(o,r),qs(r),d&4){if(r.stateNode===null)throw Error(n(162));d=r.memoizedProps,c=r.stateNode;try{c.nodeValue=d}catch(ie){Vt(r,r.return,ie)}}break;case 3:if(Sf=null,g=jr,jr=Tf(o.containerInfo),Bs(o,r),jr=g,qs(r),d&4&&c!==null&&c.memoizedState.isDehydrated)try{od(o.containerInfo)}catch(ie){Vt(r,r.return,ie)}Fp&&(Fp=!1,bw(r));break;case 4:d=jr,jr=Tf(r.stateNode.containerInfo),Bs(o,r),qs(r),jr=d;break;case 12:Bs(o,r),qs(r);break;case 13:Bs(o,r),qs(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&($p=ct()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Up(r,d)));break;case 22:g=r.memoizedState!==null;var q=c!==null&&c.memoizedState!==null,ne=Ia,de=un;if(Ia=ne||g,un=de||q,Bs(o,r),un=de,Ia=ne,qs(r),d&8192)e:for(o=r.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||q||Ia||un||Po(r)),c=null,o=r;;){if(o.tag===5||o.tag===26){if(c===null){q=c=o;try{if(y=q.stateNode,g)T=y.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{S=q.stateNode;var me=q.memoizedProps.style,re=me!=null&&me.hasOwnProperty("display")?me.display:null;S.style.display=re==null||typeof re=="boolean"?"":(""+re).trim()}}catch(ie){Vt(q,q.return,ie)}}}else if(o.tag===6){if(c===null){q=o;try{q.stateNode.nodeValue=g?"":q.memoizedProps}catch(ie){Vt(q,q.return,ie)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}d&4&&(d=r.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,Up(r,c))));break;case 19:Bs(o,r),qs(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Up(r,d)));break;case 30:break;case 21:break;default:Bs(o,r),qs(r)}}function qs(r){var o=r.flags;if(o&2){try{for(var c,d=r.return;d!==null;){if(hw(d)){c=d;break}d=d.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var g=c.stateNode,y=Vp(r);df(r,y,g);break;case 5:var T=c.stateNode;c.flags&32&&(ar(T,""),c.flags&=-33);var S=Vp(r);df(r,S,T);break;case 3:case 4:var q=c.stateNode.containerInfo,ne=Vp(r);Lp(r,ne,q);break;default:throw Error(n(161))}}catch(de){Vt(r,r.return,de)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function bw(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;bw(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function hi(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)gw(r,o.alternate,o),o=o.sibling}function Po(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:di(4,o,o.return),Po(o);break;case 1:Jr(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&uw(o,o.return,c),Po(o);break;case 27:Zu(o.stateNode);case 26:case 5:Jr(o,o.return),Po(o);break;case 22:o.memoizedState===null&&Po(o);break;case 30:Po(o);break;default:Po(o)}r=r.sibling}}function fi(r,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var d=o.alternate,g=r,y=o,T=y.flags;switch(y.tag){case 0:case 11:case 15:fi(g,y,c),zu(4,y);break;case 1:if(fi(g,y,c),d=y,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(ne){Vt(d,d.return,ne)}if(d=y,g=d.updateQueue,g!==null){var S=d.stateNode;try{var q=g.shared.hiddenCallbacks;if(q!==null)for(g.shared.hiddenCallbacks=null,g=0;g<q.length;g++)Yb(q[g],S)}catch(ne){Vt(d,d.return,ne)}}c&&T&64&&cw(y),Hu(y,y.return);break;case 27:fw(y);case 26:case 5:fi(g,y,c),c&&d===null&&T&4&&dw(y),Hu(y,y.return);break;case 12:fi(g,y,c);break;case 13:fi(g,y,c),c&&T&4&&xw(g,y);break;case 22:y.memoizedState===null&&fi(g,y,c),Hu(y,y.return);break;case 30:break;default:fi(g,y,c)}o=o.sibling}}function Bp(r,o){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&Iu(c))}function qp(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Iu(r))}function Zr(r,o,c,d){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)ww(r,o,c,d),o=o.sibling}function ww(r,o,c,d){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Zr(r,o,c,d),g&2048&&zu(9,o);break;case 1:Zr(r,o,c,d);break;case 3:Zr(r,o,c,d),g&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Iu(r)));break;case 12:if(g&2048){Zr(r,o,c,d),r=o.stateNode;try{var y=o.memoizedProps,T=y.id,S=y.onPostCommit;typeof S=="function"&&S(T,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(q){Vt(o,o.return,q)}}else Zr(r,o,c,d);break;case 13:Zr(r,o,c,d);break;case 23:break;case 22:y=o.stateNode,T=o.alternate,o.memoizedState!==null?y._visibility&2?Zr(r,o,c,d):Gu(r,o):y._visibility&2?Zr(r,o,c,d):(y._visibility|=2,Kl(r,o,c,d,(o.subtreeFlags&10256)!==0)),g&2048&&Bp(T,o);break;case 24:Zr(r,o,c,d),g&2048&&qp(o.alternate,o);break;default:Zr(r,o,c,d)}}function Kl(r,o,c,d,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var y=r,T=o,S=c,q=d,ne=T.flags;switch(T.tag){case 0:case 11:case 15:Kl(y,T,S,q,g),zu(8,T);break;case 23:break;case 22:var de=T.stateNode;T.memoizedState!==null?de._visibility&2?Kl(y,T,S,q,g):Gu(y,T):(de._visibility|=2,Kl(y,T,S,q,g)),g&&ne&2048&&Bp(T.alternate,T);break;case 24:Kl(y,T,S,q,g),g&&ne&2048&&qp(T.alternate,T);break;default:Kl(y,T,S,q,g)}o=o.sibling}}function Gu(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=r,d=o,g=d.flags;switch(d.tag){case 22:Gu(c,d),g&2048&&Bp(d.alternate,d);break;case 24:Gu(c,d),g&2048&&qp(d.alternate,d);break;default:Gu(c,d)}o=o.sibling}}var $u=8192;function Ql(r){if(r.subtreeFlags&$u)for(r=r.child;r!==null;)_w(r),r=r.sibling}function _w(r){switch(r.tag){case 26:Ql(r),r.flags&$u&&r.memoizedState!==null&&eI(jr,r.memoizedState,r.memoizedProps);break;case 5:Ql(r);break;case 3:case 4:var o=jr;jr=Tf(r.stateNode.containerInfo),Ql(r),jr=o;break;case 22:r.memoizedState===null&&(o=r.alternate,o!==null&&o.memoizedState!==null?(o=$u,$u=16777216,Ql(r),$u=o):Ql(r));break;default:Ql(r)}}function Nw(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function Ku(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];Fn=d,Ew(d,r)}Nw(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Tw(r),r=r.sibling}function Tw(r){switch(r.tag){case 0:case 11:case 15:Ku(r),r.flags&2048&&di(9,r,r.return);break;case 3:Ku(r);break;case 12:Ku(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,hf(r)):Ku(r);break;default:Ku(r)}}function hf(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];Fn=d,Ew(d,r)}Nw(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:di(8,o,o.return),hf(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,hf(o));break;default:hf(o)}r=r.sibling}}function Ew(r,o){for(;Fn!==null;){var c=Fn;switch(c.tag){case 0:case 11:case 15:di(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Iu(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,Fn=d;else e:for(c=r;Fn!==null;){d=Fn;var g=d.sibling,y=d.return;if(pw(d),d===c){Fn=null;break e}if(g!==null){g.return=y,Fn=g;break e}Fn=y}}}var p2={getCacheForType:function(r){var o=ns(Tn),c=o.data.get(r);return c===void 0&&(c=r(),o.data.set(r,c)),c}},y2=typeof WeakMap=="function"?WeakMap:Map,Tt=0,Lt=null,st=null,ht=0,Et=0,zs=null,mi=!1,Yl=!1,zp=!1,Ra=0,rn=0,gi=0,Mo=0,Hp=0,mr=0,Xl=0,Qu=null,bs=null,Gp=!1,$p=0,ff=1/0,mf=null,pi=null,Xn=0,yi=null,Wl=null,Jl=0,Kp=0,Qp=null,Sw=null,Yu=0,Yp=null;function Hs(){if((Tt&2)!==0&&ht!==0)return ht&-ht;if(z.T!==null){var r=Fl;return r!==0?r:ny()}return Tr()}function Aw(){mr===0&&(mr=(ht&536870912)===0||xt?Ur():536870912);var r=fr.current;return r!==null&&(r.flags|=32),mr}function Gs(r,o,c){(r===Lt&&(Et===2||Et===9)||r.cancelPendingCommit!==null)&&(Zl(r,0),xi(r,ht,mr,!1)),us(r,c),((Tt&2)===0||r!==Lt)&&(r===Lt&&((Tt&2)===0&&(Mo|=c),rn===4&&xi(r,ht,mr,!1)),ea(r))}function jw(r,o,c){if((Tt&6)!==0)throw Error(n(327));var d=!c&&(o&124)===0&&(o&r.expiredLanes)===0||_r(r,o),g=d?b2(r,o):Jp(r,o,!0),y=d;do{if(g===0){Yl&&!d&&xi(r,o,0,!1);break}else{if(c=r.current.alternate,y&&!x2(c)){g=Jp(r,o,!1),y=!1;continue}if(g===2){if(y=o,r.errorRecoveryDisabledLanes&y)var T=0;else T=r.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){o=T;e:{var S=r;g=Qu;var q=S.current.memoizedState.isDehydrated;if(q&&(Zl(S,T).flags|=256),T=Jp(S,T,!1),T!==2){if(zp&&!q){S.errorRecoveryDisabledLanes|=y,Mo|=y,g=4;break e}y=bs,bs=g,y!==null&&(bs===null?bs=y:bs.push.apply(bs,y))}g=T}if(y=!1,g!==2)continue}}if(g===1){Zl(r,0),xi(r,o,0,!0);break}e:{switch(d=r,y=g,y){case 0:case 1:throw Error(n(345));case 4:if((o&4194048)!==o)break;case 6:xi(d,o,mr,!mi);break e;case 2:bs=null;break;case 3:case 5:break;default:throw Error(n(329))}if((o&62914560)===o&&(g=$p+300-ct(),10<g)){if(xi(d,o,mr,!mi),Fr(d,0,!0)!==0)break e;d.timeoutHandle=s_(Iw.bind(null,d,c,bs,mf,Gp,o,mr,Mo,Xl,mi,y,2,-0,0),g);break e}Iw(d,c,bs,mf,Gp,o,mr,Mo,Xl,mi,y,0,-0,0)}}break}while(!0);ea(r)}function Iw(r,o,c,d,g,y,T,S,q,ne,de,me,re,ie){if(r.timeoutHandle=-1,me=o.subtreeFlags,(me&8192||(me&16785408)===16785408)&&(nd={stylesheets:null,count:0,unsuspend:Z2},_w(o),me=tI(),me!==null)){r.cancelPendingCommit=me(Ow.bind(null,r,o,y,c,d,g,T,S,q,de,1,re,ie)),xi(r,y,T,!ne);return}Ow(r,o,y,c,d,g,T,S,q)}function x2(r){for(var o=r;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var g=c[d],y=g.getSnapshot;g=g.value;try{if(!Fs(y(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function xi(r,o,c,d){o&=~Hp,o&=~Mo,r.suspendedLanes|=o,r.pingedLanes&=~o,d&&(r.warmLanes|=o),d=r.expirationTimes;for(var g=o;0<g;){var y=31-bn(g),T=1<<y;d[y]=-1,g&=~T}c!==0&&tr(r,c,o)}function gf(){return(Tt&6)===0?(Xu(0),!1):!0}function Xp(){if(st!==null){if(Et===0)var r=st.return;else r=st,Na=Io=null,fp(r),Gl=null,Uu=0,r=st;for(;r!==null;)lw(r.alternate,r),r=r.return;st=null}}function Zl(r,o){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,O2(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),Xp(),Lt=r,st=c=ba(r.current,null),ht=o,Et=0,zs=null,mi=!1,Yl=_r(r,o),zp=!1,Xl=mr=Hp=Mo=gi=rn=0,bs=Qu=null,Gp=!1,(o&8)!==0&&(o|=o&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=o;0<d;){var g=31-bn(d),y=1<<g;o|=r[g],d&=~y}return Ra=o,Oh(),c}function Cw(r,o){Je=null,z.H=tf,o===Ru||o===Gh?(o=Kb(),Et=3):o===Hb?(o=Kb(),Et=4):Et=o===Q0?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,zs=o,st===null&&(rn=1,of(r,cr(o,r.current)))}function Rw(){var r=z.H;return z.H=tf,r===null?tf:r}function kw(){var r=z.A;return z.A=p2,r}function Wp(){rn=4,mi||(ht&4194048)!==ht&&fr.current!==null||(Yl=!0),(gi&134217727)===0&&(Mo&134217727)===0||Lt===null||xi(Lt,ht,mr,!1)}function Jp(r,o,c){var d=Tt;Tt|=2;var g=Rw(),y=kw();(Lt!==r||ht!==o)&&(mf=null,Zl(r,o)),o=!1;var T=rn;e:do try{if(Et!==0&&st!==null){var S=st,q=zs;switch(Et){case 8:Xp(),T=6;break e;case 3:case 2:case 9:case 6:fr.current===null&&(o=!0);var ne=Et;if(Et=0,zs=null,ec(r,S,q,ne),c&&Yl){T=0;break e}break;default:ne=Et,Et=0,zs=null,ec(r,S,q,ne)}}v2(),T=rn;break}catch(de){Cw(r,de)}while(!0);return o&&r.shellSuspendCounter++,Na=Io=null,Tt=d,z.H=g,z.A=y,st===null&&(Lt=null,ht=0,Oh()),T}function v2(){for(;st!==null;)Dw(st)}function b2(r,o){var c=Tt;Tt|=2;var d=Rw(),g=kw();Lt!==r||ht!==o?(mf=null,ff=ct()+500,Zl(r,o)):Yl=_r(r,o);e:do try{if(Et!==0&&st!==null){o=st;var y=zs;t:switch(Et){case 1:Et=0,zs=null,ec(r,o,y,1);break;case 2:case 9:if(Gb(y)){Et=0,zs=null,Pw(o);break}o=function(){Et!==2&&Et!==9||Lt!==r||(Et=7),ea(r)},y.then(o,o);break e;case 3:Et=7;break e;case 4:Et=5;break e;case 7:Gb(y)?(Et=0,zs=null,Pw(o)):(Et=0,zs=null,ec(r,o,y,7));break;case 5:var T=null;switch(st.tag){case 26:T=st.memoizedState;case 5:case 27:var S=st;if(!T||g_(T)){Et=0,zs=null;var q=S.sibling;if(q!==null)st=q;else{var ne=S.return;ne!==null?(st=ne,pf(ne)):st=null}break t}}Et=0,zs=null,ec(r,o,y,5);break;case 6:Et=0,zs=null,ec(r,o,y,6);break;case 8:Xp(),rn=6;break e;default:throw Error(n(462))}}w2();break}catch(de){Cw(r,de)}while(!0);return Na=Io=null,z.H=d,z.A=g,Tt=c,st!==null?0:(Lt=null,ht=0,Oh(),rn)}function w2(){for(;st!==null&&!Qe();)Dw(st)}function Dw(r){var o=iw(r.alternate,r,Ra);r.memoizedProps=r.pendingProps,o===null?pf(r):st=o}function Pw(r){var o=r,c=o.alternate;switch(o.tag){case 15:case 0:o=ew(c,o,o.pendingProps,o.type,void 0,ht);break;case 11:o=ew(c,o,o.pendingProps,o.type.render,o.ref,ht);break;case 5:fp(o);default:lw(c,o),o=st=Mb(o,Ra),o=iw(c,o,Ra)}r.memoizedProps=r.pendingProps,o===null?pf(r):st=o}function ec(r,o,c,d){Na=Io=null,fp(o),Gl=null,Uu=0;var g=o.return;try{if(u2(r,g,o,c,ht)){rn=1,of(r,cr(c,r.current)),st=null;return}}catch(y){if(g!==null)throw st=g,y;rn=1,of(r,cr(c,r.current)),st=null;return}o.flags&32768?(xt||d===1?r=!0:Yl||(ht&536870912)!==0?r=!1:(mi=r=!0,(d===2||d===9||d===3||d===6)&&(d=fr.current,d!==null&&d.tag===13&&(d.flags|=16384))),Mw(o,r)):pf(o)}function pf(r){var o=r;do{if((o.flags&32768)!==0){Mw(o,mi);return}r=o.return;var c=h2(o.alternate,o,Ra);if(c!==null){st=c;return}if(o=o.sibling,o!==null){st=o;return}st=o=r}while(o!==null);rn===0&&(rn=5)}function Mw(r,o){do{var c=f2(r.alternate,r);if(c!==null){c.flags&=32767,st=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(r=r.sibling,r!==null)){st=r;return}st=r=c}while(r!==null);rn=6,st=null}function Ow(r,o,c,d,g,y,T,S,q){r.cancelPendingCommit=null;do yf();while(Xn!==0);if((Tt&6)!==0)throw Error(n(327));if(o!==null){if(o===r.current)throw Error(n(177));if(y=o.lanes|o.childLanes,y|=qg,lo(r,c,y,T,S,q),r===Lt&&(st=Lt=null,ht=0),Wl=o,yi=r,Jl=c,Kp=y,Qp=g,Sw=d,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,E2($n,function(){return Bw(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||d){d=z.T,z.T=null,g=oe.p,oe.p=2,T=Tt,Tt|=4;try{m2(r,o,c)}finally{Tt=T,oe.p=g,z.T=d}}Xn=1,Vw(),Lw(),Fw()}}function Vw(){if(Xn===1){Xn=0;var r=yi,o=Wl,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=z.T,z.T=null;var d=oe.p;oe.p=2;var g=Tt;Tt|=4;try{vw(o,r);var y=uy,T=Eb(r.containerInfo),S=y.focusedElem,q=y.selectionRange;if(T!==S&&S&&S.ownerDocument&&Tb(S.ownerDocument.documentElement,S)){if(q!==null&&Vg(S)){var ne=q.start,de=q.end;if(de===void 0&&(de=ne),"selectionStart"in S)S.selectionStart=ne,S.selectionEnd=Math.min(de,S.value.length);else{var me=S.ownerDocument||document,re=me&&me.defaultView||window;if(re.getSelection){var ie=re.getSelection(),He=S.textContent.length,Ue=Math.min(q.start,He),Dt=q.end===void 0?Ue:Math.min(q.end,He);!ie.extend&&Ue>Dt&&(T=Dt,Dt=Ue,Ue=T);var X=Nb(S,Ue),K=Nb(S,Dt);if(X&&K&&(ie.rangeCount!==1||ie.anchorNode!==X.node||ie.anchorOffset!==X.offset||ie.focusNode!==K.node||ie.focusOffset!==K.offset)){var Z=me.createRange();Z.setStart(X.node,X.offset),ie.removeAllRanges(),Ue>Dt?(ie.addRange(Z),ie.extend(K.node,K.offset)):(Z.setEnd(K.node,K.offset),ie.addRange(Z))}}}}for(me=[],ie=S;ie=ie.parentNode;)ie.nodeType===1&&me.push({element:ie,left:ie.scrollLeft,top:ie.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<me.length;S++){var fe=me[S];fe.element.scrollLeft=fe.left,fe.element.scrollTop=fe.top}}If=!!cy,uy=cy=null}finally{Tt=g,oe.p=d,z.T=c}}r.current=o,Xn=2}}function Lw(){if(Xn===2){Xn=0;var r=yi,o=Wl,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=z.T,z.T=null;var d=oe.p;oe.p=2;var g=Tt;Tt|=4;try{gw(r,o.alternate,o)}finally{Tt=g,oe.p=d,z.T=c}}Xn=3}}function Fw(){if(Xn===4||Xn===3){Xn=0,gt();var r=yi,o=Wl,c=Jl,d=Sw;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Xn=5:(Xn=0,Wl=yi=null,Uw(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(pi=null),Za(c),o=o.stateNode,pt&&typeof pt.onCommitFiberRoot=="function")try{pt.onCommitFiberRoot(_t,o,void 0,(o.current.flags&128)===128)}catch{}if(d!==null){o=z.T,g=oe.p,oe.p=2,z.T=null;try{for(var y=r.onRecoverableError,T=0;T<d.length;T++){var S=d[T];y(S.value,{componentStack:S.stack})}}finally{z.T=o,oe.p=g}}(Jl&3)!==0&&yf(),ea(r),g=r.pendingLanes,(c&4194090)!==0&&(g&42)!==0?r===Yp?Yu++:(Yu=0,Yp=r):Yu=0,Xu(0)}}function Uw(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Iu(o)))}function yf(r){return Vw(),Lw(),Fw(),Bw()}function Bw(){if(Xn!==5)return!1;var r=yi,o=Kp;Kp=0;var c=Za(Jl),d=z.T,g=oe.p;try{oe.p=32>c?32:c,z.T=null,c=Qp,Qp=null;var y=yi,T=Jl;if(Xn=0,Wl=yi=null,Jl=0,(Tt&6)!==0)throw Error(n(331));var S=Tt;if(Tt|=4,Tw(y.current),ww(y,y.current,T,c),Tt=S,Xu(0,!1),pt&&typeof pt.onPostCommitFiberRoot=="function")try{pt.onPostCommitFiberRoot(_t,y)}catch{}return!0}finally{oe.p=g,z.T=d,Uw(r,o)}}function qw(r,o,c){o=cr(c,o),o=Ap(r.stateNode,o,2),r=oi(r,o,2),r!==null&&(us(r,2),ea(r))}function Vt(r,o,c){if(r.tag===3)qw(r,r,c);else for(;o!==null;){if(o.tag===3){qw(o,r,c);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(pi===null||!pi.has(d))){r=cr(c,r),c=$0(2),d=oi(o,c,2),d!==null&&(K0(c,d,o,r),us(d,2),ea(d));break}}o=o.return}}function Zp(r,o,c){var d=r.pingCache;if(d===null){d=r.pingCache=new y2;var g=new Set;d.set(o,g)}else g=d.get(o),g===void 0&&(g=new Set,d.set(o,g));g.has(c)||(zp=!0,g.add(c),r=_2.bind(null,r,o,c),o.then(r,r))}function _2(r,o,c){var d=r.pingCache;d!==null&&d.delete(o),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Lt===r&&(ht&c)===c&&(rn===4||rn===3&&(ht&62914560)===ht&&300>ct()-$p?(Tt&2)===0&&Zl(r,0):Hp|=c,Xl===ht&&(Xl=0)),ea(r)}function zw(r,o){o===0&&(o=Br()),r=Ml(r,o),r!==null&&(us(r,o),ea(r))}function N2(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),zw(r,c)}function T2(r,o){var c=0;switch(r.tag){case 13:var d=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(o),zw(r,c)}function E2(r,o){return lt(r,o)}var xf=null,tc=null,ey=!1,vf=!1,ty=!1,Oo=0;function ea(r){r!==tc&&r.next===null&&(tc===null?xf=tc=r:tc=tc.next=r),vf=!0,ey||(ey=!0,A2())}function Xu(r,o){if(!ty&&vf){ty=!0;do for(var c=!1,d=xf;d!==null;){if(r!==0){var g=d.pendingLanes;if(g===0)var y=0;else{var T=d.suspendedLanes,S=d.pingedLanes;y=(1<<31-bn(42|r)+1)-1,y&=g&~(T&~S),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,Kw(d,y))}else y=ht,y=Fr(d,d===Lt?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(y&3)===0||_r(d,y)||(c=!0,Kw(d,y));d=d.next}while(c);ty=!1}}function S2(){Hw()}function Hw(){vf=ey=!1;var r=0;Oo!==0&&(M2()&&(r=Oo),Oo=0);for(var o=ct(),c=null,d=xf;d!==null;){var g=d.next,y=Gw(d,o);y===0?(d.next=null,c===null?xf=g:c.next=g,g===null&&(tc=c)):(c=d,(r!==0||(y&3)!==0)&&(vf=!0)),d=g}Xu(r)}function Gw(r,o){for(var c=r.suspendedLanes,d=r.pingedLanes,g=r.expirationTimes,y=r.pendingLanes&-62914561;0<y;){var T=31-bn(y),S=1<<T,q=g[T];q===-1?((S&c)===0||(S&d)!==0)&&(g[T]=oo(S,o)):q<=o&&(r.expiredLanes|=S),y&=~S}if(o=Lt,c=ht,c=Fr(r,r===o?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,c===0||r===o&&(Et===2||Et===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&ze(d),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||_r(r,c)){if(o=c&-c,o===r.callbackPriority)return o;switch(d!==null&&ze(d),Za(c)){case 2:case 8:c=an;break;case 32:c=$n;break;case 268435456:c=Ds;break;default:c=$n}return d=$w.bind(null,r),c=lt(c,d),r.callbackPriority=o,r.callbackNode=c,o}return d!==null&&d!==null&&ze(d),r.callbackPriority=2,r.callbackNode=null,2}function $w(r,o){if(Xn!==0&&Xn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(yf()&&r.callbackNode!==c)return null;var d=ht;return d=Fr(r,r===Lt?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(jw(r,d,o),Gw(r,ct()),r.callbackNode!=null&&r.callbackNode===c?$w.bind(null,r):null)}function Kw(r,o){if(yf())return null;jw(r,o,!0)}function A2(){V2(function(){(Tt&6)!==0?lt(Gn,S2):Hw()})}function ny(){return Oo===0&&(Oo=Ur()),Oo}function Qw(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Nl(""+r)}function Yw(r,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,r.id&&c.setAttribute("form",r.id),o.parentNode.insertBefore(c,o),r=new FormData(r),c.parentNode.removeChild(c),r}function j2(r,o,c,d,g){if(o==="submit"&&c&&c.stateNode===g){var y=Qw((g[nn]||null).action),T=d.submitter;T&&(o=(o=T[nn]||null)?Qw(o.formAction):T.getAttribute("formAction"),o!==null&&(y=o,T=null));var S=new Tl("action","action",null,d,g);r.push({event:S,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Oo!==0){var q=T?Yw(g,T):new FormData(g);_p(c,{pending:!0,data:q,method:g.method,action:y},null,q)}}else typeof y=="function"&&(S.preventDefault(),q=T?Yw(g,T):new FormData(g),_p(c,{pending:!0,data:q,method:g.method,action:y},y,q))},currentTarget:g}]})}}for(var sy=0;sy<Bg.length;sy++){var ry=Bg[sy],I2=ry.toLowerCase(),C2=ry[0].toUpperCase()+ry.slice(1);Ar(I2,"on"+C2)}Ar(jb,"onAnimationEnd"),Ar(Ib,"onAnimationIteration"),Ar(Cb,"onAnimationStart"),Ar("dblclick","onDoubleClick"),Ar("focusin","onFocus"),Ar("focusout","onBlur"),Ar(K1,"onTransitionRun"),Ar(Q1,"onTransitionStart"),Ar(Y1,"onTransitionCancel"),Ar(Rb,"onTransitionEnd"),je("onMouseEnter",["mouseout","mouseover"]),je("onMouseLeave",["mouseout","mouseover"]),je("onPointerEnter",["pointerout","pointerover"]),je("onPointerLeave",["pointerout","pointerover"]),ye("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ye("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ye("onBeforeInput",["compositionend","keypress","textInput","paste"]),ye("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ye("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ye("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),R2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Wu));function Xw(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var d=r[c],g=d.event;d=d.listeners;e:{var y=void 0;if(o)for(var T=d.length-1;0<=T;T--){var S=d[T],q=S.instance,ne=S.currentTarget;if(S=S.listener,q!==y&&g.isPropagationStopped())break e;y=S,g.currentTarget=ne;try{y(g)}catch(de){af(de)}g.currentTarget=null,y=q}else for(T=0;T<d.length;T++){if(S=d[T],q=S.instance,ne=S.currentTarget,S=S.listener,q!==y&&g.isPropagationStopped())break e;y=S,g.currentTarget=ne;try{y(g)}catch(de){af(de)}g.currentTarget=null,y=q}}}}function rt(r,o){var c=o[nr];c===void 0&&(c=o[nr]=new Set);var d=r+"__bubble";c.has(d)||(Ww(o,r,2,!1),c.add(d))}function ay(r,o,c){var d=0;o&&(d|=4),Ww(c,r,d,o)}var bf="_reactListening"+Math.random().toString(36).slice(2);function iy(r){if(!r[bf]){r[bf]=!0,De.forEach(function(c){c!=="selectionchange"&&(R2.has(c)||ay(c,!1,r),ay(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[bf]||(o[bf]=!0,ay("selectionchange",!1,o))}}function Ww(r,o,c,d){switch(w_(o)){case 2:var g=rI;break;case 8:g=aI;break;default:g=by}c=g.bind(null,o,c,r),g=void 0,!or||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),d?g!==void 0?r.addEventListener(o,c,{capture:!0,passive:g}):r.addEventListener(o,c,!0):g!==void 0?r.addEventListener(o,c,{passive:g}):r.addEventListener(o,c,!1)}function oy(r,o,c,d,g){var y=d;if((o&1)===0&&(o&2)===0&&d!==null)e:for(;;){if(d===null)return;var T=d.tag;if(T===3||T===4){var S=d.stateNode.containerInfo;if(S===g)break;if(T===4)for(T=d.return;T!==null;){var q=T.tag;if((q===3||q===4)&&T.stateNode.containerInfo===g)return;T=T.return}for(;S!==null;){if(T=sr(S),T===null)return;if(q=T.tag,q===5||q===6||q===26||q===27){d=y=T;continue e}S=S.parentNode}}d=d.return}wh(function(){var ne=y,de=ir(c),me=[];e:{var re=kb.get(r);if(re!==void 0){var ie=Tl,He=r;switch(r){case"keypress":if(Gr(c)===0)break e;case"keydown":case"keyup":ie=Cl;break;case"focusin":He="focus",ie=Al;break;case"focusout":He="blur",ie=Al;break;case"beforeblur":case"afterblur":ie=Al;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=lr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=Dg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=Ih;break;case jb:case Ib:case Cb:ie=jl;break;case Rb:ie=Rh;break;case"scroll":case"scrollend":ie=_h;break;case"wheel":ie=Rl;break;case"copy":case"cut":case"paste":ie=Il;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=wu;break;case"toggle":case"beforetoggle":ie=Dh}var Ue=(o&4)!==0,Dt=!Ue&&(r==="scroll"||r==="scrollend"),X=Ue?re!==null?re+"Capture":null:re;Ue=[];for(var K=ne,Z;K!==null;){var fe=K;if(Z=fe.stateNode,fe=fe.tag,fe!==5&&fe!==26&&fe!==27||Z===null||X===null||(fe=go(K,X),fe!=null&&Ue.push(Ju(K,fe,Z))),Dt)break;K=K.return}0<Ue.length&&(re=new ie(re,He,null,c,de),me.push({event:re,listeners:Ue}))}}if((o&7)===0){e:{if(re=r==="mouseover"||r==="pointerover",ie=r==="mouseout"||r==="pointerout",re&&c!==ma&&(He=c.relatedTarget||c.fromElement)&&(sr(He)||He[Yt]))break e;if((ie||re)&&(re=de.window===de?de:(re=de.ownerDocument)?re.defaultView||re.parentWindow:window,ie?(He=c.relatedTarget||c.toElement,ie=ne,He=He?sr(He):null,He!==null&&(Dt=l(He),Ue=He.tag,He!==Dt||Ue!==5&&Ue!==27&&Ue!==6)&&(He=null)):(ie=null,He=ne),ie!==He)){if(Ue=lr,fe="onMouseLeave",X="onMouseEnter",K="mouse",(r==="pointerout"||r==="pointerover")&&(Ue=wu,fe="onPointerLeave",X="onPointerEnter",K="pointer"),Dt=ie==null?re:Vs(ie),Z=He==null?re:Vs(He),re=new Ue(fe,K+"leave",ie,c,de),re.target=Dt,re.relatedTarget=Z,fe=null,sr(de)===ne&&(Ue=new Ue(X,K+"enter",He,c,de),Ue.target=Z,Ue.relatedTarget=Dt,fe=Ue),Dt=fe,ie&&He)t:{for(Ue=ie,X=He,K=0,Z=Ue;Z;Z=nc(Z))K++;for(Z=0,fe=X;fe;fe=nc(fe))Z++;for(;0<K-Z;)Ue=nc(Ue),K--;for(;0<Z-K;)X=nc(X),Z--;for(;K--;){if(Ue===X||X!==null&&Ue===X.alternate)break t;Ue=nc(Ue),X=nc(X)}Ue=null}else Ue=null;ie!==null&&Jw(me,re,ie,Ue,!1),He!==null&&Dt!==null&&Jw(me,Dt,He,Ue,!0)}}e:{if(re=ne?Vs(ne):window,ie=re.nodeName&&re.nodeName.toLowerCase(),ie==="select"||ie==="input"&&re.type==="file")var Re=yb;else if(Nn(re))if(xb)Re=H1;else{Re=q1;var et=B1}else ie=re.nodeName,!ie||ie.toLowerCase()!=="input"||re.type!=="checkbox"&&re.type!=="radio"?ne&&mu(ne.elementType)&&(Re=yb):Re=z1;if(Re&&(Re=Re(r,ne))){va(me,Re,c,de);break e}et&&et(r,re,ne),r==="focusout"&&ne&&re.type==="number"&&ne.memoizedProps.value!=null&&ni(re,"number",re.value)}switch(et=ne?Vs(ne):window,r){case"focusin":(Nn(et)||et.contentEditable==="true")&&(kl=et,Lg=ne,Tu=null);break;case"focusout":Tu=Lg=kl=null;break;case"mousedown":Fg=!0;break;case"contextmenu":case"mouseup":case"dragend":Fg=!1,Sb(me,c,de);break;case"selectionchange":if($1)break;case"keydown":case"keyup":Sb(me,c,de)}var Oe;if(Qr)e:{switch(r){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else ut?le(r,c)&&(Be="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Be="onCompositionStart");Be&&(_&&c.locale!=="ko"&&(ut||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&ut&&(Oe=pu()):(Hr=de,si="value"in Hr?Hr.value:Hr.textContent,ut=!0)),et=wf(ne,Be),0<et.length&&(Be=new vu(Be,r,null,c,de),me.push({event:Be,listeners:et}),Oe?Be.data=Oe:(Oe=_e(c),Oe!==null&&(Be.data=Oe)))),(Oe=v?_n(r,c):dt(r,c))&&(Be=wf(ne,"onBeforeInput"),0<Be.length&&(et=new vu("onBeforeInput","beforeinput",null,c,de),me.push({event:et,listeners:Be}),et.data=Oe)),j2(me,r,ne,c,de)}Xw(me,o)})}function Ju(r,o,c){return{instance:r,listener:o,currentTarget:c}}function wf(r,o){for(var c=o+"Capture",d=[];r!==null;){var g=r,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=go(r,c),g!=null&&d.unshift(Ju(r,g,y)),g=go(r,o),g!=null&&d.push(Ju(r,g,y))),r.tag===3)return d;r=r.return}return[]}function nc(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Jw(r,o,c,d,g){for(var y=o._reactName,T=[];c!==null&&c!==d;){var S=c,q=S.alternate,ne=S.stateNode;if(S=S.tag,q!==null&&q===d)break;S!==5&&S!==26&&S!==27||ne===null||(q=ne,g?(ne=go(c,y),ne!=null&&T.unshift(Ju(c,ne,q))):g||(ne=go(c,y),ne!=null&&T.push(Ju(c,ne,q)))),c=c.return}T.length!==0&&r.push({event:o,listeners:T})}var k2=/\r\n?/g,D2=/\u0000|\uFFFD/g;function Zw(r){return(typeof r=="string"?r:""+r).replace(k2,`
`).replace(D2,"")}function e_(r,o){return o=Zw(o),Zw(r)===o}function _f(){}function kt(r,o,c,d,g,y){switch(c){case"children":typeof d=="string"?o==="body"||o==="textarea"&&d===""||ar(r,d):(typeof d=="number"||typeof d=="bigint")&&o!=="body"&&ar(r,""+d);break;case"className":ts(r,"class",d);break;case"tabIndex":ts(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":ts(r,c,d);break;case"style":fu(r,d,y);break;case"data":if(o!=="object"){ts(r,"data",d);break}case"src":case"href":if(d===""&&(o!=="a"||c!=="href")){r.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=Nl(""+d),r.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(o!=="input"&&kt(r,o,"name",g.name,g,null),kt(r,o,"formEncType",g.formEncType,g,null),kt(r,o,"formMethod",g.formMethod,g,null),kt(r,o,"formTarget",g.formTarget,g,null)):(kt(r,o,"encType",g.encType,g,null),kt(r,o,"method",g.method,g,null),kt(r,o,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=Nl(""+d),r.setAttribute(c,d);break;case"onClick":d!=null&&(r.onclick=_f);break;case"onScroll":d!=null&&rt("scroll",r);break;case"onScrollEnd":d!=null&&rt("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}c=Nl(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""+d):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":d===!0?r.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,d):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(c,d):r.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(c):r.setAttribute(c,d);break;case"popover":rt("beforetoggle",r),rt("toggle",r),Mn(r,"popover",d);break;case"xlinkActuate":ln(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":ln(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":ln(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":ln(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":ln(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":ln(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":ln(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":ln(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":ln(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Mn(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Rg.get(c)||c,Mn(r,c,d))}}function ly(r,o,c,d,g,y){switch(c){case"style":fu(r,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"children":typeof d=="string"?ar(r,d):(typeof d=="number"||typeof d=="bigint")&&ar(r,""+d);break;case"onScroll":d!=null&&rt("scroll",r);break;case"onScrollEnd":d!=null&&rt("scrollend",r);break;case"onClick":d!=null&&(r.onclick=_f);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Q.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),y=r[nn]||null,y=y!=null?y[c]:null,typeof y=="function"&&r.removeEventListener(o,y,g),typeof d=="function")){typeof y!="function"&&y!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(o,d,g);break e}c in r?r[c]=d:d===!0?r.setAttribute(c,""):Mn(r,c,d)}}}function Wn(r,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":rt("error",r),rt("load",r);var d=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var T=c[y];if(T!=null)switch(y){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:kt(r,o,y,T,c,null)}}g&&kt(r,o,"srcSet",c.srcSet,c,null),d&&kt(r,o,"src",c.src,c,null);return;case"input":rt("invalid",r);var S=y=T=g=null,q=null,ne=null;for(d in c)if(c.hasOwnProperty(d)){var de=c[d];if(de!=null)switch(d){case"name":g=de;break;case"type":T=de;break;case"checked":q=de;break;case"defaultChecked":ne=de;break;case"value":y=de;break;case"defaultValue":S=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(n(137,o));break;default:kt(r,o,d,de,c,null)}}ho(r,y,S,q,ne,T,g,!1),_l(r);return;case"select":rt("invalid",r),d=T=y=null;for(g in c)if(c.hasOwnProperty(g)&&(S=c[g],S!=null))switch(g){case"value":y=S;break;case"defaultValue":T=S;break;case"multiple":d=S;default:kt(r,o,g,S,c,null)}o=y,c=T,r.multiple=!!d,o!=null?fa(r,!!d,o,!1):c!=null&&fa(r,!!d,c,!0);return;case"textarea":rt("invalid",r),y=g=d=null;for(T in c)if(c.hasOwnProperty(T)&&(S=c[T],S!=null))switch(T){case"value":d=S;break;case"defaultValue":g=S;break;case"children":y=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:kt(r,o,T,S,c,null)}fo(r,d,g,y),_l(r);return;case"option":for(q in c)if(c.hasOwnProperty(q)&&(d=c[q],d!=null))switch(q){case"selected":r.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:kt(r,o,q,d,c,null)}return;case"dialog":rt("beforetoggle",r),rt("toggle",r),rt("cancel",r),rt("close",r);break;case"iframe":case"object":rt("load",r);break;case"video":case"audio":for(d=0;d<Wu.length;d++)rt(Wu[d],r);break;case"image":rt("error",r),rt("load",r);break;case"details":rt("toggle",r);break;case"embed":case"source":case"link":rt("error",r),rt("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ne in c)if(c.hasOwnProperty(ne)&&(d=c[ne],d!=null))switch(ne){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:kt(r,o,ne,d,c,null)}return;default:if(mu(o)){for(de in c)c.hasOwnProperty(de)&&(d=c[de],d!==void 0&&ly(r,o,de,d,c,void 0));return}}for(S in c)c.hasOwnProperty(S)&&(d=c[S],d!=null&&kt(r,o,S,d,c,null))}function P2(r,o,c,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,T=null,S=null,q=null,ne=null,de=null;for(ie in c){var me=c[ie];if(c.hasOwnProperty(ie)&&me!=null)switch(ie){case"checked":break;case"value":break;case"defaultValue":q=me;default:d.hasOwnProperty(ie)||kt(r,o,ie,null,d,me)}}for(var re in d){var ie=d[re];if(me=c[re],d.hasOwnProperty(re)&&(ie!=null||me!=null))switch(re){case"type":y=ie;break;case"name":g=ie;break;case"checked":ne=ie;break;case"defaultChecked":de=ie;break;case"value":T=ie;break;case"defaultValue":S=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(n(137,o));break;default:ie!==me&&kt(r,o,re,ie,d,me)}}Ls(r,T,S,q,ne,de,y,g);return;case"select":ie=T=S=re=null;for(y in c)if(q=c[y],c.hasOwnProperty(y)&&q!=null)switch(y){case"value":break;case"multiple":ie=q;default:d.hasOwnProperty(y)||kt(r,o,y,null,d,q)}for(g in d)if(y=d[g],q=c[g],d.hasOwnProperty(g)&&(y!=null||q!=null))switch(g){case"value":re=y;break;case"defaultValue":S=y;break;case"multiple":T=y;default:y!==q&&kt(r,o,g,y,d,q)}o=S,c=T,d=ie,re!=null?fa(r,!!c,re,!1):!!d!=!!c&&(o!=null?fa(r,!!c,o,!0):fa(r,!!c,c?[]:"",!1));return;case"textarea":ie=re=null;for(S in c)if(g=c[S],c.hasOwnProperty(S)&&g!=null&&!d.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:kt(r,o,S,null,d,g)}for(T in d)if(g=d[T],y=c[T],d.hasOwnProperty(T)&&(g!=null||y!=null))switch(T){case"value":re=g;break;case"defaultValue":ie=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(n(91));break;default:g!==y&&kt(r,o,T,g,d,y)}Ct(r,re,ie);return;case"option":for(var He in c)if(re=c[He],c.hasOwnProperty(He)&&re!=null&&!d.hasOwnProperty(He))switch(He){case"selected":r.selected=!1;break;default:kt(r,o,He,null,d,re)}for(q in d)if(re=d[q],ie=c[q],d.hasOwnProperty(q)&&re!==ie&&(re!=null||ie!=null))switch(q){case"selected":r.selected=re&&typeof re!="function"&&typeof re!="symbol";break;default:kt(r,o,q,re,d,ie)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ue in c)re=c[Ue],c.hasOwnProperty(Ue)&&re!=null&&!d.hasOwnProperty(Ue)&&kt(r,o,Ue,null,d,re);for(ne in d)if(re=d[ne],ie=c[ne],d.hasOwnProperty(ne)&&re!==ie&&(re!=null||ie!=null))switch(ne){case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(n(137,o));break;default:kt(r,o,ne,re,d,ie)}return;default:if(mu(o)){for(var Dt in c)re=c[Dt],c.hasOwnProperty(Dt)&&re!==void 0&&!d.hasOwnProperty(Dt)&&ly(r,o,Dt,void 0,d,re);for(de in d)re=d[de],ie=c[de],!d.hasOwnProperty(de)||re===ie||re===void 0&&ie===void 0||ly(r,o,de,re,d,ie);return}}for(var X in c)re=c[X],c.hasOwnProperty(X)&&re!=null&&!d.hasOwnProperty(X)&&kt(r,o,X,null,d,re);for(me in d)re=d[me],ie=c[me],!d.hasOwnProperty(me)||re===ie||re==null&&ie==null||kt(r,o,me,re,d,ie)}var cy=null,uy=null;function Nf(r){return r.nodeType===9?r:r.ownerDocument}function t_(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function n_(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function dy(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var hy=null;function M2(){var r=window.event;return r&&r.type==="popstate"?r===hy?!1:(hy=r,!0):(hy=null,!1)}var s_=typeof setTimeout=="function"?setTimeout:void 0,O2=typeof clearTimeout=="function"?clearTimeout:void 0,r_=typeof Promise=="function"?Promise:void 0,V2=typeof queueMicrotask=="function"?queueMicrotask:typeof r_<"u"?function(r){return r_.resolve(null).then(r).catch(L2)}:s_;function L2(r){setTimeout(function(){throw r})}function vi(r){return r==="head"}function a_(r,o){var c=o,d=0,g=0;do{var y=c.nextSibling;if(r.removeChild(c),y&&y.nodeType===8)if(c=y.data,c==="/$"){if(0<d&&8>d){c=d;var T=r.ownerDocument;if(c&1&&Zu(T.documentElement),c&2&&Zu(T.body),c&4)for(c=T.head,Zu(c),T=c.firstChild;T;){var S=T.nextSibling,q=T.nodeName;T[qr]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&T.rel.toLowerCase()==="stylesheet"||c.removeChild(T),T=S}}if(g===0){r.removeChild(y),od(o);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:d=c.charCodeAt(0)-48;else d=0;c=y}while(c);od(o)}function fy(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":fy(c),Dn(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function F2(r,o,c,d){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[qr])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(y=r.getAttribute("rel"),y==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(y!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(y=r.getAttribute("src"),(y!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===y)return r}else return r;if(r=Ir(r.nextSibling),r===null)break}return null}function U2(r,o,c){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=Ir(r.nextSibling),r===null))return null;return r}function my(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function B2(r,o){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")o();else{var d=function(){o(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function Ir(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return r}var gy=null;function i_(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return r;o--}else c==="/$"&&o++}r=r.previousSibling}return null}function o_(r,o,c){switch(o=Nf(c),r){case"html":if(r=o.documentElement,!r)throw Error(n(452));return r;case"head":if(r=o.head,!r)throw Error(n(453));return r;case"body":if(r=o.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function Zu(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);Dn(r)}var gr=new Map,l_=new Set;function Tf(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var ka=oe.d;oe.d={f:q2,r:z2,D:H2,C:G2,L:$2,m:K2,X:Y2,S:Q2,M:X2};function q2(){var r=ka.f(),o=gf();return r||o}function z2(r){var o=Os(r);o!==null&&o.tag===5&&o.type==="form"?j0(o):ka.r(r)}var sc=typeof document>"u"?null:document;function c_(r,o,c){var d=sc;if(d&&typeof o=="string"&&o){var g=mn(o);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),l_.has(g)||(l_.add(g),r={rel:r,crossOrigin:c,href:o},d.querySelector(g)===null&&(o=d.createElement("link"),Wn(o,"link",r),Xt(o),d.head.appendChild(o)))}}function H2(r){ka.D(r),c_("dns-prefetch",r,null)}function G2(r,o){ka.C(r,o),c_("preconnect",r,o)}function $2(r,o,c){ka.L(r,o,c);var d=sc;if(d&&r&&o){var g='link[rel="preload"][as="'+mn(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+mn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+mn(c.imageSizes)+'"]')):g+='[href="'+mn(r)+'"]';var y=g;switch(o){case"style":y=rc(r);break;case"script":y=ac(r)}gr.has(y)||(r=x({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:r,as:o},c),gr.set(y,r),d.querySelector(g)!==null||o==="style"&&d.querySelector(ed(y))||o==="script"&&d.querySelector(td(y))||(o=d.createElement("link"),Wn(o,"link",r),Xt(o),d.head.appendChild(o)))}}function K2(r,o){ka.m(r,o);var c=sc;if(c&&r){var d=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+mn(d)+'"][href="'+mn(r)+'"]',y=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=ac(r)}if(!gr.has(y)&&(r=x({rel:"modulepreload",href:r},o),gr.set(y,r),c.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(td(y)))return}d=c.createElement("link"),Wn(d,"link",r),Xt(d),c.head.appendChild(d)}}}function Q2(r,o,c){ka.S(r,o,c);var d=sc;if(d&&r){var g=Pn(d).hoistableStyles,y=rc(r);o=o||"default";var T=g.get(y);if(!T){var S={loading:0,preload:null};if(T=d.querySelector(ed(y)))S.loading=5;else{r=x({rel:"stylesheet",href:r,"data-precedence":o},c),(c=gr.get(y))&&py(r,c);var q=T=d.createElement("link");Xt(q),Wn(q,"link",r),q._p=new Promise(function(ne,de){q.onload=ne,q.onerror=de}),q.addEventListener("load",function(){S.loading|=1}),q.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Ef(T,o,d)}T={type:"stylesheet",instance:T,count:1,state:S},g.set(y,T)}}}function Y2(r,o){ka.X(r,o);var c=sc;if(c&&r){var d=Pn(c).hoistableScripts,g=ac(r),y=d.get(g);y||(y=c.querySelector(td(g)),y||(r=x({src:r,async:!0},o),(o=gr.get(g))&&yy(r,o),y=c.createElement("script"),Xt(y),Wn(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function X2(r,o){ka.M(r,o);var c=sc;if(c&&r){var d=Pn(c).hoistableScripts,g=ac(r),y=d.get(g);y||(y=c.querySelector(td(g)),y||(r=x({src:r,async:!0,type:"module"},o),(o=gr.get(g))&&yy(r,o),y=c.createElement("script"),Xt(y),Wn(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function u_(r,o,c,d){var g=(g=Ee.current)?Tf(g):null;if(!g)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=rc(c.href),c=Pn(g).hoistableStyles,d=c.get(o),d||(d={type:"style",instance:null,count:0,state:null},c.set(o,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=rc(c.href);var y=Pn(g).hoistableStyles,T=y.get(r);if(T||(g=g.ownerDocument||g,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(r,T),(y=g.querySelector(ed(r)))&&!y._p&&(T.instance=y,T.state.loading=5),gr.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},gr.set(r,c),y||W2(g,r,c,T.state))),o&&d===null)throw Error(n(528,""));return T}if(o&&d!==null)throw Error(n(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=ac(c),c=Pn(g).hoistableScripts,d=c.get(o),d||(d={type:"script",instance:null,count:0,state:null},c.set(o,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function rc(r){return'href="'+mn(r)+'"'}function ed(r){return'link[rel="stylesheet"]['+r+"]"}function d_(r){return x({},r,{"data-precedence":r.precedence,precedence:null})}function W2(r,o,c,d){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?d.loading=1:(o=r.createElement("link"),d.preload=o,o.addEventListener("load",function(){return d.loading|=1}),o.addEventListener("error",function(){return d.loading|=2}),Wn(o,"link",c),Xt(o),r.head.appendChild(o))}function ac(r){return'[src="'+mn(r)+'"]'}function td(r){return"script[async]"+r}function h_(r,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var d=r.querySelector('style[data-href~="'+mn(c.href)+'"]');if(d)return o.instance=d,Xt(d),d;var g=x({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),Xt(d),Wn(d,"style",g),Ef(d,c.precedence,r),o.instance=d;case"stylesheet":g=rc(c.href);var y=r.querySelector(ed(g));if(y)return o.state.loading|=4,o.instance=y,Xt(y),y;d=d_(c),(g=gr.get(g))&&py(d,g),y=(r.ownerDocument||r).createElement("link"),Xt(y);var T=y;return T._p=new Promise(function(S,q){T.onload=S,T.onerror=q}),Wn(y,"link",d),o.state.loading|=4,Ef(y,c.precedence,r),o.instance=y;case"script":return y=ac(c.src),(g=r.querySelector(td(y)))?(o.instance=g,Xt(g),g):(d=c,(g=gr.get(y))&&(d=x({},c),yy(d,g)),r=r.ownerDocument||r,g=r.createElement("script"),Xt(g),Wn(g,"link",d),r.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(n(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(d=o.instance,o.state.loading|=4,Ef(d,c.precedence,r));return o.instance}function Ef(r,o,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,y=g,T=0;T<d.length;T++){var S=d[T];if(S.dataset.precedence===o)y=S;else if(y!==g)break}y?y.parentNode.insertBefore(r,y.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(r,o.firstChild))}function py(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function yy(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var Sf=null;function f_(r,o,c){if(Sf===null){var d=new Map,g=Sf=new Map;g.set(c,d)}else g=Sf,d=g.get(c),d||(d=new Map,g.set(c,d));if(d.has(r))return d;for(d.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var y=c[g];if(!(y[qr]||y[tn]||r==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var T=y.getAttribute(o)||"";T=r+T;var S=d.get(T);S?S.push(y):d.set(T,[y])}}return d}function m_(r,o,c){r=r.ownerDocument||r,r.head.insertBefore(c,o==="title"?r.querySelector("head > title"):null)}function J2(r,o,c){if(c===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function g_(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var nd=null;function Z2(){}function eI(r,o,c){if(nd===null)throw Error(n(475));var d=nd;if(o.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=rc(c.href),y=r.querySelector(ed(g));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(d.count++,d=Af.bind(d),r.then(d,d)),o.state.loading|=4,o.instance=y,Xt(y);return}y=r.ownerDocument||r,c=d_(c),(g=gr.get(g))&&py(c,g),y=y.createElement("link"),Xt(y);var T=y;T._p=new Promise(function(S,q){T.onload=S,T.onerror=q}),Wn(y,"link",c),o.instance=y}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(d.count++,o=Af.bind(d),r.addEventListener("load",o),r.addEventListener("error",o))}}function tI(){if(nd===null)throw Error(n(475));var r=nd;return r.stylesheets&&r.count===0&&xy(r,r.stylesheets),0<r.count?function(o){var c=setTimeout(function(){if(r.stylesheets&&xy(r,r.stylesheets),r.unsuspend){var d=r.unsuspend;r.unsuspend=null,d()}},6e4);return r.unsuspend=o,function(){r.unsuspend=null,clearTimeout(c)}}:null}function Af(){if(this.count--,this.count===0){if(this.stylesheets)xy(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var jf=null;function xy(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,jf=new Map,o.forEach(nI,r),jf=null,Af.call(r))}function nI(r,o){if(!(o.state.loading&4)){var c=jf.get(r);if(c)var d=c.get(null);else{c=new Map,jf.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var T=g[y];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(c.set(T.dataset.precedence,T),d=T)}d&&c.set(null,d)}g=o.instance,T=g.getAttribute("data-precedence"),y=c.get(T)||d,y===d&&c.set(null,g),c.set(T,g),this.count++,d=Af.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),y?y.parentNode.insertBefore(g,y.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),o.state.loading|=4}}var sd={$$typeof:B,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function sI(r,o,c,d,g,y,T,S){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Nr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nr(0),this.hiddenUpdates=Nr(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function p_(r,o,c,d,g,y,T,S,q,ne,de,me){return r=new sI(r,o,c,T,S,q,ne,me),o=1,y===!0&&(o|=24),y=Us(3,null,null,o),r.current=y,y.stateNode=r,o=Zg(),o.refCount++,r.pooledCache=o,o.refCount++,y.memoizedState={element:d,isDehydrated:c,cache:o},sp(y),r}function y_(r){return r?(r=Ol,r):Ol}function x_(r,o,c,d,g,y){g=y_(g),d.context===null?d.context=g:d.pendingContext=g,d=ii(o),d.payload={element:c},y=y===void 0?null:y,y!==null&&(d.callback=y),c=oi(r,d,o),c!==null&&(Gs(c,r,o),Du(c,r,o))}function v_(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function vy(r,o){v_(r,o),(r=r.alternate)&&v_(r,o)}function b_(r){if(r.tag===13){var o=Ml(r,67108864);o!==null&&Gs(o,r,67108864),vy(r,67108864)}}var If=!0;function rI(r,o,c,d){var g=z.T;z.T=null;var y=oe.p;try{oe.p=2,by(r,o,c,d)}finally{oe.p=y,z.T=g}}function aI(r,o,c,d){var g=z.T;z.T=null;var y=oe.p;try{oe.p=8,by(r,o,c,d)}finally{oe.p=y,z.T=g}}function by(r,o,c,d){if(If){var g=wy(d);if(g===null)oy(r,o,d,Cf,c),__(r,d);else if(oI(g,r,o,c,d))d.stopPropagation();else if(__(r,d),o&4&&-1<iI.indexOf(r)){for(;g!==null;){var y=Os(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var T=kn(y.pendingLanes);if(T!==0){var S=y;for(S.pendingLanes|=2,S.entangledLanes|=2;T;){var q=1<<31-bn(T);S.entanglements[1]|=q,T&=~q}ea(y),(Tt&6)===0&&(ff=ct()+500,Xu(0))}}break;case 13:S=Ml(y,2),S!==null&&Gs(S,y,2),gf(),vy(y,2)}if(y=wy(d),y===null&&oy(r,o,d,Cf,c),y===g)break;g=y}g!==null&&d.stopPropagation()}else oy(r,o,d,null,c)}}function wy(r){return r=ir(r),_y(r)}var Cf=null;function _y(r){if(Cf=null,r=sr(r),r!==null){var o=l(r);if(o===null)r=null;else{var c=o.tag;if(c===13){if(r=u(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Cf=r,null}function w_(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(It()){case Gn:return 2;case an:return 8;case $n:case wr:return 32;case Ds:return 268435456;default:return 32}default:return 32}}var Ny=!1,bi=null,wi=null,_i=null,rd=new Map,ad=new Map,Ni=[],iI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function __(r,o){switch(r){case"focusin":case"focusout":bi=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":_i=null;break;case"pointerover":case"pointerout":rd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":ad.delete(o.pointerId)}}function id(r,o,c,d,g,y){return r===null||r.nativeEvent!==y?(r={blockedOn:o,domEventName:c,eventSystemFlags:d,nativeEvent:y,targetContainers:[g]},o!==null&&(o=Os(o),o!==null&&b_(o)),r):(r.eventSystemFlags|=d,o=r.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),r)}function oI(r,o,c,d,g){switch(o){case"focusin":return bi=id(bi,r,o,c,d,g),!0;case"dragenter":return wi=id(wi,r,o,c,d,g),!0;case"mouseover":return _i=id(_i,r,o,c,d,g),!0;case"pointerover":var y=g.pointerId;return rd.set(y,id(rd.get(y)||null,r,o,c,d,g)),!0;case"gotpointercapture":return y=g.pointerId,ad.set(y,id(ad.get(y)||null,r,o,c,d,g)),!0}return!1}function N_(r){var o=sr(r.target);if(o!==null){var c=l(o);if(c!==null){if(o=c.tag,o===13){if(o=u(c),o!==null){r.blockedOn=o,ei(r.priority,function(){if(c.tag===13){var d=Hs();d=ds(d);var g=Ml(c,d);g!==null&&Gs(g,c,d),vy(c,d)}});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Rf(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=wy(r.nativeEvent);if(c===null){c=r.nativeEvent;var d=new c.constructor(c.type,c);ma=d,c.target.dispatchEvent(d),ma=null}else return o=Os(c),o!==null&&b_(o),r.blockedOn=c,!1;o.shift()}return!0}function T_(r,o,c){Rf(r)&&c.delete(o)}function lI(){Ny=!1,bi!==null&&Rf(bi)&&(bi=null),wi!==null&&Rf(wi)&&(wi=null),_i!==null&&Rf(_i)&&(_i=null),rd.forEach(T_),ad.forEach(T_)}function kf(r,o){r.blockedOn===o&&(r.blockedOn=null,Ny||(Ny=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,lI)))}var Df=null;function E_(r){Df!==r&&(Df=r,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){Df===r&&(Df=null);for(var o=0;o<r.length;o+=3){var c=r[o],d=r[o+1],g=r[o+2];if(typeof d!="function"){if(_y(d||c)===null)continue;break}var y=Os(c);y!==null&&(r.splice(o,3),o-=3,_p(y,{pending:!0,data:g,method:c.method,action:d},d,g))}}))}function od(r){function o(q){return kf(q,r)}bi!==null&&kf(bi,r),wi!==null&&kf(wi,r),_i!==null&&kf(_i,r),rd.forEach(o),ad.forEach(o);for(var c=0;c<Ni.length;c++){var d=Ni[c];d.blockedOn===r&&(d.blockedOn=null)}for(;0<Ni.length&&(c=Ni[0],c.blockedOn===null);)N_(c),c.blockedOn===null&&Ni.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var g=c[d],y=c[d+1],T=g[nn]||null;if(typeof y=="function")T||E_(c);else if(T){var S=null;if(y&&y.hasAttribute("formAction")){if(g=y,T=y[nn]||null)S=T.formAction;else if(_y(g)!==null)continue}else S=T.action;typeof S=="function"?c[d+1]=S:(c.splice(d,3),d-=3),E_(c)}}}function Ty(r){this._internalRoot=r}Pf.prototype.render=Ty.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(n(409));var c=o.current,d=Hs();x_(c,d,r,o,null,null)},Pf.prototype.unmount=Ty.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;x_(r.current,2,null,r,null,null),gf(),o[Yt]=null}};function Pf(r){this._internalRoot=r}Pf.prototype.unstable_scheduleHydration=function(r){if(r){var o=Tr();r={blockedOn:null,target:r,priority:o};for(var c=0;c<Ni.length&&o!==0&&o<Ni[c].priority;c++);Ni.splice(c,0,r),c===0&&N_(r)}};var S_=e.version;if(S_!=="19.1.1")throw Error(n(527,S_,"19.1.1"));oe.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=m(o),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var cI={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mf.isDisabled&&Mf.supportsFiber)try{_t=Mf.inject(cI),pt=Mf}catch{}}return cd.createRoot=function(r,o){if(!a(r))throw Error(n(299));var c=!1,d="",g=q0,y=z0,T=H0,S=null;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(T=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(S=o.unstable_transitionCallbacks)),o=p_(r,1,!1,null,null,c,d,g,y,T,S,null),r[Yt]=o.current,iy(r),new Ty(o)},cd.hydrateRoot=function(r,o,c){if(!a(r))throw Error(n(299));var d=!1,g="",y=q0,T=z0,S=H0,q=null,ne=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(T=c.onCaughtError),c.onRecoverableError!==void 0&&(S=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(q=c.unstable_transitionCallbacks),c.formState!==void 0&&(ne=c.formState)),o=p_(r,1,!0,o,c??null,d,g,y,T,S,q,ne),o.context=y_(null),c=o.current,d=Hs(),d=ds(d),g=ii(d),g.callback=null,oi(c,g,d),c=d,o.current.lanes=c,us(o,c),ea(o),r[Yt]=o.current,iy(r),new Pf(o)},cd.version="19.1.1",cd}var O_;function vI(){if(O_)return Ay.exports;O_=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Ay.exports=xI(),Ay.exports}var bI=vI();const wI=()=>{};var V_={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lE=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let a=s.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},_I=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const a=s[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const l=s[t++];e[n++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=s[t++],u=s[t++],h=s[t++],m=((a&7)<<18|(l&63)<<12|(u&63)<<6|h&63)-65536;e[n++]=String.fromCharCode(55296+(m>>10)),e[n++]=String.fromCharCode(56320+(m&1023))}else{const l=s[t++],u=s[t++];e[n++]=String.fromCharCode((a&15)<<12|(l&63)<<6|u&63)}}return e.join("")},cE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<s.length;a+=3){const l=s[a],u=a+1<s.length,h=u?s[a+1]:0,m=a+2<s.length,p=m?s[a+2]:0,x=l>>2,w=(l&3)<<4|h>>4;let b=(h&15)<<2|p>>6,E=p&63;m||(E=64,u||(b=64)),n.push(t[x],t[w],t[b],t[E])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(lE(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):_I(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<s.length;){const l=t[s.charAt(a++)],h=a<s.length?t[s.charAt(a)]:0;++a;const p=a<s.length?t[s.charAt(a)]:64;++a;const w=a<s.length?t[s.charAt(a)]:64;if(++a,l==null||h==null||p==null||w==null)throw new NI;const b=l<<2|h>>4;if(n.push(b),p!==64){const E=h<<4&240|p>>2;if(n.push(E),w!==64){const C=p<<6&192|w;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class NI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const TI=function(s){const e=lE(s);return cE.encodeByteArray(e,!0)},gm=function(s){return TI(s).replace(/\./g,"")},uE=function(s){try{return cE.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EI=()=>dE().__FIREBASE_DEFAULTS__,SI=()=>{if(typeof process>"u"||typeof V_>"u")return;const s=V_.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},AI=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&uE(s[1]);return e&&JSON.parse(e)},$m=()=>{try{return wI()||EI()||SI()||AI()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},hE=s=>$m()?.emulatorHosts?.[s],fE=s=>{const e=hE(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},mE=()=>$m()?.config,gE=s=>$m()?.[`_${s}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Km(s){return(await fetch(s,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=s.iat||0,l=s.sub||s.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...s};return[gm(JSON.stringify(t)),gm(JSON.stringify(u)),""].join(".")}const Ed={};function CI(){const s={prod:[],emulator:[]};for(const e of Object.keys(Ed))Ed[e]?s.emulator.push(e):s.prod.push(e);return s}function RI(s){let e=document.getElementById(s),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",s),t=!0),{created:t,element:e}}let L_=!1;function Gx(s,e){if(typeof window>"u"||typeof document>"u"||!Ka(window.location.host)||Ed[s]===e||Ed[s]||L_)return;Ed[s]=e;function t(b){return`__firebase__banner__${b}`}const n="__firebase__banner",l=CI().prod.length>0;function u(){const b=document.getElementById(n);b&&b.remove()}function h(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function m(b,E){b.setAttribute("width","24"),b.setAttribute("id",E),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function p(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{L_=!0,u()},b}function x(b,E){b.setAttribute("id",E),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function w(){const b=RI(n),E=t("text"),C=document.getElementById(E)||document.createElement("span"),k=t("learnmore"),L=document.getElementById(k)||document.createElement("a"),U=t("preprendIcon"),F=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const B=b.element;h(B),x(L,k);const H=p();m(F,U),B.append(F,C,L,H),document.body.appendChild(B)}l?(C.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",w):w()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kI(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(jn())}function pE(){const s=$m()?.forceEnvironment;if(s==="node")return!0;if(s==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function DI(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function yE(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function PI(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function MI(){const s=jn();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function xE(){return!pE()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vE(){return!pE()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function $x(){try{return typeof indexedDB=="object"}catch{return!1}}function bE(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(t){e(t)}})}function OI(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VI="FirebaseError";class br extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=VI,Object.setPrototypeOf(this,br.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dl.prototype.create)}}class dl{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,l=this.errors[e],u=l?LI(l,n):"Error",h=`${this.serviceName}: ${u} (${a}).`;return new br(a,h,n)}}function LI(s,e){return s.replace(FI,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const FI=/\{\$([^}]+)}/g;function UI(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function yr(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const l=s[a],u=e[a];if(F_(l)&&F_(u)){if(!yr(l,u))return!1}else if(l!==u)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function F_(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eh(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function BI(s,e){const t=new qI(s,e);return t.subscribe.bind(t)}class qI{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");zI(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=Ry),a.error===void 0&&(a.error=Ry),a.complete===void 0&&(a.complete=Ry);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function zI(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function Ry(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HI=1e3,GI=2,$I=14400*1e3,KI=.5;function U_(s,e=HI,t=GI){const n=e*Math.pow(t,s),a=Math.round(KI*n*(Math.random()-.5)*2);return Math.min($I,n+a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(s){return s&&s._delegate?s._delegate:s}class xr{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new jI;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(a){if(n)return null;throw a}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(XI(e))try{this.getOrInitializeService({instanceIdentifier:Lo})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:a});n.resolve(l)}catch{}}}}clearInstance(e=Lo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Lo){return this.instances.has(e)}getOptions(e=Lo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[l,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(l);n===h&&u.resolve(a)}return a}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),a=this.onInitCallbacks.get(n)??new Set;a.add(e),this.onInitCallbacks.set(n,a);const l=this.instances.get(n);return l&&e(l,n),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:YI(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Lo){return this.component?this.component.multipleInstances?e:Lo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function YI(s){return s===Lo?void 0:s}function XI(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new QI(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var it;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(it||(it={}));const JI={debug:it.DEBUG,verbose:it.VERBOSE,info:it.INFO,warn:it.WARN,error:it.ERROR,silent:it.SILENT},ZI=it.INFO,eC={[it.DEBUG]:"log",[it.VERBOSE]:"log",[it.INFO]:"info",[it.WARN]:"warn",[it.ERROR]:"error"},tC=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),a=eC[e];if(a)console[a](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Qm{constructor(e){this.name=e,this._logLevel=ZI,this._logHandler=tC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in it))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?JI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,it.DEBUG,...e),this._logHandler(this,it.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,it.VERBOSE,...e),this._logHandler(this,it.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,it.INFO,...e),this._logHandler(this,it.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,it.WARN,...e),this._logHandler(this,it.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,it.ERROR,...e),this._logHandler(this,it.ERROR,...e)}}const nC=(s,e)=>e.some(t=>s instanceof t);let B_,q_;function sC(){return B_||(B_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rC(){return q_||(q_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wE=new WeakMap,sx=new WeakMap,_E=new WeakMap,ky=new WeakMap,Kx=new WeakMap;function aC(s){const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("success",l),s.removeEventListener("error",u)},l=()=>{t(Ui(s.result)),a()},u=()=>{n(s.error),a()};s.addEventListener("success",l),s.addEventListener("error",u)});return e.then(t=>{t instanceof IDBCursor&&wE.set(t,s)}).catch(()=>{}),Kx.set(e,s),e}function iC(s){if(sx.has(s))return;const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",u),s.removeEventListener("abort",u)},l=()=>{t(),a()},u=()=>{n(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",l),s.addEventListener("error",u),s.addEventListener("abort",u)});sx.set(s,e)}let rx={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return sx.get(s);if(e==="objectStoreNames")return s.objectStoreNames||_E.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ui(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function oC(s){rx=s(rx)}function lC(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(Dy(this),e,...t);return _E.set(n,e.sort?e.sort():[e]),Ui(n)}:rC().includes(s)?function(...e){return s.apply(Dy(this),e),Ui(wE.get(this))}:function(...e){return Ui(s.apply(Dy(this),e))}}function cC(s){return typeof s=="function"?lC(s):(s instanceof IDBTransaction&&iC(s),nC(s,sC())?new Proxy(s,rx):s)}function Ui(s){if(s instanceof IDBRequest)return aC(s);if(ky.has(s))return ky.get(s);const e=cC(s);return e!==s&&(ky.set(s,e),Kx.set(e,s)),e}const Dy=s=>Kx.get(s);function NE(s,e,{blocked:t,upgrade:n,blocking:a,terminated:l}={}){const u=indexedDB.open(s,e),h=Ui(u);return n&&u.addEventListener("upgradeneeded",m=>{n(Ui(u.result),m.oldVersion,m.newVersion,Ui(u.transaction),m)}),t&&u.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),h.then(m=>{l&&m.addEventListener("close",()=>l()),a&&m.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),h}const uC=["get","getKey","getAll","getAllKeys","count"],dC=["put","add","delete","clear"],Py=new Map;function z_(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Py.get(e))return Py.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=dC.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||uC.includes(t)))return;const l=async function(u,...h){const m=this.transaction(u,a?"readwrite":"readonly");let p=m.store;return n&&(p=p.index(h.shift())),(await Promise.all([p[t](...h),a&&m.done]))[0]};return Py.set(e,l),l}oC(s=>({...s,get:(e,t,n)=>z_(e,t)||s.get(e,t,n),has:(e,t)=>!!z_(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(fC(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function fC(s){return s.getComponent()?.type==="VERSION"}const ax="@firebase/app",H_="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const za=new Qm("@firebase/app"),mC="@firebase/app-compat",gC="@firebase/analytics-compat",pC="@firebase/analytics",yC="@firebase/app-check-compat",xC="@firebase/app-check",vC="@firebase/auth",bC="@firebase/auth-compat",wC="@firebase/database",_C="@firebase/data-connect",NC="@firebase/database-compat",TC="@firebase/functions",EC="@firebase/functions-compat",SC="@firebase/installations",AC="@firebase/installations-compat",jC="@firebase/messaging",IC="@firebase/messaging-compat",CC="@firebase/performance",RC="@firebase/performance-compat",kC="@firebase/remote-config",DC="@firebase/remote-config-compat",PC="@firebase/storage",MC="@firebase/storage-compat",OC="@firebase/firestore",VC="@firebase/ai",LC="@firebase/firestore-compat",FC="firebase",UC="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pm="[DEFAULT]",BC={[ax]:"fire-core",[mC]:"fire-core-compat",[pC]:"fire-analytics",[gC]:"fire-analytics-compat",[xC]:"fire-app-check",[yC]:"fire-app-check-compat",[vC]:"fire-auth",[bC]:"fire-auth-compat",[wC]:"fire-rtdb",[_C]:"fire-data-connect",[NC]:"fire-rtdb-compat",[TC]:"fire-fn",[EC]:"fire-fn-compat",[SC]:"fire-iid",[AC]:"fire-iid-compat",[jC]:"fire-fcm",[IC]:"fire-fcm-compat",[CC]:"fire-perf",[RC]:"fire-perf-compat",[kC]:"fire-rc",[DC]:"fire-rc-compat",[PC]:"fire-gcs",[MC]:"fire-gcs-compat",[OC]:"fire-fst",[LC]:"fire-fst-compat",[VC]:"fire-vertex","fire-js":"fire-js",[FC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ym=new Map,qC=new Map,ix=new Map;function G_(s,e){try{s.container.addComponent(e)}catch(t){za.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Lr(s){const e=s.name;if(ix.has(e))return za.debug(`There were multiple attempts to register component ${e}.`),!1;ix.set(e,s);for(const t of ym.values())G_(t,s);for(const t of qC.values())G_(t,s);return!0}function ha(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function zC(s,e,t=pm){ha(s,e).clearInstance(t)}function Qs(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Bi=new dl("app","Firebase",HC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new xr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Bi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xc=UC;function TE(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n={name:pm,automaticDataCollectionEnabled:!0,...e},a=n.name;if(typeof a!="string"||!a)throw Bi.create("bad-app-name",{appName:String(a)});if(t||(t=mE()),!t)throw Bi.create("no-options");const l=ym.get(a);if(l){if(yr(t,l.options)&&yr(n,l.config))return l;throw Bi.create("duplicate-app",{appName:a})}const u=new WI(a);for(const m of ix.values())u.addComponent(m);const h=new GC(t,n,u);return ym.set(a,h),h}function Ym(s=pm){const e=ym.get(s);if(!e&&s===pm&&mE())return TE();if(!e)throw Bi.create("no-app",{appName:s});return e}function js(s,e,t){let n=BC[s]??s;t&&(n+=`-${t}`);const a=n.match(/\s|\//),l=e.match(/\s|\//);if(a||l){const u=[`Unable to register library "${n}" with version "${e}":`];a&&u.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&l&&u.push("and"),l&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),za.warn(u.join(" "));return}Lr(new xr(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C="firebase-heartbeat-database",KC=1,Fd="firebase-heartbeat-store";let My=null;function EE(){return My||(My=NE($C,KC,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(Fd)}catch(t){console.warn(t)}}}}).catch(s=>{throw Bi.create("idb-open",{originalErrorMessage:s.message})})),My}async function QC(s){try{const t=(await EE()).transaction(Fd),n=await t.objectStore(Fd).get(SE(s));return await t.done,n}catch(e){if(e instanceof br)za.warn(e.message);else{const t=Bi.create("idb-get",{originalErrorMessage:e?.message});za.warn(t.message)}}}async function $_(s,e){try{const n=(await EE()).transaction(Fd,"readwrite");await n.objectStore(Fd).put(e,SE(s)),await n.done}catch(t){if(t instanceof br)za.warn(t.message);else{const n=Bi.create("idb-set",{originalErrorMessage:t?.message});za.warn(n.message)}}}function SE(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YC=1024,XC=30;class WC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ZC(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=K_();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>XC){const a=eR(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){za.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=K_(),{heartbeatsToSend:t,unsentEntries:n}=JC(this._heartbeatsCache.heartbeats),a=gm(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return za.warn(e),""}}}function K_(){return new Date().toISOString().substring(0,10)}function JC(s,e=YC){const t=[];let n=s.slice();for(const a of s){const l=t.find(u=>u.agent===a.agent);if(l){if(l.dates.push(a.date),Q_(t)>e){l.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Q_(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class ZC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return $x()?bE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await QC(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return $_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return $_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Q_(s){return gm(JSON.stringify({version:2,heartbeats:s})).length}function eR(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tR(s){Lr(new xr("platform-logger",e=>new hC(e),"PRIVATE")),Lr(new xr("heartbeat",e=>new WC(e),"PRIVATE")),js(ax,H_,s),js(ax,H_,"esm2020"),js("fire-js","")}tR("");function AE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nR=AE,jE=new dl("auth","Firebase",AE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xm=new Qm("@firebase/auth");function sR(s,...e){xm.logLevel<=it.WARN&&xm.warn(`Auth (${Xc}): ${s}`,...e)}function Yf(s,...e){xm.logLevel<=it.ERROR&&xm.error(`Auth (${Xc}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(s,...e){throw Yx(s,...e)}function Mr(s,...e){return Yx(s,...e)}function Qx(s,e,t){const n={...nR(),[e]:t};return new dl("auth","Firebase",n).create(e,{appName:s.name})}function qi(s){return Qx(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function IE(s,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&ua(s,"argument-error"),Qx(s,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Yx(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return jE.create(s,...e)}function $e(s,e,...t){if(!s)throw Yx(e,...t)}function Oa(s){const e="INTERNAL ASSERTION FAILED: "+s;throw Yf(e),new Error(e)}function Ha(s,e){s||Oa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ox(){return typeof self<"u"&&self.location?.href||""}function rR(){return Y_()==="http:"||Y_()==="https:"}function Y_(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rR()||yE()||"connection"in navigator)?navigator.onLine:!0}function iR(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ha(t>e,"Short delay should be less than long delay!"),this.isMobile=kI()||PI()}get(){return aR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xx(s,e){Ha(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Oa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Oa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Oa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lR=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cR=new th(3e4,6e4);function Wx(s,e){return s.tenantId&&!e.tenantId?{...e,tenantId:s.tenantId}:e}async function Wc(s,e,t,n,a={}){return RE(s,a,async()=>{let l={},u={};n&&(e==="GET"?u=n:l={body:JSON.stringify(n)});const h=eh({key:s.config.apiKey,...u}).slice(1),m=await s._getAdditionalHeaders();m["Content-Type"]="application/json",s.languageCode&&(m["X-Firebase-Locale"]=s.languageCode);const p={method:e,headers:m,...l};return DI()||(p.referrerPolicy="no-referrer"),s.emulatorConfig&&Ka(s.emulatorConfig.host)&&(p.credentials="include"),CE.fetch()(await kE(s,s.config.apiHost,t,h),p)})}async function RE(s,e,t){s._canInitEmulator=!1;const n={...oR,...e};try{const a=new dR(s),l=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw Of(s,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const h=l.ok?u.errorMessage:u.error.message,[m,p]=h.split(" : ");if(m==="FEDERATED_USER_ID_ALREADY_LINKED")throw Of(s,"credential-already-in-use",u);if(m==="EMAIL_EXISTS")throw Of(s,"email-already-in-use",u);if(m==="USER_DISABLED")throw Of(s,"user-disabled",u);const x=n[m]||m.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw Qx(s,x,p);ua(s,x)}}catch(a){if(a instanceof br)throw a;ua(s,"network-request-failed",{message:String(a)})}}async function uR(s,e,t,n,a={}){const l=await Wc(s,e,t,n,a);return"mfaPendingCredential"in l&&ua(s,"multi-factor-auth-required",{_serverResponse:l}),l}async function kE(s,e,t,n){const a=`${e}${t}?${n}`,l=s,u=l.config.emulator?Xx(s.config,a):`${s.config.apiScheme}://${a}`;return lR.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}class dR{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Mr(this.auth,"network-request-failed")),cR.get())})}}function Of(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=Mr(s,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hR(s,e){return Wc(s,"POST","/v1/accounts:delete",e)}async function vm(s,e){return Wc(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fR(s,e=!1){const t=mt(s),n=await t.getIdToken(e),a=Jx(n);$e(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,u=l?.sign_in_provider;return{claims:a,token:n,authTime:Sd(Oy(a.auth_time)),issuedAtTime:Sd(Oy(a.iat)),expirationTime:Sd(Oy(a.exp)),signInProvider:u||null,signInSecondFactor:l?.sign_in_second_factor||null}}function Oy(s){return Number(s)*1e3}function Jx(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return Yf("JWT malformed, contained fewer than 3 sections"),null;try{const a=uE(t);return a?JSON.parse(a):(Yf("Failed to decode base64 JWT payload"),null)}catch(a){return Yf("Caught error parsing JWT payload as JSON",a?.toString()),null}}function X_(s){const e=Jx(s);return $e(e,"internal-error"),$e(typeof e.exp<"u","internal-error"),$e(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ud(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof br&&mR(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function mR({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Sd(this.lastLoginAt),this.creationTime=Sd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bm(s){const e=s.auth,t=await s.getIdToken(),n=await Ud(s,vm(e,{idToken:t}));$e(n?.users.length,e,"internal-error");const a=n.users[0];s._notifyReloadListener(a);const l=a.providerUserInfo?.length?DE(a.providerUserInfo):[],u=yR(s.providerData,l),h=s.isAnonymous,m=!(s.email&&a.passwordHash)&&!u?.length,p=h?m:!1,x={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new lx(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(s,x)}async function pR(s){const e=mt(s);await bm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function yR(s,e){return[...s.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function DE(s){return s.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xR(s,e){const t=await RE(s,{},async()=>{const n=eh({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=s.config,u=await kE(s,a,"/v1/token",`key=${l}`),h=await s._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const m={method:"POST",headers:h,body:n};return s.emulatorConfig&&Ka(s.emulatorConfig.host)&&(m.credentials="include"),CE.fetch()(u,m)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function vR(s,e){return Wc(s,"POST","/v2/accounts:revokeToken",Wx(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$e(e.idToken,"internal-error"),$e(typeof e.idToken<"u","internal-error"),$e(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):X_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$e(e.length!==0,"internal-error");const t=X_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:($e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:l}=await xR(e,t);this.updateTokensAndExpiration(n,a,Number(l))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:l}=t,u=new bc;return n&&($e(typeof n=="string","internal-error",{appName:e}),u.refreshToken=n),a&&($e(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),l&&($e(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new bc,this.toJSON())}_performRefresh(){return Oa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(s,e){$e(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class Dr{constructor({uid:e,auth:t,stsTokenManager:n,...a}){this.providerId="firebase",this.proactiveRefresh=new gR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new lx(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await Ud(this,this.stsTokenManager.getToken(this.auth,e));return $e(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fR(this,e)}reload(){return pR(this)}_assign(e){this!==e&&($e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Dr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){$e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await bm(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qs(this.auth.app))return Promise.reject(qi(this.auth));const e=await this.getIdToken();return await Ud(this,hR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,a=t.email??void 0,l=t.phoneNumber??void 0,u=t.photoURL??void 0,h=t.tenantId??void 0,m=t._redirectEventId??void 0,p=t.createdAt??void 0,x=t.lastLoginAt??void 0,{uid:w,emailVerified:b,isAnonymous:E,providerData:C,stsTokenManager:k}=t;$e(w&&k,e,"internal-error");const L=bc.fromJSON(this.name,k);$e(typeof w=="string",e,"internal-error"),Ei(n,e.name),Ei(a,e.name),$e(typeof b=="boolean",e,"internal-error"),$e(typeof E=="boolean",e,"internal-error"),Ei(l,e.name),Ei(u,e.name),Ei(h,e.name),Ei(m,e.name),Ei(p,e.name),Ei(x,e.name);const U=new Dr({uid:w,auth:e,email:a,emailVerified:b,displayName:n,isAnonymous:E,photoURL:u,phoneNumber:l,tenantId:h,stsTokenManager:L,createdAt:p,lastLoginAt:x});return C&&Array.isArray(C)&&(U.providerData=C.map(F=>({...F}))),m&&(U._redirectEventId=m),U}static async _fromIdTokenResponse(e,t,n=!1){const a=new bc;a.updateFromServerResponse(t);const l=new Dr({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await bm(l),l}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];$e(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?DE(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!l?.length,h=new bc;h.updateFromIdToken(n);const m=new Dr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:u}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new lx(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(m,p),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W_=new Map;function Va(s){Ha(s instanceof Function,"Expected a class definition");let e=W_.get(s);return e?(Ha(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,W_.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}PE.type="NONE";const J_=PE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(s,e,t){return`firebase:${s}:${e}:${t}`}class wc{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:l}=this.auth;this.fullUserKey=Xf(this.userKey,a.apiKey,l),this.fullPersistenceKey=Xf("persistence",a.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await vm(this.auth,{idToken:e}).catch(()=>{});return t?Dr._fromGetAccountInfoResponse(this.auth,t,e):null}return Dr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new wc(Va(J_),e,n);const a=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||Va(J_);const u=Xf(n,e.config.apiKey,e.name);let h=null;for(const p of t)try{const x=await p._get(u);if(x){let w;if(typeof x=="string"){const b=await vm(e,{idToken:x}).catch(()=>{});if(!b)break;w=await Dr._fromGetAccountInfoResponse(e,b,x)}else w=Dr._fromJSON(e,x);p!==l&&(h=w),l=p;break}}catch{}const m=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!m.length?new wc(l,e,n):(l=m[0],h&&await l._set(u,h.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(u)}catch{}})),new wc(l,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z_(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(LE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ME(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UE(e))return"Blackberry";if(BE(e))return"Webos";if(OE(e))return"Safari";if((e.includes("chrome/")||VE(e))&&!e.includes("edge/"))return"Chrome";if(FE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if(n?.length===2)return n[1]}return"Other"}function ME(s=jn()){return/firefox\//i.test(s)}function OE(s=jn()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function VE(s=jn()){return/crios\//i.test(s)}function LE(s=jn()){return/iemobile/i.test(s)}function FE(s=jn()){return/android/i.test(s)}function UE(s=jn()){return/blackberry/i.test(s)}function BE(s=jn()){return/webos/i.test(s)}function Zx(s=jn()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function bR(s=jn()){return Zx(s)&&!!window.navigator?.standalone}function wR(){return MI()&&document.documentMode===10}function qE(s=jn()){return Zx(s)||FE(s)||BE(s)||UE(s)||/windows phone/i.test(s)||LE(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zE(s,e=[]){let t;switch(s){case"Browser":t=Z_(jn());break;case"Worker":t=`${Z_(jn())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Xc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=l=>new Promise((u,h)=>{try{const m=e(l);u(m)}catch(m){h(m)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NR(s,e={}){return Wc(s,"GET","/v2/passwordPolicy",Wx(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TR=6;class ER{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??TR,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eN(this),this.idTokenSubscription=new eN(this),this.beforeStateQueue=new _R(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Va(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await wc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await vm(this,{idToken:e}),n=await Dr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Qs(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,u=n?._redirectEventId,h=await this.tryRedirectSignIn(e);(!l||l===u)&&h?.user&&(n=h.user,a=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(n)}catch(l){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return $e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bm(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iR()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qs(this.app))return Promise.reject(qi(this));const t=e?mt(e):null;return t&&$e(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&$e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qs(this.app)?Promise.reject(qi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qs(this.app)?Promise.reject(qi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Va(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await NR(this),t=new ER(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new dl("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await vR(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Va(e)||this._popupRedirectResolver;$e(t,this,"argument-error"),this.redirectPersistenceManager=await wc.create(this,[Va(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if($e(h,this,"internal-error"),h.then(()=>{u||l(this.currentUser)}),typeof t=="function"){const m=e.addObserver(t,n,a);return()=>{u=!0,m()}}else{const m=e.addObserver(t);return()=>{u=!0,m()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=zE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Qs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&sR(`Error while retrieving App Check token: ${e.error}`),e?.token}}function nh(s){return mt(s)}class eN{constructor(e){this.auth=e,this.observer=null,this.addObserver=BI(t=>this.observer=t)}get next(){return $e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ev={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function AR(s){ev=s}function jR(s){return ev.loadJS(s)}function IR(){return ev.gapiScript}function CR(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RR(s,e){const t=ha(s,"auth");if(t.isInitialized()){const a=t.getImmediate(),l=t.getOptions();if(yr(l,e??{}))return a;ua(a,"already-initialized")}return t.initialize({options:e})}function kR(s,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(Va);e?.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e?.popupRedirectResolver)}function DR(s,e,t){const n=nh(s);$e(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,l=HE(e),{host:u,port:h}=PR(e),m=h===null?"":`:${h}`,p={url:`${l}//${u}${m}/`},x=Object.freeze({host:u,port:h,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!n._canInitEmulator){$e(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),$e(yr(p,n.config.emulator)&&yr(x,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=p,n.emulatorConfig=x,n.settings.appVerificationDisabledForTesting=!0,Ka(u)?(Km(`${l}//${u}${m}`),Gx("Auth",!0)):MR()}function HE(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function PR(s){const e=HE(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const l=a[1];return{host:l,port:tN(n.substr(l.length+1))}}else{const[l,u]=n.split(":");return{host:l,port:tN(u)}}}function tN(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function MR(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Oa("not implemented")}_getIdTokenResponse(e){return Oa("not implemented")}_linkToIdToken(e,t){return Oa("not implemented")}_getReauthenticationResolver(e){return Oa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _c(s,e){return uR(s,"POST","/v1/accounts:signInWithIdp",Wx(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OR="http://localhost";class Zo extends GE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ua("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a,...l}=t;if(!n||!a)return null;const u=new Zo(n,a);return u.idToken=l.idToken||void 0,u.accessToken=l.accessToken||void 0,u.secret=l.secret,u.nonce=l.nonce,u.pendingToken=l.pendingToken||null,u}_getIdTokenResponse(e){const t=this.buildRequest();return _c(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,_c(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_c(e,t)}buildRequest(){const e={requestUri:OR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eh(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh extends Xm{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci extends sh{constructor(){super("facebook.com")}static credential(e){return Zo._fromParams({providerId:Ci.PROVIDER_ID,signInMethod:Ci.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ci.credentialFromTaggedObject(e)}static credentialFromError(e){return Ci.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ci.credential(e.oauthAccessToken)}catch{return null}}}Ci.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ci.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma extends sh{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zo._fromParams({providerId:Ma.PROVIDER_ID,signInMethod:Ma.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ma.credentialFromTaggedObject(e)}static credentialFromError(e){return Ma.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ma.credential(t,n)}catch{return null}}}Ma.GOOGLE_SIGN_IN_METHOD="google.com";Ma.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri extends sh{constructor(){super("github.com")}static credential(e){return Zo._fromParams({providerId:Ri.PROVIDER_ID,signInMethod:Ri.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ri.credentialFromTaggedObject(e)}static credentialFromError(e){return Ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ri.credential(e.oauthAccessToken)}catch{return null}}}Ri.GITHUB_SIGN_IN_METHOD="github.com";Ri.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki extends sh{constructor(){super("twitter.com")}static credential(e,t){return Zo._fromParams({providerId:ki.PROVIDER_ID,signInMethod:ki.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ki.credentialFromTaggedObject(e)}static credentialFromError(e){return ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ki.credential(t,n)}catch{return null}}}ki.TWITTER_SIGN_IN_METHOD="twitter.com";ki.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const l=await Dr._fromIdTokenResponse(e,n,a),u=nN(n);return new Sc({user:l,providerId:u,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=nN(n);return new Sc({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function nN(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm extends br{constructor(e,t,n,a){super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,wm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new wm(e,t,n,a)}}function $E(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?wm._fromErrorAndOperation(s,l,e,n):l})}async function VR(s,e,t=!1){const n=await Ud(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return Sc._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LR(s,e,t=!1){const{auth:n}=s;if(Qs(n.app))return Promise.reject(qi(n));const a="reauthenticate";try{const l=await Ud(s,$E(n,a,e,s),t);$e(l.idToken,n,"internal-error");const u=Jx(l.idToken);$e(u,n,"internal-error");const{sub:h}=u;return $e(s.uid===h,n,"user-mismatch"),Sc._forOperation(s,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&ua(n,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FR(s,e,t=!1){if(Qs(s.app))return Promise.reject(qi(s));const n="signIn",a=await $E(s,n,e),l=await Sc._fromIdTokenResponse(s,n,a);return t||await s._updateCurrentUser(l.user),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UR(s,e){return mt(s).setPersistence(e)}function KE(s,e,t,n){return mt(s).onIdTokenChanged(e,t,n)}function BR(s,e,t){return mt(s).beforeAuthStateChanged(e,t)}function qR(s,e,t,n){return mt(s).onAuthStateChanged(e,t,n)}function zR(s){return mt(s).signOut()}const _m="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_m,"1"),this.storage.removeItem(_m),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR=1e3,GR=10;class YE extends QE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((u,h,m)=>{this.notifyListeners(u,m)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const u=this.storage.getItem(n);!t&&this.localCache[n]===u||this.notifyListeners(n,u)},l=this.storage.getItem(n);wR()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,GR):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},HR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}YE.type="LOCAL";const XE=YE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE extends QE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}WE.type="SESSION";const JE=WE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $R(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new Wm(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:l}=t.data,u=this.handlersMap[a];if(!u?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const h=Array.from(u).map(async p=>p(t.origin,l)),m=await $R(h);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:m})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Wm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,u;return new Promise((h,m)=>{const p=tv("",20);a.port1.start();const x=setTimeout(()=>{m(new Error("unsupported_event"))},n);u={messageChannel:a,onMessage(w){const b=w;if(b.data.eventId===p)switch(b.data.status){case"ack":clearTimeout(x),l=setTimeout(()=>{m(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),h(b.data.response);break;default:clearTimeout(x),clearTimeout(l),m(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oa(){return window}function QR(s){oa().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(){return typeof oa().WorkerGlobalScope<"u"&&typeof oa().importScripts=="function"}async function YR(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function XR(){return navigator?.serviceWorker?.controller||null}function WR(){return ZE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS="firebaseLocalStorageDb",JR=1,Nm="firebaseLocalStorage",tS="fbase_key";class rh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Jm(s,e){return s.transaction([Nm],e?"readwrite":"readonly").objectStore(Nm)}function ZR(){const s=indexedDB.deleteDatabase(eS);return new rh(s).toPromise()}function cx(){const s=indexedDB.open(eS,JR);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(Nm,{keyPath:tS})}catch(a){t(a)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(Nm)?e(n):(n.close(),await ZR(),e(await cx()))})})}async function sN(s,e,t){const n=Jm(s,!0).put({[tS]:e,value:t});return new rh(n).toPromise()}async function ek(s,e){const t=Jm(s,!1).get(e),n=await new rh(t).toPromise();return n===void 0?null:n.value}function rN(s,e){const t=Jm(s,!0).delete(e);return new rh(t).toPromise()}const tk=800,nk=3;class nS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await cx(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>nk)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ZE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Wm._getInstance(WR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await YR(),!this.activeServiceWorker)return;this.sender=new KR(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||XR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await cx();return await sN(e,_m,"1"),await rN(e,_m),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>sN(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>ek(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=Jm(a,!1).getAll();return new rh(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),tk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}nS.type="LOCAL";const sk=nS;new th(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nv(s,e){return e?Va(e):($e(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv extends GE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _c(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _c(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _c(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rk(s){return FR(s.auth,new sv(s),s.bypassAuthState)}function ak(s){const{auth:e,user:t}=s;return $e(t,e,"internal-error"),LR(t,new sv(s),s.bypassAuthState)}async function ik(s){const{auth:e,user:t}=s;return $e(t,e,"internal-error"),VR(t,new sv(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(e,t,n,a,l=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:l,error:u,type:h}=e;if(u){this.reject(u);return}const m={auth:this.auth,requestUri:t,sessionId:n,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(m))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rk;case"linkViaPopup":case"linkViaRedirect":return ik;case"reauthViaPopup":case"reauthViaRedirect":return ak;default:ua(this.auth,"internal-error")}}resolve(e){Ha(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ha(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok=new th(2e3,1e4);async function lk(s,e,t){if(Qs(s.app))return Promise.reject(Mr(s,"operation-not-supported-in-this-environment"));const n=nh(s);IE(s,e,Xm);const a=nv(n,t);return new Go(n,"signInViaPopup",e,a).executeNotNull()}class Go extends sS{constructor(e,t,n,a,l){super(e,t,a,l),this.provider=n,this.authWindow=null,this.pollId=null,Go.currentPopupAction&&Go.currentPopupAction.cancel(),Go.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $e(e,this.auth,"internal-error"),e}async onExecution(){Ha(this.filter.length===1,"Popup operations only handle one event");const e=tv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Mr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Mr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Go.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Mr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ok.get())};e()}}Go.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck="pendingRedirect",Wf=new Map;class uk extends sS{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Wf.get(this.auth._key());if(!e){try{const n=await dk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Wf.set(this.auth._key(),e)}return this.bypassAuthState||Wf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function dk(s,e){const t=aS(e),n=rS(s);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}async function hk(s,e){return rS(s)._set(aS(e),"true")}function fk(s,e){Wf.set(s._key(),e)}function rS(s){return Va(s._redirectPersistence)}function aS(s){return Xf(ck,s.config.apiKey,s.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mk(s,e,t){return gk(s,e,t)}async function gk(s,e,t){if(Qs(s.app))return Promise.reject(qi(s));const n=nh(s);IE(s,e,Xm),await n._initializationPromise;const a=nv(n,t);return await hk(a,n),a._openRedirect(n,e,"signInViaRedirect")}async function pk(s,e,t=!1){if(Qs(s.app))return Promise.reject(qi(s));const n=nh(s),a=nv(n,e),u=await new uk(n,a,t).execute();return u&&!t&&(delete u.user._redirectEventId,await n._persistUserIfCurrent(u.user),await n._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=600*1e3;class xk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!vk(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!iS(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Mr(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=yk&&this.cachedEventUids.clear(),this.cachedEventUids.has(aN(e))}saveEventToCache(e){this.cachedEventUids.add(aN(e)),this.lastProcessedEventTime=Date.now()}}function aN(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function iS({type:s,error:e}){return s==="unknown"&&e?.code==="auth/no-auth-event"}function vk(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return iS(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bk(s,e={}){return Wc(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_k=/^https?/;async function Nk(s){if(s.config.emulator)return;const{authorizedDomains:e}=await bk(s);for(const t of e)try{if(Tk(t))return}catch{}ua(s,"unauthorized-domain")}function Tk(s){const e=ox(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const u=new URL(s);return u.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&u.hostname===n}if(!_k.test(t))return!1;if(wk.test(s))return n===s;const a=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek=new th(3e4,6e4);function iN(){const s=oa().___jsl;if(s?.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function Sk(s){return new Promise((e,t)=>{function n(){iN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{iN(),t(Mr(s,"network-request-failed"))},timeout:Ek.get()})}if(oa().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(oa().gapi?.load)n();else{const a=CR("iframefcb");return oa()[a]=()=>{gapi.load?n():t(Mr(s,"network-request-failed"))},jR(`${IR()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Jf=null,e})}let Jf=null;function Ak(s){return Jf=Jf||Sk(s),Jf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk=new th(5e3,15e3),Ik="__/auth/iframe",Ck="emulator/auth/iframe",Rk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Dk(s){const e=s.config;$e(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?Xx(e,Ck):`https://${s.config.authDomain}/${Ik}`,n={apiKey:e.apiKey,appName:s.name,v:Xc},a=kk.get(s.config.apiHost);a&&(n.eid=a);const l=s._getFrameworks();return l.length&&(n.fw=l.join(",")),`${t}?${eh(n).slice(1)}`}async function Pk(s){const e=await Ak(s),t=oa().gapi;return $e(t,s,"internal-error"),e.open({where:document.body,url:Dk(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Rk,dontclear:!0},n=>new Promise(async(a,l)=>{await n.restyle({setHideOnLeave:!1});const u=Mr(s,"network-request-failed"),h=oa().setTimeout(()=>{l(u)},jk.get());function m(){oa().clearTimeout(h),a(n)}n.ping(m).then(m,()=>{l(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Ok=500,Vk=600,Lk="_blank",Fk="http://localhost";class oN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Uk(s,e,t,n=Ok,a=Vk){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-n)/2,0).toString();let h="";const m={...Mk,width:n.toString(),height:a.toString(),top:l,left:u},p=jn().toLowerCase();t&&(h=VE(p)?Lk:t),ME(p)&&(e=e||Fk,m.scrollbars="yes");const x=Object.entries(m).reduce((b,[E,C])=>`${b}${E}=${C},`,"");if(bR(p)&&h!=="_self")return Bk(e||"",h),new oN(null);const w=window.open(e||"",h,x);$e(w,s,"popup-blocked");try{w.focus()}catch{}return new oN(w)}function Bk(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qk="__/auth/handler",zk="emulator/auth/handler",Hk=encodeURIComponent("fac");async function lN(s,e,t,n,a,l){$e(s.config.authDomain,s,"auth-domain-config-required"),$e(s.config.apiKey,s,"invalid-api-key");const u={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:Xc,eventId:a};if(e instanceof Xm){e.setDefaultLanguage(s.languageCode),u.providerId=e.providerId||"",UI(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,w]of Object.entries({}))u[x]=w}if(e instanceof sh){const x=e.getScopes().filter(w=>w!=="");x.length>0&&(u.scopes=x.join(","))}s.tenantId&&(u.tid=s.tenantId);const h=u;for(const x of Object.keys(h))h[x]===void 0&&delete h[x];const m=await s._getAppCheckToken(),p=m?`#${Hk}=${encodeURIComponent(m)}`:"";return`${Gk(s)}?${eh(h).slice(1)}${p}`}function Gk({config:s}){return s.emulator?Xx(s,zk):`https://${s.authDomain}/${qk}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy="webStorageSupport";class $k{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=JE,this._completeRedirectFn=pk,this._overrideRedirectResult=fk}async _openPopup(e,t,n,a){Ha(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await lN(e,t,n,ox(),a);return Uk(e,l,tv())}async _openRedirect(e,t,n,a){await this._originValidation(e);const l=await lN(e,t,n,ox(),a);return QR(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:l}=this.eventManagers[t];return a?Promise.resolve(a):(Ha(l,"If manager is not set, promise should be"),l)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Pk(e),n=new xk(e);return t.register("authEvent",a=>($e(a?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Vy,{type:Vy},a=>{const l=a?.[0]?.[Vy];l!==void 0&&t(!!l),ua(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Nk(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return qE()||OE()||Zx()}}const Kk=$k;var cN="@firebase/auth",uN="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yk(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Xk(s){Lr(new xr("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=n.options;$e(u&&!u.includes(":"),"invalid-api-key",{appName:n.name});const m={apiKey:u,authDomain:h,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zE(s)},p=new SR(n,a,l,m);return kR(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Lr(new xr("auth-internal",e=>{const t=nh(e.getProvider("auth").getImmediate());return(n=>new Qk(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),js(cN,uN,Yk(s)),js(cN,uN,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk=300,Jk=gE("authIdTokenMaxAge")||Wk;let dN=null;const Zk=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Jk)return;const a=t?.token;dN!==a&&(dN=a,await fetch(s,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function eD(s=Ym()){const e=ha(s,"auth");if(e.isInitialized())return e.getImmediate();const t=RR(s,{popupRedirectResolver:Kk,persistence:[sk,XE,JE]}),n=gE("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(n,location.origin);if(location.origin===l.origin){const u=Zk(l.toString());BR(t,u,()=>u(t.currentUser)),KE(t,h=>u(h))}}const a=hE("auth");return a&&DR(t,`http://${a}`),t}function tD(){return document.getElementsByTagName("head")?.[0]??document}AR({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=a=>{const l=Mr("internal-error");l.customData=a,t(l)},n.type="text/javascript",n.charset="UTF-8",tD().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Xk("Browser");var nD="firebase",sD="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */js(nD,sD,"app");var hN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zi,oS;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(R,N){function A(){}A.prototype=N.prototype,R.D=N.prototype,R.prototype=new A,R.prototype.constructor=R,R.C=function(V,I,G){for(var O=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)O[Ve-2]=arguments[Ve];return N.prototype[I].apply(V,O)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(R,N,A){A||(A=0);var V=Array(16);if(typeof N=="string")for(var I=0;16>I;++I)V[I]=N.charCodeAt(A++)|N.charCodeAt(A++)<<8|N.charCodeAt(A++)<<16|N.charCodeAt(A++)<<24;else for(I=0;16>I;++I)V[I]=N[A++]|N[A++]<<8|N[A++]<<16|N[A++]<<24;N=R.g[0],A=R.g[1],I=R.g[2];var G=R.g[3],O=N+(G^A&(I^G))+V[0]+3614090360&4294967295;N=A+(O<<7&4294967295|O>>>25),O=G+(I^N&(A^I))+V[1]+3905402710&4294967295,G=N+(O<<12&4294967295|O>>>20),O=I+(A^G&(N^A))+V[2]+606105819&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(N^I&(G^N))+V[3]+3250441966&4294967295,A=I+(O<<22&4294967295|O>>>10),O=N+(G^A&(I^G))+V[4]+4118548399&4294967295,N=A+(O<<7&4294967295|O>>>25),O=G+(I^N&(A^I))+V[5]+1200080426&4294967295,G=N+(O<<12&4294967295|O>>>20),O=I+(A^G&(N^A))+V[6]+2821735955&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(N^I&(G^N))+V[7]+4249261313&4294967295,A=I+(O<<22&4294967295|O>>>10),O=N+(G^A&(I^G))+V[8]+1770035416&4294967295,N=A+(O<<7&4294967295|O>>>25),O=G+(I^N&(A^I))+V[9]+2336552879&4294967295,G=N+(O<<12&4294967295|O>>>20),O=I+(A^G&(N^A))+V[10]+4294925233&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(N^I&(G^N))+V[11]+2304563134&4294967295,A=I+(O<<22&4294967295|O>>>10),O=N+(G^A&(I^G))+V[12]+1804603682&4294967295,N=A+(O<<7&4294967295|O>>>25),O=G+(I^N&(A^I))+V[13]+4254626195&4294967295,G=N+(O<<12&4294967295|O>>>20),O=I+(A^G&(N^A))+V[14]+2792965006&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(N^I&(G^N))+V[15]+1236535329&4294967295,A=I+(O<<22&4294967295|O>>>10),O=N+(I^G&(A^I))+V[1]+4129170786&4294967295,N=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(N^A))+V[6]+3225465664&4294967295,G=N+(O<<9&4294967295|O>>>23),O=I+(N^A&(G^N))+V[11]+643717713&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^N&(I^G))+V[0]+3921069994&4294967295,A=I+(O<<20&4294967295|O>>>12),O=N+(I^G&(A^I))+V[5]+3593408605&4294967295,N=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(N^A))+V[10]+38016083&4294967295,G=N+(O<<9&4294967295|O>>>23),O=I+(N^A&(G^N))+V[15]+3634488961&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^N&(I^G))+V[4]+3889429448&4294967295,A=I+(O<<20&4294967295|O>>>12),O=N+(I^G&(A^I))+V[9]+568446438&4294967295,N=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(N^A))+V[14]+3275163606&4294967295,G=N+(O<<9&4294967295|O>>>23),O=I+(N^A&(G^N))+V[3]+4107603335&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^N&(I^G))+V[8]+1163531501&4294967295,A=I+(O<<20&4294967295|O>>>12),O=N+(I^G&(A^I))+V[13]+2850285829&4294967295,N=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(N^A))+V[2]+4243563512&4294967295,G=N+(O<<9&4294967295|O>>>23),O=I+(N^A&(G^N))+V[7]+1735328473&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^N&(I^G))+V[12]+2368359562&4294967295,A=I+(O<<20&4294967295|O>>>12),O=N+(A^I^G)+V[5]+4294588738&4294967295,N=A+(O<<4&4294967295|O>>>28),O=G+(N^A^I)+V[8]+2272392833&4294967295,G=N+(O<<11&4294967295|O>>>21),O=I+(G^N^A)+V[11]+1839030562&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^N)+V[14]+4259657740&4294967295,A=I+(O<<23&4294967295|O>>>9),O=N+(A^I^G)+V[1]+2763975236&4294967295,N=A+(O<<4&4294967295|O>>>28),O=G+(N^A^I)+V[4]+1272893353&4294967295,G=N+(O<<11&4294967295|O>>>21),O=I+(G^N^A)+V[7]+4139469664&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^N)+V[10]+3200236656&4294967295,A=I+(O<<23&4294967295|O>>>9),O=N+(A^I^G)+V[13]+681279174&4294967295,N=A+(O<<4&4294967295|O>>>28),O=G+(N^A^I)+V[0]+3936430074&4294967295,G=N+(O<<11&4294967295|O>>>21),O=I+(G^N^A)+V[3]+3572445317&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^N)+V[6]+76029189&4294967295,A=I+(O<<23&4294967295|O>>>9),O=N+(A^I^G)+V[9]+3654602809&4294967295,N=A+(O<<4&4294967295|O>>>28),O=G+(N^A^I)+V[12]+3873151461&4294967295,G=N+(O<<11&4294967295|O>>>21),O=I+(G^N^A)+V[15]+530742520&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^N)+V[2]+3299628645&4294967295,A=I+(O<<23&4294967295|O>>>9),O=N+(I^(A|~G))+V[0]+4096336452&4294967295,N=A+(O<<6&4294967295|O>>>26),O=G+(A^(N|~I))+V[7]+1126891415&4294967295,G=N+(O<<10&4294967295|O>>>22),O=I+(N^(G|~A))+V[14]+2878612391&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~N))+V[5]+4237533241&4294967295,A=I+(O<<21&4294967295|O>>>11),O=N+(I^(A|~G))+V[12]+1700485571&4294967295,N=A+(O<<6&4294967295|O>>>26),O=G+(A^(N|~I))+V[3]+2399980690&4294967295,G=N+(O<<10&4294967295|O>>>22),O=I+(N^(G|~A))+V[10]+4293915773&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~N))+V[1]+2240044497&4294967295,A=I+(O<<21&4294967295|O>>>11),O=N+(I^(A|~G))+V[8]+1873313359&4294967295,N=A+(O<<6&4294967295|O>>>26),O=G+(A^(N|~I))+V[15]+4264355552&4294967295,G=N+(O<<10&4294967295|O>>>22),O=I+(N^(G|~A))+V[6]+2734768916&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~N))+V[13]+1309151649&4294967295,A=I+(O<<21&4294967295|O>>>11),O=N+(I^(A|~G))+V[4]+4149444226&4294967295,N=A+(O<<6&4294967295|O>>>26),O=G+(A^(N|~I))+V[11]+3174756917&4294967295,G=N+(O<<10&4294967295|O>>>22),O=I+(N^(G|~A))+V[2]+718787259&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~N))+V[9]+3951481745&4294967295,R.g[0]=R.g[0]+N&4294967295,R.g[1]=R.g[1]+(I+(O<<21&4294967295|O>>>11))&4294967295,R.g[2]=R.g[2]+I&4294967295,R.g[3]=R.g[3]+G&4294967295}n.prototype.u=function(R,N){N===void 0&&(N=R.length);for(var A=N-this.blockSize,V=this.B,I=this.h,G=0;G<N;){if(I==0)for(;G<=A;)a(this,R,G),G+=this.blockSize;if(typeof R=="string"){for(;G<N;)if(V[I++]=R.charCodeAt(G++),I==this.blockSize){a(this,V),I=0;break}}else for(;G<N;)if(V[I++]=R[G++],I==this.blockSize){a(this,V),I=0;break}}this.h=I,this.o+=N},n.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var N=1;N<R.length-8;++N)R[N]=0;var A=8*this.o;for(N=R.length-8;N<R.length;++N)R[N]=A&255,A/=256;for(this.u(R),R=Array(16),N=A=0;4>N;++N)for(var V=0;32>V;V+=8)R[A++]=this.g[N]>>>V&255;return R};function l(R,N){var A=h;return Object.prototype.hasOwnProperty.call(A,R)?A[R]:A[R]=N(R)}function u(R,N){this.h=N;for(var A=[],V=!0,I=R.length-1;0<=I;I--){var G=R[I]|0;V&&G==N||(A[I]=G,V=!1)}this.g=A}var h={};function m(R){return-128<=R&&128>R?l(R,function(N){return new u([N|0],0>N?-1:0)}):new u([R|0],0>R?-1:0)}function p(R){if(isNaN(R)||!isFinite(R))return w;if(0>R)return L(p(-R));for(var N=[],A=1,V=0;R>=A;V++)N[V]=R/A|0,A*=4294967296;return new u(N,0)}function x(R,N){if(R.length==0)throw Error("number format error: empty string");if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(R.charAt(0)=="-")return L(x(R.substring(1),N));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=p(Math.pow(N,8)),V=w,I=0;I<R.length;I+=8){var G=Math.min(8,R.length-I),O=parseInt(R.substring(I,I+G),N);8>G?(G=p(Math.pow(N,G)),V=V.j(G).add(p(O))):(V=V.j(A),V=V.add(p(O)))}return V}var w=m(0),b=m(1),E=m(16777216);s=u.prototype,s.m=function(){if(k(this))return-L(this).m();for(var R=0,N=1,A=0;A<this.g.length;A++){var V=this.i(A);R+=(0<=V?V:4294967296+V)*N,N*=4294967296}return R},s.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(C(this))return"0";if(k(this))return"-"+L(this).toString(R);for(var N=p(Math.pow(R,6)),A=this,V="";;){var I=H(A,N).g;A=U(A,I.j(N));var G=((0<A.g.length?A.g[0]:A.h)>>>0).toString(R);if(A=I,C(A))return G+V;for(;6>G.length;)G="0"+G;V=G+V}},s.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function C(R){if(R.h!=0)return!1;for(var N=0;N<R.g.length;N++)if(R.g[N]!=0)return!1;return!0}function k(R){return R.h==-1}s.l=function(R){return R=U(this,R),k(R)?-1:C(R)?0:1};function L(R){for(var N=R.g.length,A=[],V=0;V<N;V++)A[V]=~R.g[V];return new u(A,~R.h).add(b)}s.abs=function(){return k(this)?L(this):this},s.add=function(R){for(var N=Math.max(this.g.length,R.g.length),A=[],V=0,I=0;I<=N;I++){var G=V+(this.i(I)&65535)+(R.i(I)&65535),O=(G>>>16)+(this.i(I)>>>16)+(R.i(I)>>>16);V=O>>>16,G&=65535,O&=65535,A[I]=O<<16|G}return new u(A,A[A.length-1]&-2147483648?-1:0)};function U(R,N){return R.add(L(N))}s.j=function(R){if(C(this)||C(R))return w;if(k(this))return k(R)?L(this).j(L(R)):L(L(this).j(R));if(k(R))return L(this.j(L(R)));if(0>this.l(E)&&0>R.l(E))return p(this.m()*R.m());for(var N=this.g.length+R.g.length,A=[],V=0;V<2*N;V++)A[V]=0;for(V=0;V<this.g.length;V++)for(var I=0;I<R.g.length;I++){var G=this.i(V)>>>16,O=this.i(V)&65535,Ve=R.i(I)>>>16,ae=R.i(I)&65535;A[2*V+2*I]+=O*ae,F(A,2*V+2*I),A[2*V+2*I+1]+=G*ae,F(A,2*V+2*I+1),A[2*V+2*I+1]+=O*Ve,F(A,2*V+2*I+1),A[2*V+2*I+2]+=G*Ve,F(A,2*V+2*I+2)}for(V=0;V<N;V++)A[V]=A[2*V+1]<<16|A[2*V];for(V=N;V<2*N;V++)A[V]=0;return new u(A,0)};function F(R,N){for(;(R[N]&65535)!=R[N];)R[N+1]+=R[N]>>>16,R[N]&=65535,N++}function B(R,N){this.g=R,this.h=N}function H(R,N){if(C(N))throw Error("division by zero");if(C(R))return new B(w,w);if(k(R))return N=H(L(R),N),new B(L(N.g),L(N.h));if(k(N))return N=H(R,L(N)),new B(L(N.g),N.h);if(30<R.g.length){if(k(R)||k(N))throw Error("slowDivide_ only works with positive integers.");for(var A=b,V=N;0>=V.l(R);)A=$(A),V=$(V);var I=M(A,1),G=M(V,1);for(V=M(V,2),A=M(A,2);!C(V);){var O=G.add(V);0>=O.l(R)&&(I=I.add(A),G=O),V=M(V,1),A=M(A,1)}return N=U(R,I.j(N)),new B(I,N)}for(I=w;0<=R.l(N);){for(A=Math.max(1,Math.floor(R.m()/N.m())),V=Math.ceil(Math.log(A)/Math.LN2),V=48>=V?1:Math.pow(2,V-48),G=p(A),O=G.j(N);k(O)||0<O.l(R);)A-=V,G=p(A),O=G.j(N);C(G)&&(G=b),I=I.add(G),R=U(R,O)}return new B(I,R)}s.A=function(R){return H(this,R).h},s.and=function(R){for(var N=Math.max(this.g.length,R.g.length),A=[],V=0;V<N;V++)A[V]=this.i(V)&R.i(V);return new u(A,this.h&R.h)},s.or=function(R){for(var N=Math.max(this.g.length,R.g.length),A=[],V=0;V<N;V++)A[V]=this.i(V)|R.i(V);return new u(A,this.h|R.h)},s.xor=function(R){for(var N=Math.max(this.g.length,R.g.length),A=[],V=0;V<N;V++)A[V]=this.i(V)^R.i(V);return new u(A,this.h^R.h)};function $(R){for(var N=R.g.length+1,A=[],V=0;V<N;V++)A[V]=R.i(V)<<1|R.i(V-1)>>>31;return new u(A,R.h)}function M(R,N){var A=N>>5;N%=32;for(var V=R.g.length-A,I=[],G=0;G<V;G++)I[G]=0<N?R.i(G+A)>>>N|R.i(G+A+1)<<32-N:R.i(G+A);return new u(I,R.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,oS=n,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=p,u.fromString=x,zi=u}).apply(typeof hN<"u"?hN:typeof self<"u"?self:typeof window<"u"?window:{});var Vf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var lS,bd,cS,Zf,ux,uS,dS,hS;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,v,_){return f==Array.prototype||f==Object.prototype||(f[v]=_.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Vf=="object"&&Vf];for(var v=0;v<f.length;++v){var _=f[v];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var n=t(this);function a(f,v){if(v)e:{var _=n;f=f.split(".");for(var j=0;j<f.length-1;j++){var J=f[j];if(!(J in _))break e;_=_[J]}f=f[f.length-1],j=_[f],v=v(j),v!=j&&v!=null&&e(_,f,{configurable:!0,writable:!0,value:v})}}function l(f,v){f instanceof String&&(f+="");var _=0,j=!1,J={next:function(){if(!j&&_<f.length){var le=_++;return{value:v(le,f[le]),done:!1}}return j=!0,{done:!0,value:void 0}}};return J[Symbol.iterator]=function(){return J},J}a("Array.prototype.values",function(f){return f||function(){return l(this,function(v,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var u=u||{},h=this||self;function m(f){var v=typeof f;return v=v!="object"?v:f?Array.isArray(f)?"array":v:"null",v=="array"||v=="object"&&typeof f.length=="number"}function p(f){var v=typeof f;return v=="object"&&f!=null||v=="function"}function x(f,v,_){return f.call.apply(f.bind,arguments)}function w(f,v,_){if(!f)throw Error();if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var J=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(J,j),f.apply(v,J)}}return function(){return f.apply(v,arguments)}}function b(f,v,_){return b=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?x:w,b.apply(null,arguments)}function E(f,v){var _=Array.prototype.slice.call(arguments,1);return function(){var j=_.slice();return j.push.apply(j,arguments),f.apply(this,j)}}function C(f,v){function _(){}_.prototype=v.prototype,f.aa=v.prototype,f.prototype=new _,f.prototype.constructor=f,f.Qb=function(j,J,le){for(var _e=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)_e[ut-2]=arguments[ut];return v.prototype[J].apply(j,_e)}}function k(f){const v=f.length;if(0<v){const _=Array(v);for(let j=0;j<v;j++)_[j]=f[j];return _}return[]}function L(f,v){for(let _=1;_<arguments.length;_++){const j=arguments[_];if(m(j)){const J=f.length||0,le=j.length||0;f.length=J+le;for(let _e=0;_e<le;_e++)f[J+_e]=j[_e]}else f.push(j)}}class U{constructor(v,_){this.i=v,this.j=_,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function F(f){return/^[\s\xa0]*$/.test(f)}function B(){var f=h.navigator;return f&&(f=f.userAgent)?f:""}function H(f){return H[" "](f),f}H[" "]=function(){};var $=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function M(f,v,_){for(const j in f)v.call(_,f[j],j,f)}function R(f,v){for(const _ in f)v.call(void 0,f[_],_,f)}function N(f){const v={};for(const _ in f)v[_]=f[_];return v}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(f,v){let _,j;for(let J=1;J<arguments.length;J++){j=arguments[J];for(_ in j)f[_]=j[_];for(let le=0;le<A.length;le++)_=A[le],Object.prototype.hasOwnProperty.call(j,_)&&(f[_]=j[_])}}function I(f){var v=1;f=f.split(":");const _=[];for(;0<v&&f.length;)_.push(f.shift()),v--;return f.length&&_.push(f.join(":")),_}function G(f){h.setTimeout(()=>{throw f},0)}function O(){var f=be;let v=null;return f.g&&(v=f.g,f.g=f.g.next,f.g||(f.h=null),v.next=null),v}class Ve{constructor(){this.h=this.g=null}add(v,_){const j=ae.get();j.set(v,_),this.h?this.h.next=j:this.g=j,this.h=j}}var ae=new U(()=>new z,f=>f.reset());class z{constructor(){this.next=this.g=this.h=null}set(v,_){this.h=v,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let oe,Y=!1,be=new Ve,D=()=>{const f=h.Promise.resolve(void 0);oe=()=>{f.then(te)}};var te=()=>{for(var f;f=O();){try{f.h.call(f.g)}catch(_){G(_)}var v=ae;v.j(f),100>v.h&&(v.h++,f.next=v.g,v.g=f)}Y=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ue(f,v){this.type=f,this.g=this.target=v,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var Ie=(function(){if(!h.addEventListener||!Object.defineProperty)return!1;var f=!1,v=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const _=()=>{};h.addEventListener("test",_,v),h.removeEventListener("test",_,v)}catch{}return f})();function pe(f,v){if(ue.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var _=this.type=f.type,j=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=v,v=f.relatedTarget){if($){e:{try{H(v.nodeName);var J=!0;break e}catch{}J=!1}J||(v=null)}}else _=="mouseover"?v=f.fromElement:_=="mouseout"&&(v=f.toElement);this.relatedTarget=v,j?(this.clientX=j.clientX!==void 0?j.clientX:j.pageX,this.clientY=j.clientY!==void 0?j.clientY:j.pageY,this.screenX=j.screenX||0,this.screenY=j.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Ee[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&pe.aa.h.call(this)}}C(pe,ue);var Ee={2:"touch",3:"pen",4:"mouse"};pe.prototype.h=function(){pe.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var ce="closure_listenable_"+(1e6*Math.random()|0),we=0;function Se(f,v,_,j,J){this.listener=f,this.proxy=null,this.src=v,this.type=_,this.capture=!!j,this.ha=J,this.key=++we,this.da=this.fa=!1}function Fe(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Ze(f){this.src=f,this.g={},this.h=0}Ze.prototype.add=function(f,v,_,j,J){var le=f.toString();f=this.g[le],f||(f=this.g[le]=[],this.h++);var _e=lt(f,v,j,J);return-1<_e?(v=f[_e],_||(v.fa=!1)):(v=new Se(v,this.src,le,!!j,J),v.fa=_,f.push(v)),v};function Ge(f,v){var _=v.type;if(_ in f.g){var j=f.g[_],J=Array.prototype.indexOf.call(j,v,void 0),le;(le=0<=J)&&Array.prototype.splice.call(j,J,1),le&&(Fe(v),f.g[_].length==0&&(delete f.g[_],f.h--))}}function lt(f,v,_,j){for(var J=0;J<f.length;++J){var le=f[J];if(!le.da&&le.listener==v&&le.capture==!!_&&le.ha==j)return J}return-1}var ze="closure_lm_"+(1e6*Math.random()|0),Qe={};function gt(f,v,_,j,J){if(Array.isArray(v)){for(var le=0;le<v.length;le++)gt(f,v[le],_,j,J);return null}return _=Ms(_),f&&f[ce]?f.K(v,_,p(j)?!!j.capture:!1,J):ct(f,v,_,!1,j,J)}function ct(f,v,_,j,J,le){if(!v)throw Error("Invalid event type");var _e=p(J)?!!J.capture:!!J,ut=Ds(f);if(ut||(f[ze]=ut=new Ze(f)),_=ut.add(v,_,j,_e,le),_.proxy)return _;if(j=It(),_.proxy=j,j.src=f,j.listener=_,f.addEventListener)Ie||(J=_e),J===void 0&&(J=!1),f.addEventListener(v.toString(),j,J);else if(f.attachEvent)f.attachEvent($n(v.toString()),j);else if(f.addListener&&f.removeListener)f.addListener(j);else throw Error("addEventListener and attachEvent are unavailable.");return _}function It(){function f(_){return v.call(f.src,f.listener,_)}const v=wr;return f}function Gn(f,v,_,j,J){if(Array.isArray(v))for(var le=0;le<v.length;le++)Gn(f,v[le],_,j,J);else j=p(j)?!!j.capture:!!j,_=Ms(_),f&&f[ce]?(f=f.i,v=String(v).toString(),v in f.g&&(le=f.g[v],_=lt(le,_,j,J),-1<_&&(Fe(le[_]),Array.prototype.splice.call(le,_,1),le.length==0&&(delete f.g[v],f.h--)))):f&&(f=Ds(f))&&(v=f.g[v.toString()],f=-1,v&&(f=lt(v,_,j,J)),(_=-1<f?v[f]:null)&&an(_))}function an(f){if(typeof f!="number"&&f&&!f.da){var v=f.src;if(v&&v[ce])Ge(v.i,f);else{var _=f.type,j=f.proxy;v.removeEventListener?v.removeEventListener(_,j,f.capture):v.detachEvent?v.detachEvent($n(_),j):v.addListener&&v.removeListener&&v.removeListener(j),(_=Ds(v))?(Ge(_,f),_.h==0&&(_.src=null,v[ze]=null)):Fe(f)}}}function $n(f){return f in Qe?Qe[f]:Qe[f]="on"+f}function wr(f,v){if(f.da)f=!0;else{v=new pe(v,this);var _=f.listener,j=f.ha||f.src;f.fa&&an(f),f=_.call(j,v)}return f}function Ds(f){return f=f[ze],f instanceof Ze?f:null}var Ps="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ms(f){return typeof f=="function"?f:(f[Ps]||(f[Ps]=function(v){return f.handleEvent(v)}),f[Ps])}function _t(){xe.call(this),this.i=new Ze(this),this.M=this,this.F=null}C(_t,xe),_t.prototype[ce]=!0,_t.prototype.removeEventListener=function(f,v,_,j){Gn(this,f,v,_,j)};function pt(f,v){var _,j=f.F;if(j)for(_=[];j;j=j.F)_.push(j);if(f=f.M,j=v.type||v,typeof v=="string")v=new ue(v,f);else if(v instanceof ue)v.target=v.target||f;else{var J=v;v=new ue(j,f),V(v,J)}if(J=!0,_)for(var le=_.length-1;0<=le;le--){var _e=v.g=_[le];J=es(_e,j,!0,v)&&J}if(_e=v.g=f,J=es(_e,j,!0,v)&&J,J=es(_e,j,!1,v)&&J,_)for(le=0;le<_.length;le++)_e=v.g=_[le],J=es(_e,j,!1,v)&&J}_t.prototype.N=function(){if(_t.aa.N.call(this),this.i){var f=this.i,v;for(v in f.g){for(var _=f.g[v],j=0;j<_.length;j++)Fe(_[j]);delete f.g[v],f.h--}}this.F=null},_t.prototype.K=function(f,v,_,j){return this.i.add(String(f),v,!1,_,j)},_t.prototype.L=function(f,v,_,j){return this.i.add(String(f),v,!0,_,j)};function es(f,v,_,j){if(v=f.i.g[String(v)],!v)return!0;v=v.concat();for(var J=!0,le=0;le<v.length;++le){var _e=v[le];if(_e&&!_e.da&&_e.capture==_){var ut=_e.listener,_n=_e.ha||_e.src;_e.fa&&Ge(f.i,_e),J=ut.call(_n,j)!==!1&&J}}return J&&!j.defaultPrevented}function bn(f,v,_){if(typeof f=="function")_&&(f=b(f,_));else if(f&&typeof f.handleEvent=="function")f=b(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:h.setTimeout(f,v||0)}function Ja(f){f.g=bn(()=>{f.g=null,f.i&&(f.i=!1,Ja(f))},f.l);const v=f.h;f.h=null,f.m.apply(null,v)}class yl extends xe{constructor(v,_){super(),this.m=v,this.l=_,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:Ja(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zs(f){xe.call(this),this.h=f,this.g={}}C(Zs,xe);var er=[];function Kn(f){M(f.g,function(v,_){this.g.hasOwnProperty(_)&&an(v)},f),f.g={}}Zs.prototype.N=function(){Zs.aa.N.call(this),Kn(this)},Zs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var kn=h.JSON.stringify,Fr=h.JSON.parse,_r=class{stringify(f){return h.JSON.stringify(f,void 0)}parse(f){return h.JSON.parse(f,void 0)}};function oo(){}oo.prototype.h=null;function Ur(f){return f.h||(f.h=f.i())}function Br(){}var Nr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function us(){ue.call(this,"d")}C(us,ue);function lo(){ue.call(this,"c")}C(lo,ue);var tr={},qt=null;function ds(){return qt=qt||new _t}tr.La="serverreachability";function Za(f){ue.call(this,tr.La,f)}C(Za,ue);function Tr(f){const v=ds();pt(v,new Za(v))}tr.STAT_EVENT="statevent";function ei(f,v){ue.call(this,tr.STAT_EVENT,f),this.stat=v}C(ei,ue);function Mt(f){const v=ds();pt(v,new ei(v,f))}tr.Ma="timingevent";function tn(f,v){ue.call(this,tr.Ma,f),this.size=v}C(tn,ue);function nn(f,v){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){f()},v)}function Yt(){this.g=!0}Yt.prototype.xa=function(){this.g=!1};function nr(f,v,_,j,J,le){f.info(function(){if(f.g)if(le)for(var _e="",ut=le.split("&"),_n=0;_n<ut.length;_n++){var dt=ut[_n].split("=");if(1<dt.length){var Vn=dt[0];dt=dt[1];var Nn=Vn.split("_");_e=2<=Nn.length&&Nn[1]=="type"?_e+(Vn+"="+dt+"&"):_e+(Vn+"=redacted&")}}else _e=null;else _e=le;return"XMLHTTP REQ ("+j+") [attempt "+J+"]: "+v+`
`+_+`
`+_e})}function xl(f,v,_,j,J,le,_e){f.info(function(){return"XMLHTTP RESP ("+j+") [ attempt "+J+"]: "+v+`
`+_+`
`+le+" "+_e})}function Er(f,v,_,j){f.info(function(){return"XMLHTTP TEXT ("+v+"): "+qr(f,_)+(j?" "+j:"")})}function ti(f,v){f.info(function(){return"TIMEOUT: "+v})}Yt.prototype.info=function(){};function qr(f,v){if(!f.g)return v;if(!v)return null;try{var _=JSON.parse(v);if(_){for(f=0;f<_.length;f++)if(Array.isArray(_[f])){var j=_[f];if(!(2>j.length)){var J=j[1];if(Array.isArray(J)&&!(1>J.length)){var le=J[0];if(le!="noop"&&le!="stop"&&le!="close")for(var _e=1;_e<J.length;_e++)J[_e]=""}}}}return kn(_)}catch{return v}}var Dn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Os;function Vs(){}C(Vs,oo),Vs.prototype.g=function(){return new XMLHttpRequest},Vs.prototype.i=function(){return{}},Os=new Vs;function Pn(f,v,_,j){this.j=f,this.i=v,this.l=_,this.R=j||1,this.U=new Zs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Xt}function Xt(){this.i=null,this.g="",this.h=!1}var De={},Q={};function ye(f,v,_){f.L=1,f.v=fo(Ls(v)),f.m=_,f.P=!0,je(f,null)}function je(f,v){f.F=Date.now(),Ot(f),f.A=Ls(f.v);var _=f.A,j=f.R;Array.isArray(j)||(j=[String(j)]),gu(_.i,"t",j),f.C=0,_=f.j.J,f.h=new Xt,f.g=Rh(f.j,_?v:null,!f.m),0<f.O&&(f.M=new yl(b(f.Y,f,f.g),f.O)),v=f.U,_=f.g,j=f.ca;var J="readystatechange";Array.isArray(J)||(J&&(er[0]=J.toString()),J=er);for(var le=0;le<J.length;le++){var _e=gt(_,J[le],j||v.handleEvent,!1,v.h||v);if(!_e)break;v.g[_e.key]=_e}v=f.H?N(f.H):{},f.m?(f.u||(f.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,v)):(f.u="GET",f.g.ea(f.A,f.u,null,v)),Tr(),nr(f.i,f.u,f.A,f.l,f.R,f.m)}Pn.prototype.ca=function(f){f=f.target;const v=this.M;v&&lr(f)==3?v.j():this.Y(f)},Pn.prototype.Y=function(f){try{if(f==this.g)e:{const Nn=lr(this.g);var v=this.g.Ba();const va=this.g.Z();if(!(3>Nn)&&(Nn!=3||this.g&&(this.h.h||this.g.oa()||Nh(this.g)))){this.J||Nn!=4||v==7||(v==8||0>=va?Tr(3):Tr(2)),Mn(this);var _=this.g.Z();this.X=_;t:if(Nt(this)){var j=Nh(this.g);f="";var J=j.length,le=lr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ln(this),ts(this);var _e="";break t}this.h.i=new h.TextDecoder}for(v=0;v<J;v++)this.h.h=!0,f+=this.h.i.decode(j[v],{stream:!(le&&v==J-1)});j.length=0,this.h.g+=f,this.C=0,_e=this.h.g}else _e=this.g.oa();if(this.o=_==200,xl(this.i,this.u,this.A,this.l,this.R,Nn,_),this.o){if(this.T&&!this.K){t:{if(this.g){var ut,_n=this.g;if((ut=_n.g?_n.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(ut)){var dt=ut;break t}}dt=null}if(_=dt)Er(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zt(this,_);else{this.o=!1,this.s=3,Mt(12),ln(this),ts(this);break e}}if(this.P){_=!0;let Qn;for(;!this.J&&this.C<_e.length;)if(Qn=on(this,_e),Qn==Q){Nn==4&&(this.s=4,Mt(14),_=!1),Er(this.i,this.l,null,"[Incomplete Response]");break}else if(Qn==De){this.s=4,Mt(15),Er(this.i,this.l,_e,"[Invalid Chunk]"),_=!1;break}else Er(this.i,this.l,Qn,null),zt(this,Qn);if(Nt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Nn!=4||_e.length!=0||this.h.h||(this.s=1,Mt(16),_=!1),this.o=this.o&&_,!_)Er(this.i,this.l,_e,"[Invalid Chunked Response]"),ln(this),ts(this);else if(0<_e.length&&!this.W){this.W=!0;var Vn=this.j;Vn.g==this&&Vn.ba&&!Vn.M&&(Vn.j.info("Great, no buffering proxy detected. Bytes received: "+_e.length),wo(Vn),Vn.M=!0,Mt(11))}}else Er(this.i,this.l,_e,null),zt(this,_e);Nn==4&&ln(this),this.o&&!this.J&&(Nn==4?jh(this.j,this):(this.o=!1,Ot(this)))}else Dg(this.g),_==400&&0<_e.indexOf("Unknown SID")?(this.s=3,Mt(12)):(this.s=0,Mt(13)),ln(this),ts(this)}}}catch{}finally{}};function Nt(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function on(f,v){var _=f.C,j=v.indexOf(`
`,_);return j==-1?Q:(_=Number(v.substring(_,j)),isNaN(_)?De:(j+=1,j+_>v.length?Q:(v=v.slice(j,j+_),f.C=j+_,v)))}Pn.prototype.cancel=function(){this.J=!0,ln(this)};function Ot(f){f.S=Date.now()+f.I,wn(f,f.I)}function wn(f,v){if(f.B!=null)throw Error("WatchDog timer not null");f.B=nn(b(f.ba,f),v)}function Mn(f){f.B&&(h.clearTimeout(f.B),f.B=null)}Pn.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(ti(this.i,this.A),this.L!=2&&(Tr(),Mt(17)),ln(this),this.s=2,ts(this)):wn(this,this.S-f)};function ts(f){f.j.G==0||f.J||jh(f.j,f)}function ln(f){Mn(f);var v=f.M;v&&typeof v.ma=="function"&&v.ma(),f.M=null,Kn(f.U),f.g&&(v=f.g,f.g=null,v.abort(),v.ma())}function zt(f,v){try{var _=f.j;if(_.G!=0&&(_.g==f||uu(_.h,f))){if(!f.K&&uu(_.h,f)&&_.G==3){try{var j=_.Da.g.parse(v)}catch{j=null}if(Array.isArray(j)&&j.length==3){var J=j;if(J[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<f.F)Cl(_),jl(_);else break e;bu(_),Mt(18)}}else _.za=J[1],0<_.za-_.T&&37500>J[2]&&_.F&&_.v==0&&!_.C&&(_.C=nn(b(_.Za,_),6e3));if(1>=bl(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else xa(_,11)}else if((f.K||_.g==f)&&Cl(_),!F(v))for(J=_.Da.g.parse(v),v=0;v<J.length;v++){let dt=J[v];if(_.T=dt[0],dt=dt[1],_.G==2)if(dt[0]=="c"){_.K=dt[1],_.ia=dt[2];const Vn=dt[3];Vn!=null&&(_.la=Vn,_.j.info("VER="+_.la));const Nn=dt[4];Nn!=null&&(_.Aa=Nn,_.j.info("SVER="+_.Aa));const va=dt[5];va!=null&&typeof va=="number"&&0<va&&(j=1.5*va,_.L=j,_.j.info("backChannelRequestTimeoutMs_="+j)),j=_;const Qn=f.g;if(Qn){const Yr=Qn.g?Qn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Yr){var le=j.h;le.g||Yr.indexOf("spdy")==-1&&Yr.indexOf("quic")==-1&&Yr.indexOf("h2")==-1||(le.j=le.l,le.g=new Set,le.h&&(wl(le,le.h),le.h=null))}if(j.D){const _u=Qn.g?Qn.g.getResponseHeader("X-HTTP-Session-Id"):null;_u&&(j.ya=_u,Ct(j.I,j.D,_u))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-f.F,_.j.info("Handshake RTT: "+_.R+"ms")),j=_;var _e=f;if(j.qa=Ch(j,j.J?j.ia:null,j.W),_e.K){hs(j.h,_e);var ut=_e,_n=j.L;_n&&(ut.I=_n),ut.B&&(Mn(ut),Ot(ut)),j.g=_e}else Sh(j);0<_.i.length&&Il(_)}else dt[0]!="stop"&&dt[0]!="close"||xa(_,7);else _.G==3&&(dt[0]=="stop"||dt[0]=="close"?dt[0]=="stop"?xa(_,7):xu(_):dt[0]!="noop"&&_.l&&_.l.ta(dt),_.v=0)}}Tr(4)}catch{}}var co=class{constructor(f,v){this.g=f,this.map=v}};function rr(f){this.l=f||10,h.PerformanceNavigationTiming?(f=h.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(h.chrome&&h.chrome.loadTimes&&h.chrome.loadTimes()&&h.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function vl(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function bl(f){return f.h?1:f.g?f.g.size:0}function uu(f,v){return f.h?f.h==v:f.g?f.g.has(v):!1}function wl(f,v){f.g?f.g.add(v):f.h=v}function hs(f,v){f.h&&f.h==v?f.h=null:f.g&&f.g.has(v)&&f.g.delete(v)}rr.prototype.cancel=function(){if(this.i=du(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function du(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let v=f.i;for(const _ of f.g.values())v=v.concat(_.D);return v}return k(f.i)}function Ig(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(m(f)){for(var v=[],_=f.length,j=0;j<_;j++)v.push(f[j]);return v}v=[],_=0;for(j in f)v[_++]=f[j];return v}function _l(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(m(f)||typeof f=="string"){var v=[];f=f.length;for(var _=0;_<f;_++)v.push(_);return v}v=[],_=0;for(const j in f)v[_++]=j;return v}}}function hu(f,v){if(f.forEach&&typeof f.forEach=="function")f.forEach(v,void 0);else if(m(f)||typeof f=="string")Array.prototype.forEach.call(f,v,void 0);else for(var _=_l(f),j=Ig(f),J=j.length,le=0;le<J;le++)v.call(void 0,j[le],_&&_[le],f)}var uo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Cg(f,v){if(f){f=f.split("&");for(var _=0;_<f.length;_++){var j=f[_].indexOf("="),J=null;if(0<=j){var le=f[_].substring(0,j);J=f[_].substring(j+1)}else le=f[_];v(le,J?decodeURIComponent(J.replace(/\+/g," ")):"")}}}function mn(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof mn){this.h=f.h,ho(this,f.j),this.o=f.o,this.g=f.g,ni(this,f.s),this.l=f.l;var v=f.i,_=new ma;_.i=v.i,v.g&&(_.g=new Map(v.g),_.h=v.h),fa(this,_),this.m=f.m}else f&&(v=String(f).match(uo))?(this.h=!1,ho(this,v[1]||"",!0),this.o=ar(v[2]||""),this.g=ar(v[3]||"",!0),ni(this,v[4]),this.l=ar(v[5]||"",!0),fa(this,v[6]||"",!0),this.m=ar(v[7]||"")):(this.h=!1,this.i=new ma(null,this.h))}mn.prototype.toString=function(){var f=[],v=this.j;v&&f.push(mo(v,fu,!0),":");var _=this.g;return(_||v=="file")&&(f.push("//"),(v=this.o)&&f.push(mo(v,fu,!0),"@"),f.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&f.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&f.push("/"),f.push(mo(_,_.charAt(0)=="/"?Rg:mu,!0))),(_=this.i.toString())&&f.push("?",_),(_=this.m)&&f.push("#",mo(_,Nl)),f.join("")};function Ls(f){return new mn(f)}function ho(f,v,_){f.j=_?ar(v,!0):v,f.j&&(f.j=f.j.replace(/:$/,""))}function ni(f,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);f.s=v}else f.s=null}function fa(f,v,_){v instanceof ma?(f.i=v,wh(f.i,f.h)):(_||(v=mo(v,kg)),f.i=new ma(v,f.h))}function Ct(f,v,_){f.i.set(v,_)}function fo(f){return Ct(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function ar(f,v){return f?v?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function mo(f,v,_){return typeof f=="string"?(f=encodeURI(f).replace(v,bh),_&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function bh(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var fu=/[#\/\?@]/g,mu=/[#\?:]/g,Rg=/[#\?]/g,kg=/[#\?@]/g,Nl=/#/g;function ma(f,v){this.h=this.g=null,this.i=f||null,this.j=!!v}function ir(f){f.g||(f.g=new Map,f.h=0,f.i&&Cg(f.i,function(v,_){f.add(decodeURIComponent(v.replace(/\+/g," ")),_)}))}s=ma.prototype,s.add=function(f,v){ir(this),this.i=null,f=zr(this,f);var _=this.g.get(f);return _||this.g.set(f,_=[]),_.push(v),this.h+=1,this};function ga(f,v){ir(f),v=zr(f,v),f.g.has(v)&&(f.i=null,f.h-=f.g.get(v).length,f.g.delete(v))}function pa(f,v){return ir(f),v=zr(f,v),f.g.has(v)}s.forEach=function(f,v){ir(this),this.g.forEach(function(_,j){_.forEach(function(J){f.call(v,J,j,this)},this)},this)},s.na=function(){ir(this);const f=Array.from(this.g.values()),v=Array.from(this.g.keys()),_=[];for(let j=0;j<v.length;j++){const J=f[j];for(let le=0;le<J.length;le++)_.push(v[j])}return _},s.V=function(f){ir(this);let v=[];if(typeof f=="string")pa(this,f)&&(v=v.concat(this.g.get(zr(this,f))));else{f=Array.from(this.g.values());for(let _=0;_<f.length;_++)v=v.concat(f[_])}return v},s.set=function(f,v){return ir(this),this.i=null,f=zr(this,f),pa(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[v]),this.h+=1,this},s.get=function(f,v){return f?(f=this.V(f),0<f.length?String(f[0]):v):v};function gu(f,v,_){ga(f,v),0<_.length&&(f.i=null,f.g.set(zr(f,v),k(_)),f.h+=_.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],v=Array.from(this.g.keys());for(var _=0;_<v.length;_++){var j=v[_];const le=encodeURIComponent(String(j)),_e=this.V(j);for(j=0;j<_e.length;j++){var J=le;_e[j]!==""&&(J+="="+encodeURIComponent(String(_e[j]))),f.push(J)}}return this.i=f.join("&")};function zr(f,v){return v=String(v),f.j&&(v=v.toLowerCase()),v}function wh(f,v){v&&!f.j&&(ir(f),f.i=null,f.g.forEach(function(_,j){var J=j.toLowerCase();j!=J&&(ga(this,j),gu(this,J,_))},f)),f.j=v}function go(f,v){const _=new Yt;if(h.Image){const j=new Image;j.onload=E(or,_,"TestLoadImage: loaded",!0,v,j),j.onerror=E(or,_,"TestLoadImage: error",!1,v,j),j.onabort=E(or,_,"TestLoadImage: abort",!1,v,j),j.ontimeout=E(or,_,"TestLoadImage: timeout",!1,v,j),h.setTimeout(function(){j.ontimeout&&j.ontimeout()},1e4),j.src=f}else v(!1)}function Sr(f,v){const _=new Yt,j=new AbortController,J=setTimeout(()=>{j.abort(),or(_,"TestPingServer: timeout",!1,v)},1e4);fetch(f,{signal:j.signal}).then(le=>{clearTimeout(J),le.ok?or(_,"TestPingServer: ok",!0,v):or(_,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(J),or(_,"TestPingServer: error",!1,v)})}function or(f,v,_,j,J){try{J&&(J.onload=null,J.onerror=null,J.onabort=null,J.ontimeout=null),j(_)}catch{}}function po(){this.g=new _r}function Hr(f,v,_){const j=_||"";try{hu(f,function(J,le){let _e=J;p(J)&&(_e=kn(J)),v.push(j+le+"="+encodeURIComponent(_e))})}catch(J){throw v.push(j+"type="+encodeURIComponent("_badmap")),J}}function si(f){this.l=f.Ub||null,this.j=f.eb||!1}C(si,oo),si.prototype.g=function(){return new ya(this.l,this.j)},si.prototype.i=(function(f){return function(){return f}})({});function ya(f,v){_t.call(this),this.D=f,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(ya,_t),s=ya.prototype,s.open=function(f,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=v,this.readyState=1,$r(this)},s.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(v.body=f),(this.D||h).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gr(this)),this.readyState=0},s.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,$r(this)),this.g&&(this.readyState=3,$r(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof h.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;pu(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function pu(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}s.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var v=f.value?f.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!f.done}))&&(this.response=this.responseText+=v)}f.done?Gr(this):$r(this),this.readyState==3&&pu(this)}},s.Ra=function(f){this.g&&(this.response=this.responseText=f,Gr(this))},s.Qa=function(f){this.g&&(this.response=f,Gr(this))},s.ga=function(){this.g&&Gr(this)};function Gr(f){f.readyState=4,f.l=null,f.j=null,f.v=null,$r(f)}s.setRequestHeader=function(f,v){this.u.append(f,v)},s.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],v=this.h.entries();for(var _=v.next();!_.done;)_=_.value,f.push(_[0]+": "+_[1]),_=v.next();return f.join(`\r
`)};function $r(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(ya.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function yu(f){let v="";return M(f,function(_,j){v+=j,v+=":",v+=_,v+=`\r
`}),v}function On(f,v,_){e:{for(j in _){var j=!1;break e}j=!0}j||(_=yu(_),typeof f=="string"?_!=null&&encodeURIComponent(String(_)):Ct(f,v,_))}function bt(f){_t.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(bt,_t);var Tl=/^https?$/i,yo=["POST","PUT"];s=bt.prototype,s.Ha=function(f){this.J=f},s.ea=function(f,v,_,j){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);v=v?v.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Os.g(),this.v=this.o?Ur(this.o):Ur(Os),this.g.onreadystatechange=b(this.Ea,this);try{this.B=!0,this.g.open(v,String(f),!0),this.B=!1}catch(le){_h(this,le);return}if(f=_||"",_=new Map(this.headers),j)if(Object.getPrototypeOf(j)===Object.prototype)for(var J in j)_.set(J,j[J]);else if(typeof j.keys=="function"&&typeof j.get=="function")for(const le of j.keys())_.set(le,j.get(le));else throw Error("Unknown input type for opt_headers: "+String(j));j=Array.from(_.keys()).find(le=>le.toLowerCase()=="content-type"),J=h.FormData&&f instanceof h.FormData,!(0<=Array.prototype.indexOf.call(yo,v,void 0))||j||J||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[le,_e]of _)this.g.setRequestHeader(le,_e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{xo(this),this.u=!0,this.g.send(f),this.u=!1}catch(le){_h(this,le)}};function _h(f,v){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=v,f.m=5,El(f),Kr(f)}function El(f){f.A||(f.A=!0,pt(f,"complete"),pt(f,"error"))}s.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,pt(this,"complete"),pt(this,"abort"),Kr(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kr(this,!0)),bt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Sl(this):this.bb())},s.bb=function(){Sl(this)};function Sl(f){if(f.h&&typeof u<"u"&&(!f.v[1]||lr(f)!=4||f.Z()!=2)){if(f.u&&lr(f)==4)bn(f.Ea,0,f);else if(pt(f,"readystatechange"),lr(f)==4){f.h=!1;try{const _e=f.Z();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var _;if(!(_=v)){var j;if(j=_e===0){var J=String(f.D).match(uo)[1]||null;!J&&h.self&&h.self.location&&(J=h.self.location.protocol.slice(0,-1)),j=!Tl.test(J?J.toLowerCase():"")}_=j}if(_)pt(f,"complete"),pt(f,"success");else{f.m=6;try{var le=2<lr(f)?f.g.statusText:""}catch{le=""}f.l=le+" ["+f.Z()+"]",El(f)}}finally{Kr(f)}}}}function Kr(f,v){if(f.g){xo(f);const _=f.g,j=f.v[0]?()=>{}:null;f.g=null,f.v=null,v||pt(f,"ready");try{_.onreadystatechange=j}catch{}}}function xo(f){f.I&&(h.clearTimeout(f.I),f.I=null)}s.isActive=function(){return!!this.g};function lr(f){return f.g?f.g.readyState:0}s.Z=function(){try{return 2<lr(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(f){if(this.g){var v=this.g.responseText;return f&&v.indexOf(f)==0&&(v=v.substring(f.length)),Fr(v)}};function Nh(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Dg(f){const v={};f=(f.g&&2<=lr(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let j=0;j<f.length;j++){if(F(f[j]))continue;var _=I(f[j]);const J=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const le=v[J]||[];v[J]=le,le.push(_)}R(v,function(j){return j.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function vo(f,v,_){return _&&_.internalChannelParams&&_.internalChannelParams[f]||v}function Al(f){this.Aa=0,this.i=[],this.j=new Yt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=vo("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=vo("baseRetryDelayMs",5e3,f),this.cb=vo("retryDelaySeedMs",1e4,f),this.Wa=vo("forwardChannelMaxRetries",2,f),this.wa=vo("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new rr(f&&f.concurrentRequestLimit),this.Da=new po,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Al.prototype,s.la=8,s.G=1,s.connect=function(f,v,_,j){Mt(0),this.W=f,this.H=v||{},_&&j!==void 0&&(this.H.OSID=_,this.H.OAID=j),this.F=this.X,this.I=Ch(this,null,this.W),Il(this)};function xu(f){if(Th(f),f.G==3){var v=f.U++,_=Ls(f.I);if(Ct(_,"SID",f.K),Ct(_,"RID",v),Ct(_,"TYPE","terminate"),bo(f,_),v=new Pn(f,f.j,v),v.L=2,v.v=fo(Ls(_)),_=!1,h.navigator&&h.navigator.sendBeacon)try{_=h.navigator.sendBeacon(v.v.toString(),"")}catch{}!_&&h.Image&&(new Image().src=v.v,_=!0),_||(v.g=Rh(v.j,null),v.g.ea(v.v)),v.F=Date.now(),Ot(v)}Ih(f)}function jl(f){f.g&&(wo(f),f.g.cancel(),f.g=null)}function Th(f){jl(f),f.u&&(h.clearTimeout(f.u),f.u=null),Cl(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&h.clearTimeout(f.s),f.s=null)}function Il(f){if(!vl(f.h)&&!f.s){f.s=!0;var v=f.Ga;oe||D(),Y||(oe(),Y=!0),be.add(v,f),f.B=0}}function Pg(f,v){return bl(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=v.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=nn(b(f.Ga,f,v),wu(f,f.B)),f.B++,!0)}s.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const J=new Pn(this,this.j,f);let le=this.o;if(this.S&&(le?(le=N(le),V(le,this.S)):le=this.S),this.m!==null||this.O||(J.H=le,le=null),this.P)e:{for(var v=0,_=0;_<this.i.length;_++){t:{var j=this.i[_];if("__data__"in j.map&&(j=j.map.__data__,typeof j=="string")){j=j.length;break t}j=void 0}if(j===void 0)break;if(v+=j,4096<v){v=_;break e}if(v===4096||_===this.i.length-1){v=_+1;break e}}v=1e3}else v=1e3;v=Eh(this,J,v),_=Ls(this.I),Ct(_,"RID",f),Ct(_,"CVER",22),this.D&&Ct(_,"X-HTTP-Session-Id",this.D),bo(this,_),le&&(this.O?v="headers="+encodeURIComponent(String(yu(le)))+"&"+v:this.m&&On(_,this.m,le)),wl(this.h,J),this.Ua&&Ct(_,"TYPE","init"),this.P?(Ct(_,"$req",v),Ct(_,"SID","null"),J.T=!0,ye(J,_,null)):ye(J,_,v),this.G=2}}else this.G==3&&(f?vu(this,f):this.i.length==0||vl(this.h)||vu(this))};function vu(f,v){var _;v?_=v.l:_=f.U++;const j=Ls(f.I);Ct(j,"SID",f.K),Ct(j,"RID",_),Ct(j,"AID",f.T),bo(f,j),f.m&&f.o&&On(j,f.m,f.o),_=new Pn(f,f.j,_,f.B+1),f.m===null&&(_.H=f.o),v&&(f.i=v.D.concat(f.i)),v=Eh(f,_,1e3),_.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),wl(f.h,_),ye(_,j,v)}function bo(f,v){f.H&&M(f.H,function(_,j){Ct(v,j,_)}),f.l&&hu({},function(_,j){Ct(v,j,_)})}function Eh(f,v,_){_=Math.min(f.i.length,_);var j=f.l?b(f.l.Na,f.l,f):null;e:{var J=f.i;let le=-1;for(;;){const _e=["count="+_];le==-1?0<_?(le=J[0].g,_e.push("ofs="+le)):le=0:_e.push("ofs="+le);let ut=!0;for(let _n=0;_n<_;_n++){let dt=J[_n].g;const Vn=J[_n].map;if(dt-=le,0>dt)le=Math.max(0,J[_n].g-100),ut=!1;else try{Hr(Vn,_e,"req"+dt+"_")}catch{j&&j(Vn)}}if(ut){j=_e.join("&");break e}}}return f=f.i.splice(0,_),v.D=f,j}function Sh(f){if(!f.g&&!f.u){f.Y=1;var v=f.Fa;oe||D(),Y||(oe(),Y=!0),be.add(v,f),f.v=0}}function bu(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=nn(b(f.Fa,f),wu(f,f.v)),f.v++,!0)}s.Fa=function(){if(this.u=null,Ah(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=nn(b(this.ab,this),f)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mt(10),jl(this),Ah(this))};function wo(f){f.A!=null&&(h.clearTimeout(f.A),f.A=null)}function Ah(f){f.g=new Pn(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var v=Ls(f.qa);Ct(v,"RID","rpc"),Ct(v,"SID",f.K),Ct(v,"AID",f.T),Ct(v,"CI",f.F?"0":"1"),!f.F&&f.ja&&Ct(v,"TO",f.ja),Ct(v,"TYPE","xmlhttp"),bo(f,v),f.m&&f.o&&On(v,f.m,f.o),f.L&&(f.g.I=f.L);var _=f.g;f=f.ia,_.L=1,_.v=fo(Ls(v)),_.m=null,_.P=!0,je(_,f)}s.Za=function(){this.C!=null&&(this.C=null,jl(this),bu(this),Mt(19))};function Cl(f){f.C!=null&&(h.clearTimeout(f.C),f.C=null)}function jh(f,v){var _=null;if(f.g==v){Cl(f),wo(f),f.g=null;var j=2}else if(uu(f.h,v))_=v.D,hs(f.h,v),j=1;else return;if(f.G!=0){if(v.o)if(j==1){_=v.m?v.m.length:0,v=Date.now()-v.F;var J=f.B;j=ds(),pt(j,new tn(j,_)),Il(f)}else Sh(f);else if(J=v.s,J==3||J==0&&0<v.X||!(j==1&&Pg(f,v)||j==2&&bu(f)))switch(_&&0<_.length&&(v=f.h,v.i=v.i.concat(_)),J){case 1:xa(f,5);break;case 4:xa(f,10);break;case 3:xa(f,6);break;default:xa(f,2)}}}function wu(f,v){let _=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(_*=2),_*v}function xa(f,v){if(f.j.info("Error code "+v),v==2){var _=b(f.fb,f),j=f.Xa;const J=!j;j=new mn(j||"//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||ho(j,"https"),fo(j),J?go(j.toString(),_):Sr(j.toString(),_)}else Mt(2);f.G=0,f.l&&f.l.sa(v),Ih(f),Th(f)}s.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Mt(2)):(this.j.info("Failed to ping google.com"),Mt(1))};function Ih(f){if(f.G=0,f.ka=[],f.l){const v=du(f.h);(v.length!=0||f.i.length!=0)&&(L(f.ka,v),L(f.ka,f.i),f.h.i.length=0,k(f.i),f.i.length=0),f.l.ra()}}function Ch(f,v,_){var j=_ instanceof mn?Ls(_):new mn(_);if(j.g!="")v&&(j.g=v+"."+j.g),ni(j,j.s);else{var J=h.location;j=J.protocol,v=v?v+"."+J.hostname:J.hostname,J=+J.port;var le=new mn(null);j&&ho(le,j),v&&(le.g=v),J&&ni(le,J),_&&(le.l=_),j=le}return _=f.D,v=f.ya,_&&v&&Ct(j,_,v),Ct(j,"VER",f.la),bo(f,j),j}function Rh(f,v,_){if(v&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return v=f.Ca&&!f.pa?new bt(new si({eb:_})):new bt(f.pa),v.Ha(f.J),v}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function kh(){}s=kh.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Rl(){}Rl.prototype.g=function(f,v){return new fs(f,v)};function fs(f,v){_t.call(this),this.g=new Al(v),this.l=f,this.h=v&&v.messageUrlParams||null,f=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(f?f["X-WebChannel-Content-Type"]=v.messageContentType:f={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(f?f["X-WebChannel-Client-Profile"]=v.va:f={"X-WebChannel-Client-Profile":v.va}),this.g.S=f,(f=v&&v.Sb)&&!F(f)&&(this.g.m=f),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!F(v)&&(this.g.D=v,f=this.h,f!==null&&v in f&&(f=this.h,v in f&&delete f[v])),this.j=new Qr(this)}C(fs,_t),fs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fs.prototype.close=function(){xu(this.g)},fs.prototype.o=function(f){var v=this.g;if(typeof f=="string"){var _={};_.__data__=f,f=_}else this.u&&(_={},_.__data__=kn(f),f=_);v.i.push(new co(v.Ya++,f)),v.G==3&&Il(v)},fs.prototype.N=function(){this.g.l=null,delete this.j,xu(this.g),delete this.g,fs.aa.N.call(this)};function Dh(f){us.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var v=f.__sm__;if(v){e:{for(const _ in v){f=_;break e}f=void 0}(this.i=f)&&(f=this.i,v=v!==null&&f in v?v[f]:void 0),this.data=v}else this.data=f}C(Dh,us);function Ph(){lo.call(this),this.status=1}C(Ph,lo);function Qr(f){this.g=f}C(Qr,kh),Qr.prototype.ua=function(){pt(this.g,"a")},Qr.prototype.ta=function(f){pt(this.g,new Dh(f))},Qr.prototype.sa=function(f){pt(this.g,new Ph)},Qr.prototype.ra=function(){pt(this.g,"b")},Rl.prototype.createWebChannel=Rl.prototype.g,fs.prototype.send=fs.prototype.o,fs.prototype.open=fs.prototype.m,fs.prototype.close=fs.prototype.close,hS=function(){return new Rl},dS=function(){return ds()},uS=tr,ux={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Dn.NO_ERROR=0,Dn.TIMEOUT=8,Dn.HTTP_ERROR=6,Zf=Dn,sr.COMPLETE="complete",cS=sr,Br.EventType=Nr,Nr.OPEN="a",Nr.CLOSE="b",Nr.ERROR="c",Nr.MESSAGE="d",_t.prototype.listen=_t.prototype.K,bd=Br,bt.prototype.listenOnce=bt.prototype.L,bt.prototype.getLastError=bt.prototype.Ka,bt.prototype.getLastErrorCode=bt.prototype.Ba,bt.prototype.getStatus=bt.prototype.Z,bt.prototype.getResponseJson=bt.prototype.Oa,bt.prototype.getResponseText=bt.prototype.oa,bt.prototype.send=bt.prototype.ea,bt.prototype.setWithCredentials=bt.prototype.Ha,lS=bt}).apply(typeof Vf<"u"?Vf:typeof self<"u"?self:typeof window<"u"?window:{});const fN="@firebase/firestore",mN="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}zn.UNAUTHENTICATED=new zn(null),zn.GOOGLE_CREDENTIALS=new zn("google-credentials-uid"),zn.FIRST_PARTY=new zn("first-party-uid"),zn.MOCK_USER=new zn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jc="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi=new Qm("@firebase/firestore");function mc(){return Gi.logLevel}function rD(s){Gi.setLogLevel(s)}function ge(s,...e){if(Gi.logLevel<=it.DEBUG){const t=e.map(rv);Gi.debug(`Firestore (${Jc}): ${s}`,...t)}}function hn(s,...e){if(Gi.logLevel<=it.ERROR){const t=e.map(rv);Gi.error(`Firestore (${Jc}): ${s}`,...t)}}function Ws(s,...e){if(Gi.logLevel<=it.WARN){const t=e.map(rv);Gi.warn(`Firestore (${Jc}): ${s}`,...t)}}function rv(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(s,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,fS(s,n,t)}function fS(s,e,t){let n=`FIRESTORE (${Jc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${s.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw hn(n),new Error(n)}function ke(s,e,t,n){let a="Unexpected state";typeof t=="string"?a=t:n=t,s||fS(e,a,n)}function aD(s,e){s||Ae(57014,e)}function Te(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const se={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends br{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(zn.UNAUTHENTICATED)))}shutdown(){}}class iD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class oD{constructor(e){this.t=e,this.currentUser=zn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ke(this.o===void 0,42304);let n=this.i;const a=m=>this.i!==n?(n=this.i,t(m)):Promise.resolve();let l=new Hn;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Hn,e.enqueueRetryable((()=>a(this.currentUser)))};const u=()=>{const m=l;e.enqueueRetryable((async()=>{await m.promise,await a(this.currentUser)}))},h=m=>{ge("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((m=>h(m))),setTimeout((()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?h(m):(ge("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Hn)}}),0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(ge("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ke(typeof n.accessToken=="string",31837,{l:n}),new mS(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ke(e===null||typeof e=="string",2055,{h:e}),new zn(e)}}class lD{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=zn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class cD{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new lD(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(zn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class dx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uD{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ke(this.o===void 0,3512);const n=l=>{l.error!=null&&ge("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.m;return this.m=l.token,ge("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>n(l)))};const a=l=>{ge("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>a(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):ge("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new dx(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ke(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new dx(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class dD{getToken(){return Promise.resolve(new dx(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hD(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const a=hD(40);for(let l=0;l<a.length;++l)n.length<20&&a[l]<t&&(n+=e.charAt(a[l]%62))}return n}}function qe(s,e){return s<e?-1:s>e?1:0}function hx(s,e){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++){const a=s.charAt(n),l=e.charAt(n);if(a!==l)return Ly(a)===Ly(l)?qe(a,l):Ly(a)?1:-1}return qe(s.length,e.length)}const fD=55296,mD=57343;function Ly(s){const e=s.charCodeAt(0);return e>=fD&&e<=mD}function Ac(s,e,t){return s.length===e.length&&s.every(((n,a)=>t(n,e[a])))}function pS(s){return s+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fx="__name__";class ta{constructor(e,t,n){t===void 0?t=0:t>e.length&&Ae(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Ae(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ta.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ta?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const l=ta.compareSegments(e.get(a),t.get(a));if(l!==0)return l}return qe(e.length,t.length)}static compareSegments(e,t){const n=ta.isNumericId(e),a=ta.isNumericId(t);return n&&!a?-1:!n&&a?1:n&&a?ta.extractNumericId(e).compare(ta.extractNumericId(t)):hx(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return zi.fromString(e.substring(4,e.length-2))}}class tt extends ta{construct(e,t,n){return new tt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new he(se.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((a=>a.length>0)))}return new tt(t)}static emptyPath(){return new tt([])}}const gD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bt extends ta{construct(e,t,n){return new Bt(e,t,n)}static isValidIdentifier(e){return gD.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===fx}static keyField(){return new Bt([fx])}static fromServerFormat(e){const t=[];let n="",a=0;const l=()=>{if(n.length===0)throw new he(se.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let u=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new he(se.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[a+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new he(se.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=m,a+=2}else h==="`"?(u=!u,a++):h!=="."||u?(n+=h,a++):(l(),a++)}if(l(),u)throw new he(se.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bt(t)}static emptyPath(){return new Bt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ne{constructor(e){this.path=e}static fromPath(e){return new Ne(tt.fromString(e))}static fromName(e){return new Ne(tt.fromString(e).popFirst(5))}static empty(){return new Ne(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return tt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ne(new tt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function av(s,e,t){if(!t)throw new he(se.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function yS(s,e,t,n){if(e===!0&&n===!0)throw new he(se.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function gN(s){if(!Ne.isDocumentKey(s))throw new he(se.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function pN(s){if(Ne.isDocumentKey(s))throw new he(se.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function xS(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}function eg(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":Ae(12329,{type:typeof s})}function nt(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new he(se.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=eg(s);throw new he(se.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}function vS(s,e){if(e<=0)throw new he(se.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(s,e){const t={typeString:s};return e&&(t.value=e),t}function hl(s,e){if(!xS(s))throw new he(se.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const a=e[n].typeString,l="value"in e[n]?{value:e[n].value}:void 0;if(!(n in s)){t=`JSON missing required field: '${n}'`;break}const u=s[n];if(a&&typeof u!==a){t=`JSON field '${n}' must be a ${a}.`;break}if(l!==void 0&&u!==l.value){t=`Expected '${n}' field to equal '${l.value}'`;break}}if(t)throw new he(se.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yN=-62135596800,xN=1e6;class wt{static now(){return wt.fromMillis(Date.now())}static fromDate(e){return wt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*xN);return new wt(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<yN)throw new he(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xN}_compareTo(e){return this.seconds===e.seconds?qe(this.nanoseconds,e.nanoseconds):qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:wt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(hl(e,wt._jsonSchema))return new wt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-yN;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}wt._jsonSchemaVersion="firestore/timestamp/1.0",wt._jsonSchema={type:vn("string",wt._jsonSchemaVersion),seconds:vn("number"),nanoseconds:vn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{static fromTimestamp(e){return new Me(e)}static min(){return new Me(new wt(0,0))}static max(){return new Me(new wt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc=-1;class Ic{constructor(e,t,n,a){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=a}}function mx(s){return s.fields.find((e=>e.kind===2))}function Fo(s){return s.fields.filter((e=>e.kind!==2))}function pD(s,e){let t=qe(s.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let n=0;n<Math.min(s.fields.length,e.fields.length);++n)if(t=yD(s.fields[n],e.fields[n]),t!==0)return t;return qe(s.fields.length,e.fields.length)}Ic.UNKNOWN_ID=-1;class Qo{constructor(e,t){this.fieldPath=e,this.kind=t}}function yD(s,e){const t=Bt.comparator(s.fieldPath,e.fieldPath);return t!==0?t:qe(s.kind,e.kind)}class Cc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Cc(0,Js.min())}}function bS(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,a=Me.fromTimestamp(n===1e9?new wt(t+1,0):new wt(t,n));return new Js(a,Ne.empty(),e)}function wS(s){return new Js(s.readTime,s.key,jc)}class Js{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Js(Me.min(),Ne.empty(),jc)}static max(){return new Js(Me.max(),Ne.empty(),jc)}}function iv(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=Ne.comparator(s.documentKey,e.documentKey),t!==0?t:qe(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _S="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class NS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zi(s){if(s.code!==se.FAILED_PRECONDITION||s.message!==_S)throw s;ge("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ae(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new W(((n,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(n,a)},this.catchCallback=l=>{this.wrapFailure(t,l).next(n,a)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof W?t:W.resolve(t)}catch(t){return W.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):W.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):W.reject(t)}static resolve(e){return new W(((t,n)=>{t(e)}))}static reject(e){return new W(((t,n)=>{n(e)}))}static waitFor(e){return new W(((t,n)=>{let a=0,l=0,u=!1;e.forEach((h=>{++a,h.next((()=>{++l,u&&l===a&&t()}),(m=>n(m)))})),u=!0,l===a&&t()}))}static or(e){let t=W.resolve(!1);for(const n of e)t=t.next((a=>a?W.resolve(a):n()));return t}static forEach(e,t){const n=[];return e.forEach(((a,l)=>{n.push(t.call(this,a,l))})),this.waitFor(n)}static mapArray(e,t){return new W(((n,a)=>{const l=e.length,u=new Array(l);let h=0;for(let m=0;m<l;m++){const p=m;t(e[p]).next((x=>{u[p]=x,++h,h===l&&n(u)}),(x=>a(x)))}}))}static doWhile(e,t){return new W(((n,a)=>{const l=()=>{e()===!0?t().next((()=>{l()}),a):n()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $s="SimpleDb";class tg{static open(e,t,n,a){try{return new tg(t,e.transaction(a,n))}catch(l){throw new Ad(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Hn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Ad(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const a=ov(n.target.error);this.S.reject(new Ad(e,a))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ge($s,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new vD(t)}}class la{static delete(e){return ge($s,"Removing database:",e),Bo(dE().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!$x())return!1;if(la.F())return!0;const e=jn(),t=la.M(e),n=0<t&&t<10,a=TS(e),l=0<a&&a<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||l)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,la.M(jn())===12.2&&hn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ge($s,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const a=indexedDB.open(this.name,this.version);a.onsuccess=l=>{const u=l.target.result;t(u)},a.onblocked=()=>{n(new Ad(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=l=>{const u=l.target.error;u.name==="VersionError"?n(new he(se.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):u.name==="InvalidStateError"?n(new he(se.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u)):n(new Ad(e,u))},a.onupgradeneeded=l=>{ge($s,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const u=l.target.result;this.N.k(u,a.transaction,l.oldVersion,this.version).next((()=>{ge($s,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,a){const l=t==="readonly";let u=0;for(;;){++u;try{this.db=await this.L(e);const h=tg.open(this.db,e,l?"readonly":"readwrite",n),m=a(h).next((p=>(h.C(),p))).catch((p=>(h.abort(p),W.reject(p)))).toPromise();return m.catch((()=>{})),await h.D,m}catch(h){const m=h,p=m.name!=="FirebaseError"&&u<3;if(ge($s,"Transaction failed with error:",m.message,"Retrying:",p),this.close(),!p)return Promise.reject(m)}}}close(){this.db&&this.db.close(),this.db=void 0}}function TS(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class xD{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Bo(this.U.delete())}}class Ad extends he{constructor(e,t){super(se.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eo(s){return s.name==="IndexedDbTransactionError"}class vD{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(ge($s,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(ge($s,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Bo(n)}add(e){return ge($s,"ADD",this.store.name,e,e),Bo(this.store.add(e))}get(e){return Bo(this.store.get(e)).next((t=>(t===void 0&&(t=null),ge($s,"GET",this.store.name,e,t),t)))}delete(e){return ge($s,"DELETE",this.store.name,e),Bo(this.store.delete(e))}count(){return ge($s,"COUNT",this.store.name),Bo(this.store.count())}J(e,t){const n=this.options(e,t),a=n.index?this.store.index(n.index):this.store;if(typeof a.getAll=="function"){const l=a.getAll(n.range);return new W(((u,h)=>{l.onerror=m=>{h(m.target.error)},l.onsuccess=m=>{u(m.target.result)}}))}{const l=this.cursor(n),u=[];return this.H(l,((h,m)=>{u.push(m)})).next((()=>u))}}Y(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new W(((a,l)=>{n.onerror=u=>{l(u.target.error)},n.onsuccess=u=>{a(u.target.result)}}))}Z(e,t){ge($s,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const a=this.cursor(n);return this.H(a,((l,u,h)=>h.delete()))}ee(e,t){let n;t?n=e:(n={},t=e);const a=this.cursor(n);return this.H(a,t)}te(e){const t=this.cursor({});return new W(((n,a)=>{t.onerror=l=>{const u=ov(l.target.error);a(u)},t.onsuccess=l=>{const u=l.target.result;u?e(u.primaryKey,u.value).next((h=>{h?u.continue():n()})):n()}}))}H(e,t){const n=[];return new W(((a,l)=>{e.onerror=u=>{l(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void a();const m=new xD(h),p=t(h.primaryKey,h.value,m);if(p instanceof W){const x=p.catch((w=>(m.done(),W.reject(w))));n.push(x)}m.isDone?a():m.G===null?h.continue():h.continue(m.G)}})).next((()=>W.waitFor(n)))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Bo(s){return new W(((e,t)=>{s.onsuccess=n=>{const a=n.target.result;e(a)},s.onerror=n=>{const a=ov(n.target.error);t(a)}}))}let vN=!1;function ov(s){const e=la.M(jn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(s.message.indexOf(t)>=0){const n=new he("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return vN||(vN=!0,setTimeout((()=>{throw n}),0)),n}}return s}const jd="IndexBackfiller";class bD{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){ge(jd,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();ge(jd,`Documents written: ${t}`)}catch(t){eo(t)?ge(jd,"Ignoring IndexedDB error during index backfill: ",t):await Zi(t)}await this.re(6e4)}))}}class wD{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const n=new Set;let a=t,l=!0;return W.doWhile((()=>l===!0&&a>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((u=>{if(u!==null&&!n.has(u))return ge(jd,`Processing collection: ${u}`),this.oe(e,u,a).next((h=>{a-=h,n.add(u)}));l=!1})))).next((()=>t-a))}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((a=>this.localStore.localDocuments.getNextDocuments(e,t,a,n).next((l=>{const u=l.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next((()=>this._e(a,l))).next((h=>(ge(jd,`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h)))).next((()=>u.size))}))))}_e(e,t){let n=e;return t.changes.forEach(((a,l)=>{const u=wS(l);iv(u,n)>0&&(n=u)})),new Js(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ns.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=-1;function ah(s){return s==null}function Bd(s){return s===0&&1/s==-1/0}function ES(s){return typeof s=="number"&&Number.isInteger(s)&&!Bd(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm="";function ls(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=bN(e)),e=_D(s.get(t),e);return bN(e)}function _D(s,e){let t=e;const n=s.length;for(let a=0;a<n;a++){const l=s.charAt(a);switch(l){case"\0":t+="";break;case Tm:t+="";break;default:t+=l}}return t}function bN(s){return s+Tm+""}function aa(s){const e=s.length;if(ke(e>=2,64408,{path:s}),e===2)return ke(s.charAt(0)===Tm&&s.charAt(1)==="",56145,{path:s}),tt.emptyPath();const t=e-2,n=[];let a="";for(let l=0;l<e;){const u=s.indexOf(Tm,l);switch((u<0||u>t)&&Ae(50515,{path:s}),s.charAt(u+1)){case"":const h=s.substring(l,u);let m;a.length===0?m=h:(a+=h,m=a,a=""),n.push(m);break;case"":a+=s.substring(l,u),a+="\0";break;case"":a+=s.substring(l,u+1);break;default:Ae(61167,{path:s})}l=u+2}return new tt(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="remoteDocuments",ih="owner",ic="owner",qd="mutationQueues",ND="userId",kr="mutations",wN="batchId",$o="userMutationsIndex",_N=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(s,e){return[s,ls(e)]}function SS(s,e,t){return[s,ls(e),t]}const TD={},Rc="documentMutations",Em="remoteDocumentsV14",ED=["prefixPath","collectionGroup","readTime","documentId"],tm="documentKeyIndex",SD=["prefixPath","collectionGroup","documentId"],AS="collectionGroupIndex",AD=["collectionGroup","readTime","prefixPath","documentId"],zd="remoteDocumentGlobal",gx="remoteDocumentGlobalKey",kc="targets",jS="queryTargetsIndex",jD=["canonicalId","targetId"],Dc="targetDocuments",ID=["targetId","path"],lv="documentTargetsIndex",CD=["path","targetId"],Sm="targetGlobalKey",Yo="targetGlobal",Hd="collectionParents",RD=["collectionId","parent"],Pc="clientMetadata",kD="clientId",ng="bundles",DD="bundleId",sg="namedQueries",PD="name",cv="indexConfiguration",MD="indexId",px="collectionGroupIndex",OD="collectionGroup",Id="indexState",VD=["indexId","uid"],IS="sequenceNumberIndex",LD=["uid","sequenceNumber"],Cd="indexEntries",FD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],CS="documentKeyIndex",UD=["indexId","uid","orderedDocumentKey"],rg="documentOverlays",BD=["userId","collectionPath","documentId"],yx="collectionPathOverlayIndex",qD=["userId","collectionPath","largestBatchId"],RS="collectionGroupOverlayIndex",zD=["userId","collectionGroup","largestBatchId"],uv="globals",HD="name",kS=[qd,kr,Rc,Uo,kc,ih,Yo,Dc,Pc,zd,Hd,ng,sg],GD=[...kS,rg],DS=[qd,kr,Rc,Em,kc,ih,Yo,Dc,Pc,zd,Hd,ng,sg,rg],PS=DS,dv=[...PS,cv,Id,Cd],$D=dv,MS=[...dv,uv],KD=MS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xx extends NS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Cn(s,e){const t=Te(s);return la.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NN(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function to(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function OS(s,e){const t=[];for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.push(e(s[n],n,s));return t}function VS(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,t){this.comparator=e,this.root=t||Jn.EMPTY}insert(e,t){return new Ft(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jn.BLACK,null,null))}remove(e){return new Ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Lf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Lf(this.root,e,this.comparator,!1)}getReverseIterator(){return new Lf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Lf(this.root,e,this.comparator,!0)}}class Lf{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?n(e.key,t):1,t&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Jn{constructor(e,t,n,a,l){this.key=e,this.value=t,this.color=n??Jn.RED,this.left=a??Jn.EMPTY,this.right=l??Jn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,l){return new Jn(e??this.key,t??this.value,n??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const l=n(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,t,n),null):l===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Jn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Jn.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Jn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Jn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ae(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ae(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ae(27949);return e+(this.isRed()?0:1)}}Jn.EMPTY=null,Jn.RED=!0,Jn.BLACK=!1;Jn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ae(57766)}get value(){throw Ae(16141)}get color(){throw Ae(16727)}get left(){throw Ae(29726)}get right(){throw Ae(36894)}copy(e,t,n,a,l){return this}insert(e,t,n){return new Jn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new Ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new TN(this.data.getIterator())}getIteratorFrom(e){return new TN(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=n.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new jt(this.comparator);return t.data=e,t}}class TN{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function oc(s){return s.hasNext()?s.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e){this.fields=e,e.sort(Bt.comparator)}static empty(){return new Ts([])}unionWith(e){let t=new jt(Bt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ts(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ac(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QD(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new LS("Invalid base64 string: "+l):l}})(e);return new en(t)}static fromUint8Array(e){const t=(function(a){let l="";for(let u=0;u<a.length;++u)l+=String.fromCharCode(a[u]);return l})(e);return new en(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}en.EMPTY_BYTE_STRING=new en("");const YD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ga(s){if(ke(!!s,39018),typeof s=="string"){let e=0;const t=YD.exec(s);if(ke(!!t,46558,{timestamp:s}),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Gt(s.seconds),nanos:Gt(s.nanos)}}function Gt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function $a(s){return typeof s=="string"?en.fromBase64String(s):en.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FS="server_timestamp",US="__type__",BS="__previous_value__",qS="__local_write_time__";function ag(s){return(s?.mapValue?.fields||{})[US]?.stringValue===FS}function ig(s){const e=s.mapValue.fields[BS];return ag(e)?ig(e):e}function Gd(s){const e=Ga(s.mapValue.fields[qS].timestampValue);return new wt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e,t,n,a,l,u,h,m,p,x){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=m,this.useFetchStreams=p,this.isUsingEmulator=x}}const $d="(default)";class $i{constructor(e,t){this.projectId=e,this.database=t||$d}static empty(){return new $i("","")}get isDefaultDatabase(){return this.database===$d}isEqual(e){return e instanceof $i&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv="__type__",zS="__max__",Oi={mapValue:{fields:{__type__:{stringValue:zS}}}},fv="__vector__",Mc="value",nm={nullValue:"NULL_VALUE"};function Ki(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?ag(s)?4:HS(s)?9007199254740991:og(s)?10:11:Ae(28295,{value:s})}function da(s,e){if(s===e)return!0;const t=Ki(s);if(t!==Ki(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return Gd(s).isEqual(Gd(e));case 3:return(function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const u=Ga(a.timestampValue),h=Ga(l.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(s,e);case 5:return s.stringValue===e.stringValue;case 6:return(function(a,l){return $a(a.bytesValue).isEqual($a(l.bytesValue))})(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return(function(a,l){return Gt(a.geoPointValue.latitude)===Gt(l.geoPointValue.latitude)&&Gt(a.geoPointValue.longitude)===Gt(l.geoPointValue.longitude)})(s,e);case 2:return(function(a,l){if("integerValue"in a&&"integerValue"in l)return Gt(a.integerValue)===Gt(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const u=Gt(a.doubleValue),h=Gt(l.doubleValue);return u===h?Bd(u)===Bd(h):isNaN(u)&&isNaN(h)}return!1})(s,e);case 9:return Ac(s.arrayValue.values||[],e.arrayValue.values||[],da);case 10:case 11:return(function(a,l){const u=a.mapValue.fields||{},h=l.mapValue.fields||{};if(NN(u)!==NN(h))return!1;for(const m in u)if(u.hasOwnProperty(m)&&(h[m]===void 0||!da(u[m],h[m])))return!1;return!0})(s,e);default:return Ae(52216,{left:s})}}function Kd(s,e){return(s.values||[]).find((t=>da(t,e)))!==void 0}function Qi(s,e){if(s===e)return 0;const t=Ki(s),n=Ki(e);if(t!==n)return qe(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return qe(s.booleanValue,e.booleanValue);case 2:return(function(l,u){const h=Gt(l.integerValue||l.doubleValue),m=Gt(u.integerValue||u.doubleValue);return h<m?-1:h>m?1:h===m?0:isNaN(h)?isNaN(m)?0:-1:1})(s,e);case 3:return EN(s.timestampValue,e.timestampValue);case 4:return EN(Gd(s),Gd(e));case 5:return hx(s.stringValue,e.stringValue);case 6:return(function(l,u){const h=$a(l),m=$a(u);return h.compareTo(m)})(s.bytesValue,e.bytesValue);case 7:return(function(l,u){const h=l.split("/"),m=u.split("/");for(let p=0;p<h.length&&p<m.length;p++){const x=qe(h[p],m[p]);if(x!==0)return x}return qe(h.length,m.length)})(s.referenceValue,e.referenceValue);case 8:return(function(l,u){const h=qe(Gt(l.latitude),Gt(u.latitude));return h!==0?h:qe(Gt(l.longitude),Gt(u.longitude))})(s.geoPointValue,e.geoPointValue);case 9:return SN(s.arrayValue,e.arrayValue);case 10:return(function(l,u){const h=l.fields||{},m=u.fields||{},p=h[Mc]?.arrayValue,x=m[Mc]?.arrayValue,w=qe(p?.values?.length||0,x?.values?.length||0);return w!==0?w:SN(p,x)})(s.mapValue,e.mapValue);case 11:return(function(l,u){if(l===Oi.mapValue&&u===Oi.mapValue)return 0;if(l===Oi.mapValue)return 1;if(u===Oi.mapValue)return-1;const h=l.fields||{},m=Object.keys(h),p=u.fields||{},x=Object.keys(p);m.sort(),x.sort();for(let w=0;w<m.length&&w<x.length;++w){const b=hx(m[w],x[w]);if(b!==0)return b;const E=Qi(h[m[w]],p[x[w]]);if(E!==0)return E}return qe(m.length,x.length)})(s.mapValue,e.mapValue);default:throw Ae(23264,{he:t})}}function EN(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return qe(s,e);const t=Ga(s),n=Ga(e),a=qe(t.seconds,n.seconds);return a!==0?a:qe(t.nanos,n.nanos)}function SN(s,e){const t=s.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const l=Qi(t[a],n[a]);if(l)return l}return qe(t.length,n.length)}function Oc(s){return vx(s)}function vx(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?(function(t){const n=Ga(t);return`time(${n.seconds},${n.nanos})`})(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?(function(t){return $a(t).toBase64()})(s.bytesValue):"referenceValue"in s?(function(t){return Ne.fromName(t).toString()})(s.referenceValue):"geoPointValue"in s?(function(t){return`geo(${t.latitude},${t.longitude})`})(s.geoPointValue):"arrayValue"in s?(function(t){let n="[",a=!0;for(const l of t.values||[])a?a=!1:n+=",",n+=vx(l);return n+"]"})(s.arrayValue):"mapValue"in s?(function(t){const n=Object.keys(t.fields||{}).sort();let a="{",l=!0;for(const u of n)l?l=!1:a+=",",a+=`${u}:${vx(t.fields[u])}`;return a+"}"})(s.mapValue):Ae(61005,{value:s})}function sm(s){switch(Ki(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ig(s);return e?16+sm(e):16;case 5:return 2*s.stringValue.length;case 6:return $a(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((a,l)=>a+sm(l)),0)})(s.arrayValue);case 10:case 11:return(function(n){let a=0;return to(n.fields,((l,u)=>{a+=l.length+sm(u)})),a})(s.mapValue);default:throw Ae(13486,{value:s})}}function el(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function bx(s){return!!s&&"integerValue"in s}function Qd(s){return!!s&&"arrayValue"in s}function AN(s){return!!s&&"nullValue"in s}function jN(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function rm(s){return!!s&&"mapValue"in s}function og(s){return(s?.mapValue?.fields||{})[hv]?.stringValue===fv}function Rd(s){if(s.geoPointValue)return{geoPointValue:{...s.geoPointValue}};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:{...s.timestampValue}};if(s.mapValue){const e={mapValue:{fields:{}}};return to(s.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Rd(n))),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Rd(s.arrayValue.values[t]);return e}return{...s}}function HS(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===zS}const GS={mapValue:{fields:{[hv]:{stringValue:fv},[Mc]:{arrayValue:{}}}}};function WD(s){return"nullValue"in s?nm:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?el($i.empty(),Ne.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?og(s)?GS:{mapValue:{}}:Ae(35942,{value:s})}function JD(s){return"nullValue"in s?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?el($i.empty(),Ne.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?GS:"mapValue"in s?og(s)?{mapValue:{}}:Oi:Ae(61959,{value:s})}function IN(s,e){const t=Qi(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?-1:!s.inclusive&&e.inclusive?1:0}function CN(s,e){const t=Qi(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?1:!s.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e){this.value=e}static empty(){return new Zn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!rm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rd(t)}setAll(e){let t=Bt.emptyPath(),n={},a=[];e.forEach(((u,h)=>{if(!t.isImmediateParentOf(h)){const m=this.getFieldsMap(t);this.applyChanges(m,n,a),n={},a=[],t=h.popLast()}u?n[h.lastSegment()]=Rd(u):a.push(h.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,n,a)}delete(e){const t=this.field(e.popLast());rm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return da(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];rm(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){to(t,((a,l)=>e[a]=l));for(const a of n)delete e[a]}clone(){return new Zn(Rd(this.value))}}function $S(s){const e=[];return to(s.fields,((t,n)=>{const a=new Bt([t]);if(rm(n)){const l=$S(n.mapValue).fields;if(l.length===0)e.push(a);else for(const u of l)e.push(a.child(u))}else e.push(a)})),new Ts(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t,n,a,l,u,h){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=l,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Ut(e,0,Me.min(),Me.min(),Me.min(),Zn.empty(),0)}static newFoundDocument(e,t,n,a){return new Ut(e,1,t,Me.min(),n,a,0)}static newNoDocument(e,t){return new Ut(e,2,t,Me.min(),Me.min(),Zn.empty(),0)}static newUnknownDocument(e,t){return new Ut(e,3,t,Me.min(),Me.min(),Zn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Zn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Zn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ut&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t){this.position=e,this.inclusive=t}}function RN(s,e,t){let n=0;for(let a=0;a<s.position.length;a++){const l=e[a],u=s.position[a];if(l.field.isKeyField()?n=Ne.comparator(Ne.fromName(u.referenceValue),t.key):n=Qi(u,t.data.field(l.field)),l.dir==="desc"&&(n*=-1),n!==0)break}return n}function kN(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!da(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e,t="asc"){this.field=e,this.dir=t}}function ZD(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{}class ot extends KS{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new e4(e,t,n):t==="array-contains"?new s4(e,n):t==="in"?new ZS(e,n):t==="not-in"?new r4(e,n):t==="array-contains-any"?new a4(e,n):new ot(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new t4(e,n):new n4(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Qi(t,this.value)):t!==null&&Ki(this.value)===Ki(t)&&this.matchesComparison(Qi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ae(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class St extends KS{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new St(e,t)}matches(e){return Vc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Vc(s){return s.op==="and"}function wx(s){return s.op==="or"}function mv(s){return QS(s)&&Vc(s)}function QS(s){for(const e of s.filters)if(e instanceof St)return!1;return!0}function _x(s){if(s instanceof ot)return s.field.canonicalString()+s.op.toString()+Oc(s.value);if(mv(s))return s.filters.map((e=>_x(e))).join(",");{const e=s.filters.map((t=>_x(t))).join(",");return`${s.op}(${e})`}}function YS(s,e){return s instanceof ot?(function(n,a){return a instanceof ot&&n.op===a.op&&n.field.isEqual(a.field)&&da(n.value,a.value)})(s,e):s instanceof St?(function(n,a){return a instanceof St&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce(((l,u,h)=>l&&YS(u,a.filters[h])),!0):!1})(s,e):void Ae(19439)}function XS(s,e){const t=s.filters.concat(e);return St.create(t,s.op)}function WS(s){return s instanceof ot?(function(t){return`${t.field.canonicalString()} ${t.op} ${Oc(t.value)}`})(s):s instanceof St?(function(t){return t.op.toString()+" {"+t.getFilters().map(WS).join(" ,")+"}"})(s):"Filter"}class e4 extends ot{constructor(e,t,n){super(e,t,n),this.key=Ne.fromName(n.referenceValue)}matches(e){const t=Ne.comparator(e.key,this.key);return this.matchesComparison(t)}}class t4 extends ot{constructor(e,t){super(e,"in",t),this.keys=JS("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class n4 extends ot{constructor(e,t){super(e,"not-in",t),this.keys=JS("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function JS(s,e){return(e.arrayValue?.values||[]).map((t=>Ne.fromName(t.referenceValue)))}class s4 extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qd(t)&&Kd(t.arrayValue,this.value)}}class ZS extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Kd(this.value.arrayValue,t)}}class r4 extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(Kd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Kd(this.value.arrayValue,t)}}class a4 extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qd(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>Kd(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(e,t=null,n=[],a=[],l=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=l,this.startAt=u,this.endAt=h,this.Te=null}}function Nx(s,e=null,t=[],n=[],a=null,l=null,u=null){return new i4(s,e,t,n,a,l,u)}function tl(s){const e=Te(s);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>_x(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(l){return l.field.canonicalString()+l.dir})(n))).join(","),ah(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>Oc(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>Oc(n))).join(",")),e.Te=t}return e.Te}function oh(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!ZD(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!YS(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!kN(s.startAt,e.startAt)&&kN(s.endAt,e.endAt)}function Am(s){return Ne.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}function jm(s,e){return s.filters.filter((t=>t instanceof ot&&t.field.isEqual(e)))}function DN(s,e,t){let n=nm,a=!0;for(const l of jm(s,e)){let u=nm,h=!0;switch(l.op){case"<":case"<=":u=WD(l.value);break;case"==":case"in":case">=":u=l.value;break;case">":u=l.value,h=!1;break;case"!=":case"not-in":u=nm}IN({value:n,inclusive:a},{value:u,inclusive:h})<0&&(n=u,a=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];IN({value:n,inclusive:a},{value:u,inclusive:t.inclusive})<0&&(n=u,a=t.inclusive);break}}return{value:n,inclusive:a}}function PN(s,e,t){let n=Oi,a=!0;for(const l of jm(s,e)){let u=Oi,h=!0;switch(l.op){case">=":case">":u=JD(l.value),h=!1;break;case"==":case"in":case"<=":u=l.value;break;case"<":u=l.value,h=!1;break;case"!=":case"not-in":u=Oi}CN({value:n,inclusive:a},{value:u,inclusive:h})>0&&(n=u,a=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];CN({value:n,inclusive:a},{value:u,inclusive:t.inclusive})>0&&(n=u,a=t.inclusive);break}}return{value:n,inclusive:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,t=null,n=[],a=[],l=null,u="F",h=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=l,this.limitType=u,this.startAt=h,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function eA(s,e,t,n,a,l,u,h){return new Qa(s,e,t,n,a,l,u,h)}function Zc(s){return new Qa(s)}function MN(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function gv(s){return s.collectionGroup!==null}function Nc(s){const e=Te(s);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new jt(Bt.comparator);return u.filters.forEach((m=>{m.getFlattenedFilters().forEach((p=>{p.isInequality()&&(h=h.add(p.field))}))})),h})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new Yd(l,n))})),t.has(Bt.keyField().canonicalString())||e.Ie.push(new Yd(Bt.keyField(),n))}return e.Ie}function cs(s){const e=Te(s);return e.Ee||(e.Ee=nA(e,Nc(s))),e.Ee}function tA(s){const e=Te(s);return e.de||(e.de=nA(e,s.explicitOrderBy)),e.de}function nA(s,e){if(s.limitType==="F")return Nx(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map((a=>{const l=a.dir==="desc"?"asc":"desc";return new Yd(a.field,l)}));const t=s.endAt?new Yi(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new Yi(s.startAt.position,s.startAt.inclusive):null;return Nx(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Tx(s,e){const t=s.filters.concat([e]);return new Qa(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function Im(s,e,t){return new Qa(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function lh(s,e){return oh(cs(s),cs(e))&&s.limitType===e.limitType}function sA(s){return`${tl(cs(s))}|lt:${s.limitType}`}function gc(s){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((a=>WS(a))).join(", ")}]`),ah(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((a=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(a))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((a=>Oc(a))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((a=>Oc(a))).join(",")),`Target(${n})`})(cs(s))}; limitType=${s.limitType})`}function ch(s,e){return e.isFoundDocument()&&(function(n,a){const l=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(l):Ne.isDocumentKey(n.path)?n.path.isEqual(l):n.path.isImmediateParentOf(l)})(s,e)&&(function(n,a){for(const l of Nc(n))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0})(s,e)&&(function(n,a){for(const l of n.filters)if(!l.matches(a))return!1;return!0})(s,e)&&(function(n,a){return!(n.startAt&&!(function(u,h,m){const p=RN(u,h,m);return u.inclusive?p<=0:p<0})(n.startAt,Nc(n),a)||n.endAt&&!(function(u,h,m){const p=RN(u,h,m);return u.inclusive?p>=0:p>0})(n.endAt,Nc(n),a))})(s,e)}function rA(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function aA(s){return(e,t)=>{let n=!1;for(const a of Nc(s)){const l=o4(a,e,t);if(l!==0)return l;n=n||a.field.isKeyField()}return 0}}function o4(s,e,t){const n=s.field.isKeyField()?Ne.comparator(e.key,t.key):(function(l,u,h){const m=u.data.field(l),p=h.data.field(l);return m!==null&&p!==null?Qi(m,p):Ae(42886)})(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return Ae(19790,{direction:s.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,l]of n)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){to(this.inner,((t,n)=>{for(const[a,l]of n)e(a,l)}))}isEmpty(){return VS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4=new Ft(Ne.comparator);function Es(){return l4}const iA=new Ft(Ne.comparator);function wd(...s){let e=iA;for(const t of s)e=e.insert(t.key,t);return e}function oA(s){let e=iA;return s.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ia(){return kd()}function lA(){return kd()}function kd(){return new Ya((s=>s.toString()),((s,e)=>s.isEqual(e)))}const c4=new Ft(Ne.comparator),u4=new jt(Ne.comparator);function Xe(...s){let e=u4;for(const t of s)e=e.add(t);return e}const d4=new jt(qe);function pv(){return d4}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yv(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bd(e)?"-0":e}}function cA(s){return{integerValue:""+s}}function uA(s,e){return ES(e)?cA(e):yv(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(){this._=void 0}}function h4(s,e,t){return s instanceof Lc?(function(a,l){const u={fields:{[US]:{stringValue:FS},[qS]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&ag(l)&&(l=ig(l)),l&&(u.fields[BS]=l),{mapValue:u}})(t,e):s instanceof nl?hA(s,e):s instanceof sl?fA(s,e):(function(a,l){const u=dA(a,l),h=ON(u)+ON(a.Ae);return bx(u)&&bx(a.Ae)?cA(h):yv(a.serializer,h)})(s,e)}function f4(s,e,t){return s instanceof nl?hA(s,e):s instanceof sl?fA(s,e):t}function dA(s,e){return s instanceof Fc?(function(n){return bx(n)||(function(l){return!!l&&"doubleValue"in l})(n)})(e)?e:{integerValue:0}:null}class Lc extends lg{}class nl extends lg{constructor(e){super(),this.elements=e}}function hA(s,e){const t=mA(e);for(const n of s.elements)t.some((a=>da(a,n)))||t.push(n);return{arrayValue:{values:t}}}class sl extends lg{constructor(e){super(),this.elements=e}}function fA(s,e){let t=mA(e);for(const n of s.elements)t=t.filter((a=>!da(a,n)));return{arrayValue:{values:t}}}class Fc extends lg{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ON(s){return Gt(s.integerValue||s.doubleValue)}function mA(s){return Qd(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,t){this.field=e,this.transform=t}}function m4(s,e){return s.field.isEqual(e.field)&&(function(n,a){return n instanceof nl&&a instanceof nl||n instanceof sl&&a instanceof sl?Ac(n.elements,a.elements,da):n instanceof Fc&&a instanceof Fc?da(n.Ae,a.Ae):n instanceof Lc&&a instanceof Lc})(s.transform,e.transform)}class g4{constructor(e,t){this.version=e,this.transformResults=t}}class Kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Kt}static exists(e){return new Kt(void 0,e)}static updateTime(e){return new Kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function am(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class cg{}function gA(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new tu(s.key,Kt.none()):new eu(s.key,s.data,Kt.none());{const t=s.data,n=Zn.empty();let a=new jt(Bt.comparator);for(let l of e.fields)if(!a.has(l)){let u=t.field(l);u===null&&l.length>1&&(l=l.popLast(),u=t.field(l)),u===null?n.delete(l):n.set(l,u),a=a.add(l)}return new Xa(s.key,n,new Ts(a.toArray()),Kt.none())}}function p4(s,e,t){s instanceof eu?(function(a,l,u){const h=a.value.clone(),m=LN(a.fieldTransforms,l,u.transformResults);h.setAll(m),l.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(s,e,t):s instanceof Xa?(function(a,l,u){if(!am(a.precondition,l))return void l.convertToUnknownDocument(u.version);const h=LN(a.fieldTransforms,l,u.transformResults),m=l.data;m.setAll(pA(a)),m.setAll(h),l.convertToFoundDocument(u.version,m).setHasCommittedMutations()})(s,e,t):(function(a,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,t)}function Dd(s,e,t,n){return s instanceof eu?(function(l,u,h,m){if(!am(l.precondition,u))return h;const p=l.value.clone(),x=FN(l.fieldTransforms,m,u);return p.setAll(x),u.convertToFoundDocument(u.version,p).setHasLocalMutations(),null})(s,e,t,n):s instanceof Xa?(function(l,u,h,m){if(!am(l.precondition,u))return h;const p=FN(l.fieldTransforms,m,u),x=u.data;return x.setAll(pA(l)),x.setAll(p),u.convertToFoundDocument(u.version,x).setHasLocalMutations(),h===null?null:h.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((w=>w.field)))})(s,e,t,n):(function(l,u,h){return am(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(s,e,t)}function y4(s,e){let t=null;for(const n of s.fieldTransforms){const a=e.data.field(n.field),l=dA(n.transform,a||null);l!=null&&(t===null&&(t=Zn.empty()),t.set(n.field,l))}return t||null}function VN(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!(function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&Ac(n,a,((l,u)=>m4(l,u)))})(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class eu extends cg{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Xa extends cg{constructor(e,t,n,a,l=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function pA(s){const e=new Map;return s.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}})),e}function LN(s,e,t){const n=new Map;ke(s.length===t.length,32656,{Re:t.length,Ve:s.length});for(let a=0;a<t.length;a++){const l=s[a],u=l.transform,h=e.data.field(l.field);n.set(l.field,f4(u,h,t[a]))}return n}function FN(s,e,t){const n=new Map;for(const a of s){const l=a.transform,u=t.data.field(a.field);n.set(a.field,h4(l,u,e))}return n}class tu extends cg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xv extends cg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&p4(l,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Dd(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Dd(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=lA();return this.mutations.forEach((a=>{const l=e.get(a.key),u=l.overlayedDocument;let h=this.applyToLocalView(u,l.mutatedFields);h=t.has(a.key)?null:h;const m=gA(u,h);m!==null&&n.set(a.key,m),u.isValidDocument()||u.convertToNoDocument(Me.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Xe())}isEqual(e){return this.batchId===e.batchId&&Ac(this.mutations,e.mutations,((t,n)=>VN(t,n)))&&Ac(this.baseMutations,e.baseMutations,((t,n)=>VN(t,n)))}}class bv{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){ke(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let a=(function(){return c4})();const l=e.mutations;for(let u=0;u<l.length;u++)a=a.insert(l[u].key,n[u].version);return new bv(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yA{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yn,ft;function xA(s){switch(s){case se.OK:return Ae(64938);case se.CANCELLED:case se.UNKNOWN:case se.DEADLINE_EXCEEDED:case se.RESOURCE_EXHAUSTED:case se.INTERNAL:case se.UNAVAILABLE:case se.UNAUTHENTICATED:return!1;case se.INVALID_ARGUMENT:case se.NOT_FOUND:case se.ALREADY_EXISTS:case se.PERMISSION_DENIED:case se.FAILED_PRECONDITION:case se.ABORTED:case se.OUT_OF_RANGE:case se.UNIMPLEMENTED:case se.DATA_LOSS:return!0;default:return Ae(15467,{code:s})}}function vA(s){if(s===void 0)return hn("GRPC error has no .code"),se.UNKNOWN;switch(s){case yn.OK:return se.OK;case yn.CANCELLED:return se.CANCELLED;case yn.UNKNOWN:return se.UNKNOWN;case yn.DEADLINE_EXCEEDED:return se.DEADLINE_EXCEEDED;case yn.RESOURCE_EXHAUSTED:return se.RESOURCE_EXHAUSTED;case yn.INTERNAL:return se.INTERNAL;case yn.UNAVAILABLE:return se.UNAVAILABLE;case yn.UNAUTHENTICATED:return se.UNAUTHENTICATED;case yn.INVALID_ARGUMENT:return se.INVALID_ARGUMENT;case yn.NOT_FOUND:return se.NOT_FOUND;case yn.ALREADY_EXISTS:return se.ALREADY_EXISTS;case yn.PERMISSION_DENIED:return se.PERMISSION_DENIED;case yn.FAILED_PRECONDITION:return se.FAILED_PRECONDITION;case yn.ABORTED:return se.ABORTED;case yn.OUT_OF_RANGE:return se.OUT_OF_RANGE;case yn.UNIMPLEMENTED:return se.UNIMPLEMENTED;case yn.DATA_LOSS:return se.DATA_LOSS;default:return Ae(39323,{code:s})}}(ft=yn||(yn={}))[ft.OK=0]="OK",ft[ft.CANCELLED=1]="CANCELLED",ft[ft.UNKNOWN=2]="UNKNOWN",ft[ft.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ft[ft.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ft[ft.NOT_FOUND=5]="NOT_FOUND",ft[ft.ALREADY_EXISTS=6]="ALREADY_EXISTS",ft[ft.PERMISSION_DENIED=7]="PERMISSION_DENIED",ft[ft.UNAUTHENTICATED=16]="UNAUTHENTICATED",ft[ft.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ft[ft.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ft[ft.ABORTED=10]="ABORTED",ft[ft.OUT_OF_RANGE=11]="OUT_OF_RANGE",ft[ft.UNIMPLEMENTED=12]="UNIMPLEMENTED",ft[ft.INTERNAL=13]="INTERNAL",ft[ft.UNAVAILABLE=14]="UNAVAILABLE",ft[ft.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ex=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bA(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4=new zi([4294967295,4294967295],0);function UN(s){const e=bA().encode(s),t=new oS;return t.update(e),new Uint8Array(t.digest())}function BN(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new zi([t,n],0),new zi([a,l],0)]}class _v{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new _d(`Invalid padding: ${t}`);if(n<0)throw new _d(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new _d(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new _d(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=zi.fromNumber(this.ge)}ye(e,t,n){let a=e.add(t.multiply(zi.fromNumber(n)));return a.compare(v4)===1&&(a=new zi([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=UN(e),[n,a]=BN(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,a,l);if(!this.we(u))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new _v(l,a,t);return n.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const t=UN(e),[n,a]=BN(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,a,l);this.Se(u)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class _d extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(e,t,n,a,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,hh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new dh(Me.min(),a,new Ft(qe),Es(),Xe())}}class hh{constructor(e,t,n,a,l){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new hh(n,t,Xe(),Xe(),Xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(e,t,n,a){this.be=e,this.removedTargetIds=t,this.key=n,this.De=a}}class wA{constructor(e,t){this.targetId=e,this.Ce=t}}class _A{constructor(e,t,n=en.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class qN{constructor(){this.ve=0,this.Fe=zN(),this.Me=en.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Xe(),t=Xe(),n=Xe();return this.Fe.forEach(((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:Ae(38017,{changeType:l})}})),new hh(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=zN()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ke(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class b4{constructor(e){this.Ge=e,this.ze=new Map,this.je=Es(),this.Je=Ff(),this.He=Ff(),this.Ye=new Ft(qe)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Ae(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,a)=>{this.rt(a)&&t(a)}))}st(e){const t=e.targetId,n=e.Ce.count,a=this.ot(t);if(a){const l=a.target;if(Am(l))if(n===0){const u=new Ne(l.path);this.et(t,u,Ut.newNoDocument(u,Me.min()))}else ke(n===1,20013,{expectedCount:n});else{const u=this._t(t);if(u!==n){const h=this.ut(e),m=h?this.ct(h,e,u):1;if(m!==0){this.it(t);const p=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}Ex?.lt((function(x,w,b,E,C){const k={localCacheCount:x,existenceFilterCount:w.count,databaseId:b.database,projectId:b.projectId},L=w.unchangedNames;return L&&(k.bloomFilter={applied:C===0,hashCount:L?.hashCount??0,bitmapLength:L?.bits?.bitmap?.length??0,padding:L?.bits?.padding??0,mightContain:U=>E?.mightContain(U)??!1}),k})(u,e.Ce,this.Ge.ht(),h,m))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:l=0}=t;let u,h;try{u=$a(n).toUint8Array()}catch(m){if(m instanceof LS)return Ws("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{h=new _v(u,a,l)}catch(m){return Ws(m instanceof _d?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return h.ge===0?null:h}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let a=0;return n.forEach((l=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(h)||(this.et(t,l,null),a++)})),a}Tt(e){const t=new Map;this.ze.forEach(((l,u)=>{const h=this.ot(u);if(h){if(l.current&&Am(h.target)){const m=new Ne(h.target.path);this.It(m).has(u)||this.Et(u,m)||this.et(u,m,Ut.newNoDocument(m,e))}l.Be&&(t.set(u,l.ke()),l.qe())}}));let n=Xe();this.He.forEach(((l,u)=>{let h=!0;u.forEachWhile((m=>{const p=this.ot(m);return!p||p.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(n=n.add(l))})),this.je.forEach(((l,u)=>u.setReadTime(e)));const a=new dh(e,t,this.Ye,this.je,n);return this.je=Es(),this.Je=Ff(),this.He=Ff(),this.Ye=new Ft(qe),a}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,t)?a.Qe(t,1):a.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new qN,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new jt(qe),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new jt(qe),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ge("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new qN),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ff(){return new Ft(Ne.comparator)}function zN(){return new Ft(Ne.comparator)}const w4={asc:"ASCENDING",desc:"DESCENDING"},_4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},N4={and:"AND",or:"OR"};class T4{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Sx(s,e){return s.useProto3Json||ah(e)?e:{value:e}}function Uc(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function NA(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function E4(s,e){return Uc(s,e.toTimestamp())}function fn(s){return ke(!!s,49232),Me.fromTimestamp((function(t){const n=Ga(t);return new wt(n.seconds,n.nanos)})(s))}function Nv(s,e){return Ax(s,e).canonicalString()}function Ax(s,e){const t=(function(a){return new tt(["projects",a.projectId,"databases",a.database])})(s).child("documents");return e===void 0?t:t.child(e)}function TA(s){const e=tt.fromString(s);return ke(DA(e),10190,{key:e.toString()}),e}function Xd(s,e){return Nv(s.databaseId,e.path)}function ca(s,e){const t=TA(e);if(t.get(1)!==s.databaseId.projectId)throw new he(se.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new he(se.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new Ne(AA(t))}function EA(s,e){return Nv(s.databaseId,e)}function SA(s){const e=TA(s);return e.length===4?tt.emptyPath():AA(e)}function jx(s){return new tt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function AA(s){return ke(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function HN(s,e,t){return{name:Xd(s,e),fields:t.value.mapValue.fields}}function ug(s,e,t){const n=ca(s,e.name),a=fn(e.updateTime),l=e.createTime?fn(e.createTime):Me.min(),u=new Zn({mapValue:{fields:e.fields}}),h=Ut.newFoundDocument(n,a,l,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function S4(s,e){return"found"in e?(function(n,a){ke(!!a.found,43571),a.found.name,a.found.updateTime;const l=ca(n,a.found.name),u=fn(a.found.updateTime),h=a.found.createTime?fn(a.found.createTime):Me.min(),m=new Zn({mapValue:{fields:a.found.fields}});return Ut.newFoundDocument(l,u,h,m)})(s,e):"missing"in e?(function(n,a){ke(!!a.missing,3894),ke(!!a.readTime,22933);const l=ca(n,a.missing),u=fn(a.readTime);return Ut.newNoDocument(l,u)})(s,e):Ae(7234,{result:e})}function A4(s,e){let t;if("targetChange"in e){e.targetChange;const n=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:Ae(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=(function(p,x){return p.useProto3Json?(ke(x===void 0||typeof x=="string",58123),en.fromBase64String(x||"")):(ke(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),en.fromUint8Array(x||new Uint8Array))})(s,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(p){const x=p.code===void 0?se.UNKNOWN:vA(p.code);return new he(x,p.message||"")})(u);t=new _A(n,a,l,h||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=ca(s,n.document.name),l=fn(n.document.updateTime),u=n.document.createTime?fn(n.document.createTime):Me.min(),h=new Zn({mapValue:{fields:n.document.fields}}),m=Ut.newFoundDocument(a,l,u,h),p=n.targetIds||[],x=n.removedTargetIds||[];t=new im(p,x,m.key,m)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=ca(s,n.document),l=n.readTime?fn(n.readTime):Me.min(),u=Ut.newNoDocument(a,l),h=n.removedTargetIds||[];t=new im([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=ca(s,n.document),l=n.removedTargetIds||[];t=new im([],l,a,null)}else{if(!("filter"in e))return Ae(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:l}=n,u=new x4(a,l),h=n.targetId;t=new wA(h,u)}}return t}function Wd(s,e){let t;if(e instanceof eu)t={update:HN(s,e.key,e.value)};else if(e instanceof tu)t={delete:Xd(s,e.key)};else if(e instanceof Xa)t={update:HN(s,e.key,e.data),updateMask:D4(e.fieldMask)};else{if(!(e instanceof xv))return Ae(16599,{Vt:e.type});t={verify:Xd(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(l,u){const h=u.transform;if(h instanceof Lc)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof nl)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof sl)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Fc)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw Ae(20930,{transform:u.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(a,l){return l.updateTime!==void 0?{updateTime:E4(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Ae(27497)})(s,e.precondition)),t}function Ix(s,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?Kt.updateTime(fn(l.updateTime)):l.exists!==void 0?Kt.exists(l.exists):Kt.none()})(e.currentDocument):Kt.none(),n=e.updateTransforms?e.updateTransforms.map((a=>(function(u,h){let m=null;if("setToServerValue"in h)ke(h.setToServerValue==="REQUEST_TIME",16630,{proto:h}),m=new Lc;else if("appendMissingElements"in h){const x=h.appendMissingElements.values||[];m=new nl(x)}else if("removeAllFromArray"in h){const x=h.removeAllFromArray.values||[];m=new sl(x)}else"increment"in h?m=new Fc(u,h.increment):Ae(16584,{proto:h});const p=Bt.fromServerFormat(h.fieldPath);return new uh(p,m)})(s,a))):[];if(e.update){e.update.name;const a=ca(s,e.update.name),l=new Zn({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=(function(m){const p=m.fieldPaths||[];return new Ts(p.map((x=>Bt.fromServerFormat(x))))})(e.updateMask);return new Xa(a,l,u,t,n)}return new eu(a,l,t,n)}if(e.delete){const a=ca(s,e.delete);return new tu(a,t)}if(e.verify){const a=ca(s,e.verify);return new xv(a,t)}return Ae(1463,{proto:e})}function j4(s,e){return s&&s.length>0?(ke(e!==void 0,14353),s.map((t=>(function(a,l){let u=a.updateTime?fn(a.updateTime):fn(l);return u.isEqual(Me.min())&&(u=fn(l)),new g4(u,a.transformResults||[])})(t,e)))):[]}function jA(s,e){return{documents:[EA(s,e.path)]}}function dg(s,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=EA(s,a);const l=(function(p){if(p.length!==0)return kA(St.create(p,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const u=(function(p){if(p.length!==0)return p.map((x=>(function(b){return{field:Di(b.field),direction:C4(b.dir)}})(x)))})(e.orderBy);u&&(t.structuredQuery.orderBy=u);const h=Sx(s,e.limit);return h!==null&&(t.structuredQuery.limit=h),e.startAt&&(t.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:t,parent:a}}function IA(s,e,t,n){const{ft:a,parent:l}=dg(s,e),u={},h=[];let m=0;return t.forEach((p=>{const x=n?p.alias:"aggregate_"+m++;u[x]=p.alias,p.aggregateType==="count"?h.push({alias:x,count:{}}):p.aggregateType==="avg"?h.push({alias:x,avg:{field:Di(p.fieldPath)}}):p.aggregateType==="sum"&&h.push({alias:x,sum:{field:Di(p.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:a.structuredQuery},parent:a.parent},gt:u,parent:l}}function CA(s){let e=SA(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){ke(n===1,65062);const x=t.from[0];x.allDescendants?a=x.collectionId:e=e.child(x.collectionId)}let l=[];t.where&&(l=(function(w){const b=RA(w);return b instanceof St&&mv(b)?b.getFilters():[b]})(t.where));let u=[];t.orderBy&&(u=(function(w){return w.map((b=>(function(C){return new Yd(pc(C.field),(function(L){switch(L){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(b)))})(t.orderBy));let h=null;t.limit&&(h=(function(w){let b;return b=typeof w=="object"?w.value:w,ah(b)?null:b})(t.limit));let m=null;t.startAt&&(m=(function(w){const b=!!w.before,E=w.values||[];return new Yi(E,b)})(t.startAt));let p=null;return t.endAt&&(p=(function(w){const b=!w.before,E=w.values||[];return new Yi(E,b)})(t.endAt)),eA(e,a,u,l,h,"F",m,p)}function I4(s,e){const t=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ae(28987,{purpose:a})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function RA(s){return s.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=pc(t.unaryFilter.field);return ot.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=pc(t.unaryFilter.field);return ot.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=pc(t.unaryFilter.field);return ot.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=pc(t.unaryFilter.field);return ot.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ae(61313);default:return Ae(60726)}})(s):s.fieldFilter!==void 0?(function(t){return ot.create(pc(t.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ae(58110);default:return Ae(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(s):s.compositeFilter!==void 0?(function(t){return St.create(t.compositeFilter.filters.map((n=>RA(n))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ae(1026)}})(t.compositeFilter.op))})(s):Ae(30097,{filter:s})}function C4(s){return w4[s]}function R4(s){return _4[s]}function k4(s){return N4[s]}function Di(s){return{fieldPath:s.canonicalString()}}function pc(s){return Bt.fromServerFormat(s.fieldPath)}function kA(s){return s instanceof ot?(function(t){if(t.op==="=="){if(jN(t.value))return{unaryFilter:{field:Di(t.field),op:"IS_NAN"}};if(AN(t.value))return{unaryFilter:{field:Di(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(jN(t.value))return{unaryFilter:{field:Di(t.field),op:"IS_NOT_NAN"}};if(AN(t.value))return{unaryFilter:{field:Di(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Di(t.field),op:R4(t.op),value:t.value}}})(s):s instanceof St?(function(t){const n=t.getFilters().map((a=>kA(a)));return n.length===1?n[0]:{compositeFilter:{op:k4(t.op),filters:n}}})(s):Ae(54877,{filter:s})}function D4(s){const e=[];return s.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function DA(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,t,n,a,l=Me.min(),u=Me.min(),h=en.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=m}withSequenceNumber(e){return new La(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new La(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new La(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new La(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e){this.yt=e}}function P4(s,e){let t;if(e.document)t=ug(s.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=Ne.fromSegments(e.noDocument.path),a=al(e.noDocument.readTime);t=Ut.newNoDocument(n,a),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ae(56709);{const n=Ne.fromSegments(e.unknownDocument.path),a=al(e.unknownDocument.version);t=Ut.newUnknownDocument(n,a)}}return e.readTime&&t.setReadTime((function(a){const l=new wt(a[0],a[1]);return Me.fromTimestamp(l)})(e.readTime)),t}function GN(s,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Cm(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(l,u){return{name:Xd(l,u.key),fields:u.data.value.mapValue.fields,updateTime:Uc(l,u.version.toTimestamp()),createTime:Uc(l,u.createTime.toTimestamp())}})(s.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:rl(e.version)};else{if(!e.isUnknownDocument())return Ae(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:rl(e.version)}}return n}function Cm(s){const e=s.toTimestamp();return[e.seconds,e.nanoseconds]}function rl(s){const e=s.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function al(s){const e=new wt(s.seconds,s.nanoseconds);return Me.fromTimestamp(e)}function qo(s,e){const t=(e.baseMutations||[]).map((l=>Ix(s.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const u=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const h=e.mutations[l+1];u.updateTransforms=h.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const n=e.mutations.map((l=>Ix(s.yt,l))),a=wt.fromMillis(e.localWriteTimeMs);return new vv(e.batchId,a,t,n)}function Nd(s){const e=al(s.readTime),t=s.lastLimboFreeSnapshotVersion!==void 0?al(s.lastLimboFreeSnapshotVersion):Me.min();let n;return n=(function(l){return l.documents!==void 0})(s.query)?(function(l){const u=l.documents.length;return ke(u===1,1966,{count:u}),cs(Zc(SA(l.documents[0])))})(s.query):(function(l){return cs(CA(l))})(s.query),new La(n,s.targetId,"TargetPurposeListen",s.lastListenSequenceNumber,e,t,en.fromBase64String(s.resumeToken))}function MA(s,e){const t=rl(e.snapshotVersion),n=rl(e.lastLimboFreeSnapshotVersion);let a;a=Am(e.target)?jA(s.yt,e.target):dg(s.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:tl(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:a}}function hg(s){const e=CA({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Im(e,e.limit,"L"):e}function Fy(s,e){return new wv(e.largestBatchId,Ix(s.yt,e.overlayMutation))}function $N(s,e){const t=e.path.lastSegment();return[s,ls(e.path.popLast()),t]}function KN(s,e,t,n){return{indexId:s,uid:e,sequenceNumber:t,readTime:rl(n.readTime),documentKey:ls(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4{getBundleMetadata(e,t){return QN(e).get(t).next((n=>{if(n)return(function(l){return{id:l.bundleId,createTime:al(l.createTime),version:l.version}})(n)}))}saveBundleMetadata(e,t){return QN(e).put((function(a){return{bundleId:a.id,createTime:rl(fn(a.createTime)),version:a.version}})(t))}getNamedQuery(e,t){return YN(e).get(t).next((n=>{if(n)return(function(l){return{name:l.name,query:hg(l.bundledQuery),readTime:al(l.readTime)}})(n)}))}saveNamedQuery(e,t){return YN(e).put((function(a){return{name:a.name,readTime:rl(fn(a.readTime)),bundledQuery:a.bundledQuery}})(t))}}function QN(s){return Cn(s,ng)}function YN(s){return Cn(s,sg)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new fg(e,n)}getOverlay(e,t){return ud(e).get($N(this.userId,t)).next((n=>n?Fy(this.serializer,n):null))}getOverlays(e,t){const n=ia();return W.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&n.set(a,l)})))).next((()=>n))}saveOverlays(e,t,n){const a=[];return n.forEach(((l,u)=>{const h=new wv(t,u);a.push(this.St(e,h))})),W.waitFor(a)}removeOverlaysForBatchId(e,t,n){const a=new Set;t.forEach((u=>a.add(ls(u.getCollectionPath()))));const l=[];return a.forEach((u=>{const h=IDBKeyRange.bound([this.userId,u,n],[this.userId,u,n+1],!1,!0);l.push(ud(e).Z(yx,h))})),W.waitFor(l)}getOverlaysForCollection(e,t,n){const a=ia(),l=ls(t),u=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,Number.POSITIVE_INFINITY],!0);return ud(e).J(yx,u).next((h=>{for(const m of h){const p=Fy(this.serializer,m);a.set(p.getKey(),p)}return a}))}getOverlaysForCollectionGroup(e,t,n,a){const l=ia();let u;const h=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ud(e).ee({index:RS,range:h},((m,p,x)=>{const w=Fy(this.serializer,p);l.size()<a||w.largestBatchId===u?(l.set(w.getKey(),w),u=w.largestBatchId):x.done()})).next((()=>l))}St(e,t){return ud(e).put((function(a,l,u){const[h,m,p]=$N(l,u.mutation.key);return{userId:l,collectionPath:m,documentId:p,collectionGroup:u.mutation.key.getCollectionGroup(),largestBatchId:u.largestBatchId,overlayMutation:Wd(a.yt,u.mutation)}})(this.serializer,this.userId,t))}}function ud(s){return Cn(s,rg)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{bt(e){return Cn(e,uv)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const n=t?.value;return n?en.fromUint8Array(n):en.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Gt(e.integerValue));else if("doubleValue"in e){const n=Gt(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Bd(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=Ga(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt($a(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?HS(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):og(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Ae(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const a of Object.keys(n))this.Ot(a,t),this.Ct(n[a],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const a=Mc,l=n[a].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Gt(l)),this.Ot(a,t),this.Ct(n[a],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const a of n)this.Ct(a,t)}Lt(e,t){this.Ft(t,37),Ne.fromName(e).path.forEach((n=>{this.Ft(t,60),this.Ut(n,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}zo.Kt=new zo;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lc=255;function V4(s){if(s===0)return 8;let e=0;return s>>4||(e+=4,s<<=4),s>>6||(e+=2,s<<=2),s>>7||(e+=1),e}function XN(s){const e=64-(function(n){let a=0;for(let l=0;l<8;++l){const u=V4(255&n[l]);if(a+=u,u!==8)break}return a})(s);return Math.ceil(e/8)}class L4{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const a=t.codePointAt(0);this.Gt(240|a>>>18),this.Gt(128|63&a>>>12),this.Gt(128|63&a>>>6),this.Gt(128|63&a)}}this.zt()}Zt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const a=t.codePointAt(0);this.Jt(240|a>>>18),this.Jt(128|63&a>>>12),this.Jt(128|63&a>>>6),this.Jt(128|63&a)}}this.Ht()}Xt(e){const t=this.en(e),n=XN(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let a=t.length-n;a<t.length;++a)this.buffer[this.position++]=255&t[a]}nn(e){const t=this.en(e),n=XN(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let a=t.length-n;a<t.length;++a)this.buffer[this.position++]=~(255&t[a])}rn(){this.sn(lc),this.sn(255)}_n(){this.an(lc),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const u=new DataView(new ArrayBuffer(8));return u.setFloat64(0,l,!1),new Uint8Array(u.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let a=1;a<t.length;++a)t[a]^=n?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===lc?(this.sn(lc),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===lc?(this.an(lc),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const a=new Uint8Array(n);a.set(this.buffer),this.buffer=a}}class F4{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class U4{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class dd{constructor(){this.cn=new L4,this.ln=new F4(this.cn),this.hn=new U4(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,t,n,a){this.Tn=e,this.In=t,this.En=n,this.dn=a}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new Ho(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:om(this.En),directionalValue:om(this.dn),orderedDocumentKey:om(t),documentKey:n.path.toArray()}}Vn(e,t,n){const a=this.Rn(e,t,n);return[a.indexId,a.uid,a.arrayValue,a.directionalValue,a.orderedDocumentKey,a.documentKey]}}function Si(s,e){let t=s.Tn-e.Tn;return t!==0?t:(t=WN(s.En,e.En),t!==0?t:(t=WN(s.dn,e.dn),t!==0?t:Ne.comparator(s.In,e.In)))}function WN(s,e){for(let t=0;t<s.length&&t<e.length;++t){const n=s[t]-e[t];if(n!==0)return n}return s.length-e.length}function om(s){return vE()?(function(t){let n="";for(let a=0;a<t.length;a++)n+=String.fromCharCode(t[a]);return n})(s):s}function JN(s){return typeof s!="string"?s:(function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n})(s)}class ZN{constructor(e){this.mn=new jt(((t,n)=>Bt.comparator(t.field,n.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(ke(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=mx(e);if(t!==void 0&&!this.wn(t))return!1;const n=Fo(e);let a=new Set,l=0,u=0;for(;l<n.length&&this.wn(n[l]);++l)a=a.add(n[l].fieldPath.canonicalString());if(l===n.length)return!0;if(this.mn.size>0){const h=this.mn.getIterator().getNext();if(!a.has(h.field.canonicalString())){const m=n[l];if(!this.Sn(h,m)||!this.bn(this.fn[u++],m))return!1}++l}for(;l<n.length;++l){const h=n[l];if(u>=this.fn.length||!this.bn(this.fn[u++],h))return!1}return!0}Dn(){if(this.pn)return null;let e=new jt(Bt.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Qo(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Qo(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Qo(n.field,n.dir==="asc"?0:1)));return new Ic(Ic.UNKNOWN_ID,this.collectionId,t,Cc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OA(s){if(ke(s instanceof ot||s instanceof St,20012),s instanceof ot){if(s instanceof ZS){const t=s.value.arrayValue?.values?.map((n=>ot.create(s.field,"==",n)))||[];return St.create(t,"or")}return s}const e=s.filters.map((t=>OA(t)));return St.create(e,s.op)}function B4(s){if(s.getFilters().length===0)return[];const e=kx(OA(s));return ke(VA(e),7391),Cx(e)||Rx(e)?[e]:e.getFilters()}function Cx(s){return s instanceof ot}function Rx(s){return s instanceof St&&mv(s)}function VA(s){return Cx(s)||Rx(s)||(function(t){if(t instanceof St&&wx(t)){for(const n of t.getFilters())if(!Cx(n)&&!Rx(n))return!1;return!0}return!1})(s)}function kx(s){if(ke(s instanceof ot||s instanceof St,34018),s instanceof ot)return s;if(s.filters.length===1)return kx(s.filters[0]);const e=s.filters.map((n=>kx(n)));let t=St.create(e,s.op);return t=Rm(t),VA(t)?t:(ke(t instanceof St,64498),ke(Vc(t),40251),ke(t.filters.length>1,57927),t.filters.reduce(((n,a)=>Tv(n,a))))}function Tv(s,e){let t;return ke(s instanceof ot||s instanceof St,38388),ke(e instanceof ot||e instanceof St,25473),t=s instanceof ot?e instanceof ot?(function(a,l){return St.create([a,l],"and")})(s,e):eT(s,e):e instanceof ot?eT(e,s):(function(a,l){if(ke(a.filters.length>0&&l.filters.length>0,48005),Vc(a)&&Vc(l))return XS(a,l.getFilters());const u=wx(a)?a:l,h=wx(a)?l:a,m=u.filters.map((p=>Tv(p,h)));return St.create(m,"or")})(s,e),Rm(t)}function eT(s,e){if(Vc(e))return XS(e,s.getFilters());{const t=e.filters.map((n=>Tv(s,n)));return St.create(t,"or")}}function Rm(s){if(ke(s instanceof ot||s instanceof St,11850),s instanceof ot)return s;const e=s.getFilters();if(e.length===1)return Rm(e[0]);if(QS(s))return s;const t=e.map((a=>Rm(a))),n=[];return t.forEach((a=>{a instanceof ot?n.push(a):a instanceof St&&(a.op===s.op?n.push(...a.filters):n.push(a))})),n.length===1?n[0]:St.create(n,s.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q4{constructor(){this.Cn=new Ev}addToCollectionParentIndex(e,t){return this.Cn.add(t),W.resolve()}getCollectionParents(e,t){return W.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return W.resolve()}deleteFieldIndex(e,t){return W.resolve()}deleteAllFieldIndexes(e){return W.resolve()}createTargetIndexes(e,t){return W.resolve()}getDocumentsMatchingTarget(e,t){return W.resolve(null)}getIndexType(e,t){return W.resolve(0)}getFieldIndexes(e,t){return W.resolve([])}getNextCollectionGroupToUpdate(e){return W.resolve(null)}getMinOffset(e,t){return W.resolve(Js.min())}getMinOffsetFromCollectionGroup(e,t){return W.resolve(Js.min())}updateCollectionGroup(e,t,n){return W.resolve()}updateIndexEntries(e,t){return W.resolve()}}class Ev{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new jt(tt.comparator),l=!a.has(n);return this.index[t]=a.add(n),l}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new jt(tt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="IndexedDbIndexManager",Uf=new Uint8Array(0);class z4{constructor(e,t){this.databaseId=t,this.vn=new Ev,this.Fn=new Ya((n=>tl(n)),((n,a)=>oh(n,a))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),a=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:n,parent:ls(a)};return nT(e).put(l)}return W.resolve()}getCollectionParents(e,t){const n=[],a=IDBKeyRange.bound([t,""],[pS(t),""],!1,!0);return nT(e).J(a).next((l=>{for(const u of l){if(u.collectionId!==t)break;n.push(aa(u.parent))}return n}))}addFieldIndex(e,t){const n=hd(e),a=(function(h){return{indexId:h.indexId,collectionGroup:h.collectionGroup,fields:h.fields.map((m=>[m.fieldPath.canonicalString(),m.kind]))}})(t);delete a.indexId;const l=n.add(a);if(t.indexState){const u=uc(e);return l.next((h=>{u.put(KN(h,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const n=hd(e),a=uc(e),l=cc(e);return n.delete(t.indexId).next((()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=hd(e),n=cc(e),a=uc(e);return t.Z().next((()=>n.Z())).next((()=>a.Z()))}createTargetIndexes(e,t){return W.forEach(this.Mn(t),(n=>this.getIndexType(e,n).next((a=>{if(a===0||a===1){const l=new ZN(n).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const n=cc(e);let a=!0;const l=new Map;return W.forEach(this.Mn(t),(u=>this.xn(e,u).next((h=>{a&&(a=!!h),l.set(u,h)})))).next((()=>{if(a){let u=Xe();const h=[];return W.forEach(l,((m,p)=>{ge(tT,`Using index ${(function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map((H=>`${H.fieldPath}:${H.kind}`)).join(",")}`})(m)} to execute ${tl(t)}`);const x=(function(B,H){const $=mx(H);if($===void 0)return null;for(const M of jm(B,$.fieldPath))switch(M.op){case"array-contains-any":return M.value.arrayValue.values||[];case"array-contains":return[M.value]}return null})(p,m),w=(function(B,H){const $=new Map;for(const M of Fo(H))for(const R of jm(B,M.fieldPath))switch(R.op){case"==":case"in":$.set(M.fieldPath.canonicalString(),R.value);break;case"not-in":case"!=":return $.set(M.fieldPath.canonicalString(),R.value),Array.from($.values())}return null})(p,m),b=(function(B,H){const $=[];let M=!0;for(const R of Fo(H)){const N=R.kind===0?DN(B,R.fieldPath,B.startAt):PN(B,R.fieldPath,B.startAt);$.push(N.value),M&&(M=N.inclusive)}return new Yi($,M)})(p,m),E=(function(B,H){const $=[];let M=!0;for(const R of Fo(H)){const N=R.kind===0?PN(B,R.fieldPath,B.endAt):DN(B,R.fieldPath,B.endAt);$.push(N.value),M&&(M=N.inclusive)}return new Yi($,M)})(p,m),C=this.On(m,p,b),k=this.On(m,p,E),L=this.Nn(m,p,w),U=this.Bn(m.indexId,x,C,b.inclusive,k,E.inclusive,L);return W.forEach(U,(F=>n.Y(F,t.limit).next((B=>{B.forEach((H=>{const $=Ne.fromSegments(H.documentKey);u.has($)||(u=u.add($),h.push($))}))}))))})).next((()=>h))}return W.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=B4(St.create(e.filters,"and")).map((n=>Nx(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,n,a,l,u,h){const m=(t!=null?t.length:1)*Math.max(n.length,l.length),p=m/(t!=null?t.length:1),x=[];for(let w=0;w<m;++w){const b=t?this.Ln(t[w/p]):Uf,E=this.kn(e,b,n[w%p],a),C=this.qn(e,b,l[w%p],u),k=h.map((L=>this.kn(e,b,L,!0)));x.push(...this.createRange(E,C,k))}return x}kn(e,t,n,a){const l=new Ho(e,Ne.empty(),t,n);return a?l:l.An()}qn(e,t,n,a){const l=new Ho(e,Ne.empty(),t,n);return a?l.An():l}xn(e,t){const n=new ZN(t),a=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,a).next((l=>{let u=null;for(const h of l)n.yn(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u}))}getIndexType(e,t){let n=2;const a=this.Mn(t);return W.forEach(a,(l=>this.xn(e,l).next((u=>{u?n!==0&&u.fields.length<(function(m){let p=new jt(Bt.comparator),x=!1;for(const w of m.filters)for(const b of w.getFlattenedFilters())b.field.isKeyField()||(b.op==="array-contains"||b.op==="array-contains-any"?x=!0:p=p.add(b.field));for(const w of m.orderBy)w.field.isKeyField()||(p=p.add(w.field));return p.size+(x?1:0)})(l)&&(n=1):n=0})))).next((()=>(function(u){return u.limit!==null})(t)&&a.length>1&&n===2?1:n))}Qn(e,t){const n=new dd;for(const a of Fo(e)){const l=t.data.field(a.fieldPath);if(l==null)return null;const u=n.Pn(a.kind);zo.Kt.Dt(l,u)}return n.un()}Ln(e){const t=new dd;return zo.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new dd;return zo.Kt.Dt(el(this.databaseId,t),n.Pn((function(l){const u=Fo(l);return u.length===0?0:u[u.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let a=[];a.push(new dd);let l=0;for(const u of Fo(e)){const h=n[l++];for(const m of a)if(this.Un(t,u.fieldPath)&&Qd(h))a=this.Kn(a,u,h);else{const p=m.Pn(u.kind);zo.Kt.Dt(h,p)}}return this.Wn(a)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const a=[...e],l=[];for(const u of n.arrayValue.values||[])for(const h of a){const m=new dd;m.seed(h.un()),zo.Kt.Dt(u,m.Pn(t.kind)),l.push(m)}return l}Un(e,t){return!!e.filters.find((n=>n instanceof ot&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(e,t){const n=hd(e),a=uc(e);return(t?n.J(px,IDBKeyRange.bound(t,t)):n.J()).next((l=>{const u=[];return W.forEach(l,(h=>a.get([h.indexId,this.uid]).next((m=>{u.push((function(x,w){const b=w?new Cc(w.sequenceNumber,new Js(al(w.readTime),new Ne(aa(w.documentKey)),w.largestBatchId)):Cc.empty(),E=x.fields.map((([C,k])=>new Qo(Bt.fromServerFormat(C),k)));return new Ic(x.indexId,x.collectionGroup,E,b)})(h,m))})))).next((()=>u))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((n,a)=>{const l=n.indexState.sequenceNumber-a.indexState.sequenceNumber;return l!==0?l:qe(n.collectionGroup,a.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,n){const a=hd(e),l=uc(e);return this.Gn(e).next((u=>a.J(px,IDBKeyRange.bound(t,t)).next((h=>W.forEach(h,(m=>l.put(KN(m.indexId,this.uid,u,n))))))))}updateIndexEntries(e,t){const n=new Map;return W.forEach(t,((a,l)=>{const u=n.get(a.collectionGroup);return(u?W.resolve(u):this.getFieldIndexes(e,a.collectionGroup)).next((h=>(n.set(a.collectionGroup,h),W.forEach(h,(m=>this.zn(e,a,m).next((p=>{const x=this.jn(l,m);return p.isEqual(x)?W.resolve():this.Jn(e,l,m,p,x)})))))))}))}Hn(e,t,n,a){return cc(e).put(a.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,a){return cc(e).delete(a.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const a=cc(e);let l=new jt(Si);return a.ee({index:CS,range:IDBKeyRange.only([n.indexId,this.uid,om(this.$n(n,t))])},((u,h)=>{l=l.add(new Ho(n.indexId,t,JN(h.arrayValue),JN(h.directionalValue)))})).next((()=>l))}jn(e,t){let n=new jt(Si);const a=this.Qn(t,e);if(a==null)return n;const l=mx(t);if(l!=null){const u=e.data.field(l.fieldPath);if(Qd(u))for(const h of u.arrayValue.values||[])n=n.add(new Ho(t.indexId,e.key,this.Ln(h),a))}else n=n.add(new Ho(t.indexId,e.key,Uf,a));return n}Jn(e,t,n,a,l){ge(tT,"Updating index entries for document '%s'",t.key);const u=[];return(function(m,p,x,w,b){const E=m.getIterator(),C=p.getIterator();let k=oc(E),L=oc(C);for(;k||L;){let U=!1,F=!1;if(k&&L){const B=x(k,L);B<0?F=!0:B>0&&(U=!0)}else k!=null?F=!0:U=!0;U?(w(L),L=oc(C)):F?(b(k),k=oc(E)):(k=oc(E),L=oc(C))}})(a,l,Si,(h=>{u.push(this.Hn(e,t,n,h))}),(h=>{u.push(this.Yn(e,t,n,h))})),W.waitFor(u)}Gn(e){let t=1;return uc(e).ee({index:IS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,a,l)=>{l.done(),t=a.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((u,h)=>Si(u,h))).filter(((u,h,m)=>!h||Si(u,m[h-1])!==0));const a=[];a.push(e);for(const u of n){const h=Si(u,e),m=Si(u,t);if(h===0)a[0]=e.An();else if(h>0&&m<0)a.push(u),a.push(u.An());else if(m>0)break}a.push(t);const l=[];for(let u=0;u<a.length;u+=2){if(this.Zn(a[u],a[u+1]))return[];const h=a[u].Vn(this.uid,Uf,Ne.empty()),m=a[u+1].Vn(this.uid,Uf,Ne.empty());l.push(IDBKeyRange.bound(h,m))}return l}Zn(e,t){return Si(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sT)}getMinOffset(e,t){return W.mapArray(this.Mn(t),(n=>this.xn(e,n).next((a=>a||Ae(44426))))).next(sT)}}function nT(s){return Cn(s,Hd)}function cc(s){return Cn(s,Cd)}function hd(s){return Cn(s,cv)}function uc(s){return Cn(s,Id)}function sT(s){ke(s.length!==0,28825);let e=s[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<s.length;n++){const a=s[n].indexState.offset;iv(a,e)<0&&(e=a),t<a.largestBatchId&&(t=a.largestBatchId)}return new Js(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},LA=41943040;class as{static withCacheSize(e){return new as(e,as.DEFAULT_COLLECTION_PERCENTILE,as.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FA(s,e,t){const n=s.store(kr),a=s.store(Rc),l=[],u=IDBKeyRange.only(t.batchId);let h=0;const m=n.ee({range:u},((x,w,b)=>(h++,b.delete())));l.push(m.next((()=>{ke(h===1,47070,{batchId:t.batchId})})));const p=[];for(const x of t.mutations){const w=SS(e,x.key.path,t.batchId);l.push(a.delete(w)),p.push(x.key)}return W.waitFor(l).next((()=>p))}function km(s){if(!s)return 0;let e;if(s.document)e=s.document;else if(s.unknownDocument)e=s.unknownDocument;else{if(!s.noDocument)throw Ae(14731);e=s.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */as.DEFAULT_COLLECTION_PERCENTILE=10,as.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,as.DEFAULT=new as(LA,as.DEFAULT_COLLECTION_PERCENTILE,as.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),as.DISABLED=new as(-1,0,0);class mg{constructor(e,t,n,a){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=a,this.Xn={}}static wt(e,t,n,a){ke(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new mg(l,t,n,a)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ai(e).ee({index:$o,range:n},((a,l,u)=>{t=!1,u.done()})).next((()=>t))}addMutationBatch(e,t,n,a){const l=yc(e),u=Ai(e);return u.add({}).next((h=>{ke(typeof h=="number",49019);const m=new vv(h,t,n,a),p=(function(E,C,k){const L=k.baseMutations.map((F=>Wd(E.yt,F))),U=k.mutations.map((F=>Wd(E.yt,F)));return{userId:C,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:L,mutations:U}})(this.serializer,this.userId,m),x=[];let w=new jt(((b,E)=>qe(b.canonicalString(),E.canonicalString())));for(const b of a){const E=SS(this.userId,b.key.path,h);w=w.add(b.key.path.popLast()),x.push(u.put(p)),x.push(l.put(E,TD))}return w.forEach((b=>{x.push(this.indexManager.addToCollectionParentIndex(e,b))})),e.addOnCommittedListener((()=>{this.Xn[h]=m.keys()})),W.waitFor(x).next((()=>m))}))}lookupMutationBatch(e,t){return Ai(e).get(t).next((n=>n?(ke(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),qo(this.serializer,n)):null))}er(e,t){return this.Xn[t]?W.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((n=>{if(n){const a=n.keys();return this.Xn[t]=a,a}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=IDBKeyRange.lowerBound([this.userId,n]);let l=null;return Ai(e).ee({index:$o,range:a},((u,h,m)=>{h.userId===this.userId&&(ke(h.batchId>=n,47524,{tr:n}),l=qo(this.serializer,h)),m.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Hi;return Ai(e).ee({index:$o,range:t,reverse:!0},((a,l,u)=>{n=l.batchId,u.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Hi],[this.userId,Number.POSITIVE_INFINITY]);return Ai(e).J($o,t).next((n=>n.map((a=>qo(this.serializer,a)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=em(this.userId,t.path),a=IDBKeyRange.lowerBound(n),l=[];return yc(e).ee({range:a},((u,h,m)=>{const[p,x,w]=u,b=aa(x);if(p===this.userId&&t.path.isEqual(b))return Ai(e).get(w).next((E=>{if(!E)throw Ae(61480,{nr:u,batchId:w});ke(E.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:E.userId,batchId:w}),l.push(qo(this.serializer,E))}));m.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new jt(qe);const a=[];return t.forEach((l=>{const u=em(this.userId,l.path),h=IDBKeyRange.lowerBound(u),m=yc(e).ee({range:h},((p,x,w)=>{const[b,E,C]=p,k=aa(E);b===this.userId&&l.path.isEqual(k)?n=n.add(C):w.done()}));a.push(m)})),W.waitFor(a).next((()=>this.rr(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1,l=em(this.userId,n),u=IDBKeyRange.lowerBound(l);let h=new jt(qe);return yc(e).ee({range:u},((m,p,x)=>{const[w,b,E]=m,C=aa(b);w===this.userId&&n.isPrefixOf(C)?C.length===a&&(h=h.add(E)):x.done()})).next((()=>this.rr(e,h)))}rr(e,t){const n=[],a=[];return t.forEach((l=>{a.push(Ai(e).get(l).next((u=>{if(u===null)throw Ae(35274,{batchId:l});ke(u.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:u.userId,batchId:l}),n.push(qo(this.serializer,u))})))})),W.waitFor(a).next((()=>n))}removeMutationBatch(e,t){return FA(e.le,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),W.forEach(n,(a=>this.referenceDelegate.markPotentiallyOrphaned(e,a))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return W.resolve();const n=IDBKeyRange.lowerBound((function(u){return[u]})(this.userId)),a=[];return yc(e).ee({range:n},((l,u,h)=>{if(l[0]===this.userId){const m=aa(l[1]);a.push(m)}else h.done()})).next((()=>{ke(a.length===0,56720,{sr:a.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return UA(e,this.userId,t)}_r(e){return BA(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Hi,lastStreamToken:""}))}}function UA(s,e,t){const n=em(e,t.path),a=n[1],l=IDBKeyRange.lowerBound(n);let u=!1;return yc(s).ee({range:l,X:!0},((h,m,p)=>{const[x,w,b]=h;x===e&&w===a&&(u=!0),p.done()})).next((()=>u))}function Ai(s){return Cn(s,kr)}function yc(s){return Cn(s,Rc)}function BA(s){return Cn(s,qd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new il(0)}static cr(){return new il(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const n=new il(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>Me.fromTimestamp(new wt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.lr(e).next((a=>(a.highestListenSequenceNumber=t,n&&(a.lastRemoteSnapshotVersion=n.toTimestamp()),t>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=t),this.hr(e,a))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>dc(e).delete(t.targetId))).next((()=>this.lr(e))).next((n=>(ke(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n))))}removeTargets(e,t,n){let a=0;const l=[];return dc(e).ee(((u,h)=>{const m=Nd(h);m.sequenceNumber<=t&&n.get(m.targetId)===null&&(a++,l.push(this.removeTargetData(e,m)))})).next((()=>W.waitFor(l))).next((()=>a))}forEachTarget(e,t){return dc(e).ee(((n,a)=>{const l=Nd(a);t(l)}))}lr(e){return aT(e).get(Sm).next((t=>(ke(t!==null,2888),t)))}hr(e,t){return aT(e).put(Sm,t)}Pr(e,t){return dc(e).put(MA(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const n=tl(t),a=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let l=null;return dc(e).ee({range:a,index:jS},((u,h,m)=>{const p=Nd(h);oh(t,p.target)&&(l=p,m.done())})).next((()=>l))}addMatchingKeys(e,t,n){const a=[],l=Pi(e);return t.forEach((u=>{const h=ls(u.path);a.push(l.put({targetId:n,path:h})),a.push(this.referenceDelegate.addReference(e,n,u))})),W.waitFor(a)}removeMatchingKeys(e,t,n){const a=Pi(e);return W.forEach(t,(l=>{const u=ls(l.path);return W.waitFor([a.delete([n,u]),this.referenceDelegate.removeReference(e,n,l)])}))}removeMatchingKeysForTargetId(e,t){const n=Pi(e),a=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(a)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),a=Pi(e);let l=Xe();return a.ee({range:n,X:!0},((u,h,m)=>{const p=aa(u[1]),x=new Ne(p);l=l.add(x)})).next((()=>l))}containsKey(e,t){const n=ls(t.path),a=IDBKeyRange.bound([n],[pS(n)],!1,!0);let l=0;return Pi(e).ee({index:lv,X:!0,range:a},(([u,h],m,p)=>{u!==0&&(l++,p.done())})).next((()=>l>0))}At(e,t){return dc(e).get(t).next((n=>n?Nd(n):null))}}function dc(s){return Cn(s,kc)}function aT(s){return Cn(s,Yo)}function Pi(s){return Cn(s,Dc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="LruGarbageCollector",qA=1048576;function oT([s,e],[t,n]){const a=qe(s,t);return a===0?qe(e,n):a}class G4{constructor(e){this.Ir=e,this.buffer=new jt(oT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();oT(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zA{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ge(iT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){eo(t)?ge(iT,"Ignoring IndexedDB error during garbage collection: ",t):await Zi(t)}await this.Vr(3e5)}))}}class $4{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return W.resolve(Ns.ce);const n=new G4(t);return this.mr.forEachTarget(e,(a=>n.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>n.Ar(a))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ge("LruGarbageCollector","Garbage collection skipped; disabled"),W.resolve(rT)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ge("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rT):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,a,l,u,h,m,p;const x=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((w=>(w>this.params.maximumSequenceNumbersToCollect?(ge("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),a=this.params.maximumSequenceNumbersToCollect):a=w,u=Date.now(),this.nthSequenceNumber(e,a)))).next((w=>(n=w,h=Date.now(),this.removeTargets(e,n,t)))).next((w=>(l=w,m=Date.now(),this.removeOrphanedDocuments(e,n)))).next((w=>(p=Date.now(),mc()<=it.DEBUG&&ge("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-x}ms
	Determined least recently used ${a} in `+(h-u)+`ms
	Removed ${l} targets in `+(m-h)+`ms
	Removed ${w} documents in `+(p-m)+`ms
Total Duration: ${p-x}ms`),W.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:w}))))}}function HA(s,e){return new $4(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(e,t){this.db=e,this.garbageCollector=HA(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((n=>t.next((a=>n+a))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((n,a)=>t(a)))}addReference(e,t,n){return Bf(e,n)}removeReference(e,t,n){return Bf(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Bf(e,t)}br(e,t){return(function(a,l){let u=!1;return BA(a).te((h=>UA(a,h,l).next((m=>(m&&(u=!0),W.resolve(!m)))))).next((()=>u))})(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[];let l=0;return this.Sr(e,((u,h)=>{if(h<=t){const m=this.br(e,u).next((p=>{if(!p)return l++,n.getEntry(e,u).next((()=>(n.removeEntry(u,Me.min()),Pi(e).delete((function(w){return[0,ls(w.path)]})(u)))))}));a.push(m)}})).next((()=>W.waitFor(a))).next((()=>n.apply(e))).next((()=>l))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Bf(e,t)}Sr(e,t){const n=Pi(e);let a,l=Ns.ce;return n.ee({index:lv},(([u,h],{path:m,sequenceNumber:p})=>{u===0?(l!==Ns.ce&&t(new Ne(aa(a)),l),l=p,a=m):l=Ns.ce})).next((()=>{l!==Ns.ce&&t(new Ne(aa(a)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Bf(s,e){return Pi(s).put((function(n,a){return{targetId:0,path:ls(n.path),sequenceNumber:a}})(e,s.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(){this.changes=new Ya((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?W.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Vo(e).put(n)}removeEntry(e,t,n){return Vo(e).delete((function(l,u){const h=l.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],Cm(u),h[h.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Dr(e,n))))}getEntry(e,t){let n=Ut.newInvalidDocument(t);return Vo(e).ee({index:tm,range:IDBKeyRange.only(fd(t))},((a,l)=>{n=this.Cr(t,l)})).next((()=>n))}vr(e,t){let n={size:0,document:Ut.newInvalidDocument(t)};return Vo(e).ee({index:tm,range:IDBKeyRange.only(fd(t))},((a,l)=>{n={document:this.Cr(t,l),size:km(l)}})).next((()=>n))}getEntries(e,t){let n=Es();return this.Fr(e,t,((a,l)=>{const u=this.Cr(a,l);n=n.insert(a,u)})).next((()=>n))}Mr(e,t){let n=Es(),a=new Ft(Ne.comparator);return this.Fr(e,t,((l,u)=>{const h=this.Cr(l,u);n=n.insert(l,h),a=a.insert(l,km(u))})).next((()=>({documents:n,Or:a})))}Fr(e,t,n){if(t.isEmpty())return W.resolve();let a=new jt(uT);t.forEach((m=>a=a.add(m)));const l=IDBKeyRange.bound(fd(a.first()),fd(a.last())),u=a.getIterator();let h=u.getNext();return Vo(e).ee({index:tm,range:l},((m,p,x)=>{const w=Ne.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;h&&uT(h,w)<0;)n(h,null),h=u.getNext();h&&h.isEqual(w)&&(n(h,p),h=u.hasNext()?u.getNext():null),h?x.j(fd(h)):x.done()})).next((()=>{for(;h;)n(h,null),h=u.hasNext()?u.getNext():null}))}getDocumentsMatchingQuery(e,t,n,a,l){const u=t.path,h=[u.popLast().toArray(),u.lastSegment(),Cm(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],m=[u.popLast().toArray(),u.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vo(e).J(IDBKeyRange.bound(h,m,!0)).next((p=>{l?.incrementDocumentReadCount(p.length);let x=Es();for(const w of p){const b=this.Cr(Ne.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);b.isFoundDocument()&&(ch(t,b)||a.has(b.key))&&(x=x.insert(b.key,b))}return x}))}getAllFromCollectionGroup(e,t,n,a){let l=Es();const u=cT(t,n),h=cT(t,Js.max());return Vo(e).ee({index:AS,range:IDBKeyRange.bound(u,h,!0)},((m,p,x)=>{const w=this.Cr(Ne.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);l=l.insert(w.key,w),l.size===a&&x.done()})).next((()=>l))}newChangeBuffer(e){return new Y4(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return lT(e).get(gx).next((t=>(ke(!!t,20021),t)))}Dr(e,t){return lT(e).put(gx,t)}Cr(e,t){if(t){const n=P4(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Me.min())))return n}return Ut.newInvalidDocument(e)}}function $A(s){return new Q4(s)}class Y4 extends GA{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Ya((n=>n.toString()),((n,a)=>n.isEqual(a)))}applyChanges(e){const t=[];let n=0,a=new jt(((l,u)=>qe(l.canonicalString(),u.canonicalString())));return this.changes.forEach(((l,u)=>{const h=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,h.readTime)),u.isValidDocument()){const m=GN(this.Nr.serializer,u);a=a.add(l.path.popLast());const p=km(m);n+=p-h.size,t.push(this.Nr.addEntry(e,l,m))}else if(n-=h.size,this.trackRemovals){const m=GN(this.Nr.serializer,u.convertToNoDocument(Me.min()));t.push(this.Nr.addEntry(e,l,m))}})),a.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,n)),W.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:n,Or:a})=>(a.forEach(((l,u)=>{this.Br.set(l,{size:u,readTime:n.get(l).readTime})})),n)))}}function lT(s){return Cn(s,zd)}function Vo(s){return Cn(s,Em)}function fd(s){const e=s.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function cT(s,e){const t=e.documentKey.path.toArray();return[s,Cm(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function uT(s,e){const t=s.path.toArray(),n=e.path.toArray();let a=0;for(let l=0;l<t.length-2&&l<n.length-2;++l)if(a=qe(t[l],n[l]),a)return a;return a=qe(t.length,n.length),a||(a=qe(t[t.length-2],n[n.length-2]),a||qe(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((a=>(n=a,this.remoteDocumentCache.getEntry(e,t)))).next((a=>(n!==null&&Dd(n.mutation,a,Ts.empty(),wt.now()),a)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,Xe()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=Xe()){const a=ia();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,n).next((l=>{let u=wd();return l.forEach(((h,m)=>{u=u.insert(h,m.overlayedDocument)})),u}))))}getOverlayedDocuments(e,t){const n=ia();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Xe())))}populateOverlays(e,t,n){const a=[];return n.forEach((l=>{t.has(l)||a.push(l)})),this.documentOverlayCache.getOverlays(e,a).next((l=>{l.forEach(((u,h)=>{t.set(u,h)}))}))}computeViews(e,t,n,a){let l=Es();const u=kd(),h=(function(){return kd()})();return t.forEach(((m,p)=>{const x=n.get(p.key);a.has(p.key)&&(x===void 0||x.mutation instanceof Xa)?l=l.insert(p.key,p):x!==void 0?(u.set(p.key,x.mutation.getFieldMask()),Dd(x.mutation,p,x.mutation.getFieldMask(),wt.now())):u.set(p.key,Ts.empty())})),this.recalculateAndSaveOverlays(e,l).next((m=>(m.forEach(((p,x)=>u.set(p,x))),t.forEach(((p,x)=>h.set(p,new X4(x,u.get(p)??null)))),h)))}recalculateAndSaveOverlays(e,t){const n=kd();let a=new Ft(((u,h)=>u-h)),l=Xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((u=>{for(const h of u)h.keys().forEach((m=>{const p=t.get(m);if(p===null)return;let x=n.get(m)||Ts.empty();x=h.applyToLocalView(p,x),n.set(m,x);const w=(a.get(h.batchId)||Xe()).add(m);a=a.insert(h.batchId,w)}))})).next((()=>{const u=[],h=a.getReverseIterator();for(;h.hasNext();){const m=h.getNext(),p=m.key,x=m.value,w=lA();x.forEach((b=>{if(!l.has(b)){const E=gA(t.get(b),n.get(b));E!==null&&w.set(b,E),l=l.add(b)}})),u.push(this.documentOverlayCache.saveOverlays(e,p,w))}return W.waitFor(u)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,a){return(function(u){return Ne.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gv(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next((l=>{const u=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-l.size):W.resolve(ia());let h=jc,m=l;return u.next((p=>W.forEach(p,((x,w)=>(h<w.largestBatchId&&(h=w.largestBatchId),l.get(x)?W.resolve():this.remoteDocumentCache.getEntry(e,x).next((b=>{m=m.insert(x,b)}))))).next((()=>this.populateOverlays(e,p,l))).next((()=>this.computeViews(e,m,p,Xe()))).next((x=>({batchId:h,changes:oA(x)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ne(t)).next((n=>{let a=wd();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const l=t.collectionGroup;let u=wd();return this.indexManager.getCollectionParents(e,l).next((h=>W.forEach(h,(m=>{const p=(function(w,b){return new Qa(b,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)})(t,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,n,a).next((x=>{x.forEach(((w,b)=>{u=u.insert(w,b)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,t,n,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,l,a)))).next((u=>{l.forEach(((m,p)=>{const x=p.getKey();u.get(x)===null&&(u=u.insert(x,Ut.newInvalidDocument(x)))}));let h=wd();return u.forEach(((m,p)=>{const x=l.get(m);x!==void 0&&Dd(x.mutation,p,Ts.empty(),wt.now()),ch(t,p)&&(h=h.insert(m,p))})),h}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return W.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(a){return{id:a.id,version:a.version,createTime:fn(a.createTime)}})(t)),W.resolve()}getNamedQuery(e,t){return W.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(a){return{name:a.name,query:hg(a.bundledQuery),readTime:fn(a.readTime)}})(t)),W.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(){this.overlays=new Ft(Ne.comparator),this.qr=new Map}getOverlay(e,t){return W.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ia();return W.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&n.set(a,l)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((a,l)=>{this.St(e,t,l)})),W.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.qr.get(n);return a!==void 0&&(a.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(n)),W.resolve()}getOverlaysForCollection(e,t,n){const a=ia(),l=t.length+1,u=new Ne(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const m=h.getNext().value,p=m.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&m.largestBatchId>n&&a.set(m.getKey(),m)}return W.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let l=new Ft(((p,x)=>p-x));const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>n){let x=l.get(p.largestBatchId);x===null&&(x=ia(),l=l.insert(p.largestBatchId,x)),x.set(p.getKey(),p)}}const h=ia(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach(((p,x)=>h.set(p,x))),!(h.size()>=a)););return W.resolve(h)}St(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const u=this.qr.get(a.largestBatchId).delete(n.key);this.qr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(n.key,new wv(t,n));let l=this.qr.get(t);l===void 0&&(l=Xe(),this.qr.set(t,l)),this.qr.set(t,l.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(){this.sessionToken=en.EMPTY_BYTE_STRING}getSessionToken(e){return W.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,W.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(){this.Qr=new jt(qn.$r),this.Ur=new jt(qn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new qn(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new qn(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new Ne(new tt([])),n=new qn(t,e),a=new qn(t,e+1),l=[];return this.Ur.forEachInRange([n,a],(u=>{this.Gr(u),l.push(u.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ne(new tt([])),n=new qn(t,e),a=new qn(t,e+1);let l=Xe();return this.Ur.forEachInRange([n,a],(u=>{l=l.add(u.key)})),l}containsKey(e){const t=new qn(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class qn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ne.comparator(e.key,t.key)||qe(e.Yr,t.Yr)}static Kr(e,t){return qe(e.Yr,t.Yr)||Ne.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new jt(qn.$r)}checkEmpty(e){return W.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new vv(l,t,n,a);this.mutationQueue.push(u);for(const h of a)this.Zr=this.Zr.add(new qn(h.key,l)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return W.resolve(u)}lookupMutationBatch(e,t){return W.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.ei(n),l=a<0?0:a;return W.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return W.resolve(this.mutationQueue.length===0?Hi:this.tr-1)}getAllMutationBatches(e){return W.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new qn(t,0),a=new qn(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([n,a],(u=>{const h=this.Xr(u.Yr);l.push(h)})),W.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new jt(qe);return t.forEach((a=>{const l=new qn(a,0),u=new qn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,u],(h=>{n=n.add(h.Yr)}))})),W.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let l=n;Ne.isDocumentKey(l)||(l=l.child(""));const u=new qn(new Ne(l),0);let h=new jt(qe);return this.Zr.forEachWhile((m=>{const p=m.key.path;return!!n.isPrefixOf(p)&&(p.length===a&&(h=h.add(m.Yr)),!0)}),u),W.resolve(this.ti(h))}ti(e){const t=[];return e.forEach((n=>{const a=this.Xr(n);a!==null&&t.push(a)})),t}removeMutationBatch(e,t){ke(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return W.forEach(t.mutations,(a=>{const l=new qn(a.key,t.batchId);return n=n.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new qn(t,0),a=this.Zr.firstAfterOrEqual(n);return W.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,W.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e){this.ri=e,this.docs=(function(){return new Ft(Ne.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),l=a?a.size:0,u=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return W.resolve(n?n.document.mutableCopy():Ut.newInvalidDocument(t))}getEntries(e,t){let n=Es();return t.forEach((a=>{const l=this.docs.get(a);n=n.insert(a,l?l.document.mutableCopy():Ut.newInvalidDocument(a))})),W.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let l=Es();const u=t.path,h=new Ne(u.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(h);for(;m.hasNext();){const{key:p,value:{document:x}}=m.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||iv(wS(x),n)<=0||(a.has(x.key)||ch(t,x))&&(l=l.insert(x.key,x.mutableCopy()))}return W.resolve(l)}getAllFromCollectionGroup(e,t,n,a){Ae(9500)}ii(e,t){return W.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new nP(this)}getSize(e){return W.resolve(this.size)}}class nP extends GA{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,a)=>{a.isValidDocument()?t.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(n)})),W.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(e){this.persistence=e,this.si=new Ya((t=>tl(t)),oh),this.lastRemoteSnapshotVersion=Me.min(),this.highestTargetId=0,this.oi=0,this._i=new Sv,this.targetCount=0,this.ai=il.ur()}forEachTarget(e,t){return this.si.forEach(((n,a)=>t(a))),W.resolve()}getLastRemoteSnapshotVersion(e){return W.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return W.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),W.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),W.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new il(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,W.resolve()}updateTargetData(e,t){return this.Pr(t),W.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,W.resolve()}removeTargets(e,t,n){let a=0;const l=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=t&&n.get(h.targetId)===null&&(this.si.delete(u),l.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),W.waitFor(l).next((()=>a))}getTargetCount(e){return W.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return W.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),W.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const a=this.persistence.referenceDelegate,l=[];return a&&t.forEach((u=>{l.push(a.markPotentiallyOrphaned(e,u))})),W.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),W.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return W.resolve(n)}containsKey(e,t){return W.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ns(0),this.li=!1,this.li=!0,this.hi=new Z4,this.referenceDelegate=e(this),this.Pi=new sP(this),this.indexManager=new q4,this.remoteDocumentCache=(function(a){return new tP(a)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new PA(t),this.Ii=new W4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new J4,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new eP(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){ge("MemoryPersistence","Starting transaction:",e);const a=new rP(this.ci.next());return this.referenceDelegate.Ei(),n(a).next((l=>this.referenceDelegate.di(a).next((()=>l)))).toPromise().then((l=>(a.raiseOnCommittedEvent(),l)))}Ai(e,t){return W.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class rP extends NS{constructor(e){super(),this.currentSequenceNumber=e}}class gg{constructor(e){this.persistence=e,this.Ri=new Sv,this.Vi=null}static mi(e){return new gg(e)}get fi(){if(this.Vi)return this.Vi;throw Ae(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),W.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),W.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),W.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((a=>this.fi.add(a.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((a=>{a.forEach((l=>this.fi.add(l.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return W.forEach(this.fi,(n=>{const a=Ne.fromPath(n);return this.gi(e,a).next((l=>{l||t.removeEntry(a,Me.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return W.or([()=>W.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Dm{constructor(e,t){this.persistence=e,this.pi=new Ya((n=>ls(n.path)),((n,a)=>n.isEqual(a))),this.garbageCollector=HA(this,t)}static mi(e,t){return new Dm(e,t)}Ei(){}di(e){return W.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((a=>n+a))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return W.forEach(this.pi,((n,a)=>this.br(e,n,a).next((l=>l?W.resolve():t(a)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ii(e,(u=>this.br(e,u,t).next((h=>{h||(n++,l.removeEntry(u,Me.min()))})))).next((()=>l.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),W.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),W.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),W.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),W.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=sm(e.data.value)),t}br(e,t,n){return W.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const a=this.pi.get(t);return W.resolve(a!==void 0&&a>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aP{constructor(e){this.serializer=e}k(e,t,n,a){const l=new tg("createOrUpgrade",t);n<1&&a>=1&&((function(m){m.createObjectStore(ih)})(e),(function(m){m.createObjectStore(qd,{keyPath:ND}),m.createObjectStore(kr,{keyPath:wN,autoIncrement:!0}).createIndex($o,_N,{unique:!0}),m.createObjectStore(Rc)})(e),dT(e),(function(m){m.createObjectStore(Uo)})(e));let u=W.resolve();return n<3&&a>=3&&(n!==0&&((function(m){m.deleteObjectStore(Dc),m.deleteObjectStore(kc),m.deleteObjectStore(Yo)})(e),dT(e)),u=u.next((()=>(function(m){const p=m.store(Yo),x={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Me.min().toTimestamp(),targetCount:0};return p.put(Sm,x)})(l)))),n<4&&a>=4&&(n!==0&&(u=u.next((()=>(function(m,p){return p.store(kr).J().next((w=>{m.deleteObjectStore(kr),m.createObjectStore(kr,{keyPath:wN,autoIncrement:!0}).createIndex($o,_N,{unique:!0});const b=p.store(kr),E=w.map((C=>b.put(C)));return W.waitFor(E)}))})(e,l)))),u=u.next((()=>{(function(m){m.createObjectStore(Pc,{keyPath:kD})})(e)}))),n<5&&a>=5&&(u=u.next((()=>this.yi(l)))),n<6&&a>=6&&(u=u.next((()=>((function(m){m.createObjectStore(zd)})(e),this.wi(l))))),n<7&&a>=7&&(u=u.next((()=>this.Si(l)))),n<8&&a>=8&&(u=u.next((()=>this.bi(e,l)))),n<9&&a>=9&&(u=u.next((()=>{(function(m){m.objectStoreNames.contains("remoteDocumentChanges")&&m.deleteObjectStore("remoteDocumentChanges")})(e)}))),n<10&&a>=10&&(u=u.next((()=>this.Di(l)))),n<11&&a>=11&&(u=u.next((()=>{(function(m){m.createObjectStore(ng,{keyPath:DD})})(e),(function(m){m.createObjectStore(sg,{keyPath:PD})})(e)}))),n<12&&a>=12&&(u=u.next((()=>{(function(m){const p=m.createObjectStore(rg,{keyPath:BD});p.createIndex(yx,qD,{unique:!1}),p.createIndex(RS,zD,{unique:!1})})(e)}))),n<13&&a>=13&&(u=u.next((()=>(function(m){const p=m.createObjectStore(Em,{keyPath:ED});p.createIndex(tm,SD),p.createIndex(AS,AD)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(Uo)))),n<14&&a>=14&&(u=u.next((()=>this.Fi(e,l)))),n<15&&a>=15&&(u=u.next((()=>(function(m){m.createObjectStore(cv,{keyPath:MD,autoIncrement:!0}).createIndex(px,OD,{unique:!1}),m.createObjectStore(Id,{keyPath:VD}).createIndex(IS,LD,{unique:!1}),m.createObjectStore(Cd,{keyPath:FD}).createIndex(CS,UD,{unique:!1})})(e)))),n<16&&a>=16&&(u=u.next((()=>{t.objectStore(Id).clear()})).next((()=>{t.objectStore(Cd).clear()}))),n<17&&a>=17&&(u=u.next((()=>{(function(m){m.createObjectStore(uv,{keyPath:HD})})(e)}))),n<18&&a>=18&&vE()&&(u=u.next((()=>{t.objectStore(Id).clear()})).next((()=>{t.objectStore(Cd).clear()}))),u}wi(e){let t=0;return e.store(Uo).ee(((n,a)=>{t+=km(a)})).next((()=>{const n={byteSize:t};return e.store(zd).put(gx,n)}))}yi(e){const t=e.store(qd),n=e.store(kr);return t.J().next((a=>W.forEach(a,(l=>{const u=IDBKeyRange.bound([l.userId,Hi],[l.userId,l.lastAcknowledgedBatchId]);return n.J($o,u).next((h=>W.forEach(h,(m=>{ke(m.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:m.batchId});const p=qo(this.serializer,m);return FA(e,l.userId,p).next((()=>{}))}))))}))))}Si(e){const t=e.store(Dc),n=e.store(Uo);return e.store(Yo).get(Sm).next((a=>{const l=[];return n.ee(((u,h)=>{const m=new tt(u),p=(function(w){return[0,ls(w)]})(m);l.push(t.get(p).next((x=>x?W.resolve():(w=>t.put({targetId:0,path:ls(w),sequenceNumber:a.highestListenSequenceNumber}))(m))))})).next((()=>W.waitFor(l)))}))}bi(e,t){e.createObjectStore(Hd,{keyPath:RD});const n=t.store(Hd),a=new Ev,l=u=>{if(a.add(u)){const h=u.lastSegment(),m=u.popLast();return n.put({collectionId:h,parent:ls(m)})}};return t.store(Uo).ee({X:!0},((u,h)=>{const m=new tt(u);return l(m.popLast())})).next((()=>t.store(Rc).ee({X:!0},(([u,h,m],p)=>{const x=aa(h);return l(x.popLast())}))))}Di(e){const t=e.store(kc);return t.ee(((n,a)=>{const l=Nd(a),u=MA(this.serializer,l);return t.put(u)}))}Ci(e,t){const n=t.store(Uo),a=[];return n.ee(((l,u)=>{const h=t.store(Em),m=(function(w){return w.document?new Ne(tt.fromString(w.document.name).popFirst(5)):w.noDocument?Ne.fromSegments(w.noDocument.path):w.unknownDocument?Ne.fromSegments(w.unknownDocument.path):Ae(36783)})(u).path.toArray(),p={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};a.push(h.put(p))})).next((()=>W.waitFor(a)))}Fi(e,t){const n=t.store(kr),a=$A(this.serializer),l=new Av(gg.mi,this.serializer.yt);return n.J().next((u=>{const h=new Map;return u.forEach((m=>{let p=h.get(m.userId)??Xe();qo(this.serializer,m).keys().forEach((x=>p=p.add(x))),h.set(m.userId,p)})),W.forEach(h,((m,p)=>{const x=new zn(p),w=fg.wt(this.serializer,x),b=l.getIndexManager(x),E=mg.wt(x,this.serializer,b,l.referenceDelegate);return new KA(a,E,w,b).recalculateAndSaveOverlaysForDocumentKeys(new xx(t,Ns.ce),m).next()}))}))}}function dT(s){s.createObjectStore(Dc,{keyPath:ID}).createIndex(lv,CD,{unique:!0}),s.createObjectStore(kc,{keyPath:"targetId"}).createIndex(jS,jD,{unique:!0}),s.createObjectStore(Yo)}const ji="IndexedDbPersistence",Uy=18e5,By=5e3,qy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",QA="main";class jv{constructor(e,t,n,a,l,u,h,m,p,x,w=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=l,this.window=u,this.document=h,this.xi=p,this.Oi=x,this.Ni=w,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=b=>Promise.resolve(),!jv.v())throw new he(se.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new K4(this,a),this.$i=t+QA,this.serializer=new PA(m),this.Ui=new la(this.$i,this.Ni,new aP(this.serializer)),this.hi=new O4,this.Pi=new H4(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$A(this.serializer),this.Ii=new M4,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,x===!1&&hn(ji,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new he(se.FAILED_PRECONDITION,qy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new Ns(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>qf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(eo(e))return ge(ji,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ge(ji,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return md(e).get(ic).next((t=>W.resolve(this.es(t))))}ts(e){return qf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Uy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const n=Cn(t,Pc);return n.J().next((a=>{const l=this.ss(a,Uy),u=a.filter((h=>l.indexOf(h)===-1));return W.forEach(u,(h=>n.delete(h.clientId))).next((()=>u))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?W.resolve(!0):md(e).get(ic).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,By)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new he(se.FAILED_PRECONDITION,qy);return!1}}return!(!this.networkEnabled||!this.inForeground)||qf(e).J().next((n=>this.ss(n,By).find((a=>{if(this.clientId!==a.clientId){const l=!this.networkEnabled&&a.networkEnabled,u=!this.inForeground&&a.inForeground,h=this.networkEnabled===a.networkEnabled;if(l||u&&h)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&ge(ji,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[ih,Pc],(e=>{const t=new xx(e,Ns.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>qf(e).J().next((t=>this.ss(t,Uy).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return mg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new z4(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return fg.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){ge(ji,"Starting transaction:",e);const a=t==="readonly"?"readonly":"readwrite",l=(function(m){return m===18?KD:m===17?MS:m===16?$D:m===15?dv:m===14?PS:m===13?DS:m===12?GD:m===11?kS:void Ae(60245)})(this.Ni);let u;return this.Ui.runTransaction(e,a,l,(h=>(u=new xx(h,this.ci?this.ci.next():Ns.ce),t==="readwrite-primary"?this.Hi(u).next((m=>!!m||this.Yi(u))).next((m=>{if(!m)throw hn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new he(se.FAILED_PRECONDITION,_S);return n(u)})).next((m=>this.Xi(u).next((()=>m)))):this.Is(u).next((()=>n(u)))))).then((h=>(u.raiseOnCommittedEvent(),h)))}Is(e){return md(e).get(ic).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,By)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new he(se.FAILED_PRECONDITION,qy)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return md(e).put(ic,t)}static v(){return la.v()}Zi(e){const t=md(e);return t.get(ic).next((n=>this.es(n)?(ge(ji,"Releasing primary lease."),t.delete(ic)):W.resolve()))}rs(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(hn(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;xE()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return ge(ji,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return hn(ji,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){hn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function md(s){return Cn(s,ih)}function qf(s){return Cn(s,Pc)}function Iv(s,e){let t=s.projectId;return s.isDefaultDatabase||(t+="."+s.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cv{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=a}static As(e,t){let n=Xe(),a=Xe();for(const l of t.docChanges)switch(l.type){case 0:n=n.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new Cv(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return xE()?8:TS(jn())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,a){const l={result:null};return this.ys(e,t).next((u=>{l.result=u})).next((()=>{if(!l.result)return this.ws(e,t,a,n).next((u=>{l.result=u}))})).next((()=>{if(l.result)return;const u=new iP;return this.Ss(e,t,u).next((h=>{if(l.result=h,this.Vs)return this.bs(e,t,u,h.size)}))})).next((()=>l.result))}bs(e,t,n,a){return n.documentReadCount<this.fs?(mc()<=it.DEBUG&&ge("QueryEngine","SDK will not create cache indexes for query:",gc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),W.resolve()):(mc()<=it.DEBUG&&ge("QueryEngine","Query:",gc(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.gs*a?(mc()<=it.DEBUG&&ge("QueryEngine","The SDK decides to create cache indexes for query:",gc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,cs(t))):W.resolve())}ys(e,t){if(MN(t))return W.resolve(null);let n=cs(t);return this.indexManager.getIndexType(e,n).next((a=>a===0?null:(t.limit!==null&&a===1&&(t=Im(t,null,"F"),n=cs(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((l=>{const u=Xe(...l);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,n).next((m=>{const p=this.Ds(t,h);return this.Cs(t,p,u,m.readTime)?this.ys(e,Im(t,null,"F")):this.vs(e,p,t,m)}))))})))))}ws(e,t,n,a){return MN(t)||a.isEqual(Me.min())?W.resolve(null):this.ps.getDocuments(e,n).next((l=>{const u=this.Ds(t,l);return this.Cs(t,u,n,a)?W.resolve(null):(mc()<=it.DEBUG&&ge("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),gc(t)),this.vs(e,u,t,bS(a,jc)).next((h=>h)))}))}Ds(e,t){let n=new jt(aA(e));return t.forEach(((a,l)=>{ch(e,l)&&(n=n.add(l))})),n}Cs(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Ss(e,t,n){return mc()<=it.DEBUG&&ge("QueryEngine","Using full collection scan to execute query:",gc(t)),this.ps.getDocumentsMatchingQuery(e,t,Js.min(),n)}vs(e,t,n,a){return this.ps.getDocumentsMatchingQuery(e,n,a).next((l=>(t.forEach((u=>{l=l.insert(u.key,u)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv="LocalStore",oP=3e8;class lP{constructor(e,t,n,a){this.persistence=e,this.Fs=t,this.serializer=a,this.Ms=new Ft(qe),this.xs=new Ya((l=>tl(l)),oh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new KA(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function XA(s,e,t,n){return new lP(s,e,t,n)}async function WA(s,e){const t=Te(s);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next((l=>(a=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((l=>{const u=[],h=[];let m=Xe();for(const p of a){u.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}for(const p of l){h.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}return t.localDocuments.getDocuments(n,m).next((p=>({Ls:p,removedBatchIds:u,addedBatchIds:h})))}))}))}function cP(s,e){const t=Te(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const a=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,m,p,x){const w=p.batch,b=w.keys();let E=W.resolve();return b.forEach((C=>{E=E.next((()=>x.getEntry(m,C))).next((k=>{const L=p.docVersions.get(C);ke(L!==null,48541),k.version.compareTo(L)<0&&(w.applyToRemoteDocument(k,p),k.isValidDocument()&&(k.setReadTime(p.commitVersion),x.addEntry(k)))}))})),E.next((()=>h.mutationQueue.removeMutationBatch(m,w)))})(t,n,e,l).next((()=>l.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(h){let m=Xe();for(let p=0;p<h.mutationResults.length;++p)h.mutationResults[p].transformResults.length>0&&(m=m.add(h.batch.mutations[p].key));return m})(e)))).next((()=>t.localDocuments.getDocuments(n,a)))}))}function JA(s){const e=Te(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function uP(s,e){const t=Te(s),n=e.snapshotVersion;let a=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const u=t.Ns.newChangeBuffer({trackRemovals:!0});a=t.Ms;const h=[];e.targetChanges.forEach(((x,w)=>{const b=a.get(w);if(!b)return;h.push(t.Pi.removeMatchingKeys(l,x.removedDocuments,w).next((()=>t.Pi.addMatchingKeys(l,x.addedDocuments,w))));let E=b.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(w)!==null?E=E.withResumeToken(en.EMPTY_BYTE_STRING,Me.min()).withLastLimboFreeSnapshotVersion(Me.min()):x.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(x.resumeToken,n)),a=a.insert(w,E),(function(k,L,U){return k.resumeToken.approximateByteSize()===0||L.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=oP?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0})(b,E,x)&&h.push(t.Pi.updateTargetData(l,E))}));let m=Es(),p=Xe();if(e.documentUpdates.forEach((x=>{e.resolvedLimboDocuments.has(x)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(l,x))})),h.push(ZA(l,u,e.documentUpdates).next((x=>{m=x.ks,p=x.qs}))),!n.isEqual(Me.min())){const x=t.Pi.getLastRemoteSnapshotVersion(l).next((w=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,n)));h.push(x)}return W.waitFor(h).next((()=>u.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,m,p))).next((()=>m))})).then((l=>(t.Ms=a,l)))}function ZA(s,e,t){let n=Xe(),a=Xe();return t.forEach((l=>n=n.add(l))),e.getEntries(s,n).next((l=>{let u=Es();return t.forEach(((h,m)=>{const p=l.get(h);m.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(h)),m.isNoDocument()&&m.version.isEqual(Me.min())?(e.removeEntry(h,m.readTime),u=u.insert(h,m)):!p.isValidDocument()||m.version.compareTo(p.version)>0||m.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(m),u=u.insert(h,m)):ge(Rv,"Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",m.version)})),{ks:u,qs:a}}))}function dP(s,e){const t=Te(s);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Hi),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function Bc(s,e){const t=Te(s);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let a;return t.Pi.getTargetData(n,e).next((l=>l?(a=l,W.resolve(a)):t.Pi.allocateTargetId(n).next((u=>(a=new La(e,u,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,a).next((()=>a)))))))})).then((n=>{const a=t.Ms.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function qc(s,e,t){const n=Te(s),a=n.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",l,(u=>n.persistence.referenceDelegate.removeTarget(u,a)))}catch(u){if(!eo(u))throw u;ge(Rv,`Failed to update sequence numbers for target ${e}: ${u}`)}n.Ms=n.Ms.remove(e),n.xs.delete(a.target)}function Pm(s,e,t){const n=Te(s);let a=Me.min(),l=Xe();return n.persistence.runTransaction("Execute query","readwrite",(u=>(function(m,p,x){const w=Te(m),b=w.xs.get(x);return b!==void 0?W.resolve(w.Ms.get(b)):w.Pi.getTargetData(p,x)})(n,u,cs(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(u,h.targetId).next((m=>{l=m}))})).next((()=>n.Fs.getDocumentsMatchingQuery(u,e,t?a:Me.min(),t?l:Xe()))).next((h=>(nj(n,rA(e),h),{documents:h,Qs:l})))))}function ej(s,e){const t=Te(s),n=Te(t.Pi),a=t.Ms.get(e);return a?Promise.resolve(a.target):t.persistence.runTransaction("Get target data","readonly",(l=>n.At(l,e).next((u=>u?u.target:null))))}function tj(s,e){const t=Te(s),n=t.Os.get(e)||Me.min();return t.persistence.runTransaction("Get new document changes","readonly",(a=>t.Ns.getAllFromCollectionGroup(a,e,bS(n,jc),Number.MAX_SAFE_INTEGER))).then((a=>(nj(t,e,a),a)))}function nj(s,e,t){let n=s.Os.get(e)||Me.min();t.forEach(((a,l)=>{l.readTime.compareTo(n)>0&&(n=l.readTime)})),s.Os.set(e,n)}async function hP(s,e,t,n){const a=Te(s);let l=Xe(),u=Es();for(const p of t){const x=e.$s(p.metadata.name);p.document&&(l=l.add(x));const w=e.Us(p);w.setReadTime(e.Ks(p.metadata.readTime)),u=u.insert(x,w)}const h=a.Ns.newChangeBuffer({trackRemovals:!0}),m=await Bc(a,(function(x){return cs(Zc(tt.fromString(`__bundle__/docs/${x}`)))})(n));return a.persistence.runTransaction("Apply bundle documents","readwrite",(p=>ZA(p,h,u).next((x=>(h.apply(p),x))).next((x=>a.Pi.removeMatchingKeysForTargetId(p,m.targetId).next((()=>a.Pi.addMatchingKeys(p,l,m.targetId))).next((()=>a.localDocuments.getLocalViewOfDocuments(p,x.ks,x.qs))).next((()=>x.ks))))))}async function fP(s,e,t=Xe()){const n=await Bc(s,cs(hg(e.bundledQuery))),a=Te(s);return a.persistence.runTransaction("Save named query","readwrite",(l=>{const u=fn(e.readTime);if(n.snapshotVersion.compareTo(u)>=0)return a.Ii.saveNamedQuery(l,e);const h=n.withResumeToken(en.EMPTY_BYTE_STRING,u);return a.Ms=a.Ms.insert(h.targetId,h),a.Pi.updateTargetData(l,h).next((()=>a.Pi.removeMatchingKeysForTargetId(l,n.targetId))).next((()=>a.Pi.addMatchingKeys(l,t,n.targetId))).next((()=>a.Ii.saveNamedQuery(l,e)))}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sj="firestore_clients";function hT(s,e){return`${sj}_${s}_${e}`}const rj="firestore_mutations";function fT(s,e,t){let n=`${rj}_${s}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}const aj="firestore_targets";function zy(s,e){return`${aj}_${s}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na="SharedClientState";class Mm{constructor(e,t,n,a){this.user=e,this.batchId=t,this.state=n,this.error=a}static Ws(e,t,n){const a=JSON.parse(n);let l,u=typeof a=="object"&&["pending","acknowledged","rejected"].indexOf(a.state)!==-1&&(a.error===void 0||typeof a.error=="object");return u&&a.error&&(u=typeof a.error.message=="string"&&typeof a.error.code=="string",u&&(l=new he(a.error.code,a.error.message))),u?new Mm(e,t,a.state,l):(hn(na,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Pd{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ws(e,t){const n=JSON.parse(t);let a,l=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return l&&n.error&&(l=typeof n.error.message=="string"&&typeof n.error.code=="string",l&&(a=new he(n.error.code,n.error.message))),l?new Pd(e,n.state,a):(hn(na,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Om{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const n=JSON.parse(t);let a=typeof n=="object"&&n.activeTargetIds instanceof Array,l=pv();for(let u=0;a&&u<n.activeTargetIds.length;++u)a=ES(n.activeTargetIds[u]),l=l.add(n.activeTargetIds[u]);return a?new Om(e,l):(hn(na,`Failed to parse client data for instance '${e}': ${t}`),null)}}class kv{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new kv(t.clientId,t.onlineState):(hn(na,`Failed to parse online state: ${e}`),null)}}class Dx{constructor(){this.activeTargetIds=pv()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Hy{constructor(e,t,n,a,l){this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=a,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Ft(qe),this.started=!1,this.Xs=[];const u=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.eo=hT(this.persistenceKey,this.Js),this.no=(function(m){return`firestore_sequence_number_${m}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Dx),this.ro=new RegExp(`^${sj}_${u}_([^_]*)$`),this.io=new RegExp(`^${rj}_${u}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${aj}_${u}_(\\d+)$`),this.oo=(function(m){return`firestore_online_state_${m}`})(this.persistenceKey),this._o=(function(m){return`firestore_bundle_loaded_v2_${m}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const n of e){if(n===this.Js)continue;const a=this.getItem(hT(this.persistenceKey,n));if(a){const l=Om.Ws(n,a);l&&(this.Zs=this.Zs.insert(l.clientId,l))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const n=this.uo(t);n&&this.co(n)}for(const n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((n,a)=>{a.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const a=this.storage.getItem(zy(this.persistenceKey,e));if(a){const l=Pd.Ws(e,a);l&&(n=l.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(zy(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach((a=>{this.Po(a)})),this.currentUser=e,n.forEach((a=>{this.addPendingMutation(a)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ge(na,"READ",e,t),t}setItem(e,t){ge(na,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ge(na,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(ge(na,"EVENT",t.key,t.newValue),t.key===this.eo)return void hn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const n=this.Ro(t.key);return this.Vo(n,null)}{const n=this.mo(t.key,t.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(t.key)){if(t.newValue!==null){const n=this.fo(t.key,t.newValue);if(n)return this.po(n)}}else if(this.so.test(t.key)){if(t.newValue!==null){const n=this.yo(t.key,t.newValue);if(n)return this.wo(n)}}else if(t.key===this.oo){if(t.newValue!==null){const n=this.uo(t.newValue);if(n)return this.co(n)}}else if(t.key===this.no){const n=(function(l){let u=Ns.ce;if(l!=null)try{const h=JSON.parse(l);ke(typeof h=="number",30636,{So:l}),u=h}catch(h){hn(na,"Failed to read sequence number from WebStorage",h)}return u})(t.newValue);n!==Ns.ce&&this.sequenceNumberHandler(n)}else if(t.key===this._o){const n=this.bo(t.newValue);await Promise.all(n.map((a=>this.syncEngine.Do(a))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){const a=new Mm(this.currentUser,e,t,n),l=fT(this.persistenceKey,this.currentUser,e);this.setItem(l,a.Gs())}Po(e){const t=fT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){const a=zy(this.persistenceKey,e),l=new Pd(e,t,n);this.setItem(a,l.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const n=this.Ro(e);return Om.Ws(n,t)}fo(e,t){const n=this.io.exec(e),a=Number(n[1]),l=n[2]!==void 0?n[2]:null;return Mm.Ws(new zn(l),a,t)}yo(e,t){const n=this.so.exec(e),a=Number(n[1]);return Pd.Ws(a,t)}uo(e){return kv.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);ge(na,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const n=t?this.Zs.insert(e,t):this.Zs.remove(e),a=this.lo(this.Zs),l=this.lo(n),u=[],h=[];return l.forEach((m=>{a.has(m)||u.push(m)})),a.forEach((m=>{l.has(m)||h.push(m)})),this.syncEngine.Fo(u,h).then((()=>{this.Zs=n}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=pv();return e.forEach(((n,a)=>{t=t.unionWith(a.activeTargetIds)})),t}}class ij{constructor(){this.Mo=new Dx,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Dx,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mT="ConnectivityMonitor";class gT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ge(mT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ge(mT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zf=null;function Px(){return zf===null?zf=(function(){return 268435456+Math.round(2147483648*Math.random())})():zf++,"0x"+zf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy="RestConnection",gP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pP{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${a}`,this.Wo=this.databaseId.database===$d?`project_id=${n}`:`project_id=${n}&database_id=${a}`}Go(e,t,n,a,l){const u=Px(),h=this.zo(e,t.toUriEncodedString());ge(Gy,`Sending RPC '${e}' ${u}:`,h,n);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,a,l);const{host:p}=new URL(h),x=Ka(p);return this.Jo(e,h,m,n,x).then((w=>(ge(Gy,`Received RPC '${e}' ${u}: `,w),w)),(w=>{throw Ws(Gy,`RPC '${e}' ${u} failed with error: `,w,"url: ",h,"request:",n),w}))}Ho(e,t,n,a,l,u){return this.Go(e,t,n,a,l)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Jc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((a,l)=>e[l]=a)),n&&n.headers.forEach(((a,l)=>e[l]=a))}zo(e,t){const n=gP[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rs="WebChannelConnection";class xP extends pP{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,a,l){const u=Px();return new Promise(((h,m)=>{const p=new lS;p.setWithCredentials(!0),p.listenOnce(cS.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case Zf.NO_ERROR:const w=p.getResponseJson();ge(rs,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(w)),h(w);break;case Zf.TIMEOUT:ge(rs,`RPC '${e}' ${u} timed out`),m(new he(se.DEADLINE_EXCEEDED,"Request time out"));break;case Zf.HTTP_ERROR:const b=p.getStatus();if(ge(rs,`RPC '${e}' ${u} failed with status:`,b,"response text:",p.getResponseText()),b>0){let E=p.getResponseJson();Array.isArray(E)&&(E=E[0]);const C=E?.error;if(C&&C.status&&C.message){const k=(function(U){const F=U.toLowerCase().replace(/_/g,"-");return Object.values(se).indexOf(F)>=0?F:se.UNKNOWN})(C.status);m(new he(k,C.message))}else m(new he(se.UNKNOWN,"Server responded with status "+p.getStatus()))}else m(new he(se.UNAVAILABLE,"Connection failed."));break;default:Ae(9055,{l_:e,streamId:u,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{ge(rs,`RPC '${e}' ${u} completed.`)}}));const x=JSON.stringify(a);ge(rs,`RPC '${e}' ${u} sending request:`,a),p.send(t,"POST",x,n,15)}))}T_(e,t,n){const a=Px(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=hS(),h=dS(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(m.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,n),m.encodeInitMessageHeaders=!0;const x=l.join("");ge(rs,`Creating RPC '${e}' stream ${a}: ${x}`,m);const w=u.createWebChannel(x,m);this.I_(w);let b=!1,E=!1;const C=new yP({Yo:L=>{E?ge(rs,`Not sending because RPC '${e}' stream ${a} is closed:`,L):(b||(ge(rs,`Opening RPC '${e}' stream ${a} transport.`),w.open(),b=!0),ge(rs,`RPC '${e}' stream ${a} sending:`,L),w.send(L))},Zo:()=>w.close()}),k=(L,U,F)=>{L.listen(U,(B=>{try{F(B)}catch(H){setTimeout((()=>{throw H}),0)}}))};return k(w,bd.EventType.OPEN,(()=>{E||(ge(rs,`RPC '${e}' stream ${a} transport opened.`),C.o_())})),k(w,bd.EventType.CLOSE,(()=>{E||(E=!0,ge(rs,`RPC '${e}' stream ${a} transport closed`),C.a_(),this.E_(w))})),k(w,bd.EventType.ERROR,(L=>{E||(E=!0,Ws(rs,`RPC '${e}' stream ${a} transport errored. Name:`,L.name,"Message:",L.message),C.a_(new he(se.UNAVAILABLE,"The operation could not be completed")))})),k(w,bd.EventType.MESSAGE,(L=>{if(!E){const U=L.data[0];ke(!!U,16349);const F=U,B=F?.error||F[0]?.error;if(B){ge(rs,`RPC '${e}' stream ${a} received error:`,B);const H=B.status;let $=(function(N){const A=yn[N];if(A!==void 0)return vA(A)})(H),M=B.message;$===void 0&&($=se.INTERNAL,M="Unknown error status: "+H+" with message "+B.message),E=!0,C.a_(new he($,M)),w.close()}else ge(rs,`RPC '${e}' stream ${a} received:`,U),C.u_(U)}})),k(h,uS.STAT_EVENT,(L=>{L.stat===ux.PROXY?ge(rs,`RPC '${e}' stream ${a} detected buffering proxy`):L.stat===ux.NOPROXY&&ge(rs,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oj(){return typeof window<"u"?window:null}function lm(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fl(s){return new T4(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(e,t,n=1e3,a=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=a,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),a=Math.max(0,t-n);a>0&&ge("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pT="PersistentStream";class lj{constructor(e,t,n,a,l,u,h,m){this.Mi=e,this.S_=n,this.b_=a,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Dv(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===se.RESOURCE_EXHAUSTED?(hn(t.toString()),hn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===se.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,a])=>{this.D_===t&&this.G_(n,a)}),(n=>{e((()=>{const a=new he(se.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(a)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{n((()=>this.z_(a)))})),this.stream.onMessage((a=>{n((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return ge(pT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(ge(pT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class vP extends lj{constructor(e,t,n,a,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,u),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=A4(this.serializer,e),n=(function(l){if(!("targetChange"in l))return Me.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?Me.min():u.readTime?fn(u.readTime):Me.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=jx(this.serializer),t.addTarget=(function(l,u){let h;const m=u.target;if(h=Am(m)?{documents:jA(l,m)}:{query:dg(l,m).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=NA(l,u.resumeToken);const p=Sx(l,u.expectedCount);p!==null&&(h.expectedCount=p)}else if(u.snapshotVersion.compareTo(Me.min())>0){h.readTime=Uc(l,u.snapshotVersion.toTimestamp());const p=Sx(l,u.expectedCount);p!==null&&(h.expectedCount=p)}return h})(this.serializer,e);const n=I4(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=jx(this.serializer),t.removeTarget=e,this.q_(t)}}class bP extends lj{constructor(e,t,n,a,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,u),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ke(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ke(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ke(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=j4(e.writeResults,e.commitTime),n=fn(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=jx(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>Wd(this.serializer,n)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wP{}class _P extends wP{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new he(se.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Go(e,Ax(t,n),a,l,u))).catch((l=>{throw l.name==="FirebaseError"?(l.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new he(se.UNKNOWN,l.toString())}))}Ho(e,t,n,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,Ax(t,n),a,u,h,l))).catch((u=>{throw u.name==="FirebaseError"?(u.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new he(se.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class NP{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(hn(t),this.aa=!1):ge("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol="RemoteStore";class TP{constructor(e,t,n,a,l){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((u=>{n.enqueueAndForget((async()=>{no(this)&&(ge(ol,"Restarting streams for network reachability change."),await(async function(m){const p=Te(m);p.Ea.add(4),await nu(p),p.Ra.set("Unknown"),p.Ea.delete(4),await fh(p)})(this))}))})),this.Ra=new NP(n,a)}}async function fh(s){if(no(s))for(const e of s.da)await e(!0)}async function nu(s){for(const e of s.da)await e(!1)}function pg(s,e){const t=Te(s);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ov(t)?Mv(t):ru(t).O_()&&Pv(t,e))}function zc(s,e){const t=Te(s),n=ru(t);t.Ia.delete(e),n.O_()&&cj(t,e),t.Ia.size===0&&(n.O_()?n.L_():no(t)&&t.Ra.set("Unknown"))}function Pv(s,e){if(s.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Me.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ru(s).Y_(e)}function cj(s,e){s.Va.Ue(e),ru(s).Z_(e)}function Mv(s){s.Va=new b4({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),At:e=>s.Ia.get(e)||null,ht:()=>s.datastore.serializer.databaseId}),ru(s).start(),s.Ra.ua()}function Ov(s){return no(s)&&!ru(s).x_()&&s.Ia.size>0}function no(s){return Te(s).Ea.size===0}function uj(s){s.Va=void 0}async function EP(s){s.Ra.set("Online")}async function SP(s){s.Ia.forEach(((e,t)=>{Pv(s,e)}))}async function AP(s,e){uj(s),Ov(s)?(s.Ra.ha(e),Mv(s)):s.Ra.set("Unknown")}async function jP(s,e,t){if(s.Ra.set("Online"),e instanceof _A&&e.state===2&&e.cause)try{await(async function(a,l){const u=l.cause;for(const h of l.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,u),a.Ia.delete(h),a.Va.removeTarget(h))})(s,e)}catch(n){ge(ol,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Vm(s,n)}else if(e instanceof im?s.Va.Ze(e):e instanceof wA?s.Va.st(e):s.Va.tt(e),!t.isEqual(Me.min()))try{const n=await JA(s.localStore);t.compareTo(n)>=0&&await(function(l,u){const h=l.Va.Tt(u);return h.targetChanges.forEach(((m,p)=>{if(m.resumeToken.approximateByteSize()>0){const x=l.Ia.get(p);x&&l.Ia.set(p,x.withResumeToken(m.resumeToken,u))}})),h.targetMismatches.forEach(((m,p)=>{const x=l.Ia.get(m);if(!x)return;l.Ia.set(m,x.withResumeToken(en.EMPTY_BYTE_STRING,x.snapshotVersion)),cj(l,m);const w=new La(x.target,m,p,x.sequenceNumber);Pv(l,w)})),l.remoteSyncer.applyRemoteEvent(h)})(s,t)}catch(n){ge(ol,"Failed to raise snapshot:",n),await Vm(s,n)}}async function Vm(s,e,t){if(!eo(e))throw e;s.Ea.add(1),await nu(s),s.Ra.set("Offline"),t||(t=()=>JA(s.localStore)),s.asyncQueue.enqueueRetryable((async()=>{ge(ol,"Retrying IndexedDB access"),await t(),s.Ea.delete(1),await fh(s)}))}function dj(s,e){return e().catch((t=>Vm(s,t,e)))}async function su(s){const e=Te(s),t=Xi(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Hi;for(;IP(e);)try{const a=await dP(e.localStore,n);if(a===null){e.Ta.length===0&&t.L_();break}n=a.batchId,CP(e,a)}catch(a){await Vm(e,a)}hj(e)&&fj(e)}function IP(s){return no(s)&&s.Ta.length<10}function CP(s,e){s.Ta.push(e);const t=Xi(s);t.O_()&&t.X_&&t.ea(e.mutations)}function hj(s){return no(s)&&!Xi(s).x_()&&s.Ta.length>0}function fj(s){Xi(s).start()}async function RP(s){Xi(s).ra()}async function kP(s){const e=Xi(s);for(const t of s.Ta)e.ea(t.mutations)}async function DP(s,e,t){const n=s.Ta.shift(),a=bv.from(n,e,t);await dj(s,(()=>s.remoteSyncer.applySuccessfulWrite(a))),await su(s)}async function PP(s,e){e&&Xi(s).X_&&await(async function(n,a){if((function(u){return xA(u)&&u!==se.ABORTED})(a.code)){const l=n.Ta.shift();Xi(n).B_(),await dj(n,(()=>n.remoteSyncer.rejectFailedWrite(l.batchId,a))),await su(n)}})(s,e),hj(s)&&fj(s)}async function yT(s,e){const t=Te(s);t.asyncQueue.verifyOperationInProgress(),ge(ol,"RemoteStore received new credentials");const n=no(t);t.Ea.add(3),await nu(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await fh(t)}async function Mx(s,e){const t=Te(s);e?(t.Ea.delete(2),await fh(t)):e||(t.Ea.add(2),await nu(t),t.Ra.set("Unknown"))}function ru(s){return s.ma||(s.ma=(function(t,n,a){const l=Te(t);return l.sa(),new vP(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(s.datastore,s.asyncQueue,{Xo:EP.bind(null,s),t_:SP.bind(null,s),r_:AP.bind(null,s),H_:jP.bind(null,s)}),s.da.push((async e=>{e?(s.ma.B_(),Ov(s)?Mv(s):s.Ra.set("Unknown")):(await s.ma.stop(),uj(s))}))),s.ma}function Xi(s){return s.fa||(s.fa=(function(t,n,a){const l=Te(t);return l.sa(),new bP(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(s.datastore,s.asyncQueue,{Xo:()=>Promise.resolve(),t_:RP.bind(null,s),r_:PP.bind(null,s),ta:kP.bind(null,s),na:DP.bind(null,s)}),s.da.push((async e=>{e?(s.fa.B_(),await su(s)):(await s.fa.stop(),s.Ta.length>0&&(ge(ol,`Stopping write stream with ${s.Ta.length} pending writes`),s.Ta=[]))}))),s.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{constructor(e,t,n,a,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=l,this.deferred=new Hn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,l){const u=Date.now()+n,h=new Vv(e,t,u,a,l);return h.start(n),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(se.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function au(s,e){if(hn("AsyncQueue",`${e}: ${s}`),eo(s))return new he(se.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{static emptySet(e){return new Xo(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ne.comparator(t.key,n.key):(t,n)=>Ne.comparator(t.key,n.key),this.keyedMap=wd(),this.sortedSet=new Ft(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Xo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=n.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Xo;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(){this.ga=new Ft(Ne.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ae(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ll{constructor(e,t,n,a,l,u,h,m,p){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=m,this.hasCachedResults=p}static fromInitialDocuments(e,t,n,a,l){const u=[];return t.forEach((h=>{u.push({type:0,doc:h})})),new ll(e,t,Xo.emptySet(t),u,n,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class OP{constructor(){this.queries=vT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const a=Te(t),l=a.queries;a.queries=vT(),l.forEach(((u,h)=>{for(const m of h.Sa)m.onError(n)}))})(this,new he(se.ABORTED,"Firestore shutting down"))}}function vT(){return new Ya((s=>sA(s)),lh)}async function Lv(s,e){const t=Te(s);let n=3;const a=e.query;let l=t.queries.get(a);l?!l.ba()&&e.Da()&&(n=2):(l=new MP,n=e.Da()?0:1);try{switch(n){case 0:l.wa=await t.onListen(a,!0);break;case 1:l.wa=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(u){const h=au(u,`Initialization of query '${gc(e.query)}' failed`);return void e.onError(h)}t.queries.set(a,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&Uv(t)}async function Fv(s,e){const t=Te(s),n=e.query;let a=3;const l=t.queries.get(n);if(l){const u=l.Sa.indexOf(e);u>=0&&(l.Sa.splice(u,1),l.Sa.length===0?a=e.Da()?0:1:!l.ba()&&e.Da()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function VP(s,e){const t=Te(s);let n=!1;for(const a of e){const l=a.query,u=t.queries.get(l);if(u){for(const h of u.Sa)h.Fa(a)&&(n=!0);u.wa=a}}n&&Uv(t)}function LP(s,e,t){const n=Te(s),a=n.queries.get(e);if(a)for(const l of a.Sa)l.onError(t);n.queries.delete(e)}function Uv(s){s.Ca.forEach((e=>{e.next()}))}var Ox,bT;(bT=Ox||(Ox={})).Ma="default",bT.Cache="cache";class Bv{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new ll(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ll.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ox.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mj{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wT{constructor(e){this.serializer=e}$s(e){return ca(this.serializer,e)}Us(e){return e.metadata.exists?ug(this.serializer,e.document,!1):Ut.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return fn(e)}}class qv{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=gj(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const n=tt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,n=new wT(this.serializer);for(const a of e)if(a.metadata.queries){const l=n.$s(a.metadata.name);for(const u of a.metadata.queries){const h=(t.get(u)||Xe()).add(l);t.set(u,h)}}return t}async ja(e){const t=await hP(e,new wT(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(const a of this.Ka)await fP(e,a,n.get(a.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function gj(s){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pj{constructor(e){this.key=e}}class yj{constructor(e){this.key=e}}class xj{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Xe(),this.mutatedKeys=Xe(),this.eu=aA(e),this.tu=new Xo(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new xT,a=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,u=a,h=!1;const m=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((x,w)=>{const b=a.get(x),E=ch(this.query,w)?w:null,C=!!b&&this.mutatedKeys.has(b.key),k=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations);let L=!1;b&&E?b.data.isEqual(E.data)?C!==k&&(n.track({type:3,doc:E}),L=!0):this.su(b,E)||(n.track({type:2,doc:E}),L=!0,(m&&this.eu(E,m)>0||p&&this.eu(E,p)<0)&&(h=!0)):!b&&E?(n.track({type:0,doc:E}),L=!0):b&&!E&&(n.track({type:1,doc:b}),L=!0,(m||p)&&(h=!0)),L&&(E?(u=u.add(E),l=k?l.add(x):l.delete(x)):(u=u.delete(x),l=l.delete(x)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const x=this.query.limitType==="F"?u.last():u.first();u=u.delete(x.key),l=l.delete(x.key),n.track({type:1,doc:x})}return{tu:u,iu:n,Cs:h,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((x,w)=>(function(E,C){const k=L=>{switch(L){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ae(20277,{Rt:L})}};return k(E)-k(C)})(x.type,w.type)||this.eu(x.doc,w.doc))),this.ou(n),a=a??!1;const h=t&&!a?this._u():[],m=this.Xa.size===0&&this.current&&!a?1:0,p=m!==this.Za;return this.Za=m,u.length!==0||p?{snapshot:new ll(this.query,e.tu,l,u,e.mutatedKeys,m===0,p,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new xT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Xe(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new yj(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new pj(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=Xe();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ll.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const so="SyncEngine";class FP{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class UP{constructor(e){this.key=e,this.hu=!1}}class BP{constructor(e,t,n,a,l,u){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new Ya((h=>sA(h)),lh),this.Iu=new Map,this.Eu=new Set,this.du=new Ft(Ne.comparator),this.Au=new Map,this.Ru=new Sv,this.Vu={},this.mu=new Map,this.fu=il.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function qP(s,e,t=!0){const n=yg(s);let a;const l=n.Tu.get(e);return l?(n.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await vj(n,e,t,!0),a}async function zP(s,e){const t=yg(s);await vj(t,e,!0,!1)}async function vj(s,e,t,n){const a=await Bc(s.localStore,cs(e)),l=a.targetId,u=s.sharedClientState.addLocalQueryTarget(l,t);let h;return n&&(h=await zv(s,e,l,u==="current",a.resumeToken)),s.isPrimaryClient&&t&&pg(s.remoteStore,a),h}async function zv(s,e,t,n,a){s.pu=(w,b,E)=>(async function(k,L,U,F){let B=L.view.ru(U);B.Cs&&(B=await Pm(k.localStore,L.query,!1).then((({documents:R})=>L.view.ru(R,B))));const H=F&&F.targetChanges.get(L.targetId),$=F&&F.targetMismatches.get(L.targetId)!=null,M=L.view.applyChanges(B,k.isPrimaryClient,H,$);return Vx(k,L.targetId,M.au),M.snapshot})(s,w,b,E);const l=await Pm(s.localStore,e,!0),u=new xj(e,l.Qs),h=u.ru(l.documents),m=hh.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",a),p=u.applyChanges(h,s.isPrimaryClient,m);Vx(s,t,p.au);const x=new FP(e,t,u);return s.Tu.set(e,x),s.Iu.has(t)?s.Iu.get(t).push(e):s.Iu.set(t,[e]),p.snapshot}async function HP(s,e,t){const n=Te(s),a=n.Tu.get(e),l=n.Iu.get(a.targetId);if(l.length>1)return n.Iu.set(a.targetId,l.filter((u=>!lh(u,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await qc(n.localStore,a.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(a.targetId),t&&zc(n.remoteStore,a.targetId),Hc(n,a.targetId)})).catch(Zi)):(Hc(n,a.targetId),await qc(n.localStore,a.targetId,!0))}async function GP(s,e){const t=Te(s),n=t.Tu.get(e),a=t.Iu.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),zc(t.remoteStore,n.targetId))}async function $P(s,e,t){const n=Kv(s);try{const a=await(function(u,h){const m=Te(u),p=wt.now(),x=h.reduce(((E,C)=>E.add(C.key)),Xe());let w,b;return m.persistence.runTransaction("Locally write mutations","readwrite",(E=>{let C=Es(),k=Xe();return m.Ns.getEntries(E,x).next((L=>{C=L,C.forEach(((U,F)=>{F.isValidDocument()||(k=k.add(U))}))})).next((()=>m.localDocuments.getOverlayedDocuments(E,C))).next((L=>{w=L;const U=[];for(const F of h){const B=y4(F,w.get(F.key).overlayedDocument);B!=null&&U.push(new Xa(F.key,B,$S(B.value.mapValue),Kt.exists(!0)))}return m.mutationQueue.addMutationBatch(E,p,U,h)})).next((L=>{b=L;const U=L.applyToLocalDocumentSet(w,k);return m.documentOverlayCache.saveOverlays(E,L.batchId,U)}))})).then((()=>({batchId:b.batchId,changes:oA(w)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),(function(u,h,m){let p=u.Vu[u.currentUser.toKey()];p||(p=new Ft(qe)),p=p.insert(h,m),u.Vu[u.currentUser.toKey()]=p})(n,a.batchId,t),await Wa(n,a.changes),await su(n.remoteStore)}catch(a){const l=au(a,"Failed to persist write");t.reject(l)}}async function bj(s,e){const t=Te(s);try{const n=await uP(t.localStore,e);e.targetChanges.forEach(((a,l)=>{const u=t.Au.get(l);u&&(ke(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?u.hu=!0:a.modifiedDocuments.size>0?ke(u.hu,14607):a.removedDocuments.size>0&&(ke(u.hu,42227),u.hu=!1))})),await Wa(t,n,e)}catch(n){await Zi(n)}}function _T(s,e,t){const n=Te(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Tu.forEach(((l,u)=>{const h=u.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(u,h){const m=Te(u);m.onlineState=h;let p=!1;m.queries.forEach(((x,w)=>{for(const b of w.Sa)b.va(h)&&(p=!0)})),p&&Uv(m)})(n.eventManager,e),a.length&&n.Pu.H_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function KP(s,e,t){const n=Te(s);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Au.get(e),l=a&&a.key;if(l){let u=new Ft(Ne.comparator);u=u.insert(l,Ut.newNoDocument(l,Me.min()));const h=Xe().add(l),m=new dh(Me.min(),new Map,new Ft(qe),u,h);await bj(n,m),n.du=n.du.remove(l),n.Au.delete(e),$v(n)}else await qc(n.localStore,e,!1).then((()=>Hc(n,e,t))).catch(Zi)}async function QP(s,e){const t=Te(s),n=e.batch.batchId;try{const a=await cP(t.localStore,e);Gv(t,n,null),Hv(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Wa(t,a)}catch(a){await Zi(a)}}async function YP(s,e,t){const n=Te(s);try{const a=await(function(u,h){const m=Te(u);return m.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let x;return m.mutationQueue.lookupMutationBatch(p,h).next((w=>(ke(w!==null,37113),x=w.keys(),m.mutationQueue.removeMutationBatch(p,w)))).next((()=>m.mutationQueue.performConsistencyCheck(p))).next((()=>m.documentOverlayCache.removeOverlaysForBatchId(p,x,h))).next((()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,x))).next((()=>m.localDocuments.getDocuments(p,x)))}))})(n.localStore,e);Gv(n,e,t),Hv(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Wa(n,a)}catch(a){await Zi(a)}}async function XP(s,e){const t=Te(s);no(t.remoteStore)||ge(so,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=await(function(u){const h=Te(u);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(m=>h.mutationQueue.getHighestUnacknowledgedBatchId(m)))})(t.localStore);if(n===Hi)return void e.resolve();const a=t.mu.get(n)||[];a.push(e),t.mu.set(n,a)}catch(n){const a=au(n,"Initialization of waitForPendingWrites() operation failed");e.reject(a)}}function Hv(s,e){(s.mu.get(e)||[]).forEach((t=>{t.resolve()})),s.mu.delete(e)}function Gv(s,e,t){const n=Te(s);let a=n.Vu[n.currentUser.toKey()];if(a){const l=a.get(e);l&&(t?l.reject(t):l.resolve(),a=a.remove(e)),n.Vu[n.currentUser.toKey()]=a}}function Hc(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Iu.get(e))s.Tu.delete(n),t&&s.Pu.yu(n,t);s.Iu.delete(e),s.isPrimaryClient&&s.Ru.jr(e).forEach((n=>{s.Ru.containsKey(n)||wj(s,n)}))}function wj(s,e){s.Eu.delete(e.path.canonicalString());const t=s.du.get(e);t!==null&&(zc(s.remoteStore,t),s.du=s.du.remove(e),s.Au.delete(t),$v(s))}function Vx(s,e,t){for(const n of t)n instanceof pj?(s.Ru.addReference(n.key,e),WP(s,n)):n instanceof yj?(ge(so,"Document no longer in limbo: "+n.key),s.Ru.removeReference(n.key,e),s.Ru.containsKey(n.key)||wj(s,n.key)):Ae(19791,{wu:n})}function WP(s,e){const t=e.key,n=t.path.canonicalString();s.du.get(t)||s.Eu.has(n)||(ge(so,"New document in limbo: "+t),s.Eu.add(n),$v(s))}function $v(s){for(;s.Eu.size>0&&s.du.size<s.maxConcurrentLimboResolutions;){const e=s.Eu.values().next().value;s.Eu.delete(e);const t=new Ne(tt.fromString(e)),n=s.fu.next();s.Au.set(n,new UP(t)),s.du=s.du.insert(t,n),pg(s.remoteStore,new La(cs(Zc(t.path)),n,"TargetPurposeLimboResolution",Ns.ce))}}async function Wa(s,e,t){const n=Te(s),a=[],l=[],u=[];n.Tu.isEmpty()||(n.Tu.forEach(((h,m)=>{u.push(n.pu(m,e,t).then((p=>{if((p||t)&&n.isPrimaryClient){const x=p?!p.fromCache:t?.targetChanges.get(m.targetId)?.current;n.sharedClientState.updateQueryState(m.targetId,x?"current":"not-current")}if(p){a.push(p);const x=Cv.As(m.targetId,p);l.push(x)}})))})),await Promise.all(u),n.Pu.H_(a),await(async function(m,p){const x=Te(m);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",(w=>W.forEach(p,(b=>W.forEach(b.Es,(E=>x.persistence.referenceDelegate.addReference(w,b.targetId,E))).next((()=>W.forEach(b.ds,(E=>x.persistence.referenceDelegate.removeReference(w,b.targetId,E)))))))))}catch(w){if(!eo(w))throw w;ge(Rv,"Failed to update sequence numbers: "+w)}for(const w of p){const b=w.targetId;if(!w.fromCache){const E=x.Ms.get(b),C=E.snapshotVersion,k=E.withLastLimboFreeSnapshotVersion(C);x.Ms=x.Ms.insert(b,k)}}})(n.localStore,l))}async function JP(s,e){const t=Te(s);if(!t.currentUser.isEqual(e)){ge(so,"User change. New user:",e.toKey());const n=await WA(t.localStore,e);t.currentUser=e,(function(l,u){l.mu.forEach((h=>{h.forEach((m=>{m.reject(new he(se.CANCELLED,u))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Wa(t,n.Ls)}}function ZP(s,e){const t=Te(s),n=t.Au.get(e);if(n&&n.hu)return Xe().add(n.key);{let a=Xe();const l=t.Iu.get(e);if(!l)return a;for(const u of l){const h=t.Tu.get(u);a=a.unionWith(h.view.nu)}return a}}async function e6(s,e){const t=Te(s),n=await Pm(t.localStore,e.query,!0),a=e.view.cu(n);return t.isPrimaryClient&&Vx(t,e.targetId,a.au),a}async function t6(s,e){const t=Te(s);return tj(t.localStore,e).then((n=>Wa(t,n)))}async function n6(s,e,t,n){const a=Te(s),l=await(function(h,m){const p=Te(h),x=Te(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",(w=>x.er(w,m).next((b=>b?p.localDocuments.getDocuments(w,b):W.resolve(null)))))})(a.localStore,e);l!==null?(t==="pending"?await su(a.remoteStore):t==="acknowledged"||t==="rejected"?(Gv(a,e,n||null),Hv(a,e),(function(h,m){Te(Te(h).mutationQueue).ir(m)})(a.localStore,e)):Ae(6720,"Unknown batchState",{Su:t}),await Wa(a,l)):ge(so,"Cannot apply mutation batch with id: "+e)}async function s6(s,e){const t=Te(s);if(yg(t),Kv(t),e===!0&&t.gu!==!0){const n=t.sharedClientState.getAllActiveQueryTargets(),a=await NT(t,n.toArray());t.gu=!0,await Mx(t.remoteStore,!0);for(const l of a)pg(t.remoteStore,l)}else if(e===!1&&t.gu!==!1){const n=[];let a=Promise.resolve();t.Iu.forEach(((l,u)=>{t.sharedClientState.isLocalQueryTarget(u)?n.push(u):a=a.then((()=>(Hc(t,u),qc(t.localStore,u,!0)))),zc(t.remoteStore,u)})),await a,await NT(t,n),(function(u){const h=Te(u);h.Au.forEach(((m,p)=>{zc(h.remoteStore,p)})),h.Ru.Jr(),h.Au=new Map,h.du=new Ft(Ne.comparator)})(t),t.gu=!1,await Mx(t.remoteStore,!1)}}async function NT(s,e,t){const n=Te(s),a=[],l=[];for(const u of e){let h;const m=n.Iu.get(u);if(m&&m.length!==0){h=await Bc(n.localStore,cs(m[0]));for(const p of m){const x=n.Tu.get(p),w=await e6(n,x);w.snapshot&&l.push(w.snapshot)}}else{const p=await ej(n.localStore,u);h=await Bc(n.localStore,p),await zv(n,_j(p),u,!1,h.resumeToken)}a.push(h)}return n.Pu.H_(l),a}function _j(s){return eA(s.path,s.collectionGroup,s.orderBy,s.filters,s.limit,"F",s.startAt,s.endAt)}function r6(s){return(function(t){return Te(Te(t).persistence).Ts()})(Te(s).localStore)}async function a6(s,e,t,n){const a=Te(s);if(a.gu)return void ge(so,"Ignoring unexpected query state notification.");const l=a.Iu.get(e);if(l&&l.length>0)switch(t){case"current":case"not-current":{const u=await tj(a.localStore,rA(l[0])),h=dh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",en.EMPTY_BYTE_STRING);await Wa(a,u,h);break}case"rejected":await qc(a.localStore,e,!0),Hc(a,e,n);break;default:Ae(64155,t)}}async function i6(s,e,t){const n=yg(s);if(n.gu){for(const a of e){if(n.Iu.has(a)&&n.sharedClientState.isActiveQueryTarget(a)){ge(so,"Adding an already active target "+a);continue}const l=await ej(n.localStore,a),u=await Bc(n.localStore,l);await zv(n,_j(l),u.targetId,!1,u.resumeToken),pg(n.remoteStore,u)}for(const a of t)n.Iu.has(a)&&await qc(n.localStore,a,!1).then((()=>{zc(n.remoteStore,a),Hc(n,a)})).catch(Zi)}}function yg(s){const e=Te(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=bj.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ZP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=KP.bind(null,e),e.Pu.H_=VP.bind(null,e.eventManager),e.Pu.yu=LP.bind(null,e.eventManager),e}function Kv(s){const e=Te(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=QP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=YP.bind(null,e),e}function o6(s,e,t){const n=Te(s);(async function(l,u,h){try{const m=await u.getMetadata();if(await(function(E,C){const k=Te(E),L=fn(C.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",(U=>k.Ii.getBundleMetadata(U,C.id))).then((U=>!!U&&U.createTime.compareTo(L)>=0))})(l.localStore,m))return await u.close(),h._completeWith((function(E){return{taskState:"Success",documentsLoaded:E.totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}})(m)),Promise.resolve(new Set);h._updateProgress(gj(m));const p=new qv(m,u.serializer);let x=await u.bu();for(;x;){const b=await p.Ga(x);b&&h._updateProgress(b),x=await u.bu()}const w=await p.ja(l.localStore);return await Wa(l,w.Ha,void 0),await(function(E,C){const k=Te(E);return k.persistence.runTransaction("Save bundle","readwrite",(L=>k.Ii.saveBundleMetadata(L,C)))})(l.localStore,m),h._completeWith(w.progress),Promise.resolve(w.Ja)}catch(m){return Ws(so,`Loading bundle failed with ${m}`),h._failWith(m),Promise.resolve(new Set)}})(n,e,t).then((a=>{n.sharedClientState.notifyBundleLoaded(a)}))}class Gc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return XA(this.persistence,new YA,e.initialUser,this.serializer)}Cu(e){return new Av(gg.mi,this.serializer)}Du(e){return new ij}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gc.provider={build:()=>new Gc};class Qv extends Gc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ke(this.persistence.referenceDelegate instanceof Dm,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new zA(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?as.withCacheSize(this.cacheSizeBytes):as.DEFAULT;return new Av((n=>Dm.mi(n,t)),this.serializer)}}class Yv extends Gc{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Kv(this.xu.syncEngine),await su(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return XA(this.persistence,new YA,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new zA(n,e.asyncQueue,t)}Mu(e,t){const n=new wD(t,this.persistence);return new bD(e.asyncQueue,n)}Cu(e){const t=Iv(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?as.withCacheSize(this.cacheSizeBytes):as.DEFAULT;return new jv(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,oj(),lm(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new ij}}class Nj extends Yv{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Hy&&(this.sharedClientState.syncEngine={Co:n6.bind(null,t),vo:a6.bind(null,t),Fo:i6.bind(null,t),Ts:r6.bind(null,t),Do:t6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async n=>{await s6(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))}Du(e){const t=oj();if(!Hy.v(t))throw new he(se.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Iv(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Hy(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Wi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>_T(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=JP.bind(null,this.syncEngine),await Mx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new OP})()}createDatastore(e){const t=fl(e.databaseInfo.databaseId),n=(function(l){return new xP(l)})(e.databaseInfo);return(function(l,u,h,m){return new _P(l,u,h,m)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,a,l,u,h){return new TP(n,a,l,u,h)})(this.localStore,this.datastore,e.asyncQueue,(t=>_T(this.syncEngine,t,0)),(function(){return gT.v()?new gT:new mP})())}createSyncEngine(e,t){return(function(a,l,u,h,m,p,x){const w=new BP(a,l,u,h,m,p);return x&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=Te(t);ge(ol,"RemoteStore shutting down."),n.Ea.add(5),await nu(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Wi.provider={build:()=>new Wi};function TT(s,e=10240){let t=0;return{async read(){if(t<s.byteLength){const n={value:s.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):hn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l6{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Hn,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((n=>{n&&n.$a()?this.metadata.resolve(n.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.Qa)}`))}),(n=>this.metadata.reject(n)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),n=Number(t);isNaN(n)&&this.Qu(`length string (${t}) is not valid number`);const a=await this.$u(n);return new mj(JSON.parse(a),e.length+n)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.Qa)}`);this.metadata=n;do n=this.bu(),n!==null&&this.elements.push(n);while(n!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new mj(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new he(se.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new he(se.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(a,l){const u=Te(a),h={documents:l.map((w=>Xd(u.serializer,w)))},m=await u.Ho("BatchGetDocuments",u.serializer.databaseId,tt.emptyPath(),h,l.length),p=new Map;m.forEach((w=>{const b=S4(u.serializer,w);p.set(b.key.toString(),b)}));const x=[];return l.forEach((w=>{const b=p.get(w.toString());ke(!!b,55234,{key:w}),x.push(b)})),x})(this.datastore,e);return t.forEach((n=>this.recordVersion(n))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new tu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,n)=>{const a=Ne.fromPath(n);this.mutations.push(new xv(a,this.precondition(a)))})),await(async function(n,a){const l=Te(n),u={writes:a.map((h=>Wd(l.serializer,h)))};await l.Go("Commit",l.serializer.databaseId,tt.emptyPath(),u)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ae(50498,{Gu:e.constructor.name});t=Me.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new he(se.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Me.min())?Kt.exists(!1):Kt.updateTime(t):Kt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Me.min()))throw new he(se.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Kt.updateTime(t)}return Kt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d6{constructor(e,t,n,a,l){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=a,this.deferred=l,this.zu=n.maxAttempts,this.M_=new Dv(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new u6(this.datastore),t=this.Hu(e);t&&t.then((n=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(n)})).catch((a=>{this.Yu(a)}))))})).catch((n=>{this.Yu(n)}))}))}Hu(e){try{const t=this.updateFunction(e);return!ah(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!xA(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ji="FirestoreClient";class h6{constructor(e,t,n,a,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=zn.UNAUTHENTICATED,this.clientId=Zm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(n,(async u=>{ge(Ji,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(n,(u=>(ge(Ji,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Hn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=au(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function $y(s,e){s.asyncQueue.verifyOperationInProgress(),ge(Ji,"Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener((async a=>{n.isEqual(a)||(await WA(e.localStore,a),n=a)})),e.persistence.setDatabaseDeletedListener((()=>s.terminate())),s._offlineComponents=e}async function ET(s,e){s.asyncQueue.verifyOperationInProgress();const t=await Xv(s);ge(Ji,"Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener((n=>yT(e.remoteStore,n))),s.setAppCheckTokenChangeListener(((n,a)=>yT(e.remoteStore,a))),s._onlineComponents=e}async function Xv(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){ge(Ji,"Using user provided OfflineComponentProvider");try{await $y(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(a){return a.name==="FirebaseError"?a.code===se.FAILED_PRECONDITION||a.code===se.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(t))throw t;Ws("Error using user provided cache. Falling back to memory cache: "+t),await $y(s,new Gc)}}else ge(Ji,"Using default OfflineComponentProvider"),await $y(s,new Qv(void 0));return s._offlineComponents}async function vg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(ge(Ji,"Using user provided OnlineComponentProvider"),await ET(s,s._uninitializedComponentsProvider._online)):(ge(Ji,"Using default OnlineComponentProvider"),await ET(s,new Wi))),s._onlineComponents}function Tj(s){return Xv(s).then((e=>e.persistence))}function iu(s){return Xv(s).then((e=>e.localStore))}function Ej(s){return vg(s).then((e=>e.remoteStore))}function Wv(s){return vg(s).then((e=>e.syncEngine))}function Sj(s){return vg(s).then((e=>e.datastore))}async function $c(s){const e=await vg(s),t=e.eventManager;return t.onListen=qP.bind(null,e.syncEngine),t.onUnlisten=HP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=zP.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=GP.bind(null,e.syncEngine),t}function f6(s){return s.asyncQueue.enqueue((async()=>{const e=await Tj(s),t=await Ej(s);return e.setNetworkEnabled(!0),(function(a){const l=Te(a);return l.Ea.delete(0),fh(l)})(t)}))}function m6(s){return s.asyncQueue.enqueue((async()=>{const e=await Tj(s),t=await Ej(s);return e.setNetworkEnabled(!1),(async function(a){const l=Te(a);l.Ea.add(0),await nu(l),l.Ra.set("Offline")})(t)}))}function g6(s,e){const t=new Hn;return s.asyncQueue.enqueueAndForget((async()=>(async function(a,l,u){try{const h=await(function(p,x){const w=Te(p);return w.persistence.runTransaction("read document","readonly",(b=>w.localDocuments.getDocument(b,x)))})(a,l);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new he(se.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const m=au(h,`Failed to get document '${l} from cache`);u.reject(m)}})(await iu(s),e,t))),t.promise}function Aj(s,e,t={}){const n=new Hn;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new xg({next:b=>{x.Nu(),u.enqueueAndForget((()=>Fv(l,w)));const E=b.docs.has(h);!E&&b.fromCache?p.reject(new he(se.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&b.fromCache&&m&&m.source==="server"?p.reject(new he(se.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(b)},error:b=>p.reject(b)}),w=new Bv(Zc(h.path),x,{includeMetadataChanges:!0,qa:!0});return Lv(l,w)})(await $c(s),s.asyncQueue,e,t,n))),n.promise}function p6(s,e){const t=new Hn;return s.asyncQueue.enqueueAndForget((async()=>(async function(a,l,u){try{const h=await Pm(a,l,!0),m=new xj(l,h.Qs),p=m.ru(h.documents),x=m.applyChanges(p,!1);u.resolve(x.snapshot)}catch(h){const m=au(h,`Failed to execute query '${l} against cache`);u.reject(m)}})(await iu(s),e,t))),t.promise}function jj(s,e,t={}){const n=new Hn;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new xg({next:b=>{x.Nu(),u.enqueueAndForget((()=>Fv(l,w))),b.fromCache&&m.source==="server"?p.reject(new he(se.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(b)},error:b=>p.reject(b)}),w=new Bv(h,x,{includeMetadataChanges:!0,qa:!0});return Lv(l,w)})(await $c(s),s.asyncQueue,e,t,n))),n.promise}function y6(s,e,t){const n=new Hn;return s.asyncQueue.enqueueAndForget((async()=>{try{const a=await Sj(s);n.resolve((async function(u,h,m){const p=Te(u),{request:x,gt:w,parent:b}=IA(p.serializer,tA(h),m);p.connection.$o||delete x.parent;const E=(await p.Ho("RunAggregationQuery",p.serializer.databaseId,b,x,1)).filter((k=>!!k.result));ke(E.length===1,64727);const C=E[0].result?.aggregateFields;return Object.keys(C).reduce(((k,L)=>(k[w[L]]=C[L],k)),{})})(a,e,t))}catch(a){n.reject(a)}})),n.promise}function x6(s,e){const t=new xg(e);return s.asyncQueue.enqueueAndForget((async()=>(function(a,l){Te(a).Ca.add(l),l.next()})(await $c(s),t))),()=>{t.Nu(),s.asyncQueue.enqueueAndForget((async()=>(function(a,l){Te(a).Ca.delete(l)})(await $c(s),t)))}}function v6(s,e,t,n){const a=(function(u,h){let m;return m=typeof u=="string"?bA().encode(u):u,(function(x,w){return new l6(x,w)})((function(x,w){if(x instanceof Uint8Array)return TT(x,w);if(x instanceof ArrayBuffer)return TT(new Uint8Array(x),w);if(x instanceof ReadableStream)return x.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(m),h)})(t,fl(e));s.asyncQueue.enqueueAndForget((async()=>{o6(await Wv(s),a,n)}))}function b6(s,e){return s.asyncQueue.enqueue((async()=>(function(n,a){const l=Te(n);return l.persistence.runTransaction("Get named query","readonly",(u=>l.Ii.getNamedQuery(u,a)))})(await iu(s),e)))}function Ij(s,e){return(function(n,a){return new c6(n,a)})(s,e)}function w6(s,e){return s.asyncQueue.enqueue((async()=>(async function(n,a){const l=Te(n),u=l.indexManager,h=[];return l.persistence.runTransaction("Configure indexes","readwrite",(m=>u.getFieldIndexes(m).next((p=>(function(w,b,E,C,k){w=[...w],b=[...b],w.sort(E),b.sort(E);const L=w.length,U=b.length;let F=0,B=0;for(;F<U&&B<L;){const H=E(w[B],b[F]);H<0?k(w[B++]):H>0?C(b[F++]):(F++,B++)}for(;F<U;)C(b[F++]);for(;B<L;)k(w[B++])})(p,a,pD,(x=>{h.push(u.addFieldIndex(m,x))}),(x=>{h.push(u.deleteFieldIndex(m,x))})))).next((()=>W.waitFor(h)))))})(await iu(s),e)))}function _6(s,e){return s.asyncQueue.enqueue((async()=>(function(n,a){Te(n).Fs.Vs=a})(await iu(s),e)))}function N6(s){return s.asyncQueue.enqueue((async()=>(function(t){const n=Te(t),a=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",(l=>a.deleteAllFieldIndexes(l)))})(await iu(s))))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cj(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj="firestore.googleapis.com",AT=!0;class jT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new he(se.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Rj,this.ssl=AT}else this.host=e.host,this.ssl=e.ssl??AT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=LA;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qA)throw new he(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}yS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cj(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new he(se.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new he(se.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new he(se.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,a){return n.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mh{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(se.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(se.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new gS;switch(n.type){case"firstParty":return new cD(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new he(se.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=ST.get(t);n&&(ge("ComponentProvider","Removing Datastore"),ST.delete(t),n.terminate())})(this),Promise.resolve()}}function kj(s,e,t,n={}){s=nt(s,mh);const a=Ka(e),l=s._getSettings(),u={...l,emulatorOptions:s._getEmulatorOptions()},h=`${e}:${t}`;a&&(Km(`https://${h}`),Gx("Firestore",!0)),l.host!==Rj&&l.host!==h&&Ws("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...l,host:h,ssl:a,emulatorOptions:n};if(!yr(m,u)&&(s._setSettings(m),n.mockUserToken)){let p,x;if(typeof n.mockUserToken=="string")p=n.mockUserToken,x=zn.MOCK_USER;else{p=II(n.mockUserToken,s._app?.options.projectId);const w=n.mockUserToken.sub||n.mockUserToken.user_id;if(!w)throw new he(se.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new zn(w)}s._authCredentials=new iD(new mS(p,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new In(this.firestore,e,this._query)}}class At{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Or(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new At(this.firestore,e,this._key)}toJSON(){return{type:At._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(hl(t,At._jsonSchema))return new At(e,n||null,new Ne(tt.fromString(t.referencePath)))}}At._jsonSchemaVersion="firestore/documentReference/1.0",At._jsonSchema={type:vn("string",At._jsonSchemaVersion),referencePath:vn("string")};class Or extends In{constructor(e,t,n){super(e,t,Zc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new At(this.firestore,null,new Ne(e))}withConverter(e){return new Or(this.firestore,e,this._path)}}function Ce(s,e,...t){if(s=mt(s),av("collection","path",e),s instanceof mh){const n=tt.fromString(e,...t);return pN(n),new Or(s,null,n)}{if(!(s instanceof At||s instanceof Or))throw new he(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(tt.fromString(e,...t));return pN(n),new Or(s.firestore,null,n)}}function T6(s,e){if(s=nt(s,mh),av("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new he(se.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new In(s,null,(function(n){return new Qa(tt.emptyPath(),n)})(e))}function ve(s,e,...t){if(s=mt(s),arguments.length===1&&(e=Zm.newId()),av("doc","path",e),s instanceof mh){const n=tt.fromString(e,...t);return gN(n),new At(s,null,new Ne(n))}{if(!(s instanceof At||s instanceof Or))throw new he(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(tt.fromString(e,...t));return gN(n),new At(s.firestore,s instanceof Or?s.converter:null,new Ne(n))}}function E6(s,e){return s=mt(s),e=mt(e),(s instanceof At||s instanceof Or)&&(e instanceof At||e instanceof Or)&&s.firestore===e.firestore&&s.path===e.path&&s.converter===e.converter}function Jv(s,e){return s=mt(s),e=mt(e),s instanceof In&&e instanceof In&&s.firestore===e.firestore&&lh(s._query,e._query)&&s.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IT="AsyncQueue";class CT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Dv(this,"async_queue_retry"),this._c=()=>{const n=lm();n&&ge(IT,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=lm();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=lm();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Hn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!eo(e))throw e;ge(IT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,hn("INTERNAL UNHANDLED ERROR: ",RT(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const a=Vv.createAndSchedule(this,e,t,n,(l=>this.hc(l)));return this.tc.push(a),a}uc(){this.nc&&Ae(47125,{Pc:RT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function RT(s){let e=s.message||"";return s.stack&&(e=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tc(s){return(function(t,n){if(typeof t!="object"||t===null)return!1;const a=t;for(const l of n)if(l in a&&typeof a[l]=="function")return!0;return!1})(s,["next","error","complete"])}class Dj{constructor(){this._progressObserver={},this._taskCompletionResolver=new Hn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S6=-1;class Pt extends mh{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new CT,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new CT(e),this._firestoreClient=void 0,await e}}}function A6(s,e,t){t||(t=$d);const n=ha(s,"firestore");if(n.isInitialized(t)){const a=n.getImmediate({identifier:t}),l=n.getOptions(t);if(yr(l,e))return a;throw new he(se.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new he(se.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qA)throw new he(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Ka(e.host)&&Km(e.host),n.initialize({options:e,instanceIdentifier:t})}function Pj(s,e){const t=typeof s=="object"?s:Ym(),n=typeof s=="string"?s:e||$d,a=ha(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const l=fE("firestore");l&&kj(a,...l)}return a}function Qt(s){if(s._terminated)throw new he(se.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||Mj(s),s._firestoreClient}function Mj(s){const e=s._freezeSettings(),t=(function(a,l,u,h){return new XD(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Cj(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(s._databaseId,s._app?.options.appId||"",s._persistenceKey,e);s._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(s._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),s._firestoreClient=new h6(s._authCredentials,s._appCheckCredentials,s._queue,t,s._componentsProvider&&(function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}})(s._componentsProvider))}function j6(s,e){Ws("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=s._freezeSettings();return Oj(s,Wi.provider,{build:n=>new Yv(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function I6(s){Ws("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=s._freezeSettings();Oj(s,Wi.provider,{build:t=>new Nj(t,e.cacheSizeBytes)})}function Oj(s,e,t){if((s=nt(s,Pt))._firestoreClient||s._terminated)throw new he(se.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(s._componentsProvider||s._getSettings().localCache)throw new he(se.FAILED_PRECONDITION,"SDK cache is already specified.");s._componentsProvider={_online:e,_offline:t},Mj(s)}function C6(s){if(s._initialized&&!s._terminated)throw new he(se.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Hn;return s._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(n){if(!la.v())return Promise.resolve();const a=n+QA;await la.delete(a)})(Iv(s._databaseId,s._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function R6(s){return(function(t){const n=new Hn;return t.asyncQueue.enqueueAndForget((async()=>XP(await Wv(t),n))),n.promise})(Qt(s=nt(s,Pt)))}function k6(s){return f6(Qt(s=nt(s,Pt)))}function D6(s){return m6(Qt(s=nt(s,Pt)))}function P6(s){return zC(s.app,"firestore",s._databaseId.database),s._delete()}function Lx(s,e){const t=Qt(s=nt(s,Pt)),n=new Dj;return v6(t,s._databaseId,e,n),n}function Vj(s,e){return b6(Qt(s=nt(s,Pt)),e).then((t=>t?new In(s,null,t.query):null))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class Lj{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _s(en.fromBase64String(e))}catch(t){throw new he(se.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _s(en.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:_s._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(hl(e,_s._jsonSchema))return _s.fromBase64String(e.bytes)}}_s._jsonSchemaVersion="firestore/bytes/1.0",_s._jsonSchema={type:vn("string",_s._jsonSchemaVersion),bytes:vn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(se.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function M6(){return new ro(fx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(se.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(se.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return qe(this._lat,e._lat)||qe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Vr._jsonSchemaVersion}}static fromJSON(e){if(hl(e,Vr._jsonSchema))return new Vr(e.latitude,e.longitude)}}Vr._jsonSchemaVersion="firestore/geoPoint/1.0",Vr._jsonSchema={type:vn("string",Vr._jsonSchemaVersion),latitude:vn("number"),longitude:vn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,a){if(n.length!==a.length)return!1;for(let l=0;l<n.length;++l)if(n[l]!==a[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:pr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(hl(e,pr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new pr(e.vectorValues);throw new he(se.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}pr._jsonSchemaVersion="firestore/vectorValue/1.0",pr._jsonSchema={type:vn("string",pr._jsonSchemaVersion),vectorValues:vn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O6=/^__.*__$/;class V6{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Xa(e,this.data,this.fieldMask,t,this.fieldTransforms):new eu(e,this.data,t,this.fieldTransforms)}}class Fj{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Xa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Uj(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ae(40011,{Ac:s})}}class bg{constructor(e,t,n,a,l,u){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new bg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Lm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Uj(this.Ac)&&O6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class L6{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||fl(e)}Cc(e,t,n,a=!1){return new bg({Ac:e,methodName:t,Dc:n,path:Bt.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ml(s){const e=s._freezeSettings(),t=fl(s._databaseId);return new L6(s._databaseId,!!e.ignoreUndefinedProperties,t)}function wg(s,e,t,n,a,l={}){const u=s.Cc(l.merge||l.mergeFields?2:0,e,t,a);ab("Data must be an object, but it was:",u,n);const h=zj(n,u);let m,p;if(l.merge)m=new Ts(u.fieldMask),p=u.fieldTransforms;else if(l.mergeFields){const x=[];for(const w of l.mergeFields){const b=Jd(e,w,t);if(!u.contains(b))throw new he(se.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);Gj(x,b)||x.push(b)}m=new Ts(x),p=u.fieldTransforms.filter((w=>m.covers(w.field)))}else m=null,p=u.fieldTransforms;return new V6(new Zn(h),m,p)}class gh extends ao{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gh}}function Bj(s,e,t){return new bg({Ac:3,Dc:e.settings.Dc,methodName:s._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Zv extends ao{_toFieldTransform(e){return new uh(e.path,new Lc)}isEqual(e){return e instanceof Zv}}class eb extends ao{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Bj(this,e,!0),n=this.vc.map((l=>gl(l,t))),a=new nl(n);return new uh(e.path,a)}isEqual(e){return e instanceof eb&&yr(this.vc,e.vc)}}class tb extends ao{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Bj(this,e,!0),n=this.vc.map((l=>gl(l,t))),a=new sl(n);return new uh(e.path,a)}isEqual(e){return e instanceof tb&&yr(this.vc,e.vc)}}class nb extends ao{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Fc(e.serializer,uA(e.serializer,this.Fc));return new uh(e.path,t)}isEqual(e){return e instanceof nb&&this.Fc===e.Fc}}function sb(s,e,t,n){const a=s.Cc(1,e,t);ab("Data must be an object, but it was:",a,n);const l=[],u=Zn.empty();to(n,((m,p)=>{const x=_g(e,m,t);p=mt(p);const w=a.yc(x);if(p instanceof gh)l.push(x);else{const b=gl(p,w);b!=null&&(l.push(x),u.set(x,b))}}));const h=new Ts(l);return new Fj(u,h,a.fieldTransforms)}function rb(s,e,t,n,a,l){const u=s.Cc(1,e,t),h=[Jd(e,n,t)],m=[a];if(l.length%2!=0)throw new he(se.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<l.length;b+=2)h.push(Jd(e,l[b])),m.push(l[b+1]);const p=[],x=Zn.empty();for(let b=h.length-1;b>=0;--b)if(!Gj(p,h[b])){const E=h[b];let C=m[b];C=mt(C);const k=u.yc(E);if(C instanceof gh)p.push(E);else{const L=gl(C,k);L!=null&&(p.push(E),x.set(E,L))}}const w=new Ts(p);return new Fj(x,w,u.fieldTransforms)}function qj(s,e,t,n=!1){return gl(t,s.Cc(n?4:3,e))}function gl(s,e){if(Hj(s=mt(s)))return ab("Unsupported field value:",e,s),zj(s,e);if(s instanceof ao)return(function(n,a){if(!Uj(a.Ac))throw a.Sc(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${n._methodName}() is not currently supported inside arrays`);const l=n._toFieldTransform(a);l&&a.fieldTransforms.push(l)})(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,a){const l=[];let u=0;for(const h of n){let m=gl(h,a.wc(u));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),u++}return{arrayValue:{values:l}}})(s,e)}return(function(n,a){if((n=mt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return uA(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const l=wt.fromDate(n);return{timestampValue:Uc(a.serializer,l)}}if(n instanceof wt){const l=new wt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Uc(a.serializer,l)}}if(n instanceof Vr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof _s)return{bytesValue:NA(a.serializer,n._byteString)};if(n instanceof At){const l=a.databaseId,u=n.firestore._databaseId;if(!u.isEqual(l))throw a.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:Nv(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof pr)return(function(u,h){return{mapValue:{fields:{[hv]:{stringValue:fv},[Mc]:{arrayValue:{values:u.toArray().map((p=>{if(typeof p!="number")throw h.Sc("VectorValues must only contain numeric values.");return yv(h.serializer,p)}))}}}}}})(n,a);throw a.Sc(`Unsupported field value: ${eg(n)}`)})(s,e)}function zj(s,e){const t={};return VS(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):to(s,((n,a)=>{const l=gl(a,e.mc(n));l!=null&&(t[n]=l)})),{mapValue:{fields:t}}}function Hj(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof wt||s instanceof Vr||s instanceof _s||s instanceof At||s instanceof ao||s instanceof pr)}function ab(s,e,t){if(!Hj(t)||!xS(t)){const n=eg(t);throw n==="an object"?e.Sc(s+" a custom object"):e.Sc(s+" "+n)}}function Jd(s,e,t){if((e=mt(e))instanceof ro)return e._internalPath;if(typeof e=="string")return _g(s,e);throw Lm("Field path arguments must be of type string or ",s,!1,void 0,t)}const F6=new RegExp("[~\\*/\\[\\]]");function _g(s,e,t){if(e.search(F6)>=0)throw Lm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new ro(...e.split("."))._internalPath}catch{throw Lm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function Lm(s,e,t,n,a){const l=n&&!n.isEmpty(),u=a!==void 0;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let m="";return(l||u)&&(m+=" (found",l&&(m+=` in field ${n}`),u&&(m+=` in document ${a}`),m+=")"),new he(se.INVALID_ARGUMENT,h+s+m)}function Gj(s,e){return s.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(e,t,n,a,l){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new At(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new U6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ng("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class U6 extends Zd{data(){return super.data()}}function Ng(s,e){return typeof e=="string"?_g(s,e):e instanceof ro?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $j(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new he(se.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ib{}class ou extends ib{}function Le(s,e,...t){let n=[];e instanceof ib&&n.push(e),n=n.concat(t),(function(l){const u=l.filter((m=>m instanceof pl)).length,h=l.filter((m=>m instanceof lu)).length;if(u>1||u>0&&h>0)throw new he(se.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const a of n)s=a._apply(s);return s}class lu extends ou{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new lu(e,t,n)}_apply(e){const t=this._parse(e);return Qj(e._query,t),new In(e.firestore,e.converter,Tx(e._query,t))}_parse(e){const t=ml(e.firestore);return(function(l,u,h,m,p,x,w){let b;if(p.isKeyField()){if(x==="array-contains"||x==="array-contains-any")throw new he(se.INVALID_ARGUMENT,`Invalid Query. You can't perform '${x}' queries on documentId().`);if(x==="in"||x==="not-in"){DT(w,x);const C=[];for(const k of w)C.push(kT(m,l,k));b={arrayValue:{values:C}}}else b=kT(m,l,w)}else x!=="in"&&x!=="not-in"&&x!=="array-contains-any"||DT(w,x),b=qj(h,u,w,x==="in"||x==="not-in");return ot.create(p,x,b)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ye(s,e,t){const n=e,a=Ng("where",s);return lu._create(a,n,t)}class pl extends ib{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new pl(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:St.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(a,l){let u=a;const h=l.getFlattenedFilters();for(const m of h)Qj(u,m),u=Tx(u,m)})(e._query,t),new In(e.firestore,e.converter,Tx(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function B6(...s){return s.forEach((e=>Yj("or",e))),pl._create("or",s)}function q6(...s){return s.forEach((e=>Yj("and",e))),pl._create("and",s)}class Tg extends ou{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Tg(e,t)}_apply(e){const t=(function(a,l,u){if(a.startAt!==null)throw new he(se.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new he(se.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Yd(l,u)})(e._query,this._field,this._direction);return new In(e.firestore,e.converter,(function(a,l){const u=a.explicitOrderBy.concat([l]);return new Qa(a.path,a.collectionGroup,u,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)})(e._query,t))}}function Jt(s,e="asc"){const t=e,n=Ng("orderBy",s);return Tg._create(n,t)}class ph extends ou{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ph(e,t,n)}_apply(e){return new In(e.firestore,e.converter,Im(e._query,this._limit,this._limitType))}}function Zt(s){return vS("limit",s),ph._create("limit",s,"F")}function z6(s){return vS("limitToLast",s),ph._create("limitToLast",s,"L")}class yh extends ou{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new yh(e,t,n)}_apply(e){const t=Kj(e,this.type,this._docOrFields,this._inclusive);return new In(e.firestore,e.converter,(function(a,l){return new Qa(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,l,a.endAt)})(e._query,t))}}function H6(...s){return yh._create("startAt",s,!0)}function G6(...s){return yh._create("startAfter",s,!1)}class xh extends ou{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new xh(e,t,n)}_apply(e){const t=Kj(e,this.type,this._docOrFields,this._inclusive);return new In(e.firestore,e.converter,(function(a,l){return new Qa(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,l)})(e._query,t))}}function $6(...s){return xh._create("endBefore",s,!1)}function K6(...s){return xh._create("endAt",s,!0)}function Kj(s,e,t,n){if(t[0]=mt(t[0]),t[0]instanceof Zd)return(function(l,u,h,m,p){if(!m)throw new he(se.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const x=[];for(const w of Nc(l))if(w.field.isKeyField())x.push(el(u,m.key));else{const b=m.data.field(w.field);if(ag(b))throw new he(se.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+w.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(b===null){const E=w.field.canonicalString();throw new he(se.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}x.push(b)}return new Yi(x,p)})(s._query,s.firestore._databaseId,e,t[0]._document,n);{const a=ml(s.firestore);return(function(u,h,m,p,x,w){const b=u.explicitOrderBy;if(x.length>b.length)throw new he(se.INVALID_ARGUMENT,`Too many arguments provided to ${p}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const E=[];for(let C=0;C<x.length;C++){const k=x[C];if(b[C].field.isKeyField()){if(typeof k!="string")throw new he(se.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${p}(), but got a ${typeof k}`);if(!gv(u)&&k.indexOf("/")!==-1)throw new he(se.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${p}() must be a plain document ID, but '${k}' contains a slash.`);const L=u.path.child(tt.fromString(k));if(!Ne.isDocumentKey(L))throw new he(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${p}() must result in a valid document path, but '${L}' is not because it contains an odd number of segments.`);const U=new Ne(L);E.push(el(h,U))}else{const L=qj(m,p,k);E.push(L)}}return new Yi(E,w)})(s._query,s.firestore._databaseId,a,e,t,n)}}function kT(s,e,t){if(typeof(t=mt(t))=="string"){if(t==="")throw new he(se.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gv(e)&&t.indexOf("/")!==-1)throw new he(se.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(tt.fromString(t));if(!Ne.isDocumentKey(n))throw new he(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return el(s,new Ne(n))}if(t instanceof At)return el(s,t._key);throw new he(se.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eg(t)}.`)}function DT(s,e){if(!Array.isArray(s)||s.length===0)throw new he(se.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Qj(s,e){const t=(function(a,l){for(const u of a)for(const h of u.getFlattenedFilters())if(l.indexOf(h.op)>=0)return h.op;return null})(s.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new he(se.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new he(se.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Yj(s,e){if(!(e instanceof lu||e instanceof pl))throw new he(se.INVALID_ARGUMENT,`Function ${s}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ob{convertValue(e,t="none"){switch(Ki(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Gt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($a(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ae(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return to(e,((a,l)=>{n[a]=this.convertValue(l,t)})),n}convertVectorValue(e){const t=e.fields?.[Mc].arrayValue?.values?.map((n=>Gt(n.doubleValue)));return new pr(t)}convertGeoPoint(e){return new Vr(Gt(e.latitude),Gt(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ig(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Gd(e));default:return null}}convertTimestamp(e){const t=Ga(e);return new wt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=tt.fromString(e);ke(DA(n),9688,{name:e});const a=new $i(n.get(1),n.get(3)),l=new Ne(n.popFirst(5));return a.isEqual(t)||hn(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(s,e,t){let n;return n=s?t&&(t.merge||t.mergeFields)?s.toFirestore(e,t):s.toFirestore(e):e,n}class lb extends ob{constructor(e){super(),this.firestore=e}convertBytes(e){return new _s(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q6(s){return new Kc("sum",Jd("sum",s))}function Y6(s){return new Kc("avg",Jd("average",s))}function Xj(){return new Kc("count")}function X6(s,e){return s instanceof Kc&&e instanceof Kc&&s.aggregateType===e.aggregateType&&s._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function W6(s,e){return Jv(s.query,e.query)&&yr(s.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wj="NOT SUPPORTED";class Fa{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Is extends Zd{constructor(e,t,n,a,l,u){super(e,t,n,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Md(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ng("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new he(se.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Is._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function J6(s,e,t){if(hl(e,Is._jsonSchema)){if(e.bundle===Wj)throw new he(se.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=fl(s._databaseId),a=Ij(e.bundle,n),l=a.Wu(),u=new qv(a.getMetadata(),n);for(const x of l)u.Ga(x);const h=u.documents;if(h.length!==1)throw new he(se.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);const m=ug(n,h[0].document),p=new Ne(tt.fromString(e.bundleName));return new Is(s,new lb(s),p,m,new Fa(!1,!1),t||null)}}Is._jsonSchemaVersion="firestore/documentSnapshot/1.0",Is._jsonSchema={type:vn("string",Is._jsonSchemaVersion),bundleSource:vn("string","DocumentSnapshot"),bundleName:vn("string"),bundle:vn("string")};class Md extends Is{data(e={}){return super.data(e)}}class Cs{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new Fa(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Md(this._firestore,this._userDataWriter,n.key,n,new Fa(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(se.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(a,l){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map((h=>{const m=new Md(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Fa(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:m,oldIndex:-1,newIndex:u++}}))}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>l||h.type!==3)).map((h=>{const m=new Md(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Fa(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,x=-1;return h.type!==0&&(p=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),x=u.indexOf(h.doc.key)),{type:e3(h.type),doc:m,oldIndex:p,newIndex:x}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new he(se.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Cs._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Zm.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],a=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),n.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Z6(s,e,t){if(hl(e,Cs._jsonSchema)){if(e.bundle===Wj)throw new he(se.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=fl(s._databaseId),a=Ij(e.bundle,n),l=a.Wu(),u=new qv(a.getMetadata(),n);for(const b of l)u.Ga(b);if(u.queries.length!==1)throw new he(se.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${u.queries.length} queries.`);const h=hg(u.queries[0].bundledQuery),m=u.documents;let p=new Xo;m.map((b=>{const E=ug(n,b.document);p=p.add(E)}));const x=ll.fromInitialDocuments(h,p,Xe(),!1,!1),w=new In(s,t||null,h);return new Cs(s,new lb(s),w,x)}}function e3(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ae(61501,{type:s})}}function t3(s,e){return s instanceof Is&&e instanceof Is?s._firestore===e._firestore&&s._key.isEqual(e._key)&&(s._document===null?e._document===null:s._document.isEqual(e._document))&&s._converter===e._converter:s instanceof Cs&&e instanceof Cs&&s._firestore===e._firestore&&Jv(s.query,e.query)&&s.metadata.isEqual(e.metadata)&&s._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vt(s){s=nt(s,At);const e=nt(s.firestore,Pt);return Aj(Qt(e),s._key).then((t=>cb(e,s,t)))}Cs._jsonSchemaVersion="firestore/querySnapshot/1.0",Cs._jsonSchema={type:vn("string",Cs._jsonSchemaVersion),bundleSource:vn("string","QuerySnapshot"),bundleName:vn("string"),bundle:vn("string")};class io extends ob{constructor(e){super(),this.firestore=e}convertBytes(e){return new _s(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}function n3(s){s=nt(s,At);const e=nt(s.firestore,Pt),t=Qt(e),n=new io(e);return g6(t,s._key).then((a=>new Is(e,n,s._key,a,new Fa(a!==null&&a.hasLocalMutations,!0),s.converter)))}function s3(s){s=nt(s,At);const e=nt(s.firestore,Pt);return Aj(Qt(e),s._key,{source:"server"}).then((t=>cb(e,s,t)))}function Ke(s){s=nt(s,In);const e=nt(s.firestore,Pt),t=Qt(e),n=new io(e);return $j(s._query),jj(t,s._query).then((a=>new Cs(e,n,s,a)))}function r3(s){s=nt(s,In);const e=nt(s.firestore,Pt),t=Qt(e),n=new io(e);return p6(t,s._query).then((a=>new Cs(e,n,s,a)))}function a3(s){s=nt(s,In);const e=nt(s.firestore,Pt),t=Qt(e),n=new io(e);return jj(t,s._query,{source:"server"}).then((a=>new Cs(e,n,s,a)))}function Rs(s,e,t){s=nt(s,At);const n=nt(s.firestore,Pt),a=Eg(s.converter,e,t);return cu(n,[wg(ml(n),"setDoc",s._key,a,s.converter!==null,t).toMutation(s._key,Kt.none())])}function $t(s,e,t,...n){s=nt(s,At);const a=nt(s.firestore,Pt),l=ml(a);let u;return u=typeof(e=mt(e))=="string"||e instanceof ro?rb(l,"updateDoc",s._key,e,t,n):sb(l,"updateDoc",s._key,e),cu(a,[u.toMutation(s._key,Kt.exists(!0))])}function Wo(s){return cu(nt(s.firestore,Pt),[new tu(s._key,Kt.none())])}function Ys(s,e){const t=nt(s.firestore,Pt),n=ve(s),a=Eg(s.converter,e);return cu(t,[wg(ml(s.firestore),"addDoc",n._key,a,s.converter!==null,{}).toMutation(n._key,Kt.exists(!1))]).then((()=>n))}function Fm(s,...e){s=mt(s);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||Tc(e[n])||(t=e[n++]);const a={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Tc(e[n])){const m=e[n];e[n]=m.next?.bind(m),e[n+1]=m.error?.bind(m),e[n+2]=m.complete?.bind(m)}let l,u,h;if(s instanceof At)u=nt(s.firestore,Pt),h=Zc(s._key.path),l={next:m=>{e[n]&&e[n](cb(u,s,m))},error:e[n+1],complete:e[n+2]};else{const m=nt(s,In);u=nt(m.firestore,Pt),h=m._query;const p=new io(u);l={next:x=>{e[n]&&e[n](new Cs(u,p,m,x))},error:e[n+1],complete:e[n+2]},$j(s._query)}return(function(p,x,w,b){const E=new xg(b),C=new Bv(x,E,w);return p.asyncQueue.enqueueAndForget((async()=>Lv(await $c(p),C))),()=>{E.Nu(),p.asyncQueue.enqueueAndForget((async()=>Fv(await $c(p),C)))}})(Qt(u),h,a,l)}function i3(s,e,...t){const n=mt(s),a=(function(m){const p={bundle:"",bundleName:"",bundleSource:""},x=["bundle","bundleName","bundleSource"];for(const w of x){if(!(w in m)){p.error=`snapshotJson missing required field: ${w}`;break}const b=m[w];if(typeof b!="string"){p.error=`snapshotJson field '${w}' must be a string.`;break}if(b.length===0){p.error=`snapshotJson field '${w}' cannot be an empty string.`;break}w==="bundle"?p.bundle=b:w==="bundleName"?p.bundleName=b:w==="bundleSource"&&(p.bundleSource=b)}return p})(e);if(a.error)throw new he(se.INVALID_ARGUMENT,a.error);let l,u=0;if(typeof t[u]!="object"||Tc(t[u])||(l=t[u++]),a.bundleSource==="QuerySnapshot"){let h=null;if(typeof t[u]=="object"&&Tc(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,w,b,E){let C,k=!1;return Lx(p,x.bundle).then((()=>Vj(p,x.bundleName))).then((U=>{U&&!k&&(E&&U.withConverter(E),C=Fm(U,w||{},b))})).catch((U=>(b.error&&b.error(U),()=>{}))),()=>{k||(k=!0,C&&C())}})(n,a,l,h,t[u])}if(a.bundleSource==="DocumentSnapshot"){let h=null;if(typeof t[u]=="object"&&Tc(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,w,b,E){let C,k=!1;return Lx(p,x.bundle).then((()=>{if(!k){const U=new At(p,E||null,Ne.fromPath(x.bundleName));C=Fm(U,w||{},b)}})).catch((U=>(b.error&&b.error(U),()=>{}))),()=>{k||(k=!0,C&&C())}})(n,a,l,h,t[u])}throw new he(se.INVALID_ARGUMENT,`unsupported bundle source: ${a.bundleSource}`)}function o3(s,e){return x6(Qt(s=nt(s,Pt)),Tc(e)?e:{next:e})}function cu(s,e){return(function(n,a){const l=new Hn;return n.asyncQueue.enqueueAndForget((async()=>$P(await Wv(n),a,l))),l.promise})(Qt(s),e)}function cb(s,e,t){const n=t.docs.get(e._key),a=new io(s);return new Is(s,a,e._key,n,new Fa(t.hasPendingWrites,t.fromCache),e.converter)}function l3(s){return Jj(s,{count:Xj()})}function Jj(s,e){const t=nt(s.firestore,Pt),n=Qt(t),a=OS(e,((l,u)=>new yA(u,l.aggregateType,l._internalFieldPath)));return y6(n,s._query,a).then((l=>(function(h,m,p){const x=new io(h);return new Lj(m,x,p)})(t,s,l)))}class c3{constructor(e){this.kind="memory",this._onlineComponentProvider=Wi.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Qv(void 0)}}toJSON(){return{kind:this.kind}}}class u3{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=Zj(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class d3{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Gc.provider}toJSON(){return{kind:this.kind}}}class h3{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Qv(e)}}toJSON(){return{kind:this.kind}}}function f3(){return new d3}function m3(s){return new h3(s?.cacheSizeBytes)}function g3(s){return new c3(s)}function p3(s){return new u3(s)}class y3{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Wi.provider,this._offlineComponentProvider={build:t=>new Yv(t,e?.cacheSizeBytes,this.forceOwnership)}}}class x3{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Wi.provider,this._offlineComponentProvider={build:t=>new Nj(t,e?.cacheSizeBytes)}}}function Zj(s){return new y3(s?.forceOwnership)}function v3(){return new x3}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b3={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ml(e)}set(e,t,n){this._verifyNotCommitted();const a=Vi(e,this._firestore),l=Eg(a.converter,t,n),u=wg(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,n);return this._mutations.push(u.toMutation(a._key,Kt.none())),this}update(e,t,n,...a){this._verifyNotCommitted();const l=Vi(e,this._firestore);let u;return u=typeof(t=mt(t))=="string"||t instanceof ro?rb(this._dataReader,"WriteBatch.update",l._key,t,n,a):sb(this._dataReader,"WriteBatch.update",l._key,t),this._mutations.push(u.toMutation(l._key,Kt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Vi(e,this._firestore);return this._mutations=this._mutations.concat(new tu(t._key,Kt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new he(se.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vi(s,e){if((s=mt(s)).firestore!==e)throw new he(se.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w3{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ml(e)}get(e){const t=Vi(e,this._firestore),n=new lb(this._firestore);return this._transaction.lookup([t._key]).then((a=>{if(!a||a.length!==1)return Ae(24041);const l=a[0];if(l.isFoundDocument())return new Zd(this._firestore,n,l.key,l,t.converter);if(l.isNoDocument())return new Zd(this._firestore,n,t._key,null,t.converter);throw Ae(18433,{doc:l})}))}set(e,t,n){const a=Vi(e,this._firestore),l=Eg(a.converter,t,n),u=wg(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,n);return this._transaction.set(a._key,u),this}update(e,t,n,...a){const l=Vi(e,this._firestore);let u;return u=typeof(t=mt(t))=="string"||t instanceof ro?rb(this._dataReader,"Transaction.update",l._key,t,n,a):sb(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,u),this}delete(e){const t=Vi(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1 extends w3{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Vi(e,this._firestore),n=new io(this._firestore);return super.get(e).then((a=>new Is(this._firestore,n,t._key,a._document,new Fa(!1,!1),t.converter)))}}function Td(s,e,t){s=nt(s,Pt);const n={...b3,...t};return(function(l){if(l.maxAttempts<1)throw new he(se.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(l,u,h){const m=new Hn;return l.asyncQueue.enqueueAndForget((async()=>{const p=await Sj(l);new d6(l.asyncQueue,p,h,u,m).ju()})),m.promise})(Qt(s),(a=>e(new t1(s,a))),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _3(){return new gh("deleteField")}function Pe(){return new Zv("serverTimestamp")}function Qc(...s){return new eb("arrayUnion",s)}function Um(...s){return new tb("arrayRemove",s)}function cm(s){return new nb("increment",s)}function N3(s){return new pr(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(s){return Qt(s=nt(s,Pt)),new e1(s,(e=>cu(s,e)))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T3(s,e){const t=Qt(s=nt(s,Pt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Ws("Cannot enable indexes when persistence is disabled"),Promise.resolve();const n=(function(l){const u=typeof l=="string"?(function(p){try{return JSON.parse(p)}catch(x){throw new he(se.INVALID_ARGUMENT,"Failed to parse JSON: "+x?.message)}})(l):l,h=[];if(Array.isArray(u.indexes))for(const m of u.indexes){const p=PT(m,"collectionGroup"),x=[];if(Array.isArray(m.fields))for(const w of m.fields){const b=_g("setIndexConfiguration",PT(w,"fieldPath"));w.arrayConfig==="CONTAINS"?x.push(new Qo(b,2)):w.order==="ASCENDING"?x.push(new Qo(b,0)):w.order==="DESCENDING"&&x.push(new Qo(b,1))}h.push(new Ic(Ic.UNKNOWN_ID,p,x,Cc.empty()))}return h})(e);return w6(t,n)}function PT(s,e){if(typeof s[e]!="string")throw new he(se.INVALID_ARGUMENT,"Missing string value for: "+e);return s[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function E3(s){s=nt(s,Pt);const e=MT.get(s);if(e)return e;if(Qt(s)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const n=new n1(s);return MT.set(s,n),n}function S3(s){s1(s,!0)}function A3(s){s1(s,!1)}function j3(s){N6(Qt(s._firestore)).then((e=>ge("deleting all persistent cache indexes succeeded"))).catch((e=>Ws("deleting all persistent cache indexes failed",e)))}function s1(s,e){_6(Qt(s._firestore),e).then((t=>ge(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>Ws(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const MT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I3(s){const e=Qt(nt(s.firestore,Pt)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:dg(t,cs(s._query)).ft}function C3(s,e){const t=OS(e,((l,u)=>new yA(u,l.aggregateType,l._internalFieldPath))),n=Qt(nt(s.firestore,Pt)),a=n._onlineComponents?.datastore.serializer;return a===void 0?null:IA(a,tA(s._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return ub.instance.onExistenceFilterMismatch(e)}}class ub{constructor(){this.Mc=new Map}static get instance(){return Hf||(Hf=new ub,(function(t){if(Ex)throw new Error("a TestingHooksSpi instance is already set");Ex=t})(Hf)),Hf}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.Mc;return n.set(t,e),()=>n.delete(t)}}let Hf=null;(function(e,t=!0){(function(a){Jc=a})(Xc),Lr(new xr("firestore",((n,{instanceIdentifier:a,options:l})=>{const u=n.getProvider("app").getImmediate(),h=new Pt(new oD(n.getProvider("auth-internal")),new uD(u,n.getProvider("app-check-internal")),(function(p,x){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new he(se.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $i(p.options.projectId,x)})(u,a),u);return l={useFetchStreams:t,...l},h._setSettings(l),h}),"PUBLIC").setMultipleInstances(!0)),js(fN,mN,e),js(fN,mN,"esm2020")})();const ra=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:ob,AggregateField:Kc,AggregateQuerySnapshot:Lj,Bytes:_s,CACHE_SIZE_UNLIMITED:S6,CollectionReference:Or,DocumentReference:At,DocumentSnapshot:Is,FieldPath:ro,FieldValue:ao,Firestore:Pt,FirestoreError:he,GeoPoint:Vr,LoadBundleTask:Dj,PersistentCacheIndexManager:n1,Query:In,QueryCompositeFilterConstraint:pl,QueryConstraint:ou,QueryDocumentSnapshot:Md,QueryEndAtConstraint:xh,QueryFieldFilterConstraint:lu,QueryLimitConstraint:ph,QueryOrderByConstraint:Tg,QuerySnapshot:Cs,QueryStartAtConstraint:yh,SnapshotMetadata:Fa,Timestamp:wt,Transaction:t1,VectorValue:pr,WriteBatch:e1,_AutoId:Zm,_ByteString:en,_DatabaseId:$i,_DocumentKey:Ne,_EmptyAppCheckTokenProvider:dD,_EmptyAuthCredentialsProvider:gS,_FieldPath:Bt,_TestingHooks:R3,_cast:nt,_debugAssert:aD,_internalAggregationQueryToProtoRunAggregationQueryRequest:C3,_internalQueryToProtoQueryTarget:I3,_isBase64Available:QD,_logWarn:Ws,_validateIsNotUsedTogether:yS,addDoc:Ys,aggregateFieldEqual:X6,aggregateQuerySnapshotEqual:W6,and:q6,arrayRemove:Um,arrayUnion:Qc,average:Y6,clearIndexedDbPersistence:C6,collection:Ce,collectionGroup:T6,connectFirestoreEmulator:kj,count:Xj,deleteAllPersistentCacheIndexes:j3,deleteDoc:Wo,deleteField:_3,disableNetwork:D6,disablePersistentCacheIndexAutoCreation:A3,doc:ve,documentId:M6,documentSnapshotFromJSON:J6,enableIndexedDbPersistence:j6,enableMultiTabIndexedDbPersistence:I6,enableNetwork:k6,enablePersistentCacheIndexAutoCreation:S3,endAt:K6,endBefore:$6,ensureFirestoreConfigured:Qt,executeWrite:cu,getAggregateFromServer:Jj,getCountFromServer:l3,getDoc:vt,getDocFromCache:n3,getDocFromServer:s3,getDocs:Ke,getDocsFromCache:r3,getDocsFromServer:a3,getFirestore:Pj,getPersistentCacheIndexManager:E3,increment:cm,initializeFirestore:A6,limit:Zt,limitToLast:z6,loadBundle:Lx,memoryEagerGarbageCollector:f3,memoryLocalCache:g3,memoryLruGarbageCollector:m3,namedQuery:Vj,onSnapshot:Fm,onSnapshotResume:i3,onSnapshotsInSync:o3,or:B6,orderBy:Jt,persistentLocalCache:p3,persistentMultipleTabManager:v3,persistentSingleTabManager:Zj,query:Le,queryEqual:Jv,querySnapshotFromJSON:Z6,refEqual:E6,runTransaction:Td,serverTimestamp:Pe,setDoc:Rs,setIndexConfiguration:T3,setLogLevel:rD,snapshotEqual:t3,startAfter:G6,startAt:H6,sum:Q6,terminate:P6,updateDoc:$t,vector:N3,waitForPendingWrites:R6,where:Ye,writeBatch:Jo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3="type.googleapis.com/google.protobuf.Int64Value",D3="type.googleapis.com/google.protobuf.UInt64Value";function r1(s,e){const t={};for(const n in s)s.hasOwnProperty(n)&&(t[n]=e(s[n]));return t}function Bm(s){if(s==null)return null;if(s instanceof Number&&(s=s.valueOf()),typeof s=="number"&&isFinite(s)||s===!0||s===!1||Object.prototype.toString.call(s)==="[object String]")return s;if(s instanceof Date)return s.toISOString();if(Array.isArray(s))return s.map(e=>Bm(e));if(typeof s=="function"||typeof s=="object")return r1(s,e=>Bm(e));throw new Error("Data cannot be encoded in JSON: "+s)}function Yc(s){if(s==null)return s;if(s["@type"])switch(s["@type"]){case k3:case D3:{const e=Number(s.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+s);return e}default:throw new Error("Data cannot be decoded from JSON: "+s)}return Array.isArray(s)?s.map(e=>Yc(e)):typeof s=="function"||typeof s=="object"?r1(s,e=>Yc(e)):s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const db="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ss extends br{constructor(e,t,n){super(`${db}/${e}`,t||""),this.details=n,Object.setPrototypeOf(this,Ss.prototype)}}function P3(s){if(s>=200&&s<300)return"ok";switch(s){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function qm(s,e){let t=P3(s),n=t,a;try{const l=e&&e.error;if(l){const u=l.status;if(typeof u=="string"){if(!OT[u])return new Ss("internal","internal");t=OT[u],n=u}const h=l.message;typeof h=="string"&&(n=h),a=l.details,a!==void 0&&(a=Yc(a))}}catch{}return t==="ok"?null:new Ss(t,n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3{constructor(e,t,n,a){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Qs(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(l=>this.auth=l,()=>{}),this.messaging||n.get().then(l=>this.messaging=l,()=>{}),this.appCheck||a?.get().then(l=>this.appCheck=l,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),n=await this.getMessagingToken(),a=await this.getAppCheckToken(e);return{authToken:t,messagingToken:n,appCheckToken:a}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fx="us-central1",O3=/^data: (.*?)(?:\n|$)/;function V3(s){let e=null;return{promise:new Promise((t,n)=>{e=setTimeout(()=>{n(new Ss("deadline-exceeded","deadline-exceeded"))},s)}),cancel:()=>{e&&clearTimeout(e)}}}class L3{constructor(e,t,n,a,l=Fx,u=(...h)=>fetch(...h)){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new M3(e,t,n,a),this.cancelAllRequests=new Promise(h=>{this.deleteService=()=>Promise.resolve(h())});try{const h=new URL(l);this.customDomain=h.origin+(h.pathname==="/"?"":h.pathname),this.region=Fx}catch{this.customDomain=null,this.region=l}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function F3(s,e,t){const n=Ka(e);s.emulatorOrigin=`http${n?"s":""}://${e}:${t}`,n&&(Km(s.emulatorOrigin+"/backends"),Gx("Functions",!0))}function U3(s,e,t){const n=a=>q3(s,e,a,{});return n.stream=(a,l)=>H3(s,e,a,l),n}function a1(s){return s.emulatorOrigin&&Ka(s.emulatorOrigin)?"include":void 0}async function B3(s,e,t,n,a){t["Content-Type"]="application/json";let l;try{l=await n(s,{method:"POST",body:JSON.stringify(e),headers:t,credentials:a1(a)})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function i1(s,e){const t={},n=await s.contextProvider.getContext(e.limitedUseAppCheckTokens);return n.authToken&&(t.Authorization="Bearer "+n.authToken),n.messagingToken&&(t["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=n.appCheckToken),t}function q3(s,e,t,n){const a=s._url(e);return z3(s,a,t,n)}async function z3(s,e,t,n){t=Bm(t);const a={data:t},l=await i1(s,n),u=n.timeout||7e4,h=V3(u),m=await Promise.race([B3(e,a,l,s.fetchImpl,s),h.promise,s.cancelAllRequests]);if(h.cancel(),!m)throw new Ss("cancelled","Firebase Functions instance was deleted.");const p=qm(m.status,m.json);if(p)throw p;if(!m.json)throw new Ss("internal","Response is not valid JSON object.");let x=m.json.data;if(typeof x>"u"&&(x=m.json.result),typeof x>"u")throw new Ss("internal","Response is missing data field.");return{data:Yc(x)}}function H3(s,e,t,n){const a=s._url(e);return G3(s,a,t,n||{})}async function G3(s,e,t,n){t=Bm(t);const a={data:t},l=await i1(s,n);l["Content-Type"]="application/json",l.Accept="text/event-stream";let u;try{u=await s.fetchImpl(e,{method:"POST",body:JSON.stringify(a),headers:l,signal:n?.signal,credentials:a1(s)})}catch(b){if(b instanceof Error&&b.name==="AbortError"){const C=new Ss("cancelled","Request was cancelled.");return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}const E=qm(0,null);return{data:Promise.reject(E),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(E)}}}}}}let h,m;const p=new Promise((b,E)=>{h=b,m=E});n?.signal?.addEventListener("abort",()=>{const b=new Ss("cancelled","Request was cancelled.");m(b)});const x=u.body.getReader(),w=$3(x,h,m,n?.signal);return{stream:{[Symbol.asyncIterator](){const b=w.getReader();return{async next(){const{value:E,done:C}=await b.read();return{value:E,done:C}},async return(){return await b.cancel(),{done:!0,value:void 0}}}}},data:p}}function $3(s,e,t,n){const a=(u,h)=>{const m=u.match(O3);if(!m)return;const p=m[1];try{const x=JSON.parse(p);if("result"in x){e(Yc(x.result));return}if("message"in x){h.enqueue(Yc(x.message));return}if("error"in x){const w=qm(0,x);h.error(w),t(w);return}}catch(x){if(x instanceof Ss){h.error(x),t(x);return}}},l=new TextDecoder;return new ReadableStream({start(u){let h="";return m();async function m(){if(n?.aborted){const p=new Ss("cancelled","Request was cancelled");return u.error(p),t(p),Promise.resolve()}try{const{value:p,done:x}=await s.read();if(x){h.trim()&&a(h.trim(),u),u.close();return}if(n?.aborted){const b=new Ss("cancelled","Request was cancelled");u.error(b),t(b),await s.cancel();return}h+=l.decode(p,{stream:!0});const w=h.split(`
`);h=w.pop()||"";for(const b of w)b.trim()&&a(b.trim(),u);return m()}catch(p){const x=p instanceof Ss?p:qm(0,null);u.error(x),t(x)}}},cancel(){return s.cancel()}})}const VT="@firebase/functions",LT="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K3="auth-internal",Q3="app-check-internal",Y3="messaging-internal";function X3(s){const e=(t,{instanceIdentifier:n})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider(K3),u=t.getProvider(Y3),h=t.getProvider(Q3);return new L3(a,l,u,h,n)};Lr(new xr(db,e,"PUBLIC").setMultipleInstances(!0)),js(VT,LT,s),js(VT,LT,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W3(s=Ym(),e=Fx){const n=ha(mt(s),db).getImmediate({identifier:e}),a=fE("functions");return a&&J3(n,...a),n}function J3(s,e,t){F3(mt(s),e,t)}function Li(s,e,t){return U3(mt(s),e)}X3();const o1="@firebase/installations",hb="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1=1e4,c1=`w:${hb}`,u1="FIS_v2",Z3="https://firebaseinstallations.googleapis.com/v1",eM=3600*1e3,tM="installations",nM="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sM={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},cl=new dl(tM,nM,sM);function d1(s){return s instanceof br&&s.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h1({projectId:s}){return`${Z3}/projects/${s}/installations`}function f1(s){return{token:s.token,requestStatus:2,expiresIn:aM(s.expiresIn),creationTime:Date.now()}}async function m1(s,e){const n=(await e.json()).error;return cl.create("request-failed",{requestName:s,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function g1({apiKey:s}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":s})}function rM(s,{refreshToken:e}){const t=g1(s);return t.append("Authorization",iM(e)),t}async function p1(s){const e=await s();return e.status>=500&&e.status<600?s():e}function aM(s){return Number(s.replace("s","000"))}function iM(s){return`${u1} ${s}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oM({appConfig:s,heartbeatServiceProvider:e},{fid:t}){const n=h1(s),a=g1(s),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&a.append("x-firebase-client",p)}const u={fid:t,authVersion:u1,appId:s.appId,sdkVersion:c1},h={method:"POST",headers:a,body:JSON.stringify(u)},m=await p1(()=>fetch(n,h));if(m.ok){const p=await m.json();return{fid:p.fid||t,registrationStatus:2,refreshToken:p.refreshToken,authToken:f1(p.authToken)}}else throw await m1("Create Installation",m)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y1(s){return new Promise(e=>{setTimeout(e,s)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lM(s){return btoa(String.fromCharCode(...s)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM=/^[cdef][\w-]{21}$/,Ux="";function uM(){try{const s=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(s),s[0]=112+s[0]%16;const t=dM(s);return cM.test(t)?t:Ux}catch{return Ux}}function dM(s){return lM(s).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sg(s){return`${s.appName}!${s.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x1=new Map;function v1(s,e){const t=Sg(s);b1(t,e),hM(t,e)}function b1(s,e){const t=x1.get(s);if(t)for(const n of t)n(e)}function hM(s,e){const t=fM();t&&t.postMessage({key:s,fid:e}),mM()}let Ko=null;function fM(){return!Ko&&"BroadcastChannel"in self&&(Ko=new BroadcastChannel("[Firebase] FID Change"),Ko.onmessage=s=>{b1(s.data.key,s.data.fid)}),Ko}function mM(){x1.size===0&&Ko&&(Ko.close(),Ko=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gM="firebase-installations-database",pM=1,ul="firebase-installations-store";let Ky=null;function fb(){return Ky||(Ky=NE(gM,pM,{upgrade:(s,e)=>{switch(e){case 0:s.createObjectStore(ul)}}})),Ky}async function zm(s,e){const t=Sg(s),a=(await fb()).transaction(ul,"readwrite"),l=a.objectStore(ul),u=await l.get(t);return await l.put(e,t),await a.done,(!u||u.fid!==e.fid)&&v1(s,e.fid),e}async function w1(s){const e=Sg(s),n=(await fb()).transaction(ul,"readwrite");await n.objectStore(ul).delete(e),await n.done}async function Ag(s,e){const t=Sg(s),a=(await fb()).transaction(ul,"readwrite"),l=a.objectStore(ul),u=await l.get(t),h=e(u);return h===void 0?await l.delete(t):await l.put(h,t),await a.done,h&&(!u||u.fid!==h.fid)&&v1(s,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mb(s){let e;const t=await Ag(s.appConfig,n=>{const a=yM(n),l=xM(s,a);return e=l.registrationPromise,l.installationEntry});return t.fid===Ux?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function yM(s){const e=s||{fid:uM(),registrationStatus:0};return _1(e)}function xM(s,e){if(e.registrationStatus===0){if(!navigator.onLine){const a=Promise.reject(cl.create("app-offline"));return{installationEntry:e,registrationPromise:a}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=vM(s,t);return{installationEntry:t,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:bM(s)}:{installationEntry:e}}async function vM(s,e){try{const t=await oM(s,e);return zm(s.appConfig,t)}catch(t){throw d1(t)&&t.customData.serverCode===409?await w1(s.appConfig):await zm(s.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function bM(s){let e=await FT(s.appConfig);for(;e.registrationStatus===1;)await y1(100),e=await FT(s.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:n}=await mb(s);return n||t}return e}function FT(s){return Ag(s,e=>{if(!e)throw cl.create("installation-not-found");return _1(e)})}function _1(s){return wM(s)?{fid:s.fid,registrationStatus:0}:s}function wM(s){return s.registrationStatus===1&&s.registrationTime+l1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _M({appConfig:s,heartbeatServiceProvider:e},t){const n=NM(s,t),a=rM(s,t),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&a.append("x-firebase-client",p)}const u={installation:{sdkVersion:c1,appId:s.appId}},h={method:"POST",headers:a,body:JSON.stringify(u)},m=await p1(()=>fetch(n,h));if(m.ok){const p=await m.json();return f1(p)}else throw await m1("Generate Auth Token",m)}function NM(s,{fid:e}){return`${h1(s)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gb(s,e=!1){let t;const n=await Ag(s.appConfig,l=>{if(!N1(l))throw cl.create("not-registered");const u=l.authToken;if(!e&&SM(u))return l;if(u.requestStatus===1)return t=TM(s,e),l;{if(!navigator.onLine)throw cl.create("app-offline");const h=jM(l);return t=EM(s,h),h}});return t?await t:n.authToken}async function TM(s,e){let t=await UT(s.appConfig);for(;t.authToken.requestStatus===1;)await y1(100),t=await UT(s.appConfig);const n=t.authToken;return n.requestStatus===0?gb(s,e):n}function UT(s){return Ag(s,e=>{if(!N1(e))throw cl.create("not-registered");const t=e.authToken;return IM(t)?{...e,authToken:{requestStatus:0}}:e})}async function EM(s,e){try{const t=await _M(s,e),n={...e,authToken:t};return await zm(s.appConfig,n),t}catch(t){if(d1(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await w1(s.appConfig);else{const n={...e,authToken:{requestStatus:0}};await zm(s.appConfig,n)}throw t}}function N1(s){return s!==void 0&&s.registrationStatus===2}function SM(s){return s.requestStatus===2&&!AM(s)}function AM(s){const e=Date.now();return e<s.creationTime||s.creationTime+s.expiresIn<e+eM}function jM(s){const e={requestStatus:1,requestTime:Date.now()};return{...s,authToken:e}}function IM(s){return s.requestStatus===1&&s.requestTime+l1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CM(s){const e=s,{installationEntry:t,registrationPromise:n}=await mb(e);return n?n.catch(console.error):gb(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RM(s,e=!1){const t=s;return await kM(t),(await gb(t,e)).token}async function kM(s){const{registrationPromise:e}=await mb(s);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(s){if(!s||!s.options)throw Qy("App Configuration");if(!s.name)throw Qy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!s.options[t])throw Qy(t);return{appName:s.name,projectId:s.options.projectId,apiKey:s.options.apiKey,appId:s.options.appId}}function Qy(s){return cl.create("missing-app-config-values",{valueName:s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T1="installations",PM="installations-internal",MM=s=>{const e=s.getProvider("app").getImmediate(),t=DM(e),n=ha(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},OM=s=>{const e=s.getProvider("app").getImmediate(),t=ha(e,T1).getImmediate();return{getId:()=>CM(t),getToken:a=>RM(t,a)}};function VM(){Lr(new xr(T1,MM,"PUBLIC")),Lr(new xr(PM,OM,"PRIVATE"))}VM();js(o1,hb);js(o1,hb,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hm="analytics",LM="firebase_id",FM="origin",UM=60*1e3,BM="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",pb="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ks=new Qm("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qM={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Xs=new dl("analytics","Analytics",qM);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zM(s){if(!s.startsWith(pb)){const e=Xs.create("invalid-gtag-resource",{gtagURL:s});return ks.warn(e.message),""}return s}function E1(s){return Promise.all(s.map(e=>e.catch(t=>t)))}function HM(s,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(s,e)),t}function GM(s,e){const t=HM("firebase-js-sdk-policy",{createScriptURL:zM}),n=document.createElement("script"),a=`${pb}?l=${s}&id=${e}`;n.src=t?t?.createScriptURL(a):a,n.async=!0,document.head.appendChild(n)}function $M(s){let e=[];return Array.isArray(window[s])?e=window[s]:window[s]=e,e}async function KM(s,e,t,n,a,l){const u=n[a];try{if(u)await e[u];else{const m=(await E1(t)).find(p=>p.measurementId===a);m&&await e[m.appId]}}catch(h){ks.error(h)}s("config",a,l)}async function QM(s,e,t,n,a){try{let l=[];if(a&&a.send_to){let u=a.send_to;Array.isArray(u)||(u=[u]);const h=await E1(t);for(const m of u){const p=h.find(w=>w.measurementId===m),x=p&&e[p.appId];if(x)l.push(x);else{l=[];break}}}l.length===0&&(l=Object.values(e)),await Promise.all(l),s("event",n,a||{})}catch(l){ks.error(l)}}function YM(s,e,t,n){async function a(l,...u){try{if(l==="event"){const[h,m]=u;await QM(s,e,t,h,m)}else if(l==="config"){const[h,m]=u;await KM(s,e,t,n,h,m)}else if(l==="consent"){const[h,m]=u;s("consent",h,m)}else if(l==="get"){const[h,m,p]=u;s("get",h,m,p)}else if(l==="set"){const[h]=u;s("set",h)}else s(l,...u)}catch(h){ks.error(h)}}return a}function XM(s,e,t,n,a){let l=function(...u){window[n].push(arguments)};return window[a]&&typeof window[a]=="function"&&(l=window[a]),window[a]=YM(l,s,e,t),{gtagCore:l,wrappedGtag:window[a]}}function WM(s){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(pb)&&t.src.includes(s))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JM=30,ZM=1e3;class e5{constructor(e={},t=ZM){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const S1=new e5;function t5(s){return new Headers({Accept:"application/json","x-goog-api-key":s})}async function n5(s){const{appId:e,apiKey:t}=s,n={method:"GET",headers:t5(t)},a=BM.replace("{app-id}",e),l=await fetch(a,n);if(l.status!==200&&l.status!==304){let u="";try{const h=await l.json();h.error?.message&&(u=h.error.message)}catch{}throw Xs.create("config-fetch-failed",{httpStatus:l.status,responseMessage:u})}return l.json()}async function s5(s,e=S1,t){const{appId:n,apiKey:a,measurementId:l}=s.options;if(!n)throw Xs.create("no-app-id");if(!a){if(l)return{measurementId:l,appId:n};throw Xs.create("no-api-key")}const u=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new i5;return setTimeout(async()=>{h.abort()},UM),A1({appId:n,apiKey:a,measurementId:l},u,h,e)}async function A1(s,{throttleEndTimeMillis:e,backoffCount:t},n,a=S1){const{appId:l,measurementId:u}=s;try{await r5(n,e)}catch(h){if(u)return ks.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:l,measurementId:u};throw h}try{const h=await n5(s);return a.deleteThrottleMetadata(l),h}catch(h){const m=h;if(!a5(m)){if(a.deleteThrottleMetadata(l),u)return ks.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${m?.message}]`),{appId:l,measurementId:u};throw h}const p=Number(m?.customData?.httpStatus)===503?U_(t,a.intervalMillis,JM):U_(t,a.intervalMillis),x={throttleEndTimeMillis:Date.now()+p,backoffCount:t+1};return a.setThrottleMetadata(l,x),ks.debug(`Calling attemptFetch again in ${p} millis`),A1(s,x,n,a)}}function r5(s,e){return new Promise((t,n)=>{const a=Math.max(e-Date.now(),0),l=setTimeout(t,a);s.addEventListener(()=>{clearTimeout(l),n(Xs.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function a5(s){if(!(s instanceof br)||!s.customData)return!1;const e=Number(s.customData.httpStatus);return e===429||e===500||e===503||e===504}class i5{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function o5(s,e,t,n,a){if(a&&a.global){s("event",t,n);return}else{const l=await e,u={...n,send_to:l};s("event",t,u)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l5(){if($x())try{await bE()}catch(s){return ks.warn(Xs.create("indexeddb-unavailable",{errorInfo:s?.toString()}).message),!1}else return ks.warn(Xs.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function c5(s,e,t,n,a,l,u){const h=s5(s);h.then(b=>{t[b.measurementId]=b.appId,s.options.measurementId&&b.measurementId!==s.options.measurementId&&ks.warn(`The measurement ID in the local Firebase config (${s.options.measurementId}) does not match the measurement ID fetched from the server (${b.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(b=>ks.error(b)),e.push(h);const m=l5().then(b=>{if(b)return n.getId()}),[p,x]=await Promise.all([h,m]);WM(l)||GM(l,p.measurementId),a("js",new Date);const w=u?.config??{};return w[FM]="firebase",w.update=!0,x!=null&&(w[LM]=x),a("config",p.measurementId,w),p.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u5=class{constructor(e){this.app=e}_delete(){return delete Od[this.app.options.appId],Promise.resolve()}},Od={},BT=[];const qT={};let Yy="dataLayer",d5="gtag",zT,j1,HT=!1;function h5(){const s=[];if(yE()&&s.push("This is a browser extension environment."),OI()||s.push("Cookies are not available."),s.length>0){const e=s.map((n,a)=>`(${a+1}) ${n}`).join(" "),t=Xs.create("invalid-analytics-context",{errorInfo:e});ks.warn(t.message)}}function f5(s,e,t){h5();const n=s.options.appId;if(!n)throw Xs.create("no-app-id");if(!s.options.apiKey)if(s.options.measurementId)ks.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${s.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Xs.create("no-api-key");if(Od[n]!=null)throw Xs.create("already-exists",{id:n});if(!HT){$M(Yy);const{wrappedGtag:l,gtagCore:u}=XM(Od,BT,qT,Yy,d5);j1=l,zT=u,HT=!0}return Od[n]=c5(s,BT,qT,e,zT,Yy,t),new u5(s)}function m5(s=Ym()){s=mt(s);const e=ha(s,Hm);return e.isInitialized()?e.getImmediate():g5(s)}function g5(s,e={}){const t=ha(s,Hm);if(t.isInitialized()){const a=t.getImmediate();if(yr(e,t.getOptions()))return a;throw Xs.create("already-initialized")}return t.initialize({options:e})}function sa(s,e,t,n){s=mt(s),o5(j1,Od[s.app.options.appId],e,t,n).catch(a=>ks.error(a))}const GT="@firebase/analytics",$T="0.10.18";function p5(){Lr(new xr(Hm,(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("installations-internal").getImmediate();return f5(n,a,t)},"PUBLIC")),Lr(new xr("analytics-internal",s,"PRIVATE")),js(GT,$T),js(GT,$T,"esm2020");function s(e){try{const t=e.getProvider(Hm).getImmediate();return{logEvent:(n,a,l)=>sa(t,n,a,l)}}catch(t){throw Xs.create("interop-component-reg-failed",{reason:t})}}}p5();const y5={apiKey:"AIzaSyDQnrbvsx52ikiWELf6hc4YiXQTC1G5tpY",authDomain:"three-sided-flashcard-app.firebaseapp.com",projectId:"three-sided-flashcard-app",storageBucket:"three-sided-flashcard-app.firebasestorage.app",messagingSenderId:"47503676879",appId:"1:47503676879:web:27fb875159cc4459a12eba",measurementId:"G-PBP1G21Q29"},jg=TE(y5),ws=eD(jg),ee=Pj(jg),Ua=W3(jg),Sn=m5(jg),Ba=Object.freeze(Object.defineProperty({__proto__:null,analytics:Sn,auth:ws,db:ee,functions:Ua},Symbol.toStringTag,{value:"Module"}));class Ks{static sanitizeInput(e,t={}){if(!e||typeof e!="string")return"";const{maxLength:n=1e4,allowHtml:a=!1,allowLatex:l=!0,stripScripts:u=!0,stripUrls:h=!1}=t;let m=e;return m.length>n&&(m=m.substring(0,n)),(!a||u)&&(m=m.replace(/<script[^>]*>.*?<\/script>/gi,""),m=m.replace(/on\w+\s*=\s*["'][^"']*["']/gi,""),m=m.replace(/javascript:/gi,""),a||(m=m.replace(/data:/gi,"")),["script","iframe","object","embed","form","input","textarea","button"].forEach(x=>{const w=new RegExp(`<${x}[^>]*>.*?</${x}>`,"gi");m=m.replace(w,"");const b=new RegExp(`<${x}[^>]*/?>`,"gi");m=m.replace(b,"")})),h&&(m=m.replace(/https?:\/\/[^\s]+/gi,"[URL_REMOVED]")),m.trim()}static validateFlashcardInput(e){const t=[],n={};if(!e.statement||typeof e.statement!="string"?t.push("Statement is required and must be text"):e.statement.length<3?t.push("Statement must be at least 3 characters long"):e.statement.length>5e3?t.push("Statement must be less than 5000 characters"):n.statement=this.sanitizeInput(e.statement,{maxLength:5e3,allowLatex:!0,allowHtml:!1}),e.hints&&typeof e.hints=="string"&&(e.hints.length>5e3?t.push("Hints must be less than 5000 characters"):n.hints=this.sanitizeInput(e.hints,{maxLength:5e3,allowLatex:!0,allowHtml:!1})),e.proof&&typeof e.proof=="string"&&(e.proof.length>1e4?t.push("Proof must be less than 10000 characters"):n.proof=this.sanitizeInput(e.proof,{maxLength:1e4,allowLatex:!0,allowHtml:!1})),e.tags)if(typeof e.tags=="string"){const a=e.tags.split(",").map(l=>l.trim()).filter(l=>l);a.length>20&&t.push("Maximum 20 tags allowed"),n.tags=a.map(l=>this.sanitizeInput(l,{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(l=>l&&/^[a-zA-Z0-9\s\-_]+$/.test(l))}else Array.isArray(e.tags)&&(e.tags.length>20&&t.push("Maximum 20 tags allowed"),n.tags=e.tags.slice(0,20).map(a=>this.sanitizeInput(String(a),{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(a=>a&&/^[a-zA-Z0-9\s\-_]+$/.test(a)));return e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),n.isPublic=!!e.isPublic,{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static validateProfileInput(e){const t=[],n={};return!e.displayName||typeof e.displayName!="string"?t.push("Display name is required"):e.displayName.length<2?t.push("Display name must be at least 2 characters"):e.displayName.length>50?t.push("Display name must be less than 50 characters"):/^[a-zA-Z0-9\s\-_\.]+$/.test(e.displayName)?n.displayName=this.sanitizeInput(e.displayName,{maxLength:50,allowLatex:!1,allowHtml:!1}):t.push("Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods"),e.bio&&typeof e.bio=="string"&&(e.bio.length>500?t.push("Bio must be less than 500 characters"):n.bio=this.sanitizeInput(e.bio,{maxLength:500,allowLatex:!1,allowHtml:!1})),e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static rateLimiter=new Map;static checkRateLimit(e,t=10,n=6e4){const a=Date.now(),u=(this.rateLimiter.get(e)||[]).filter(h=>a-h<n);return u.length>=t?{allowed:!1,retryAfter:n-(a-u[0]),message:`Rate limit exceeded. Try again in ${Math.ceil((n-(a-u[0]))/1e3)} seconds.`}:(u.push(a),this.rateLimiter.set(e,u),{allowed:!0,remaining:t-u.length})}static getPublicErrorMessage(e,t=!0){if(!t)return e.message||"Unknown error";const n={"auth/user-not-found":"Invalid email or password","auth/wrong-password":"Invalid email or password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password should be at least 6 characters","auth/invalid-email":"Please enter a valid email address","auth/user-disabled":"This account has been disabled","auth/too-many-requests":"Too many failed attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","auth/popup-closed-by-user":"Sign-in was cancelled","auth/popup-blocked":"Sign-in popup was blocked. Please disable popup blockers","permission-denied":"You don't have permission to perform this action","not-found":"The requested item was not found","already-exists":"This item already exists","resource-exhausted":"Service temporarily unavailable. Please try again","failed-precondition":"Unable to complete request. Please try again",aborted:"Request was cancelled. Please try again","out-of-range":"Request parameters are invalid",unimplemented:"This feature is not yet available",internal:"Internal error. Please try again",unavailable:"Service temporarily unavailable. Please try again","data-loss":"Data error occurred. Please contact support","functions/invalid-argument":"Invalid request parameters","functions/failed-precondition":"Unable to process request","functions/out-of-range":"Request parameters are out of range","functions/unauthenticated":"Please sign in to continue","functions/permission-denied":"You don't have permission for this action","functions/not-found":"Requested service not found","functions/already-exists":"Resource already exists","functions/resource-exhausted":"Service limit reached. Please try again later","functions/cancelled":"Request was cancelled","functions/unknown":"An unexpected error occurred","functions/deadline-exceeded":"Request timed out. Please try again","validation-error":"Please check your input and try again","rate-limit-exceeded":"Too many requests. Please wait and try again","content-too-long":"Content is too long. Please shorten and try again","invalid-content":"Content contains invalid characters","network-error":"Network error. Please check your connection"},a=e.code||e.name||"unknown";return n[a]||"Something went wrong. Please try again"}static INACTIVITY_TIMEOUT=7200*1e3;static lastActivity=Date.now();static timeoutWarningShown=!1;static updateActivity(){this.lastActivity=Date.now(),this.timeoutWarningShown=!1}static checkInactivity(e,t){const n=Date.now()-this.lastActivity;return n>this.INACTIVITY_TIMEOUT*.83&&!this.timeoutWarningShown&&(this.timeoutWarningShown=!0,e&&e()),n>this.INACTIVITY_TIMEOUT?(t&&t(),!0):!1}static setupActivityTracking(e,t){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(a=>{document.addEventListener(a,this.updateActivity.bind(this),{passive:!0})}),setInterval(()=>{this.checkInactivity(e,t)},6e4)}static detectSuspiciousContent(e){const t=[/<script[\s\S]*?>[\s\S]*?<\/script>/gi,/javascript:/gi,/vbscript:/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/union\s+select/gi,/drop\s+table/gi,/delete\s+from/gi,/data:text\/html/gi,/data:application/gi,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g],n=[];return t.forEach((a,l)=>{const u=e.match(a);u&&n.push({pattern:l,matches:u.length,content:u[0]})}),{isSuspicious:n.length>0,findings:n}}static generateSecureId(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";const a=new Uint8Array(e);crypto.getRandomValues(a);for(let l=0;l<e;l++)n+=t[a[l]%t.length];return n}static async hashForLogging(e){const n=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(a)).map(u=>u.toString(16).padStart(2,"0")).join("")}}const I1=P.createContext(void 0),KT=s=>{switch(s){case"auth/popup-closed-by-user":return"Sign-in popup was closed.";case"auth/cancelled-popup-request":return"Another sign-in is in progress.";case"auth/popup-blocked":return"Popup blocked by the browser. Try again or disable the blocker.";case"auth/network-request-failed":return"Network error. Check your connection and try again.";case"auth/user-disabled":return"This account has been disabled.";default:return"Sign-in failed. Please try again."}},Rn=()=>{const s=P.useContext(I1);if(!s)throw new Error("useAuth must be used within <AuthProvider>");return s},x5=({children:s,fallback:e=null})=>{const[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState(!0),[m,p]=P.useState(null),[x,w]=P.useState(!1),b=P.useRef(!1);P.useEffect(()=>{UR(ws,XE).catch(F=>{console.warn("Auth persistence failed, falling back to default:",F)})},[]),P.useEffect(()=>{const F=qR(ws,H=>{n(H),b.current||(b.current=!0,h(!1))}),B=KE(ws,async H=>{if(H)try{const $=await H.getIdToken(!1);l($)}catch($){console.warn("Failed to get ID token:",$),l(null)}else l(null)});return()=>{F(),B()}},[]);const E=async()=>{if(!ws.currentUser)return null;try{const F=await ws.currentUser.getIdToken(!0);return l(F),F}catch(F){return console.warn("getFreshIdToken error:",F),null}},C=async()=>{p(null);const F=new Ma;F.setCustomParameters({prompt:"select_account"});try{return(await lk(ws,F)).user}catch(B){if(B?.code==="auth/popup-blocked"||B?.code==="auth/popup-closed-by-user"||B?.code==="auth/cancelled-popup-request")try{return await mk(ws,F),null}catch(H){throw p(KT(H.code)),H}throw p(KT(B.code)),B}},k=async()=>{p(null);try{await zR(ws)}catch(F){throw p("Error signing out. Please try again."),F}};P.useEffect(()=>{if(t){const F=()=>{w(!0)},B=()=>{alert("Your session has expired due to inactivity. Please sign in again."),k()};Ks.setupActivityTracking(F,B)}},[t]);const L=()=>{w(!1),Ks.updateActivity()},U=P.useMemo(()=>({user:t,idToken:a,loading:u,authError:m,sessionWarning:x,dismissSessionWarning:L,signInWithGoogle:C,logout:k,getFreshIdToken:E}),[t,a,u,m,x]);return i.jsx(I1.Provider,{value:U,children:u?e:s})};class As{static async isSlugTaken(e){try{return(await vt(ve(ee,"profiles",e))).exists()}catch(t){throw console.error("Error checking slug availability:",t),t}}static slugify(e){if(!e||typeof e!="string")return"";const n=e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").slice(0,30);return n.length>=3?n:""}static async createProfile(e,t,n){try{const{displayName:a,bio:l="",institution:u="",email:h}=n;if(await this.isSlugTaken(t))throw new Error(`Slug '${t}' is already taken`);const m={userId:e,displayName:a,bio:l,institution:u,email:h,createdAt:Pe(),updatedAt:Pe(),flashcardCount:0,upvotesReceived:0,loginStreak:0,lastLoginDate:Pe()};await Rs(ve(ee,"profiles",t),m),await Rs(ve(ee,"userToSlug",e),{slug:t}),console.log(" Profile created successfully:",{userId:e,slug:t})}catch(a){throw console.error(" Error creating profile:",a),a}}static async getProfileBySlug(e){try{const t=await vt(ve(ee,"profiles",e));return t.exists()?{id:t.id,slug:t.id,...t.data()}:null}catch(t){throw console.error("Error getting profile by slug:",t),t}}static async getProfileByUserId(e){try{const t=await vt(ve(ee,"userToSlug",e));if(!t.exists())return null;const{slug:n}=t.data();return await this.getProfileBySlug(n)}catch(t){throw console.error("Error getting profile by user ID:",t),t}}static async updateProfile(e,t){try{const n={...t,updatedAt:Pe()};await $t(ve(ee,"profiles",e),n),console.log(" Profile updated successfully:",e)}catch(n){throw console.error(" Error updating profile:",n),n}}static async searchProfiles(e,t=20){try{const n=e.toLowerCase().trim();if(!n)return[];const a=Le(Ce(ee,"profiles")),l=await Ke(a),u=[];return l.docs.forEach(h=>{const m=h.data(),p=(m.displayName||"").toLowerCase(),x=(m.email||"").toLowerCase();(p.includes(n)||x.includes(n))&&u.push({slug:h.id,userId:m.userId,displayName:m.displayName,email:m.email,institution:m.institution,flashcardCount:m.flashcardCount||0})}),u.slice(0,t)}catch(n){throw console.error("Error searching profiles:",n),n}}static async getUserSlug(e){try{const t=await vt(ve(ee,"userToSlug",e));return t.exists()?t.data().slug:null}catch(t){return console.error("Error getting user slug:",t),null}}static async hasProfile(e){try{return!!await this.getUserSlug(e)}catch(t){return console.error("Error checking if user has profile:",t),!1}}static async updateUserStats(e,t){try{const n=await this.getUserSlug(e);if(!n)return;await this.updateProfile(n,t)}catch(n){throw console.error("Error updating user stats:",n),n}}}class is{static async createDeck(e,t){try{const n=await Ys(Ce(ee,"decks"),{name:t.name||"Untitled Deck",description:t.description||"",userId:e,isPublic:t.isPublic||!1,isDefault:t.isDefault||!1,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,color:t.color||"#635BFF",icon:t.icon||"",createdAt:Pe(),updatedAt:Pe(),authorSlug:t.authorSlug||null,slug:t.slug||null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0});return t.isPublic&&t.slug&&t.authorSlug&&await Ys(Ce(ee,"publicDecks"),{deckId:n.id,name:t.name,description:t.description,authorSlug:t.authorSlug,slug:t.slug,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,likeCount:0,importCount:0,createdAt:Pe()}),n.id}catch(n){throw console.error("Error creating deck:",n),n}}static async getUserDecks(e,t=!0){try{let n=Le(Ce(ee,"decks"),Ye("userId","==",e),Jt("updatedAt","desc"));return t||(n=Le(Ce(ee,"decks"),Ye("userId","==",e),Ye("isDefault","==",!1),Jt("updatedAt","desc"))),(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user decks:",n),n}}static async getDeck(e){try{const t=await vt(ve(ee,"decks",e));if(!t.exists())throw new Error("Deck not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching deck:",t),t}}static async updateDeck(e,t){try{const n={...t,updatedAt:Pe()};await $t(ve(ee,"decks",e),n);const a=await this.getDeck(e);if(a.isPublic&&a.slug){const l=Le(Ce(ee,"publicDecks"),Ye("deckId","==",e),Zt(1)),u=await Ke(l);if(!u.empty){const h=u.docs[0];await $t(ve(ee,"publicDecks",h.id),{name:t.name||a.name,description:t.description||a.description,subject:t.subject||a.subject,difficulty:t.difficulty||a.difficulty,tags:t.tags||a.tags})}}return!0}catch(n){throw console.error("Error updating deck:",n),n}}static async deleteDeck(e){try{const t=Jo(ee),n=Le(Ce(ee,"deckCards"),Ye("deckId","==",e)),a=await Ke(n);for(const h of a.docs){t.delete(ve(ee,"deckCards",h.id));const m=h.data().cardId,p=ve(ee,"cards",m);t.update(p,{deckIds:Um(e)})}t.delete(ve(ee,"decks",e));const l=Le(Ce(ee,"publicDecks"),Ye("deckId","==",e)),u=await Ke(l);for(const h of u.docs)t.delete(ve(ee,"publicDecks",h.id));return await t.commit(),!0}catch(t){throw console.error("Error deleting deck:",t),t}}static async addCardToDeck(e,t,n=null){try{return await Td(ee,async a=>{const l=ve(ee,"decks",e),u=await a.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data().cardCount||0,m=n!==null?n:h+1,p=ve(Ce(ee,"deckCards"));a.set(p,{deckId:e,cardId:t,position:m,addedAt:Pe(),addedBy:u.data().userId});const x=ve(ee,"cards",t);return a.update(x,{deckIds:Qc(e)}),a.update(l,{cardCount:h+1,updatedAt:Pe()}),p.id})}catch(a){throw console.error("Error adding card to deck:",a),a}}static async removeCardFromDeck(e,t){try{return await Td(ee,async n=>{const a=Le(Ce(ee,"deckCards"),Ye("deckId","==",e),Ye("cardId","==",t),Zt(1)),l=await Ke(a);if(l.empty)throw new Error("Card not found in deck");const u=l.docs[0];n.delete(ve(ee,"deckCards",u.id));const h=ve(ee,"cards",t);n.update(h,{deckIds:Um(e)});const m=ve(ee,"decks",e),x=(await n.get(m)).data().cardCount||0;return n.update(m,{cardCount:Math.max(0,x-1),updatedAt:Pe()}),!0})}catch(n){throw console.error("Error removing card from deck:",n),n}}static async getDeckCards(e,t=100){try{const n=Le(Ce(ee,"deckCards"),Ye("deckId","==",e),Jt("position","asc"),Zt(t)),l=(await Ke(n)).docs.map(h=>h.data().cardId);if(l.length===0)return[];const u=[];for(const h of l)try{const m=await vt(ve(ee,"cards",h));m.exists()&&u.push({id:m.id,...m.data()})}catch(m){console.warn(`Failed to fetch card ${h}:`,m)}return u}catch(n){throw console.error("Error fetching deck cards:",n),n}}static async reorderCardsInDeck(e,t){try{const n=Jo(ee);for(const{cardId:a,position:l}of t){const u=Le(Ce(ee,"deckCards"),Ye("deckId","==",e),Ye("cardId","==",a),Zt(1)),h=await Ke(u);if(!h.empty){const m=h.docs[0];n.update(ve(ee,"deckCards",m.id),{position:l})}}return await n.commit(),!0}catch(n){throw console.error("Error reordering deck cards:",n),n}}static async createDefaultDeck(e){try{const t={name:"My Flashcards",description:"Your complete collection - contains all your flashcards",isDefault:!0,isPublic:!1,subject:"",difficulty:"mixed",tags:[],color:"#635BFF",icon:""};return{id:await this.createDeck(e,t),...t}}catch(t){throw console.error("Error creating default deck:",t),t}}static async getOrCreateDefaultDeck(e){try{const t=Le(Ce(ee,"decks"),Ye("userId","==",e),Ye("isDefault","==",!0),Zt(1)),n=await Ke(t);if(!n.empty){const a=n.docs[0];return{id:a.id,...a.data()}}return await this.createDefaultDeck(e)}catch(t){throw console.error("Error getting or creating default deck:",t),t}}static async migrateCardsToDefaultDeck(e){try{console.log(` Starting deck migration for user: ${e}`);const t=await this.getOrCreateDefaultDeck(e);console.log(` Default deck: ${t.name} (${t.id})`);const[n,a]=await Promise.all([this.getUserCardsFromCollection("cards",e),this.getUserCardsFromCollection("flashcards",e)]),l=[...n,...a];if(console.log(` Found ${l.length} cards to migrate`),l.length===0)return console.log(" No cards to migrate"),{migratedCount:0,defaultDeck:t};let u=0;const h=Jo(ee);for(const m of l)try{const p=ve(Ce(ee,"deckCards"));h.set(p,{deckId:t.id,cardId:m.id,position:u+1,addedAt:Pe(),addedBy:e});const x=ve(ee,m.collection,m.id),w=m.deckIds||[],b=w.includes(t.id)?w:[...w,t.id];h.update(x,{deckIds:b,defaultDeckId:t.id}),u++}catch(p){console.warn(`Failed to migrate card ${m.id}:`,p)}if(u>0){const m=ve(ee,"decks",t.id);h.update(m,{cardCount:u,updatedAt:Pe()}),await h.commit()}return console.log(` Migration complete: ${u} cards migrated`),{migratedCount:u,defaultDeck:t}}catch(t){throw console.error("Error migrating cards to default deck:",t),t}}static async getUserCardsFromCollection(e,t){try{const n=Le(Ce(ee,e),Ye("userId","==",t),Jt("createdAt","desc"));return(await Ke(n)).docs.map(l=>({id:l.id,collection:e,...l.data()}))}catch(n){return console.error(`Error fetching cards from ${e}:`,n),[]}}static async makeDeckPublic(e,t,n){try{return await Td(ee,async a=>{const l=ve(ee,"decks",e),u=await a.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data();a.update(l,{isPublic:!0,authorSlug:t,slug:n,updatedAt:Pe()});const m=ve(Ce(ee,"publicDecks"));return a.set(m,{deckId:e,name:h.name,description:h.description,authorSlug:t,slug:n,subject:h.subject||"",difficulty:h.difficulty||"beginner",tags:h.tags||[],cardCount:h.cardCount||0,likeCount:0,importCount:0,createdAt:h.createdAt}),!0})}catch(a){throw console.error("Error making deck public:",a),a}}static async getPublicDecks(e={},t=50){try{let n=Le(Ce(ee,"publicDecks"));return e.subject&&(n=Le(n,Ye("subject","==",e.subject))),e.difficulty&&(n=Le(n,Ye("difficulty","==",e.difficulty))),e.tag&&(n=Le(n,Ye("tags","array-contains",e.tag))),e.sortBy==="popular"?n=Le(n,Jt("likeCount","desc"),Jt("createdAt","desc")):e.sortBy==="imported"?n=Le(n,Jt("importCount","desc"),Jt("createdAt","desc")):n=Le(n,Jt("createdAt","desc")),n=Le(n,Zt(t)),(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching public decks:",n),n}}static async importPublicDeck(e,t){try{return await Td(ee,async n=>{const a=ve(ee,"decks",e),l=await n.get(a);if(!l.exists())throw new Error("Source deck not found");const u=l.data(),h=ve(Ce(ee,"decks"));n.set(h,{...u,userId:t,isPublic:!1,isDefault:!1,name:`${u.name} (Imported)`,authorSlug:null,slug:null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0,createdAt:Pe(),updatedAt:Pe()});const m=Le(Ce(ee,"deckCards"),Ye("deckId","==",e)),p=await Ke(m);for(const b of p.docs){const E=b.data(),C=ve(ee,"cards",E.cardId),k=await n.get(C);if(k.exists()){const L=k.data(),U=ve(Ce(ee,"cards"));n.set(U,{...L,userId:t,isPublic:!1,deckIds:[h.id],defaultDeckId:h.id,createdAt:Pe(),originalCardId:E.cardId});const F=ve(Ce(ee,"deckCards"));n.set(F,{deckId:h.id,cardId:U.id,position:E.position,addedAt:Pe(),addedBy:t})}}const x=Le(Ce(ee,"publicDecks"),Ye("deckId","==",e),Zt(1)),w=await Ke(x);if(!w.empty){const b=w.docs[0];n.update(ve(ee,"publicDecks",b.id),{importCount:(b.data().importCount||0)+1})}return h.id})}catch(n){throw console.error("Error importing public deck:",n),n}}static async updateDeckStats(e,t){try{const n=ve(ee,"decks",e);return await $t(n,{...t,lastStudied:Pe(),updatedAt:Pe()}),!0}catch(n){throw console.error("Error updating deck stats:",n),n}}static async getDeckAnalytics(e){try{const t=await this.getDeck(e),n=await this.getDeckCards(e);return{cardCount:n.length,studyStreak:t.studyStreak||0,averageScore:t.averageScore||0,lastStudied:t.lastStudied,createdAt:t.createdAt,subjects:[...new Set(n.map(a=>a.subject).filter(Boolean))],tags:[...new Set(n.flatMap(a=>a.tags||[]))]}}catch(t){throw console.error("Error getting deck analytics:",t),t}}static async generateUniqueSlug(e,t){try{const n=`${e.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,30)}-${t}`;let a=n,l=0;for(;l<5;){const u=Le(Ce(ee,"publicDecks"),Ye("slug","==",a),Zt(1));if((await Ke(u)).empty)return a;a=`${n}-${Math.floor(Math.random()*1e4)}`,l++}throw new Error("Failed to generate unique slug")}catch(n){throw console.error("Error generating unique slug:",n),n}}}class um{static async getUserProfile(e){try{return await As.getProfileByUserId(e)}catch(t){throw console.error("Error fetching user profile:",t),t}}static async createUserProfile(e,t){try{const n=ve(ee,"users",e);return await Rs(n,{...t,createdAt:Pe(),updatedAt:Pe(),isPremium:!1,flashcardCount:0,upvotes:0,streak:0}),e}catch(n){throw console.error("Error creating user profile:",n),n}}static async updateUserProfile(e,t){try{const n=ve(ee,"users",e);await $t(n,{...t,updatedAt:Pe()})}catch(n){throw console.error("Error updating user profile:",n),n}}static async getUserStats(e){try{const t=await this.getUserProfile(e);if(!t)return null;const n=[Le(Ce(ee,"cards"),Ye("userId","==",e)),Le(Ce(ee,"flashcards"),Ye("userId","==",e)),Le(Ce(ee,"publicCards"),Ye("userId","==",e))],[a,l,u]=await Promise.all(n.map(p=>Ke(p))),h=a.size+l.size+u.size,m=[];return h>0&&m.push("first_card"),h>=10&&m.push("ten_cards"),h>=100&&m.push("hundred_cards"),t.upvotesReceived>50&&m.push("popular_creator"),{...t,flashcardCount:h,achievements:m,studySessions:Math.floor(Math.random()*20)+1,followers:Math.floor(Math.random()*100),rating:(Math.random()*2+3).toFixed(1)}}catch(t){throw console.error("Error fetching user stats:",t),t}}static async checkOnboardingStatus(e){try{const t=await this.getUserProfile(e);if(!t)return{hasProfile:!1,hasCards:!1};const n=Le(Ce(ee,"flashcards"),Ye("authorId","==",e),Zt(1));return{hasProfile:!0,hasCards:!(await Ke(n)).empty,profile:t}}catch(t){throw console.error("Error checking onboarding status:",t),t}}static async getTopUsers(e=20,t="allTime"){try{const n=Le(Ce(ee,"users"),Jt("flashcardCount","desc"),Jt("upvotes","desc"),Zt(e));return(await Ke(n)).docs.map(l=>({uid:l.id,...l.data()}))}catch(n){return console.error("Error fetching top users:",n),[]}}static async getStudyHistory(e){try{return[{date:"2024-01-15",duration:45,cardsStudied:12,accuracy:85},{date:"2024-01-14",duration:30,cardsStudied:8,accuracy:92},{date:"2024-01-13",duration:60,cardsStudied:20,accuracy:78},{date:"2024-01-12",duration:25,cardsStudied:6,accuracy:95},{date:"2024-01-11",duration:40,cardsStudied:15,accuracy:88}]}catch(t){return console.error("Error fetching study history:",t),[]}}static async needsDeckMigration(e){try{if((await is.getUserDecks(e)).length>0)return!1;const n=Le(Ce(ee,"cards"),Ye("userId","==",e),Zt(1)),a=await Ke(n),l=Le(Ce(ee,"flashcards"),Ye("userId","==",e),Zt(1)),u=await Ke(l);return!a.empty||!u.empty}catch(t){return console.error("Error checking deck migration status:",t),!1}}static async migrateUserToDecks(e){try{if(console.log(` Starting deck migration for user: ${e}`),!await this.needsDeckMigration(e))return console.log(" User already migrated or has no cards"),{success:!0,message:"No migration needed"};const n=await is.migrateCardsToDefaultDeck(e),a=ve(ee,"users",e);return await Rs(a,{deckMigrationCompleted:!0,deckMigrationDate:Pe(),updatedAt:Pe()},{merge:!0}),console.log(` Deck migration completed for user: ${e}`),console.log(" Migration stats:",n),{success:!0,message:`Successfully migrated ${n.migratedCount} cards`,migrationResult:n}}catch(t){console.error("Error migrating user to decks:",t);try{const n=ve(ee,"users",e);await Rs(n,{deckMigrationFailed:!0,deckMigrationError:t.message,deckMigrationAttemptDate:Pe(),updatedAt:Pe()},{merge:!0})}catch(n){console.error("Failed to log migration error:",n)}return{success:!1,message:`Migration failed: ${t.message}`,error:t}}}static async autoMigrateUserDecks(e){try{const t=await vt(ve(ee,"users",e)),n=t.exists()?t.data():{};if(n.deckMigrationCompleted)return{success:!0,message:"Already migrated"};if(n.deckMigrationFailed&&n.deckMigrationAttemptDate){const a=n.deckMigrationAttemptDate.toMillis();if((Date.now()-a)/(1e3*60*60)<24)return{success:!1,message:"Migration failed recently, will retry later"}}return await this.migrateUserToDecks(e)}catch(t){return console.error("Error in auto-migration:",t),{success:!1,message:"Auto-migration failed",error:t}}}}class os{static async getUserFlashcards(e,t=50){try{const n=Le(Ce(ee,"cards"),Ye("userId","==",e),Jt("createdAt","desc"),Zt(t));return(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user flashcards:",n),n}}static async getPublicFlashcards(e=50){try{const t=Le(Ce(ee,"publicCards"),Jt("createdAt","desc"),Zt(e));return(await Ke(t)).docs.map(a=>({id:a.id,...a.data()}))}catch(t){throw console.error("Error fetching public flashcards:",t),t}}static async getPublicFlashcardsByUser(e,t=50){try{const n=Le(Ce(ee,"publicCards"),Ye("userId","==",e),Jt("createdAt","desc"),Zt(t));return(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user public flashcards:",n),n}}static async createFlashcard(e,t,n=null){try{if(console.log(" Creating flashcard for user:",t,"with data:",e),!t||typeof t!="string")throw new Error("Valid user ID is required to create flashcard");const a=await is.getOrCreateDefaultDeck(t);console.log(" Default deck obtained:",a.id);const l=n||a.id,u=n&&n!==a.id?[a.id,l]:[a.id],h={statement:e.statement||e.question||"",hints:e.hints||e.answer||"",proof:e.proof||"",tags:Array.isArray(e.tags)?e.tags:typeof e.tags=="string"?e.tags.split(",").map(p=>p.trim()).filter(p=>p):[],subject:e.subject||"",userId:t,createdAt:Pe(),isPublic:e.isPublic||!1,defaultDeckId:a.id,deckIds:u};console.log(" Creating card document:",h);const m=await Ys(Ce(ee,"cards"),h);if(e.isPublic){let p=null;const x=await vt(ve(ee,"userToSlug",t));if(x.exists())p=x.data().slug;else{const E=await vt(ve(ee,"users",t));if(E.exists()&&E.data().username)p=E.data().username;else throw new Error("You must create a profile before posting public cards. Please create your profile first.")}const w=(e.question||e.statement).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,50),b=await this.ensureUniqueCardSlug(w);await Rs(ve(ee,"publicCards",b),{statement:e.question||e.statement,hints:e.hints||e.answer,proof:e.proof||e.answer,tags:e.tags||[],userId:t,authorSlug:p,slug:b,id:b,createdAt:Pe(),likeCount:0,viewCount:0,importCount:0})}for(const p of u)await is.addCardToDeck(p,m.id);return m.id}catch(a){throw console.error("Error creating flashcard:",a),a}}static async updateCardDeck(e,t){try{const n=ve(ee,"cards",e),a=await vt(n);if(!a.exists())throw new Error("Card not found");const u=a.data().deckIds||[];if(!u.includes(t)){const h=[...u,t];await $t(n,{deckIds:h})}return!0}catch(n){throw console.error("Error updating card deck:",n),n}}static async ensureUniqueCardSlug(e){let t=e,n=0;for(;n<5;){const a=ve(ee,"publicCards",t);if(!(await vt(a)).exists())return t;t=e+"-"+Math.floor(Math.random()*1e4),n++}throw new Error("Failed to generate unique card slug after multiple attempts.")}static async updateFlashcard(e,t){try{const n=ve(ee,"cards",e);await $t(n,{...t,updatedAt:Pe()})}catch(n){throw console.error("Error updating flashcard:",n),n}}static async deleteFlashcard(e){try{const t=ve(ee,"cards",e);await Wo(t)}catch(t){throw console.error("Error deleting flashcard:",t),t}}static async searchFlashcards(e,t={},n=20){try{const a=[Ye("isPublic","==",!0)];t.subject&&a.push(Ye("subject","==",t.subject));let l="createdAt",u="desc";t.sortBy==="oldest"?(l="createdAt",u="asc"):t.sortBy==="popular"&&(l="upvotes",u="desc");const h=Le(Ce(ee,"flashcards"),...a,Jt(l,u),Zt(n*3));let p=(await Ke(h)).docs.map(x=>({id:x.id,...x.data()}));if(e&&e.trim()){const x=e.toLowerCase();p=p.filter(w=>w.question?.toLowerCase().includes(x)||w.answer?.toLowerCase().includes(x)||Array.isArray(w.hints)&&w.hints.some(b=>b.toLowerCase().includes(x))||Array.isArray(w.tags)&&w.tags.some(b=>b.toLowerCase().includes(x)))}return p.slice(0,n)}catch(a){return console.error("Error searching flashcards:",a),await this.getPublicFlashcards(n)}}static async getSubjects(){try{const e=await this.getPublicFlashcards(1e3),t=new Set;return e.forEach(n=>{n.subject&&t.add(n.subject)}),Array.from(t).sort()}catch(e){return console.error("Error fetching subjects:",e),["Mathematics","Physics","Chemistry","Biology","Computer Science"]}}static async getPopularTags(e=20){try{const t=await this.getPublicFlashcards(1e3),n={};return t.forEach(a=>{a.tags&&a.tags.forEach(l=>{n[l]=(n[l]||0)+1})}),Object.entries(n).sort(([,a],[,l])=>l-a).slice(0,e).map(([a])=>a)}catch(t){return console.error("Error fetching popular tags:",t),["calculus","algebra","geometry","trigonometry","statistics"]}}static async getUserFavorites(e){try{return(await this.getPublicFlashcards(20)).slice(0,10)}catch(t){return console.error("Error fetching user favorites:",t),[]}}static async removeFromFavorites(e,t){try{return!0}catch(n){throw console.error("Error removing from favorites:",n),n}}static async getDeckFlashcards(e,t=100){try{return await is.getDeckCards(e,t)}catch(n){throw console.error("Error fetching deck flashcards:",n),n}}static async moveCardToDeck(e,t,n){try{return t&&await is.removeCardFromDeck(t,e),await is.addCardToDeck(n,e),await $t(ve(ee,"cards",e),{defaultDeckId:n,deckIds:Qc(n)}),t&&await $t(ve(ee,"cards",e),{deckIds:Um(t)}),!0}catch(a){throw console.error("Error moving card to deck:",a),a}}static async getUserFlashcardsByDeck(e){try{const t=await is.getUserDecks(e),n={};for(const a of t)n[a.id]={deck:a,cards:await this.getDeckFlashcards(a.id)};return n}catch(t){throw console.error("Error fetching user flashcards by deck:",t),t}}static async createFlashcardInDeck(e,t,n){try{return await this.createFlashcard(e,t,n)}catch(a){throw console.error("Error creating flashcard in deck:",a),a}}static async getFlashcardsFromDecks(e,t=200){try{const n=[];for(const l of e){const u=await this.getDeckFlashcards(l,t);n.push(...u)}return n.reduce((l,u)=>(l.find(h=>h.id===u.id)||l.push(u),l),[]).sort((l,u)=>{const h=l.createdAt?.toMillis?.()||l.createdAt?.getTime?.()||0;return(u.createdAt?.toMillis?.()||u.createdAt?.getTime?.()||0)-h})}catch(n){throw console.error("Error fetching flashcards from multiple decks:",n),n}}static async getPublicFlashcard(e){try{const t=await vt(ve(ee,"publicCards",e));if(!t.exists())throw new Error("Public flashcard not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching public flashcard:",t),t}}static async updatePublicFlashcard(e,t,n){try{const a=await vt(ve(ee,"publicCards",e));if(!a.exists())throw new Error("Public flashcard not found");if(a.data().userId!==n)throw new Error("You can only edit your own public flashcards");const u=ve(ee,"publicCards",e);return await $t(u,{...t,updatedAt:Pe()}),{success:!0}}catch(a){throw console.error("Error updating public flashcard:",a),a}}static async deletePublicFlashcard(e,t){try{const n=await vt(ve(ee,"publicCards",e));if(!n.exists())throw new Error("Public flashcard not found");if(n.data().userId!==t)throw new Error("You can only delete your own public flashcards");return await Wo(ve(ee,"publicCards",e)),{success:!0}}catch(n){throw console.error("Error deleting public flashcard:",n),n}}static async toggleFlashcardPublic(e,t,n=!0){try{return n?await this.makeFlashcardPublic(e,t):await this.makeFlashcardPrivate(e,t),{success:!0}}catch(a){throw console.error("Error toggling flashcard public status:",a),a}}static async makeFlashcardPublic(e,t){try{const n=await this.getFlashcard(e,t),a=await vt(ve(ee,"userToSlug",t));if(!a.exists())throw new Error("You must create a profile before making cards public");const l=a.data().slug,u=this.generateSlugFromStatement(n.statement),h=await this.ensureUniqueSlug(u),m={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,authorSlug:l,slug:h,createdAt:n.createdAt||Pe(),updatedAt:Pe(),likeCount:0,viewCount:0,importCount:0};return await Rs(ve(ee,"publicCards",h),m),await $t(ve(ee,"cards",e),{isPublic:!0,publicSlug:h,updatedAt:Pe()}),{success:!0,publicSlug:h,publicUrl:`/card/${h}`}}catch(n){throw console.error("Error making flashcard public:",n),n}}static async makeFlashcardPrivate(e,t){try{const n=await vt(ve(ee,"cards",e));if(!n.exists())throw new Error("Private flashcard not found");const a=n.data();if(a.userId!==t)throw new Error("You can only modify your own flashcards");return a.publicSlug&&await Wo(ve(ee,"publicCards",a.publicSlug)),await $t(ve(ee,"cards",e),{isPublic:!1,publicSlug:null,updatedAt:Pe()}),{success:!0}}catch(n){throw console.error("Error making flashcard private:",n),n}}static async importPublicFlashcard(e,t){try{const n=await this.getPublicFlashcard(e),a={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,createdAt:Pe(),isPublic:!1,originalCardId:e,originalAuthor:n.userId,importedAt:Pe()},l=await Ys(Ce(ee,"cards"),a);return await $t(ve(ee,"publicCards",e),{importCount:increment(1)}),{success:!0,cardId:l.id}}catch(n){throw console.error("Error importing public flashcard:",n),n}}static generateSlugFromStatement(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().replace(/\s+/g,"-").slice(0,50)}static async ensureUniqueSlug(e){let t=e,n=0;const a=10;for(;n<a;){if(!(await vt(ve(ee,"publicCards",t))).exists())return t;n++,t=`${e}-${Math.floor(Math.random()*1e4)}`}throw new Error("Failed to generate unique slug after multiple attempts")}}class dm{static async autoFillFromStatement(e){try{const t=await ws.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/deepseekAutofill",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}const a=await n.json();return{hints:a.hints||"",proof:a.proof||"",tags:a.tags||[]}}catch(t){throw console.error("Error with AI autofill:",t),t}}static async autoTagOnly(e){try{const t=await ws.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/autoTagOnly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).tags||[]}catch(t){throw console.error("Error with AI auto-tagging:",t),t}}static async convertToLaTeX(e){try{const t=await ws.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/convertToLatex",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({input:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).latex||e}catch(t){throw console.error("Error converting to LaTeX:",t),t}}}const v5="modulepreload",b5=function(s){return"/new/"+s},QT={},An=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let p=function(x){return Promise.all(x.map(w=>Promise.resolve(w).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var u=p;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),m=h?.nonce||h?.getAttribute("nonce");a=p(t.map(x=>{if(x=b5(x),x in QT)return;QT[x]=!0;const w=x.endsWith(".css"),b=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${b}`))return;const E=document.createElement("link");if(E.rel=w?"stylesheet":v5,w||(E.as="script"),E.crossOrigin="",E.href=x,m&&E.setAttribute("nonce",m),document.head.appendChild(E),w)return new Promise((C,k)=>{E.addEventListener("load",C),E.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${x}`)))})}))}function l(h){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=h,window.dispatchEvent(m),!m.defaultPrevented)throw h}return a.then(h=>{for(const m of h||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})},w5=({value:s,onChange:e,className:t="",placeholder:n="Type tags here or click existing tags below"})=>{const{user:a}=Rn(),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[w,b]=P.useState([]),E=P.useRef(null);P.useEffect(()=>{const $=s?s.split(",").map(M=>M.trim()).filter(M=>M):[];b($)},[s]);const C=()=>{if(!s)return l;const $=s.split(",").map(R=>R.trim()),M=$[$.length-1].toLowerCase();return M?l.filter(R=>R.toLowerCase().includes(M)&&!w.includes(R)).sort((R,N)=>{const A=R.toLowerCase().startsWith(M),V=N.toLowerCase().startsWith(M);return A&&!V?-1:!A&&V?1:R.localeCompare(N)}):l};P.useEffect(()=>{k()},[a]);const k=async()=>{if(!a?.uid){m(!1);return}try{m(!0);const $=await os.getUserFlashcards(a.uid,200),{collection:M,query:R,where:N,getDocs:A}=await An(async()=>{const{collection:oe,query:Y,where:be,getDocs:D}=await Promise.resolve().then(()=>ra);return{collection:oe,query:Y,where:be,getDocs:D}},void 0),{db:V}=await An(async()=>{const{db:oe}=await Promise.resolve().then(()=>Ba);return{db:oe}},void 0),I=R(M(V,"flashcards"),N("userId","==",a.uid)),O=(await A(I)).docs.map(oe=>oe.data()),Ve=[...$,...O],ae=new Set;Ve.forEach(oe=>{oe.tags&&Array.isArray(oe.tags)?oe.tags.forEach(Y=>{Y&&typeof Y=="string"&&ae.add(Y.trim())}):typeof oe.tags=="string"&&oe.tags.split(",").forEach(Y=>{const be=Y.trim();be&&ae.add(be)})});const z=Array.from(ae).sort();u(z)}catch($){console.error("Error loading existing tags:",$),u([])}finally{m(!1)}},L=$=>{const M=w.slice();if(M.includes($))return;const R=[...M,$],N=R.join(", ");b(R),e(N)},U=$=>{const M=w.filter(N=>N!==$),R=M.join(", ");b(M),e(R)},F=$=>{e($.target.value)},B=$=>{if($.key==="Tab"){const M=C();M.length>0&&($.preventDefault(),L(M[0]))}},H=()=>{x(!p)};return i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"mb-3",children:i.jsx("textarea",{ref:E,value:s,onChange:F,onKeyDown:B,placeholder:n,className:`claude-input w-full resize-none ${t}`,rows:"2"})}),w.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Selected tags:"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(($,M)=>i.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:["#",$,i.jsx("button",{onClick:()=>U($),className:"ml-1 hover:bg-white/20 rounded-full w-4 h-4 flex items-center justify-center text-xs",title:"Remove tag",children:""})]},M))})]}),i.jsxs("div",{className:"existing-tags-section",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"text-sm claude-text-secondary",children:s?`Filtered tags (${C().length}):`:"Click to add existing tags:"}),l.length>6&&i.jsxs("button",{onClick:H,className:"text-sm px-2 py-1 rounded",style:{color:"var(--claude-accent)",backgroundColor:"var(--claude-accent-bg)"},children:["View All (",l.length,")"]})]}),i.jsx("div",{className:"existing-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",maxHeight:"120px",overflowY:"auto",padding:"0.75rem",backgroundColor:"var(--claude-surface)",border:"1px solid var(--claude-border)",borderRadius:"8px"},children:h?i.jsx("div",{className:"claude-text-muted italic",children:"Loading existing tags..."}):l.length===0?i.jsx("div",{className:"claude-text-muted italic",children:"No existing tags found. Create your first card to see tags here!"}):C().length===0&&s?i.jsxs("div",{className:"claude-text-muted italic",children:['No tags match your search. Press Enter to add "',s.split(",").pop()?.trim(),'" as a new tag.']}):C().slice(0,p?C().length:12).map($=>{const M=w.includes($);return i.jsxs("button",{onClick:()=>L($),className:`tag-btn transition-all duration-200 ${M?"selected":""}`,style:{backgroundColor:M?"var(--claude-accent)":"var(--claude-subtle)",color:M?"white":"var(--claude-primary-text)",border:"none",padding:"0.25rem 0.75rem",borderRadius:"20px",fontSize:"0.85rem",cursor:"pointer",whiteSpace:"nowrap",opacity:M?.7:1},onMouseEnter:R=>{M||(R.target.style.backgroundColor="var(--claude-border)",R.target.style.color="var(--claude-heading)")},onMouseLeave:R=>{M||(R.target.style.backgroundColor="var(--claude-subtle)",R.target.style.color="var(--claude-primary-text)")},title:M?"Already selected":`Add "${$}" tag`,children:["#",$]},$)})})]}),p&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"claude-card max-w-2xl w-full mx-4 p-6 max-h-[80vh] overflow-hidden",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Select Tags"}),i.jsx("button",{onClick:()=>x(!1),className:"claude-text-muted hover:claude-text-secondary transition-colors text-2xl",style:{color:"var(--claude-text-muted)"},onMouseEnter:$=>$.target.style.color="var(--claude-text-secondary)",onMouseLeave:$=>$.target.style.color="var(--claude-text-muted)",children:""})]}),i.jsx("div",{className:"mb-4",children:i.jsx("p",{className:"claude-text-secondary",children:"Click tags to add them to your flashcard:"})}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-96 overflow-y-auto p-2",children:l.map($=>{const M=w.includes($);return i.jsxs("button",{onClick:()=>{L($)},className:`p-3 rounded-lg border text-left transition-all duration-200 ${M?"border-purple-500 bg-purple-500/20":"border-gray-600 hover:border-purple-500 hover:bg-purple-500/10"}`,children:[i.jsxs("div",{className:"font-medium",style:{color:M?"var(--claude-accent)":"var(--claude-primary-text)"},children:["#",$]}),i.jsx("div",{className:"text-sm claude-text-secondary",children:M?" Selected":"Click to add"})]},$)})}),i.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:i.jsxs("button",{onClick:()=>x(!1),className:"claude-button-primary flex-1",children:["Done (",w.length," selected)"]})})]})})]})},_5=({value:s,onChange:e,className:t="",placeholder:n="Select or type a subject"})=>{const{user:a}=Rn(),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[w,b]=P.useState(!1),E=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Statistics","Calculus","Linear Algebra","Differential Equations","Organic Chemistry","Molecular Biology","Machine Learning","Data Science","Literature","World History","European History","American History","Political Science"];P.useEffect(()=>{C()},[a]);const C=async()=>{if(!a?.uid){m(!1);return}try{m(!0);const M=await os.getUserFlashcards(a.uid,200),{collection:R,query:N,where:A,getDocs:V}=await An(async()=>{const{collection:Y,query:be,where:D,getDocs:te}=await Promise.resolve().then(()=>ra);return{collection:Y,query:be,where:D,getDocs:te}},void 0),{db:I}=await An(async()=>{const{db:Y}=await Promise.resolve().then(()=>Ba);return{db:Y}},void 0),G=N(R(I,"flashcards"),A("userId","==",a.uid)),Ve=(await V(G)).docs.map(Y=>Y.data()),ae=[...M,...Ve],z=new Set;ae.forEach(Y=>{if(Y.subject&&typeof Y.subject=="string"){const be=Y.subject.trim();be&&be!=="General"&&z.add(be)}});const oe=Array.from(z).sort();u(oe)}catch(M){console.error("Error loading existing subjects:",M),u([])}finally{m(!1)}},k=()=>{const M=new Set([...E,...l]),R=s?.toLowerCase()||"";return R?Array.from(M).filter(N=>N.toLowerCase().includes(R)).sort((N,A)=>{const V=N.toLowerCase().startsWith(R),I=A.toLowerCase().startsWith(R);return V&&!I?-1:!V&&I?1:N.localeCompare(A)}):Array.from(M).sort()},L=M=>{e(M),x(!1)},U=M=>{e(M.target.value),x(!0)},F=()=>{b(!0),x(!0)},B=()=>{b(!1),setTimeout(()=>x(!1),150)},H=k(),$=l.length>0;return i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",value:s||"",onChange:U,onFocus:F,onBlur:B,placeholder:n,className:`claude-input w-full ${t}`}),p&&(w||s)&&i.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:h?i.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading subjects..."}):i.jsxs(i.Fragment,{children:[$&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-purple-400",children:" Your Subjects"})}),l.filter(M=>!s||M.toLowerCase().includes(s.toLowerCase())).slice(0,5).map(M=>i.jsx("button",{onClick:()=>L(M),className:"w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-purple-400",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:M}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"From your cards"})]})]})},`existing-${M}`))]}),i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-blue-400",children:" Popular Subjects"})}),H.filter(M=>!l.includes(M)).slice(0,8).map(M=>i.jsx("button",{onClick:()=>L(M),className:"w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-blue-400",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:M}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Popular choice"})]})]})},`popular-${M}`)),H.length===0&&s&&i.jsxs("div",{className:"p-4 text-center",children:[i.jsx("div",{className:"claude-text-muted mb-2",children:"No matching subjects found"}),i.jsxs("button",{onClick:()=>L(s),className:"px-4 py-2 rounded text-sm",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:['Create "',s,'"']})]}),s&&!H.some(M=>M.toLowerCase()===s.toLowerCase())&&i.jsx("button",{onClick:()=>L(s),className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-green-500/10 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:['Create "',s,'"']}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"New custom subject"})]})]})})]})}),!w&&!s&&$&&i.jsxs("div",{className:"mt-3",children:[i.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Recent subjects:"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:l.slice(0,6).map(M=>i.jsx("button",{onClick:()=>L(M),className:"px-3 py-1 rounded-full text-sm font-medium transition-all duration-200",style:{backgroundColor:"#e2e8f0",color:"#4a5568"},onMouseEnter:R=>{R.target.style.backgroundColor="var(--claude-accent)",R.target.style.color="white"},onMouseLeave:R=>{R.target.style.backgroundColor="#e2e8f0",R.target.style.color="#4a5568"},children:M},M))})]})]})},N5=({value:s,onChange:e,className:t="",placeholder:n="Select a deck for this card",rememberSelection:a=!0})=>{const{user:l}=Rn(),[u,h]=P.useState([]),[m,p]=P.useState(!0),[x,w]=P.useState(!1),[b,E]=P.useState(null);P.useEffect(()=>{C(),k()},[l]);const C=async()=>{if(!l?.uid){p(!1);return}try{p(!0);const H=await is.getUserDecks(l.uid,!0);h(H)}catch(H){console.error("Error loading user decks:",H),h([])}finally{p(!1)}},k=()=>{if(!a||!l?.uid)return;const H=localStorage.getItem(`selectedDeck_${l.uid}`);if(H&&!s){const $=u.find(M=>M.id===H);$&&(E($),e(H))}};P.useEffect(()=>{if(u.length>0&&!s&&a&&l?.uid){const H=localStorage.getItem(`selectedDeck_${l.uid}`);if(H){const $=u.find(M=>M.id===H);$&&(E($),e(H))}}},[u,s,a,l?.uid,e]),P.useEffect(()=>{if(s&&u.length>0){const H=u.find($=>$.id===s);E(H||null)}else E(null)},[s,u]);const L=H=>{E(H),e(H.id),w(!1),a&&l?.uid&&localStorage.setItem(`selectedDeck_${l.uid}`,H.id)},U=()=>{E(null),e(""),a&&l?.uid&&localStorage.removeItem(`selectedDeck_${l.uid}`)},F=u.find(H=>H.isDefault),B=u.filter(H=>!H.isDefault);return i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:`relative ${t}`,onClick:()=>w(!x),children:i.jsxs("div",{className:"claude-input w-full cursor-pointer flex items-center justify-between",style:{minHeight:"44px"},children:[b?i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:b.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:b.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[b.cardCount||0," cards  ",b.subject||"General"]})]})]}):i.jsx("span",{className:"claude-text-muted",children:n}),i.jsxs("div",{className:"flex items-center gap-2",children:[b&&i.jsx("button",{onClick:H=>{H.stopPropagation(),U()},className:"transition-colors p-1",style:{color:"var(--claude-text-muted)"},onMouseEnter:H=>H.target.style.color="var(--claude-primary-text)",onMouseLeave:H=>H.target.style.color="var(--claude-text-muted)",title:"Clear selection",children:""}),i.jsx("span",{className:"text-gray-400",children:x?"":""})]})]})}),x&&i.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:m?i.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading decks..."}):u.length===0?i.jsxs("div",{className:"p-4 text-center",children:[i.jsx("div",{className:"claude-text-muted mb-3",children:"No decks found"}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Create a deck first to organize your cards"})]}):i.jsxs(i.Fragment,{children:[F&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-blue-400",children:" Default Collection"})}),i.jsx("button",{onClick:()=>L(F),className:`w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 ${b?.id===F.id?"bg-blue-500/20":""}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:F.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:F.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[F.cardCount||0," cards  All your flashcards"]})]})]})})]}),B.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:i.jsx("div",{className:"text-sm font-medium text-purple-400",children:" Your Decks"})}),B.map(H=>i.jsx("button",{onClick:()=>L(H),className:`w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0 ${b?.id===H.id?"bg-purple-500/20":""}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:H.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:H.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[H.cardCount||0," cards  ",H.subject||"General"]})]})]})},H.id))]}),i.jsx("button",{onClick:()=>{U(),w(!1)},className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-gray-500/10 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-gray-400",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"text-gray-300 font-medium",children:"No specific deck"}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Just use default collection"})]})]})})]})}),a&&b&&i.jsxs("div",{className:"mt-2 text-xs claude-text-secondary flex items-center gap-1",children:[i.jsx("span",{children:""}),i.jsx("span",{children:"This deck will be remembered for future cards"})]}),x&&i.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>w(!1)})]})},T5=({onCardCreated:s,onClose:e})=>{const{user:t}=Rn(),[n,a]=P.useState({statement:"",hints:"",proof:"",tags:"",subject:"",isPublic:!0,deckId:""}),[l,u]=P.useState(!1),[h,m]=P.useState(""),[p,x]=P.useState(!1),[w,b]=P.useState({autoFill:!1,autoTag:!1,convertLatex:!1});P.useEffect(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},[n]),P.useEffect(()=>{if(!t?.uid)return;const F=localStorage.getItem(`flashcard_draft_${t.uid}`);if(F)try{const B=JSON.parse(F);Date.now()-(B.timestamp||0)<1440*60*1e3?a($=>({...$,...B.data})):localStorage.removeItem(`flashcard_draft_${t.uid}`)}catch(B){console.warn("Failed to restore draft:",B),localStorage.removeItem(`flashcard_draft_${t.uid}`)}},[t?.uid]),P.useEffect(()=>{if(!t?.uid||!(n.statement.trim()||n.hints.trim()||n.proof.trim()))return;const B=setTimeout(()=>{const H={data:n,timestamp:Date.now()};localStorage.setItem(`flashcard_draft_${t.uid}`,JSON.stringify(H))},2e3);return()=>clearTimeout(B)},[n,t?.uid]);const E=(F,B)=>{a(H=>({...H,[F]:B})),m("")},C=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}b(F=>({...F,autoFill:!0})),m("");try{const F=await dm.autoFillFromStatement(n.statement);a(B=>({...B,hints:F.hints||B.hints,proof:F.proof||B.proof,tags:F.tags?F.tags.join(", "):B.tags})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(F){console.error("AI autofill error:",F),m(`AI autofill failed: ${F.message}`)}finally{b(F=>({...F,autoFill:!1}))}},k=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}b(F=>({...F,autoTag:!0})),m("");try{const F=await dm.autoTagOnly(n.statement);a(B=>({...B,tags:F.join(", ")}))}catch(F){console.error("AI auto-tag error:",F),m(`AI auto-tag failed: ${F.message}`)}finally{b(F=>({...F,autoTag:!1}))}},L=async F=>{const B=n[F];if(!B.trim()){m(`Please enter some ${F} content first`);return}b(H=>({...H,convertLatex:!0})),m("");try{const H=await dm.convertToLaTeX(B);a($=>({...$,[F]:H})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(H){console.error("LaTeX conversion error:",H),m(`LaTeX conversion failed: ${H.message}`)}finally{b(H=>({...H,convertLatex:!1}))}},U=async F=>{if(F.preventDefault(),!t){m("Please sign in to create flashcards");return}const B=Ks.checkRateLimit(`flashcard_create_${t.uid}`,5,3e5);if(!B.allowed){m(B.message);return}const H=Ks.validateFlashcardInput(n);if(!H.isValid){m(H.errors[0]);return}const $=Ks.detectSuspiciousContent(`${n.statement} ${n.hints} ${n.proof}`);if($.isSuspicious){m("Content contains potentially unsafe elements. Please review and try again."),console.warn("Suspicious content detected:",$.findings);return}u(!0),m("");try{const M={...H.sanitizedData,createdAt:new Date};await os.createFlashcard(M,t.uid,n.deckId||null),localStorage.removeItem(`flashcard_draft_${t.uid}`),a(R=>({statement:"",hints:"",proof:"",tags:R.tags,subject:R.subject,isPublic:R.isPublic,deckId:R.deckId})),x(!0),s&&s(),setTimeout(()=>{x(!1)},2e3)}catch(M){console.error("Error creating flashcard:",M);const R=Ks.getPublicErrorMessage(M,!0);m(R)}finally{u(!1)}};return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Create Flashcard"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Build a three-sided flashcard with statement, hints, and proof"}),p&&i.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 border border-green-200 rounded-xl text-sm shadow-md",children:[i.jsx("div",{className:"text-lg",children:""}),i.jsx("span",{className:"font-medium",children:"Flashcard created successfully! Ready to create another?"})]}),t&&!p&&(n.statement.trim()||n.hints.trim()||n.proof.trim())&&i.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm",children:[i.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),i.jsx("span",{children:"Auto-saving draft..."})]})]}),i.jsxs("form",{onSubmit:U,className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"w-10 h-10 claude-gradient rounded-xl flex items-center justify-center text-white font-bold",children:"1"}),i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Statement"}),i.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),i.jsx("textarea",{value:n.statement,onChange:F=>E("statement",F.target.value),placeholder:`Enter the problem statement, theorem, or question here...

Example: Prove that the derivative of sin(x) is cos(x)`,className:"claude-input w-full h-32 resize-none",required:!0}),n.statement.trim()&&i.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[i.jsxs("button",{type:"button",onClick:C,disabled:w.autoFill,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:w.autoFill?"var(--claude-muted)":"linear-gradient(135deg, #635BFF 0%, #7C3AED 100%)"},children:[w.autoFill?i.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx("span",{children:""}),i.jsx("span",{children:w.autoFill?"Generating...":"Autofill Hints, Proof & Tags"})]}),i.jsxs("button",{type:"button",onClick:k,disabled:w.autoTag,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:w.autoTag?"var(--claude-muted)":"linear-gradient(135deg, #10B981 0%, #059669 100%)"},children:[w.autoTag?i.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx("span",{children:""}),i.jsx("span",{children:w.autoTag?"Generating...":"Auto Tag Only"})]})]}),n.statement&&i.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[i.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),i.jsx("div",{style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.statement}})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, #9333ea 0%, #a855f7 100%)"},children:"2"}),i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Hints"}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Optional"})]}),i.jsx("textarea",{value:n.hints,onChange:F=>E("hints",F.target.value),placeholder:`Provide helpful hints or guidance...

Example: Start by using the definition of derivative as a limit. Consider the addition formula for sine.`,className:"claude-input w-full h-24 resize-none"}),n.hints.trim()&&i.jsx("div",{className:"mt-3",children:i.jsxs("button",{type:"button",onClick:()=>L("hints"),disabled:w.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:w.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[w.convertLatex?i.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx("span",{children:""}),i.jsx("span",{children:w.convertLatex?"Converting...":"Convert to LaTeX"})]})})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, var(--claude-success) 0%, #10b981 100%)"},children:"3"}),i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Proof / Answer"}),i.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),i.jsx("textarea",{value:n.proof,onChange:F=>E("proof",F.target.value),placeholder:`Provide the complete proof, solution, or detailed answer...

Example: Using the definition of derivative:
f'(x) = lim(h0) [sin(x+h) - sin(x)]/h
= lim(h0) [sin(x)cos(h) + cos(x)sin(h) - sin(x)]/h
...`,className:"claude-input w-full h-40 resize-none",required:!0}),n.proof.trim()&&i.jsx("div",{className:"mt-3",children:i.jsxs("button",{type:"button",onClick:()=>L("proof"),disabled:w.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:w.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[w.convertLatex?i.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx("span",{children:""}),i.jsx("span",{children:w.convertLatex?"Converting...":"Convert to LaTeX"})]})}),n.proof&&i.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[i.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),i.jsx("div",{className:"whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.proof}})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Card Details"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),i.jsx(_5,{value:n.subject,onChange:F=>E("subject",F),placeholder:"Select or type a subject (e.g. Calculus, Physics)"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),i.jsx(w5,{value:n.tags,onChange:F=>E("tags",F),placeholder:"Type tags here or click existing tags below"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck ",i.jsx("span",{className:"text-sm claude-text-muted",children:"(optional)"})]}),i.jsx(N5,{value:n.deckId,onChange:F=>E("deckId",F),placeholder:"Choose a deck to organize this card",rememberSelection:!0})]})]}),i.jsx("div",{className:"mt-6",children:i.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:n.isPublic,onChange:F=>E("isPublic",F.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--claude-accent)",backgroundColor:n.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),i.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this flashcard public (others can discover and study it)"})]})})]}),h&&i.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:i.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[i.jsx("span",{children:""}),i.jsx("span",{children:h})]})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&i.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{type:"submit",disabled:l||!n.statement.trim()||!n.proof.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:l||!n.statement.trim()||!n.proof.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:l?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:""}),"Create Flashcard"]})})]})]}),i.jsxs("div",{className:"mt-8 p-6 rounded-2xl",style:{backgroundColor:"rgba(68, 90, 255, 0.1)",border:"1px solid var(--claude-accent-blue)"},children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:"var(--claude-accent-blue)"},children:" LaTeX Math Support"}),i.jsxs("div",{className:"claude-text-secondary text-sm space-y-2",children:[i.jsx("p",{children:"Use LaTeX for mathematical expressions:"}),i.jsxs("div",{className:"claude-card p-3 font-mono text-xs",children:[i.jsxs("div",{children:["Inline: ",i.jsx("code",{children:"$f(x) = x^2 + 2x + 1$"})]}),i.jsxs("div",{children:["Block: ",i.jsxs("code",{children:["$$\\int_0^1 x^2 dx = \\frac",1,3,"$$"]})]})]})]})]})]})})};class Vd{static isPermissionOrIndexError(e){const t=e.message||"";return t.includes("Missing or insufficient permissions")||t.includes("requires an index")||t.includes("permission-denied")}static async startStudySession(e,t={}){try{const n={userId:e,sessionId:this.generateSessionId(),startTime:Pe(),mode:t.mode||"study",deckId:t.deckId||null,deckName:t.deckName||null,cardsStudied:0,cardsCorrect:0,cardsIncorrect:0,cardResults:[],isActive:!0},a=await Ys(Ce(ee,"studySessions"),n);if(Sn)try{sa(Sn,"study_session_start",{mode:t.mode,deck_id:t.deckId,user_id:e})}catch(l){console.warn("Firebase Analytics not available:",l)}return{id:a.id,...n}}catch(n){throw console.error("Error starting study session:",n),n}}static async endStudySession(e,t){try{const n=ve(ee,"studySessions",e),a=await vt(n);if(!a.exists())throw new Error("Session not found");const l=a.data(),u=l.startTime.toMillis(),h=Date.now(),m=Math.round((h-u)/1e3),p=l.cardsStudied>0?l.cardsCorrect/l.cardsStudied:0,x=l.cardsStudied>0?m/l.cardsStudied:0;if(await $t(n,{endTime:Pe(),duration:m,accuracy:p,averageTimePerCard:x,isActive:!1}),await this.updateUserAnalytics(t,{sessionDuration:m,cardsStudied:l.cardsStudied,accuracy:p,deckId:l.deckId}),await this.updateDailyStats(t,{studyTime:m,sessionsCount:1,cardsStudied:l.cardsStudied,accuracy:p}),Sn)try{sa(Sn,"study_session_end",{duration:m,cards_studied:l.cardsStudied,accuracy:p,user_id:t})}catch(w){console.warn("Firebase Analytics not available:",w)}return{duration:m,cardsStudied:l.cardsStudied,accuracy:p,averageTimePerCard:x}}catch(n){if(this.isPermissionOrIndexError(n))return{duration:0,cardsStudied:0,accuracy:0,averageTimePerCard:0};throw console.error("Error ending study session:",n),n}}static async recordCardAnswer(e,t){try{const n=ve(ee,"studySessions",e),a=await vt(n);if(!a.exists())throw new Error("Session not found");const l=Jo(ee),u={cardId:t.cardId,timeSpent:t.timeSpent,wasCorrect:t.wasCorrect,attempts:t.attempts||1,difficulty:t.difficulty||"medium",confidenceLevel:t.confidenceLevel||3,timestamp:Pe()};if(l.update(n,{cardsStudied:Qc(u),[`cards${t.wasCorrect?"Correct":"Incorrect"}`]:(a.data()[`cards${t.wasCorrect?"Correct":"Incorrect"}`]||0)+1}),await this.updateCardProgress(t.userId,t.cardId,{wasCorrect:t.wasCorrect,timeSpent:t.timeSpent,confidenceLevel:t.confidenceLevel}),await l.commit(),Sn)try{sa(Sn,"card_answered",{card_id:t.cardId,was_correct:t.wasCorrect,time_spent:t.timeSpent,user_id:t.userId})}catch(h){console.warn("Firebase Analytics not available:",h)}return!0}catch(n){throw console.error("Error recording card answer:",n),n}}static async updateCardProgress(e,t,n){try{const a=ve(ee,"learningProgress",e,"cards",t),l=await vt(a);let u;l.exists()?u=l.data():u={cardId:t,userId:e,totalReviews:0,correctReviews:0,accuracy:0,averageTimeToAnswer:0,fastestTime:1/0,slowestTime:0,masteryLevel:0,improvementRate:0,createdAt:Pe()},u.totalReviews+=1,n.wasCorrect&&(u.correctReviews+=1),u.accuracy=u.correctReviews/u.totalReviews;const h=n.timeSpent;u.averageTimeToAnswer=(u.averageTimeToAnswer*(u.totalReviews-1)+h)/u.totalReviews,u.fastestTime=Math.min(u.fastestTime,h),u.slowestTime=Math.max(u.slowestTime,h);const m=u.accuracy,p=1-(u.slowestTime-u.fastestTime)/u.slowestTime,x=(n.confidenceLevel||3)/5;return u.masteryLevel=m*.5+p*.3+x*.2,u.lastMasteryUpdate=Pe(),await Rs(a,u,{merge:!0}),u}catch(a){throw console.error("Error updating card progress:",a),a}}static async getCardProgress(e,t=null){try{const n=Ce(ee,"learningProgress",e,"cards");let a=n;t&&t.length>0&&(a=Le(n,Ye("cardId","in",t)));const l=await Ke(a),u={};return l.docs.forEach(h=>{const m=h.data();u[m.cardId]=m}),u}catch(n){if(this.isPermissionOrIndexError(n))return{};throw console.error("Error getting card progress:",n),n}}static async updateUserAnalytics(e,t){try{const n=ve(ee,"userAnalytics",e),a=await vt(n);let l;if(a.exists()?l=a.data():l={userId:e,totalStudyTime:0,totalSessions:0,studyStreak:0,longestStreak:0,overallAccuracy:0,improvementRate:0,subjectStats:{},deckStats:{},createdAt:Pe()},l.totalStudyTime+=t.sessionDuration,l.totalSessions+=1,l.overallAccuracy=(l.overallAccuracy*(l.totalSessions-1)+t.accuracy)/l.totalSessions,t.deckId){l.deckStats[t.deckId]||(l.deckStats[t.deckId]={studyTime:0,sessions:0,accuracy:0});const u=l.deckStats[t.deckId];u.studyTime+=t.sessionDuration,u.sessions+=1,u.accuracy=(u.accuracy*(u.sessions-1)+t.accuracy)/u.sessions}return l.lastUpdated=Pe(),await Rs(n,l,{merge:!0}),l}catch(n){throw console.error("Error updating user analytics:",n),n}}static async updateDailyStats(e,t){try{const n=new Date().toISOString().split("T")[0],a=ve(ee,"dailyStats",e,"days",n),l=await vt(a);let u;return l.exists()?u=l.data():u={date:n,userId:e,studyTime:0,sessionsCount:0,cardsStudied:0,accuracy:0,decksStudied:[],subjectsStudied:[]},u.studyTime+=t.studyTime,u.sessionsCount+=t.sessionsCount,u.cardsStudied+=t.cardsStudied,u.sessionsCount>0&&(u.accuracy=(u.accuracy*(u.sessionsCount-1)+t.accuracy)/u.sessionsCount),await Rs(a,u,{merge:!0}),u}catch(n){throw console.error("Error updating daily stats:",n),n}}static async getUserInsights(e,t="week"){try{const[n,a,l]=await Promise.all([this.getUserAnalytics(e),this.getRecentSessions(e,t),this.getCardProgress(e)]);return{accuracyTrend:this.calculateTrend(a,"accuracy"),studyTimeTrend:this.calculateTrend(a,"duration"),masteryProgress:this.calculateMasteryProgress(l),strugglingCards:this.identifyStrugglingCards(l),strongSubjects:this.identifyStrongSubjects(n.subjectStats),optimalStudyTime:this.identifyOptimalStudyTime(a),consistencyScore:this.calculateConsistencyScore(a),recommendations:this.generateRecommendations(n,l)}}catch(n){if(this.isPermissionOrIndexError(n))return{studyStreaks:{current:0,longest:0},totalStudyTime:0,averageAccuracy:0,cardsStudied:0,sessionsCompleted:0,improvementTrend:"stable",weeklyProgress:[],strongSubjects:[],weakSubjects:[]};throw console.error("Error getting user insights:",n),n}}static async getRecentSessions(e,t="week"){try{const n=t==="week"?7:t==="month"?30:1,a=new Date(Date.now()-n*24*60*60*1e3),l=Le(Ce(ee,"studySessions"),Ye("userId","==",e),Ye("startTime",">=",a),Ye("isActive","==",!1),Jt("startTime","desc"),Zt(100));return(await Ke(l)).docs.map(h=>({id:h.id,...h.data()}))}catch(n){return this.isPermissionOrIndexError(n)?[]:(console.error("Error getting recent sessions:",n),[])}}static async getUserAnalytics(e){try{const t=ve(ee,"userAnalytics",e),n=await vt(t);return n.exists()?n.data():{totalStudyTime:0,totalSessions:0,overallAccuracy:0,studyStreak:0,subjectStats:{},deckStats:{}}}catch(t){throw console.error("Error getting user analytics:",t),t}}static generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static calculateTrend(e,t){if(e.length<2)return 0;const n=e.slice(0,Math.floor(e.length/2)),a=e.slice(Math.floor(e.length/2)),l=n.reduce((h,m)=>h+(m[t]||0),0)/n.length,u=a.reduce((h,m)=>h+(m[t]||0),0)/a.length;return u>0?(l-u)/u:0}static calculateMasteryProgress(e){const t=Object.values(e);return t.length===0?0:t.reduce((n,a)=>n+(a.masteryLevel||0),0)/t.length}static identifyStrugglingCards(e){return Object.values(e).filter(t=>t.accuracy<.6&&t.totalReviews>=3).sort((t,n)=>t.accuracy-n.accuracy).slice(0,5)}static identifyStrongSubjects(e){return Object.entries(e).filter(([t,n])=>n.accuracy>.8).sort(([t,n],[a,l])=>l.accuracy-n.accuracy).slice(0,3).map(([t,n])=>t)}static identifyOptimalStudyTime(e){const t={morning:[],afternoon:[],evening:[]};e.forEach(l=>{const u=new Date(l.startTime.toMillis()).getHours();let h="afternoon";u<12?h="morning":u>18&&(h="evening"),t[h].push(l.accuracy||0)});let n="afternoon",a=0;return Object.entries(t).forEach(([l,u])=>{if(u.length>0){const h=u.reduce((m,p)=>m+p)/u.length;h>a&&(a=h,n=l)}}),n}static calculateConsistencyScore(e){if(e.length<3)return 0;const t=e.map(u=>u.duration||0),n=t.reduce((u,h)=>u+h)/t.length,a=t.reduce((u,h)=>u+Math.pow(h-n,2),0)/t.length,l=Math.sqrt(a);return Math.max(0,1-l/n)}static generateRecommendations(e,t){const n=[];e.totalStudyTime<3600&&n.push({type:"study_time",title:"Increase Study Time",description:"Try to study for at least 20 minutes per day to see better results.",priority:"high"}),e.overallAccuracy<.7&&n.push({type:"accuracy",title:"Focus on Understanding",description:"Review the hints and explanations more carefully before answering.",priority:"high"});const a=this.identifyStrugglingCards(t);return a.length>0&&n.push({type:"struggling_cards",title:"Review Difficult Cards",description:`You have ${a.length} cards that need extra attention.`,priority:"medium"}),n}}const vh=(s=[],e)=>{P.useEffect(()=>{let t=!1;const n=()=>{if(!window.MathJax?.typesetPromise)return;const a=typeof e=="string"?document.querySelector(e):e||document.body;window.MathJax.typesetClear&&window.MathJax.typesetClear([a]),window.MathJax.typesetPromise([a]).catch(l=>{t||console.error("MathJax typeset error:",l)})};if(window.MathJax&&window.MathJax.typesetPromise)n();else if(window.MathJaxReady)n();else{const a=()=>{t||(window.MathJax?.typesetPromise||window.MathJaxReady?n():requestAnimationFrame(a))},l=()=>!t&&n();return document.addEventListener("mathjax:ready",l),a(),()=>{t=!0,document.removeEventListener("mathjax:ready",l)}}return()=>{t=!0}},s)},E5=()=>{const{user:s}=Rn(),[e,t]=P.useState([]),[n,a]=P.useState(0),[l,u]=P.useState(0),[h,m]=P.useState(!0),[p,x]=P.useState(""),[w,b]=P.useState(null),[E,C]=P.useState(null),[k,L]=P.useState(!1),[U,F]=P.useState({}),B=P.useRef(null),H=P.useRef(!1),$=P.useRef(null),M=e[n],R=P.useMemo(()=>{const D=M?.statement??M?.question??"No statement available",te=Array.isArray(M?.hints)?M.hints.join(`
`):M?.hints??M?.hint??"No hint available",xe=M?.proof??M?.answer??"No proof available";return[D,te,xe]},[M?.statement,M?.question,M?.hints,M?.hint,M?.proof,M?.answer]),N=["Statement","Hint","Proof"];vh([n,l],$?.current),P.useEffect(()=>{G()},[s]),P.useEffect(()=>{s&&e.length>0&&!w&&A()},[s,e.length,w]),P.useEffect(()=>{M&&C(Date.now())},[n]),P.useEffect(()=>()=>{w&&V()},[w]);const A=async()=>{try{const D=await Vd.startStudySession(s.uid,{mode:"study",deckId:null,deckName:"All Cards"});b(D),console.log("Study session started:",D.sessionId)}catch(D){console.error("Failed to start study session:",D)}},V=async()=>{if(w)try{const D=await Vd.endStudySession(w.sessionId,s.uid);console.log("Study session ended:",D),b(null)}catch(D){console.warn("Analytics not available for session end:",D),b(null)}},I=async(D,te=3)=>{if(!w||!M||!E)return;const xe=Math.round((Date.now()-E)/1e3);try{await Vd.recordCardAnswer(w.sessionId,{cardId:M.id,userId:s.uid,timeSpent:xe,wasCorrect:D,attempts:1,difficulty:"medium",confidenceLevel:te}),F(ue=>({...ue,[M.id]:D})),setTimeout(()=>{O()},1e3)}catch(ue){console.warn("Analytics not available, but rating recorded locally:",ue),F(Ie=>({...Ie,[M.id]:D})),setTimeout(()=>{O()},1e3)}},G=P.useCallback(async()=>{try{m(!0),x("");let D=[];if(s)try{const te=await os.getUserFlashcards(s.uid,50),{collection:xe,query:ue,where:Ie,orderBy:pe,limit:Ee,getDocs:ce}=await An(async()=>{const{collection:Ge,query:lt,where:ze,orderBy:Qe,limit:gt,getDocs:ct}=await Promise.resolve().then(()=>ra);return{collection:Ge,query:lt,where:ze,orderBy:Qe,limit:gt,getDocs:ct}},void 0),{db:we}=await An(async()=>{const{db:Ge}=await Promise.resolve().then(()=>Ba);return{db:Ge}},void 0),Se=ue(xe(we,"flashcards"),Ie("userId","==",s.uid),pe("createdAt","desc"),Ee(50)),Ze=(await ce(Se)).docs.map(Ge=>({id:Ge.id,...Ge.data()}));D=[...te,...Ze].sort((Ge,lt)=>{const ze=Ge.createdAt?.toMillis?.()||Ge.createdAt?.getTime?.()||0;return(lt.createdAt?.toMillis?.()||lt.createdAt?.getTime?.()||0)-ze})}catch(te){console.warn("Failed to load user cards, falling back to public:",te)}D.length||(D=await os.getPublicFlashcards(50)),Array.isArray(D)&&D.length>0?(t(D),a(0),u(0)):(t([]),a(0),u(0))}catch(D){x("Failed to load flashcards"),console.error("Error loading flashcards:",D),t([])}finally{m(!1)}},[s]),O=P.useCallback(()=>{e.length>0&&(a(D=>Math.min(D+1,e.length-1)),u(0))},[e.length]),Ve=P.useCallback(()=>{e.length>0&&(a(D=>Math.max(D-1,0)),u(0))},[e.length]),ae=P.useCallback(()=>{u(D=>(D+1)%3)},[]),z=P.useCallback(D=>{D.key==="ArrowRight"?O():D.key==="ArrowLeft"?Ve():(D.key===" "||D.code==="Space")&&(D.preventDefault(),ae())},[O,Ve,ae]),oe=D=>{B.current=D.touches[0].clientX,H.current=!1},Y=D=>{H.current=!0},be=D=>{if(!B.current)return;const te=B.current-D.changedTouches[0].clientX;if(B.current=null,Math.abs(te)>50)return te>0?O():Ve();H.current||ae()};return P.useEffect(()=>(window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)),[z]),h?i.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:i.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[i.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-6"}),i.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:" Loading Flashcards..."}),i.jsx("p",{className:"text-slate-300",children:"Please wait while we load your study materials."})]})}):p?i.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:i.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-3xl p-12 text-center max-w-lg",children:[i.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-4",children:" Error Loading Flashcards"}),i.jsx("p",{className:"text-red-300 mb-6",children:p}),i.jsx("button",{onClick:G,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-xl transition-all duration-200",children:"Try Again"})]})}):e.length===0?i.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:i.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[i.jsx("div",{className:"text-6xl mb-6",children:""}),i.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"No Flashcards Available"}),i.jsx("p",{className:"text-slate-300",children:"Create your first flashcard to start studying!"})]})}):M?i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},role:"main",children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-8",children:[i.jsx("h2",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:" Study Mode"}),i.jsx("div",{className:"claude-card px-4 py-2",children:i.jsxs("span",{className:"claude-text-secondary font-medium",children:[n+1," of ",e.length]})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"flex justify-center mb-6",children:i.jsx("div",{className:"flex claude-card p-2",children:N.map((D,te)=>i.jsx("button",{onClick:()=>u(te),className:`px-6 py-2 rounded-xl font-medium transition-colors duration-200 ${l===te?"bg-[var(--claude-accent)] text-white":"text-[var(--claude-secondary-text)] hover:bg-[var(--claude-surface-hover)] hover:text-[var(--claude-primary-text)]"}`,"aria-pressed":l===te,"aria-label":`Show ${D} (${te+1} of ${N.length})`,children:D},te))})}),i.jsxs("div",{onClick:ae,onTouchStart:oe,onTouchMove:Y,onTouchEnd:be,onKeyDown:D=>{(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),ae())},className:"claude-card p-12 min-h-[400px] flex flex-col justify-center items-center cursor-pointer transition-all duration-300 group hover:-translate-y-0.5 hover:border-[var(--claude-accent)] focus:outline-none focus:ring-2 focus:ring-[var(--claude-accent)] focus:ring-opacity-50",style:{borderRadius:"24px"},tabIndex:0,role:"button","aria-label":`Show ${N[l]} content. Press Space or Enter to continue.`,children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-sm font-medium mb-4 uppercase tracking-wider",style:{color:"var(--claude-accent)"},children:N[l]}),i.jsx("div",{ref:$,className:"text-xl leading-relaxed transition-colors whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},children:R[l]})]}),i.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 claude-text-muted text-sm",children:l<2?"Tap to see next side":"Tap to restart"})]}),i.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[M.subject&&i.jsx("span",{className:"claude-tag",children:M.subject}),M.slug?i.jsxs("a",{href:`/card/${M.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-primary inline-flex items-center gap-2 text-sm",children:[i.jsx("span",{children:""}),"View Public Card"]}):i.jsxs("div",{className:"claude-button-secondary inline-flex items-center gap-2 text-sm opacity-50 cursor-not-allowed",children:[i.jsx("span",{children:""}),"Private Card"]})]}),l===2&&w&&i.jsxs("div",{className:"mt-6 claude-card p-4 bg-blue-50 border-blue-200",children:[i.jsxs("div",{className:"text-center mb-4",children:[i.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"How well did you know this?"}),i.jsx("p",{className:"text-sm text-blue-600",children:"This helps track your learning progress"})]}),i.jsxs("div",{className:"flex justify-center gap-2",children:[i.jsx("button",{onClick:()=>I(!1,1),className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg transition-colors text-sm font-medium",children:" Struggled"}),i.jsx("button",{onClick:()=>I(!1,2),className:"px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 rounded-lg transition-colors text-sm font-medium",children:" Unsure"}),i.jsx("button",{onClick:()=>I(!0,4),className:"px-4 py-2 bg-green-100 hover:bg-green-200 text-green-800 rounded-lg transition-colors text-sm font-medium",children:" Good"}),i.jsx("button",{onClick:()=>I(!0,5),className:"px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition-colors text-sm font-medium",children:" Perfect"})]}),U[M.id]!==void 0&&i.jsx("div",{className:"mt-3 text-center",children:i.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${U[M.id]?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:U[M.id]?" Recorded as correct":" Recorded as incorrect"})})]})]}),i.jsxs("div",{className:"flex justify-between items-center mt-8",children:[i.jsx("button",{onClick:Ve,disabled:n===0,className:"claude-button-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:" Previous"}),i.jsx("div",{className:"claude-text-muted text-sm",children:"Use arrow keys or swipe to navigate  Space to flip sides"}),i.jsx("button",{onClick:O,disabled:n===e.length-1,className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:n===e.length-1?"var(--claude-muted)":"var(--claude-accent)"},children:"Next "})]}),i.jsx("span",{className:"sr-only","aria-live":"polite",children:N[l]})]})}):i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[i.jsx("div",{className:"text-6xl mb-6",children:""}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Card Not Found"}),i.jsx("p",{className:"claude-text-secondary",children:"Unable to load the requested flashcard."}),i.jsx("button",{onClick:G,className:"claude-button-primary mt-6",children:"Reload Cards"})]})})},S5=()=>{const{user:s}=Rn(),[e,t]=P.useState(""),[n,a]=P.useState(""),[l,u]=P.useState(!0),[h,m]=P.useState([]),[p,x]=P.useState("recent"),[w,b]=P.useState(""),[E,C]=P.useState(new Set),[k,L]=P.useState(1),[U,F]=P.useState(new Set),[B,H]=P.useState(new Set),[$,M]=P.useState(new Set),[R,N]=P.useState(new Set),[A,V]=P.useState(""),I=12;P.useEffect(()=>{const ce=setTimeout(()=>a(e),200);return()=>clearTimeout(ce)},[e]);const G=P.useCallback(ce=>ce?.toMillis?ce.toMillis():ce||0,[]),O=P.useCallback(ce=>{if(!ce)return"Unknown date";const we=ce.toDate?ce.toDate():new Date(ce);return Number.isNaN(we.getTime())?"Unknown date":we.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},[]),Ve=P.useCallback(async()=>{const ce=await An(()=>Promise.resolve().then(()=>ra),void 0),{db:we}=await An(async()=>{const{db:Se}=await Promise.resolve().then(()=>Ba);return{db:Se}},void 0);return{db:we,firestore:ce}},[]),ae=P.useMemo(()=>{const ce=n.trim().toLowerCase(),we=h.filter(Se=>{const Fe=Array.isArray(Se.hints)?Se.hints.join(" "):typeof Se.hints=="string"?Se.hints:"",Ze=!ce||(Se.statement||"").toLowerCase().includes(ce)||Fe.toLowerCase().includes(ce)||(Se.proof||"").toLowerCase().includes(ce)||(Se.authorSlug||"").toLowerCase().includes(ce)||(Se.tags||[]).some(lt=>(lt||"").toLowerCase().includes(ce)),Ge=!w||(Se.tags||[]).includes(w);return Ze&&Ge});switch(p){case"upvotes":we.sort((Se,Fe)=>(Fe.likeCount||0)-(Se.likeCount||0));break;case"oldest":we.sort((Se,Fe)=>G(Se.createdAt)-G(Fe.createdAt));break;case"alphabetical":we.sort((Se,Fe)=>(Se.statement||"").localeCompare(Fe.statement||""));break;default:we.sort((Se,Fe)=>G(Fe.createdAt)-G(Se.createdAt))}return we},[h,n,p,w]);vh([ae,k]),P.useEffect(()=>{oe(),s&&z()},[s]);const z=async()=>{if(s)try{const{collection:ce,query:we,where:Se,getDocs:Fe}=await An(async()=>{const{collection:gt,query:ct,where:It,getDocs:Gn}=await Promise.resolve().then(()=>ra);return{collection:gt,query:ct,where:It,getDocs:Gn}},void 0),{db:Ze}=await An(async()=>{const{db:gt}=await Promise.resolve().then(()=>Ba);return{db:gt}},void 0),Ge=await Fe(we(ce(Ze,"userUpvotes"),Se("userId","==",s.uid))),lt=new Set(Ge.docs.map(gt=>gt.data().cardId));F(lt);const ze=await Fe(we(ce(Ze,"flashcards"),Se("userId","==",s.uid))),Qe=new Set;ze.docs.forEach(gt=>{Qe.add(gt.data().statement)}),H(Qe)}catch(ce){console.error("Error loading user data:",ce)}},oe=P.useCallback(async()=>{try{u(!0);const{db:ce,firestore:we}=await Ve(),{collection:Se,orderBy:Fe,query:Ze,getDocs:Ge}=we;console.log(" Loading public cards...");const lt=Ze(Se(ce,"publicCards"),Fe("createdAt","desc")),ze=await Ge(lt),Qe=new Set,gt=ze.docs.map(ct=>{const It=ct.data();return(It.tags||[]).forEach(Gn=>Qe.add(Gn)),{id:ct.id,...It}});console.log(" Loaded public cards:",gt.length,gt.slice(0,3)),m(gt),C(Qe)}catch(ce){console.error(" Error loading public cards:",ce),m([]),C(new Set)}finally{u(!1)}},[Ve]);P.useEffect(()=>{L(1)},[n,p,w]);const Y=P.useCallback(async ce=>{if(s&&!$.has(ce)){M(we=>new Set(we).add(ce));try{const{runTransaction:we,doc:Se,serverTimestamp:Fe}=await An(async()=>{const{runTransaction:ze,doc:Qe,serverTimestamp:gt}=await Promise.resolve().then(()=>ra);return{runTransaction:ze,doc:Qe,serverTimestamp:gt}},void 0),{db:Ze}=await An(async()=>{const{db:ze}=await Promise.resolve().then(()=>Ba);return{db:ze}},void 0),Ge=Se(Ze,"userUpvotes",`${s.uid}_${ce}`),lt=Se(Ze,"publicCards",ce);await we(Ze,async ze=>{const Qe=await ze.get(Ge),ct=(await ze.get(lt)).data()?.likeCount||0;Qe.exists()?(ze.delete(Ge),ze.update(lt,{likeCount:Math.max(0,ct-1)})):(ze.set(Ge,{userId:s.uid,cardId:ce,createdAt:Fe()}),ze.update(lt,{likeCount:ct+1}))}),F(ze=>{const Qe=new Set(ze);return Qe.has(ce)?Qe.delete(ce):Qe.add(ce),Qe}),m(ze=>ze.map(Qe=>Qe.id===ce?{...Qe,likeCount:Math.max(0,(Qe.likeCount||0)+(U.has(ce)?-1:1))}:Qe))}catch(we){console.error("Error upvoting card:",we),V("Error upvoting card. Please try again."),setTimeout(()=>V(""),5e3)}finally{M(we=>{const Se=new Set(we);return Se.delete(ce),Se})}}},[s,U,$,m]),be=P.useCallback(async ce=>{if(!s||R.has(ce))return;const we=h.find(Se=>Se.id===ce);if(we){if(B.has(we.statement)){V("Card already imported"),setTimeout(()=>V(""),3e3);return}N(Se=>new Set(Se).add(ce));try{const{collection:Se,addDoc:Fe,doc:Ze,updateDoc:Ge,increment:lt}=await An(async()=>{const{collection:It,addDoc:Gn,doc:an,updateDoc:$n,increment:wr}=await Promise.resolve().then(()=>ra);return{collection:It,addDoc:Gn,doc:an,updateDoc:$n,increment:wr}},void 0),{serverTimestamp:ze}=await An(async()=>{const{serverTimestamp:It}=await Promise.resolve().then(()=>ra);return{serverTimestamp:It}},void 0),{db:Qe}=await An(async()=>{const{db:It}=await Promise.resolve().then(()=>Ba);return{db:It}},void 0);await Fe(Se(Qe,"flashcards"),{userId:s.uid,statement:we.statement,hints:we.hints,proof:we.proof||"",tags:we.tags||[],createdAt:ze(),updatedAt:ze(),importedFrom:ce}),await Ge(Ze(Qe,"publicCards",ce),{importCount:lt(1)});const gt=new Set(B);gt.add(we.statement),H(gt);const ct=h.map(It=>It.id===ce?{...It,importCount:(It.importCount||0)+1}:It);m(ct),V("Card imported successfully!"),setTimeout(()=>V(""),3e3)}catch(Se){console.error("Error importing card:",Se),V("Error importing card. Please try again."),setTimeout(()=>V(""),5e3)}finally{N(Se=>{const Fe=new Set(Se);return Fe.delete(ce),Fe})}}},[s,h,B,Ve,R]),D=ce=>{if(!ce)return"";const we=document.createElement("div");return we.textContent=ce,we.innerHTML},te=ce=>{const we=s&&U.has(ce.id),Se=s&&B.has(ce.statement),Fe=$.has(ce.id),Ze=R.has(ce.id),Ge=O(ce.createdAt),lt=ce.authorSlug?ce.authorSlug.charAt(0).toUpperCase():"U";return i.jsxs("div",{className:"claude-card p-6 hover:shadow-lg transition-all duration-200",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm",style:{backgroundColor:"var(--claude-accent)"},children:lt}),i.jsxs("div",{children:[ce.authorSlug?i.jsx("a",{href:`/profile/${ce.authorSlug}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium hover:underline",style:{color:"var(--claude-accent)"},children:ce.authorSlug}):i.jsx("span",{className:"font-medium claude-text-secondary",children:"Anonymous User"}),i.jsx("div",{className:"claude-text-muted text-sm",children:Ge})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Statement"}),i.jsx("div",{className:"text-sm leading-relaxed",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:D(ce.statement)}})]}),ce.hints&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-1 claude-text-secondary text-sm",children:"Hints"}),i.jsx("div",{className:"text-sm claude-text-secondary",dangerouslySetInnerHTML:{__html:D(ce.hints)}})]}),ce.proof&&i.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",borderLeft:"4px solid var(--claude-accent)"},children:[i.jsx("div",{className:"text-xs font-semibold claude-text-secondary mb-1 uppercase tracking-wider",children:"Proof Preview"}),i.jsx("div",{className:"text-sm",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:D(ce.proof.substring(0,150)+(ce.proof.length>150?"...":""))}})]}),i.jsxs("div",{className:"flex gap-4 mb-4 text-sm claude-text-muted",children:[i.jsxs("span",{children:[" ",Math.max(0,ce.viewCount||0)," views"]}),i.jsxs("span",{children:[" ",Math.max(0,ce.importCount||0)," imports"]})]}),ce.tags&&ce.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ce.tags.map(ze=>i.jsx("span",{className:"claude-tag cursor-pointer hover:opacity-80",onClick:()=>b(ze),children:ze},ze))}),i.jsxs("div",{className:"flex gap-3 items-center",children:[i.jsxs("button",{onClick:()=>Y(ce.id),disabled:!s||Fe,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${we?"text-white":"claude-button-secondary"} ${!s||Fe?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:we?"var(--claude-accent)":void 0,border:we?"none":void 0},title:s?`${we?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards","aria-label":s?`${we?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards",children:[Fe?"":""," ",Math.max(0,ce.likeCount||0)]}),i.jsx("button",{onClick:()=>be(ce.id),disabled:!s||Se||Ze,className:`claude-button-primary text-sm ${!s||Se||Ze?"opacity-50 cursor-not-allowed":""}`,title:s?Se?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards","aria-label":s?Se?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards",children:Ze?" Importing...":Se?" Imported":" Import"}),i.jsx("a",{href:`/card/${ce.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary text-sm",children:" View"})]})]},ce.id)},xe=Math.ceil(ae.length/I),ue=(k-1)*I,Ie=ue+I,pe=ae.slice(ue,Ie),Ee=P.useCallback(ce=>{ce<1||ce>xe||(L(ce),window.scrollTo({top:0,behavior:"smooth"}))},[xe]);return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Search Flashcards"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Discover and import flashcards from the community"})]}),A&&i.jsx("div",{className:`mb-6 p-4 rounded-lg border ${A.includes("successfully")?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{children:A}),i.jsx("button",{onClick:()=>V(""),className:"ml-2 text-lg font-bold opacity-60 hover:opacity-100",children:""})]})}),!s&&i.jsxs("div",{className:"text-center p-4 mb-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--claude-accent) 0%, var(--claude-accent-blue) 100%)",color:"white"},children:[i.jsx("p",{className:"mb-3",children:"Unlock the full experience!"}),i.jsx("a",{href:"/index.html",className:"inline-block px-6 py-2 rounded-lg font-semibold transition-all hover:scale-105",style:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",textDecoration:"none"},onMouseEnter:ce=>ce.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:ce=>ce.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Sign in"}),i.jsx("span",{children:" to upvote and import flashcards to your account."})]}),i.jsx("div",{className:"claude-card p-6 mb-8",children:i.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[i.jsxs("div",{className:"relative flex-1 w-full",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:i.jsx("span",{className:"claude-text-muted",children:""})}),i.jsx("input",{type:"text",value:e,onChange:ce=>t(ce.target.value),placeholder:"Search flashcards, tags, or authors...",className:"claude-input w-full pl-10"}),e&&i.jsx("button",{onClick:()=>t(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center claude-text-muted hover:opacity-70",children:""})]}),i.jsxs("div",{className:"flex gap-3 items-center",children:[i.jsxs("select",{value:p,onChange:ce=>x(ce.target.value),className:"claude-input",children:[i.jsx("option",{value:"recent",children:"Most Recent"}),i.jsx("option",{value:"upvotes",children:"Most Upvoted"}),i.jsx("option",{value:"oldest",children:"Oldest First"}),i.jsx("option",{value:"alphabetical",children:"Alphabetical"})]}),i.jsxs("select",{value:w,onChange:ce=>b(ce.target.value),className:"claude-input",children:[i.jsx("option",{value:"",children:"All Tags"}),Array.from(E).sort().map(ce=>i.jsx("option",{value:ce,children:ce},ce))]})]})]})}),ae.length>0&&i.jsx("div",{className:"claude-card p-4 mb-6",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{className:"claude-text-secondary",children:[i.jsx("span",{className:"font-semibold",children:ae.length})," flashcards found"]}),i.jsxs("div",{className:"claude-text-muted text-sm",children:["Showing ",ue+1,"-",Math.min(Ie,ae.length)," of ",ae.length]})]})}),l&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"w-10 h-10 border-4 border-t-4 rounded-full animate-spin mx-auto mb-4",style:{borderColor:"var(--claude-border)",borderTopColor:"var(--claude-accent)"}}),i.jsx("div",{className:"claude-text-secondary",children:"Loading flashcards..."})]}),!l&&ae.length===0&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-6xl mb-4 opacity-50",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No flashcards found"}),i.jsx("p",{className:"claude-text-muted",children:"Try adjusting your search terms or filters"})]}),!l&&pe.length>0&&i.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:pe.map(te)}),xe>1&&i.jsxs("div",{className:"flex justify-center items-center gap-2",children:[i.jsx("button",{onClick:()=>Ee(k-1),disabled:k===1,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:" Previous"}),Array.from({length:Math.min(5,xe)},(ce,we)=>{const Se=we+1;return i.jsx("button",{onClick:()=>Ee(Se),className:`px-4 py-2 rounded-lg font-medium transition-all ${Se===k?"text-white":"claude-button-secondary"}`,style:{backgroundColor:Se===k?"var(--claude-accent)":void 0},children:Se},Se)}),i.jsx("button",{onClick:()=>Ee(k+1),disabled:k===xe,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Next "})]})]})})},YT=new Map,A5=300*1e3,j5=()=>{const{user:s}=Rn(),[e,t]=P.useState([]),[n,a]=P.useState({totalUsers:0,totalCards:0,totalViews:0}),[l,u]=P.useState(!0),[h,m]=P.useState("creators"),[p,x]=P.useState(!1);P.useEffect(()=>{w(),b()},[h]);const w=async(k=!1)=>{try{u(!0);let L="upvotes";h==="creators"?L="flashcards":h==="streak"&&(L="streak");const U=`leaderboard_${L}`;if(!k){const H=YT.get(U);if(H&&Date.now()-H.timestamp<A5){console.log(" Using cached leaderboard data for:",L),t(H.data),x(!0),u(!1);return}}console.log(" Loading leaderboard using backend API for:",L);const F=await fetch(`https://us-central1-three-sided-flashcard-app.cloudfunctions.net/getLeaderboard?sort=${encodeURIComponent(L)}`);if(!F.ok)throw new Error(`HTTP error! status: ${F.status}`);const B=await F.json();if(console.log(" Leaderboard data loaded:",B),!B.leaderboard||!Array.isArray(B.leaderboard))throw new Error("Invalid leaderboard data format");YT.set(U,{data:B.leaderboard,timestamp:Date.now()}),t(B.leaderboard),x(!1),console.log(" Leaderboard loaded:",B.leaderboard.length,"entries")}catch(L){console.error(" Error loading leaderboard:",L),t([])}finally{u(!1)}},b=async()=>{try{const k=Le(Ce(ee,"profiles")),L=await Ke(k),U=Le(Ce(ee,"publicCards")),F=await Ke(U);let B=0;F.docs.forEach(H=>{const $=H.data();B+=$.viewCount||0}),a({totalUsers:L.size,totalCards:F.size,totalViews:B})}catch(k){console.error("Error loading community stats:",k)}},E=k=>k?k.split(" ").map(L=>L.charAt(0)).join("").toUpperCase().slice(0,2):"?",C=k=>{switch(k){case 0:return"";case 1:return"";case 2:return"";default:return`#${k+1}`}};return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Community Leaderboard"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Celebrating our top contributors and creators"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:n.totalUsers.toLocaleString()}),i.jsx("div",{className:"claude-text-secondary",children:"Community Members"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:n.totalCards.toLocaleString()}),i.jsx("div",{className:"claude-text-secondary",children:"Total Flashcards"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:n.totalViews.toLocaleString()}),i.jsx("div",{className:"claude-text-secondary",children:"Total Views"})]})]}),i.jsx("div",{className:"claude-card p-2 mb-8",children:i.jsx("div",{className:"flex",children:[{id:"popular",label:"Most Upvoted",icon:""},{id:"creators",label:"Top Creators",icon:""},{id:"streak",label:"Login Streak",icon:""}].map(k=>i.jsxs("button",{onClick:()=>m(k.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200",style:{backgroundColor:h===k.id?"var(--claude-accent)":"transparent",color:h===k.id?"white":"var(--claude-secondary-text)"},onMouseEnter:L=>{h!==k.id&&(L.target.style.backgroundColor="var(--claude-surface-hover)",L.target.style.color="var(--claude-primary-text)")},onMouseLeave:L=>{h!==k.id&&(L.target.style.backgroundColor="transparent",L.target.style.color="var(--claude-secondary-text)")},children:[i.jsx("span",{children:k.icon}),k.label]},k.id))})}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:h==="creators"?" Top Creators":h==="popular"?" Most Upvoted":" Login Streak Champions"}),i.jsxs("div",{className:"flex items-center gap-3",children:[p&&i.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:" Cached"}),i.jsx("button",{onClick:()=>w(!0),className:"claude-button-primary",title:"Force refresh from server (bypasses cache)",children:"Refresh"})]})]}),l?i.jsx("div",{className:"space-y-4",children:Array.from({length:10}).map((k,L)=>i.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl animate-pulse",style:{backgroundColor:"var(--claude-subtle)"},children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),i.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]},L))}):e.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),i.jsx("p",{className:"claude-text-muted",children:"Be the first to create some flashcards!"})]}):i.jsx("div",{className:"space-y-3",children:e.map((k,L)=>i.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:scale-105",style:{backgroundColor:L<3?"rgba(255, 215, 0, 0.1)":"var(--claude-subtle)",border:`1px solid ${L<3?"rgba(255, 215, 0, 0.3)":"var(--claude-border)"}`},children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg",style:{background:L<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:L<3?"white":"var(--claude-background)"},children:C(L)}),i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:E(k.displayName)}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:k.displayName||"Anonymous"}),k.slug&&i.jsxs("a",{href:`/profile/${k.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",k.slug]})]}),i.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?`${k.flashcardCount||0} flashcards created`:h==="popular"?`${k.upvotesReceived||0} upvotes received`:`${k.loginStreak||0} day login streak`})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:L<3?"#B8860B":"var(--claude-accent-blue)"},children:h==="creators"?k.flashcardCount||0:h==="popular"?k.upvotesReceived||0:k.loginStreak||0}),i.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?"cards":h==="popular"?"upvotes":"day streak"})]})]},k.slug||k.id))})]}),s&&i.jsxs("div",{className:"mt-8 bg-slate-800/30 border border-slate-700 rounded-2xl p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Your Position"}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:E(s.displayName)}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-white",children:s.displayName}),i.jsx("div",{className:"text-slate-400 text-sm",children:"That's you!"})]})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-xl font-bold text-blue-400",children:["#",e.findIndex(k=>k.id===s.uid)+1||"Unranked"]}),i.jsx("div",{className:"text-slate-400 text-sm",children:"Position"})]})]})]})]})})},I5=({onClose:s,refreshCallback:e})=>{const{user:t}=Rn(),[n,a]=P.useState([]),[l,u]=P.useState(!0),[h,m]=P.useState(""),[p,x]=P.useState(null),[w,b]=P.useState(null),[E,C]=P.useState({statement:"",hints:"",proof:"",subject:"",tags:""});P.useEffect(()=>{t&&k()},[t]);const k=async()=>{try{u(!0);const N=await os.getPublicFlashcardsByUser(t.uid);a(N),m("")}catch(N){console.error("Error loading public cards:",N),m("Failed to load your public flashcards")}finally{u(!1)}},L=N=>{x(N),C({statement:N.statement||"",hints:Array.isArray(N.hints)?N.hints.join(`
`):N.hints||"",proof:N.proof||"",subject:N.subject||"",tags:Array.isArray(N.tags)?N.tags.join(", "):""})},U=async()=>{if(p)try{const N=Ks.checkRateLimit(`edit_public_${t.uid}`,10,3e5);if(!N.allowed){m(N.message);return}const A=Ks.validateFlashcardInput(E);if(!A.isValid){m(A.errors[0]);return}await os.updatePublicFlashcard(p.id,A.sanitizedData,t.uid),x(null),m(""),await k(),e&&e()}catch(N){console.error("Error updating public card:",N);const A=Ks.getPublicErrorMessage(N,!0);m(A)}},F=async N=>{try{const A=Ks.checkRateLimit(`delete_public_${t.uid}`,5,3e5);if(!A.allowed){m(A.message);return}await os.deletePublicFlashcard(N,t.uid),b(null),m(""),await k(),e&&e()}catch(A){console.error("Error deleting public card:",A);const V=Ks.getPublicErrorMessage(A,!0);m(V)}},B=async N=>{try{const A=Ks.checkRateLimit(`toggle_public_${t.uid}`,10,3e5);if(!A.allowed){m(A.message);return}await os.toggleFlashcardPublic(N,t.uid,!1),m(""),await k(),e&&e()}catch(A){console.error("Error making card private:",A);const V=Ks.getPublicErrorMessage(A,!0);m(V)}},H=(N,A)=>{C(V=>({...V,[N]:A}))},$=N=>N?(N.toDate?N.toDate():new Date(N)).toLocaleDateString():"Unknown",M=N=>`${window.location.origin}/card/${N.slug}`,R=N=>{const A=M(N);navigator.clipboard.writeText(A).then(()=>{alert("Card URL copied to clipboard!")})};return l?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsx("div",{className:"claude-card p-8 rounded-2xl shadow-2xl max-w-md",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading your public flashcards..."})]})})}):i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[i.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:" Manage Public Flashcards"}),i.jsx("button",{onClick:s,className:"claude-text-muted hover:text-gray-700 text-3xl transition-colors","aria-label":"Close manager",children:""})]}),h&&i.jsx("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-700 text-sm",children:h})}),i.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:n.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No Public Flashcards Yet"}),i.jsx("p",{className:"claude-text-secondary mb-4",children:"Create flashcards and make them public to share your knowledge with the world!"}),i.jsx("button",{onClick:s,className:"claude-button-primary",children:"Create Your First Public Card"})]}):i.jsx("div",{className:"space-y-4",children:n.map(N=>i.jsxs("div",{className:"claude-card p-6 rounded-xl border-l-4 border-l-blue-500",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-lg mb-2",style:{color:"var(--claude-heading)"},children:N.statement?.length>100?`${N.statement.slice(0,100)}...`:N.statement}),i.jsxs("div",{className:"flex gap-4 text-sm claude-text-secondary",children:[i.jsxs("span",{children:["Created: ",$(N.createdAt)]}),i.jsxs("span",{children:[" ",N.likeCount||0," likes"]}),i.jsxs("span",{children:[" ",N.viewCount||0," views"]}),i.jsxs("span",{children:[" ",N.importCount||0," imports"]})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>R(N),className:"claude-button-secondary text-sm px-3 py-1",title:"Copy public URL",children:" Copy Link"}),i.jsx("button",{onClick:()=>L(N),className:"claude-button-secondary text-sm px-3 py-1",children:" Edit"}),i.jsx("button",{onClick:()=>B(N.id),className:"claude-button-secondary text-sm px-3 py-1 text-orange-600",title:"Make private (remove from public)",children:" Make Private"}),i.jsx("button",{onClick:()=>b(N.id),className:"claude-button-secondary text-sm px-3 py-1 text-red-600",children:" Delete"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Subject & Tags:"}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx("span",{className:"claude-tag",children:N.subject||"General"}),N.tags?.map((A,V)=>i.jsx("span",{className:"claude-tag",children:A},V))]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Public URL:"}),i.jsx("a",{href:M(N),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 text-xs break-all",children:M(N)})]})]})]},N.id))})}),p&&i.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Edit Public Flashcard"}),i.jsx("button",{onClick:()=>x(null),className:"claude-text-muted hover:text-gray-700 text-2xl",children:""})]}),i.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-140px)]",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Statement *"}),i.jsx("textarea",{value:E.statement,onChange:N=>H("statement",N.target.value),className:"claude-input w-full h-24 resize-none",placeholder:"Enter the main statement or question...",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Hints"}),i.jsx("textarea",{value:E.hints,onChange:N=>H("hints",N.target.value),className:"claude-input w-full h-20 resize-none",placeholder:"Helpful hints (optional)..."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Proof/Answer *"}),i.jsx("textarea",{value:E.proof,onChange:N=>H("proof",N.target.value),className:"claude-input w-full h-32 resize-none",placeholder:"Enter the proof, solution, or answer...",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Subject"}),i.jsx("input",{type:"text",value:E.subject,onChange:N=>H("subject",N.target.value),className:"claude-input w-full",placeholder:"Mathematics, Physics, etc."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Tags"}),i.jsx("input",{type:"text",value:E.tags,onChange:N=>H("tags",N.target.value),className:"claude-input w-full",placeholder:"algebra, calculus, geometry (comma-separated)"})]})]})]})}),i.jsxs("div",{className:"px-6 py-4 border-t border-gray-300 flex justify-end gap-3",children:[i.jsx("button",{onClick:()=>x(null),className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{onClick:U,className:"claude-button-primary",disabled:!E.statement.trim()||!E.proof.trim(),children:"Save Changes"})]})]})}),w&&i.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:i.jsx("div",{className:"claude-card rounded-2xl shadow-2xl max-w-md w-full mx-4",children:i.jsxs("div",{className:"p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-bold mb-2 text-red-600",children:"Delete Public Flashcard?"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:"This will permanently delete this flashcard from the public collection. This action cannot be undone."}),i.jsxs("div",{className:"flex gap-3 justify-center",children:[i.jsx("button",{onClick:()=>b(null),className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{onClick:()=>F(w),className:"claude-button-secondary bg-red-100 text-red-800 hover:bg-red-200 border-red-300",children:"Delete Forever"})]})]})})})]})})},dn=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 19H21"}),i.jsx("rect",{x:"5",y:"13",width:"4",height:"6",rx:"2",ry:"2"}),i.jsx("rect",{x:"10",y:"9",width:"4",height:"10",rx:"2",ry:"2"}),i.jsx("rect",{x:"15",y:"5",width:"4",height:"14",rx:"2",ry:"2"})]})})},Ec=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"8",r:"3"}),i.jsx("path",{d:"M4 19c0-3.314 3.134-6 8-6s8 2.686 8 6"})]})})},qa=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"5",y:"5",width:"12",height:"14",rx:"2",ry:"2"}),i.jsx("rect",{x:"7",y:"3",width:"12",height:"14",rx:"2",ry:"2"}),i.jsx("rect",{x:"3",y:"7",width:"12",height:"14",rx:"2",ry:"2"})]})})},Fi=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"}),i.jsx("path",{d:"M14.06 6.19l3.75 3.75 1.41-1.41c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.41 1.41z"})]})})},C1=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M8 6h8"}),i.jsx("path",{d:"M5 8h14"}),i.jsx("rect",{x:"6",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),i.jsx("path",{d:"M10 12v6"}),i.jsx("path",{d:"M14 12v6"})]})})},xc=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"}),i.jsx("circle",{cx:"12",cy:"12",r:"2"})]})})},R1=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"3",r:"1"}),i.jsx("path",{d:"M12 4v2"}),i.jsx("rect",{x:"5",y:"6",width:"14",height:"12",rx:"3",ry:"3"}),i.jsx("circle",{cx:"9",cy:"12",r:"1.25"}),i.jsx("circle",{cx:"15",cy:"12",r:"1.25"}),i.jsx("path",{d:"M9 15h6"})]})})},hm=({size:s=20,color:e="success",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"success-dark":return"#4A9B7F";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#5BC8A2"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M8 12l3 3 5-6"})]})})},C5=({size:s=20,color:e="error",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"error-dark":return"#E55555";case"default":return"#606164";default:return"#FF6363"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M9 9l6 6M15 9l-6 6"})]})})},R5=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"warning-dark":return"#FFB800";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3l-8.47-14.14a2 2 0 0 0-3.42 0z"}),i.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),i.jsx("circle",{cx:"12",cy:"16",r:"1"})]})})},k5=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"warning-dark":return"#FFB800";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M9 18h6M10 21h4"}),i.jsx("path",{d:"M12 2a7 7 0 0 0-4 12c.67.67 1 1.33 1 2h6c0-.67.33-1.33 1-2a7 7 0 0 0-4-12z"})]})})},D5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"}),i.jsx("line",{x1:"8",y1:"13",x2:"16",y2:"13"}),i.jsx("line",{x1:"8",y1:"17",x2:"16",y2:"17"})]})})},P5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M10 4a3 3 0 0 0-6 2v3a3 3 0 0 0 0 6v3a3 3 0 0 0 6 2"}),i.jsx("path",{d:"M14 4a3 3 0 0 1 6 2v3a3 3 0 0 1 0 6v3a3 3 0 0 1-6 2"}),i.jsx("path",{d:"M12 2v20"})]})})},fm=({size:s=24,color:e="success",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#5BC8A2"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("circle",{cx:"12",cy:"12",r:"5"}),i.jsx("circle",{cx:"12",cy:"12",r:"1.5"})]})})},M5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M12 7v5"}),i.jsx("path",{d:"M12 12l3 3"})]})})},vc=({size:s=20,color:e="success",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#5BC8A2"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 3v18h18"}),i.jsx("path",{d:"M19 9l-5 5-4-4-4 5"})]})})},O5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M21 12a9 9 0 1 1-2.64-6.36L21 8"}),i.jsx("path",{d:"M21 3v5h-5"})]})})},V5=({size:s=20,color:e="secondary",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#445AFF"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M20 12l-8-8H4v8l8 8 8-8z"}),i.jsx("circle",{cx:"7.5",cy:"7.5",r:"1.5"})]})})},k1=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 21h18L3 3v18z"}),i.jsx("path",{d:"M7 17h7L7 10v7z"})]})})},L5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"7",y:"3",width:"10",height:"18",rx:"2.5",ry:"2.5"}),i.jsx("line",{x1:"10",y1:"6",x2:"14",y2:"6"})]})})},F5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"4",y:"5",width:"16",height:"10",rx:"2",ry:"2"}),i.jsx("path",{d:"M2 17h20"}),i.jsx("path",{d:"M10 19h4"})]})})},U5=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"6",y:"5",width:"4",height:"14",rx:"1"}),i.jsx("rect",{x:"14",y:"5",width:"4",height:"14",rx:"1"})]})})},D1=({size:s=16,color:e="error",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#FF6363"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:i.jsx("path",{d:"M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-7.6 1-1a5.5 5.5 0 0 0 0-7.8z"})})})},B5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M4 12a8 8 0 0 1 16 0"}),i.jsx("rect",{x:"3",y:"12",width:"3",height:"6",rx:"1.5"}),i.jsx("rect",{x:"18",y:"12",width:"3",height:"6",rx:"1.5"})]})})},q5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M5 3h11l5 5v13H5V3z"}),i.jsx("rect",{x:"7",y:"3",width:"7",height:"5"}),i.jsx("rect",{x:"9",y:"13",width:"6",height:"6"})]})})},z5=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 6l6-2 6 2 6-2v14l-6 2-6-2-6 2V6z"}),i.jsx("path",{d:"M9 4v14M15 6v14"}),i.jsx("path",{d:"M16.5 10.5a2.5 2.5 0 1 0 5 0c0-1.38-1.12-2.5-2.5-2.5s-2.5 1.12-2.5 2.5z"}),i.jsx("path",{d:"M19 13.5v0"})]})})},H5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:i.jsx("path",{d:"M6 4l6 14 2-6 6-2L6 4z"})})})},Gm=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M12 3l3 4H9l3-4z"}),i.jsx("rect",{x:"9",y:"7",width:"6",height:"8",rx:"2",ry:"2"}),i.jsx("circle",{cx:"12",cy:"10",r:"1.3"}),i.jsx("path",{d:"M9 12l-2.5 2H9M15 12l2.5 2H15"})]})})},G5=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"warning-dark":return"#FFB800";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:i.jsx("path",{d:"M13 2L5 13h6l-2 9 10-13h-6l2-7z"})})})},Ld=({size:s=20,color:e="warning",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":return"#606164";default:return"#FFD554"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M8 4h8v3a4 4 0 0 1-4 4 4 4 0 0 1-4-4V4z"}),i.jsx("path",{d:"M8 5H5a2 2 0 0 0 2 3"}),i.jsx("path",{d:"M16 5h3a2 2 0 0 1-2 3"}),i.jsx("path",{d:"M12 11v4"}),i.jsx("rect",{x:"9",y:"15",width:"6",height:"2",rx:"1"}),i.jsx("rect",{x:"8",y:"17",width:"8",height:"2",rx:"1"})]})})},$5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M12 4a8 8 0 1 0 8 8c0-1.7-1.3-3-3-3h-1a2 2 0 0 1-2-2V7c0-1.7-1.3-3-3-3z"}),i.jsx("circle",{cx:"10",cy:"14",r:"1.5"})]})})},Ii=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"11",cy:"11",r:"6"}),i.jsx("line",{x1:"16",y1:"16",x2:"20",y2:"20"})]})})},K5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"2"}),i.jsx("rect",{x:"8",y:"5",width:"8",height:"4",rx:"1"}),i.jsx("circle",{cx:"9",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"15",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"9",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"15",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"9",cy:"18",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"18",r:"0.8"}),i.jsx("circle",{cx:"15",cy:"18",r:"0.8"})]})})},Q5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("rect",{x:"5",y:"19",width:"14",height:"2",rx:"1"}),i.jsx("line",{x1:"8",y1:"19",x2:"8",y2:"13"}),i.jsx("line",{x1:"8",y1:"13",x2:"14",y2:"7"}),i.jsx("rect",{x:"13",y:"5",width:"4",height:"2",rx:"1"}),i.jsx("line",{x1:"9",y1:"15",x2:"13",y2:"15"})]})})},Y5=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 9l9-4 9 4-9 4-9-4z"}),i.jsx("path",{d:"M12 13v3"}),i.jsx("path",{d:"M7 12v2c0 1.66 3 3 5 3s5-1.34 5-3v-2"}),i.jsx("path",{d:"M21 9v4"}),i.jsx("circle",{cx:"21",cy:"14",r:"0.8"})]})})},P1=({size:s=20,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("path",{d:"M3 5h7a3 3 0 0 1 3 3v11a3 3 0 0 0-3-3H3z"}),i.jsx("path",{d:"M21 5h-7a3 3 0 0 0-3 3v11a3 3 0 0 1 3-3h7z"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"19"})]})})},X5=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("line",{x1:"4",y1:"20",x2:"20",y2:"20"}),i.jsx("line",{x1:"4",y1:"20",x2:"4",y2:"4"}),i.jsx("path",{d:"M4 16l4-4 4 3 5-5 3 2"}),i.jsx("circle",{cx:"4",cy:"16",r:"0.8"}),i.jsx("circle",{cx:"8",cy:"12",r:"0.8"}),i.jsx("circle",{cx:"12",cy:"15",r:"0.8"}),i.jsx("circle",{cx:"17",cy:"10",r:"0.8"}),i.jsx("circle",{cx:"20",cy:"12",r:"0.8"})]})})},M1=({size:s=24,color:e="default",className:t="",...n})=>{const a=()=>{switch(e){case"primary":return"#635BFF";case"secondary":return"#445AFF";case"success":return"#5BC8A2";case"warning":return"#FFD554";case"error":return"#FF6363";case"default":default:return"#606164"}};return i.jsx("div",{className:`inline-flex items-center justify-center ${t}`,style:{width:s,height:s},...n,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:a(),strokeWidth:s===16?1:s===20?1.5:2,strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[i.jsx("circle",{cx:"9",cy:"8",r:"3"}),i.jsx("path",{d:"M4 20v-1a5 5 0 0 1 10 0v1"}),i.jsx("circle",{cx:"17",cy:"10",r:"3"}),i.jsx("path",{d:"M12 20v-1a5 5 0 0 1 10 0v1"})]})})},hc=(...s)=>!1,Bx=s=>{if(!s)return null;if(typeof s?.toDate=="function")return s.toDate();const e=new Date(s);return Number.isNaN(e.getTime())?null:e},W5=(s,e=0)=>({id:s.id??`card-${e}`,subject:s.subject??"General",question:s.question??s.statement??"",answer:s.answer??s.proof??"",createdAt:Bx(s.createdAt)??new Date(0),...s}),XT=(s,e)=>typeof s=="string"?s.length>e?s.slice(0,e)+"":s:"",J5=()=>{const{user:s}=Rn(),[e,t]=P.useState(null),[n,a]=P.useState([]),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[w,b]=P.useState("overview"),[E,C]=P.useState(null),[k,L]=P.useState(!1),[U,F]=P.useState(!1),[B,H]=P.useState(null),[$,M]=P.useState([]),[R,N]=P.useState(!1);P.useEffect(()=>{if(!s?.uid){t(null),a([]),u([]),m(!1);return}A()},[s?.uid]);const A=P.useCallback(async()=>{let Y=!0;m(!0),b(be=>be);try{const be=s.uid;hc(" Loading user data for:",be);const D=[um.getUserProfile(be),(async()=>{try{const we=await os.getUserFlashcards(be,100),{collection:Se,query:Fe,where:Ze,orderBy:Ge,limit:lt,getDocs:ze}=await An(async()=>{const{collection:an,query:$n,where:wr,orderBy:Ds,limit:Ps,getDocs:Ms}=await Promise.resolve().then(()=>ra);return{collection:an,query:$n,where:wr,orderBy:Ds,limit:Ps,getDocs:Ms}},void 0),{db:Qe}=await An(async()=>{const{db:an}=await Promise.resolve().then(()=>Ba);return{db:an}},void 0),gt=Fe(Se(Qe,"flashcards"),Ze("userId","==",be),Ge("createdAt","desc"),lt(100)),It=(await ze(gt)).docs.map(an=>({id:an.id,...an.data()}));return[...we,...It].sort((an,$n)=>{const wr=an.createdAt?.toMillis?.()||an.createdAt?.getTime?.()||0;return($n.createdAt?.toMillis?.()||$n.createdAt?.getTime?.()||0)-wr})}catch(we){return hc("Failed to load user cards:",we),[]}})(),(async()=>{try{const{collection:we,query:Se,where:Fe,getDocs:Ze}=await An(async()=>{const{collection:Qe,query:gt,where:ct,getDocs:It}=await Promise.resolve().then(()=>ra);return{collection:Qe,query:gt,where:ct,getDocs:It}},void 0),{db:Ge}=await An(async()=>{const{db:Qe}=await Promise.resolve().then(()=>Ba);return{db:Qe}},void 0),lt=Se(we(Ge,"cards"),Fe("userId","==",be),Fe("originalCardId","!=",null));return(await Ze(lt)).docs.map(Qe=>({id:Qe.id,...Qe.data()}))}catch(we){return hc("Failed to load imported cards:",we),[]}})()],[te,xe,ue]=await Promise.allSettled(D);if(!Y)return;const Ie=te.status==="fulfilled"?te.value:null,Ee=(xe.status==="fulfilled"?xe.value??[]:[]).map(W5),ce=ue.status==="fulfilled"?ue.value??[]:[];hc(" User profile:",Ie),hc(" Private cards found:",Ee.length),hc(" Imported cards found:",ce.length),t(Ie),a(Ee),u(ce)}catch(be){console.error(" Error loading user data:",be)}finally{Y&&m(!1)}return()=>{Y=!1}},[s?.uid]),V=async Y=>{if(!confirm("Delete this card? This cannot be undone."))return;const be=n;a(D=>D.filter(te=>te.id!==Y));try{await os.deleteFlashcard(Y)}catch(D){console.error("Error deleting card:",D),a(be)}},I=P.useCallback(async()=>{try{if(!s?.uid)return;const Y=await is.getUserDecks(s.uid,!0);M(Y)}catch(Y){console.error("Error loading user decks:",Y)}},[s?.uid]);P.useEffect(()=>{I()},[I]);const G=Y=>{H(Y),N(!0)},O=async Y=>{if(B)try{await is.addCardToDeck(Y,B.id),await os.updateCardDeck(B.id,Y),N(!1),H(null),await A()}catch(be){console.error("Error moving card to deck:",be),alert("Failed to move card. Please try again.")}},Ve=async()=>{x(!0),await A(),x(!1)},ae=P.useCallback(Y=>{C(Y),L(!0)},[]),z=P.useCallback(()=>{L(!1),C(null)},[]);vh([E]);const oe=P.useMemo(()=>!n||n.length===0?0:new Set(n.map(be=>be.subject??"General")).size,[n]);return h?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[i.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-t-transparent rounded-full mx-auto mb-6",style:{borderColor:"var(--claude-accent)",borderTopColor:"transparent"}}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Loading Dashboard..."}),i.jsx("p",{className:"claude-text-secondary",children:"Fetching your data"})]})}):i.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:[i.jsx(dn,{size:32,color:"primary"}),"Your Dashboard"]}),i.jsxs("p",{className:"claude-text-secondary text-lg",children:["Welcome back, ",s?.displayName||"Student","!"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"claude-card p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:i.jsx(qa,{size:24,color:"primary"})}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Total"})]}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:n.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards Created"})]}),i.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:i.jsx(vc,{size:24,color:"success"})}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Imported"})]}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:l.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported"})]}),i.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"p-3 bg-green-500/20 rounded-xl",children:i.jsx(Ld,{size:24,color:"warning"})}),i.jsx("span",{className:"claude-text-muted text-sm",children:"Streak"})]}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:e?.loginStreak||0}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]}),i.jsx("div",{role:"tablist","aria-label":"Dashboard sections",className:"flex claude-card rounded-2xl p-2 mb-8",children:[{id:"overview",label:"Overview",icon:"dashboard"},{id:"profile",label:"My Profile",icon:"user"},{id:"cards",label:"My Cards",icon:"cards"},{id:"public",label:"Public Cards",icon:"view"},{id:"imported",label:"Imported Cards",icon:"progress"}].map((Y,be)=>{const D=[{id:"overview",label:"Overview",icon:"dashboard"},{id:"profile",label:"My Profile",icon:"user"},{id:"cards",label:"My Cards",icon:"cards"},{id:"public",label:"Public Cards",icon:"view"},{id:"imported",label:"Imported Cards",icon:"progress"}],te=w===Y.id;return i.jsxs("button",{role:"tab","aria-selected":te,"aria-controls":`${Y.id}-panel`,id:`${Y.id}-tab`,tabIndex:te?0:-1,onKeyDown:xe=>{xe.key==="ArrowRight"&&b(D[(be+1)%D.length].id),xe.key==="ArrowLeft"&&b(D[(be-1+D.length)%D.length].id)},onClick:()=>b(Y.id),className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 ${te?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"claude-text-secondary hover:text-gray-700 hover:bg-gray-100"}`,children:[Y.icon==="dashboard"?i.jsx(dn,{size:20,color:te?"primary":"default"}):Y.icon==="user"?i.jsx(Ec,{size:20,color:te?"primary":"default"}):Y.icon==="cards"?i.jsx(qa,{size:20,color:te?"primary":"default"}):Y.icon==="view"?i.jsx(xc,{size:20,color:te?"primary":"default"}):Y.icon==="progress"?i.jsx(vc,{size:20,color:te?"primary":"default"}):i.jsx("span",{children:Y.icon}),Y.label]},Y.id)})}),w==="overview"&&i.jsxs("div",{role:"tabpanel",id:"overview-panel","aria-labelledby":"overview-tab",className:"space-y-8",children:[i.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(vc,{size:24,color:"success"}),"Recent Activity"]}),i.jsxs("div",{className:"space-y-4",children:[n.slice(0,5).map(Y=>i.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/30 rounded-xl",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:[Y.question?.slice(0,60),"..."]}),i.jsxs("p",{className:"claude-text-muted text-sm",children:["Created ",new Date(Y.createdAt?.toDate?.()||Y.createdAt).toLocaleDateString()]})]}),i.jsx("span",{className:"text-blue-400 text-sm",children:Y.subject||"General"})]},Y.id)),n.length===0&&i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-4xl mb-4",children:i.jsx(Fi,{size:48,color:"default"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards yet"}),i.jsx("p",{className:"claude-text-muted",children:"Create your first flashcard to get started!"})]})]})]}),i.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(dn,{size:24,color:"default"}),"Quick Stats"]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:n.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Total Cards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:l.length}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported Cards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:oe}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Subjects"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:e?.loginStreak||0}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]})]})]}),w==="profile"&&i.jsxs("div",{role:"tabpanel",id:"profile-panel","aria-labelledby":"profile-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Ec,{size:24,color:"default"}),"My Profile"]}),e?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Display Name"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsx("span",{className:"claude-text-primary",children:e.displayName||"Not set"})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Profile URL"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsxs("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 transition-colors",children:["three-sided.com/profile/",e.slug]})})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Bio"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsx("span",{className:"claude-text-primary",children:e.bio||"No bio added yet"})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Institution"}),i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsx("span",{className:"claude-text-primary",children:e.institution||"Not specified"})})]}),i.jsxs("div",{className:"flex gap-4 pt-4",children:[i.jsxs("button",{onClick:()=>{console.log("Edit profile")},className:"claude-button-primary",style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:[i.jsx(Fi,{size:16,color:"default"}),"Edit Profile"]}),i.jsxs("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary",children:[i.jsx(xc,{size:16,color:"default"}),"View Public Profile"]})]})]}):i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"mb-4",children:i.jsx(Ec,{size:48,color:"default"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No profile yet"}),i.jsx("p",{className:"claude-text-muted mb-6",children:"Create a profile to share your flashcards publicly and connect with other students."}),i.jsxs("button",{onClick:()=>{console.log("Create profile")},className:"claude-button-primary",style:{background:"linear-gradient(135deg, #B8A082 0%, #A68B5B 100%)"},children:[i.jsx(Gm,{size:16,color:"default"}),"Create My Profile"]})]})]}),w==="cards"&&i.jsxs("div",{role:"tabpanel",id:"cards-panel","aria-labelledby":"cards-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(qa,{size:24,color:"primary"}),"My Cards (",n.length,")"]}),i.jsx("button",{onClick:Ve,disabled:p,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-60 rounded-lg transition-all duration-200",style:{color:"white"},children:p?"Refreshing":"Refresh"})]}),n.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(Fi,{size:64,color:"default"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards found"}),i.jsx("p",{className:"claude-text-muted mb-6",children:"It looks like you haven't created any flashcards yet, or there might be a connection issue."}),i.jsxs("div",{className:"space-x-4",children:[i.jsx("a",{href:"#",onClick:Y=>{Y.preventDefault(),window.location.href="/#create"},className:"inline-block px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-xl transition-all duration-200",style:{color:"white"},children:"Create a Flashcard"}),i.jsx("button",{onClick:Ve,disabled:p,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:opacity-60 font-semibold rounded-xl transition-all duration-200",style:{color:"white"},children:p?"Refreshing":"Try Loading Again"})]})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(Y=>i.jsxs("div",{className:"group claude-card border hover:border-blue-500/50 rounded-2xl p-6 transition-all duration-300",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsx("span",{className:"text-sm text-blue-400 font-medium",children:Y.subject||"General"}),i.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-200",children:[i.jsx("button",{onClick:()=>G(Y),className:"text-purple-400 hover:text-purple-300 text-sm px-2 py-1 rounded bg-purple-500/10 hover:bg-purple-500/20",title:"Move to deck",children:""}),i.jsx("button",{onClick:()=>V(Y.id),className:"text-red-400 hover:text-red-300",title:"Delete card",children:i.jsx(C1,{size:16,color:"error"})})]})]}),i.jsx("h3",{className:"font-semibold mb-3 group-hover:text-blue-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:XT(Y.question,80)}),i.jsx("p",{className:"claude-text-secondary text-sm mb-4 leading-relaxed",children:XT(Y.answer,100)}),i.jsxs("div",{className:"flex justify-between items-center text-sm",children:[i.jsx("span",{className:"claude-text-muted",children:Bx(Y.createdAt)?.toLocaleDateString()??""}),i.jsx("div",{className:"flex gap-2",children:Y.slug?i.jsx("a",{href:`/card/${Y.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"View Public "}):i.jsxs("button",{onClick:()=>ae(Y),className:"text-blue-400 hover:text-blue-300 font-medium transition-colors cursor-pointer",children:[i.jsx(xc,{size:16,color:"primary"}),"Inspect"]})})]})]},Y.id))})]}),w==="public"&&i.jsxs("div",{role:"tabpanel",id:"public-panel","aria-labelledby":"public-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(xc,{size:24,color:"primary"}),"Your Public Cards"]}),i.jsx("button",{onClick:()=>F(!0),className:"claude-button-primary",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:" Manage Public Cards"})]}),i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(xc,{size:64,color:"primary"})}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Public Flashcard Management"}),i.jsx("p",{className:"claude-text-muted mb-6",children:"View, edit, and manage all your public flashcards in one place. Control what the world sees and track engagement."}),i.jsx("button",{onClick:()=>F(!0),className:"claude-button-primary",style:{background:"linear-gradient(135deg, #7E6B5A 0%, #6D5A4A 100%)"},children:"Open Public Card Manager"})]})]}),w==="imported"&&i.jsxs("div",{role:"tabpanel",id:"imported-panel","aria-labelledby":"imported-tab",className:"claude-card rounded-3xl p-8",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3",style:{color:"var(--claude-heading)"},children:[i.jsx(vc,{size:24,color:"success"}),"Imported Cards (",l.length,")"]}),l.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(qa,{size:64,color:"primary"})}),i.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No imported cards yet"}),i.jsx("p",{className:"claude-text-muted",children:"Import useful cards from the public library!"})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(Y=>i.jsxs("div",{className:"group claude-card border hover:border-purple-500/50 rounded-2xl p-6 transition-all duration-300",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsx("span",{className:"text-sm text-purple-400 font-medium",children:Y.subject||"General"}),i.jsx(vc,{size:16,color:"success"})]}),i.jsx("h3",{className:"font-semibold mb-3 group-hover:text-purple-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:Y.question?.length>80?Y.question.slice(0,80)+"...":Y.question}),i.jsx("p",{className:"claude-text-secondary text-sm leading-relaxed",children:Y.answer?.length>100?Y.answer.slice(0,100)+"...":Y.answer})]},Y.id))})]})]}),k&&E&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[i.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Card Inspector"}),i.jsx("button",{onClick:z,className:"claude-text-muted hover:text-gray-700 text-2xl transition-colors","aria-label":"Close inspector",children:""})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:[i.jsxs("div",{className:"flex gap-4 mb-6",children:[i.jsx("span",{className:"claude-tag",children:E.subject||"General"}),i.jsxs("span",{className:"claude-text-muted text-sm",children:["Created: ",Bx(E.createdAt)?.toLocaleDateString()??"Unknown"]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-purple-400 mb-3",children:"Statement"}),i.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:E.statement||E.question||"No statement available"})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-3",children:"Hints"}),i.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:Array.isArray(E.hints)?E.hints.join(`
`):E.hints||E.hint||"No hints available"})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-green-400 mb-3",children:"Proof"}),i.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:E.proof||E.answer||"No proof available"})]}),E.tags&&E.tags.length>0&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-orange-400 mb-3",children:"Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:E.tags.map((Y,be)=>i.jsx("span",{className:"claude-tag",children:Y},be))})]}),i.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-300",children:[i.jsx("button",{onClick:()=>{console.log("Edit card:",E.id)},className:"claude-button-secondary",children:" Edit Card"}),i.jsx("button",{onClick:async()=>{await V(E.id),z()},className:"claude-button-danger",children:" Delete Card"}),i.jsx("button",{onClick:z,className:"claude-button-primary ml-auto",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:" Close"})]})]})]})}),U&&i.jsx(I5,{onClose:()=>F(!1),refreshCallback:A}),R&&B&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"claude-card max-w-md w-full mx-4 p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Move Card to Deck"}),i.jsx("button",{onClick:()=>N(!1),className:"transition-colors",style:{color:"var(--claude-text-muted)"},onMouseEnter:Y=>Y.target.style.color="var(--claude-primary-text)",onMouseLeave:Y=>Y.target.style.color="var(--claude-text-muted)",children:""})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"claude-text-secondary mb-2",children:"Moving card:"}),i.jsx("p",{className:"font-medium truncate",style:{color:"var(--claude-primary-text)"},children:B.statement||B.question||"Untitled Card"})]}),i.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[$.map(Y=>i.jsx("button",{onClick:()=>O(Y.id),className:"w-full text-left p-3 rounded-lg border border-gray-600 hover:border-purple-500 hover:bg-purple-500/10 transition-all duration-200",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:Y.icon||""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:Y.name}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[Y.cardCount||0," cards  ",Y.subject||"General"]})]})]})},Y.id)),$.length===0&&i.jsxs("div",{className:"text-center py-8",children:[i.jsx("p",{className:"claude-text-secondary",children:"No decks available"}),i.jsx("p",{className:"text-sm claude-text-muted mt-2",children:"Create a deck first to organize your cards"})]})]}),i.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:i.jsx("button",{onClick:()=>N(!1),className:"claude-button-secondary flex-1",children:"Cancel"})})]})})]})},fc=s=>s.trim().toLowerCase().replace(/[\s_]+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,40),Z5=(s,e=200)=>{const[t,n]=P.useState(s);return P.useEffect(()=>{const a=setTimeout(()=>n(s),e);return()=>clearTimeout(a)},[s,e]),t},eO=({selectedTags:s=[],onTagsChange:e,onClose:t,isVisible:n=!1,maxSelected:a})=>{const[l,u]=P.useState([]),[h,m]=P.useState(""),[p,x]=P.useState(!0),[w,b]=P.useState(""),[E,C]=P.useState(""),k=P.useRef(null),L=Z5(E,150);P.useEffect(()=>{if(!n)return;const N=document.body.style.overflow;document.body.style.overflow="hidden",setTimeout(()=>k.current?.focus(),0);const A=V=>{V.key==="Escape"&&t?.()};return window.addEventListener("keydown",A),()=>{document.body.style.overflow=N,window.removeEventListener("keydown",A)}},[n,t]),P.useEffect(()=>{if(!n)return;let N=!0;return(async()=>{x(!0),b("");try{const A=await os.getPopularTags(100);if(!N)return;const V=Array.from(new Set((A||[]).map(I=>fc(String(I||""))).filter(Boolean))).sort((I,G)=>I.localeCompare(G));u(V.length?V:U())}catch(A){if(console.error("Error loading tags:",A),!N)return;u(U()),b("Could not load popular tags. Showing common tags.")}finally{N&&x(!1)}})(),()=>{N=!1}},[n]);const U=()=>["calculus","algebra","geometry","trigonometry","statistics","physics","chemistry","biology","computer-science","mathematics","linear-algebra","differential-equations","real-analysis","abstract-algebra","topology","number-theory","combinatorics","probability","optimization"],F=P.useMemo(()=>Array.from(new Set(s.map(N=>fc(N)).filter(Boolean))),[s]),B=N=>typeof a=="number"?N<=a:!0,H=P.useCallback(N=>{const A=fc(N),I=F.includes(A)?F.filter(G=>G!==A):[...F,A];B(I.length)&&e?.(I)},[F,e,a]),$=P.useCallback(()=>{const N=fc(h);if(N){if(!l.includes(N)){const A=[...l,N].sort((V,I)=>V.localeCompare(I));u(A)}if(!F.includes(N)){const A=[...F,N];B(A.length)&&e?.(A)}m("")}},[h,l,F,e,a]),M=P.useCallback(N=>{const A=fc(N),V=F.filter(I=>I!==A);e?.(V)},[F,e]),R=P.useMemo(()=>{const N=L.trim().toLowerCase();return N?l.filter(A=>A.includes(N)):l},[l,L]);return n?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:i.jsxs("div",{ref:k,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"tags-title",className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden outline-none",children:[i.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"tags-title",className:"text-2xl font-bold",children:" Tag Management"}),i.jsx("button",{onClick:t,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Organize your flashcards with tags"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:[w&&i.jsx("div",{className:"mb-4 p-3 rounded-lg border border-yellow-200 bg-yellow-50 text-yellow-900",children:w}),F.length>0&&i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Selected Tags"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:F.map(N=>i.jsxs("span",{className:"inline-flex items-center gap-2 bg-primary-100 text-primary-800 px-3 py-2 rounded-full text-sm font-medium",children:["#",N,i.jsx("button",{onClick:()=>M(N),className:"text-primary-600 hover:text-primary-800 transition-colors","aria-label":`Remove tag ${N}`,children:""})]},N))})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Add Custom Tag"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"text",value:h,onChange:N=>m(N.target.value),placeholder:"Enter new tag (e.g., linear-algebra)",className:"input flex-1",onKeyDown:N=>N.key==="Enter"&&$(),"aria-label":"New tag"}),i.jsx("button",{onClick:$,className:"btn btn-primary whitespace-nowrap",disabled:!fc(h),children:"Add Tag"})]}),!!a&&i.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[F.length,"/",a," selected"]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Browse Tags"}),i.jsx("input",{type:"text",value:E,onChange:N=>C(N.target.value),placeholder:"Search tags",className:"input","aria-label":"Search tags"})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:["Available Tags (",R.length,")"]}),p?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-neutral-600",children:"Loading tags"})]}):R.length===0?i.jsxs("div",{className:"text-center py-8 text-neutral-600",children:['No tags found matching "',L,'"']}):i.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-4",children:R.map(N=>{const A=F.includes(N),V=!A&&a&&F.length>=a;return i.jsxs("button",{onClick:()=>H(N),disabled:V,className:`p-3 rounded-lg text-sm font-medium transition-all duration-200 text-left
                        ${A?"bg-primary-100 text-primary-800 border-2 border-primary-300":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200 border-2 border-transparent"}
                        ${V?"opacity-50 cursor-not-allowed":""}`,"aria-pressed":A,"aria-label":`Tag ${N}`,title:V?"Maximum selected":`#${N}`,children:["#",N]},N)})})]})]}),i.jsx("div",{className:"bg-neutral-50 px-6 py-4 border-t border-neutral-200",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-sm text-neutral-600",children:[F.length," tag",F.length!==1?"s":""," selected",a?`  max ${a}`:""]}),i.jsx("button",{onClick:t,className:"btn btn-primary",children:"Done"})]})})]})}):null},tO=1.3;function nO(s,e,t){const n={repetition:s.repetition??0,interval:s.interval??0,easeFactor:s.easeFactor??2.5};let{repetition:a,interval:l,easeFactor:u}=n;if(e<3)a=0,l=1;else{a===0?l=1:a===1?l=6:l=Math.round(l*u),a+=1;const p=.1-(5-e)*(.08+(5-e)*.02);u=Math.max(tO,parseFloat((u+p).toFixed(2)))}const h=new Date(t+l*24*60*60*1e3);return{next:{...s,repetition:a,interval:l,easeFactor:u,reviewCount:(s.reviewCount??0)+1,lastReviewed:new Date(t),nextReview:h}}}const sO=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState([]),[a,l]=P.useState(0),[u,h]=P.useState(!1),[m,p]=P.useState(!0),[x,w]=P.useState({total:0,due:0,new:0,learning:0,reviewing:0}),b=P.useRef(!0);P.useEffect(()=>(b.current=!0,e&&E(),()=>{b.current=!1}),[e]),P.useEffect(()=>{if(!e)return;const H=$=>{if($.key==="Escape")return s?.();if(t.length){if(!u&&($.key===" "||$.key==="Enter")){$.preventDefault(),h(!0);return}u&&"12345".includes($.key)&&($.preventDefault(),k(parseInt($.key,10))),$.key.toLowerCase()==="r"&&L()}};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[e,t.length,u]),P.useEffect(()=>{if(!e)return;const H=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=H}},[e]);const E=async()=>{try{p(!0);const H=await os.getPublicFlashcards(50);if(!b.current)return;const $=Date.now(),R=H.map((N,A)=>({...N,id:N.id||`card-${A}`,repetition:N.repetition??0,interval:N.interval??0,easeFactor:N.easeFactor??2.5,reviewCount:N.reviewCount??0,nextReview:N.nextReview?new Date(N.nextReview):new Date($),difficulty:N.difficulty??3,lastReviewed:N.lastReviewed?new Date(N.lastReviewed):null,question:N.statement??N.question??"",answer:N.proof??N.answer??"",hints:Array.isArray(N.hints)?N.hints:N.hints?[N.hints]:[]})).sort((N,A)=>N.nextReview-A.nextReview);if(!b.current)return;n(R),C(R)}catch(H){console.error("Error loading cards:",H),b.current&&n([])}finally{b.current&&p(!1)}},C=H=>{const $=Date.now(),M=H.length,R=H.filter(V=>(V.nextReview?.getTime?.()??V.nextReview)<=$).length,N=V=>V.reviewCount??0,A={total:M,due:R,new:H.filter(V=>N(V)===0).length,learning:H.filter(V=>N(V)>0&&N(V)<5).length,reviewing:H.filter(V=>N(V)>=5).length};w(A)},k=H=>{const $=Date.now();n(M=>{if(!M.length)return M;const R=M[a];if(!R)return M;const{next:N}=nO(R,H,$),A=[...M];A[a]=N;const V=[...A].sort((I,G)=>I.nextReview-G.nextReview);return C(V),V}),l(M=>Math.min(M+1,t.length-1)),h(!1)},L=()=>{l(0),h(!1)},U=()=>t[a]||null,F=U();vh([F,u]);const B=()=>[{value:1,label:"Again",color:"bg-danger-500 hover:bg-danger-600"},{value:2,label:"Hard",color:"bg-warning-500 hover:bg-warning-600"},{value:3,label:"Good",color:"bg-success-500 hover:bg-success-600"},{value:4,label:"Easy",color:"bg-primary-500 hover:bg-primary-600"},{value:5,label:"Perfect",color:"bg-accent-500 hover:bg-accent-600"}];return e?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:i.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"sr-title",className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",tabIndex:-1,children:[i.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"sr-title",className:"text-2xl font-bold",children:" Spaced Repetition"}),i.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close spaced repetition",title:"Close (Esc)",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Intelligent study scheduling for optimal learning"})]}),i.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:m?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-neutral-600 text-lg",children:"Loading your study session..."})]}):t.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"No cards available"}),i.jsx("p",{className:"text-neutral-600",children:"Create some flashcards to start studying!"})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-primary-600",children:x.total}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Total"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-danger-600",children:x.due}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Due"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-accent-600",children:x.new}),i.jsx("div",{className:"text-sm text-neutral-600",children:"New"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-warning-600",children:x.learning}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Learning"})]}),i.jsxs("div",{className:"card p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-success-600",children:x.reviewing}),i.jsx("div",{className:"text-sm text-neutral-600",children:"Reviewing"})]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:["Card ",a+1," of ",t.length]}),i.jsxs("span",{className:"text-sm text-neutral-500",children:[Math.round((a+1)/t.length*100),"% complete"]})]}),i.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:i.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-secondary-500 h-2 rounded-full transition-all duration-300",style:{width:`${(a+1)/t.length*100}%`}})})]}),i.jsx("div",{className:"card p-8 mb-8",children:i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"flex justify-center gap-4 mb-6 text-sm text-neutral-600",children:[i.jsxs("span",{children:["Interval: ",U()?.interval||0," days"]}),i.jsxs("span",{children:["Reviews: ",U()?.reviewCount||0]}),i.jsxs("span",{children:["Ease: ",U()?.easeFactor?.toFixed(1)||"2.5"]})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Question"}),i.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:U()?.question||"Loading..."})]}),u&&i.jsxs("div",{className:"mb-8 animate-fade-in",children:[i.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Answer"}),i.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:U()?.answer||"No answer available"}),U()?.hints&&U().hints.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("h4",{className:"text-lg font-medium text-neutral-700 mb-2",children:"Hints"}),i.jsx("div",{className:"space-y-2",children:U().hints.map((H,$)=>i.jsxs("div",{className:"bg-accent-50 p-3 rounded-lg text-neutral-700",children:[" ",H]},$))})]})]}),u?i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-lg font-semibold text-neutral-800",children:"How well did you know this?"}),i.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:B().map(({value:H,label:$,color:M})=>i.jsxs("button",{onClick:()=>k(H),className:`btn text-white px-6 py-3 ${M}`,title:`${$} (${H})`,"aria-label":`Rate as ${$} (Press ${H})`,children:[H,". ",$]},H))})]}):i.jsx("button",{onClick:()=>h(!0),className:"btn btn-primary text-lg px-8 py-4",title:"Show Answer (Space or Enter)",children:"Show Answer"})]})}),i.jsxs("div",{className:"text-center mt-6 p-4 bg-gray-50 rounded-lg",children:[i.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:" Keyboard Shortcuts"}),i.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-2 gap-2",children:[i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Space"})," Show Answer"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"1-5"})," Rate Quality"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"R"})," Reset Session"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Esc"})," Close"]})]})]}),i.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[i.jsx("button",{onClick:L,className:"btn btn-secondary",title:"Reset Session (R)",children:" Reset Session"}),i.jsx("button",{onClick:s,className:"btn btn-primary",title:"Finish Session (Esc)",children:"Finish Session"})]})]})})]})}):null},rO=(s,e=200)=>{const[t,n]=P.useState(s);return P.useEffect(()=>{const a=setTimeout(()=>n(s),e);return()=>clearTimeout(a)},[s,e]),t},aO=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState(""),[a,l]=P.useState(""),[u,h]=P.useState(!1),[m,p]=P.useState(!1),[x,w]=P.useState(""),b=P.useRef(null),E=P.useRef(null),[C]=P.useState(["A direct sum B","The integral from 0 to infinity of x squared dx","The limit as x approaches 0 of sin x over x","The matrix with rows [1,2] and [3,4]","The set of all real numbers x such that x is greater than 0","The derivative of f with respect to x","The sum from n equals 1 to infinity of 1 over n squared","The product from i equals 1 to n of i","The square root of a squared plus b squared","The absolute value of x minus 3"]),k=rO(a,150);P.useEffect(()=>{e&&setTimeout(()=>b.current?.focus(),0)},[e]),P.useEffect(()=>{if(!e)return;const $=M=>{M.key==="Escape"&&s?.()};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[e,s]),vh([k],E.current);const L=P.useCallback(async()=>{if(!(!t.trim()||u)){h(!0),w(""),p(!1);try{const $=await dm.convertToLaTeX(t);l($||"")}catch($){console.error("Error converting to LaTeX:",$),w("Could not convert to LaTeX. Please try again.")}finally{h(!1)}}},[t,u]),U=async $=>{n($),setTimeout(()=>{L()},0)},F=async()=>{if(a)try{await navigator.clipboard.writeText(a),p(!0),setTimeout(()=>p(!1),1500)}catch($){console.error("Failed to copy:",$),p(!1)}},B=()=>{n(""),l(""),p(!1),w(""),h(!1)},H=$=>{($.ctrlKey||$.metaKey)&&$.key==="Enter"&&($.preventDefault(),L())};return e?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},role:"dialog","aria-modal":"true","aria-labelledby":"latex-converter-title",children:i.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"latex-converter-title",className:"text-2xl font-bold",children:" LaTeX Converter"}),i.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Convert natural language to beautiful mathematical notation"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Input"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{htmlFor:"nl-input",className:"block text-sm font-medium claude-text-secondary mb-2",children:"Natural Language Description"}),i.jsx("textarea",{id:"nl-input",ref:b,value:t,onChange:$=>n($.target.value),placeholder:"e.g., A direct sum B, The integral from 0 to infinity of x squared dx...",className:"claude-input h-32",onKeyDown:H}),i.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Press Ctrl/ + Enter to convert"})]}),i.jsx("button",{onClick:L,disabled:!t.trim()||u,className:"claude-button-primary w-full mb-4 disabled:opacity-60",children:u?i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Converting..."]}):" Convert to LaTeX"}),x&&i.jsxs("div",{className:"claude-alert claude-alert-error mb-4",children:[x," ",i.jsx("button",{className:"underline ml-1 font-medium",onClick:L,disabled:u,children:"Retry"})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-medium claude-text-secondary mb-3",children:"Quick Examples"}),i.jsx("div",{className:"space-y-2",children:C.map(($,M)=>i.jsx("button",{onClick:()=>U($),className:"claude-card block w-full text-left p-3 text-sm claude-text-secondary transition-all hover:shadow-md","aria-label":`Use example: ${$}`,children:$},M))})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Output"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{htmlFor:"latex-output",className:"block text-sm font-medium claude-text-secondary mb-2",children:"LaTeX Code"}),i.jsxs("div",{className:"relative",children:[i.jsx("textarea",{id:"latex-output",value:a,readOnly:!0,placeholder:"LaTeX will appear here...",className:"claude-input h-32 font-mono",style:{backgroundColor:"var(--background-modal)"}}),i.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[a&&i.jsx("button",{onClick:F,className:"claude-button-secondary p-2",title:"Copy to clipboard","aria-label":"Copy LaTeX to clipboard",children:""}),m&&i.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},role:"status","aria-live":"polite",children:"Copied!"})]})]})]}),a&&i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Preview"}),i.jsxs("div",{className:"claude-card p-4 min-h-[100px]",style:{border:"2px dashed var(--border-light)"},children:[i.jsx("div",{ref:E,className:"prose max-w-none",children:k}),!window.MathJax&&i.jsx("div",{className:"text-center mt-2 claude-text-muted text-xs",children:"(MathJax not loaded  preview shows raw TeX)"})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("button",{onClick:B,disabled:!t&&!a&&!x,className:"claude-button-secondary w-full disabled:opacity-60",children:" Clear All"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm claude-text-secondary",children:" Tip: Use this tool to quickly convert mathematical expressions"}),i.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Perfect for creating flashcards with LaTeX support"})]})]})]})]}),i.jsxs("div",{className:"mt-8 p-4 rounded-xl",style:{background:"linear-gradient(to right, var(--background-modal), rgba(68, 90, 255, 0.05))"},children:[i.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--heading)"},children:"How to use LaTeX in Three-Sided:"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm claude-text-secondary",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Inline math:"})," Wrap with ",i.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$ $"}),i.jsx("br",{}),i.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",i.jsx("code",{children:"$x^2 + y^2 = z^2$"})]})]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Block math:"})," Wrap with ",i.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$$ $$"}),i.jsx("br",{}),i.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",i.jsxs("code",{children:["$$\\int_0^\\infty e^","{-x}"," \\, dx = 1$$"]})]})]})]})]})]})]})}):null};class Xy{static async createCheckoutSession(){try{const e=await ws.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to create checkout session")}return(await t.json()).id}catch(e){throw console.error("Error creating checkout session:",e),e}}static async createPortalLink(){try{const e=await ws.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createPortalLink",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to create portal link")}return(await t.json()).url}catch(e){throw console.error("Error creating portal link:",e),e}}static async redirectToCheckout(e){const t=window.Stripe?window.Stripe("pk_live_51RUu9KE3qmOAkttRGqw7Cr2wJ6qRHtCz9qXpHJHO0Bv4Q7gGHg5QXI9GFdXGh4IhQD5Xf9XUvLFCr9G2PHK0003w0Q"):null;if(!t)throw new Error("Stripe.js not loaded. Please include the Stripe script in your HTML.");const{error:n}=await t.redirectToCheckout({sessionId:e});if(n)throw new Error(n.message)}}const Da={monthly:{label:"Monthly",displayPrice:"5",period:"month",savings:null,popular:!1,priceId:"price_1RUvcJE3qmOAkttR2Rh4YzOY",interval:"month"},yearly:{label:"Yearly",displayPrice:"50",period:"year",savings:"10",popular:!0,priceId:"price_YEARLY_REPLACE_ME",interval:"year"}},iO=[{name:"Spaced Repetition Mode",description:"Advanced algorithm for optimal learning",free:"",premium:"",icon:""},{name:"AI Autofill (Hint, Proof, Tags)",description:"Generate content with AI assistance",free:" Limited (1/day)",premium:" Unlimited",icon:""},{name:"AI Auto-Tagging",description:"Automatic tag suggestions",free:" Limited (1/day)",premium:" Unlimited",icon:""},{name:"AI LaTeX Conversion",description:"Convert text to mathematical notation",free:" Unlimited",premium:" Unlimited",icon:""},{name:"Public Profile & Sharing",description:"Share your flashcards with the community",free:"",premium:" + Custom Themes",icon:""},{name:"Advanced Analytics",description:"Detailed learning progress tracking",free:"",premium:"",icon:""},{name:"Priority Support",description:"Get help when you need it most",free:"",premium:"",icon:""},{name:"Export & Backup",description:"Download your data anytime",free:"",premium:"",icon:""}],oO=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState("monthly"),[a,l]=P.useState(!1),[u,h]=P.useState(!1),[m,p]=P.useState(""),x=P.useRef(null);P.useEffect(()=>{if(e){const E=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=E}}},[e]),P.useEffect(()=>{if(!e)return;setTimeout(()=>x.current?.focus(),0);const E=C=>{C.key==="Escape"&&s?.()};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[e,s]);const w=P.useCallback(async()=>{p("");try{l(!0);const E=await Xy.createCheckoutSession();await Xy.redirectToCheckout(E)}catch(E){console.error("Error creating subscription:",E),p("Failed to start subscription. Please check your connection and try again.")}finally{l(!1)}},[t]),b=P.useCallback(async()=>{p("");try{h(!0);const E=await Xy.createPortalLink();window.location.href=E}catch(E){console.error("Error accessing subscription management:",E),p("Failed to open the billing portal. Please try again.")}finally{h(!1)}},[]);return e?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:i.jsxs("div",{ref:x,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"premium-title",className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden outline-none",children:[i.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"premium-title",className:"text-2xl font-bold",children:" Premium Features"}),i.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),i.jsx("p",{className:"text-white/90 mt-1",children:"Unlock the full potential of Three-Sided"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[m&&i.jsx("div",{className:"claude-alert claude-alert-error mb-4",children:m}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Choose Your Plan"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto",role:"radiogroup","aria-label":"Billing plan",children:[i.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 ${t==="monthly"?"claude-card-elevated":""}`,style:{border:t==="monthly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="monthly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[i.jsx("input",{type:"radio",name:"plan",value:"monthly",className:"sr-only",checked:t==="monthly",onChange:()=>n("monthly"),"aria-label":"Monthly plan"}),i.jsxs("div",{className:"text-center",children:[i.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:Da.monthly.label}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:Da.monthly.displayPrice}),i.jsxs("div",{className:"claude-text-secondary mb-4",children:["per ",Da.monthly.period]}),i.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto border-2",style:{backgroundColor:t==="monthly"?"var(--accent-primary)":"transparent",borderColor:t==="monthly"?"var(--accent-primary)":"var(--border-light)"}})]})]}),i.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 relative ${t==="yearly"?"claude-card-elevated":""}`,style:{border:t==="yearly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="yearly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[i.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:i.jsx("span",{className:"text-white px-3 py-1 rounded-full text-xs font-bold",style:{backgroundColor:"var(--accent-secondary)"},children:"MOST POPULAR"})}),i.jsx("input",{type:"radio",name:"plan",value:"yearly",className:"sr-only",checked:t==="yearly",onChange:()=>n("yearly"),"aria-label":"Yearly plan"}),i.jsxs("div",{className:"text-center",children:[i.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:Da.yearly.label}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:Da.yearly.displayPrice}),i.jsxs("div",{className:"claude-text-secondary mb-2",children:["per ",Da.yearly.period]}),i.jsxs("div",{className:"font-bold mb-4",style:{color:"var(--success)"},children:["Save ",Da.yearly.savings,"!"]}),i.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto",style:{backgroundColor:t==="yearly"?"var(--accent-primary)":"transparent",borderColor:t==="yearly"?"var(--accent-primary)":"var(--border-light)"}})]})]})]})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Feature Comparison"}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{children:i.jsxs("tr",{style:{borderBottom:"2px solid var(--border-light)"},children:[i.jsx("th",{className:"text-left p-4 font-semibold",style:{color:"var(--heading)"},children:"Feature"}),i.jsx("th",{className:"text-center p-4 font-semibold",style:{color:"var(--heading)"},children:"Free"}),i.jsx("th",{className:"text-center p-4 font-semibold rounded-lg",style:{color:"var(--heading)",background:"linear-gradient(to right, rgba(99, 91, 255, 0.1), rgba(68, 90, 255, 0.1))"},children:"Premium"})]})}),i.jsx("tbody",{children:iO.map((E,C)=>i.jsxs("tr",{className:"claude-card hover:shadow-sm transition-all",style:{border:"none",marginBottom:"4px"},children:[i.jsx("td",{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:E.icon}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",style:{color:"var(--heading)"},children:E.name}),i.jsx("div",{className:"text-sm claude-text-secondary",children:E.description})]})]})}),i.jsx("td",{className:"p-4 text-center",children:i.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:E.free===""?"rgba(91, 200, 162, 0.1)":E.free.startsWith("")?"rgba(255, 213, 84, 0.1)":"var(--background-modal)",color:E.free===""?"var(--success)":E.free.startsWith("")?"var(--warning)":"var(--text-secondary)"},children:E.free})}),i.jsx("td",{className:"p-4 text-center",style:{background:"linear-gradient(to right, rgba(99, 91, 255, 0.05), rgba(68, 90, 255, 0.05))"},children:i.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:E.premium})})]},C))})]})})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Why Go Premium?"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Accelerate Learning"}),i.jsx("p",{className:"claude-text-secondary",children:"Unlimited AI assistance helps you create better flashcards faster"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Track Progress"}),i.jsx("p",{className:"claude-text-secondary",children:"Advanced analytics show your learning journey and improvement"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Study Smarter"}),i.jsx("p",{className:"claude-text-secondary",children:"Spaced repetition algorithm optimizes your study schedule"})]})]})]}),i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("button",{onClick:w,disabled:a,className:"claude-button-primary text-lg px-12 py-4 disabled:opacity-60 disabled:cursor-not-allowed",style:{boxShadow:"0 0 20px rgba(99, 91, 255, 0.3)"},children:a?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):`Go Premium - ${Da[t].displayPrice}/${Da[t].period}`}),i.jsxs("div",{className:"flex justify-center gap-4",children:[i.jsx("button",{onClick:b,disabled:u,className:"claude-button-secondary disabled:opacity-60 disabled:cursor-not-allowed",children:u?"Opening":"Manage Subscription"}),i.jsx("button",{onClick:s,className:"claude-button-secondary",children:"Maybe Later"})]})]}),i.jsx("div",{className:"mt-8 p-4 rounded-xl text-center",style:{backgroundColor:"var(--background-modal)"},children:i.jsx("p",{className:"text-sm claude-text-secondary",children:" Secure payment powered by Stripe  Cancel anytime  30-day money-back guarantee"})})]})]})}):null},lO=({onProfileCreated:s,onClose:e})=>{const{user:t}=Rn(),[n,a]=P.useState({displayName:"",bio:"",institution:""}),[l,u]=P.useState(""),[h,m]=P.useState({state:"idle",message:""}),[p,x]=P.useState(!1),[w,b]=P.useState(null),E={displayName:50,bio:1e3,institution:100},C=P.useCallback(async B=>{const H=As.slugify(B);if(u(H),!H){m({state:"idle",message:""});return}m({state:"checking",message:"Checking availability..."});try{const $=await As.isSlugTaken(H);m($?{state:"taken",message:` ${H} is already taken`}:{state:"available",message:` ${H} is available!`})}catch{m({state:"error",message:" Error checking availability. Please try again."})}},[]),k=B=>{a($=>({...$,displayName:B})),w&&clearTimeout(w);const H=setTimeout(()=>{C(B)},400);b(H)},L=async B=>{if(B.preventDefault(),!t){alert("You must be logged in to create a profile.");return}if(n.displayName.length<2||n.displayName.length>E.displayName){alert(`Display name must be between 2 and ${E.displayName} characters.`);return}if(n.bio.length>E.bio){alert(`Bio must be ${E.bio} characters or less.`);return}if(n.institution.length>E.institution){alert(`Institution must be ${E.institution} characters or less.`);return}if(!l||h.state!=="available"){alert("Please wait for slug availability check or choose a different name.");return}x(!0);try{if(await As.isSlugTaken(l)){alert(`Username "${l}" was just taken. Please choose another name.`),await C(n.displayName);return}await As.createProfile(t.uid,l,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim(),email:t.email}),s&&s()}catch(H){console.error("Error creating profile:",H),alert("Something went wrong. Please try again.")}finally{x(!1)}},U=({current:B,max:H,label:$})=>{const M=B/H*100;let R="text-sm ";return M>90?R+="text-red-500":M>70?R+="text-yellow-500":R+="text-gray-500",i.jsxs("div",{className:R,children:[B,"/",H," ",$]})};P.useEffect(()=>()=>{w&&clearTimeout(w)},[w]);const F=n.displayName.length>=2&&n.displayName.length<=E.displayName&&n.bio.length<=E.bio&&n.institution.length<=E.institution&&h.state==="available";return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Create Your Profile"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Set up your public profile to connect with others"})]}),i.jsx("div",{className:"claude-card p-8",children:i.jsxs("form",{onSubmit:L,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),i.jsx("input",{type:"text",value:n.displayName,onChange:B=>k(B.target.value),placeholder:"Enter your display name",maxLength:E.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:B=>{B.target.style.borderColor="var(--claude-accent)",B.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:B=>{B.target.style.borderColor="var(--claude-border)",B.target.style.boxShadow="none"}}),i.jsx("div",{className:"flex justify-between items-center mt-2",children:i.jsx(U,{current:n.displayName.length,max:E.displayName,label:"characters"})}),i.jsxs("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[i.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your profile URL: ",i.jsxs("strong",{children:["three-sided.app/profile/",i.jsx("span",{className:"font-mono",children:l||"..."})]})]}),h.message&&i.jsxs("div",{className:`text-sm mt-1 ${h.state==="checking"?"text-blue-500":h.state==="available"?"text-green-500":(h.state==="taken","text-red-500")}`,children:[h.state==="checking"&&i.jsxs("span",{className:"inline-flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),h.message]}),h.state!=="checking"&&h.message]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Short Bio"}),i.jsx("textarea",{value:n.bio,onChange:B=>a(H=>({...H,bio:B.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:E.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:B=>{B.target.style.borderColor="var(--claude-accent)",B.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:B=>{B.target.style.borderColor="var(--claude-border)",B.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),i.jsx(U,{current:n.bio.length,max:E.bio,label:"characters"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),i.jsx("input",{type:"text",value:n.institution,onChange:B=>a(H=>({...H,institution:B.target.value})),placeholder:"University, company, or organization (optional)",maxLength:E.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:B=>{B.target.style.borderColor="var(--claude-accent)",B.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:B=>{B.target.style.borderColor="var(--claude-border)",B.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{}),i.jsx(U,{current:n.institution.length,max:E.institution,label:"characters"})]})]}),i.jsxs("div",{className:"flex gap-4 pt-4",children:[i.jsx("button",{type:"submit",disabled:!F||p,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:p?i.jsxs("span",{className:"flex items-center justify-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Profile..."]}):"Create Profile"}),e&&i.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 rounded-xl font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:B=>{B.target.style.backgroundColor="var(--claude-surface-hover)"},onMouseLeave:B=>{B.target.style.backgroundColor="var(--claude-subtle)"},children:"Cancel"})]})]})})]})})};class xn{static async getFriendRequests(e){try{const t=Le(Ce(ee,"friendRequests"),Ye("to","==",e),Jt("timestamp","desc")),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data(),h=u.from,m=await As.getProfileByUserId(h);a.push({id:l.id,fromId:h,toId:u.to,timestamp:u.timestamp,senderProfile:m||{displayName:"Unknown User",slug:null}})}return a}catch(t){throw console.error("Error getting friend requests:",t),t}}static async sendFriendRequest(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs");const[n,a]=await Promise.all([this.checkExistingRequest(e,t),this.checkExistingRequest(t,e)]);if(n)throw new Error("Friend request already sent");if(a)throw new Error("This user has already sent you a friend request");if(await this.areFriends(e,t))throw new Error("You are already friends");const u=3;let h;for(let m=1;m<=u;m++)try{await Ys(Ce(ee,"friendRequests"),{from:e,to:t,timestamp:Pe(),status:"pending"}),console.log(" Friend request sent:",{fromId:e,toId:t});return}catch(p){h=p,m<u&&(console.warn(`Retry ${m}/${u} for friend request:`,p.message),await new Promise(x=>setTimeout(x,1e3*m)))}throw h}catch(n){throw console.error(" Error sending friend request:",n),n}}static async acceptFriendRequest(e,t,n){try{if(!e||!t||!n||t===n)throw new Error("Invalid parameters for accepting friend request");const a=await vt(ve(ee,"friendRequests",e));if(!a.exists())throw new Error("Friend request not found");const l=a.data();if(l.from!==t||l.to!==n)throw new Error("Friend request does not match the specified users");if(await this.areFriends(t,n)){await Wo(ve(ee,"friendRequests",e)),console.log("Users were already friends, cleaned up request");return}const h=Jo(ee),m=ve(ee,"userFriends",n,"friends",t),p=ve(ee,"userFriends",t,"friends",n),x={addedAt:Pe(),requestAcceptedAt:Pe(),status:"active"};h.set(m,x),h.set(p,x);const w=ve(ee,"friendRequests",e);h.delete(w);const b=3;let E;for(let C=1;C<=b;C++)try{await h.commit(),console.log(" Friend request accepted:",{fromId:t,toId:n,requestId:e});return}catch(k){E=k,C<b&&(console.warn(`Retry ${C}/${b} for accepting friend request:`,k.message),await new Promise(L=>setTimeout(L,1e3*C)))}throw E}catch(a){throw console.error(" Error accepting friend request:",a),a}}static async rejectFriendRequest(e){try{await Wo(ve(ee,"friendRequests",e)),console.log(" Friend request rejected:",e)}catch(t){throw console.error(" Error rejecting friend request:",t),t}}static async removeFriend(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs for removing friend");if(!await this.areFriends(e,t)){console.log("Users are not friends, nothing to remove");return}const a=Jo(ee),l=ve(ee,"userFriends",e,"friends",t),u=ve(ee,"userFriends",t,"friends",e);a.delete(l),a.delete(u);const h=3;let m;for(let p=1;p<=h;p++)try{await a.commit(),console.log(" Friend removed:",{userId:e,friendId:t});return}catch(x){m=x,p<h&&(console.warn(`Retry ${p}/${h} for removing friend:`,x.message),await new Promise(w=>setTimeout(w,1e3*p)))}throw m}catch(n){throw console.error(" Error removing friend:",n),n}}static async getFriends(e){try{const t=Le(Ce(ee,"userFriends",e,"friends")),n=await Ke(t),a=[];for(const l of n.docs){const u=l.id,h=l.data(),m=await As.getProfileByUserId(u);m&&a.push({userId:u,addedAt:h.addedAt,...m})}return a}catch(t){throw console.error("Error getting friends:",t),t}}static async getFriendshipStatus(e,t){try{const n=await this.areFriends(e,t),a=await this.checkExistingRequest(e,t),l=await this.checkExistingRequest(t,e);return{areFriends:n,sentRequest:!!a,receivedRequest:!!l,receivedRequestId:l?.id||null}}catch(n){return console.error("Error getting friendship status:",n),{areFriends:!1,sentRequest:!1,receivedRequest:!1,receivedRequestId:null}}}static async areFriends(e,t){try{return(await vt(ve(ee,"userFriends",e,"friends",t))).exists()}catch(n){return console.error("Error checking friendship:",n),!1}}static async checkExistingRequest(e,t){try{const n=Le(Ce(ee,"friendRequests"),Ye("from","==",e),Ye("to","==",t)),a=await Ke(n);if(!a.empty){const l=a.docs[0];return{id:l.id,...l.data()}}return null}catch(n){return console.error("Error checking existing request:",n),null}}static async getMutualFriends(e,t){try{const[n,a]=await Promise.all([this.getFriendIds(e),this.getFriendIds(t)]),l=n.filter(h=>a.includes(h)),u=[];for(let h=0;h<Math.min(3,l.length);h++){const m=await As.getProfileByUserId(l[h]);m&&u.push(m)}return{total:l.length,profiles:u,hasMore:l.length>3}}catch(n){return console.error("Error getting mutual friends:",n),{total:0,profiles:[],hasMore:!1}}}static async getFriendCount(e){try{const t=Le(Ce(ee,"userFriends",e,"friends"));return(await Ke(t)).size}catch(t){return console.error("Error getting friend count:",t),0}}static async getFriendIds(e){try{const t=Le(Ce(ee,"userFriends",e,"friends"));return(await Ke(t)).docs.map(a=>a.id)}catch(t){return console.error("Error getting friend IDs:",t),[]}}}const cO=({onViewProfile:s})=>{const{user:e}=Rn(),[t,n]=P.useState("friends"),[a,l]=P.useState([]),[u,h]=P.useState([]),[m,p]=P.useState([]),[x,w]=P.useState(""),[b,E]=P.useState(!1),[C,k]=P.useState([]),[L,U]=P.useState({friendCount:0,requestCount:0,sharedCardsCount:0,mutualConnections:0});P.useEffect(()=>{e&&F()},[e]),P.useEffect(()=>{switch(t){case"friends":B();break;case"requests":H();break;case"leaderboard":V();break}},[t]);const F=async()=>{try{const[ae,z,oe]=await Promise.all([xn.getFriendCount(e.uid),xn.getFriendRequests(e.uid),os.getPublicFlashcardsByUser(e.uid)]);U(Y=>({...Y,friendCount:ae,requestCount:z.length,sharedCardsCount:oe.length}))}catch(ae){console.error("Error loading initial data:",ae)}},B=async()=>{E(!0);try{const ae=await xn.getFriends(e.uid);l(ae),U(z=>({...z,friendCount:ae.length}))}catch(ae){console.error("Error loading friends:",ae)}finally{E(!1)}},H=async()=>{E(!0);try{const ae=await xn.getFriendRequests(e.uid);h(ae),U(z=>({...z,requestCount:ae.length}))}catch(ae){console.error("Error loading friend requests:",ae)}finally{E(!1)}},$=async()=>{if(x.trim()){E(!0);try{const z=(await As.searchProfiles(x)).filter(Y=>Y.userId!==e.uid),oe=await Promise.all(z.map(async Y=>{const be=await xn.getFriendshipStatus(e.uid,Y.userId),D=await xn.getMutualFriends(e.uid,Y.userId);return{...Y,friendshipStatus:be,mutualFriends:D}}));p(oe)}catch(ae){console.error("Error searching users:",ae)}finally{E(!1)}}},M=async ae=>{try{await xn.sendFriendRequest(e.uid,ae),I("Friend request sent!"),x&&await $(),await F()}catch(z){console.error("Error sending friend request:",z),I("Failed to send friend request",!0)}},R=async ae=>{try{await xn.acceptFriendRequest(ae.id,ae.fromId,e.uid),I("Friend request accepted!"),await H(),await F(),t==="friends"&&await B()}catch(z){console.error("Error accepting friend request:",z),I("Failed to accept friend request",!0)}},N=async ae=>{try{await xn.rejectFriendRequest(ae),I("Friend request declined"),await H(),await F()}catch(z){console.error("Error rejecting friend request:",z),I("Failed to reject friend request",!0)}},A=async(ae,z)=>{if(confirm(`Remove ${z} from your friends?`))try{await xn.removeFriend(e.uid,ae),I("Friend removed"),await B(),await F()}catch(oe){console.error("Error removing friend:",oe),I("Failed to remove friend",!0)}},V=async()=>{E(!0);try{const ae=await xn.getFriendIds(e.uid),z=[e.uid,...ae],oe=[];for(const be of z){const D=await As.getProfileByUserId(be);D&&oe.push({...D,userId:be})}const Y=await Promise.all(oe.map(async be=>{const D=await xn.getFriendCount(be.userId);return{...be,friendCount:D,isCurrentUser:be.userId===e.uid}}));Y.sort((be,D)=>D.friendCount-be.friendCount),k(Y)}catch(ae){console.error("Error loading leaderboard:",ae)}finally{E(!1)}},I=(ae,z=!1)=>{const oe=document.createElement("div");oe.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",oe.style.backgroundColor=z?"#ef4444":"#10b981",oe.textContent=ae,document.body.appendChild(oe),setTimeout(()=>{oe.style.transform="translateX(0)"},100),setTimeout(()=>{oe.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(oe)},300)},3e3)},G=ae=>ae?ae.split(" ").map(z=>z.charAt(0)).join("").toUpperCase().slice(0,2):"?",O=(ae,z,oe,Y=!0)=>{const be=()=>Y?z?.areFriends?i.jsx("button",{onClick:()=>A(ae.userId,ae.displayName),className:"px-3 py-1 rounded-lg text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove"}):z?.sentRequest?i.jsx("span",{className:"px-3 py-1 rounded-lg text-sm font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):z?.receivedRequest?i.jsx("button",{onClick:()=>R({id:z.receivedRequestId,fromId:ae.userId}),className:"px-3 py-1 rounded-lg text-sm font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}):i.jsx("button",{onClick:()=>M(ae.userId),className:"px-3 py-1 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}):null,D=()=>z?.areFriends?i.jsx("span",{className:"px-2 py-1 rounded text-xs bg-green-100 text-green-800",children:"Friends"}):z?.sentRequest?i.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"Pending"}):z?.receivedRequest?i.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"Wants to connect"}):null;return i.jsx("div",{className:"claude-card p-4 hover:scale-[1.02] transition-transform",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:G(ae.displayName)}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:s&&ae.slug?i.jsx("button",{onClick:()=>s(ae.slug),className:"hover:underline transition-colors",style:{color:"var(--claude-heading)"},children:ae.displayName||"Unknown User"}):ae.displayName||"Unknown User"}),D()]}),i.jsxs("div",{className:"text-sm claude-text-secondary space-y-1",children:[ae.email&&i.jsx("div",{children:ae.email}),ae.institution&&i.jsxs("div",{children:[" ",ae.institution]}),oe?.total>0&&i.jsxs("div",{className:"text-green-600 font-medium",children:[oe.total," mutual friend",oe.total>1?"s":""]})]})]})]}),i.jsx("div",{className:"flex items-center gap-2",children:be()})]})},ae.userId)},Ve=[{id:"friends",label:"My Friends",icon:""},{id:"discover",label:"Discover",icon:""},{id:"requests",label:"Requests",icon:"",badge:L.requestCount},{id:"leaderboard",label:"Leaderboard",icon:""}];return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Friends & Social"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Connect with fellow learners and share your progress"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:L.friendCount}),i.jsx("div",{className:"claude-text-secondary",children:"Friends"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:L.sharedCardsCount}),i.jsx("div",{className:"claude-text-secondary",children:"Cards Shared"})]}),i.jsxs("div",{className:"claude-card p-6 text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:L.requestCount}),i.jsx("div",{className:"claude-text-secondary",children:"Pending Requests"})]})]}),i.jsx("div",{className:"claude-card p-2 mb-8",children:i.jsx("div",{className:"flex",children:Ve.map(ae=>i.jsxs("button",{onClick:()=>n(ae.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 relative",style:{backgroundColor:t===ae.id?"var(--claude-accent)":"transparent",color:t===ae.id?"white":"var(--claude-secondary-text)"},children:[i.jsx("span",{children:ae.icon}),ae.label,ae.badge>0&&i.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:ae.badge})]},ae.id))})}),i.jsxs("div",{className:"claude-card p-8",children:[t==="friends"&&i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" My Friends (",L.friendCount,")"]}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ae,z)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},z))}):a.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No friends yet"}),i.jsx("p",{className:"claude-text-secondary",children:"Search for users to add your first friend!"})]}):i.jsx("div",{className:"space-y-4",children:a.map(ae=>O(ae,{areFriends:!0},null,!0))})]}),t==="discover"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Discover Users"}),i.jsxs("div",{className:"flex gap-4 mb-6",children:[i.jsx("input",{type:"text",value:x,onChange:ae=>w(ae.target.value),onKeyPress:ae=>ae.key==="Enter"&&$(),placeholder:"Search by email or display name...",className:"flex-1 px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"}}),i.jsxs("button",{onClick:$,disabled:!x.trim()||b,className:"claude-button-primary disabled:opacity-50",children:[b?"":""," Search"]})]}),i.jsx("p",{className:"text-sm claude-text-secondary mb-6",children:" Tip: Search by email address or display name for best results"}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ae,z)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},z))}):m.length===0&&x?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),i.jsx("p",{className:"claude-text-secondary",children:"Try searching with a different email or username"})]}):m.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Discover new friends"}),i.jsx("p",{className:"claude-text-secondary",children:"Search for users to connect with and share your learning journey!"})]}):i.jsx("div",{className:"space-y-4",children:m.map(ae=>O(ae,ae.friendshipStatus,ae.mutualFriends,!0))})]}),t==="requests"&&i.jsxs("div",{children:[i.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" Friend Requests (",L.requestCount,")"]}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:2}).map((ae,z)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},z))}):u.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No pending requests"}),i.jsx("p",{className:"claude-text-secondary",children:"You're all caught up! New friend requests will appear here."})]}):i.jsx("div",{className:"space-y-4",children:u.map(ae=>i.jsx("div",{className:"claude-card p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:G(ae.senderProfile.displayName)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:ae.senderProfile.displayName||"Unknown User"}),i.jsx("div",{className:"text-sm claude-text-secondary",children:"Wants to connect with you"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>R(ae),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}),i.jsx("button",{onClick:()=>N(ae.id),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Decline"})]})]})},ae.id))})]}),t==="leaderboard"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Friends Leaderboard"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:"Top learners among you and your friends"}),b?i.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((ae,z)=>i.jsx("div",{className:"animate-pulse claude-card p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),i.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),i.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]})},z))}):C.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No leaderboard data"}),i.jsx("p",{className:"claude-text-secondary",children:"Add some friends to see the leaderboard!"})]}):i.jsx("div",{className:"space-y-3",children:C.map((ae,z)=>i.jsx("div",{className:`claude-card p-4 transition-all duration-300 hover:scale-[1.02] ${ae.isCurrentUser?"ring-2 ring-blue-500 bg-blue-50/10":""}`,style:{backgroundColor:z<3&&!ae.isCurrentUser?"rgba(255, 215, 0, 0.1)":ae.isCurrentUser?"rgba(59, 130, 246, 0.1)":"var(--claude-surface)",border:`1px solid ${z<3&&!ae.isCurrentUser?"rgba(255, 215, 0, 0.3)":ae.isCurrentUser?"rgba(59, 130, 246, 0.3)":"var(--claude-border)"}`},children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm",style:{background:z<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:z<3?"white":"var(--claude-text)"},children:z===0?"":z===1?"":z===2?"":z+1}),i.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:G(ae.displayName)}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:[ae.displayName||"Unknown User",ae.isCurrentUser&&i.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"You"})]}),ae.slug&&i.jsxs("button",{onClick:()=>s&&s(ae.slug),className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",ae.slug]})]}),i.jsx("div",{className:"claude-text-secondary text-sm",children:ae.institution&&` ${ae.institution}`})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xl font-bold",style:{color:z<3?"#FFD700":"var(--claude-accent-blue)"},children:ae.friendCount}),i.jsxs("div",{className:"claude-text-secondary text-sm",children:["friend",ae.friendCount!==1?"s":""]})]})]})},ae.userId))})]})]})]})})},uO=({profile:s,onSave:e,onCancel:t})=>{const[n,a]=P.useState({displayName:"",bio:"",institution:""}),[l,u]=P.useState(!1),h={displayName:50,bio:1e3,institution:100};P.useEffect(()=>{s&&a({displayName:s.displayName||"",bio:s.bio||"",institution:s.institution||""})},[s]);const m=async x=>{if(x.preventDefault(),n.displayName.length<2||n.displayName.length>h.displayName){alert(`Display name must be between 2 and ${h.displayName} characters.`);return}if(n.bio.length>h.bio){alert(`Bio must be ${h.bio} characters or less.`);return}if(n.institution.length>h.institution){alert(`Institution must be ${h.institution} characters or less.`);return}u(!0);try{await As.updateProfile(s.slug,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()}),e&&e({...s,displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()})}catch(w){console.error("Error updating profile:",w),alert("Something went wrong. Please try again.")}finally{u(!1)}},p=({current:x,max:w,label:b})=>{const E=x/w*100;let C="text-sm ";return E>90?C+="text-red-500":E>70?C+="text-yellow-500":C+="text-gray-500",i.jsxs("div",{className:C,children:[x,"/",w," ",b]})};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"claude-card p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-3xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Edit Profile"}),i.jsx("p",{className:"claude-text-secondary",children:"Update your public profile information"})]}),i.jsxs("form",{onSubmit:m,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),i.jsx("input",{type:"text",value:n.displayName,onChange:x=>a(w=>({...w,displayName:x.target.value})),placeholder:"Enter your display name",maxLength:h.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your username @",s?.slug," cannot be changed"]}),i.jsx(p,{current:n.displayName.length,max:h.displayName,label:"characters"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Bio"}),i.jsx("textarea",{value:n.bio,onChange:x=>a(w=>({...w,bio:x.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:h.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),i.jsx(p,{current:n.bio.length,max:h.bio,label:"characters"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),i.jsx("input",{type:"text",value:n.institution,onChange:x=>a(w=>({...w,institution:x.target.value})),placeholder:"University, company, or organization (optional)",maxLength:h.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("div",{}),i.jsx(p,{current:n.institution.length,max:h.institution,label:"characters"})]})]}),i.jsxs("div",{className:"flex gap-4 pt-4",children:[i.jsx("button",{type:"submit",disabled:l,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?i.jsxs("span",{className:"flex items-center justify-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"}),i.jsx("button",{type:"button",onClick:t,disabled:l,className:"px-6 py-3 rounded-xl font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:x=>{l||(x.target.style.backgroundColor="var(--claude-surface-hover)")},onMouseLeave:x=>{l||(x.target.style.backgroundColor="var(--claude-subtle)")},children:"Cancel"})]})]})]})})},dO=({profileSlug:s,onClose:e})=>{const{user:t}=Rn(),[n,a]=P.useState(null),[l,u]=P.useState([]),[h,m]=P.useState(null),[p,x]=P.useState(null),[w,b]=P.useState({cardCount:0,friendCount:0}),[E,C]=P.useState(!0),[k,L]=P.useState("upvotes"),[U,F]=P.useState(!1),[B,H]=P.useState(null);P.useEffect(()=>{s&&$()},[s]),P.useEffect(()=>{n&&n.userId&&M()},[n,k]);const $=async()=>{C(!0);try{const z=await As.getProfileBySlug(s);if(!z)throw new Error("Profile not found");a(z)}catch(z){console.error("Error loading profile:",z),alert("Profile not found or error loading profile"),e&&e()}finally{C(!1)}},M=async()=>{try{const[z,oe,Y,be]=await Promise.all([R(),xn.getFriendCount(n.userId),t?xn.getFriendshipStatus(t.uid,n.userId):null,t?xn.getMutualFriends(t.uid,n.userId):null]);b({cardCount:z.length,friendCount:oe}),m(Y),x(be)}catch(z){console.error("Error loading profile data:",z)}},R=async()=>{try{const oe=(await os.getPublicFlashcardsByUser(n.userId)).sort((Y,be)=>{switch(k){case"upvotes":return(be.upvotes||0)-(Y.upvotes||0);case"date":return new Date(be.createdAt)-new Date(Y.createdAt);default:return 0}});return u(oe),oe}catch(z){return console.error("Error loading public cards:",z),[]}},N=async z=>{if(!t){alert("Please sign in to connect with friends");return}try{switch(z){case"send_request":await xn.sendFriendRequest(t.uid,n.userId),A("Friend request sent!");break;case"accept_request":await xn.acceptFriendRequest(h.receivedRequestId,n.userId,t.uid),A("Friend request accepted!");break;case"remove_friend":confirm(`Remove ${n.displayName} from your friends?`)&&(await xn.removeFriend(t.uid,n.userId),A("Friend removed"));break}const oe=await xn.getFriendshipStatus(t.uid,n.userId);m(oe);const Y=await xn.getFriendCount(n.userId);b(be=>({...be,friendCount:Y}))}catch(oe){console.error("Error with friend action:",oe),A("Failed to perform action",!0)}},A=(z,oe=!1)=>{const Y=document.createElement("div");Y.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",Y.style.backgroundColor=oe?"#ef4444":"#10b981",Y.textContent=z,document.body.appendChild(Y),setTimeout(()=>{Y.style.transform="translateX(0)"},100),setTimeout(()=>{Y.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(Y)},300)},3e3)},V=z=>z?z.split(" ").map(oe=>oe.charAt(0)).join("").toUpperCase().slice(0,2):"?",I=()=>!t||!h?null:h.areFriends?i.jsx("button",{onClick:()=>N("remove_friend"),className:"px-4 py-2 rounded-lg font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove Friend"}):h.sentRequest?i.jsx("span",{className:"px-4 py-2 rounded-lg font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):h.receivedRequest?i.jsx("button",{onClick:()=>N("accept_request"),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept Friend Request"}):i.jsx("button",{onClick:()=>N("send_request"),className:"px-4 py-2 rounded-lg font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}),G=z=>z?(z.toDate?z.toDate():new Date(z)).toLocaleDateString():"Unknown",O=z=>{a(z),F(!1),A("Profile updated successfully!")},Ve=()=>{F(!1)};if(E)return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading profile..."})]})})});if(!n)return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:"Profile not found"}),i.jsx("p",{className:"claude-text-secondary mb-4",children:"The profile you're looking for doesn't exist or has been removed."}),e&&i.jsx("button",{onClick:e,className:"claude-button-primary",children:"Go Back"})]})})});const ae=t&&t.uid===n.userId;return i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e&&i.jsx("button",{onClick:e,className:"mb-4 px-4 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},children:" Back"}),i.jsx("div",{className:"claude-card p-8 mb-8",children:i.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[i.jsxs("div",{className:"text-center md:text-left",children:[i.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto md:mx-0 mb-4",style:{background:"var(--claude-accent)"},children:V(n.displayName)}),i.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:n.displayName||"Anonymous User"}),i.jsxs("p",{className:"claude-text-secondary text-lg mb-2",children:["@",n.slug]}),n.institution&&i.jsxs("p",{className:"claude-text-secondary",children:[" ",n.institution]})]}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[n.bio&&i.jsx("div",{className:"mb-4",children:i.jsx("p",{className:"claude-text-primary",children:n.bio})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent-blue)"},children:w.cardCount}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent)"},children:w.friendCount}),i.jsx("div",{className:"claude-text-secondary text-sm",children:"Friends"})]})]}),p&&p.total>0&&i.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[i.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--claude-heading)"},children:[p.total," mutual friend",p.total>1?"s":""]}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:[p.profiles.map(z=>z.displayName).join(", "),p.hasMore&&` and ${p.total-p.profiles.length} more`]})]}),i.jsxs("div",{className:"flex gap-3",children:[I(),ae&&i.jsx("button",{onClick:()=>F(!0),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Edit Profile"})]})]})]})}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:["Public Flashcards (",w.cardCount,")"]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("label",{className:"text-sm font-medium",style:{color:"var(--claude-secondary-text)"},children:"Sort by:"}),i.jsxs("select",{value:k,onChange:z=>L(z.target.value),className:"px-3 py-1 rounded-lg border",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},children:[i.jsx("option",{value:"upvotes",children:"Upvotes"}),i.jsx("option",{value:"date",children:"Date Created"})]})]})]}),l.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No public flashcards"}),i.jsx("p",{className:"claude-text-secondary",children:ae?"You haven't shared any flashcards publicly yet.":`${n.displayName} hasn't shared any flashcards publicly yet.`})]}):i.jsx("div",{className:"grid gap-4",children:l.map(z=>i.jsxs("div",{className:"border rounded-xl p-6 transition-all hover:shadow-md",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)"},children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:z.statement||z.question||"Untitled Card"}),z.subject&&i.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 mb-2",children:z.subject}),i.jsxs("div",{className:"text-sm claude-text-secondary",children:["Created ",G(z.createdAt)]})]}),i.jsxs("div",{className:"flex items-center gap-3 text-sm claude-text-secondary",children:[i.jsxs("span",{children:[" ",z.upvotes||0]}),i.jsxs("span",{children:[" ",z.viewCount||0]})]})]}),z.tags&&z.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-2",children:z.tags.map((oe,Y)=>i.jsxs("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:"var(--claude-border)",color:"var(--claude-secondary-text)"},children:["#",oe]},Y))})]},z.id))})]}),U&&i.jsx(uO,{profile:n,onSave:O,onCancel:Ve})]})})},WT=({onDeckCreated:s,onClose:e,editingDeck:t=null})=>{const{user:n}=Rn(),[a,l]=P.useState({name:"",description:"",subject:"",difficulty:"beginner",tags:"",color:"#635BFF",icon:"",isPublic:!1}),[u,h]=P.useState(!1),[m,p]=P.useState(""),[x,w]=P.useState(!1),b=["#635BFF","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"],E=["","","","","","","","","","","","","","","",""],C=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Other"];P.useEffect(()=>{t&&l({name:t.name||"",description:t.description||"",subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:(t.tags||[]).join(", "),color:t.color||"#635BFF",icon:t.icon||"",isPublic:t.isPublic||!1})},[t]);const k=(U,F)=>{l(B=>({...B,[U]:F})),p("")},L=async U=>{if(U.preventDefault(),!n){p("Please sign in to create decks");return}if(!a.name.trim()){p("Deck name is required");return}h(!0),p("");try{const F={name:a.name.trim(),description:a.description.trim(),subject:a.subject,difficulty:a.difficulty,tags:a.tags.split(",").map(H=>H.trim()).filter(H=>H),color:a.color,icon:a.icon,isPublic:a.isPublic};if(a.isPublic){const H=await As.getUserSlug(n.uid);if(!H){p("You must create a profile before making public decks."),h(!1);return}F.authorSlug=H,F.slug=await is.generateUniqueSlug(a.name,H)}let B;t?(await is.updateDeck(t.id,F),B=t.id):B=await is.createDeck(n.uid,F),w(!0),setTimeout(()=>{s&&s(B),e&&e()},1500)}catch(F){console.error("Error saving deck:",F),p(F.message||"Failed to save deck. Please try again.")}finally{h(!1)}};return x?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-2xl font-bold claude-success mb-4",children:t?"Deck Updated!":"Deck Created!"}),i.jsxs("p",{className:"claude-text-secondary",children:["Your deck has been ",t?"updated":"created"," successfully."]})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:t?" Edit Deck":" Create New Deck"}),i.jsx("p",{className:"claude-text-secondary text-lg",children:t?"Update your deck details":"Organize your flashcards into a themed collection"})]}),i.jsxs("form",{onSubmit:L,className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Basic Information"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck Name ",i.jsx("span",{className:"claude-error",children:"*"})]}),i.jsx("input",{type:"text",value:a.name,onChange:U=>k("name",U.target.value),placeholder:"e.g. Calculus I - Derivatives",className:"claude-input w-full",maxLength:100,required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Description"}),i.jsx("textarea",{value:a.description,onChange:U=>k("description",U.target.value),placeholder:"Brief description of what this deck covers...",className:"claude-input w-full h-24 resize-none",maxLength:300}),i.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:[a.description.length,"/300 characters"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),i.jsxs("select",{value:a.subject,onChange:U=>k("subject",U.target.value),className:"claude-input w-full",children:[i.jsx("option",{value:"",children:"Select a subject"}),C.map(U=>i.jsx("option",{value:U,children:U},U))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Difficulty Level"}),i.jsxs("select",{value:a.difficulty,onChange:U=>k("difficulty",U.target.value),className:"claude-input w-full",children:[i.jsx("option",{value:"beginner",children:"Beginner"}),i.jsx("option",{value:"intermediate",children:"Intermediate"}),i.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),i.jsx("input",{type:"text",value:a.tags,onChange:U=>k("tags",U.target.value),placeholder:"e.g. calculus, derivatives, math (comma-separated)",className:"claude-input w-full"}),i.jsx("div",{className:"text-xs claude-text-muted mt-1",children:"Separate tags with commas"})]})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Appearance"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Color"}),i.jsx("div",{className:"flex flex-wrap gap-3",children:b.map(U=>i.jsx("button",{type:"button",onClick:()=>k("color",U),className:`w-12 h-12 rounded-xl border-4 transition-all duration-200 ${a.color===U?"border-white shadow-lg scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:U},title:U},U))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Icon"}),i.jsx("div",{className:"flex flex-wrap gap-3",children:E.map(U=>i.jsx("button",{type:"button",onClick:()=>k("icon",U),className:`w-12 h-12 rounded-xl text-2xl flex items-center justify-center transition-all duration-200 ${a.icon===U?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg scale-110":"claude-card hover:scale-105"}`,title:U,children:U},U))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Preview"}),i.jsxs("div",{className:"claude-card p-6 max-w-xs rounded-2xl shadow-lg",style:{borderLeft:`6px solid ${a.color}`},children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{backgroundColor:a.color,color:"white"},children:a.icon}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold claude-text-primary",children:a.name||"Deck Name"}),i.jsx("p",{className:"text-sm claude-text-muted",children:a.subject||"Subject"})]})]}),a.description&&i.jsx("p",{className:"text-sm claude-text-secondary",children:a.description})]})]})]})]}),i.jsxs("div",{className:"claude-card p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Privacy & Sharing"}),i.jsx("div",{className:"space-y-4",children:i.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:a.isPublic,onChange:U=>k("isPublic",U.target.checked),className:"w-5 h-5 rounded mt-1",style:{accentColor:"var(--claude-accent)",backgroundColor:a.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),i.jsxs("div",{children:[i.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this deck public"}),i.jsx("p",{className:"text-sm claude-text-muted mt-1",children:"Public decks can be discovered and imported by other users. You need a profile to create public decks."})]})]})})]}),m&&i.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:i.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[i.jsx("span",{children:""}),i.jsx("span",{children:m})]})}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&i.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),i.jsx("button",{type:"submit",disabled:u||!a.name.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:u||!a.name.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t?"Updating...":"Creating..."]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:t?"":""}),t?"Update Deck":"Create Deck"]})})]})]})]})})},hO=({onCreateDeck:s,onEditDeck:e,onSelectDeck:t})=>{const{user:n}=Rn(),[a,l]=P.useState([]),[u,h]=P.useState(!0),[m,p]=P.useState(""),[x,w]=P.useState(""),[b,E]=P.useState("all");P.useEffect(()=>{n&&C()},[n]);const C=async()=>{try{h(!0),p("");const U=await is.getUserDecks(n.uid);l(U)}catch(U){console.error("Error loading decks:",U),p("Failed to load decks. Please try again.")}finally{h(!1)}},k=async(U,F)=>{if(window.confirm(`Are you sure you want to delete "${F}"? This action cannot be undone.`))try{await is.deleteDeck(U),l(a.filter(B=>B.id!==U))}catch(B){console.error("Error deleting deck:",B),p("Failed to delete deck. Please try again.")}},L=a.filter(U=>{const F=!x||U.name.toLowerCase().includes(x.toLowerCase())||U.description.toLowerCase().includes(x.toLowerCase())||U.subject&&U.subject.toLowerCase().includes(x.toLowerCase()),B=b==="all"||b==="public"&&U.isPublic||b==="private"&&!U.isPublic;return F&&B});return u?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading your decks..."})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" My Decks"}),i.jsx("p",{className:"claude-text-secondary",children:"Organize and manage your flashcard collections"})]}),i.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary mt-4 md:mt-0 flex items-center gap-2",children:[i.jsx("span",{children:""}),"Create New Deck"]})]}),i.jsxs("div",{className:"claude-card p-6 mb-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[i.jsx("div",{className:"flex-1",children:i.jsx("input",{type:"text",value:x,onChange:U=>w(U.target.value),placeholder:"Search decks by name, subject, or description...",className:"claude-input w-full"})}),i.jsx("div",{className:"md:w-48",children:i.jsxs("select",{value:b,onChange:U=>E(U.target.value),className:"claude-input w-full",children:[i.jsx("option",{value:"all",children:"All Decks"}),i.jsx("option",{value:"private",children:"Private Only"}),i.jsx("option",{value:"public",children:"Public Only"})]})})]}),i.jsxs("div",{className:"flex flex-wrap gap-6 mt-4 pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.length}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Total Decks"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.reduce((U,F)=>U+(F.cardCount||0),0)}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Total Cards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.filter(U=>U.isPublic).length}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Public Decks"})]})]})]}),m&&i.jsx("div",{className:"p-4 rounded-2xl mb-6",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:i.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[i.jsx("span",{children:""}),i.jsx("span",{children:m})]})}),L.length===0?i.jsxs("div",{className:"claude-card p-12 text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:x||b!=="all"?"No matching decks found":"No decks yet"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:x||b!=="all"?"Try adjusting your search or filter criteria":"Create your first deck to start organizing your flashcards"}),!x&&b==="all"&&i.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary flex items-center gap-2 mx-auto",children:[i.jsx("span",{children:""}),"Create Your First Deck"]})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:L.map(U=>i.jsx(fO,{deck:U,onEdit:()=>e&&e(U),onDelete:()=>k(U.id,U.name),onSelect:()=>t&&t(U)},U.id))})]})})},fO=({deck:s,onEdit:e,onDelete:t,onSelect:n})=>{const a=l=>l?(l.toDate?l.toDate():new Date(l)).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"Unknown";return i.jsxs("div",{className:"claude-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer relative group",style:{borderLeft:`6px solid ${s.color||"#635BFF"}`},onClick:()=>n&&n(),children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl text-white",style:{backgroundColor:s.color||"#635BFF"},children:s.icon||""}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"font-bold claude-text-primary truncate",children:s.name}),i.jsx("p",{className:"text-sm claude-text-muted",children:s.subject||"No subject"})]})]}),i.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:l=>{l.stopPropagation(),e()},className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 hover:text-gray-800",title:"Edit deck",children:""}),!s.isDefault&&i.jsx("button",{onClick:l=>{l.stopPropagation(),t()},className:"p-2 rounded-lg hover:bg-red-100 text-red-600 hover:text-red-800",title:"Delete deck",children:""})]})})]}),s.description&&i.jsx("p",{className:"text-sm claude-text-secondary mb-4 line-clamp-2",children:s.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm claude-text-muted mb-4",children:[i.jsxs("span",{children:[s.cardCount||0," cards"]}),i.jsx("span",{children:s.difficulty||"Mixed"})]}),s.tags&&s.tags.length>0&&i.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[s.tags.slice(0,3).map((l,u)=>i.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${s.color||"#635BFF"}20`,color:s.color||"#635BFF"},children:l},u)),s.tags.length>3&&i.jsxs("span",{className:"px-2 py-1 rounded-full text-xs claude-text-muted",children:["+",s.tags.length-3]})]}),i.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[i.jsxs("div",{className:"flex items-center gap-2",children:[s.isPublic&&i.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700",children:"Public"}),s.isDefault&&i.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700",children:"Default"})]}),i.jsx("span",{className:"text-xs claude-text-muted",children:a(s.updatedAt||s.createdAt)})]})]})},mO=({onClose:s})=>{const{user:e}=Rn(),[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState("week"),[m,p]=P.useState(!0),[x,w]=P.useState("overview");P.useEffect(()=>{e&&b()},[e,u]);const b=async()=>{try{p(!0);const[k,L]=await Promise.all([Vd.getUserAnalytics(e.uid),Vd.getUserInsights(e.uid,u)]);n(k),l(L)}catch(k){console.error("Error loading analytics:",k)}finally{p(!1)}},E=k=>{const L=Math.floor(k/3600),U=Math.floor(k%3600/60);return L>0?`${L}h ${U}m`:`${U}m`},C=k=>`${Math.round(k*100)}%`;return m?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading your analytics..."})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" Learning Analytics"}),i.jsx("p",{className:"claude-text-secondary",children:"Track your progress, identify patterns, and optimize your learning"})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[i.jsxs("select",{value:u,onChange:k=>h(k.target.value),className:"claude-input",children:[i.jsx("option",{value:"day",children:"Today"}),i.jsx("option",{value:"week",children:"This Week"}),i.jsx("option",{value:"month",children:"This Month"})]}),s&&i.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close"})]})]}),i.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"performance",label:" Performance",icon:""},{id:"insights",label:" Insights",icon:""},{id:"progress",label:" Progress",icon:""}].map(k=>i.jsxs("button",{onClick:()=>w(k.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===k.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[i.jsx("span",{className:"mr-2",children:k.icon}),i.jsx("span",{className:"hidden sm:inline",children:k.label.replace(/^.+\s/,"")})]},k.id))}),x==="overview"&&i.jsx(gO,{analytics:t,insights:a,formatTime:E,formatPercentage:C}),x==="performance"&&i.jsx(pO,{analytics:t,insights:a,formatPercentage:C}),x==="insights"&&i.jsx(yO,{insights:a,formatTime:E}),x==="progress"&&i.jsx(xO,{analytics:t,insights:a,formatPercentage:C})]})})},gO=({analytics:s,insights:e,formatTime:t,formatPercentage:n})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Gf,{title:"Total Study Time",value:t(s?.totalStudyTime||0),icon:"",color:"blue",trend:e?.studyTimeTrend}),i.jsx(Gf,{title:"Study Sessions",value:s?.totalSessions||0,icon:"",color:"green"}),i.jsx(Gf,{title:"Overall Accuracy",value:n(s?.overallAccuracy||0),icon:"",color:"purple",trend:e?.accuracyTrend}),i.jsx(Gf,{title:"Study Streak",value:`${s?.studyStreak||0} days`,icon:"",color:"orange"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),i.jsxs("div",{className:"space-y-4",children:[s?.deckStats&&Object.entries(s.deckStats).slice(0,5).map(([a,l])=>i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",children:["Deck ",a.slice(-6)]}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[l.sessions," sessions"]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-bold text-green-600",children:n(l.accuracy)}),i.jsx("div",{className:"text-sm claude-text-muted",children:t(l.studyTime)})]})]},a)),(!s?.deckStats||Object.keys(s.deckStats).length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No study activity yet. Start studying to see your progress!"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Performance Trends"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(JT,{label:"Accuracy Trend",value:e?.accuracyTrend||0,description:"How your accuracy has changed recently"}),i.jsx(JT,{label:"Study Time Trend",value:e?.studyTimeTrend||0,description:"How your study duration has changed"}),i.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[i.jsx("div",{className:"font-medium text-blue-800",children:"Mastery Progress"}),i.jsxs("div",{className:"text-sm text-blue-600 mb-2",children:["Overall understanding: ",n(e?.masteryProgress||0)]}),i.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:i.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(e?.masteryProgress||0)*100}%`}})})]})]})]})]})]}),pO=({analytics:s,insights:e,formatPercentage:t})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Subject Performance"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s?.subjectStats&&Object.entries(s.subjectStats).map(([n,a])=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsx("div",{className:"font-medium mb-2",children:n||"General"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm claude-text-muted",children:"Accuracy:"}),i.jsx("span",{className:"font-medium",children:t(a.accuracy)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm claude-text-muted",children:"Mastery:"}),i.jsx("span",{className:"font-medium",children:t(a.masteryLevel||0)})]}),i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${a.accuracy*100}%`}})})]})]},n)),(!s?.subjectStats||Object.keys(s.subjectStats).length===0)&&i.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"No subject data available yet. Study more to see subject breakdown!"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Cards Needing Attention"}),i.jsx("div",{className:"space-y-4",children:e?.strugglingCards&&e.strugglingCards.length>0?e.strugglingCards.map((n,a)=>i.jsxs("div",{className:"flex items-center justify-between p-4 border-l-4 border-red-500 bg-red-50",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",children:["Card ",n.cardId.slice(-6)]}),i.jsxs("div",{className:"text-sm text-red-600",children:[n.totalReviews," attempts"]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-red-700 font-bold",children:t(n.accuracy)}),i.jsx("div",{className:"text-sm text-red-600",children:"accuracy"})]})]},n.cardId)):i.jsx("div",{className:"text-center py-8 text-green-600",children:" Great job! No cards need special attention right now."})})]})]}),yO=({insights:s,formatTime:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Personalized Recommendations"}),i.jsx("div",{className:"space-y-4",children:s?.recommendations&&s.recommendations.length>0?s.recommendations.map((t,n)=>i.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${t.priority==="high"?"border-red-500 bg-red-50":t.priority==="medium"?"border-yellow-500 bg-yellow-50":"border-blue-500 bg-blue-50"}`,children:[i.jsx("div",{className:`font-medium ${t.priority==="high"?"text-red-800":t.priority==="medium"?"text-yellow-800":"text-blue-800"}`,children:t.title}),i.jsx("div",{className:`text-sm mt-1 ${t.priority==="high"?"text-red-600":t.priority==="medium"?"text-yellow-600":"text-blue-600"}`,children:t.description})]},n)):i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"Keep studying to get personalized recommendations!"})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Optimal Study Time"}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:s?.optimalStudyTime==="morning"?"":s?.optimalStudyTime==="afternoon"?"":""}),i.jsx("div",{className:"text-lg font-medium capitalize",children:s?.optimalStudyTime||"Not enough data"}),i.jsx("div",{className:"text-sm claude-text-muted mt-2",children:"You perform best during this time"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Consistency Score"}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:[Math.round((s?.consistencyScore||0)*100),"%"]}),i.jsx("div",{className:"text-sm claude-text-muted",children:"How consistent your study sessions are"}),i.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-3",children:i.jsx("div",{className:"claude-gradient h-3 rounded-full transition-all duration-300",style:{width:`${(s?.consistencyScore||0)*100}%`}})})]})]})]})]}),xO=({analytics:s,insights:e,formatPercentage:t})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Learning Progress"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-success)"},children:t(e?.masteryProgress||0)}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Overall Mastery"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:s?.studyStreak||0}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Day Streak"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-warning)"},children:s?.longestStreak||0}),i.jsx("div",{className:"text-sm claude-text-muted",children:"Longest Streak"})]})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Your Strongest Subjects"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e?.strongSubjects&&e.strongSubjects.length>0?e.strongSubjects.map((n,a)=>i.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border-2 border-green-200",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"font-medium text-green-800",children:n}),i.jsx("div",{className:"text-sm text-green-600",children:"Strong performance"})]},n)):i.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"Keep studying to identify your strongest subjects!"})})]})]}),Gf=({title:s,value:e,icon:t,color:n,trend:a})=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl relative overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"text-2xl",children:t}),a!==void 0&&i.jsxs("div",{className:`text-sm font-medium ${a>0?"text-green-600":a<0?"text-red-600":"text-gray-600"}`,children:[a>0?"":a<0?"":""," ",Math.abs(a*100).toFixed(1),"%"]})]}),i.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),i.jsx("div",{className:"text-sm claude-text-muted",children:s})]}),JT=({label:s,value:e,description:t})=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:s}),i.jsx("div",{className:"text-sm claude-text-muted",children:t})]}),i.jsxs("div",{className:`text-right ${e>0?"text-green-600":e<0?"text-red-600":"text-gray-600"}`,children:[i.jsxs("div",{className:"font-bold",children:[e>0?"":e<0?"":""," ",Math.abs(e*100).toFixed(1),"%"]}),i.jsx("div",{className:"text-sm",children:e>0?"Improving":e<0?"Declining":"Stable"})]})]});class Bn{static async initializeSession(e=null){try{const t=this.generateSessionId(),n={sessionId:t,userId:e||null,startTime:Pe(),isActive:!0,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},referrer:document.referrer||null,initialUrl:window.location.href,pageViews:0,clicks:0,timeSpent:0,pagesVisited:[],actionsPerformed:[],isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isTablet:/iPad/i.test(navigator.userAgent),platform:navigator.platform};if(await Rs(ve(ee,"websiteSessions",t),n),localStorage.setItem("website_session_id",t),Sn)try{sa(Sn,"session_start",{session_id:t,user_id:e,is_mobile:n.isMobile})}catch(a){console.warn("Firebase Analytics not available:",a)}return this.setupVisibilityTracking(t),this.setupUnloadTracking(t),t}catch(t){throw console.error("Error initializing session:",t),t}}static async trackPageView(e,t=null,n=null){try{const a=t||localStorage.getItem("website_session_id");if(!a)return;const l={sessionId:a,userId:n||null,page:e,url:window.location.href,timestamp:Pe(),referrer:document.referrer||null,timeOnPage:0,scrollDepth:0,interactions:0},u=await Ys(Ce(ee,"pageViews"),l),h=ve(ee,"websiteSessions",a);if(await $t(h,{pageViews:cm(1),pagesVisited:Qc(e),lastPageView:Pe(),currentPage:e}),Sn)try{sa(Sn,"page_view",{page_title:document.title,page_location:window.location.href,session_id:a,user_id:n})}catch(m){console.warn("Firebase Analytics not available:",m)}return this.startPageTimeTracking(u.id,a),u.id}catch(a){console.error("Error tracking page view:",a)}}static async trackInteraction(e,t=null,n=null){try{const a=t||localStorage.getItem("website_session_id");if(!a)return;const l={sessionId:a,userId:n||null,timestamp:Pe(),page:window.location.pathname,...e};await Ys(Ce(ee,"interactions"),l);const u=ve(ee,"websiteSessions",a);if(await $t(u,{clicks:cm(1),actionsPerformed:Qc(e.action||"unknown"),lastActivity:Pe()}),Sn)try{sa(Sn,"user_interaction",{action:e.action,element:e.element,session_id:a,user_id:n})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(a){console.error("Error tracking interaction:",a)}}static async trackScrollDepth(e,t=null){try{const n=t||localStorage.getItem("website_session_id");if(!n)return;const a=Le(Ce(ee,"pageViews"),Ye("sessionId","==",n),Jt("timestamp","desc"),Zt(1)),l=await Ke(a);if(!l.empty){const u=l.docs[0];await $t(u.ref,{scrollDepth:Math.max(e,u.data().scrollDepth||0)})}}catch(n){if(n.message&&(n.message.includes("requires an index")||n.message.includes("Missing or insufficient permissions")||n.message.includes("permission-denied")))return;console.error("Error tracking scroll depth:",n)}}static async trackFeatureUsage(e,t,n={},a=null){try{const l=localStorage.getItem("website_session_id"),u={sessionId:l,userId:a||null,feature:e,action:t,metadata:n,timestamp:Pe(),page:window.location.pathname};if(await Ys(Ce(ee,"featureUsage"),u),Sn)try{sa(Sn,"feature_usage",{feature_name:e,action_type:t,session_id:l,user_id:a})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(l){console.error("Error tracking feature usage:",l)}}static async trackConversion(e,t=null,n=null){try{const a=localStorage.getItem("website_session_id"),l={sessionId:a,userId:n||null,conversionType:e,value:t,timestamp:Pe(),page:window.location.pathname};if(await Ys(Ce(ee,"conversions"),l),Sn)try{sa(Sn,"conversion",{conversion_type:e,conversion_value:t,session_id:a,user_id:n})}catch(u){console.warn("Firebase Analytics not available:",u)}}catch(a){console.error("Error tracking conversion:",a)}}static async trackUserFlow(e,t,n="navigation",a=null){try{const u={sessionId:localStorage.getItem("website_session_id"),userId:a||null,fromPage:e,toPage:t,action:n,timestamp:Pe()};await Ys(Ce(ee,"userFlows"),u)}catch(l){console.error("Error tracking user flow:",l)}}static async trackClick(e,t={},n=null){try{await this.trackInteraction({action:"click",element:e,context:t,elementText:t.text||"",elementId:t.id||"",elementClass:t.className||""},null,n)}catch(a){console.error("Error tracking click:",a)}}static async trackFormInteraction(e,t,n=null,a=null){try{await this.trackInteraction({action:"form_interaction",element:"form",formName:e,formAction:t,field:n},null,a)}catch(l){console.error("Error tracking form interaction:",l)}}static startPageTimeTracking(e,t){window.pageTimeTracking||(window.pageTimeTracking={}),window.pageTimeTracking[e]={startTime:Date.now(),sessionId:t,pageViewId:e}}static async endPageTimeTracking(e){try{if(!window.pageTimeTracking||!window.pageTimeTracking[e])return;const t=window.pageTimeTracking[e],n=Math.round((Date.now()-t.startTime)/1e3),a=ve(ee,"pageViews",e);await $t(a,{timeOnPage:n});const l=ve(ee,"websiteSessions",t.sessionId);await $t(l,{timeSpent:cm(n)}),delete window.pageTimeTracking[e]}catch(t){console.error("Error ending page time tracking:",t)}}static async endSession(e=null){try{const t=e||localStorage.getItem("website_session_id");if(!t)return;if(window.pageTimeTracking)for(const a of Object.keys(window.pageTimeTracking))await this.endPageTimeTracking(a);const n=ve(ee,"websiteSessions",t);if(await $t(n,{endTime:Pe(),isActive:!1}),localStorage.removeItem("website_session_id"),Sn)try{sa(Sn,"session_end",{session_id:t})}catch(a){console.warn("Firebase Analytics not available:",a)}}catch(t){console.error("Error ending session:",t)}}static async getAnalyticsSummary(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),a=Le(Ce(ee,"websiteSessions"),Ye("startTime",">=",n)),u=(await Ke(a)).docs.map(M=>({id:M.id,...M.data()})),h=Le(Ce(ee,"pageViews"),Ye("timestamp",">=",n)),p=(await Ke(h)).docs.map(M=>({id:M.id,...M.data()})),x=Le(Ce(ee,"interactions"),Ye("timestamp",">=",n)),b=(await Ke(x)).docs.map(M=>({id:M.id,...M.data()})),E=new Set(u.filter(M=>M.userId).map(M=>M.userId)).size,C=u.length,k=p.length,L=b.length,U=u.reduce((M,R)=>M+(R.timeSpent||0),0)/u.length,F=k/C,B={};p.forEach(M=>{const R=M.page||"unknown";B[R]||(B[R]={views:0,totalTime:0,interactions:0}),B[R].views++,B[R].totalTime+=M.timeOnPage||0}),b.forEach(M=>{const R=M.page||"unknown";B[R]&&B[R].interactions++});const H=Object.entries(B).map(([M,R])=>({page:M,...R,avgTimeOnPage:R.totalTime/R.views})).sort((M,R)=>R.views-M.views).slice(0,10),$={mobile:u.filter(M=>M.isMobile).length,tablet:u.filter(M=>M.isTablet).length,desktop:u.filter(M=>!M.isMobile&&!M.isTablet).length};return{summary:{uniqueUsers:E,totalSessions:C,totalPageViews:k,totalInteractions:L,avgSessionDuration:Math.round(U),avgPagesPerSession:Math.round(F*10)/10},popularPages:H,deviceStats:$,sessions:u,timeframe:e}}catch(t){throw console.error("Error getting analytics summary:",t),t}}static async getUserJourneyAnalytics(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),a=Le(Ce(ee,"userFlows"),Ye("timestamp",">=",n)),u=(await Ke(a)).docs.map(w=>({id:w.id,...w.data()})),h={};u.forEach(w=>{const b=`${w.fromPage}  ${w.toPage}`;h[b]=(h[b]||0)+1});const m=Object.entries(h).map(([w,b])=>({path:w,count:b})).sort((w,b)=>b.count-w.count).slice(0,10),p={},x={};return u.forEach(w=>{p[w.fromPage]=(p[w.fromPage]||0)+1,x[w.toPage]=(x[w.toPage]||0)+1}),{commonPaths:m,entryPoints:Object.entries(p).map(([w,b])=>({page:w,count:b})).sort((w,b)=>b.count-w.count).slice(0,5),exitPoints:Object.entries(x).map(([w,b])=>({page:w,count:b})).sort((w,b)=>b.count-w.count).slice(0,5)}}catch(t){throw console.error("Error getting user journey analytics:",t),t}}static generateSessionId(){return`ws_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static setupVisibilityTracking(e){let t=!document.hidden,n=Date.now();const a=()=>{const l=Date.now();if(document.hidden&&t){const u=l-n;this.trackInteraction({action:"page_hidden",element:"page",timeVisible:u},e),t=!1}else!document.hidden&&!t&&(this.trackInteraction({action:"page_visible",element:"page"},e),t=!0,n=l)};document.addEventListener("visibilitychange",a)}static setupUnloadTracking(e){const t=()=>{this.endSession(e)};window.addEventListener("beforeunload",t)}static setupScrollTracking(){let e=0,t;const n=()=>{const a=window.pageYOffset||document.documentElement.scrollTop,l=document.documentElement.scrollHeight-window.innerHeight,u=l>0?a/l*100:0;e=Math.max(e,u),clearTimeout(t),t=setTimeout(()=>{this.trackScrollDepth(Math.round(e))},1e3)};window.addEventListener("scroll",n,{passive:!0})}static setupAutoClickTracking(){document.addEventListener("click",e=>{const t=e.target.closest("[data-track]");if(t){const n={action:t.getAttribute("data-track"),text:t.textContent.trim(),id:t.id,className:t.className};this.trackClick(t.tagName.toLowerCase(),n)}})}static initializeAutoTracking(e=null){this.initializeSession(e),this.setupScrollTracking(),this.setupAutoClickTracking(),setTimeout(()=>{this.trackPageView(window.location.pathname,null,e)},100)}}const vO=({onClose:s})=>{const{user:e}=Rn(),[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState("week"),[m,p]=P.useState(!0),[x,w]=P.useState("overview"),[b,E]=P.useState({activeSessions:0,currentPageViews:0,recentInteractions:[]});P.useEffect(()=>{if(e){C();const U=setInterval(C,3e4);return()=>clearInterval(U)}},[e,u]);const C=async()=>{try{p(!0);const[U,F]=await Promise.all([Bn.getAnalyticsSummary(u),Bn.getUserJourneyAnalytics(u)]);n(U),l(F);const B=U.sessions.filter($=>$.isActive).length,H=U.sessions.flatMap($=>$.actionsPerformed||[]).slice(-10);E({activeSessions:B,currentPageViews:U.summary.totalPageViews,recentInteractions:H})}catch(U){console.error("Error loading analytics:",U)}finally{p(!1)}},k=U=>{const F=Math.floor(U/3600),B=Math.floor(U%3600/60),H=U%60;return F>0?`${F}h ${B}m ${H}s`:B>0?`${B}m ${H}s`:`${H}s`},L=U=>`${Math.round(U*100)}%`;return m?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Loading website analytics..."})]})}):i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" Website Analytics"}),i.jsx("p",{className:"claude-text-secondary",children:"Track growth, engagement, and user behavior across your platform"})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[i.jsxs("select",{value:u,onChange:U=>h(U.target.value),className:"claude-input",children:[i.jsx("option",{value:"day",children:"Today"}),i.jsx("option",{value:"week",children:"This Week"}),i.jsx("option",{value:"month",children:"This Month"})]}),i.jsx("button",{onClick:C,className:"claude-button-secondary",children:" Refresh"}),s&&i.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close"})]})]}),i.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-6",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),i.jsx("span",{className:"font-medium",children:"Live Now"})]}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[b.activeSessions," active sessions  ",b.currentPageViews," page views today"]})]}),i.jsxs("div",{className:"text-xs claude-text-muted",children:["Last updated: ",new Date().toLocaleTimeString()]})]})}),i.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"traffic",label:" Traffic",icon:""},{id:"engagement",label:" Engagement",icon:""},{id:"journeys",label:" User Journeys",icon:""},{id:"realtime",label:" Real-time",icon:""}].map(U=>i.jsxs("button",{onClick:()=>w(U.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===U.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[i.jsx("span",{className:"mr-2",children:U.icon}),i.jsx("span",{className:"hidden sm:inline",children:U.label.replace(/^.+\s/,"")})]},U.id))}),x==="overview"&&i.jsx(bO,{analytics:t,formatDuration:k,formatPercentage:L}),x==="traffic"&&i.jsx(wO,{analytics:t,formatDuration:k}),x==="engagement"&&i.jsx(_O,{analytics:t,formatDuration:k}),x==="journeys"&&i.jsx(NO,{userJourney:a}),x==="realtime"&&i.jsx(TO,{realTimeData:b,analytics:t})]})})},bO=({analytics:s,formatDuration:e,formatPercentage:t})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Pr,{title:"Unique Users",value:s?.summary?.uniqueUsers||0,icon:"",color:"blue",description:"Distinct users this period"}),i.jsx(Pr,{title:"Total Sessions",value:s?.summary?.totalSessions||0,icon:"",color:"green",description:"User sessions tracked"}),i.jsx(Pr,{title:"Page Views",value:s?.summary?.totalPageViews||0,icon:"",color:"purple",description:"Total pages visited"}),i.jsx(Pr,{title:"Avg Session Duration",value:e(s?.summary?.avgSessionDuration||0),icon:"",color:"orange",description:"Average time per session"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Popular Pages"}),i.jsxs("div",{className:"space-y-4",children:[s?.popularPages?.slice(0,8).map((n,a)=>i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-bold text-blue-800",children:a+1}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:n.page}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[n.views," views"]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-bold text-blue-600",children:e(n.avgTimeOnPage||0)}),i.jsx("div",{className:"text-sm claude-text-muted",children:"avg time"})]})]},n.page)),(!s?.popularPages||s.popularPages.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No page data available yet"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Device Breakdown"}),i.jsx("div",{className:"space-y-4",children:s?.deviceStats&&Object.entries(s.deviceStats).map(([n,a])=>{const l=Object.values(s.deviceStats).reduce((m,p)=>m+p,0),u=l>0?a/l*100:0,h=n==="mobile"?"":n==="tablet"?"":"";return i.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:h}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium capitalize",children:n}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[a," sessions"]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("div",{className:"font-bold text-green-600",children:[Math.round(u),"%"]}),i.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2 mt-1",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})]})]},n)})})]})]})]}),wO=({analytics:s,formatDuration:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsx(Pr,{title:"Pages per Session",value:s?.summary?.avgPagesPerSession||0,icon:"",color:"blue",description:"Average pages viewed per session"}),i.jsx(Pr,{title:"Total Interactions",value:s?.summary?.totalInteractions||0,icon:"",color:"green",description:"Total clicks and interactions"}),i.jsx(Pr,{title:"Bounce Rate",value:`${Math.round(((s?.summary?.totalSessions-s?.summary?.totalPageViews)/s?.summary?.totalSessions||0)*100)}%`,icon:"",color:"orange",description:"Single page sessions"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Detailed Page Analytics"}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b",children:[i.jsx("th",{className:"text-left py-3 px-4 font-medium claude-text-secondary",children:"Page"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Views"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Avg Time"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Interactions"}),i.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Engagement"})]})}),i.jsx("tbody",{children:s?.popularPages?.map((t,n)=>{const a=t.views>0?t.interactions/t.views*100:0;return i.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[i.jsx("td",{className:"py-3 px-4",children:i.jsx("div",{className:"font-medium",children:t.page})}),i.jsx("td",{className:"text-right py-3 px-4 font-medium",children:t.views}),i.jsx("td",{className:"text-right py-3 px-4",children:e(t.avgTimeOnPage||0)}),i.jsx("td",{className:"text-right py-3 px-4",children:t.interactions}),i.jsx("td",{className:"text-right py-3 px-4",children:i.jsxs("span",{className:`font-medium ${a>50?"text-green-600":a>20?"text-yellow-600":"text-red-600"}`,children:[Math.round(a),"%"]})})]},t.page)})})]})})]})]}),_O=({analytics:s,formatDuration:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Pr,{title:"Click Rate",value:`${Math.round((s?.summary?.totalInteractions/s?.summary?.totalPageViews||0)*100)}%`,icon:"",color:"blue",description:"Interactions per page view"}),i.jsx(Pr,{title:"Session Depth",value:s?.summary?.avgPagesPerSession||0,icon:"",color:"green",description:"Pages explored per session"}),i.jsx(Pr,{title:"Return Rate",value:`${Math.round((s?.summary?.uniqueUsers/s?.summary?.totalSessions||0)*100)}%`,icon:"",color:"purple",description:"Users who return"}),i.jsx(Pr,{title:"Engagement Score",value:Math.round((s?.summary?.avgSessionDuration||0)/60*(s?.summary?.avgPagesPerSession||0)),icon:"",color:"orange",description:"Overall engagement rating"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Engaging Content"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s?.popularPages?.slice(0,6).map((t,n)=>{const a=(t.avgTimeOnPage||0)*(t.interactions||0)/100;return i.jsxs("div",{className:"p-4 border rounded-lg hover:border-blue-500 transition-colors",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("h4",{className:"font-medium",children:t.page}),i.jsxs("span",{className:"text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["#",n+1]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Time on Page"}),i.jsx("div",{className:"font-medium",children:e(t.avgTimeOnPage||0)})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Interactions"}),i.jsx("div",{className:"font-medium",children:t.interactions||0})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Views"}),i.jsx("div",{className:"font-medium",children:t.views})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Engagement"}),i.jsx("div",{className:"font-medium text-green-600",children:Math.round(a)})]})]})]},t.page)})})]})]}),NO=({userJourney:s})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Common User Paths"}),i.jsxs("div",{className:"space-y-4",children:[s?.commonPaths?.slice(0,8).map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-800",children:t+1}),i.jsx("div",{className:"font-mono text-sm",children:e.path})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"font-bold text-purple-600",children:e.count}),i.jsx("div",{className:"text-sm claude-text-muted",children:"transitions"})]})]},e.path)),(!s?.commonPaths||s.commonPaths.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No user journey data available yet"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Top Entry Points"}),i.jsxs("div",{className:"space-y-3",children:[s?.entryPoints?.map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[i.jsx("div",{className:"font-medium",children:e.page}),i.jsx("div",{className:"text-green-700 font-bold",children:e.count})]},e.page)),(!s?.entryPoints||s.entryPoints.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No entry data"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Top Exit Points"}),i.jsxs("div",{className:"space-y-3",children:[s?.exitPoints?.map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[i.jsx("div",{className:"font-medium",children:e.page}),i.jsx("div",{className:"text-red-700 font-bold",children:e.count})]},e.page)),(!s?.exitPoints||s.exitPoints.length===0)&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No exit data"})]})]})]})]}),TO=({realTimeData:s,analytics:e})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full animate-pulse"}),i.jsx("h3",{className:"font-bold text-green-800",children:"Active Now"})]}),i.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:s.activeSessions}),i.jsx("div",{className:"text-sm text-green-700",children:"Active sessions"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"font-bold text-blue-800",children:"Page Views"})]}),i.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:s.currentPageViews}),i.jsx("div",{className:"text-sm text-blue-700",children:"Total today"})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"font-bold text-purple-800",children:"Interactions"})]}),i.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:e?.summary?.totalInteractions||0}),i.jsx("div",{className:"text-sm text-purple-700",children:"Total clicks"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),i.jsxs("div",{className:"space-y-3",children:[s.recentInteractions.slice(0,10).map((t,n)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),i.jsx("span",{className:"font-medium",children:t})]}),i.jsx("span",{className:"text-sm claude-text-muted",children:"Just now"})]},n)),s.recentInteractions.length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No recent interactions"})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Active Sessions Detail"}),i.jsxs("div",{className:"space-y-4",children:[e?.sessions?.filter(t=>t.isActive).slice(0,5).map((t,n)=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"font-medium",children:["Session ",t.sessionId.slice(-6)]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),i.jsx("span",{className:"text-sm text-green-600",children:"Active"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Device"}),i.jsx("div",{children:t.isMobile?" Mobile":t.isTablet?" Tablet":" Desktop"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Page Views"}),i.jsx("div",{children:t.pageViews||0})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Duration"}),i.jsxs("div",{children:[Math.round((t.timeSpent||0)/60),"m"]})]}),i.jsxs("div",{children:[i.jsx("div",{className:"claude-text-muted",children:"Current Page"}),i.jsx("div",{className:"truncate",children:t.currentPage||"Unknown"})]})]})]},t.sessionId)),e?.sessions?.filter(t=>t.isActive).length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No active sessions"})]})]})]}),Pr=({title:s,value:e,icon:t,color:n,description:a})=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("div",{className:"flex items-center justify-between mb-4",children:i.jsx("div",{className:"text-2xl",children:t})}),i.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),i.jsx("div",{className:"text-sm font-medium mb-1",children:s}),a&&i.jsx("div",{className:"text-xs claude-text-muted",children:a})]}),EO=()=>i.jsx("div",{className:"min-h-screen bg-[#F6F5EC] p-8",children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("h1",{className:"text-4xl font-bold mb-8",style:{color:"var(--claude-heading)"},children:" Icon System Test"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Size Variants"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:16,color:"default"}),i.jsx("span",{children:"16px - Small"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:20,color:"default"}),i.jsx("span",{children:"20px - Medium"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"default"}),i.jsx("span",{children:"24px - Large"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Color Variants"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"default"}),i.jsx("span",{children:"Default (#606164)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"primary"}),i.jsx("span",{children:"Primary (#635BFF)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"secondary"}),i.jsx("span",{children:"Secondary (#445AFF)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"success"}),i.jsx("span",{children:"Success (#5BC8A2)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"warning"}),i.jsx("span",{children:"Warning (#FFD554)"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(dn,{size:24,color:"error"}),i.jsx("span",{children:"Error (#FF6363)"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Usage Examples"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[i.jsx(dn,{size:20,color:"primary"}),i.jsx("span",{children:"Active Tab"})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[i.jsx(dn,{size:20,color:"default"}),i.jsx("span",{children:"Inactive Tab"})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[i.jsx(dn,{size:24,color:"default"}),i.jsx("span",{children:"Section Header"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card md:col-span-2 lg:col-span-3",children:[i.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:"Before vs After"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2 text-red-600",children:"Before (Emoji)"}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("span",{children:"Dashboard Overview"})]}),i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Inconsistent rendering across devices and browsers"})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium mb-2 text-green-600",children:"After (SVG Icon)"}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[i.jsx(dn,{size:24,color:"primary"}),i.jsx("span",{children:"Dashboard Overview"})]}),i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Consistent, scalable, and matches your design theme"})]})]})]})]}),i.jsxs("div",{className:"mt-8 space-y-8",children:[i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 1 - Critical Icons (10/10) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(dn,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Dashboard"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Ec,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"User"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(qa,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Cards"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Fi,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Edit"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(C1,{size:20,color:"error"}),i.jsx("span",{className:"text-sm",children:"Delete"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(xc,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"View"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(R1,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"AI/Bot"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(hm,{size:20,color:"success"}),i.jsx("span",{className:"text-sm",children:"Success"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(C5,{size:20,color:"error"}),i.jsx("span",{className:"text-sm",children:"Error"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(R5,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Warning"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 2 - Important Icons (10/10) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(k5,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Hint"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(D5,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Proof"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(P5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Brain"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(fm,{size:24,color:"success"}),i.jsx("span",{className:"text-sm",children:"Target"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(M5,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Time"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(vc,{size:20,color:"success"}),i.jsx("span",{className:"text-sm",children:"Progress"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(O5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Refresh"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(V5,{size:20,color:"secondary"}),i.jsx("span",{className:"text-sm",children:"Tags"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(k1,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Math"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(L5,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Mobile"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 3 - Nice to Have Icons (8/8) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(F5,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Desktop"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(U5,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Pause"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(D1,{size:16,color:"error"}),i.jsx("span",{className:"text-sm",children:"Heart"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(B5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Support"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(q5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Save"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(z5,{size:24,color:"default"}),i.jsx("span",{className:"text-sm",children:"Map"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(H5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Click"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Gm,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Launch"})]})]})]}),i.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-6",style:{color:"var(--claude-heading)"},children:"Phase 3+ Extension - Comprehensive Icons (11/11) "}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(G5,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Fast"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Ld,{size:20,color:"warning"}),i.jsx("span",{className:"text-sm",children:"Trophy"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx($5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Palette"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Ii,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Search"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(K5,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Calculator"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Q5,{size:20,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Microscope"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(Y5,{size:20,color:"success"}),i.jsx("span",{className:"text-sm",children:"Graduation"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(P1,{size:20,color:"default"}),i.jsx("span",{className:"text-sm",children:"Book"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(X5,{size:24,color:"success"}),i.jsx("span",{className:"text-sm",children:"Analytics"})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx(M1,{size:24,color:"primary"}),i.jsx("span",{className:"text-sm",children:"Social"})]})]})]}),i.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-2xl",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",style:{color:"var(--claude-heading)"},children:" ULTIMATE ICON SYSTEM - 39 ICONS COMPLETE!"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{children:"39 Professional Icons -  Complete"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{children:"110+ SVG Assets -  Created"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{children:"All React Components -  Ready"})]})]}),i.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-4 gap-4 text-sm bg-white/50 rounded-lg p-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-green-600",children:"10"}),i.jsx("div",{className:"text-gray-600",children:"Critical Icons"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-blue-600",children:"10"}),i.jsx("div",{className:"text-gray-600",children:"Important Icons"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-purple-600",children:"8"}),i.jsx("div",{className:"text-gray-600",children:"Nice-to-Have Icons"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-lg font-bold text-orange-600",children:"11"}),i.jsx("div",{className:"text-gray-600",children:"Extension Icons"})]})]}),i.jsx("p",{className:"mt-4 text-gray-700",children:"Your comprehensive professional icon system is now complete with 39 icons covering every use case! Each icon is scalable, consistent, and matches your Claude theme perfectly. From critical UI elements to specialized features like learning analytics, scientific tools, and social community features - you have everything you need to replace emojis throughout your React application."})]})]})]})});class Cr{static ADMIN_EMAILS=["three.dash.sided@gmail.com"];static isAdmin(e){return!e||!e.email?!1:this.ADMIN_EMAILS.includes(e.email)}static async getAdminStatus(e){try{const n=(await vt(ve(ee,"users",e))).data();return{isAdmin:n?.isAdmin||!1,adminLevel:n?.adminLevel||"none",permissions:n?.adminPermissions||[]}}catch(t){return console.error("Error getting admin status:",t),{isAdmin:!1,adminLevel:"none",permissions:[]}}}static async verifyAdminAccess(e){return!e||!this.isAdmin(e)?!1:(await this.getAdminStatus(e.uid)).isAdmin}static async getAllUsers(e=100){try{const t=Le(Ce(ee,"users"),Jt("createdAt","desc"),Zt(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await vt(l(ee,"profiles",l.id));m.exists()&&(h=m.data())}catch{console.warn("Could not load profile for user:",l.id)}a.push({id:l.id,...u,profile:h,displayName:h.displayName||u.displayName||u.email?.split("@")[0]||"Unknown",joinDate:u.createdAt?.toDate?.()||new Date,lastSeen:u.lastLogin?.toDate?.()||u.createdAt?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting all users:",t),t}}static async updateUserPremium(e,t){try{return await $t(ve(ee,"users",e),{isPremium:t,premiumUpdatedAt:new Date,premiumUpdatedBy:"admin"}),!0}catch(n){throw console.error("Error updating user premium status:",n),n}}static async updateUserAdmin(e,t,n="admin"){try{const a={isAdmin:t,adminUpdatedAt:new Date,adminUpdatedBy:"super_admin"};return t?(a.adminLevel=n,a.adminPermissions=this.getDefaultPermissions(n)):(a.adminLevel="none",a.adminPermissions=[]),await $t(ve(ee,"users",e),a),!0}catch(a){throw console.error("Error updating user admin status:",a),a}}static getDefaultPermissions(e){switch(e){case"super":return["user_management","content_moderation","system_settings","analytics_access","data_export","admin_management"];case"admin":return["user_management","content_moderation","analytics_access"];case"moderator":return["content_moderation"];default:return[]}}static async getPublicCardsForModeration(e=50){try{const t=Le(Ce(ee,"publicCards"),Jt("createdAt","desc"),Zt(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{if(u.userId){const m=await vt(l(ee,"users",u.userId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}}catch{console.warn("Could not load author info for card:",l.id)}a.push({id:l.id,...u,author:h,createdDate:u.createdAt?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting public cards:",t),t}}static async moderateCard(e,t,n=""){try{const a={moderatedAt:new Date,moderatedBy:"admin",moderationAction:t,moderationReason:n};return t==="hide"?a.isHidden=!0:t==="remove"&&(a.isRemoved=!0),await $t(ve(ee,"publicCards",e),a),!0}catch(a){throw console.error("Error moderating card:",a),a}}static async getSystemStats(){try{const[e,t,n]=await Promise.all([Ke(Ce(ee,"users")),Ke(Ce(ee,"cards")),Ke(Ce(ee,"publicCards"))]),a=e.docs.map(C=>C.data()),l=a.length,u=a.filter(C=>C.isPremium).length,h=a.filter(C=>C.isAdmin).length,m=new Date(Date.now()-10080*60*1e3),p=a.filter(C=>C.createdAt?.toDate?.()>m||C.lastLogin?.toDate?.()>m).length,x=t.size,w=n.size,E=n.docs.map(C=>C.data()).filter(C=>C.createdAt?.toDate?.()>m).length;return{users:{total:l,premium:u,admin:h,recentlyActive:p,conversionRate:l>0?(u/l*100).toFixed(1):0},content:{totalPrivateCards:x,totalPublicCards:w,totalCards:x+w,recentPublicCards:E,avgCardsPerUser:l>0?((x+w)/l).toFixed(1):0},system:{lastUpdated:new Date,status:"operational"}}}catch(e){throw console.error("Error getting system stats:",e),e}}static async logAdminAction(e,t,n={}){try{await Ys(Ce(ee,"adminLogs"),{adminUserId:e,action:t,details:n,timestamp:new Date,userAgent:navigator.userAgent,ip:null})}catch(a){console.error("Error logging admin action:",a)}}static async getAdminActivity(e=50){try{const t=Le(Ce(ee,"adminLogs"),Jt("timestamp","desc"),Zt(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await vt(l(ee,"users",u.adminUserId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}catch{console.warn("Could not load admin info for log:",l.id)}a.push({id:l.id,...u,admin:h,timestamp:u.timestamp?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting admin activity:",t),t}}}const SO=()=>{const[s,e]=P.useState([]),[t,n]=P.useState(!1),[a,l]=P.useState(0),[u,h]=P.useState(new Set),m=async()=>{n(!0);try{const C=(await Li(Ua,"findBrokenCards")()).data;e(C.brokenCards||[]),l(C.totalCards||0)}catch(b){console.error("Error finding broken cards:",b),alert(` Failed to find broken cards: ${b.message}`)}finally{n(!1)}},p=async(b,E)=>{if(confirm(`Are you sure you want to delete this card?

ID: ${b}
Slug: ${E||"MISSING"}

This action cannot be undone.`)){h(C=>new Set(C).add(b));try{await Li(Ua,"deleteCard")({cardId:b,cardSlug:E}),e(k=>k.filter(L=>L.id!==b))}catch(C){console.error("Error deleting card:",C),alert(` Failed to delete card: ${C.message}`)}finally{h(C=>{const k=new Set(C);return k.delete(b),k})}}},x=b=>{if(!b)return"Unknown";try{const E=b.toDate?b.toDate():new Date(b);return E.toLocaleDateString()+" "+E.toLocaleTimeString()}catch{return"Invalid date"}},w=async()=>{if(s.length===0||!confirm(` DANGER: Delete ALL ${s.length} broken cards?

This will permanently delete all cards with missing/broken slugs.

This action cannot be undone. Are you absolutely sure?`))return;n(!0);let b=0,E=0;for(const C of s)try{await Li(Ua,"deleteCard")({cardId:C.id,cardSlug:C.slug}),b++}catch(k){console.error(`Failed to delete card ${C.id}:`,k),E++}e([]),n(!1),alert(` Bulk delete completed!

 Deleted: ${b}
 Failed: ${E}`)};return P.useEffect(()=>{m()},[]),i.jsx("div",{className:"space-y-6",children:i.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:" Broken Cards Review"}),i.jsx("button",{onClick:m,disabled:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Searching...":" Refresh"})]}),i.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:i.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a}),i.jsx("div",{className:"text-sm text-gray-600",children:"Total Cards"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.length}),i.jsx("div",{className:"text-sm text-gray-600",children:"Broken Cards"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:a-s.length}),i.jsx("div",{className:"text-sm text-gray-600",children:"Healthy Cards"})]})]})}),s.length>0&&i.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-medium text-yellow-800",children:[" Found ",s.length," broken cards"]}),i.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:'These cards have missing or invalid slugs and show as "undefined" when users try to view them.'})]}),i.jsx("button",{onClick:w,disabled:t,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:" Delete All Broken"})]})}),t&&s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Searching for broken cards..."})]}):s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-4xl mb-2",children:""}),i.jsx("h4",{className:"text-lg font-medium text-green-600 mb-1",children:"No broken cards found!"}),i.jsx("p",{className:"text-gray-600",children:"All cards have valid slugs and are working properly."})]}):i.jsx("div",{className:"space-y-4",children:s.map(b=>i.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded text-red-600",children:["ID: ",b.id]}),i.jsxs("span",{className:"text-sm font-mono bg-red-100 px-2 py-1 rounded text-red-700",children:["Slug: ",b.slug||"MISSING"]}),b.isBotPost&&i.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:" Bot Post"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("strong",{className:"text-sm text-gray-700",children:"Statement:"}),i.jsx("p",{className:"text-sm text-gray-900 mt-1 bg-gray-50 p-2 rounded",children:b.statement.length>200?b.statement.substring(0,200)+"...":b.statement})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-600",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Views:"})," ",b.viewCount]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Likes:"})," ",b.likeCount]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Author:"})," ",b.authorId?.substring(0,8)||"Unknown","..."]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Created:"})," ",x(b.createdAt)]})]})]})]}),i.jsx("button",{onClick:()=>p(b.id,b.slug),disabled:u.has(b.id),className:"ml-4 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 flex items-center gap-1",children:u.has(b.id)?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Deleting..."]}):i.jsx(i.Fragment,{children:" Delete"})})]})},b.id))})]})})},AO=()=>{const[s,e]=P.useState([]),[t,n]=P.useState(!0),[a,l]=P.useState(!0);P.useEffect(()=>{if(!a)return;const b=Le(Ce(ee,"automationLogs"),Jt("timestamp","desc"),Zt(50)),E=Fm(b,C=>{const k=C.docs.map(L=>({id:L.id,...L.data(),timestamp:L.data().timestamp?.toDate()}));e(k),n(!1)},C=>{console.error("Error listening to automation logs:",C),n(!1)});return()=>E()},[a]);const u=b=>b?b.toLocaleString():"Unknown",h=b=>{switch(b){case"started":return"";case"step_success":return"";case"step_failed":return"";case"success":return"";case"failed":return"";case"skipped":return"";case"retry_scheduled":return"";case"retrying":return"";default:return""}},m=b=>{switch(b){case"started":return"text-blue-600 bg-blue-50 border-blue-200";case"step_success":return"text-green-600 bg-green-50 border-green-200";case"step_failed":return"text-red-600 bg-red-50 border-red-200";case"success":return"text-green-700 bg-green-100 border-green-300";case"failed":return"text-red-700 bg-red-100 border-red-300";case"skipped":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"retry_scheduled":return"text-orange-600 bg-orange-50 border-orange-200";case"retrying":return"text-blue-700 bg-blue-100 border-blue-300";default:return"text-gray-600 bg-gray-50 border-gray-200"}},p=b=>{const E=s.filter(F=>F.details?.runId===b);if(E.length===0)return{total:0,completed:0,status:"unknown"};const C=E.some(F=>F.status==="started"),k=E.some(F=>F.status==="success"),L=E.some(F=>F.status==="failed"),U=E.filter(F=>F.status==="step_success").length;return{total:C?6:0,completed:U,status:L?"failed":k?"success":C?"running":"unknown"}},x=s.reduce((b,E)=>{const C=E.details?.runId||"unknown";return b[C]||(b[C]=[]),b[C].push(E),b},{}),w=Object.entries(x).sort((b,E)=>{const C=Math.max(...b[1].map(L=>L.timestamp?.getTime()||0));return Math.max(...E[1].map(L=>L.timestamp?.getTime()||0))-C});return t?i.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Loading Automation Monitor..."})]})}):i.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:" Automation Monitor"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`h-2 w-2 rounded-full ${a?"bg-green-500 animate-pulse":"bg-gray-400"}`}),i.jsx("span",{className:"text-sm text-gray-600",children:a?"Live":"Paused"}),i.jsx("button",{onClick:()=>l(!a),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${a?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a?"Pause":"Resume"})]})]}),s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-4xl mb-2",children:""}),i.jsx("h4",{className:"text-lg font-medium text-gray-600 mb-1",children:"No automation logs yet"}),i.jsx("p",{className:"text-gray-500",children:"Logs will appear here when the automation runs"})]}):i.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.slice(0,10).map(([b,E])=>{const C=p(b),k=E[0],L=k.timestamp&&Date.now()-k.timestamp.getTime()<300*1e3;return i.jsxs("div",{className:`border rounded-lg p-4 ${L?"ring-2 ring-blue-200 border-blue-300":"border-gray-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:[b.substring(0,12),"..."]}),i.jsxs("span",{className:`text-xs px-2 py-1 rounded border ${m(C.status)}`,children:[h(C.status)," ",C.status.toUpperCase()]}),C.total>0&&i.jsxs("span",{className:"text-xs text-gray-500",children:[C.completed,"/",C.total," steps"]})]}),i.jsx("span",{className:"text-xs text-gray-500",children:u(k.timestamp)})]}),C.total>0&&i.jsx("div",{className:"mb-3",children:i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${C.status==="failed"?"bg-red-500":C.status==="success"?"bg-green-500":"bg-blue-500"}`,style:{width:`${C.completed/C.total*100}%`}})})}),i.jsxs("div",{className:"space-y-1",children:[E.slice(0,3).map((U,F)=>i.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[i.jsx("span",{className:"text-xs",children:h(U.status)}),i.jsxs("div",{className:"flex-1",children:[i.jsx("span",{className:"text-gray-700",children:U.details?.message||"No message"}),U.details?.error&&i.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Error: ",U.details.error]}),U.details?.step&&i.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["[",U.details.step,"]"]})]}),i.jsx("span",{className:"text-xs text-gray-400",children:u(U.timestamp)})]},U.id)),E.length>3&&i.jsxs("div",{className:"text-xs text-gray-500 pl-4",children:["+",E.length-3," more logs..."]})]})]},b)})}),i.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:i.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[i.jsx("span",{children:"Showing last 50 automation logs"}),i.jsx("span",{children:"Updates automatically every few seconds"})]})})]})};class Mi{static async getBotAccounts(){try{const e=Ce(ee,"botAccounts");return(await Ke(e)).docs.map(n=>({id:n.id,...n.data()}))}catch(e){throw console.error("Error getting bot accounts:",e),e}}static async getAutomationSettings(){try{const e=ve(ee,"automation","settings"),t=await vt(e);return t.exists()?t.data():{enabled:!1,interval:24,maxPostsPerDay:5,tags:["math","mathematics"],subjects:["mathematics"]}}catch(e){throw console.error("Error getting automation settings:",e),e}}static async updateAutomationSettings(e){try{const t=ve(ee,"automation","settings");await Rs(t,{...e,updatedAt:Pe()})}catch(t){throw console.error("Error updating automation settings:",t),t}}static async createBotAccount(e){try{const t=ve(Ce(ee,"botAccounts"));return await Rs(t,{...e,createdAt:Pe(),isActive:!0}),t.id}catch(t){throw console.error("Error creating bot account:",t),t}}static async deleteBotAccount(e){try{const t=ve(ee,"botAccounts",e);await Wo(t)}catch(t){throw console.error("Error deleting bot account:",t),t}}}/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:O1,setPrototypeOf:ZT,isFrozen:jO,getPrototypeOf:IO,getOwnPropertyDescriptor:CO}=Object;let{freeze:ps,seal:vr,create:V1}=Object,{apply:qx,construct:zx}=typeof Reflect<"u"&&Reflect;ps||(ps=function(e){return e});vr||(vr=function(e){return e});qx||(qx=function(e,t,n){return e.apply(t,n)});zx||(zx=function(e,t){return new e(...t)});const $f=ys(Array.prototype.forEach),RO=ys(Array.prototype.lastIndexOf),eE=ys(Array.prototype.pop),gd=ys(Array.prototype.push),kO=ys(Array.prototype.splice),mm=ys(String.prototype.toLowerCase),Wy=ys(String.prototype.toString),tE=ys(String.prototype.match),pd=ys(String.prototype.replace),DO=ys(String.prototype.indexOf),PO=ys(String.prototype.trim),Rr=ys(Object.prototype.hasOwnProperty),gs=ys(RegExp.prototype.test),yd=MO(TypeError);function ys(s){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return qx(s,e,n)}}function MO(s){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return zx(s,t)}}function at(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mm;ZT&&ZT(s,null);let n=e.length;for(;n--;){let a=e[n];if(typeof a=="string"){const l=t(a);l!==a&&(jO(e)||(e[n]=l),a=l)}s[a]=!0}return s}function OO(s){for(let e=0;e<s.length;e++)Rr(s,e)||(s[e]=null);return s}function Pa(s){const e=V1(null);for(const[t,n]of O1(s))Rr(s,t)&&(Array.isArray(n)?e[t]=OO(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=Pa(n):e[t]=n);return e}function xd(s,e){for(;s!==null;){const n=CO(s,e);if(n){if(n.get)return ys(n.get);if(typeof n.value=="function")return ys(n.value)}s=IO(s)}function t(){return null}return t}const nE=ps(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Jy=ps(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Zy=ps(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),VO=ps(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ex=ps(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),LO=ps(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),sE=ps(["#text"]),rE=ps(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),tx=ps(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),aE=ps(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Kf=ps(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),FO=vr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),UO=vr(/<%[\w\W]*|[\w\W]*%>/gm),BO=vr(/\$\{[\w\W]*/gm),qO=vr(/^data-[\-\w.\u00B7-\uFFFF]+$/),zO=vr(/^aria-[\-\w]+$/),L1=vr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),HO=vr(/^(?:\w+script|data):/i),GO=vr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),F1=vr(/^html$/i),$O=vr(/^[a-z][.\w]*(-[.\w]+)+$/i);var iE=Object.freeze({__proto__:null,ARIA_ATTR:zO,ATTR_WHITESPACE:GO,CUSTOM_ELEMENT:$O,DATA_ATTR:qO,DOCTYPE_NAME:F1,ERB_EXPR:UO,IS_ALLOWED_URI:L1,IS_SCRIPT_OR_DATA:HO,MUSTACHE_EXPR:FO,TMPLIT_EXPR:BO});const vd={element:1,text:3,progressingInstruction:7,comment:8,document:9},KO=function(){return typeof window>"u"?null:window},QO=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const a="data-tt-policy-suffix";t&&t.hasAttribute(a)&&(n=t.getAttribute(a));const l="dompurify"+(n?"#"+n:"");try{return e.createPolicy(l,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},oE=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function U1(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:KO();const e=De=>U1(De);if(e.version="3.2.6",e.removed=[],!s||!s.document||s.document.nodeType!==vd.document||!s.Element)return e.isSupported=!1,e;let{document:t}=s;const n=t,a=n.currentScript,{DocumentFragment:l,HTMLTemplateElement:u,Node:h,Element:m,NodeFilter:p,NamedNodeMap:x=s.NamedNodeMap||s.MozNamedAttrMap,HTMLFormElement:w,DOMParser:b,trustedTypes:E}=s,C=m.prototype,k=xd(C,"cloneNode"),L=xd(C,"remove"),U=xd(C,"nextSibling"),F=xd(C,"childNodes"),B=xd(C,"parentNode");if(typeof u=="function"){const De=t.createElement("template");De.content&&De.content.ownerDocument&&(t=De.content.ownerDocument)}let H,$="";const{implementation:M,createNodeIterator:R,createDocumentFragment:N,getElementsByTagName:A}=t,{importNode:V}=n;let I=oE();e.isSupported=typeof O1=="function"&&typeof B=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:G,ERB_EXPR:O,TMPLIT_EXPR:Ve,DATA_ATTR:ae,ARIA_ATTR:z,IS_SCRIPT_OR_DATA:oe,ATTR_WHITESPACE:Y,CUSTOM_ELEMENT:be}=iE;let{IS_ALLOWED_URI:D}=iE,te=null;const xe=at({},[...nE,...Jy,...Zy,...ex,...sE]);let ue=null;const Ie=at({},[...rE,...tx,...aE,...Kf]);let pe=Object.seal(V1(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ee=null,ce=null,we=!0,Se=!0,Fe=!1,Ze=!0,Ge=!1,lt=!0,ze=!1,Qe=!1,gt=!1,ct=!1,It=!1,Gn=!1,an=!0,$n=!1;const wr="user-content-";let Ds=!0,Ps=!1,Ms={},_t=null;const pt=at({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let es=null;const bn=at({},["audio","video","img","source","image","track"]);let Ja=null;const yl=at({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Zs="http://www.w3.org/1998/Math/MathML",er="http://www.w3.org/2000/svg",Kn="http://www.w3.org/1999/xhtml";let kn=Kn,Fr=!1,_r=null;const oo=at({},[Zs,er,Kn],Wy);let Ur=at({},["mi","mo","mn","ms","mtext"]),Br=at({},["annotation-xml"]);const Nr=at({},["title","style","font","a","script"]);let us=null;const lo=["application/xhtml+xml","text/html"],tr="text/html";let qt=null,ds=null;const Za=t.createElement("form"),Tr=function(Q){return Q instanceof RegExp||Q instanceof Function},ei=function(){let Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ds&&ds===Q)){if((!Q||typeof Q!="object")&&(Q={}),Q=Pa(Q),us=lo.indexOf(Q.PARSER_MEDIA_TYPE)===-1?tr:Q.PARSER_MEDIA_TYPE,qt=us==="application/xhtml+xml"?Wy:mm,te=Rr(Q,"ALLOWED_TAGS")?at({},Q.ALLOWED_TAGS,qt):xe,ue=Rr(Q,"ALLOWED_ATTR")?at({},Q.ALLOWED_ATTR,qt):Ie,_r=Rr(Q,"ALLOWED_NAMESPACES")?at({},Q.ALLOWED_NAMESPACES,Wy):oo,Ja=Rr(Q,"ADD_URI_SAFE_ATTR")?at(Pa(yl),Q.ADD_URI_SAFE_ATTR,qt):yl,es=Rr(Q,"ADD_DATA_URI_TAGS")?at(Pa(bn),Q.ADD_DATA_URI_TAGS,qt):bn,_t=Rr(Q,"FORBID_CONTENTS")?at({},Q.FORBID_CONTENTS,qt):pt,Ee=Rr(Q,"FORBID_TAGS")?at({},Q.FORBID_TAGS,qt):Pa({}),ce=Rr(Q,"FORBID_ATTR")?at({},Q.FORBID_ATTR,qt):Pa({}),Ms=Rr(Q,"USE_PROFILES")?Q.USE_PROFILES:!1,we=Q.ALLOW_ARIA_ATTR!==!1,Se=Q.ALLOW_DATA_ATTR!==!1,Fe=Q.ALLOW_UNKNOWN_PROTOCOLS||!1,Ze=Q.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ge=Q.SAFE_FOR_TEMPLATES||!1,lt=Q.SAFE_FOR_XML!==!1,ze=Q.WHOLE_DOCUMENT||!1,ct=Q.RETURN_DOM||!1,It=Q.RETURN_DOM_FRAGMENT||!1,Gn=Q.RETURN_TRUSTED_TYPE||!1,gt=Q.FORCE_BODY||!1,an=Q.SANITIZE_DOM!==!1,$n=Q.SANITIZE_NAMED_PROPS||!1,Ds=Q.KEEP_CONTENT!==!1,Ps=Q.IN_PLACE||!1,D=Q.ALLOWED_URI_REGEXP||L1,kn=Q.NAMESPACE||Kn,Ur=Q.MATHML_TEXT_INTEGRATION_POINTS||Ur,Br=Q.HTML_INTEGRATION_POINTS||Br,pe=Q.CUSTOM_ELEMENT_HANDLING||{},Q.CUSTOM_ELEMENT_HANDLING&&Tr(Q.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(pe.tagNameCheck=Q.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Q.CUSTOM_ELEMENT_HANDLING&&Tr(Q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(pe.attributeNameCheck=Q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Q.CUSTOM_ELEMENT_HANDLING&&typeof Q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(pe.allowCustomizedBuiltInElements=Q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ge&&(Se=!1),It&&(ct=!0),Ms&&(te=at({},sE),ue=[],Ms.html===!0&&(at(te,nE),at(ue,rE)),Ms.svg===!0&&(at(te,Jy),at(ue,tx),at(ue,Kf)),Ms.svgFilters===!0&&(at(te,Zy),at(ue,tx),at(ue,Kf)),Ms.mathMl===!0&&(at(te,ex),at(ue,aE),at(ue,Kf))),Q.ADD_TAGS&&(te===xe&&(te=Pa(te)),at(te,Q.ADD_TAGS,qt)),Q.ADD_ATTR&&(ue===Ie&&(ue=Pa(ue)),at(ue,Q.ADD_ATTR,qt)),Q.ADD_URI_SAFE_ATTR&&at(Ja,Q.ADD_URI_SAFE_ATTR,qt),Q.FORBID_CONTENTS&&(_t===pt&&(_t=Pa(_t)),at(_t,Q.FORBID_CONTENTS,qt)),Ds&&(te["#text"]=!0),ze&&at(te,["html","head","body"]),te.table&&(at(te,["tbody"]),delete Ee.tbody),Q.TRUSTED_TYPES_POLICY){if(typeof Q.TRUSTED_TYPES_POLICY.createHTML!="function")throw yd('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Q.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw yd('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');H=Q.TRUSTED_TYPES_POLICY,$=H.createHTML("")}else H===void 0&&(H=QO(E,a)),H!==null&&typeof $=="string"&&($=H.createHTML(""));ps&&ps(Q),ds=Q}},Mt=at({},[...Jy,...Zy,...VO]),tn=at({},[...ex,...LO]),nn=function(Q){let ye=B(Q);(!ye||!ye.tagName)&&(ye={namespaceURI:kn,tagName:"template"});const je=mm(Q.tagName),Nt=mm(ye.tagName);return _r[Q.namespaceURI]?Q.namespaceURI===er?ye.namespaceURI===Kn?je==="svg":ye.namespaceURI===Zs?je==="svg"&&(Nt==="annotation-xml"||Ur[Nt]):!!Mt[je]:Q.namespaceURI===Zs?ye.namespaceURI===Kn?je==="math":ye.namespaceURI===er?je==="math"&&Br[Nt]:!!tn[je]:Q.namespaceURI===Kn?ye.namespaceURI===er&&!Br[Nt]||ye.namespaceURI===Zs&&!Ur[Nt]?!1:!tn[je]&&(Nr[je]||!Mt[je]):!!(us==="application/xhtml+xml"&&_r[Q.namespaceURI]):!1},Yt=function(Q){gd(e.removed,{element:Q});try{B(Q).removeChild(Q)}catch{L(Q)}},nr=function(Q,ye){try{gd(e.removed,{attribute:ye.getAttributeNode(Q),from:ye})}catch{gd(e.removed,{attribute:null,from:ye})}if(ye.removeAttribute(Q),Q==="is")if(ct||It)try{Yt(ye)}catch{}else try{ye.setAttribute(Q,"")}catch{}},xl=function(Q){let ye=null,je=null;if(gt)Q="<remove></remove>"+Q;else{const Ot=tE(Q,/^[\r\n\t ]+/);je=Ot&&Ot[0]}us==="application/xhtml+xml"&&kn===Kn&&(Q='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Q+"</body></html>");const Nt=H?H.createHTML(Q):Q;if(kn===Kn)try{ye=new b().parseFromString(Nt,us)}catch{}if(!ye||!ye.documentElement){ye=M.createDocument(kn,"template",null);try{ye.documentElement.innerHTML=Fr?$:Nt}catch{}}const on=ye.body||ye.documentElement;return Q&&je&&on.insertBefore(t.createTextNode(je),on.childNodes[0]||null),kn===Kn?A.call(ye,ze?"html":"body")[0]:ze?ye.documentElement:on},Er=function(Q){return R.call(Q.ownerDocument||Q,Q,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},ti=function(Q){return Q instanceof w&&(typeof Q.nodeName!="string"||typeof Q.textContent!="string"||typeof Q.removeChild!="function"||!(Q.attributes instanceof x)||typeof Q.removeAttribute!="function"||typeof Q.setAttribute!="function"||typeof Q.namespaceURI!="string"||typeof Q.insertBefore!="function"||typeof Q.hasChildNodes!="function")},qr=function(Q){return typeof h=="function"&&Q instanceof h};function Dn(De,Q,ye){$f(De,je=>{je.call(e,Q,ye,ds)})}const sr=function(Q){let ye=null;if(Dn(I.beforeSanitizeElements,Q,null),ti(Q))return Yt(Q),!0;const je=qt(Q.nodeName);if(Dn(I.uponSanitizeElement,Q,{tagName:je,allowedTags:te}),lt&&Q.hasChildNodes()&&!qr(Q.firstElementChild)&&gs(/<[/\w!]/g,Q.innerHTML)&&gs(/<[/\w!]/g,Q.textContent)||Q.nodeType===vd.progressingInstruction||lt&&Q.nodeType===vd.comment&&gs(/<[/\w]/g,Q.data))return Yt(Q),!0;if(!te[je]||Ee[je]){if(!Ee[je]&&Vs(je)&&(pe.tagNameCheck instanceof RegExp&&gs(pe.tagNameCheck,je)||pe.tagNameCheck instanceof Function&&pe.tagNameCheck(je)))return!1;if(Ds&&!_t[je]){const Nt=B(Q)||Q.parentNode,on=F(Q)||Q.childNodes;if(on&&Nt){const Ot=on.length;for(let wn=Ot-1;wn>=0;--wn){const Mn=k(on[wn],!0);Mn.__removalCount=(Q.__removalCount||0)+1,Nt.insertBefore(Mn,U(Q))}}}return Yt(Q),!0}return Q instanceof m&&!nn(Q)||(je==="noscript"||je==="noembed"||je==="noframes")&&gs(/<\/no(script|embed|frames)/i,Q.innerHTML)?(Yt(Q),!0):(Ge&&Q.nodeType===vd.text&&(ye=Q.textContent,$f([G,O,Ve],Nt=>{ye=pd(ye,Nt," ")}),Q.textContent!==ye&&(gd(e.removed,{element:Q.cloneNode()}),Q.textContent=ye)),Dn(I.afterSanitizeElements,Q,null),!1)},Os=function(Q,ye,je){if(an&&(ye==="id"||ye==="name")&&(je in t||je in Za))return!1;if(!(Se&&!ce[ye]&&gs(ae,ye))){if(!(we&&gs(z,ye))){if(!ue[ye]||ce[ye]){if(!(Vs(Q)&&(pe.tagNameCheck instanceof RegExp&&gs(pe.tagNameCheck,Q)||pe.tagNameCheck instanceof Function&&pe.tagNameCheck(Q))&&(pe.attributeNameCheck instanceof RegExp&&gs(pe.attributeNameCheck,ye)||pe.attributeNameCheck instanceof Function&&pe.attributeNameCheck(ye))||ye==="is"&&pe.allowCustomizedBuiltInElements&&(pe.tagNameCheck instanceof RegExp&&gs(pe.tagNameCheck,je)||pe.tagNameCheck instanceof Function&&pe.tagNameCheck(je))))return!1}else if(!Ja[ye]){if(!gs(D,pd(je,Y,""))){if(!((ye==="src"||ye==="xlink:href"||ye==="href")&&Q!=="script"&&DO(je,"data:")===0&&es[Q])){if(!(Fe&&!gs(oe,pd(je,Y,"")))){if(je)return!1}}}}}}return!0},Vs=function(Q){return Q!=="annotation-xml"&&tE(Q,be)},Pn=function(Q){Dn(I.beforeSanitizeAttributes,Q,null);const{attributes:ye}=Q;if(!ye||ti(Q))return;const je={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ue,forceKeepAttr:void 0};let Nt=ye.length;for(;Nt--;){const on=ye[Nt],{name:Ot,namespaceURI:wn,value:Mn}=on,ts=qt(Ot),ln=Mn;let zt=Ot==="value"?ln:PO(ln);if(je.attrName=ts,je.attrValue=zt,je.keepAttr=!0,je.forceKeepAttr=void 0,Dn(I.uponSanitizeAttribute,Q,je),zt=je.attrValue,$n&&(ts==="id"||ts==="name")&&(nr(Ot,Q),zt=wr+zt),lt&&gs(/((--!?|])>)|<\/(style|title)/i,zt)){nr(Ot,Q);continue}if(je.forceKeepAttr)continue;if(!je.keepAttr){nr(Ot,Q);continue}if(!Ze&&gs(/\/>/i,zt)){nr(Ot,Q);continue}Ge&&$f([G,O,Ve],rr=>{zt=pd(zt,rr," ")});const co=qt(Q.nodeName);if(!Os(co,ts,zt)){nr(Ot,Q);continue}if(H&&typeof E=="object"&&typeof E.getAttributeType=="function"&&!wn)switch(E.getAttributeType(co,ts)){case"TrustedHTML":{zt=H.createHTML(zt);break}case"TrustedScriptURL":{zt=H.createScriptURL(zt);break}}if(zt!==ln)try{wn?Q.setAttributeNS(wn,Ot,zt):Q.setAttribute(Ot,zt),ti(Q)?Yt(Q):eE(e.removed)}catch{nr(Ot,Q)}}Dn(I.afterSanitizeAttributes,Q,null)},Xt=function De(Q){let ye=null;const je=Er(Q);for(Dn(I.beforeSanitizeShadowDOM,Q,null);ye=je.nextNode();)Dn(I.uponSanitizeShadowNode,ye,null),sr(ye),Pn(ye),ye.content instanceof l&&De(ye.content);Dn(I.afterSanitizeShadowDOM,Q,null)};return e.sanitize=function(De){let Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ye=null,je=null,Nt=null,on=null;if(Fr=!De,Fr&&(De="<!-->"),typeof De!="string"&&!qr(De))if(typeof De.toString=="function"){if(De=De.toString(),typeof De!="string")throw yd("dirty is not a string, aborting")}else throw yd("toString is not a function");if(!e.isSupported)return De;if(Qe||ei(Q),e.removed=[],typeof De=="string"&&(Ps=!1),Ps){if(De.nodeName){const Mn=qt(De.nodeName);if(!te[Mn]||Ee[Mn])throw yd("root node is forbidden and cannot be sanitized in-place")}}else if(De instanceof h)ye=xl("<!---->"),je=ye.ownerDocument.importNode(De,!0),je.nodeType===vd.element&&je.nodeName==="BODY"||je.nodeName==="HTML"?ye=je:ye.appendChild(je);else{if(!ct&&!Ge&&!ze&&De.indexOf("<")===-1)return H&&Gn?H.createHTML(De):De;if(ye=xl(De),!ye)return ct?null:Gn?$:""}ye&&gt&&Yt(ye.firstChild);const Ot=Er(Ps?De:ye);for(;Nt=Ot.nextNode();)sr(Nt),Pn(Nt),Nt.content instanceof l&&Xt(Nt.content);if(Ps)return De;if(ct){if(It)for(on=N.call(ye.ownerDocument);ye.firstChild;)on.appendChild(ye.firstChild);else on=ye;return(ue.shadowroot||ue.shadowrootmode)&&(on=V.call(n,on,!0)),on}let wn=ze?ye.outerHTML:ye.innerHTML;return ze&&te["!doctype"]&&ye.ownerDocument&&ye.ownerDocument.doctype&&ye.ownerDocument.doctype.name&&gs(F1,ye.ownerDocument.doctype.name)&&(wn="<!DOCTYPE "+ye.ownerDocument.doctype.name+`>
`+wn),Ge&&$f([G,O,Ve],Mn=>{wn=pd(wn,Mn," ")}),H&&Gn?H.createHTML(wn):wn},e.setConfig=function(){let De=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ei(De),Qe=!0},e.clearConfig=function(){ds=null,Qe=!1},e.isValidAttribute=function(De,Q,ye){ds||ei({});const je=qt(De),Nt=qt(Q);return Os(je,Nt,ye)},e.addHook=function(De,Q){typeof Q=="function"&&gd(I[De],Q)},e.removeHook=function(De,Q){if(Q!==void 0){const ye=RO(I[De],Q);return ye===-1?void 0:kO(I[De],ye,1)[0]}return eE(I[De])},e.removeHooks=function(De){I[De]=[]},e.removeAllHooks=function(){I=oE()},e}var nx=U1();const YO=()=>{const{user:s}=Rn(),[e,t]=P.useState(""),[n,a]=P.useState(!1),[l,u]=P.useState(null),[h,m]=P.useState(!1),[p,x]=P.useState([]),[w,b]=P.useState(!1),[E,C]=P.useState(""),[k,L]=P.useState({enabled:!1,interval:24,lastRun:null,nextRun:null});P.useEffect(()=>{U(),F()},[]);const U=async()=>{try{const I=await Mi.getBotAccounts();x(I)}catch(I){console.error("Error loading bots:",I)}},F=async()=>{try{const I=await Mi.getAutomationSettings();L(I)}catch(I){console.error("Error loading automation settings:",I)}},B=async()=>{a(!0);try{const O=(await Li(Ua,"getRandomMathPost")()).data;t(O.url),confirm(`Found: "${O.question.title}" (${O.question.score} votes)

Auto-convert to flashcard?`)&&await H(O.url)}catch(I){console.error("Error getting random post:",I),alert("Failed to get random math post: "+I.message)}finally{a(!1)}},H=async(I=null)=>{const G=I||e;if(!G){alert("Please enter a Stack Exchange URL");return}a(!0);try{const Ve=await Li(Ua,"convertStackExchangePost")({url:G});u(Ve.data),m(!1)}catch(O){console.error("Error converting post:",O),alert("Failed to convert post: "+O.message)}finally{a(!1)}},$=(I,G)=>{u(O=>({...O,[I]:G}))},M=async()=>{if(!E){alert("Please select a bot account");return}if(!l){alert("No conversion data available");return}a(!0);try{const G=await Li(Ua,"publishStackExchangeFlashcard")({conversion:l,botId:E});alert("Flashcard published successfully!"),u(null),t(""),C("")}catch(I){console.error("Error publishing flashcard:",I),alert("Failed to publish flashcard: "+I.message)}finally{a(!1)}},R=async()=>{try{const I={...k,enabled:!k.enabled};await Mi.updateAutomationSettings(I),L(I)}catch(I){console.error("Error updating automation:",I),alert("Failed to update automation settings")}},N=async I=>{try{const G={...k,interval:parseInt(I)};await Mi.updateAutomationSettings(G),L(G)}catch(G){console.error("Error updating automation interval:",G),alert("Failed to update automation interval")}},A=async()=>{if(p.length===0){alert(` No bots available!

You need to create at least one bot account before triggering automation.

Go to the "Bots" tab to create a bot first.`);return}const I=p.filter(G=>G.isActive);if(I.length===0){alert(` No active bots!

You have bots, but none are currently active.

Activate at least one bot in the "Bots" tab before triggering automation.`);return}if(confirm(`This will trigger the full automation pipeline:

1. Select random bot (from ${I.length} active bots)
2. Get random StackExchange post
3. Convert to flashcard with DeepSeek AI
4. Publish as bot
5. Bot likes own post

Continue?`)){a(!0);try{const Ve=(await Li(Ua,"triggerAutomation")()).data;alert(` Automation completed successfully!

Bot: ${Ve.botName}
Post ID: ${Ve.postId}
Card URL: ${Ve.cardUrl||"Not available"}
Source: ${Ve.stackExchangeUrl}

Check the Cloud Functions logs for detailed execution info.`),U(),F()}catch(G){console.error("Error triggering automation:",G);let O=G.message;O.includes("Failed to get random math post")?O="StackExchange API issue - likely rate limited. Try again in a few minutes.":O.includes("No active bot accounts")?O="No active bots found. Create and activate a bot first.":O.includes("DeepSeek")&&(O="AI conversion failed. Check DeepSeek API key and credits."),alert(` Automation failed: ${O}

Check the browser console and Cloud Functions logs for more details.`)}finally{a(!1)}}},V=async()=>{if(confirm("Are you sure you want to stop the automation? This will disable all scheduled automated posting."))try{const I={...k,enabled:!1,lastStopped:new Date().toISOString()};await Mi.updateAutomationSettings(I),L(I),alert(" Automation has been stopped. No more automated posts will be created.")}catch(I){console.error("Error stopping automation:",I),alert("Failed to stop automation: "+I.message)}};return i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[i.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:" StackExchange to Flashcard Converter"}),i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:" Automation Settings"}),i.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${k.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${k.enabled?"bg-green-500":"bg-gray-400"}`}),k.enabled?"ACTIVE":"STOPPED"]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Automated Posting Control:"}),i.jsx("div",{className:"flex gap-2",children:k.enabled?i.jsx("button",{onClick:V,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:" Stop Automation"}):i.jsxs("button",{onClick:R,disabled:n||p.length===0||p.filter(I=>I.isActive).length===0,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[i.jsx("span",{className:"animate-pulse",children:""}),"Start Automation"]})})]}),p.length===0&&i.jsx("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-1 rounded",children:" Create bots first"}),p.length>0&&p.filter(I=>I.isActive).length===0&&i.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:" Activate bots first"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Post every:"}),i.jsxs("select",{value:k.interval,onChange:I=>N(I.target.value),disabled:!k.enabled,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",children:[i.jsx("option",{value:15,children:"15 minutes"}),i.jsx("option",{value:30,children:"30 minutes"}),i.jsx("option",{value:60,children:"1 hour"}),i.jsx("option",{value:180,children:"3 hours"}),i.jsx("option",{value:360,children:"6 hours"}),i.jsx("option",{value:720,children:"12 hours"}),i.jsx("option",{value:1440,children:"24 hours"})]})]}),k.lastRun&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Last run: ",new Date(k.lastRun).toLocaleString()]}),k.nextRun&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Next run: ",new Date(k.nextRun).toLocaleString()]})]})]}),i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Manual Conversion"}),i.jsxs("div",{className:"flex gap-3 mb-4",children:[i.jsx("input",{type:"url",value:e,onChange:I=>t(I.target.value),placeholder:"https://math.stackexchange.com/questions/...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("button",{onClick:()=>H(),disabled:n||!e,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:n?"Converting...":"Convert to Flashcard"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:B,disabled:n,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:" Test: Get Random Math Post"}),i.jsxs("button",{onClick:()=>b(!w),disabled:n,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:[w?" Hide":" Review"," Broken Cards"]})]}),i.jsxs("div",{className:"border-t pt-3",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Manual Testing:"}),p.length===0&&i.jsx("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-1 rounded",children:" Create bots first"}),p.length>0&&p.filter(I=>I.isActive).length===0&&i.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:" Activate bots first"})]}),i.jsx("button",{onClick:A,disabled:n||p.length===0||p.filter(I=>I.isActive).length===0,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:" Test Full Pipeline Once"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This runs the entire automation once for testing. The scheduled automation above runs automatically."})]})]})]}),l&&i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Conversion Result"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Statement:"}),h?i.jsx("textarea",{value:l.statement,onChange:I=>$("statement",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4}):i.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:nx.sanitize(l.statement)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hints:"}),h?i.jsx("textarea",{value:l.hints,onChange:I=>$("hints",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}):i.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:nx.sanitize(l.hints)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof:"}),h?i.jsx("textarea",{value:l.proof,onChange:I=>$("proof",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4}):i.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:nx.sanitize(l.proof)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags:"}),h?i.jsx("input",{type:"text",value:l.tags?.join(", ")||"",onChange:I=>$("tags",I.target.value.split(",").map(G=>G.trim())),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"tag1, tag2, tag3"}):i.jsx("div",{className:"flex flex-wrap gap-2",children:l.tags?.map(I=>i.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:["#",I]},I))})]})]}),i.jsxs("div",{className:"flex gap-3 mt-6",children:[i.jsx("button",{onClick:()=>m(!h),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:h?"Preview":"Edit"}),i.jsx("button",{onClick:()=>H(),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Regenerate"})]})]}),l&&i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Publish Flashcard"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bot Account:"}),i.jsxs("select",{value:E,onChange:I=>C(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Choose a bot..."}),p.map(I=>i.jsxs("option",{value:I.id,children:[I.displayName," (",I.email,")"]},I.id))]})]}),i.jsx("button",{onClick:M,disabled:n||!E,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:n?"Publishing...":"Publish Flashcard"})]}),w&&i.jsx(SO,{}),i.jsx(AO,{})]})},XO=()=>{const[s,e]=P.useState([]),[t,n]=P.useState(!1),[a,l]=P.useState({displayName:"",email:"",password:"",bio:"",avatar:""}),[u,h]=P.useState(!1);P.useEffect(()=>{m()},[]);const m=async()=>{n(!0);try{const b=await Mi.getBotAccounts();e(b)}catch(b){console.error("Error loading bots:",b),alert("Failed to load bot accounts")}finally{n(!1)}},p=async()=>{if(!a.displayName||!a.email||!a.password){alert("Please fill in all required fields");return}n(!0);try{const b=await Mi.createBotAccount(a);alert("Bot account created successfully!"),l({displayName:"",email:"",password:"",bio:"",avatar:""}),h(!1),m()}catch(b){console.error("Error creating bot:",b),alert("Failed to create bot account: "+b.message)}finally{n(!1)}},x=async b=>{if(confirm("Are you sure you want to delete this bot account? This action cannot be undone.")){n(!0);try{await Mi.deleteBotAccount(b),alert("Bot account deleted successfully!"),m()}catch(E){console.error("Error deleting bot:",E),alert("Failed to delete bot account: "+E.message)}finally{n(!1)}}},w=async(b,E)=>{n(!0);try{await Li(Ua,"updateBotStatus")({botId:b,isActive:!E}),m()}catch(C){console.error("Error updating bot status:",C),alert("Failed to update bot status: "+C.message)}finally{n(!1)}};return i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[i.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:" Bot Account Management"}),i.jsxs("div",{className:"flex gap-4 mb-6",children:[i.jsx("button",{onClick:()=>h(!u),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:u?"Cancel":"+ Create New Bot"}),i.jsx("button",{onClick:m,disabled:t,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Loading...":"Refresh"})]}),u&&i.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Bot Account"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name:"}),i.jsx("input",{type:"text",value:a.displayName,onChange:b=>l({...a,displayName:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., MathBot Pro"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email:"}),i.jsx("input",{type:"email",value:a.email,onChange:b=>l({...a,email:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., mathbot1@example.com"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password:"}),i.jsx("input",{type:"password",value:a.password,onChange:b=>l({...a,password:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Strong password"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar URL (optional):"}),i.jsx("input",{type:"url",value:a.avatar,onChange:b=>l({...a,avatar:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/avatar.jpg"})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio:"}),i.jsx("textarea",{value:a.bio,onChange:b=>l({...a,bio:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Brief description of this bot..."})]}),a.avatar&&i.jsxs("div",{className:"mt-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar Preview:"}),i.jsx("img",{src:a.avatar,alt:"Avatar preview",className:"w-16 h-16 rounded-full object-cover border border-gray-300",onError:b=>{b.target.style.display="none"}})]}),i.jsxs("div",{className:"flex gap-3 mt-6",children:[i.jsx("button",{onClick:p,disabled:t,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Creating...":"Create Bot"}),i.jsx("button",{onClick:()=>h(!1),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"})]})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Bot Accounts (",s.length,")"]}),t&&i.jsx("div",{className:"text-gray-600 py-4",children:"Loading bot accounts..."}),s.length===0&&!t&&i.jsx("div",{className:"text-gray-600 py-8 text-center",children:i.jsx("p",{children:"No bot accounts found. Create your first bot to get started!"})}),i.jsx("div",{className:"grid gap-4",children:s.map(b=>i.jsx("div",{className:`p-4 rounded-lg border ${b.isActive?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:b.displayName}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${b.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:b.isActive?"Active":"Inactive"})]}),i.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Email:"})," ",b.email]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Bio:"})," ",b.bio||"No bio set"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Created:"})," ",b.createdAt?b.createdAt.toDate?b.createdAt.toDate().toLocaleDateString():new Date(b.createdAt).toLocaleDateString():"Unknown"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Posts:"})," ",b.postCount||0]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Last Active:"})," ",b.lastActive?new Date(b.lastActive).toLocaleString():"Never"]})]})]}),i.jsxs("div",{className:"flex gap-2 ml-4",children:[i.jsx("button",{onClick:()=>w(b.id,b.isActive),disabled:t,className:`px-3 py-1 rounded text-sm font-medium transition-colors ${b.isActive?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:b.isActive?"Deactivate":"Activate"}),i.jsx("button",{onClick:()=>x(b.id),disabled:t,className:"px-3 py-1 rounded text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition-colors",children:"Delete"})]})]})},b.id))})]})]})},WO=({onClose:s})=>{const{user:e}=Rn(),[t,n]=P.useState(null),[a,l]=P.useState(!0),[u,h]=P.useState("overview"),[m,p]=P.useState(null),[x,w]=P.useState([]),[b,E]=P.useState([]),[C,k]=P.useState([]);P.useEffect(()=>{e&&L()},[e]);const L=async()=>{try{if(l(!0),!await Cr.verifyAdminAccess(e)){console.log(" No admin access, closing dashboard"),s&&s();return}const A=await Cr.getAdminStatus(e.uid);n(A),await U()}catch(N){console.error(" Error checking admin access:",N),s&&s()}finally{l(!1)}},U=async()=>{try{const N=await Cr.getSystemStats();p(N)}catch(N){console.error("Error loading system stats:",N)}},F=async()=>{try{const N=await Cr.getAllUsers(100);w(N)}catch(N){console.error("Error loading users:",N)}},B=async()=>{try{const N=await Cr.getPublicCardsForModeration(50);E(N)}catch(N){console.error("Error loading public cards:",N)}},H=async()=>{try{const N=await Cr.getAdminActivity(30);k(N)}catch(N){console.error("Error loading admin activity:",N)}},$=async N=>{switch(h(N),N){case"users":await F();break;case"content":await B();break;case"activity":await H();break}},M=async(N,A)=>{try{await Cr.updateUserPremium(N,A),await Cr.logAdminAction(e.uid,"user_premium_update",{targetUserId:N,newStatus:A}),await F()}catch(V){console.error("Error updating user premium:",V),alert("Failed to update user premium status")}},R=async(N,A,V="")=>{try{await Cr.moderateCard(N,A,V),await Cr.logAdminAction(e.uid,"content_moderation",{cardId:N,action:A,reason:V}),await B()}catch(I){console.error("Error moderating card:",I),alert("Failed to moderate content")}};return a?i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-red-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"claude-text-secondary",children:"Verifying admin access..."})]})}):t?.isAdmin?i.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-extrabold mb-2 text-red-600",children:" Admin Dashboard"}),i.jsx("p",{className:"claude-text-secondary",children:"System management and content moderation"}),i.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[i.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[t.adminLevel.toUpperCase()," ADMIN"]}),i.jsxs("span",{className:"text-sm claude-text-muted",children:["Logged in as: ",e.email]})]})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[i.jsx("button",{onClick:U,className:"claude-button-secondary",children:" Refresh Data"}),s&&i.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close Admin"})]})]}),i.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-red-50 to-orange-50 border-red-200",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-semibold text-red-800",children:"Administrator Mode Active"}),i.jsx("div",{className:"text-sm text-red-600",children:"All actions are logged. Use admin privileges responsibly."})]})]})}),i.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"users",label:" Users",icon:""},{id:"content",label:" Content",icon:""},{id:"activity",label:" Activity",icon:""},{id:"stackexchange",label:" StackExchange",icon:""},{id:"bots",label:" Bots",icon:""}].map(N=>i.jsxs("button",{onClick:()=>$(N.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${u===N.id?"bg-blue-500 text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[i.jsx("span",{className:"mr-2",children:N.icon}),i.jsx("span",{className:"hidden sm:inline",children:N.label.replace(/^.+\s/,"")})]},N.id))}),u==="overview"&&i.jsx(JO,{systemStats:m}),u==="users"&&i.jsx(ZO,{users:x,onPremiumToggle:M}),u==="content"&&i.jsx(eV,{publicCards:b,onModerate:R}),u==="stackexchange"&&i.jsxs("div",{className:"admin-section",children:[i.jsx("h3",{children:" StackExchange Integration"}),i.jsx(YO,{})]}),u==="bots"&&i.jsxs("div",{className:"admin-section",children:[i.jsx("h3",{children:" Bot Management"}),i.jsx(XO,{})]}),u==="activity"&&i.jsx(tV,{adminActivity:C})]})}):i.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:i.jsxs("div",{className:"claude-card p-8 text-center max-w-md",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Access Denied"}),i.jsx("p",{className:"claude-text-secondary mb-6",children:"You don't have administrator privileges to access this dashboard."}),i.jsx("button",{onClick:s,className:"claude-button-primary",children:"Return to App"})]})})},JO=({systemStats:s})=>i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Qf,{title:"Total Users",value:s?.users?.total||0,icon:"",color:"blue",subtitle:`${s?.users?.recentlyActive||0} active this week`}),i.jsx(Qf,{title:"Premium Users",value:s?.users?.premium||0,icon:"",color:"gold",subtitle:`${s?.users?.conversionRate||0}% conversion rate`}),i.jsx(Qf,{title:"Total Content",value:s?.content?.totalCards||0,icon:"",color:"green",subtitle:`${s?.content?.totalPublicCards||0} public cards`}),i.jsx(Qf,{title:"Recent Activity",value:s?.content?.recentPublicCards||0,icon:"",color:"purple",subtitle:"New public cards this week"})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),"System Status"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Database"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Authentication"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"File Storage"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Analytics"}),i.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]})]})]}),i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",children:" Usage Statistics"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Avg Cards per User"}),i.jsx("span",{className:"font-medium",children:s?.content?.avgCardsPerUser||0})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Admin Users"}),i.jsx("span",{className:"font-medium",children:s?.users?.admin||0})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Public vs Private"}),i.jsxs("span",{className:"font-medium",children:[s?.content?.totalPublicCards||0," / ",s?.content?.totalPrivateCards||0]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Last Updated"}),i.jsx("span",{className:"font-medium text-sm",children:s?.system?.lastUpdated?new Date(s.system.lastUpdated).toLocaleTimeString():"Never"})]})]})]})]})]}),ZO=({users:s,onPremiumToggle:e})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",children:"User Management"}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," users loaded"]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold",children:t.displayName}),i.jsx("p",{className:"text-sm claude-text-muted",children:t.email}),i.jsxs("p",{className:"text-xs claude-text-muted",children:["Joined: ",t.joinDate.toLocaleDateString()]})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[t.isPremium&&i.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"Premium"}),t.isAdmin&&i.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Admin"})]})]}),i.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Profile:"}),i.jsx("span",{children:t.profile?.displayName?"Complete":"Incomplete"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Last Seen:"}),i.jsx("span",{children:t.lastSeen.toLocaleDateString()})]})]}),i.jsx("div",{className:"space-y-2",children:i.jsx("button",{onClick:()=>e(t.id,!t.isPremium),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t.isPremium?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.isPremium?" Remove Premium":" Grant Premium"})})]},t.id))})]}),eV=({publicCards:s,onModerate:e})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",children:"Content Moderation"}),i.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," public cards"]})]}),i.jsxs("div",{className:"space-y-4",children:[s.map(t=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("h4",{className:"font-bold mb-2",children:[t.statement?.substring(0,100),"..."]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm claude-text-muted",children:[i.jsxs("span",{children:["By: ",t.author?.displayName||t.author?.email||"Unknown"]}),i.jsxs("span",{children:["Created: ",t.createdDate.toLocaleDateString()]}),i.jsxs("span",{children:["Likes: ",t.likeCount||0]}),i.jsxs("span",{children:["Views: ",t.viewCount||0]})]})]}),i.jsxs("div",{className:"flex gap-2 ml-4",children:[i.jsx("button",{onClick:()=>e(t.id,"hide","Hidden by admin"),className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-sm hover:bg-yellow-200",children:" Hide"}),i.jsx("button",{onClick:()=>e(t.id,"remove","Removed by admin"),className:"px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200",children:" Remove"})]})]}),t.isHidden&&i.jsx("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:" This card is currently hidden from public view"}),t.isRemoved&&i.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:" This card has been removed"})]},t.id)),s.length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No public cards found"})]})]}),tV=({adminActivity:s})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h3",{className:"text-xl font-bold",children:"Admin Activity Log"}),i.jsxs("div",{className:"text-sm claude-text-muted",children:["Recent ",s.length," actions"]})]}),i.jsxs("div",{className:"space-y-3",children:[s.map(e=>i.jsx("div",{className:"claude-card p-4 rounded-xl",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:e.action.replace(/_/g," ").toUpperCase()}),i.jsxs("div",{className:"text-sm claude-text-muted",children:["By: ",e.admin?.displayName||e.admin?.email||"Unknown"]}),e.details&&Object.keys(e.details).length>0&&i.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:["Details: ",JSON.stringify(e.details,null,2)]})]}),i.jsx("div",{className:"text-xs claude-text-muted",children:e.timestamp.toLocaleString()})]})},e.id)),s.length===0&&i.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No admin activity recorded"})]})]}),Qf=({title:s,value:e,icon:t,color:n,subtitle:a})=>i.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("div",{className:"text-2xl",children:t}),i.jsx("div",{className:`w-3 h-3 rounded-full bg-${n}-500`})]}),i.jsx("div",{className:`text-2xl font-bold mb-1 text-${n}-600`,children:e}),i.jsx("div",{className:"text-sm font-medium mb-1",children:s}),a&&i.jsx("div",{className:"text-xs claude-text-muted",children:a})]});function nV(){const[s,e]=P.useState("home"),[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState(null),[m,p]=P.useState({hasProfile:!1,hasCards:!1}),[x,w]=P.useState(!1),[b,E]=P.useState(!1),[C,k]=P.useState(!1),[L,U]=P.useState(!1),[F,B]=P.useState(0),[H,$]=P.useState(!1),{user:M,signInWithGoogle:R,logout:N,authError:A,getFreshIdToken:V,sessionWarning:I,dismissSessionWarning:G}=Rn();P.useEffect(()=>{M&&Ve()},[M]),P.useEffect(()=>{Bn.initializeAutoTracking(M?.uid),Bn.trackFeatureUsage("app","loaded",{userLoggedIn:!!M},M?.uid)},[]),P.useEffect(()=>{if(s){Bn.trackPageView(`/new/${s}`,null,M?.uid),Bn.trackUserFlow(localStorage.getItem("lastMode")||"home",s,"navigation",M?.uid),localStorage.setItem("lastMode",s);const pe=new URL(window.location);pe.searchParams.set("mode",s),window.history.replaceState({mode:s},"",pe.toString())}},[s]),P.useEffect(()=>{const pe=we=>{const Fe=new URLSearchParams(window.location.search).get("mode")||we.state?.mode||"home";e(Fe)};window.addEventListener("popstate",pe);const ce=new URLSearchParams(window.location.search).get("mode");return ce&&e(ce),()=>window.removeEventListener("popstate",pe)},[]),P.useEffect(()=>{M?(Bn.trackConversion("user_login",1,M.uid),Bn.trackFeatureUsage("auth","login_success",{},M.uid),O()):$(!1)},[M]);const O=async()=>{try{const pe=await Cr.verifyAdminAccess(M);$(pe)}catch(pe){console.error("Error checking admin status:",pe),$(!1)}},Ve=async()=>{try{const pe=await um.checkOnboardingStatus(M.uid),Ee=await As.hasProfile(M.uid);try{const ce=await um.autoMigrateUserDecks(M.uid);ce.success&&ce.migrationResult&&console.log(" Deck migration completed:",ce.message)}catch(ce){console.warn("Deck migration failed:",ce)}p({...pe,hasProfile:pe.hasProfile||Ee})}catch(pe){console.error("Error checking onboarding status:",pe)}},ae=async()=>{try{await R()}catch(pe){console.error("Error signing in:",pe)}},z=async()=>{try{await N()}catch(pe){console.error("Error signing out:",pe)}},oe=async()=>{if(!M){await ae();return}try{const pe=await um.getUserProfile(M.uid);e(pe?"dashboard":"create-profile")}catch(pe){console.error("Error checking profile:",pe),e("create-profile")}},Y=async pe=>{if(!M){await ae();return}pe==="profile"&&!m.hasProfile&&e("create-profile")},be=async()=>{await Ve(),e("home")},D=pe=>{n(pe),e("profile")},te=()=>{B(pe=>pe+1),M&&Ve()},xe=()=>{switch(s){case"create":return i.jsx(T5,{onCardCreated:te,onClose:()=>e("home")});case"study":return i.jsx(E5,{},F);case"search":return i.jsx(S5,{});case"decks":return i.jsx(hO,{onCreateDeck:()=>e("create-deck"),onEditDeck:pe=>{l(pe),e("edit-deck")},onSelectDeck:pe=>{h(pe),e("study")}});case"create-deck":return i.jsx(WT,{onDeckCreated:()=>e("decks"),onClose:()=>e("decks")});case"edit-deck":return i.jsx(WT,{editingDeck:a,onDeckCreated:()=>{l(null),e("decks")},onClose:()=>{l(null),e("decks")}});case"analytics":return i.jsx(mO,{onClose:()=>e("home")});case"admin-analytics":return i.jsx(vO,{onClose:()=>e("home")});case"admin-dashboard":return i.jsx(WO,{onClose:()=>e("home")});case"leaderboard":return i.jsx(j5,{});case"dashboard":return i.jsx(J5,{});case"icon-test":return i.jsx(EO,{});case"create-profile":return i.jsx(lO,{onProfileCreated:be,onClose:()=>e("home")});case"social":return i.jsx(cO,{onViewProfile:D});case"profile":return i.jsx(dO,{profileSlug:t,onClose:()=>e("home")});default:return Ie()}},ue=()=>{const[pe,Ee]=P.useState(!1),[ce,we]=P.useState(!1),[Se,Fe]=P.useState(!1),[Ze,Ge]=P.useState(!1);return i.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-md border-b",style:{backgroundColor:"rgba(246, 245, 236, 0.8)",borderBottomColor:"var(--border-light)"},children:[i.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3 group cursor-pointer",onClick:()=>e("home"),children:[i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"40",height:"40",className:"rounded-xl shadow-lg group-hover:shadow-blue-500/25 transition-all duration-300 group-hover:scale-105"}),i.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"})]}),i.jsx("span",{className:"text-xl md:text-2xl font-extrabold tracking-tight",style:{color:"var(--claude-heading)"},children:"ThreeSided"})]}),s==="home"&&M&&i.jsxs("div",{className:"hidden lg:flex items-center gap-3",children:[i.jsxs("button",{className:"claude-button-secondary flex items-center gap-2",onClick:()=>e("search"),children:[i.jsx(Ii,{size:16,color:"default"}),"Search"]}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>we(!ce),onBlur:()=>setTimeout(()=>we(!1),200),children:[i.jsx(qa,{size:16,color:"default"}),"Study "]}),ce&&i.jsxs("div",{className:"absolute top-full mt-1 left-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),we(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(qa,{size:16,color:"default"}),"My Decks"]})}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),we(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(fm,{size:16,color:"default"}),"Study Mode"]})}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),we(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Fi,{size:16,color:"default"}),"Create Flashcard"]})})]})]}),i.jsx("button",{className:"claude-button-secondary",onClick:()=>e("social"),children:" Social"}),i.jsxs("button",{className:"claude-button-secondary flex items-center gap-2",onClick:()=>e("leaderboard"),children:[i.jsx(Ld,{size:16,color:"default"}),"Leaderboard"]}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>Fe(!Se),onBlur:()=>setTimeout(()=>Fe(!1),200),children:[i.jsx(Ec,{size:16,color:"default"}),"Account "]}),Se&&i.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Fe(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(dn,{size:16,color:"default"}),"My Dashboard"]})}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{oe(),Fe(!1)},children:" My Profile"}),i.jsx("div",{className:"border-t border-gray-200 my-1"}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Fe(!1),Bn.trackClick("button",{text:"Analytics",action:"view_analytics"},M?.uid)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(dn,{size:16,color:"default"}),"Learning Analytics"]})})]})]}),H&&i.jsxs("div",{className:"relative",children:[i.jsx("button",{className:"claude-button-secondary bg-red-50 text-red-700 hover:bg-red-100 border-red-200 flex items-center gap-1",onClick:()=>Ge(!Ze),onBlur:()=>setTimeout(()=>Ge(!1),200),children:" Admin "}),Ze&&i.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("admin-analytics"),Ge(!1),Bn.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},M?.uid)},children:" Website Analytics"}),i.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors text-red-600",onClick:()=>{e("admin-dashboard"),Ge(!1),Bn.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},M?.uid)},children:" Admin Dashboard"})]})]})]}),s!=="home"&&i.jsx("div",{className:"hidden md:block",children:i.jsxs("span",{className:"text-lg font-bold",style:{color:"var(--claude-heading)"},children:[s==="create"&&" Create Flashcard",s==="study"&&" Study Mode",s==="search"&&" Search & Discovery",s==="decks"&&" My Decks",s==="create-deck"&&" Create Deck",s==="edit-deck"&&" Edit Deck",s==="analytics"&&" Learning Analytics",s==="admin-analytics"&&" Website Analytics",s==="admin-dashboard"&&" Admin Dashboard",s==="leaderboard"&&" Leaderboard & Stats",s==="dashboard"&&" My Dashboard",t&&" Profile",!t&&s==="social"&&" Social Hub",!t&&s==="create-profile"&&" Create Profile"]})}),i.jsxs("div",{className:"flex items-center gap-3",children:[M&&i.jsx("button",{className:"lg:hidden claude-button-secondary",onClick:()=>Ee(!pe),children:""}),M?i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-2 rounded-xl",style:{backgroundColor:"rgba(91, 200, 162, 0.15)",border:"1px solid var(--success)",color:"var(--success)"},children:[i.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),i.jsx("span",{className:"text-sm font-medium",children:M.displayName?.split(" ")[0]||"User"})]}),i.jsx("button",{className:"claude-button-secondary",style:{borderColor:"var(--error)",color:"var(--error)"},onClick:z,children:"Sign Out"})]}):i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[A&&i.jsx("div",{className:"text-xs text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200 max-w-xs text-right",children:A}),i.jsx("button",{className:"claude-button-primary transform hover:scale-105 transition-all duration-200",onClick:ae,style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:" Sign In"})]})]})]}),M&&pe&&i.jsx("div",{className:"lg:hidden bg-white border-t border-gray-200 shadow-lg",children:i.jsxs("div",{className:"px-4 py-3 space-y-2",children:[i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("search"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ii,{size:16,color:"default"}),"Search"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(qa,{size:16,color:"default"}),"My Decks"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(fm,{size:16,color:"default"}),"Study Mode"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Fi,{size:16,color:"default"}),"Create Flashcard"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("social"),Ee(!1)},children:" Social"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("leaderboard"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ld,{size:16,color:"default"}),"Leaderboard"]})}),i.jsx("div",{className:"border-t border-gray-200 my-2"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(dn,{size:16,color:"default"}),"My Dashboard"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{oe(),Ee(!1)},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ec,{size:16,color:"default"}),"My Profile"]})}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Ee(!1),Bn.trackClick("button",{text:"Analytics",action:"view_analytics"},M?.uid)},children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(dn,{size:16,color:"default"}),"Learning Analytics"]})}),H&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"border-t border-red-200 my-2"}),i.jsx("div",{className:"px-3 py-1 text-xs font-semibold text-red-600 bg-red-50 rounded-lg mb-2",children:" ADMIN CONTROLS"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-analytics"),Ee(!1),Bn.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},M?.uid)},children:" Website Analytics"}),i.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-dashboard"),Ee(!1),Bn.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},M?.uid)},children:" Admin Dashboard"})]})]})})]})},Ie=()=>i.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[!M&&i.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[i.jsxs("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, var(--claude-background) 0%, var(--claude-subtle) 50%, var(--claude-surface) 100%)"},children:[i.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234B284E' fill-opacity='0.05'%3E%3Cpath d='m36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),i.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(99, 91, 255, 0.08)"}}),i.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(68, 90, 255, 0.08)",animationDelay:"1s"}}),i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full blur-2xl animate-pulse",style:{backgroundColor:"rgba(91, 194, 162, 0.08)",animationDelay:"2s"}})]}),i.jsxs("div",{className:"max-w-7xl mx-auto px-4 relative z-10 text-center py-24",children:[i.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full mb-8",style:{backgroundColor:"rgba(91, 194, 162, 0.15)",border:"1px solid var(--claude-success)",color:"var(--claude-success)"},children:[i.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--claude-success)"}}),i.jsx("span",{className:"text-sm font-semibold",children:" New React Version - Live Now"})]}),i.jsxs("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-extrabold tracking-tight mb-8",style:{color:"var(--heading)"},children:["Master Any Subject",i.jsx("br",{}),i.jsx("span",{style:{color:"var(--accent-primary)"},children:"with ThreeSided"})]}),i.jsxs("p",{className:"text-xl md:text-2xl max-w-4xl mx-auto mb-12 leading-relaxed claude-text-secondary",children:["Create, study, and share flashcards with ",i.jsx("span",{style:{color:"var(--claude-accent)",fontWeight:"600"},children:"AI assistance"}),". Learn faster with ",i.jsx("span",{style:{color:"var(--claude-accent-blue)",fontWeight:"600"},children:"spaced repetition"})," and a",i.jsx("span",{style:{color:"var(--claude-success)",fontWeight:"600"},children:" community library"}),"."]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[i.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group relative min-w-[200px] transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)",boxShadow:"0 8px 32px rgba(155, 139, 115, 0.25)"},children:[i.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[i.jsx(Ii,{size:20,color:"default"}),i.jsx("span",{children:"Search Flashcards"})]}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),i.jsx("button",{onClick:()=>e("leaderboard"),className:"claude-button-secondary group transform hover:scale-105 transition-all duration-300 min-w-[200px]",children:i.jsxs("span",{className:"flex items-center gap-3",children:[i.jsx(Ld,{size:20,color:"default"}),i.jsx("span",{children:"View Leaderboard"})]})})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-8 justify-center items-center mt-16",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"500+"}),i.jsx("div",{className:"claude-text-muted",children:"Flashcards"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),i.jsx("div",{className:"claude-text-muted",children:"Students"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),i.jsx("div",{className:"claude-text-muted",children:"Public"})]})]})]}),i.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce",children:i.jsx("div",{className:"w-6 h-10 border-2 border-neutral-400 rounded-full flex justify-center",children:i.jsx("div",{className:"w-1 h-3 bg-neutral-400 rounded-full mt-2 animate-pulse"})})})]}),i.jsxs("div",{className:`max-w-7xl mx-auto px-4 ${M?"py-8":"py-16"}`,children:[M&&i.jsxs("div",{className:"relative p-8 mb-16 rounded-3xl bg-neutral-800/50 border border-neutral-700 backdrop-blur-sm shadow-2xl",children:[i.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r from-blue-500/5 to-purple-500/5"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsxs("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--claude-heading)"},children:[i.jsx(Gm,{size:24,color:"primary"}),"Quick Actions"]}),i.jsx("p",{className:"text-neutral-300 text-lg",children:"Jump into your learning journey"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6",children:[i.jsxs("button",{onClick:()=>{e("create"),Bn.trackClick("homepage_action",{action:"create_flashcard",location:"quick_actions"},M?.uid),Bn.trackFeatureUsage("flashcard","create_started",{},M?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(Fi,{size:32,color:"default"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Create"}),i.jsx("div",{className:"text-white/90 text-sm",children:"New Flashcard"})]})]}),i.jsxs("button",{onClick:()=>{e("study"),Bn.trackClick("homepage_action",{action:"study_mode",location:"quick_actions"},M?.uid),Bn.trackFeatureUsage("study","session_started",{},M?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #B8A082 0%, #A68B5B 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(P1,{size:32,color:"default"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Study"}),i.jsx("div",{className:"text-white/90 text-sm",children:"Practice Mode"})]})]}),i.jsxs("button",{onClick:()=>e("search"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(Ii,{size:32,color:"default"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Search"}),i.jsx("div",{className:"text-white/90 text-sm",children:"& Discover"})]})]}),i.jsxs("button",{onClick:()=>e("dashboard"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #7E6B5A 0%, #6D5A4A 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(fm,{size:32,color:"default"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Dashboard"}),i.jsx("div",{className:"text-white/90 text-sm",children:"My Progress"})]})]}),i.jsxs("button",{onClick:()=>e("decks"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #6B5B4A 0%, #5A4A3A 100%)"},children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center text-white",children:[i.jsx("div",{className:"text-4xl mb-3",children:i.jsx(qa,{size:32,color:"default"})}),i.jsx("div",{className:"font-bold text-lg mb-1",children:"Decks"}),i.jsx("div",{className:"text-white/90 text-sm",children:"Organize Cards"})]})]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 gap-8 mb-16 lg:grid-cols-3",children:[i.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#D4A574] to-[#C19A6B] rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:i.jsx(M1,{size:32,color:"default"})}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"CommunityDriven"}),i.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Discover and share flashcards with students worldwide. Learn from the community's collective knowledge and contribute your own."})]})]}),i.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#B8A082] to-[#A68B5B] rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:i.jsx(R1,{size:32,color:"default"})}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"AIPowered Assistance"}),i.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Get AIgenerated hints, proofs, and suggestions to help you create better flashcards faster and study more effectively."})]})]}),i.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),i.jsxs("div",{className:"relative z-10 text-center",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#9B8B73] to-[#8A7A63] rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:i.jsx(k1,{size:32,color:"default"})}),i.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"LaTeX Support"}),i.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Beautiful mathematical notation with full LaTeX rendering. Use $...$ for inline math and $$...$$ for display blocks."})]})]})]}),i.jsxs("div",{className:"claude-card relative p-8 mb-16 backdrop-blur-sm shadow-2xl",children:[i.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-success-500/5 to-accent-500/5"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsxs("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--heading)"},children:[i.jsx(Gm,{size:32,color:"primary"}),"Get Started"]}),i.jsx("p",{className:"claude-text-secondary text-lg",children:"Complete these quick steps to join our community"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 cursor-pointer ${M?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10"}`,onClick:()=>Y("login"),children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${M?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:M?i.jsx(hm,{size:16,color:"success"}):"1"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:M?"Signed In":"Sign In"}),i.jsx("div",{className:"claude-text-secondary text-sm",children:M?`Welcome, ${M.displayName?.split(" ")[0]||"User"}!`:"Use Google to get started"})]})]})}),i.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasProfile?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":M?"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10 cursor-pointer":"bg-white/5 border-white/10 opacity-50"}`,onClick:M&&!m.hasProfile?()=>Y("profile"):void 0,children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasProfile?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:m.hasProfile?i.jsx(hm,{size:16,color:"success"}):"2"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasProfile?"Profile Created":"Create Profile"}),i.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasProfile?"Profile is ready!":"Set display name & avatar"})]})]})}),i.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasCards?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":M?"bg-white/5 border-white/20":"bg-white/5 border-white/10 opacity-50"}`,children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasCards?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:m.hasCards?i.jsx(hm,{size:16,color:"success"}):"3"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasCards?"First Card Published":"Publish First Card"}),i.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasCards?"Nice work!":"Share with the community"})]})]})})]}),M&&!m.hasCards&&i.jsx("div",{className:"text-center mt-8",children:i.jsxs("button",{onClick:()=>e("create"),className:"claude-button-primary px-8 py-4 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #D4A574 0%, #C19A6B 100%)"},children:[i.jsx(Fi,{size:20,color:"default"}),"Create Your First Card"]})})]})]}),i.jsxs("div",{className:"relative overflow-hidden p-16 mb-16 rounded-3xl bg-gradient-to-br from-accent-500/20 via-primary-500/20 to-secondary-500/20 border border-white/20 text-center group hover:scale-105 transition-all duration-500",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-accent-500/10 to-primary-500/10"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-accent-400 to-primary-500 rounded-3xl mb-8 text-5xl shadow-2xl group-hover:shadow-glow/80 transition-all duration-300",children:i.jsx(Ii,{size:40,color:"default"})}),i.jsxs("h2",{className:"text-4xl md:text-5xl font-extrabold mb-6",style:{color:"var(--heading)"},children:[i.jsx(Ii,{size:32,color:"primary"}),"Looking for something specific?"]}),i.jsxs("p",{className:"text-xl claude-text-secondary max-w-3xl mx-auto mb-8 leading-relaxed",children:["Search our community database of ",i.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"600"},children:"10,000+ flashcards"})," from",i.jsx("span",{style:{color:"var(--accent-secondary)",fontWeight:"600"},children:" students worldwide"}),". Find exactly what you need to ace your studies."]}),i.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group/btn relative overflow-hidden px-12 py-6 font-semibold text-lg shadow-2xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #9B8B73 0%, #8A7A63 100%)"},children:[i.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[i.jsx(Ii,{size:20,color:"default"}),i.jsx("span",{children:"Search Community Flashcards"})]}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 opacity-0 group-hover/btn:opacity-100 transition-opacity duration-300"})]})]})]}),i.jsx("footer",{className:"claude-card relative overflow-hidden mt-24 py-16",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"inline-flex items-center gap-3 mb-4",children:[i.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"48",height:"48",className:"rounded-xl shadow-lg"}),i.jsx("span",{className:"text-3xl font-extrabold",style:{color:"var(--heading)"},children:"ThreeSided"})]}),i.jsx("p",{className:"claude-text-secondary text-lg max-w-2xl mx-auto",children:"Empowering students worldwide with AI-enhanced flashcards and collaborative learning."})]}),i.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-8 pt-8",style:{borderTop:"1px solid var(--border-light)"},children:[i.jsxs("div",{className:"claude-text-muted",children:[" ",new Date().getFullYear()," ThreeSided. Made with ",i.jsx(D1,{size:16,color:"error"})," for students."]}),i.jsxs("div",{className:"flex items-center gap-8",children:[i.jsx("a",{href:"mailto:amirbattye@gmail.com",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-primary)"},children:"Contact"}),i.jsx("a",{href:"/latex_guide.html",target:"_blank",rel:"noreferrer",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-secondary)"},children:"LaTeX Guide"}),i.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:[i.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),i.jsx("span",{className:"font-medium",children:"Beta"})]})]})]})]})})]})]});return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(ue,{}),xe(),i.jsx(eO,{isVisible:x,onClose:()=>w(!1),selectedTags:[],onTagsChange:()=>{}}),i.jsx(sO,{isVisible:b,onClose:()=>E(!1)}),i.jsx(aO,{isVisible:C,onClose:()=>k(!1)}),i.jsx(oO,{isVisible:L,onClose:()=>U(!1)}),I&&i.jsx("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4 shadow-2xl",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("h3",{className:"text-lg font-bold text-orange-600",children:"Session Timeout Warning"})]}),i.jsx("p",{className:"text-gray-700 mb-6",children:`Your session will expire soon due to inactivity. Click "Stay Active" to continue, or you'll be signed out automatically.`}),i.jsxs("div",{className:"flex gap-3 justify-end",children:[i.jsx("button",{onClick:()=>{G(),N()},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Sign Out"}),i.jsx("button",{onClick:G,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Stay Active"})]})]})})]})}const sV=()=>i.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"var(--background-main)"},children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-t-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-lg font-medium",style:{color:"var(--text-main)"},children:"Loading Three-Sided..."})]})});bI.createRoot(document.getElementById("root")).render(i.jsx(P.StrictMode,{children:i.jsx(x5,{fallback:i.jsx(sV,{}),children:i.jsx(nV,{})})}));
