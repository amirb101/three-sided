(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();var my={exports:{}},td={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pw;function QC(){if(pw)return td;pw=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,a,l){var u=null;if(l!==void 0&&(u=""+l),a.key!==void 0&&(u=""+a.key),"key"in a){l={};for(var h in a)h!=="key"&&(l[h]=a[h])}else l=a;return a=l.ref,{$$typeof:s,type:n,key:u,ref:a!==void 0?a:null,props:l}}return td.Fragment=e,td.jsx=t,td.jsxs=t,td}var yw;function YC(){return yw||(yw=1,my.exports=QC()),my.exports}var o=YC(),gy={exports:{}},We={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xw;function XC(){if(xw)return We;xw=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),_=Symbol.iterator;function b(D){return D===null||typeof D!="object"?null:(D=_&&D[_]||D["@@iterator"],typeof D=="function"?D:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,k={};function L(D,se,xe){this.props=D,this.context=se,this.refs=k,this.updater=xe||N}L.prototype.isReactComponent={},L.prototype.setState=function(D,se){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,se,"setState")},L.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function F(){}F.prototype=L.prototype;function U(D,se,xe){this.props=D,this.context=se,this.refs=k,this.updater=xe||N}var B=U.prototype=new F;B.constructor=U,C(B,L.prototype),B.isPureReactComponent=!0;var H=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},M=Object.prototype.hasOwnProperty;function R(D,se,xe,ue,Ie,pe){return xe=pe.ref,{$$typeof:s,type:D,key:se,ref:xe!==void 0?xe:null,props:pe}}function T(D,se){return R(D.type,se,void 0,void 0,void 0,D.props)}function A(D){return typeof D=="object"&&D!==null&&D.$$typeof===s}function V(D){var se={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(xe){return se[xe]})}var I=/\/+/g;function G(D,se){return typeof D=="object"&&D!==null&&D.key!=null?V(""+D.key):se.toString(36)}function O(){}function Ve(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(O,O):(D.status="pending",D.then(function(se){D.status==="pending"&&(D.status="fulfilled",D.value=se)},function(se){D.status==="pending"&&(D.status="rejected",D.reason=se)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function ae(D,se,xe,ue,Ie){var pe=typeof D;(pe==="undefined"||pe==="boolean")&&(D=null);var Ne=!1;if(D===null)Ne=!0;else switch(pe){case"bigint":case"string":case"number":Ne=!0;break;case"object":switch(D.$$typeof){case s:case e:Ne=!0;break;case x:return Ne=D._init,ae(Ne(D._payload),se,xe,ue,Ie)}}if(Ne)return Ie=Ie(D),Ne=ue===""?"."+G(D,0):ue,H(Ie)?(xe="",Ne!=null&&(xe=Ne.replace(I,"$&/")+"/"),ae(Ie,se,xe,"",function(Se){return Se})):Ie!=null&&(A(Ie)&&(Ie=T(Ie,xe+(Ie.key==null||D&&D.key===Ie.key?"":(""+Ie.key).replace(I,"$&/")+"/")+Ne)),se.push(Ie)),1;Ne=0;var ce=ue===""?".":ue+":";if(H(D))for(var _e=0;_e<D.length;_e++)ue=D[_e],pe=ce+G(ue,_e),Ne+=ae(ue,se,xe,pe,Ie);else if(_e=b(D),typeof _e=="function")for(D=_e.call(D),_e=0;!(ue=D.next()).done;)ue=ue.value,pe=ce+G(ue,_e++),Ne+=ae(ue,se,xe,pe,Ie);else if(pe==="object"){if(typeof D.then=="function")return ae(Ve(D),se,xe,ue,Ie);throw se=String(D),Error("Objects are not valid as a React child (found: "+(se==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":se)+"). If you meant to render a collection of children, use an array instead.")}return Ne}function z(D,se,xe){if(D==null)return D;var ue=[],Ie=0;return ae(D,ue,"","",function(pe){return se.call(xe,pe,Ie++)}),ue}function oe(D){if(D._status===-1){var se=D._result;se=se(),se.then(function(xe){(D._status===0||D._status===-1)&&(D._status=1,D._result=xe)},function(xe){(D._status===0||D._status===-1)&&(D._status=2,D._result=xe)}),D._status===-1&&(D._status=0,D._result=se)}if(D._status===1)return D._result.default;throw D._result}var Y=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var se=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(se))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)};function be(){}return We.Children={map:z,forEach:function(D,se,xe){z(D,function(){se.apply(this,arguments)},xe)},count:function(D){var se=0;return z(D,function(){se++}),se},toArray:function(D){return z(D,function(se){return se})||[]},only:function(D){if(!A(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},We.Component=L,We.Fragment=t,We.Profiler=a,We.PureComponent=U,We.StrictMode=n,We.Suspense=m,We.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,We.__COMPILER_RUNTIME={__proto__:null,c:function(D){return $.H.useMemoCache(D)}},We.cache=function(D){return function(){return D.apply(null,arguments)}},We.cloneElement=function(D,se,xe){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var ue=C({},D.props),Ie=D.key,pe=void 0;if(se!=null)for(Ne in se.ref!==void 0&&(pe=void 0),se.key!==void 0&&(Ie=""+se.key),se)!M.call(se,Ne)||Ne==="key"||Ne==="__self"||Ne==="__source"||Ne==="ref"&&se.ref===void 0||(ue[Ne]=se[Ne]);var Ne=arguments.length-2;if(Ne===1)ue.children=xe;else if(1<Ne){for(var ce=Array(Ne),_e=0;_e<Ne;_e++)ce[_e]=arguments[_e+2];ue.children=ce}return R(D.type,Ie,void 0,void 0,pe,ue)},We.createContext=function(D){return D={$$typeof:u,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:l,_context:D},D},We.createElement=function(D,se,xe){var ue,Ie={},pe=null;if(se!=null)for(ue in se.key!==void 0&&(pe=""+se.key),se)M.call(se,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Ie[ue]=se[ue]);var Ne=arguments.length-2;if(Ne===1)Ie.children=xe;else if(1<Ne){for(var ce=Array(Ne),_e=0;_e<Ne;_e++)ce[_e]=arguments[_e+2];Ie.children=ce}if(D&&D.defaultProps)for(ue in Ne=D.defaultProps,Ne)Ie[ue]===void 0&&(Ie[ue]=Ne[ue]);return R(D,pe,void 0,void 0,null,Ie)},We.createRef=function(){return{current:null}},We.forwardRef=function(D){return{$$typeof:h,render:D}},We.isValidElement=A,We.lazy=function(D){return{$$typeof:x,_payload:{_status:-1,_result:D},_init:oe}},We.memo=function(D,se){return{$$typeof:p,type:D,compare:se===void 0?null:se}},We.startTransition=function(D){var se=$.T,xe={};$.T=xe;try{var ue=D(),Ie=$.S;Ie!==null&&Ie(xe,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(be,Y)}catch(pe){Y(pe)}finally{$.T=se}},We.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},We.use=function(D){return $.H.use(D)},We.useActionState=function(D,se,xe){return $.H.useActionState(D,se,xe)},We.useCallback=function(D,se){return $.H.useCallback(D,se)},We.useContext=function(D){return $.H.useContext(D)},We.useDebugValue=function(){},We.useDeferredValue=function(D,se){return $.H.useDeferredValue(D,se)},We.useEffect=function(D,se,xe){var ue=$.H;if(typeof xe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ue.useEffect(D,se)},We.useId=function(){return $.H.useId()},We.useImperativeHandle=function(D,se,xe){return $.H.useImperativeHandle(D,se,xe)},We.useInsertionEffect=function(D,se){return $.H.useInsertionEffect(D,se)},We.useLayoutEffect=function(D,se){return $.H.useLayoutEffect(D,se)},We.useMemo=function(D,se){return $.H.useMemo(D,se)},We.useOptimistic=function(D,se){return $.H.useOptimistic(D,se)},We.useReducer=function(D,se,xe){return $.H.useReducer(D,se,xe)},We.useRef=function(D){return $.H.useRef(D)},We.useState=function(D){return $.H.useState(D)},We.useSyncExternalStore=function(D,se,xe){return $.H.useSyncExternalStore(D,se,xe)},We.useTransition=function(){return $.H.useTransition()},We.version="19.1.1",We}var vw;function Dx(){return vw||(vw=1,gy.exports=XC()),gy.exports}var P=Dx(),py={exports:{}},nd={},yy={exports:{}},xy={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bw;function WC(){return bw||(bw=1,(function(s){function e(z,oe){var Y=z.length;z.push(oe);e:for(;0<Y;){var be=Y-1>>>1,D=z[be];if(0<a(D,oe))z[be]=oe,z[Y]=D,Y=be;else break e}}function t(z){return z.length===0?null:z[0]}function n(z){if(z.length===0)return null;var oe=z[0],Y=z.pop();if(Y!==oe){z[0]=Y;e:for(var be=0,D=z.length,se=D>>>1;be<se;){var xe=2*(be+1)-1,ue=z[xe],Ie=xe+1,pe=z[Ie];if(0>a(ue,Y))Ie<D&&0>a(pe,ue)?(z[be]=pe,z[Ie]=Y,be=Ie):(z[be]=ue,z[xe]=Y,be=xe);else if(Ie<D&&0>a(pe,Y))z[be]=pe,z[Ie]=Y,be=Ie;else break e}}return oe}function a(z,oe){var Y=z.sortIndex-oe.sortIndex;return Y!==0?Y:z.id-oe.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;s.unstable_now=function(){return l.now()}}else{var u=Date,h=u.now();s.unstable_now=function(){return u.now()-h}}var m=[],p=[],x=1,_=null,b=3,N=!1,C=!1,k=!1,L=!1,F=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function H(z){for(var oe=t(p);oe!==null;){if(oe.callback===null)n(p);else if(oe.startTime<=z)n(p),oe.sortIndex=oe.expirationTime,e(m,oe);else break;oe=t(p)}}function $(z){if(k=!1,H(z),!C)if(t(m)!==null)C=!0,M||(M=!0,G());else{var oe=t(p);oe!==null&&ae($,oe.startTime-z)}}var M=!1,R=-1,T=5,A=-1;function V(){return L?!0:!(s.unstable_now()-A<T)}function I(){if(L=!1,M){var z=s.unstable_now();A=z;var oe=!0;try{e:{C=!1,k&&(k=!1,U(R),R=-1),N=!0;var Y=b;try{t:{for(H(z),_=t(m);_!==null&&!(_.expirationTime>z&&V());){var be=_.callback;if(typeof be=="function"){_.callback=null,b=_.priorityLevel;var D=be(_.expirationTime<=z);if(z=s.unstable_now(),typeof D=="function"){_.callback=D,H(z),oe=!0;break t}_===t(m)&&n(m),H(z)}else n(m);_=t(m)}if(_!==null)oe=!0;else{var se=t(p);se!==null&&ae($,se.startTime-z),oe=!1}}break e}finally{_=null,b=Y,N=!1}oe=void 0}}finally{oe?G():M=!1}}}var G;if(typeof B=="function")G=function(){B(I)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,Ve=O.port2;O.port1.onmessage=I,G=function(){Ve.postMessage(null)}}else G=function(){F(I,0)};function ae(z,oe){R=F(function(){z(s.unstable_now())},oe)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(z){z.callback=null},s.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<z?Math.floor(1e3/z):5},s.unstable_getCurrentPriorityLevel=function(){return b},s.unstable_next=function(z){switch(b){case 1:case 2:case 3:var oe=3;break;default:oe=b}var Y=b;b=oe;try{return z()}finally{b=Y}},s.unstable_requestPaint=function(){L=!0},s.unstable_runWithPriority=function(z,oe){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var Y=b;b=z;try{return oe()}finally{b=Y}},s.unstable_scheduleCallback=function(z,oe,Y){var be=s.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?be+Y:be):Y=be,z){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=Y+D,z={id:x++,callback:oe,priorityLevel:z,startTime:Y,expirationTime:D,sortIndex:-1},Y>be?(z.sortIndex=Y,e(p,z),t(m)===null&&z===t(p)&&(k?(U(R),R=-1):k=!0,ae($,Y-be))):(z.sortIndex=D,e(m,z),C||N||(C=!0,M||(M=!0,G()))),z},s.unstable_shouldYield=V,s.unstable_wrapCallback=function(z){var oe=b;return function(){var Y=b;b=oe;try{return z.apply(this,arguments)}finally{b=Y}}}})(xy)),xy}var _w;function JC(){return _w||(_w=1,yy.exports=WC()),yy.exports}var vy={exports:{}},ns={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ww;function ZC(){if(ww)return ns;ww=1;var s=Dx();function e(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(m,p,x){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:m,containerInfo:p,implementation:x}}var u=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return ns.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,ns.createPortal=function(m,p){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(m,p,null,x)},ns.flushSync=function(m){var p=u.T,x=n.p;try{if(u.T=null,n.p=2,m)return m()}finally{u.T=p,n.p=x,n.d.f()}},ns.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,n.d.C(m,p))},ns.prefetchDNS=function(m){typeof m=="string"&&n.d.D(m)},ns.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var x=p.as,_=h(x,p.crossOrigin),b=typeof p.integrity=="string"?p.integrity:void 0,N=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;x==="style"?n.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:_,integrity:b,fetchPriority:N}):x==="script"&&n.d.X(m,{crossOrigin:_,integrity:b,fetchPriority:N,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},ns.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var x=h(p.as,p.crossOrigin);n.d.M(m,{crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&n.d.M(m)},ns.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var x=p.as,_=h(x,p.crossOrigin);n.d.L(m,x,{crossOrigin:_,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},ns.preloadModule=function(m,p){if(typeof m=="string")if(p){var x=h(p.as,p.crossOrigin);n.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else n.d.m(m)},ns.requestFormReset=function(m){n.d.r(m)},ns.unstable_batchedUpdates=function(m,p){return m(p)},ns.useFormState=function(m,p,x){return u.H.useFormState(m,p,x)},ns.useFormStatus=function(){return u.H.useHostTransitionStatus()},ns.version="19.1.1",ns}var Tw;function e1(){if(Tw)return vy.exports;Tw=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),vy.exports=ZC(),vy.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ew;function t1(){if(Ew)return nd;Ew=1;var s=JC(),e=Dx(),t=e1();function n(r){var i="https://react.dev/errors/"+r;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)i+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var i=r,c=r;if(r.alternate)for(;i.return;)i=i.return;else{r=i;do i=r,(i.flags&4098)!==0&&(c=i.return),r=i.return;while(r)}return i.tag===3?c:null}function u(r){if(r.tag===13){var i=r.memoizedState;if(i===null&&(r=r.alternate,r!==null&&(i=r.memoizedState)),i!==null)return i.dehydrated}return null}function h(r){if(l(r)!==r)throw Error(n(188))}function m(r){var i=r.alternate;if(!i){if(i=l(r),i===null)throw Error(n(188));return i!==r?null:r}for(var c=r,d=i;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(d=g.return,d!==null){c=d;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return h(g),r;if(y===d)return h(g),i;y=y.sibling}throw Error(n(188))}if(c.return!==d.return)c=g,d=y;else{for(var E=!1,S=g.child;S;){if(S===c){E=!0,c=g,d=y;break}if(S===d){E=!0,d=g,c=y;break}S=S.sibling}if(!E){for(S=y.child;S;){if(S===c){E=!0,c=y,d=g;break}if(S===d){E=!0,d=y,c=g;break}S=S.sibling}if(!E)throw Error(n(189))}}if(c.alternate!==d)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?r:i}function p(r){var i=r.tag;if(i===5||i===26||i===27||i===6)return r;for(r=r.child;r!==null;){if(i=p(r),i!==null)return i;r=r.sibling}return null}var x=Object.assign,_=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),U=Symbol.for("react.consumer"),B=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function G(r){return r===null||typeof r!="object"?null:(r=I&&r[I]||r["@@iterator"],typeof r=="function"?r:null)}var O=Symbol.for("react.client.reference");function Ve(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===O?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case C:return"Fragment";case L:return"Profiler";case k:return"StrictMode";case $:return"Suspense";case M:return"SuspenseList";case A:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case N:return"Portal";case B:return(r.displayName||"Context")+".Provider";case U:return(r._context.displayName||"Context")+".Consumer";case H:var i=r.render;return r=r.displayName,r||(r=i.displayName||i.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case R:return i=r.displayName||null,i!==null?i:Ve(r.type)||"Memo";case T:i=r._payload,r=r._init;try{return Ve(r(i))}catch{}}return null}var ae=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},be=[],D=-1;function se(r){return{current:r}}function xe(r){0>D||(r.current=be[D],be[D]=null,D--)}function ue(r,i){D++,be[D]=r.current,r.current=i}var Ie=se(null),pe=se(null),Ne=se(null),ce=se(null);function _e(r,i){switch(ue(Ne,i),ue(pe,r),ue(Ie,null),i.nodeType){case 9:case 11:r=(r=i.documentElement)&&(r=r.namespaceURI)?H_(r):0;break;default:if(r=i.tagName,i=i.namespaceURI)i=H_(i),r=G_(i,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}xe(Ie),ue(Ie,r)}function Se(){xe(Ie),xe(pe),xe(Ne)}function Ue(r){r.memoizedState!==null&&ue(ce,r);var i=Ie.current,c=G_(i,r.type);i!==c&&(ue(pe,r),ue(Ie,c))}function Ze(r){pe.current===r&&(xe(Ie),xe(pe)),ce.current===r&&(xe(ce),Xu._currentValue=Y)}var Ge=Object.prototype.hasOwnProperty,lt=s.unstable_scheduleCallback,ze=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,gt=s.unstable_requestPaint,ct=s.unstable_now,It=s.unstable_getCurrentPriorityLevel,Hn=s.unstable_ImmediatePriority,an=s.unstable_UserBlockingPriority,Gn=s.unstable_NormalPriority,br=s.unstable_LowPriority,ks=s.unstable_IdlePriority,Ds=s.log,Ps=s.unstable_setDisableYieldValue,wt=null,pt=null;function Zn(r){if(typeof Ds=="function"&&Ps(r),pt&&typeof pt.setStrictMode=="function")try{pt.setStrictMode(wt,r)}catch{}}var vn=Math.clz32?Math.clz32:Js,Xa=Math.log,fl=Math.LN2;function Js(r){return r>>>=0,r===0?32:31-(Xa(r)/fl|0)|0}var Zs=256,$n=4194304;function Rn(r){var i=r&42;if(i!==0)return i;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Lr(r,i,c){var d=r.pendingLanes;if(d===0)return 0;var g=0,y=r.suspendedLanes,E=r.pingedLanes;r=r.warmLanes;var S=d&134217727;return S!==0?(d=S&~y,d!==0?g=Rn(d):(E&=S,E!==0?g=Rn(E):c||(c=S&~r,c!==0&&(g=Rn(c))))):(S=d&~y,S!==0?g=Rn(S):E!==0?g=Rn(E):c||(c=d&~r,c!==0&&(g=Rn(c)))),g===0?0:i!==0&&i!==g&&(i&y)===0&&(y=g&-g,c=i&-i,y>=c||y===32&&(c&4194048)!==0)?i:g}function _r(r,i){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&i)===0}function so(r,i){switch(r){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ur(){var r=Zs;return Zs<<=1,(Zs&4194048)===0&&(Zs=256),r}function Fr(){var r=$n;return $n<<=1,($n&62914560)===0&&($n=4194304),r}function wr(r){for(var i=[],c=0;31>c;c++)i.push(r);return i}function cs(r,i){r.pendingLanes|=i,i!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function ro(r,i,c,d,g,y){var E=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var S=r.entanglements,q=r.expirationTimes,te=r.hiddenUpdates;for(c=E&~c;0<c;){var de=31-vn(c),me=1<<de;S[de]=0,q[de]=-1;var re=te[de];if(re!==null)for(te[de]=null,de=0;de<re.length;de++){var ie=re[de];ie!==null&&(ie.lane&=-536870913)}c&=~me}d!==0&&er(r,d,0),y!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=y&~(E&~i))}function er(r,i,c){r.pendingLanes|=i,r.suspendedLanes&=~i;var d=31-vn(i);r.entangledLanes|=i,r.entanglements[d]=r.entanglements[d]|1073741824|c&4194090}function qt(r,i){var c=r.entangledLanes|=i;for(r=r.entanglements;c;){var d=31-vn(c),g=1<<d;g&i|r[d]&i&&(r[d]|=i),c&=~g}}function us(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Wa(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Tr(){var r=oe.p;return r!==0?r:(r=window.event,r===void 0?32:uw(r.type))}function Ja(r,i){var c=oe.p;try{return oe.p=r,i()}finally{oe.p=c}}var Mt=Math.random().toString(36).slice(2),tn="__reactFiber$"+Mt,nn="__reactProps$"+Mt,Yt="__reactContainer$"+Mt,tr="__reactEvents$"+Mt,ml="__reactListeners$"+Mt,Er="__reactHandles$"+Mt,Za="__reactResources$"+Mt,Br="__reactMarker$"+Mt;function kn(r){delete r[tn],delete r[nn],delete r[tr],delete r[ml],delete r[Er]}function nr(r){var i=r[tn];if(i)return i;for(var c=r.parentNode;c;){if(i=c[Yt]||c[tn]){if(c=i.alternate,i.child!==null||c!==null&&c.child!==null)for(r=Y_(r);r!==null;){if(c=r[tn])return c;r=Y_(r)}return i}r=c,c=r.parentNode}return null}function Ms(r){if(r=r[tn]||r[Yt]){var i=r.tag;if(i===5||i===6||i===13||i===26||i===27||i===3)return r}return null}function Os(r){var i=r.tag;if(i===5||i===26||i===27||i===6)return r.stateNode;throw Error(n(33))}function Dn(r){var i=r[Za];return i||(i=r[Za]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Xt(r){r[Br]=!0}var De=new Set,Q={};function ye(r,i){je(r,i),je(r+"Capture",i)}function je(r,i){for(Q[r]=i,r=0;r<i.length;r++)De.add(i[r])}var Tt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),on={},Ot={};function bn(r){return Ge.call(Ot,r)?!0:Ge.call(on,r)?!1:Tt.test(r)?Ot[r]=!0:(on[r]=!0,!1)}function Pn(r,i,c){if(bn(i))if(c===null)r.removeAttribute(i);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(i);return;case"boolean":var d=i.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(i);return}}r.setAttribute(i,""+c)}}function es(r,i,c){if(c===null)r.removeAttribute(i);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(i);return}r.setAttribute(i,""+c)}}function ln(r,i,c,d){if(d===null)r.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(i,c,""+d)}}var zt,ao;function sr(r){if(zt===void 0)try{throw Error()}catch(c){var i=c.stack.trim().match(/\n( *(at )?)/);zt=i&&i[1]||"",ao=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zt+r+ao}var gl=!1;function pl(r,i){if(!r||gl)return"";gl=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(i){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(ie){var re=ie}Reflect.construct(r,[],me)}else{try{me.call()}catch(ie){re=ie}r.call(me.prototype)}}else{try{throw Error()}catch(ie){re=ie}(me=r())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(ie){if(ie&&re&&typeof ie.stack=="string")return[ie.stack,re.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),E=y[0],S=y[1];if(E&&S){var q=E.split(`
`),te=S.split(`
`);for(g=d=0;d<q.length&&!q[d].includes("DetermineComponentFrameRoot");)d++;for(;g<te.length&&!te[g].includes("DetermineComponentFrameRoot");)g++;if(d===q.length||g===te.length)for(d=q.length-1,g=te.length-1;1<=d&&0<=g&&q[d]!==te[g];)g--;for(;1<=d&&0<=g;d--,g--)if(q[d]!==te[g]){if(d!==1||g!==1)do if(d--,g--,0>g||q[d]!==te[g]){var de=`
`+q[d].replace(" at new "," at ");return r.displayName&&de.includes("<anonymous>")&&(de=de.replace("<anonymous>",r.displayName)),de}while(1<=d&&0<=g);break}}}finally{gl=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?sr(c):""}function su(r){switch(r.tag){case 26:case 27:case 5:return sr(r.type);case 16:return sr("Lazy");case 13:return sr("Suspense");case 19:return sr("SuspenseList");case 0:case 15:return pl(r.type,!1);case 11:return pl(r.type.render,!1);case 1:return pl(r.type,!0);case 31:return sr("Activity");default:return""}}function yl(r){try{var i="";do i+=su(r),r=r.return;while(r);return i}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function ds(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function ru(r){var i=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function xg(r){var i=ru(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,i),d=""+r[i];if(!r.hasOwnProperty(i)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,y=c.set;return Object.defineProperty(r,i,{configurable:!0,get:function(){return g.call(this)},set:function(E){d=""+E,y.call(this,E)}}),Object.defineProperty(r,i,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(E){d=""+E},stopTracking:function(){r._valueTracker=null,delete r[i]}}}}function xl(r){r._valueTracker||(r._valueTracker=xg(r))}function au(r){if(!r)return!1;var i=r._valueTracker;if(!i)return!0;var c=i.getValue(),d="";return r&&(d=ru(r)?r.checked?"true":"false":r.value),r=d,r!==c?(i.setValue(r),!0):!1}function io(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var vg=/[\n"\\]/g;function fn(r){return r.replace(vg,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Vs(r,i,c,d,g,y,E,S){r.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?r.type=E:r.removeAttribute("type"),i!=null?E==="number"?(i===0&&r.value===""||r.value!=i)&&(r.value=""+ds(i)):r.value!==""+ds(i)&&(r.value=""+ds(i)):E!=="submit"&&E!=="reset"||r.removeAttribute("value"),i!=null?ei(r,E,ds(i)):c!=null?ei(r,E,ds(c)):d!=null&&r.removeAttribute("value"),g==null&&y!=null&&(r.defaultChecked=!!y),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?r.name=""+ds(S):r.removeAttribute("name")}function oo(r,i,c,d,g,y,E,S){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(r.type=y),i!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||i!=null))return;c=c!=null?""+ds(c):"",i=i!=null?""+ds(i):c,S||i===r.value||(r.value=i),r.defaultValue=i}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=S?r.checked:!!d,r.defaultChecked=!!d,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(r.name=E)}function ei(r,i,c){i==="number"&&io(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function ha(r,i,c,d){if(r=r.options,i){i={};for(var g=0;g<c.length;g++)i["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=i.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&d&&(r[c].defaultSelected=!0)}else{for(c=""+ds(c),i=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,d&&(r[g].defaultSelected=!0);return}i!==null||r[g].disabled||(i=r[g])}i!==null&&(i.selected=!0)}}function Ct(r,i,c){if(i!=null&&(i=""+ds(i),i!==r.value&&(r.value=i),c==null)){r.defaultValue!==i&&(r.defaultValue=i);return}r.defaultValue=c!=null?""+ds(c):""}function lo(r,i,c,d){if(i==null){if(d!=null){if(c!=null)throw Error(n(92));if(ae(d)){if(1<d.length)throw Error(n(93));d=d[0]}c=d}c==null&&(c=""),i=c}c=ds(i),r.defaultValue=c,d=r.textContent,d===c&&d!==""&&d!==null&&(r.value=d)}function rr(r,i){if(i){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=i;return}}r.textContent=i}var co=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function hh(r,i,c){var d=i.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?r.setProperty(i,""):i==="float"?r.cssFloat="":r[i]="":d?r.setProperty(i,c):typeof c!="number"||c===0||co.has(i)?i==="float"?r.cssFloat=c:r[i]=(""+c).trim():r[i]=c+"px"}function iu(r,i,c){if(i!=null&&typeof i!="object")throw Error(n(62));if(r=r.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||i!=null&&i.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var g in i)d=i[g],i.hasOwnProperty(g)&&c[g]!==d&&hh(r,g,d)}else for(var y in i)i.hasOwnProperty(y)&&hh(r,y,i[y])}function ou(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_g=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vl(r){return _g.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var fa=null;function ar(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ma=null,ga=null;function lu(r){var i=Ms(r);if(i&&(r=i.stateNode)){var c=r[nn]||null;e:switch(r=i.stateNode,i.type){case"input":if(Vs(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),i=c.name,c.type==="radio"&&i!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+fn(""+i)+'"][type="radio"]'),i=0;i<c.length;i++){var d=c[i];if(d!==r&&d.form===r.form){var g=d[nn]||null;if(!g)throw Error(n(90));Vs(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(i=0;i<c.length;i++)d=c[i],d.form===r.form&&au(d)}break e;case"textarea":Ct(r,c.value,c.defaultValue);break e;case"select":i=c.value,i!=null&&ha(r,!!c.multiple,i,!1)}}}var qr=!1;function fh(r,i,c){if(qr)return r(i,c);qr=!0;try{var d=r(i);return d}finally{if(qr=!1,(ma!==null||ga!==null)&&(of(),ma&&(i=ma,r=ga,ga=ma=null,lu(i),r)))for(i=0;i<r.length;i++)lu(r[i])}}function uo(r,i){var c=r.stateNode;if(c===null)return null;var d=c[nn]||null;if(d===null)return null;c=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(n(231,i,typeof c));return c}var Nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ir=!1;if(Nr)try{var ho={};Object.defineProperty(ho,"passive",{get:function(){ir=!0}}),window.addEventListener("test",ho,ho),window.removeEventListener("test",ho,ho)}catch{ir=!1}var zr=null,ti=null,pa=null;function cu(){if(pa)return pa;var r,i=ti,c=i.length,d,g="value"in zr?zr.value:zr.textContent,y=g.length;for(r=0;r<c&&i[r]===g[r];r++);var E=c-r;for(d=1;d<=E&&i[c-d]===g[y-d];d++);return pa=g.slice(r,1<d?1-d:void 0)}function Hr(r){var i=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&i===13&&(r=13)):r=i,r===10&&(r=13),32<=r||r===13?r:0}function Gr(){return!0}function uu(){return!1}function Mn(r){function i(c,d,g,y,E){this._reactName=c,this._targetInst=g,this.type=d,this.nativeEvent=y,this.target=E,this.currentTarget=null;for(var S in r)r.hasOwnProperty(S)&&(c=r[S],this[S]=c?c(y):y[S]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Gr:uu,this.isPropagationStopped=uu,this}return x(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Gr)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Gr)},persist:function(){},isPersistent:Gr}),i}var bt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bl=Mn(bt),fo=x({},bt,{view:0,detail:0}),mh=Mn(fo),_l,wl,$r,mo=x({},fo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==$r&&($r&&r.type==="mousemove"?(_l=r.screenX-$r.screenX,wl=r.screenY-$r.screenY):wl=_l=0,$r=r),_l)},movementY:function(r){return"movementY"in r?r.movementY:wl}}),or=Mn(mo),gh=x({},mo,{dataTransfer:0}),wg=Mn(gh),go=x({},fo,{relatedTarget:0}),Tl=Mn(go),du=x({},bt,{animationName:0,elapsedTime:0,pseudoElement:0}),El=Mn(du),ph=x({},bt,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Nl=Mn(ph),Tg=x({},bt,{data:0}),hu=Mn(Tg),po={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fu(r){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(r):(r=xh[r])?!!i[r]:!1}function yo(){return fu}var vh=x({},fo,{key:function(r){if(r.key){var i=po[r.key]||r.key;if(i!=="Unidentified")return i}return r.type==="keypress"?(r=Hr(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?yh[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yo,charCode:function(r){return r.type==="keypress"?Hr(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Hr(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Sl=Mn(vh),bh=x({},mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mu=Mn(bh),ya=x({},fo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yo}),_h=Mn(ya),wh=x({},bt,{propertyName:0,elapsedTime:0,pseudoElement:0}),Th=Mn(wh),Eh=x({},mo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Al=Mn(Eh),hs=x({},bt,{newState:0,oldState:0}),Nh=Mn(hs),Sh=[9,13,27,32],Kr=Nr&&"CompositionEvent"in window,f=null;Nr&&"documentMode"in document&&(f=document.documentMode);var v=Nr&&"TextEvent"in window&&!f,w=Nr&&(!Kr||f&&8<f&&11>=f),j=" ",J=!1;function le(r,i){switch(r){case"keyup":return Sh.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function we(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ut=!1;function _n(r,i){switch(r){case"compositionend":return we(i);case"keypress":return i.which!==32?null:(J=!0,j);case"textInput":return r=i.data,r===j&&J?null:r;default:return null}}function dt(r,i){if(ut)return r==="compositionend"||!Kr&&le(r,i)?(r=cu(),pa=ti=zr=null,ut=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return w&&i.locale!=="ko"?null:i.data;default:return null}}var On={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wn(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i==="input"?!!On[r.type]:i==="textarea"}function xa(r,i,c,d){ma?ga?ga.push(d):ga=[d]:ma=d,i=ff(i,"onChange"),0<i.length&&(c=new bl("onChange","change",null,c,d),r.push({event:c,listeners:i}))}var Kn=null,Qr=null;function gu(r){U_(r,0)}function Ah(r){var i=Os(r);if(au(i))return r}function ib(r,i){if(r==="change")return i}var ob=!1;if(Nr){var Eg;if(Nr){var Ng="oninput"in document;if(!Ng){var lb=document.createElement("div");lb.setAttribute("oninput","return;"),Ng=typeof lb.oninput=="function"}Eg=Ng}else Eg=!1;ob=Eg&&(!document.documentMode||9<document.documentMode)}function cb(){Kn&&(Kn.detachEvent("onpropertychange",ub),Qr=Kn=null)}function ub(r){if(r.propertyName==="value"&&Ah(Qr)){var i=[];xa(i,Qr,r,ar(r)),fh(gu,i)}}function EI(r,i,c){r==="focusin"?(cb(),Kn=i,Qr=c,Kn.attachEvent("onpropertychange",ub)):r==="focusout"&&cb()}function NI(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ah(Qr)}function SI(r,i){if(r==="click")return Ah(i)}function AI(r,i){if(r==="input"||r==="change")return Ah(i)}function jI(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var Ls=typeof Object.is=="function"?Object.is:jI;function pu(r,i){if(Ls(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;var c=Object.keys(r),d=Object.keys(i);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var g=c[d];if(!Ge.call(i,g)||!Ls(r[g],i[g]))return!1}return!0}function db(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function hb(r,i){var c=db(r);r=0;for(var d;c;){if(c.nodeType===3){if(d=r+c.textContent.length,r<=i&&d>=i)return{node:c,offset:i-r};r=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=db(c)}}function fb(r,i){return r&&i?r===i?!0:r&&r.nodeType===3?!1:i&&i.nodeType===3?fb(r,i.parentNode):"contains"in r?r.contains(i):r.compareDocumentPosition?!!(r.compareDocumentPosition(i)&16):!1:!1}function mb(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var i=io(r.document);i instanceof r.HTMLIFrameElement;){try{var c=typeof i.contentWindow.location.href=="string"}catch{c=!1}if(c)r=i.contentWindow;else break;i=io(r.document)}return i}function Sg(r){var i=r&&r.nodeName&&r.nodeName.toLowerCase();return i&&(i==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||i==="textarea"||r.contentEditable==="true")}var II=Nr&&"documentMode"in document&&11>=document.documentMode,jl=null,Ag=null,yu=null,jg=!1;function gb(r,i,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;jg||jl==null||jl!==io(d)||(d=jl,"selectionStart"in d&&Sg(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),yu&&pu(yu,d)||(yu=d,d=ff(Ag,"onSelect"),0<d.length&&(i=new bl("onSelect","select",null,i,c),r.push({event:i,listeners:d}),i.target=jl)))}function xo(r,i){var c={};return c[r.toLowerCase()]=i.toLowerCase(),c["Webkit"+r]="webkit"+i,c["Moz"+r]="moz"+i,c}var Il={animationend:xo("Animation","AnimationEnd"),animationiteration:xo("Animation","AnimationIteration"),animationstart:xo("Animation","AnimationStart"),transitionrun:xo("Transition","TransitionRun"),transitionstart:xo("Transition","TransitionStart"),transitioncancel:xo("Transition","TransitionCancel"),transitionend:xo("Transition","TransitionEnd")},Ig={},pb={};Nr&&(pb=document.createElement("div").style,"AnimationEvent"in window||(delete Il.animationend.animation,delete Il.animationiteration.animation,delete Il.animationstart.animation),"TransitionEvent"in window||delete Il.transitionend.transition);function vo(r){if(Ig[r])return Ig[r];if(!Il[r])return r;var i=Il[r],c;for(c in i)if(i.hasOwnProperty(c)&&c in pb)return Ig[r]=i[c];return r}var yb=vo("animationend"),xb=vo("animationiteration"),vb=vo("animationstart"),CI=vo("transitionrun"),RI=vo("transitionstart"),kI=vo("transitioncancel"),bb=vo("transitionend"),_b=new Map,Cg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Cg.push("scrollEnd");function Sr(r,i){_b.set(r,i),ye(i,[r])}var wb=new WeakMap;function lr(r,i){if(typeof r=="object"&&r!==null){var c=wb.get(r);return c!==void 0?c:(i={value:r,source:i,stack:yl(i)},wb.set(r,i),i)}return{value:r,source:i,stack:yl(i)}}var cr=[],Cl=0,Rg=0;function jh(){for(var r=Cl,i=Rg=Cl=0;i<r;){var c=cr[i];cr[i++]=null;var d=cr[i];cr[i++]=null;var g=cr[i];cr[i++]=null;var y=cr[i];if(cr[i++]=null,d!==null&&g!==null){var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}y!==0&&Tb(c,g,y)}}function Ih(r,i,c,d){cr[Cl++]=r,cr[Cl++]=i,cr[Cl++]=c,cr[Cl++]=d,Rg|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function kg(r,i,c,d){return Ih(r,i,c,d),Ch(r)}function Rl(r,i){return Ih(r,null,null,i),Ch(r)}function Tb(r,i,c){r.lanes|=c;var d=r.alternate;d!==null&&(d.lanes|=c);for(var g=!1,y=r.return;y!==null;)y.childLanes|=c,d=y.alternate,d!==null&&(d.childLanes|=c),y.tag===22&&(r=y.stateNode,r===null||r._visibility&1||(g=!0)),r=y,y=y.return;return r.tag===3?(y=r.stateNode,g&&i!==null&&(g=31-vn(c),r=y.hiddenUpdates,d=r[g],d===null?r[g]=[i]:d.push(i),i.lane=c|536870912),y):null}function Ch(r){if(50<qu)throw qu=0,Lp=null,Error(n(185));for(var i=r.return;i!==null;)r=i,i=r.return;return r.tag===3?r.stateNode:null}var kl={};function DI(r,i,c,d){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(r,i,c,d){return new DI(r,i,c,d)}function Dg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function va(r,i){var c=r.alternate;return c===null?(c=Us(r.tag,i,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=i,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,i=r.dependencies,c.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Eb(r,i){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=i,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,i=c.dependencies,r.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),r}function Rh(r,i,c,d,g,y){var E=0;if(d=r,typeof r=="function")Dg(r)&&(E=1);else if(typeof r=="string")E=MC(r,c,Ie.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case A:return r=Us(31,c,i,g),r.elementType=A,r.lanes=y,r;case C:return bo(c.children,g,y,i);case k:E=8,g|=24;break;case L:return r=Us(12,c,i,g|2),r.elementType=L,r.lanes=y,r;case $:return r=Us(13,c,i,g),r.elementType=$,r.lanes=y,r;case M:return r=Us(19,c,i,g),r.elementType=M,r.lanes=y,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case F:case B:E=10;break e;case U:E=9;break e;case H:E=11;break e;case R:E=14;break e;case T:E=16,d=null;break e}E=29,c=Error(n(130,r===null?"null":typeof r,"")),d=null}return i=Us(E,c,i,g),i.elementType=r,i.type=d,i.lanes=y,i}function bo(r,i,c,d){return r=Us(7,r,d,i),r.lanes=c,r}function Pg(r,i,c){return r=Us(6,r,null,i),r.lanes=c,r}function Mg(r,i,c){return i=Us(4,r.children!==null?r.children:[],r.key,i),i.lanes=c,i.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},i}var Dl=[],Pl=0,kh=null,Dh=0,ur=[],dr=0,_o=null,ba=1,_a="";function wo(r,i){Dl[Pl++]=Dh,Dl[Pl++]=kh,kh=r,Dh=i}function Nb(r,i,c){ur[dr++]=ba,ur[dr++]=_a,ur[dr++]=_o,_o=r;var d=ba;r=_a;var g=32-vn(d)-1;d&=~(1<<g),c+=1;var y=32-vn(i)+g;if(30<y){var E=g-g%5;y=(d&(1<<E)-1).toString(32),d>>=E,g-=E,ba=1<<32-vn(i)+g|c<<g|d,_a=y+r}else ba=1<<y|c<<g|d,_a=r}function Og(r){r.return!==null&&(wo(r,1),Nb(r,1,0))}function Vg(r){for(;r===kh;)kh=Dl[--Pl],Dl[Pl]=null,Dh=Dl[--Pl],Dl[Pl]=null;for(;r===_o;)_o=ur[--dr],ur[dr]=null,_a=ur[--dr],ur[dr]=null,ba=ur[--dr],ur[dr]=null}var fs=null,sn=null,xt=!1,To=null,Yr=!1,Lg=Error(n(519));function Eo(r){var i=Error(n(418,""));throw bu(lr(i,r)),Lg}function Sb(r){var i=r.stateNode,c=r.type,d=r.memoizedProps;switch(i[tn]=r,i[nn]=d,c){case"dialog":rt("cancel",i),rt("close",i);break;case"iframe":case"object":case"embed":rt("load",i);break;case"video":case"audio":for(c=0;c<Hu.length;c++)rt(Hu[c],i);break;case"source":rt("error",i);break;case"img":case"image":case"link":rt("error",i),rt("load",i);break;case"details":rt("toggle",i);break;case"input":rt("invalid",i),oo(i,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),xl(i);break;case"select":rt("invalid",i);break;case"textarea":rt("invalid",i),lo(i,d.value,d.defaultValue,d.children),xl(i)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||i.textContent===""+c||d.suppressHydrationWarning===!0||z_(i.textContent,c)?(d.popover!=null&&(rt("beforetoggle",i),rt("toggle",i)),d.onScroll!=null&&rt("scroll",i),d.onScrollEnd!=null&&rt("scrollend",i),d.onClick!=null&&(i.onclick=mf),i=!0):i=!1,i||Eo(r)}function Ab(r){for(fs=r.return;fs;)switch(fs.tag){case 5:case 13:Yr=!1;return;case 27:case 3:Yr=!0;return;default:fs=fs.return}}function xu(r){if(r!==fs)return!1;if(!xt)return Ab(r),xt=!0,!1;var i=r.tag,c;if((c=i!==3&&i!==27)&&((c=i===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||ey(r.type,r.memoizedProps)),c=!c),c&&sn&&Eo(r),Ab(r),i===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));e:{for(r=r.nextSibling,i=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(i===0){sn=jr(r.nextSibling);break e}i--}else c!=="$"&&c!=="$!"&&c!=="$?"||i++;r=r.nextSibling}sn=null}}else i===27?(i=sn,yi(r.type)?(r=ry,ry=null,sn=r):sn=i):sn=fs?jr(r.stateNode.nextSibling):null;return!0}function vu(){sn=fs=null,xt=!1}function jb(){var r=To;return r!==null&&(vs===null?vs=r:vs.push.apply(vs,r),To=null),r}function bu(r){To===null?To=[r]:To.push(r)}var Ug=se(null),No=null,wa=null;function ni(r,i,c){ue(Ug,i._currentValue),i._currentValue=c}function Ta(r){r._currentValue=Ug.current,xe(Ug)}function Fg(r,i,c){for(;r!==null;){var d=r.alternate;if((r.childLanes&i)!==i?(r.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),r===c)break;r=r.return}}function Bg(r,i,c,d){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var y=g.dependencies;if(y!==null){var E=g.child;y=y.firstContext;e:for(;y!==null;){var S=y;y=g;for(var q=0;q<i.length;q++)if(S.context===i[q]){y.lanes|=c,S=y.alternate,S!==null&&(S.lanes|=c),Fg(y.return,c,r),d||(E=null);break e}y=S.next}}else if(g.tag===18){if(E=g.return,E===null)throw Error(n(341));E.lanes|=c,y=E.alternate,y!==null&&(y.lanes|=c),Fg(E,c,r),E=null}else E=g.child;if(E!==null)E.return=g;else for(E=g;E!==null;){if(E===r){E=null;break}if(g=E.sibling,g!==null){g.return=E.return,E=g;break}E=E.return}g=E}}function _u(r,i,c,d){r=null;for(var g=i,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var E=g.alternate;if(E===null)throw Error(n(387));if(E=E.memoizedProps,E!==null){var S=g.type;Ls(g.pendingProps.value,E.value)||(r!==null?r.push(S):r=[S])}}else if(g===ce.current){if(E=g.alternate,E===null)throw Error(n(387));E.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(Xu):r=[Xu])}g=g.return}r!==null&&Bg(i,r,c,d),i.flags|=262144}function Ph(r){for(r=r.firstContext;r!==null;){if(!Ls(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function So(r){No=r,wa=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ts(r){return Ib(No,r)}function Mh(r,i){return No===null&&So(r),Ib(r,i)}function Ib(r,i){var c=i._currentValue;if(i={context:i,memoizedValue:c,next:null},wa===null){if(r===null)throw Error(n(308));wa=i,r.dependencies={lanes:0,firstContext:i},r.flags|=524288}else wa=wa.next=i;return c}var PI=typeof AbortController<"u"?AbortController:function(){var r=[],i=this.signal={aborted:!1,addEventListener:function(c,d){r.push(d)}};this.abort=function(){i.aborted=!0,r.forEach(function(c){return c()})}},MI=s.unstable_scheduleCallback,OI=s.unstable_NormalPriority,Tn={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qg(){return{controller:new PI,data:new Map,refCount:0}}function wu(r){r.refCount--,r.refCount===0&&MI(OI,function(){r.controller.abort()})}var Tu=null,zg=0,Ml=0,Ol=null;function VI(r,i){if(Tu===null){var c=Tu=[];zg=0,Ml=Gp(),Ol={status:"pending",value:void 0,then:function(d){c.push(d)}}}return zg++,i.then(Cb,Cb),i}function Cb(){if(--zg===0&&Tu!==null){Ol!==null&&(Ol.status="fulfilled");var r=Tu;Tu=null,Ml=0,Ol=null;for(var i=0;i<r.length;i++)(0,r[i])()}}function LI(r,i){var c=[],d={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){d.status="fulfilled",d.value=i;for(var g=0;g<c.length;g++)(0,c[g])(i)},function(g){for(d.status="rejected",d.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),d}var Rb=z.S;z.S=function(r,i){typeof i=="object"&&i!==null&&typeof i.then=="function"&&VI(r,i),Rb!==null&&Rb(r,i)};var Ao=se(null);function Hg(){var r=Ao.current;return r!==null?r:Lt.pooledCache}function Oh(r,i){i===null?ue(Ao,Ao.current):ue(Ao,i.pool)}function kb(){var r=Hg();return r===null?null:{parent:Tn._currentValue,pool:r}}var Eu=Error(n(460)),Db=Error(n(474)),Vh=Error(n(542)),Gg={then:function(){}};function Pb(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Lh(){}function Mb(r,i,c){switch(c=r[c],c===void 0?r.push(i):c!==i&&(i.then(Lh,Lh),i=c),i.status){case"fulfilled":return i.value;case"rejected":throw r=i.reason,Vb(r),r;default:if(typeof i.status=="string")i.then(Lh,Lh);else{if(r=Lt,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=i,r.status="pending",r.then(function(d){if(i.status==="pending"){var g=i;g.status="fulfilled",g.value=d}},function(d){if(i.status==="pending"){var g=i;g.status="rejected",g.reason=d}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw r=i.reason,Vb(r),r}throw Nu=i,Eu}}var Nu=null;function Ob(){if(Nu===null)throw Error(n(459));var r=Nu;return Nu=null,r}function Vb(r){if(r===Eu||r===Vh)throw Error(n(483))}var si=!1;function $g(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kg(r,i){r=r.updateQueue,i.updateQueue===r&&(i.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ri(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function ai(r,i,c){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(Et&2)!==0){var g=d.pending;return g===null?i.next=i:(i.next=g.next,g.next=i),d.pending=i,i=Ch(r),Tb(r,null,c),i}return Ih(r,d,i,c),Ch(r)}function Su(r,i,c){if(i=i.updateQueue,i!==null&&(i=i.shared,(c&4194048)!==0)){var d=i.lanes;d&=r.pendingLanes,c|=d,i.lanes=c,qt(r,c)}}function Qg(r,i){var c=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var E={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=E:y=y.next=E,c=c.next}while(c!==null);y===null?g=y=i:y=y.next=i}else g=y=i;c={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=i:r.next=i,c.lastBaseUpdate=i}var Yg=!1;function Au(){if(Yg){var r=Ol;if(r!==null)throw r}}function ju(r,i,c,d){Yg=!1;var g=r.updateQueue;si=!1;var y=g.firstBaseUpdate,E=g.lastBaseUpdate,S=g.shared.pending;if(S!==null){g.shared.pending=null;var q=S,te=q.next;q.next=null,E===null?y=te:E.next=te,E=q;var de=r.alternate;de!==null&&(de=de.updateQueue,S=de.lastBaseUpdate,S!==E&&(S===null?de.firstBaseUpdate=te:S.next=te,de.lastBaseUpdate=q))}if(y!==null){var me=g.baseState;E=0,de=te=q=null,S=y;do{var re=S.lane&-536870913,ie=re!==S.lane;if(ie?(ht&re)===re:(d&re)===re){re!==0&&re===Ml&&(Yg=!0),de!==null&&(de=de.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var He=r,Fe=S;re=i;var Dt=c;switch(Fe.tag){case 1:if(He=Fe.payload,typeof He=="function"){me=He.call(Dt,me,re);break e}me=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Fe.payload,re=typeof He=="function"?He.call(Dt,me,re):He,re==null)break e;me=x({},me,re);break e;case 2:si=!0}}re=S.callback,re!==null&&(r.flags|=64,ie&&(r.flags|=8192),ie=g.callbacks,ie===null?g.callbacks=[re]:ie.push(re))}else ie={lane:re,tag:S.tag,payload:S.payload,callback:S.callback,next:null},de===null?(te=de=ie,q=me):de=de.next=ie,E|=re;if(S=S.next,S===null){if(S=g.shared.pending,S===null)break;ie=S,S=ie.next,ie.next=null,g.lastBaseUpdate=ie,g.shared.pending=null}}while(!0);de===null&&(q=me),g.baseState=q,g.firstBaseUpdate=te,g.lastBaseUpdate=de,y===null&&(g.shared.lanes=0),fi|=E,r.lanes=E,r.memoizedState=me}}function Lb(r,i){if(typeof r!="function")throw Error(n(191,r));r.call(i)}function Ub(r,i){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Lb(c[r],i)}var Vl=se(null),Uh=se(0);function Fb(r,i){r=Ca,ue(Uh,r),ue(Vl,i),Ca=r|i.baseLanes}function Xg(){ue(Uh,Ca),ue(Vl,Vl.current)}function Wg(){Ca=Uh.current,xe(Vl),xe(Uh)}var ii=0,Je=null,Rt=null,mn=null,Fh=!1,Ll=!1,jo=!1,Bh=0,Iu=0,Ul=null,UI=0;function cn(){throw Error(n(321))}function Jg(r,i){if(i===null)return!1;for(var c=0;c<i.length&&c<r.length;c++)if(!Ls(r[c],i[c]))return!1;return!0}function Zg(r,i,c,d,g,y){return ii=y,Je=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,z.H=r===null||r.memoizedState===null?T0:E0,jo=!1,y=c(d,g),jo=!1,Ll&&(y=qb(i,c,d,g)),Bb(r),y}function Bb(r){z.H=Kh;var i=Rt!==null&&Rt.next!==null;if(ii=0,mn=Rt=Je=null,Fh=!1,Iu=0,Ul=null,i)throw Error(n(300));r===null||Vn||(r=r.dependencies,r!==null&&Ph(r)&&(Vn=!0))}function qb(r,i,c,d){Je=r;var g=0;do{if(Ll&&(Ul=null),Iu=0,Ll=!1,25<=g)throw Error(n(301));if(g+=1,mn=Rt=null,r.updateQueue!=null){var y=r.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}z.H=$I,y=i(c,d)}while(Ll);return y}function FI(){var r=z.H,i=r.useState()[0];return i=typeof i.then=="function"?Cu(i):i,r=r.useState()[0],(Rt!==null?Rt.memoizedState:null)!==r&&(Je.flags|=1024),i}function ep(){var r=Bh!==0;return Bh=0,r}function tp(r,i,c){i.updateQueue=r.updateQueue,i.flags&=-2053,r.lanes&=~c}function np(r){if(Fh){for(r=r.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Fh=!1}ii=0,mn=Rt=Je=null,Ll=!1,Iu=Bh=0,Ul=null}function ys(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mn===null?Je.memoizedState=mn=r:mn=mn.next=r,mn}function gn(){if(Rt===null){var r=Je.alternate;r=r!==null?r.memoizedState:null}else r=Rt.next;var i=mn===null?Je.memoizedState:mn.next;if(i!==null)mn=i,Rt=r;else{if(r===null)throw Je.alternate===null?Error(n(467)):Error(n(310));Rt=r,r={memoizedState:Rt.memoizedState,baseState:Rt.baseState,baseQueue:Rt.baseQueue,queue:Rt.queue,next:null},mn===null?Je.memoizedState=mn=r:mn=mn.next=r}return mn}function sp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Cu(r){var i=Iu;return Iu+=1,Ul===null&&(Ul=[]),r=Mb(Ul,r,i),i=Je,(mn===null?i.memoizedState:mn.next)===null&&(i=i.alternate,z.H=i===null||i.memoizedState===null?T0:E0),r}function qh(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Cu(r);if(r.$$typeof===B)return ts(r)}throw Error(n(438,String(r)))}function rp(r){var i=null,c=Je.updateQueue;if(c!==null&&(i=c.memoCache),i==null){var d=Je.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(i={data:d.data.map(function(g){return g.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),c===null&&(c=sp(),Je.updateQueue=c),c.memoCache=i,c=i.data[i.index],c===void 0)for(c=i.data[i.index]=Array(r),d=0;d<r;d++)c[d]=V;return i.index++,c}function Ea(r,i){return typeof i=="function"?i(r):i}function zh(r){var i=gn();return ap(i,Rt,r)}function ap(r,i,c){var d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=c;var g=r.baseQueue,y=d.pending;if(y!==null){if(g!==null){var E=g.next;g.next=y.next,y.next=E}i.baseQueue=g=y,d.pending=null}if(y=r.baseState,g===null)r.memoizedState=y;else{i=g.next;var S=E=null,q=null,te=i,de=!1;do{var me=te.lane&-536870913;if(me!==te.lane?(ht&me)===me:(ii&me)===me){var re=te.revertLane;if(re===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:te.action,hasEagerState:te.hasEagerState,eagerState:te.eagerState,next:null}),me===Ml&&(de=!0);else if((ii&re)===re){te=te.next,re===Ml&&(de=!0);continue}else me={lane:0,revertLane:te.revertLane,action:te.action,hasEagerState:te.hasEagerState,eagerState:te.eagerState,next:null},q===null?(S=q=me,E=y):q=q.next=me,Je.lanes|=re,fi|=re;me=te.action,jo&&c(y,me),y=te.hasEagerState?te.eagerState:c(y,me)}else re={lane:me,revertLane:te.revertLane,action:te.action,hasEagerState:te.hasEagerState,eagerState:te.eagerState,next:null},q===null?(S=q=re,E=y):q=q.next=re,Je.lanes|=me,fi|=me;te=te.next}while(te!==null&&te!==i);if(q===null?E=y:q.next=S,!Ls(y,r.memoizedState)&&(Vn=!0,de&&(c=Ol,c!==null)))throw c;r.memoizedState=y,r.baseState=E,r.baseQueue=q,d.lastRenderedState=y}return g===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function ip(r){var i=gn(),c=i.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=r;var d=c.dispatch,g=c.pending,y=i.memoizedState;if(g!==null){c.pending=null;var E=g=g.next;do y=r(y,E.action),E=E.next;while(E!==g);Ls(y,i.memoizedState)||(Vn=!0),i.memoizedState=y,i.baseQueue===null&&(i.baseState=y),c.lastRenderedState=y}return[y,d]}function zb(r,i,c){var d=Je,g=gn(),y=xt;if(y){if(c===void 0)throw Error(n(407));c=c()}else c=i();var E=!Ls((Rt||g).memoizedState,c);E&&(g.memoizedState=c,Vn=!0),g=g.queue;var S=$b.bind(null,d,g,r);if(Ru(2048,8,S,[r]),g.getSnapshot!==i||E||mn!==null&&mn.memoizedState.tag&1){if(d.flags|=2048,Fl(9,Hh(),Gb.bind(null,d,g,c,i),null),Lt===null)throw Error(n(349));y||(ii&124)!==0||Hb(d,i,c)}return c}function Hb(r,i,c){r.flags|=16384,r={getSnapshot:i,value:c},i=Je.updateQueue,i===null?(i=sp(),Je.updateQueue=i,i.stores=[r]):(c=i.stores,c===null?i.stores=[r]:c.push(r))}function Gb(r,i,c,d){i.value=c,i.getSnapshot=d,Kb(i)&&Qb(r)}function $b(r,i,c){return c(function(){Kb(i)&&Qb(r)})}function Kb(r){var i=r.getSnapshot;r=r.value;try{var c=i();return!Ls(r,c)}catch{return!0}}function Qb(r){var i=Rl(r,2);i!==null&&Hs(i,r,2)}function op(r){var i=ys();if(typeof r=="function"){var c=r;if(r=c(),jo){Zn(!0);try{c()}finally{Zn(!1)}}}return i.memoizedState=i.baseState=r,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:r},i}function Yb(r,i,c,d){return r.baseState=c,ap(r,Rt,typeof d=="function"?d:Ea)}function BI(r,i,c,d,g){if($h(r))throw Error(n(485));if(r=i.action,r!==null){var y={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){y.listeners.push(E)}};z.T!==null?c(!0):y.isTransition=!1,d(y),c=i.pending,c===null?(y.next=i.pending=y,Xb(i,y)):(y.next=c.next,i.pending=c.next=y)}}function Xb(r,i){var c=i.action,d=i.payload,g=r.state;if(i.isTransition){var y=z.T,E={};z.T=E;try{var S=c(g,d),q=z.S;q!==null&&q(E,S),Wb(r,i,S)}catch(te){lp(r,i,te)}finally{z.T=y}}else try{y=c(g,d),Wb(r,i,y)}catch(te){lp(r,i,te)}}function Wb(r,i,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){Jb(r,i,d)},function(d){return lp(r,i,d)}):Jb(r,i,c)}function Jb(r,i,c){i.status="fulfilled",i.value=c,Zb(i),r.state=c,i=r.pending,i!==null&&(c=i.next,c===i?r.pending=null:(c=c.next,i.next=c,Xb(r,c)))}function lp(r,i,c){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do i.status="rejected",i.reason=c,Zb(i),i=i.next;while(i!==d)}r.action=null}function Zb(r){r=r.listeners;for(var i=0;i<r.length;i++)(0,r[i])()}function e0(r,i){return i}function t0(r,i){if(xt){var c=Lt.formState;if(c!==null){e:{var d=Je;if(xt){if(sn){t:{for(var g=sn,y=Yr;g.nodeType!==8;){if(!y){g=null;break t}if(g=jr(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){sn=jr(g.nextSibling),d=g.data==="F!";break e}}Eo(d)}d=!1}d&&(i=c[0])}}return c=ys(),c.memoizedState=c.baseState=i,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e0,lastRenderedState:i},c.queue=d,c=b0.bind(null,Je,d),d.dispatch=c,d=op(!1),y=fp.bind(null,Je,!1,d.queue),d=ys(),g={state:i,dispatch:null,action:r,pending:null},d.queue=g,c=BI.bind(null,Je,g,y,c),g.dispatch=c,d.memoizedState=r,[i,c,!1]}function n0(r){var i=gn();return s0(i,Rt,r)}function s0(r,i,c){if(i=ap(r,i,e0)[0],r=zh(Ea)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var d=Cu(i)}catch(E){throw E===Eu?Vh:E}else d=i;i=gn();var g=i.queue,y=g.dispatch;return c!==i.memoizedState&&(Je.flags|=2048,Fl(9,Hh(),qI.bind(null,g,c),null)),[d,y,r]}function qI(r,i){r.action=i}function r0(r){var i=gn(),c=Rt;if(c!==null)return s0(i,c,r);gn(),i=i.memoizedState,c=gn();var d=c.queue.dispatch;return c.memoizedState=r,[i,d,!1]}function Fl(r,i,c,d){return r={tag:r,create:c,deps:d,inst:i,next:null},i=Je.updateQueue,i===null&&(i=sp(),Je.updateQueue=i),c=i.lastEffect,c===null?i.lastEffect=r.next=r:(d=c.next,c.next=r,r.next=d,i.lastEffect=r),r}function Hh(){return{destroy:void 0,resource:void 0}}function a0(){return gn().memoizedState}function Gh(r,i,c,d){var g=ys();d=d===void 0?null:d,Je.flags|=r,g.memoizedState=Fl(1|i,Hh(),c,d)}function Ru(r,i,c,d){var g=gn();d=d===void 0?null:d;var y=g.memoizedState.inst;Rt!==null&&d!==null&&Jg(d,Rt.memoizedState.deps)?g.memoizedState=Fl(i,y,c,d):(Je.flags|=r,g.memoizedState=Fl(1|i,y,c,d))}function i0(r,i){Gh(8390656,8,r,i)}function o0(r,i){Ru(2048,8,r,i)}function l0(r,i){return Ru(4,2,r,i)}function c0(r,i){return Ru(4,4,r,i)}function u0(r,i){if(typeof i=="function"){r=r();var c=i(r);return function(){typeof c=="function"?c():i(null)}}if(i!=null)return r=r(),i.current=r,function(){i.current=null}}function d0(r,i,c){c=c!=null?c.concat([r]):null,Ru(4,4,u0.bind(null,i,r),c)}function cp(){}function h0(r,i){var c=gn();i=i===void 0?null:i;var d=c.memoizedState;return i!==null&&Jg(i,d[1])?d[0]:(c.memoizedState=[r,i],r)}function f0(r,i){var c=gn();i=i===void 0?null:i;var d=c.memoizedState;if(i!==null&&Jg(i,d[1]))return d[0];if(d=r(),jo){Zn(!0);try{r()}finally{Zn(!1)}}return c.memoizedState=[d,i],d}function up(r,i,c){return c===void 0||(ii&1073741824)!==0?r.memoizedState=i:(r.memoizedState=c,r=p_(),Je.lanes|=r,fi|=r,c)}function m0(r,i,c,d){return Ls(c,i)?c:Vl.current!==null?(r=up(r,c,d),Ls(r,i)||(Vn=!0),r):(ii&42)===0?(Vn=!0,r.memoizedState=c):(r=p_(),Je.lanes|=r,fi|=r,i)}function g0(r,i,c,d,g){var y=oe.p;oe.p=y!==0&&8>y?y:8;var E=z.T,S={};z.T=S,fp(r,!1,i,c);try{var q=g(),te=z.S;if(te!==null&&te(S,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var de=LI(q,d);ku(r,i,de,zs(r))}else ku(r,i,d,zs(r))}catch(me){ku(r,i,{then:function(){},status:"rejected",reason:me},zs())}finally{oe.p=y,z.T=E}}function zI(){}function dp(r,i,c,d){if(r.tag!==5)throw Error(n(476));var g=p0(r).queue;g0(r,g,i,Y,c===null?zI:function(){return y0(r),c(d)})}function p0(r){var i=r.memoizedState;if(i!==null)return i;i={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:Y},next:null};var c={};return i.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:c},next:null},r.memoizedState=i,r=r.alternate,r!==null&&(r.memoizedState=i),i}function y0(r){var i=p0(r).next.queue;ku(r,i,{},zs())}function hp(){return ts(Xu)}function x0(){return gn().memoizedState}function v0(){return gn().memoizedState}function HI(r){for(var i=r.return;i!==null;){switch(i.tag){case 24:case 3:var c=zs();r=ri(c);var d=ai(i,r,c);d!==null&&(Hs(d,i,c),Su(d,i,c)),i={cache:qg()},r.payload=i;return}i=i.return}}function GI(r,i,c){var d=zs();c={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},$h(r)?_0(i,c):(c=kg(r,i,c,d),c!==null&&(Hs(c,r,d),w0(c,i,d)))}function b0(r,i,c){var d=zs();ku(r,i,c,d)}function ku(r,i,c,d){var g={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if($h(r))_0(i,g);else{var y=r.alternate;if(r.lanes===0&&(y===null||y.lanes===0)&&(y=i.lastRenderedReducer,y!==null))try{var E=i.lastRenderedState,S=y(E,c);if(g.hasEagerState=!0,g.eagerState=S,Ls(S,E))return Ih(r,i,g,0),Lt===null&&jh(),!1}catch{}finally{}if(c=kg(r,i,g,d),c!==null)return Hs(c,r,d),w0(c,i,d),!0}return!1}function fp(r,i,c,d){if(d={lane:2,revertLane:Gp(),action:d,hasEagerState:!1,eagerState:null,next:null},$h(r)){if(i)throw Error(n(479))}else i=kg(r,c,d,2),i!==null&&Hs(i,r,2)}function $h(r){var i=r.alternate;return r===Je||i!==null&&i===Je}function _0(r,i){Ll=Fh=!0;var c=r.pending;c===null?i.next=i:(i.next=c.next,c.next=i),r.pending=i}function w0(r,i,c){if((c&4194048)!==0){var d=i.lanes;d&=r.pendingLanes,c|=d,i.lanes=c,qt(r,c)}}var Kh={readContext:ts,use:qh,useCallback:cn,useContext:cn,useEffect:cn,useImperativeHandle:cn,useLayoutEffect:cn,useInsertionEffect:cn,useMemo:cn,useReducer:cn,useRef:cn,useState:cn,useDebugValue:cn,useDeferredValue:cn,useTransition:cn,useSyncExternalStore:cn,useId:cn,useHostTransitionStatus:cn,useFormState:cn,useActionState:cn,useOptimistic:cn,useMemoCache:cn,useCacheRefresh:cn},T0={readContext:ts,use:qh,useCallback:function(r,i){return ys().memoizedState=[r,i===void 0?null:i],r},useContext:ts,useEffect:i0,useImperativeHandle:function(r,i,c){c=c!=null?c.concat([r]):null,Gh(4194308,4,u0.bind(null,i,r),c)},useLayoutEffect:function(r,i){return Gh(4194308,4,r,i)},useInsertionEffect:function(r,i){Gh(4,2,r,i)},useMemo:function(r,i){var c=ys();i=i===void 0?null:i;var d=r();if(jo){Zn(!0);try{r()}finally{Zn(!1)}}return c.memoizedState=[d,i],d},useReducer:function(r,i,c){var d=ys();if(c!==void 0){var g=c(i);if(jo){Zn(!0);try{c(i)}finally{Zn(!1)}}}else g=i;return d.memoizedState=d.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},d.queue=r,r=r.dispatch=GI.bind(null,Je,r),[d.memoizedState,r]},useRef:function(r){var i=ys();return r={current:r},i.memoizedState=r},useState:function(r){r=op(r);var i=r.queue,c=b0.bind(null,Je,i);return i.dispatch=c,[r.memoizedState,c]},useDebugValue:cp,useDeferredValue:function(r,i){var c=ys();return up(c,r,i)},useTransition:function(){var r=op(!1);return r=g0.bind(null,Je,r.queue,!0,!1),ys().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,i,c){var d=Je,g=ys();if(xt){if(c===void 0)throw Error(n(407));c=c()}else{if(c=i(),Lt===null)throw Error(n(349));(ht&124)!==0||Hb(d,i,c)}g.memoizedState=c;var y={value:c,getSnapshot:i};return g.queue=y,i0($b.bind(null,d,y,r),[r]),d.flags|=2048,Fl(9,Hh(),Gb.bind(null,d,y,c,i),null),c},useId:function(){var r=ys(),i=Lt.identifierPrefix;if(xt){var c=_a,d=ba;c=(d&~(1<<32-vn(d)-1)).toString(32)+c,i=""+i+"R"+c,c=Bh++,0<c&&(i+="H"+c.toString(32)),i+=""}else c=UI++,i=""+i+"r"+c.toString(32)+"";return r.memoizedState=i},useHostTransitionStatus:hp,useFormState:t0,useActionState:t0,useOptimistic:function(r){var i=ys();i.memoizedState=i.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=c,i=fp.bind(null,Je,!0,c),c.dispatch=i,[r,i]},useMemoCache:rp,useCacheRefresh:function(){return ys().memoizedState=HI.bind(null,Je)}},E0={readContext:ts,use:qh,useCallback:h0,useContext:ts,useEffect:o0,useImperativeHandle:d0,useInsertionEffect:l0,useLayoutEffect:c0,useMemo:f0,useReducer:zh,useRef:a0,useState:function(){return zh(Ea)},useDebugValue:cp,useDeferredValue:function(r,i){var c=gn();return m0(c,Rt.memoizedState,r,i)},useTransition:function(){var r=zh(Ea)[0],i=gn().memoizedState;return[typeof r=="boolean"?r:Cu(r),i]},useSyncExternalStore:zb,useId:x0,useHostTransitionStatus:hp,useFormState:n0,useActionState:n0,useOptimistic:function(r,i){var c=gn();return Yb(c,Rt,r,i)},useMemoCache:rp,useCacheRefresh:v0},$I={readContext:ts,use:qh,useCallback:h0,useContext:ts,useEffect:o0,useImperativeHandle:d0,useInsertionEffect:l0,useLayoutEffect:c0,useMemo:f0,useReducer:ip,useRef:a0,useState:function(){return ip(Ea)},useDebugValue:cp,useDeferredValue:function(r,i){var c=gn();return Rt===null?up(c,r,i):m0(c,Rt.memoizedState,r,i)},useTransition:function(){var r=ip(Ea)[0],i=gn().memoizedState;return[typeof r=="boolean"?r:Cu(r),i]},useSyncExternalStore:zb,useId:x0,useHostTransitionStatus:hp,useFormState:r0,useActionState:r0,useOptimistic:function(r,i){var c=gn();return Rt!==null?Yb(c,Rt,r,i):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:rp,useCacheRefresh:v0},Bl=null,Du=0;function Qh(r){var i=Du;return Du+=1,Bl===null&&(Bl=[]),Mb(Bl,r,i)}function Pu(r,i){i=i.props.ref,r.ref=i!==void 0?i:null}function Yh(r,i){throw i.$$typeof===_?Error(n(525)):(r=Object.prototype.toString.call(i),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":r)))}function N0(r){var i=r._init;return i(r._payload)}function S0(r){function i(X,K){if(r){var Z=X.deletions;Z===null?(X.deletions=[K],X.flags|=16):Z.push(K)}}function c(X,K){if(!r)return null;for(;K!==null;)i(X,K),K=K.sibling;return null}function d(X){for(var K=new Map;X!==null;)X.key!==null?K.set(X.key,X):K.set(X.index,X),X=X.sibling;return K}function g(X,K){return X=va(X,K),X.index=0,X.sibling=null,X}function y(X,K,Z){return X.index=Z,r?(Z=X.alternate,Z!==null?(Z=Z.index,Z<K?(X.flags|=67108866,K):Z):(X.flags|=67108866,K)):(X.flags|=1048576,K)}function E(X){return r&&X.alternate===null&&(X.flags|=67108866),X}function S(X,K,Z,fe){return K===null||K.tag!==6?(K=Pg(Z,X.mode,fe),K.return=X,K):(K=g(K,Z),K.return=X,K)}function q(X,K,Z,fe){var Re=Z.type;return Re===C?de(X,K,Z.props.children,fe,Z.key):K!==null&&(K.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===T&&N0(Re)===K.type)?(K=g(K,Z.props),Pu(K,Z),K.return=X,K):(K=Rh(Z.type,Z.key,Z.props,null,X.mode,fe),Pu(K,Z),K.return=X,K)}function te(X,K,Z,fe){return K===null||K.tag!==4||K.stateNode.containerInfo!==Z.containerInfo||K.stateNode.implementation!==Z.implementation?(K=Mg(Z,X.mode,fe),K.return=X,K):(K=g(K,Z.children||[]),K.return=X,K)}function de(X,K,Z,fe,Re){return K===null||K.tag!==7?(K=bo(Z,X.mode,fe,Re),K.return=X,K):(K=g(K,Z),K.return=X,K)}function me(X,K,Z){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return K=Pg(""+K,X.mode,Z),K.return=X,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case b:return Z=Rh(K.type,K.key,K.props,null,X.mode,Z),Pu(Z,K),Z.return=X,Z;case N:return K=Mg(K,X.mode,Z),K.return=X,K;case T:var fe=K._init;return K=fe(K._payload),me(X,K,Z)}if(ae(K)||G(K))return K=bo(K,X.mode,Z,null),K.return=X,K;if(typeof K.then=="function")return me(X,Qh(K),Z);if(K.$$typeof===B)return me(X,Mh(X,K),Z);Yh(X,K)}return null}function re(X,K,Z,fe){var Re=K!==null?K.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Re!==null?null:S(X,K,""+Z,fe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case b:return Z.key===Re?q(X,K,Z,fe):null;case N:return Z.key===Re?te(X,K,Z,fe):null;case T:return Re=Z._init,Z=Re(Z._payload),re(X,K,Z,fe)}if(ae(Z)||G(Z))return Re!==null?null:de(X,K,Z,fe,null);if(typeof Z.then=="function")return re(X,K,Qh(Z),fe);if(Z.$$typeof===B)return re(X,K,Mh(X,Z),fe);Yh(X,Z)}return null}function ie(X,K,Z,fe,Re){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return X=X.get(Z)||null,S(K,X,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case b:return X=X.get(fe.key===null?Z:fe.key)||null,q(K,X,fe,Re);case N:return X=X.get(fe.key===null?Z:fe.key)||null,te(K,X,fe,Re);case T:var et=fe._init;return fe=et(fe._payload),ie(X,K,Z,fe,Re)}if(ae(fe)||G(fe))return X=X.get(Z)||null,de(K,X,fe,Re,null);if(typeof fe.then=="function")return ie(X,K,Z,Qh(fe),Re);if(fe.$$typeof===B)return ie(X,K,Z,Mh(K,fe),Re);Yh(K,fe)}return null}function He(X,K,Z,fe){for(var Re=null,et=null,Oe=K,Be=K=0,Un=null;Oe!==null&&Be<Z.length;Be++){Oe.index>Be?(Un=Oe,Oe=null):Un=Oe.sibling;var yt=re(X,Oe,Z[Be],fe);if(yt===null){Oe===null&&(Oe=Un);break}r&&Oe&&yt.alternate===null&&i(X,Oe),K=y(yt,K,Be),et===null?Re=yt:et.sibling=yt,et=yt,Oe=Un}if(Be===Z.length)return c(X,Oe),xt&&wo(X,Be),Re;if(Oe===null){for(;Be<Z.length;Be++)Oe=me(X,Z[Be],fe),Oe!==null&&(K=y(Oe,K,Be),et===null?Re=Oe:et.sibling=Oe,et=Oe);return xt&&wo(X,Be),Re}for(Oe=d(Oe);Be<Z.length;Be++)Un=ie(Oe,X,Be,Z[Be],fe),Un!==null&&(r&&Un.alternate!==null&&Oe.delete(Un.key===null?Be:Un.key),K=y(Un,K,Be),et===null?Re=Un:et.sibling=Un,et=Un);return r&&Oe.forEach(function(wi){return i(X,wi)}),xt&&wo(X,Be),Re}function Fe(X,K,Z,fe){if(Z==null)throw Error(n(151));for(var Re=null,et=null,Oe=K,Be=K=0,Un=null,yt=Z.next();Oe!==null&&!yt.done;Be++,yt=Z.next()){Oe.index>Be?(Un=Oe,Oe=null):Un=Oe.sibling;var wi=re(X,Oe,yt.value,fe);if(wi===null){Oe===null&&(Oe=Un);break}r&&Oe&&wi.alternate===null&&i(X,Oe),K=y(wi,K,Be),et===null?Re=wi:et.sibling=wi,et=wi,Oe=Un}if(yt.done)return c(X,Oe),xt&&wo(X,Be),Re;if(Oe===null){for(;!yt.done;Be++,yt=Z.next())yt=me(X,yt.value,fe),yt!==null&&(K=y(yt,K,Be),et===null?Re=yt:et.sibling=yt,et=yt);return xt&&wo(X,Be),Re}for(Oe=d(Oe);!yt.done;Be++,yt=Z.next())yt=ie(Oe,X,Be,yt.value,fe),yt!==null&&(r&&yt.alternate!==null&&Oe.delete(yt.key===null?Be:yt.key),K=y(yt,K,Be),et===null?Re=yt:et.sibling=yt,et=yt);return r&&Oe.forEach(function(KC){return i(X,KC)}),xt&&wo(X,Be),Re}function Dt(X,K,Z,fe){if(typeof Z=="object"&&Z!==null&&Z.type===C&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case b:e:{for(var Re=Z.key;K!==null;){if(K.key===Re){if(Re=Z.type,Re===C){if(K.tag===7){c(X,K.sibling),fe=g(K,Z.props.children),fe.return=X,X=fe;break e}}else if(K.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===T&&N0(Re)===K.type){c(X,K.sibling),fe=g(K,Z.props),Pu(fe,Z),fe.return=X,X=fe;break e}c(X,K);break}else i(X,K);K=K.sibling}Z.type===C?(fe=bo(Z.props.children,X.mode,fe,Z.key),fe.return=X,X=fe):(fe=Rh(Z.type,Z.key,Z.props,null,X.mode,fe),Pu(fe,Z),fe.return=X,X=fe)}return E(X);case N:e:{for(Re=Z.key;K!==null;){if(K.key===Re)if(K.tag===4&&K.stateNode.containerInfo===Z.containerInfo&&K.stateNode.implementation===Z.implementation){c(X,K.sibling),fe=g(K,Z.children||[]),fe.return=X,X=fe;break e}else{c(X,K);break}else i(X,K);K=K.sibling}fe=Mg(Z,X.mode,fe),fe.return=X,X=fe}return E(X);case T:return Re=Z._init,Z=Re(Z._payload),Dt(X,K,Z,fe)}if(ae(Z))return He(X,K,Z,fe);if(G(Z)){if(Re=G(Z),typeof Re!="function")throw Error(n(150));return Z=Re.call(Z),Fe(X,K,Z,fe)}if(typeof Z.then=="function")return Dt(X,K,Qh(Z),fe);if(Z.$$typeof===B)return Dt(X,K,Mh(X,Z),fe);Yh(X,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint"?(Z=""+Z,K!==null&&K.tag===6?(c(X,K.sibling),fe=g(K,Z),fe.return=X,X=fe):(c(X,K),fe=Pg(Z,X.mode,fe),fe.return=X,X=fe),E(X)):c(X,K)}return function(X,K,Z,fe){try{Du=0;var Re=Dt(X,K,Z,fe);return Bl=null,Re}catch(Oe){if(Oe===Eu||Oe===Vh)throw Oe;var et=Us(29,Oe,null,X.mode);return et.lanes=fe,et.return=X,et}finally{}}}var ql=S0(!0),A0=S0(!1),hr=se(null),Xr=null;function oi(r){var i=r.alternate;ue(En,En.current&1),ue(hr,r),Xr===null&&(i===null||Vl.current!==null||i.memoizedState!==null)&&(Xr=r)}function j0(r){if(r.tag===22){if(ue(En,En.current),ue(hr,r),Xr===null){var i=r.alternate;i!==null&&i.memoizedState!==null&&(Xr=r)}}else li()}function li(){ue(En,En.current),ue(hr,hr.current)}function Na(r){xe(hr),Xr===r&&(Xr=null),xe(En)}var En=se(0);function Xh(r){for(var i=r;i!==null;){if(i.tag===13){var c=i.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||sy(c)))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}function mp(r,i,c,d){i=r.memoizedState,c=c(d,i),c=c==null?i:x({},i,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var gp={enqueueSetState:function(r,i,c){r=r._reactInternals;var d=zs(),g=ri(d);g.payload=i,c!=null&&(g.callback=c),i=ai(r,g,d),i!==null&&(Hs(i,r,d),Su(i,r,d))},enqueueReplaceState:function(r,i,c){r=r._reactInternals;var d=zs(),g=ri(d);g.tag=1,g.payload=i,c!=null&&(g.callback=c),i=ai(r,g,d),i!==null&&(Hs(i,r,d),Su(i,r,d))},enqueueForceUpdate:function(r,i){r=r._reactInternals;var c=zs(),d=ri(c);d.tag=2,i!=null&&(d.callback=i),i=ai(r,d,c),i!==null&&(Hs(i,r,c),Su(i,r,c))}};function I0(r,i,c,d,g,y,E){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,y,E):i.prototype&&i.prototype.isPureReactComponent?!pu(c,d)||!pu(g,y):!0}function C0(r,i,c,d){r=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(c,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(c,d),i.state!==r&&gp.enqueueReplaceState(i,i.state,null)}function Io(r,i){var c=i;if("ref"in i){c={};for(var d in i)d!=="ref"&&(c[d]=i[d])}if(r=r.defaultProps){c===i&&(c=x({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}var Wh=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function R0(r){Wh(r)}function k0(r){console.error(r)}function D0(r){Wh(r)}function Jh(r,i){try{var c=r.onUncaughtError;c(i.value,{componentStack:i.stack})}catch(d){setTimeout(function(){throw d})}}function P0(r,i,c){try{var d=r.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function pp(r,i,c){return c=ri(c),c.tag=3,c.payload={element:null},c.callback=function(){Jh(r,i)},c}function M0(r){return r=ri(r),r.tag=3,r}function O0(r,i,c,d){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=d.value;r.payload=function(){return g(y)},r.callback=function(){P0(i,c,d)}}var E=c.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(r.callback=function(){P0(i,c,d),typeof g!="function"&&(mi===null?mi=new Set([this]):mi.add(this));var S=d.stack;this.componentDidCatch(d.value,{componentStack:S!==null?S:""})})}function KI(r,i,c,d,g){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(i=c.alternate,i!==null&&_u(i,c,g,!0),c=hr.current,c!==null){switch(c.tag){case 13:return Xr===null?Fp():c.alternate===null&&rn===0&&(rn=3),c.flags&=-257,c.flags|=65536,c.lanes=g,d===Gg?c.flags|=16384:(i=c.updateQueue,i===null?c.updateQueue=new Set([d]):i.add(d),qp(r,d,g)),!1;case 22:return c.flags|=65536,d===Gg?c.flags|=16384:(i=c.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=i):(c=i.retryQueue,c===null?i.retryQueue=new Set([d]):c.add(d)),qp(r,d,g)),!1}throw Error(n(435,c.tag))}return qp(r,d,g),Fp(),!1}if(xt)return i=hr.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=g,d!==Lg&&(r=Error(n(422),{cause:d}),bu(lr(r,c)))):(d!==Lg&&(i=Error(n(423),{cause:d}),bu(lr(i,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,d=lr(d,c),g=pp(r.stateNode,d,g),Qg(r,g),rn!==4&&(rn=2)),!1;var y=Error(n(520),{cause:d});if(y=lr(y,c),Bu===null?Bu=[y]:Bu.push(y),rn!==4&&(rn=2),i===null)return!0;d=lr(d,c),c=i;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=pp(c.stateNode,d,r),Qg(c,r),!1;case 1:if(i=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(mi===null||!mi.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=M0(g),O0(g,r,c,d),Qg(c,g),!1}c=c.return}while(c!==null);return!1}var V0=Error(n(461)),Vn=!1;function Qn(r,i,c,d){i.child=r===null?A0(i,null,c,d):ql(i,r.child,c,d)}function L0(r,i,c,d,g){c=c.render;var y=i.ref;if("ref"in d){var E={};for(var S in d)S!=="ref"&&(E[S]=d[S])}else E=d;return So(i),d=Zg(r,i,c,E,y,g),S=ep(),r!==null&&!Vn?(tp(r,i,g),Sa(r,i,g)):(xt&&S&&Og(i),i.flags|=1,Qn(r,i,d,g),i.child)}function U0(r,i,c,d,g){if(r===null){var y=c.type;return typeof y=="function"&&!Dg(y)&&y.defaultProps===void 0&&c.compare===null?(i.tag=15,i.type=y,F0(r,i,y,d,g)):(r=Rh(c.type,null,d,i,i.mode,g),r.ref=i.ref,r.return=i,i.child=r)}if(y=r.child,!Ep(r,g)){var E=y.memoizedProps;if(c=c.compare,c=c!==null?c:pu,c(E,d)&&r.ref===i.ref)return Sa(r,i,g)}return i.flags|=1,r=va(y,d),r.ref=i.ref,r.return=i,i.child=r}function F0(r,i,c,d,g){if(r!==null){var y=r.memoizedProps;if(pu(y,d)&&r.ref===i.ref)if(Vn=!1,i.pendingProps=d=y,Ep(r,g))(r.flags&131072)!==0&&(Vn=!0);else return i.lanes=r.lanes,Sa(r,i,g)}return yp(r,i,c,d,g)}function B0(r,i,c){var d=i.pendingProps,g=d.children,y=r!==null?r.memoizedState:null;if(d.mode==="hidden"){if((i.flags&128)!==0){if(d=y!==null?y.baseLanes|c:c,r!==null){for(g=i.child=r.child,y=0;g!==null;)y=y|g.lanes|g.childLanes,g=g.sibling;i.childLanes=y&~d}else i.childLanes=0,i.child=null;return q0(r,i,d,c)}if((c&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},r!==null&&Oh(i,y!==null?y.cachePool:null),y!==null?Fb(i,y):Xg(),j0(i);else return i.lanes=i.childLanes=536870912,q0(r,i,y!==null?y.baseLanes|c:c,c)}else y!==null?(Oh(i,y.cachePool),Fb(i,y),li(),i.memoizedState=null):(r!==null&&Oh(i,null),Xg(),li());return Qn(r,i,g,c),i.child}function q0(r,i,c,d){var g=Hg();return g=g===null?null:{parent:Tn._currentValue,pool:g},i.memoizedState={baseLanes:c,cachePool:g},r!==null&&Oh(i,null),Xg(),j0(i),r!==null&&_u(r,i,d,!0),null}function Zh(r,i){var c=i.ref;if(c===null)r!==null&&r.ref!==null&&(i.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(r===null||r.ref!==c)&&(i.flags|=4194816)}}function yp(r,i,c,d,g){return So(i),c=Zg(r,i,c,d,void 0,g),d=ep(),r!==null&&!Vn?(tp(r,i,g),Sa(r,i,g)):(xt&&d&&Og(i),i.flags|=1,Qn(r,i,c,g),i.child)}function z0(r,i,c,d,g,y){return So(i),i.updateQueue=null,c=qb(i,d,c,g),Bb(r),d=ep(),r!==null&&!Vn?(tp(r,i,y),Sa(r,i,y)):(xt&&d&&Og(i),i.flags|=1,Qn(r,i,c,y),i.child)}function H0(r,i,c,d,g){if(So(i),i.stateNode===null){var y=kl,E=c.contextType;typeof E=="object"&&E!==null&&(y=ts(E)),y=new c(d,y),i.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=gp,i.stateNode=y,y._reactInternals=i,y=i.stateNode,y.props=d,y.state=i.memoizedState,y.refs={},$g(i),E=c.contextType,y.context=typeof E=="object"&&E!==null?ts(E):kl,y.state=i.memoizedState,E=c.getDerivedStateFromProps,typeof E=="function"&&(mp(i,c,E,d),y.state=i.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(E=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),E!==y.state&&gp.enqueueReplaceState(y,y.state,null),ju(i,d,y,g),Au(),y.state=i.memoizedState),typeof y.componentDidMount=="function"&&(i.flags|=4194308),d=!0}else if(r===null){y=i.stateNode;var S=i.memoizedProps,q=Io(c,S);y.props=q;var te=y.context,de=c.contextType;E=kl,typeof de=="object"&&de!==null&&(E=ts(de));var me=c.getDerivedStateFromProps;de=typeof me=="function"||typeof y.getSnapshotBeforeUpdate=="function",S=i.pendingProps!==S,de||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(S||te!==E)&&C0(i,y,d,E),si=!1;var re=i.memoizedState;y.state=re,ju(i,d,y,g),Au(),te=i.memoizedState,S||re!==te||si?(typeof me=="function"&&(mp(i,c,me,d),te=i.memoizedState),(q=si||I0(i,c,q,d,re,te,E))?(de||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(i.flags|=4194308)):(typeof y.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=te),y.props=d,y.state=te,y.context=E,d=q):(typeof y.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{y=i.stateNode,Kg(r,i),E=i.memoizedProps,de=Io(c,E),y.props=de,me=i.pendingProps,re=y.context,te=c.contextType,q=kl,typeof te=="object"&&te!==null&&(q=ts(te)),S=c.getDerivedStateFromProps,(te=typeof S=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(E!==me||re!==q)&&C0(i,y,d,q),si=!1,re=i.memoizedState,y.state=re,ju(i,d,y,g),Au();var ie=i.memoizedState;E!==me||re!==ie||si||r!==null&&r.dependencies!==null&&Ph(r.dependencies)?(typeof S=="function"&&(mp(i,c,S,d),ie=i.memoizedState),(de=si||I0(i,c,de,d,re,ie,q)||r!==null&&r.dependencies!==null&&Ph(r.dependencies))?(te||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,ie,q),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,ie,q)),typeof y.componentDidUpdate=="function"&&(i.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof y.componentDidUpdate!="function"||E===r.memoizedProps&&re===r.memoizedState||(i.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&re===r.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=ie),y.props=d,y.state=ie,y.context=q,d=de):(typeof y.componentDidUpdate!="function"||E===r.memoizedProps&&re===r.memoizedState||(i.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&re===r.memoizedState||(i.flags|=1024),d=!1)}return y=d,Zh(r,i),d=(i.flags&128)!==0,y||d?(y=i.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:y.render(),i.flags|=1,r!==null&&d?(i.child=ql(i,r.child,null,g),i.child=ql(i,null,c,g)):Qn(r,i,c,g),i.memoizedState=y.state,r=i.child):r=Sa(r,i,g),r}function G0(r,i,c,d){return vu(),i.flags|=256,Qn(r,i,c,d),i.child}var xp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vp(r){return{baseLanes:r,cachePool:kb()}}function bp(r,i,c){return r=r!==null?r.childLanes&~c:0,i&&(r|=fr),r}function $0(r,i,c){var d=i.pendingProps,g=!1,y=(i.flags&128)!==0,E;if((E=y)||(E=r!==null&&r.memoizedState===null?!1:(En.current&2)!==0),E&&(g=!0,i.flags&=-129),E=(i.flags&32)!==0,i.flags&=-33,r===null){if(xt){if(g?oi(i):li(),xt){var S=sn,q;if(q=S){e:{for(q=S,S=Yr;q.nodeType!==8;){if(!S){S=null;break e}if(q=jr(q.nextSibling),q===null){S=null;break e}}S=q}S!==null?(i.memoizedState={dehydrated:S,treeContext:_o!==null?{id:ba,overflow:_a}:null,retryLane:536870912,hydrationErrors:null},q=Us(18,null,null,0),q.stateNode=S,q.return=i,i.child=q,fs=i,sn=null,q=!0):q=!1}q||Eo(i)}if(S=i.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return sy(S)?i.lanes=32:i.lanes=536870912,null;Na(i)}return S=d.children,d=d.fallback,g?(li(),g=i.mode,S=ef({mode:"hidden",children:S},g),d=bo(d,g,c,null),S.return=i,d.return=i,S.sibling=d,i.child=S,g=i.child,g.memoizedState=vp(c),g.childLanes=bp(r,E,c),i.memoizedState=xp,d):(oi(i),_p(i,S))}if(q=r.memoizedState,q!==null&&(S=q.dehydrated,S!==null)){if(y)i.flags&256?(oi(i),i.flags&=-257,i=wp(r,i,c)):i.memoizedState!==null?(li(),i.child=r.child,i.flags|=128,i=null):(li(),g=d.fallback,S=i.mode,d=ef({mode:"visible",children:d.children},S),g=bo(g,S,c,null),g.flags|=2,d.return=i,g.return=i,d.sibling=g,i.child=d,ql(i,r.child,null,c),d=i.child,d.memoizedState=vp(c),d.childLanes=bp(r,E,c),i.memoizedState=xp,i=g);else if(oi(i),sy(S)){if(E=S.nextSibling&&S.nextSibling.dataset,E)var te=E.dgst;E=te,d=Error(n(419)),d.stack="",d.digest=E,bu({value:d,source:null,stack:null}),i=wp(r,i,c)}else if(Vn||_u(r,i,c,!1),E=(c&r.childLanes)!==0,Vn||E){if(E=Lt,E!==null&&(d=c&-c,d=(d&42)!==0?1:us(d),d=(d&(E.suspendedLanes|c))!==0?0:d,d!==0&&d!==q.retryLane))throw q.retryLane=d,Rl(r,d),Hs(E,r,d),V0;S.data==="$?"||Fp(),i=wp(r,i,c)}else S.data==="$?"?(i.flags|=192,i.child=r.child,i=null):(r=q.treeContext,sn=jr(S.nextSibling),fs=i,xt=!0,To=null,Yr=!1,r!==null&&(ur[dr++]=ba,ur[dr++]=_a,ur[dr++]=_o,ba=r.id,_a=r.overflow,_o=i),i=_p(i,d.children),i.flags|=4096);return i}return g?(li(),g=d.fallback,S=i.mode,q=r.child,te=q.sibling,d=va(q,{mode:"hidden",children:d.children}),d.subtreeFlags=q.subtreeFlags&65011712,te!==null?g=va(te,g):(g=bo(g,S,c,null),g.flags|=2),g.return=i,d.return=i,d.sibling=g,i.child=d,d=g,g=i.child,S=r.child.memoizedState,S===null?S=vp(c):(q=S.cachePool,q!==null?(te=Tn._currentValue,q=q.parent!==te?{parent:te,pool:te}:q):q=kb(),S={baseLanes:S.baseLanes|c,cachePool:q}),g.memoizedState=S,g.childLanes=bp(r,E,c),i.memoizedState=xp,d):(oi(i),c=r.child,r=c.sibling,c=va(c,{mode:"visible",children:d.children}),c.return=i,c.sibling=null,r!==null&&(E=i.deletions,E===null?(i.deletions=[r],i.flags|=16):E.push(r)),i.child=c,i.memoizedState=null,c)}function _p(r,i){return i=ef({mode:"visible",children:i},r.mode),i.return=r,r.child=i}function ef(r,i){return r=Us(22,r,null,i),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function wp(r,i,c){return ql(i,r.child,null,c),r=_p(i,i.pendingProps.children),r.flags|=2,i.memoizedState=null,r}function K0(r,i,c){r.lanes|=i;var d=r.alternate;d!==null&&(d.lanes|=i),Fg(r.return,i,c)}function Tp(r,i,c,d,g){var y=r.memoizedState;y===null?r.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:g}:(y.isBackwards=i,y.rendering=null,y.renderingStartTime=0,y.last=d,y.tail=c,y.tailMode=g)}function Q0(r,i,c){var d=i.pendingProps,g=d.revealOrder,y=d.tail;if(Qn(r,i,d.children,c),d=En.current,(d&2)!==0)d=d&1|2,i.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=i.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&K0(r,c,i);else if(r.tag===19)K0(r,c,i);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break e;for(;r.sibling===null;){if(r.return===null||r.return===i)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}switch(ue(En,d),g){case"forwards":for(c=i.child,g=null;c!==null;)r=c.alternate,r!==null&&Xh(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=i.child,i.child=null):(g=c.sibling,c.sibling=null),Tp(i,!1,g,c,y);break;case"backwards":for(c=null,g=i.child,i.child=null;g!==null;){if(r=g.alternate,r!==null&&Xh(r)===null){i.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}Tp(i,!0,c,null,y);break;case"together":Tp(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Sa(r,i,c){if(r!==null&&(i.dependencies=r.dependencies),fi|=i.lanes,(c&i.childLanes)===0)if(r!==null){if(_u(r,i,c,!1),(c&i.childLanes)===0)return null}else return null;if(r!==null&&i.child!==r.child)throw Error(n(153));if(i.child!==null){for(r=i.child,c=va(r,r.pendingProps),i.child=c,c.return=i;r.sibling!==null;)r=r.sibling,c=c.sibling=va(r,r.pendingProps),c.return=i;c.sibling=null}return i.child}function Ep(r,i){return(r.lanes&i)!==0?!0:(r=r.dependencies,!!(r!==null&&Ph(r)))}function QI(r,i,c){switch(i.tag){case 3:_e(i,i.stateNode.containerInfo),ni(i,Tn,r.memoizedState.cache),vu();break;case 27:case 5:Ue(i);break;case 4:_e(i,i.stateNode.containerInfo);break;case 10:ni(i,i.type,i.memoizedProps.value);break;case 13:var d=i.memoizedState;if(d!==null)return d.dehydrated!==null?(oi(i),i.flags|=128,null):(c&i.child.childLanes)!==0?$0(r,i,c):(oi(i),r=Sa(r,i,c),r!==null?r.sibling:null);oi(i);break;case 19:var g=(r.flags&128)!==0;if(d=(c&i.childLanes)!==0,d||(_u(r,i,c,!1),d=(c&i.childLanes)!==0),g){if(d)return Q0(r,i,c);i.flags|=128}if(g=i.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ue(En,En.current),d)break;return null;case 22:case 23:return i.lanes=0,B0(r,i,c);case 24:ni(i,Tn,r.memoizedState.cache)}return Sa(r,i,c)}function Y0(r,i,c){if(r!==null)if(r.memoizedProps!==i.pendingProps)Vn=!0;else{if(!Ep(r,c)&&(i.flags&128)===0)return Vn=!1,QI(r,i,c);Vn=(r.flags&131072)!==0}else Vn=!1,xt&&(i.flags&1048576)!==0&&Nb(i,Dh,i.index);switch(i.lanes=0,i.tag){case 16:e:{r=i.pendingProps;var d=i.elementType,g=d._init;if(d=g(d._payload),i.type=d,typeof d=="function")Dg(d)?(r=Io(d,r),i.tag=1,i=H0(null,i,d,r,c)):(i.tag=0,i=yp(null,i,d,r,c));else{if(d!=null){if(g=d.$$typeof,g===H){i.tag=11,i=L0(null,i,d,r,c);break e}else if(g===R){i.tag=14,i=U0(null,i,d,r,c);break e}}throw i=Ve(d)||d,Error(n(306,i,""))}}return i;case 0:return yp(r,i,i.type,i.pendingProps,c);case 1:return d=i.type,g=Io(d,i.pendingProps),H0(r,i,d,g,c);case 3:e:{if(_e(i,i.stateNode.containerInfo),r===null)throw Error(n(387));d=i.pendingProps;var y=i.memoizedState;g=y.element,Kg(r,i),ju(i,d,null,c);var E=i.memoizedState;if(d=E.cache,ni(i,Tn,d),d!==y.cache&&Bg(i,[Tn],c,!0),Au(),d=E.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:E.cache},i.updateQueue.baseState=y,i.memoizedState=y,i.flags&256){i=G0(r,i,d,c);break e}else if(d!==g){g=lr(Error(n(424)),i),bu(g),i=G0(r,i,d,c);break e}else{switch(r=i.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(sn=jr(r.firstChild),fs=i,xt=!0,To=null,Yr=!0,c=A0(i,null,d,c),i.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(vu(),d===g){i=Sa(r,i,c);break e}Qn(r,i,d,c)}i=i.child}return i;case 26:return Zh(r,i),r===null?(c=Z_(i.type,null,i.pendingProps,null))?i.memoizedState=c:xt||(c=i.type,r=i.pendingProps,d=gf(Ne.current).createElement(c),d[tn]=i,d[nn]=r,Xn(d,c,r),Xt(d),i.stateNode=d):i.memoizedState=Z_(i.type,r.memoizedProps,i.pendingProps,r.memoizedState),null;case 27:return Ue(i),r===null&&xt&&(d=i.stateNode=X_(i.type,i.pendingProps,Ne.current),fs=i,Yr=!0,g=sn,yi(i.type)?(ry=g,sn=jr(d.firstChild)):sn=g),Qn(r,i,i.pendingProps.children,c),Zh(r,i),r===null&&(i.flags|=4194304),i.child;case 5:return r===null&&xt&&((g=d=sn)&&(d=wC(d,i.type,i.pendingProps,Yr),d!==null?(i.stateNode=d,fs=i,sn=jr(d.firstChild),Yr=!1,g=!0):g=!1),g||Eo(i)),Ue(i),g=i.type,y=i.pendingProps,E=r!==null?r.memoizedProps:null,d=y.children,ey(g,y)?d=null:E!==null&&ey(g,E)&&(i.flags|=32),i.memoizedState!==null&&(g=Zg(r,i,FI,null,null,c),Xu._currentValue=g),Zh(r,i),Qn(r,i,d,c),i.child;case 6:return r===null&&xt&&((r=c=sn)&&(c=TC(c,i.pendingProps,Yr),c!==null?(i.stateNode=c,fs=i,sn=null,r=!0):r=!1),r||Eo(i)),null;case 13:return $0(r,i,c);case 4:return _e(i,i.stateNode.containerInfo),d=i.pendingProps,r===null?i.child=ql(i,null,d,c):Qn(r,i,d,c),i.child;case 11:return L0(r,i,i.type,i.pendingProps,c);case 7:return Qn(r,i,i.pendingProps,c),i.child;case 8:return Qn(r,i,i.pendingProps.children,c),i.child;case 12:return Qn(r,i,i.pendingProps.children,c),i.child;case 10:return d=i.pendingProps,ni(i,i.type,d.value),Qn(r,i,d.children,c),i.child;case 9:return g=i.type._context,d=i.pendingProps.children,So(i),g=ts(g),d=d(g),i.flags|=1,Qn(r,i,d,c),i.child;case 14:return U0(r,i,i.type,i.pendingProps,c);case 15:return F0(r,i,i.type,i.pendingProps,c);case 19:return Q0(r,i,c);case 31:return d=i.pendingProps,c=i.mode,d={mode:d.mode,children:d.children},r===null?(c=ef(d,c),c.ref=i.ref,i.child=c,c.return=i,i=c):(c=va(r.child,d),c.ref=i.ref,i.child=c,c.return=i,i=c),i;case 22:return B0(r,i,c);case 24:return So(i),d=ts(Tn),r===null?(g=Hg(),g===null&&(g=Lt,y=qg(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),i.memoizedState={parent:d,cache:g},$g(i),ni(i,Tn,g)):((r.lanes&c)!==0&&(Kg(r,i),ju(i,null,null,c),Au()),g=r.memoizedState,y=i.memoizedState,g.parent!==d?(g={parent:d,cache:d},i.memoizedState=g,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=g),ni(i,Tn,d)):(d=y.cache,ni(i,Tn,d),d!==g.cache&&Bg(i,[Tn],c,!0))),Qn(r,i,i.pendingProps.children,c),i.child;case 29:throw i.pendingProps}throw Error(n(156,i.tag))}function Aa(r){r.flags|=4}function X0(r,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!rw(i)){if(i=hr.current,i!==null&&((ht&4194048)===ht?Xr!==null:(ht&62914560)!==ht&&(ht&536870912)===0||i!==Xr))throw Nu=Gg,Db;r.flags|=8192}}function tf(r,i){i!==null&&(r.flags|=4),r.flags&16384&&(i=r.tag!==22?Fr():536870912,r.lanes|=i,$l|=i)}function Mu(r,i){if(!xt)switch(r.tailMode){case"hidden":i=r.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?i||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function Wt(r){var i=r.alternate!==null&&r.alternate.child===r.child,c=0,d=0;if(i)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=d,r.childLanes=c,i}function YI(r,i,c){var d=i.pendingProps;switch(Vg(i),i.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(i),null;case 1:return Wt(i),null;case 3:return c=i.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),i.memoizedState.cache!==d&&(i.flags|=2048),Ta(Tn),Se(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(xu(i)?Aa(i):r===null||r.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,jb())),Wt(i),null;case 26:return c=i.memoizedState,r===null?(Aa(i),c!==null?(Wt(i),X0(i,c)):(Wt(i),i.flags&=-16777217)):c?c!==r.memoizedState?(Aa(i),Wt(i),X0(i,c)):(Wt(i),i.flags&=-16777217):(r.memoizedProps!==d&&Aa(i),Wt(i),i.flags&=-16777217),null;case 27:Ze(i),c=Ne.current;var g=i.type;if(r!==null&&i.stateNode!=null)r.memoizedProps!==d&&Aa(i);else{if(!d){if(i.stateNode===null)throw Error(n(166));return Wt(i),null}r=Ie.current,xu(i)?Sb(i):(r=X_(g,d,c),i.stateNode=r,Aa(i))}return Wt(i),null;case 5:if(Ze(i),c=i.type,r!==null&&i.stateNode!=null)r.memoizedProps!==d&&Aa(i);else{if(!d){if(i.stateNode===null)throw Error(n(166));return Wt(i),null}if(r=Ie.current,xu(i))Sb(i);else{switch(g=gf(Ne.current),r){case 1:r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof d.is=="string"?g.createElement("select",{is:d.is}):g.createElement("select"),d.multiple?r.multiple=!0:d.size&&(r.size=d.size);break;default:r=typeof d.is=="string"?g.createElement(c,{is:d.is}):g.createElement(c)}}r[tn]=i,r[nn]=d;e:for(g=i.child;g!==null;){if(g.tag===5||g.tag===6)r.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===i)break e;for(;g.sibling===null;){if(g.return===null||g.return===i)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}i.stateNode=r;e:switch(Xn(r,c,d),c){case"button":case"input":case"select":case"textarea":r=!!d.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Aa(i)}}return Wt(i),i.flags&=-16777217,null;case 6:if(r&&i.stateNode!=null)r.memoizedProps!==d&&Aa(i);else{if(typeof d!="string"&&i.stateNode===null)throw Error(n(166));if(r=Ne.current,xu(i)){if(r=i.stateNode,c=i.memoizedProps,d=null,g=fs,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}r[tn]=i,r=!!(r.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||z_(r.nodeValue,c)),r||Eo(i)}else r=gf(r).createTextNode(d),r[tn]=i,i.stateNode=r}return Wt(i),null;case 13:if(d=i.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=xu(i),d!==null&&d.dehydrated!==null){if(r===null){if(!g)throw Error(n(318));if(g=i.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(n(317));g[tn]=i}else vu(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Wt(i),g=!1}else g=jb(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return i.flags&256?(Na(i),i):(Na(i),null)}if(Na(i),(i.flags&128)!==0)return i.lanes=c,i;if(c=d!==null,r=r!==null&&r.memoizedState!==null,c){d=i.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool);var y=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==g&&(d.flags|=2048)}return c!==r&&c&&(i.child.flags|=8192),tf(i,i.updateQueue),Wt(i),null;case 4:return Se(),r===null&&Yp(i.stateNode.containerInfo),Wt(i),null;case 10:return Ta(i.type),Wt(i),null;case 19:if(xe(En),g=i.memoizedState,g===null)return Wt(i),null;if(d=(i.flags&128)!==0,y=g.rendering,y===null)if(d)Mu(g,!1);else{if(rn!==0||r!==null&&(r.flags&128)!==0)for(r=i.child;r!==null;){if(y=Xh(r),y!==null){for(i.flags|=128,Mu(g,!1),r=y.updateQueue,i.updateQueue=r,tf(i,r),i.subtreeFlags=0,r=c,c=i.child;c!==null;)Eb(c,r),c=c.sibling;return ue(En,En.current&1|2),i.child}r=r.sibling}g.tail!==null&&ct()>rf&&(i.flags|=128,d=!0,Mu(g,!1),i.lanes=4194304)}else{if(!d)if(r=Xh(y),r!==null){if(i.flags|=128,d=!0,r=r.updateQueue,i.updateQueue=r,tf(i,r),Mu(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!xt)return Wt(i),null}else 2*ct()-g.renderingStartTime>rf&&c!==536870912&&(i.flags|=128,d=!0,Mu(g,!1),i.lanes=4194304);g.isBackwards?(y.sibling=i.child,i.child=y):(r=g.last,r!==null?r.sibling=y:i.child=y,g.last=y)}return g.tail!==null?(i=g.tail,g.rendering=i,g.tail=i.sibling,g.renderingStartTime=ct(),i.sibling=null,r=En.current,ue(En,d?r&1|2:r&1),i):(Wt(i),null);case 22:case 23:return Na(i),Wg(),d=i.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(i.flags|=8192):d&&(i.flags|=8192),d?(c&536870912)!==0&&(i.flags&128)===0&&(Wt(i),i.subtreeFlags&6&&(i.flags|=8192)):Wt(i),c=i.updateQueue,c!==null&&tf(i,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),d=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),d!==c&&(i.flags|=2048),r!==null&&xe(Ao),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),i.memoizedState.cache!==c&&(i.flags|=2048),Ta(Tn),Wt(i),null;case 25:return null;case 30:return null}throw Error(n(156,i.tag))}function XI(r,i){switch(Vg(i),i.tag){case 1:return r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 3:return Ta(Tn),Se(),r=i.flags,(r&65536)!==0&&(r&128)===0?(i.flags=r&-65537|128,i):null;case 26:case 27:case 5:return Ze(i),null;case 13:if(Na(i),r=i.memoizedState,r!==null&&r.dehydrated!==null){if(i.alternate===null)throw Error(n(340));vu()}return r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 19:return xe(En),null;case 4:return Se(),null;case 10:return Ta(i.type),null;case 22:case 23:return Na(i),Wg(),r!==null&&xe(Ao),r=i.flags,r&65536?(i.flags=r&-65537|128,i):null;case 24:return Ta(Tn),null;case 25:return null;default:return null}}function W0(r,i){switch(Vg(i),i.tag){case 3:Ta(Tn),Se();break;case 26:case 27:case 5:Ze(i);break;case 4:Se();break;case 13:Na(i);break;case 19:xe(En);break;case 10:Ta(i.type);break;case 22:case 23:Na(i),Wg(),r!==null&&xe(Ao);break;case 24:Ta(Tn)}}function Ou(r,i){try{var c=i.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var g=d.next;c=g;do{if((c.tag&r)===r){d=void 0;var y=c.create,E=c.inst;d=y(),E.destroy=d}c=c.next}while(c!==g)}}catch(S){Vt(i,i.return,S)}}function ci(r,i,c){try{var d=i.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var y=g.next;d=y;do{if((d.tag&r)===r){var E=d.inst,S=E.destroy;if(S!==void 0){E.destroy=void 0,g=i;var q=c,te=S;try{te()}catch(de){Vt(g,q,de)}}}d=d.next}while(d!==y)}}catch(de){Vt(i,i.return,de)}}function J0(r){var i=r.updateQueue;if(i!==null){var c=r.stateNode;try{Ub(i,c)}catch(d){Vt(r,r.return,d)}}}function Z0(r,i,c){c.props=Io(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(d){Vt(r,i,d)}}function Vu(r,i){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof c=="function"?r.refCleanup=c(d):c.current=d}}catch(g){Vt(r,i,g)}}function Wr(r,i){var c=r.ref,d=r.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(g){Vt(r,i,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Vt(r,i,g)}else c.current=null}function e_(r){var i=r.type,c=r.memoizedProps,d=r.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break e;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(g){Vt(r,r.return,g)}}function Np(r,i,c){try{var d=r.stateNode;yC(d,r.type,c,i),d[nn]=i}catch(g){Vt(r,r.return,g)}}function t_(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&yi(r.type)||r.tag===4}function Sp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||t_(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&yi(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ap(r,i,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,i?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,i):(i=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,i.appendChild(r),c=c._reactRootContainer,c!=null||i.onclick!==null||(i.onclick=mf));else if(d!==4&&(d===27&&yi(r.type)&&(c=r.stateNode,i=null),r=r.child,r!==null))for(Ap(r,i,c),r=r.sibling;r!==null;)Ap(r,i,c),r=r.sibling}function nf(r,i,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,i?c.insertBefore(r,i):c.appendChild(r);else if(d!==4&&(d===27&&yi(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(nf(r,i,c),r=r.sibling;r!==null;)nf(r,i,c),r=r.sibling}function n_(r){var i=r.stateNode,c=r.memoizedProps;try{for(var d=r.type,g=i.attributes;g.length;)i.removeAttributeNode(g[0]);Xn(i,d,c),i[tn]=r,i[nn]=c}catch(y){Vt(r,r.return,y)}}var ja=!1,un=!1,jp=!1,s_=typeof WeakSet=="function"?WeakSet:Set,Ln=null;function WI(r,i){if(r=r.containerInfo,Jp=_f,r=mb(r),Sg(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var g=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var E=0,S=-1,q=-1,te=0,de=0,me=r,re=null;t:for(;;){for(var ie;me!==c||g!==0&&me.nodeType!==3||(S=E+g),me!==y||d!==0&&me.nodeType!==3||(q=E+d),me.nodeType===3&&(E+=me.nodeValue.length),(ie=me.firstChild)!==null;)re=me,me=ie;for(;;){if(me===r)break t;if(re===c&&++te===g&&(S=E),re===y&&++de===d&&(q=E),(ie=me.nextSibling)!==null)break;me=re,re=me.parentNode}me=ie}c=S===-1||q===-1?null:{start:S,end:q}}else c=null}c=c||{start:0,end:0}}else c=null;for(Zp={focusedElem:r,selectionRange:c},_f=!1,Ln=i;Ln!==null;)if(i=Ln,r=i.child,(i.subtreeFlags&1024)!==0&&r!==null)r.return=i,Ln=r;else for(;Ln!==null;){switch(i=Ln,y=i.alternate,r=i.flags,i.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&y!==null){r=void 0,c=i,g=y.memoizedProps,y=y.memoizedState,d=c.stateNode;try{var He=Io(c.type,g,c.elementType===c.type);r=d.getSnapshotBeforeUpdate(He,y),d.__reactInternalSnapshotBeforeUpdate=r}catch(Fe){Vt(c,c.return,Fe)}}break;case 3:if((r&1024)!==0){if(r=i.stateNode.containerInfo,c=r.nodeType,c===9)ny(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":ny(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=i.sibling,r!==null){r.return=i.return,Ln=r;break}Ln=i.return}}function r_(r,i,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:ui(r,c),d&4&&Ou(5,c);break;case 1:if(ui(r,c),d&4)if(r=c.stateNode,i===null)try{r.componentDidMount()}catch(E){Vt(c,c.return,E)}else{var g=Io(c.type,i.memoizedProps);i=i.memoizedState;try{r.componentDidUpdate(g,i,r.__reactInternalSnapshotBeforeUpdate)}catch(E){Vt(c,c.return,E)}}d&64&&J0(c),d&512&&Vu(c,c.return);break;case 3:if(ui(r,c),d&64&&(r=c.updateQueue,r!==null)){if(i=null,c.child!==null)switch(c.child.tag){case 27:case 5:i=c.child.stateNode;break;case 1:i=c.child.stateNode}try{Ub(r,i)}catch(E){Vt(c,c.return,E)}}break;case 27:i===null&&d&4&&n_(c);case 26:case 5:ui(r,c),i===null&&d&4&&e_(c),d&512&&Vu(c,c.return);break;case 12:ui(r,c);break;case 13:ui(r,c),d&4&&o_(r,c),d&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=iC.bind(null,c),EC(r,c))));break;case 22:if(d=c.memoizedState!==null||ja,!d){i=i!==null&&i.memoizedState!==null||un,g=ja;var y=un;ja=d,(un=i)&&!y?di(r,c,(c.subtreeFlags&8772)!==0):ui(r,c),ja=g,un=y}break;case 30:break;default:ui(r,c)}}function a_(r){var i=r.alternate;i!==null&&(r.alternate=null,a_(i)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(i=r.stateNode,i!==null&&kn(i)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Ht=null,xs=!1;function Ia(r,i,c){for(c=c.child;c!==null;)i_(r,i,c),c=c.sibling}function i_(r,i,c){if(pt&&typeof pt.onCommitFiberUnmount=="function")try{pt.onCommitFiberUnmount(wt,c)}catch{}switch(c.tag){case 26:un||Wr(c,i),Ia(r,i,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:un||Wr(c,i);var d=Ht,g=xs;yi(c.type)&&(Ht=c.stateNode,xs=!1),Ia(r,i,c),$u(c.stateNode),Ht=d,xs=g;break;case 5:un||Wr(c,i);case 6:if(d=Ht,g=xs,Ht=null,Ia(r,i,c),Ht=d,xs=g,Ht!==null)if(xs)try{(Ht.nodeType===9?Ht.body:Ht.nodeName==="HTML"?Ht.ownerDocument.body:Ht).removeChild(c.stateNode)}catch(y){Vt(c,i,y)}else try{Ht.removeChild(c.stateNode)}catch(y){Vt(c,i,y)}break;case 18:Ht!==null&&(xs?(r=Ht,Q_(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),ed(r)):Q_(Ht,c.stateNode));break;case 4:d=Ht,g=xs,Ht=c.stateNode.containerInfo,xs=!0,Ia(r,i,c),Ht=d,xs=g;break;case 0:case 11:case 14:case 15:un||ci(2,c,i),un||ci(4,c,i),Ia(r,i,c);break;case 1:un||(Wr(c,i),d=c.stateNode,typeof d.componentWillUnmount=="function"&&Z0(c,i,d)),Ia(r,i,c);break;case 21:Ia(r,i,c);break;case 22:un=(d=un)||c.memoizedState!==null,Ia(r,i,c),un=d;break;default:Ia(r,i,c)}}function o_(r,i){if(i.memoizedState===null&&(r=i.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{ed(r)}catch(c){Vt(i,i.return,c)}}function JI(r){switch(r.tag){case 13:case 19:var i=r.stateNode;return i===null&&(i=r.stateNode=new s_),i;case 22:return r=r.stateNode,i=r._retryCache,i===null&&(i=r._retryCache=new s_),i;default:throw Error(n(435,r.tag))}}function Ip(r,i){var c=JI(r);i.forEach(function(d){var g=oC.bind(null,r,d);c.has(d)||(c.add(d),d.then(g,g))})}function Fs(r,i){var c=i.deletions;if(c!==null)for(var d=0;d<c.length;d++){var g=c[d],y=r,E=i,S=E;e:for(;S!==null;){switch(S.tag){case 27:if(yi(S.type)){Ht=S.stateNode,xs=!1;break e}break;case 5:Ht=S.stateNode,xs=!1;break e;case 3:case 4:Ht=S.stateNode.containerInfo,xs=!0;break e}S=S.return}if(Ht===null)throw Error(n(160));i_(y,E,g),Ht=null,xs=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(i.subtreeFlags&13878)for(i=i.child;i!==null;)l_(i,r),i=i.sibling}var Ar=null;function l_(r,i){var c=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Fs(i,r),Bs(r),d&4&&(ci(3,r,r.return),Ou(3,r),ci(5,r,r.return));break;case 1:Fs(i,r),Bs(r),d&512&&(un||c===null||Wr(c,c.return)),d&64&&ja&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var g=Ar;if(Fs(i,r),Bs(r),d&512&&(un||c===null||Wr(c,c.return)),d&4){var y=c!==null?c.memoizedState:null;if(d=r.memoizedState,c===null)if(d===null)if(r.stateNode===null){e:{d=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(d){case"title":y=g.getElementsByTagName("title")[0],(!y||y[Br]||y[tn]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(d),g.head.insertBefore(y,g.querySelector("head > title"))),Xn(y,d,c),y[tn]=r,Xt(y),d=y;break e;case"link":var E=nw("link","href",g).get(d+(c.href||""));if(E){for(var S=0;S<E.length;S++)if(y=E[S],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){E.splice(S,1);break t}}y=g.createElement(d),Xn(y,d,c),g.head.appendChild(y);break;case"meta":if(E=nw("meta","content",g).get(d+(c.content||""))){for(S=0;S<E.length;S++)if(y=E[S],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){E.splice(S,1);break t}}y=g.createElement(d),Xn(y,d,c),g.head.appendChild(y);break;default:throw Error(n(468,d))}y[tn]=r,Xt(y),d=y}r.stateNode=d}else sw(g,r.type,r.stateNode);else r.stateNode=tw(g,d,r.memoizedProps);else y!==d?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,d===null?sw(g,r.type,r.stateNode):tw(g,d,r.memoizedProps)):d===null&&r.stateNode!==null&&Np(r,r.memoizedProps,c.memoizedProps)}break;case 27:Fs(i,r),Bs(r),d&512&&(un||c===null||Wr(c,c.return)),c!==null&&d&4&&Np(r,r.memoizedProps,c.memoizedProps);break;case 5:if(Fs(i,r),Bs(r),d&512&&(un||c===null||Wr(c,c.return)),r.flags&32){g=r.stateNode;try{rr(g,"")}catch(ie){Vt(r,r.return,ie)}}d&4&&r.stateNode!=null&&(g=r.memoizedProps,Np(r,g,c!==null?c.memoizedProps:g)),d&1024&&(jp=!0);break;case 6:if(Fs(i,r),Bs(r),d&4){if(r.stateNode===null)throw Error(n(162));d=r.memoizedProps,c=r.stateNode;try{c.nodeValue=d}catch(ie){Vt(r,r.return,ie)}}break;case 3:if(xf=null,g=Ar,Ar=pf(i.containerInfo),Fs(i,r),Ar=g,Bs(r),d&4&&c!==null&&c.memoizedState.isDehydrated)try{ed(i.containerInfo)}catch(ie){Vt(r,r.return,ie)}jp&&(jp=!1,c_(r));break;case 4:d=Ar,Ar=pf(r.stateNode.containerInfo),Fs(i,r),Bs(r),Ar=d;break;case 12:Fs(i,r),Bs(r);break;case 13:Fs(i,r),Bs(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Mp=ct()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Ip(r,d)));break;case 22:g=r.memoizedState!==null;var q=c!==null&&c.memoizedState!==null,te=ja,de=un;if(ja=te||g,un=de||q,Fs(i,r),un=de,ja=te,Bs(r),d&8192)e:for(i=r.stateNode,i._visibility=g?i._visibility&-2:i._visibility|1,g&&(c===null||q||ja||un||Co(r)),c=null,i=r;;){if(i.tag===5||i.tag===26){if(c===null){q=c=i;try{if(y=q.stateNode,g)E=y.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{S=q.stateNode;var me=q.memoizedProps.style,re=me!=null&&me.hasOwnProperty("display")?me.display:null;S.style.display=re==null||typeof re=="boolean"?"":(""+re).trim()}}catch(ie){Vt(q,q.return,ie)}}}else if(i.tag===6){if(c===null){q=i;try{q.stateNode.nodeValue=g?"":q.memoizedProps}catch(ie){Vt(q,q.return,ie)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===r)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break e;for(;i.sibling===null;){if(i.return===null||i.return===r)break e;c===i&&(c=null),i=i.return}c===i&&(c=null),i.sibling.return=i.return,i=i.sibling}d&4&&(d=r.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,Ip(r,c))));break;case 19:Fs(i,r),Bs(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Ip(r,d)));break;case 30:break;case 21:break;default:Fs(i,r),Bs(r)}}function Bs(r){var i=r.flags;if(i&2){try{for(var c,d=r.return;d!==null;){if(t_(d)){c=d;break}d=d.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var g=c.stateNode,y=Sp(r);nf(r,y,g);break;case 5:var E=c.stateNode;c.flags&32&&(rr(E,""),c.flags&=-33);var S=Sp(r);nf(r,S,E);break;case 3:case 4:var q=c.stateNode.containerInfo,te=Sp(r);Ap(r,te,q);break;default:throw Error(n(161))}}catch(de){Vt(r,r.return,de)}r.flags&=-3}i&4096&&(r.flags&=-4097)}function c_(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var i=r;c_(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),r=r.sibling}}function ui(r,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)r_(r,i.alternate,i),i=i.sibling}function Co(r){for(r=r.child;r!==null;){var i=r;switch(i.tag){case 0:case 11:case 14:case 15:ci(4,i,i.return),Co(i);break;case 1:Wr(i,i.return);var c=i.stateNode;typeof c.componentWillUnmount=="function"&&Z0(i,i.return,c),Co(i);break;case 27:$u(i.stateNode);case 26:case 5:Wr(i,i.return),Co(i);break;case 22:i.memoizedState===null&&Co(i);break;case 30:Co(i);break;default:Co(i)}r=r.sibling}}function di(r,i,c){for(c=c&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var d=i.alternate,g=r,y=i,E=y.flags;switch(y.tag){case 0:case 11:case 15:di(g,y,c),Ou(4,y);break;case 1:if(di(g,y,c),d=y,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(te){Vt(d,d.return,te)}if(d=y,g=d.updateQueue,g!==null){var S=d.stateNode;try{var q=g.shared.hiddenCallbacks;if(q!==null)for(g.shared.hiddenCallbacks=null,g=0;g<q.length;g++)Lb(q[g],S)}catch(te){Vt(d,d.return,te)}}c&&E&64&&J0(y),Vu(y,y.return);break;case 27:n_(y);case 26:case 5:di(g,y,c),c&&d===null&&E&4&&e_(y),Vu(y,y.return);break;case 12:di(g,y,c);break;case 13:di(g,y,c),c&&E&4&&o_(g,y);break;case 22:y.memoizedState===null&&di(g,y,c),Vu(y,y.return);break;case 30:break;default:di(g,y,c)}i=i.sibling}}function Cp(r,i){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(r=i.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&wu(c))}function Rp(r,i){r=null,i.alternate!==null&&(r=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==r&&(i.refCount++,r!=null&&wu(r))}function Jr(r,i,c,d){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)u_(r,i,c,d),i=i.sibling}function u_(r,i,c,d){var g=i.flags;switch(i.tag){case 0:case 11:case 15:Jr(r,i,c,d),g&2048&&Ou(9,i);break;case 1:Jr(r,i,c,d);break;case 3:Jr(r,i,c,d),g&2048&&(r=null,i.alternate!==null&&(r=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==r&&(i.refCount++,r!=null&&wu(r)));break;case 12:if(g&2048){Jr(r,i,c,d),r=i.stateNode;try{var y=i.memoizedProps,E=y.id,S=y.onPostCommit;typeof S=="function"&&S(E,i.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(q){Vt(i,i.return,q)}}else Jr(r,i,c,d);break;case 13:Jr(r,i,c,d);break;case 23:break;case 22:y=i.stateNode,E=i.alternate,i.memoizedState!==null?y._visibility&2?Jr(r,i,c,d):Lu(r,i):y._visibility&2?Jr(r,i,c,d):(y._visibility|=2,zl(r,i,c,d,(i.subtreeFlags&10256)!==0)),g&2048&&Cp(E,i);break;case 24:Jr(r,i,c,d),g&2048&&Rp(i.alternate,i);break;default:Jr(r,i,c,d)}}function zl(r,i,c,d,g){for(g=g&&(i.subtreeFlags&10256)!==0,i=i.child;i!==null;){var y=r,E=i,S=c,q=d,te=E.flags;switch(E.tag){case 0:case 11:case 15:zl(y,E,S,q,g),Ou(8,E);break;case 23:break;case 22:var de=E.stateNode;E.memoizedState!==null?de._visibility&2?zl(y,E,S,q,g):Lu(y,E):(de._visibility|=2,zl(y,E,S,q,g)),g&&te&2048&&Cp(E.alternate,E);break;case 24:zl(y,E,S,q,g),g&&te&2048&&Rp(E.alternate,E);break;default:zl(y,E,S,q,g)}i=i.sibling}}function Lu(r,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var c=r,d=i,g=d.flags;switch(d.tag){case 22:Lu(c,d),g&2048&&Cp(d.alternate,d);break;case 24:Lu(c,d),g&2048&&Rp(d.alternate,d);break;default:Lu(c,d)}i=i.sibling}}var Uu=8192;function Hl(r){if(r.subtreeFlags&Uu)for(r=r.child;r!==null;)d_(r),r=r.sibling}function d_(r){switch(r.tag){case 26:Hl(r),r.flags&Uu&&r.memoizedState!==null&&VC(Ar,r.memoizedState,r.memoizedProps);break;case 5:Hl(r);break;case 3:case 4:var i=Ar;Ar=pf(r.stateNode.containerInfo),Hl(r),Ar=i;break;case 22:r.memoizedState===null&&(i=r.alternate,i!==null&&i.memoizedState!==null?(i=Uu,Uu=16777216,Hl(r),Uu=i):Hl(r));break;default:Hl(r)}}function h_(r){var i=r.alternate;if(i!==null&&(r=i.child,r!==null)){i.child=null;do i=r.sibling,r.sibling=null,r=i;while(r!==null)}}function Fu(r){var i=r.deletions;if((r.flags&16)!==0){if(i!==null)for(var c=0;c<i.length;c++){var d=i[c];Ln=d,m_(d,r)}h_(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)f_(r),r=r.sibling}function f_(r){switch(r.tag){case 0:case 11:case 15:Fu(r),r.flags&2048&&ci(9,r,r.return);break;case 3:Fu(r);break;case 12:Fu(r);break;case 22:var i=r.stateNode;r.memoizedState!==null&&i._visibility&2&&(r.return===null||r.return.tag!==13)?(i._visibility&=-3,sf(r)):Fu(r);break;default:Fu(r)}}function sf(r){var i=r.deletions;if((r.flags&16)!==0){if(i!==null)for(var c=0;c<i.length;c++){var d=i[c];Ln=d,m_(d,r)}h_(r)}for(r=r.child;r!==null;){switch(i=r,i.tag){case 0:case 11:case 15:ci(8,i,i.return),sf(i);break;case 22:c=i.stateNode,c._visibility&2&&(c._visibility&=-3,sf(i));break;default:sf(i)}r=r.sibling}}function m_(r,i){for(;Ln!==null;){var c=Ln;switch(c.tag){case 0:case 11:case 15:ci(8,c,i);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:wu(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,Ln=d;else e:for(c=r;Ln!==null;){d=Ln;var g=d.sibling,y=d.return;if(a_(d),d===c){Ln=null;break e}if(g!==null){g.return=y,Ln=g;break e}Ln=y}}}var ZI={getCacheForType:function(r){var i=ts(Tn),c=i.data.get(r);return c===void 0&&(c=r(),i.data.set(r,c)),c}},eC=typeof WeakMap=="function"?WeakMap:Map,Et=0,Lt=null,st=null,ht=0,Nt=0,qs=null,hi=!1,Gl=!1,kp=!1,Ca=0,rn=0,fi=0,Ro=0,Dp=0,fr=0,$l=0,Bu=null,vs=null,Pp=!1,Mp=0,rf=1/0,af=null,mi=null,Yn=0,gi=null,Kl=null,Ql=0,Op=0,Vp=null,g_=null,qu=0,Lp=null;function zs(){if((Et&2)!==0&&ht!==0)return ht&-ht;if(z.T!==null){var r=Ml;return r!==0?r:Gp()}return Tr()}function p_(){fr===0&&(fr=(ht&536870912)===0||xt?Ur():536870912);var r=hr.current;return r!==null&&(r.flags|=32),fr}function Hs(r,i,c){(r===Lt&&(Nt===2||Nt===9)||r.cancelPendingCommit!==null)&&(Yl(r,0),pi(r,ht,fr,!1)),cs(r,c),((Et&2)===0||r!==Lt)&&(r===Lt&&((Et&2)===0&&(Ro|=c),rn===4&&pi(r,ht,fr,!1)),Zr(r))}function y_(r,i,c){if((Et&6)!==0)throw Error(n(327));var d=!c&&(i&124)===0&&(i&r.expiredLanes)===0||_r(r,i),g=d?sC(r,i):Bp(r,i,!0),y=d;do{if(g===0){Gl&&!d&&pi(r,i,0,!1);break}else{if(c=r.current.alternate,y&&!tC(c)){g=Bp(r,i,!1),y=!1;continue}if(g===2){if(y=i,r.errorRecoveryDisabledLanes&y)var E=0;else E=r.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){i=E;e:{var S=r;g=Bu;var q=S.current.memoizedState.isDehydrated;if(q&&(Yl(S,E).flags|=256),E=Bp(S,E,!1),E!==2){if(kp&&!q){S.errorRecoveryDisabledLanes|=y,Ro|=y,g=4;break e}y=vs,vs=g,y!==null&&(vs===null?vs=y:vs.push.apply(vs,y))}g=E}if(y=!1,g!==2)continue}}if(g===1){Yl(r,0),pi(r,i,0,!0);break}e:{switch(d=r,y=g,y){case 0:case 1:throw Error(n(345));case 4:if((i&4194048)!==i)break;case 6:pi(d,i,fr,!hi);break e;case 2:vs=null;break;case 3:case 5:break;default:throw Error(n(329))}if((i&62914560)===i&&(g=Mp+300-ct(),10<g)){if(pi(d,i,fr,!hi),Lr(d,0,!0)!==0)break e;d.timeoutHandle=$_(x_.bind(null,d,c,vs,af,Pp,i,fr,Ro,$l,hi,y,2,-0,0),g);break e}x_(d,c,vs,af,Pp,i,fr,Ro,$l,hi,y,0,-0,0)}}break}while(!0);Zr(r)}function x_(r,i,c,d,g,y,E,S,q,te,de,me,re,ie){if(r.timeoutHandle=-1,me=i.subtreeFlags,(me&8192||(me&16785408)===16785408)&&(Yu={stylesheets:null,count:0,unsuspend:OC},d_(i),me=LC(),me!==null)){r.cancelPendingCommit=me(N_.bind(null,r,i,y,c,d,g,E,S,q,de,1,re,ie)),pi(r,y,E,!te);return}N_(r,i,y,c,d,g,E,S,q)}function tC(r){for(var i=r;;){var c=i.tag;if((c===0||c===11||c===15)&&i.flags&16384&&(c=i.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var g=c[d],y=g.getSnapshot;g=g.value;try{if(!Ls(y(),g))return!1}catch{return!1}}if(c=i.child,i.subtreeFlags&16384&&c!==null)c.return=i,i=c;else{if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function pi(r,i,c,d){i&=~Dp,i&=~Ro,r.suspendedLanes|=i,r.pingedLanes&=~i,d&&(r.warmLanes|=i),d=r.expirationTimes;for(var g=i;0<g;){var y=31-vn(g),E=1<<y;d[y]=-1,g&=~E}c!==0&&er(r,c,i)}function of(){return(Et&6)===0?(zu(0),!1):!0}function Up(){if(st!==null){if(Nt===0)var r=st.return;else r=st,wa=No=null,np(r),Bl=null,Du=0,r=st;for(;r!==null;)W0(r.alternate,r),r=r.return;st=null}}function Yl(r,i){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,vC(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),Up(),Lt=r,st=c=va(r.current,null),ht=i,Nt=0,qs=null,hi=!1,Gl=_r(r,i),kp=!1,$l=fr=Dp=Ro=fi=rn=0,vs=Bu=null,Pp=!1,(i&8)!==0&&(i|=i&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=i;0<d;){var g=31-vn(d),y=1<<g;i|=r[g],d&=~y}return Ca=i,jh(),c}function v_(r,i){Je=null,z.H=Kh,i===Eu||i===Vh?(i=Ob(),Nt=3):i===Db?(i=Ob(),Nt=4):Nt=i===V0?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,qs=i,st===null&&(rn=1,Jh(r,lr(i,r.current)))}function b_(){var r=z.H;return z.H=Kh,r===null?Kh:r}function __(){var r=z.A;return z.A=ZI,r}function Fp(){rn=4,hi||(ht&4194048)!==ht&&hr.current!==null||(Gl=!0),(fi&134217727)===0&&(Ro&134217727)===0||Lt===null||pi(Lt,ht,fr,!1)}function Bp(r,i,c){var d=Et;Et|=2;var g=b_(),y=__();(Lt!==r||ht!==i)&&(af=null,Yl(r,i)),i=!1;var E=rn;e:do try{if(Nt!==0&&st!==null){var S=st,q=qs;switch(Nt){case 8:Up(),E=6;break e;case 3:case 2:case 9:case 6:hr.current===null&&(i=!0);var te=Nt;if(Nt=0,qs=null,Xl(r,S,q,te),c&&Gl){E=0;break e}break;default:te=Nt,Nt=0,qs=null,Xl(r,S,q,te)}}nC(),E=rn;break}catch(de){v_(r,de)}while(!0);return i&&r.shellSuspendCounter++,wa=No=null,Et=d,z.H=g,z.A=y,st===null&&(Lt=null,ht=0,jh()),E}function nC(){for(;st!==null;)w_(st)}function sC(r,i){var c=Et;Et|=2;var d=b_(),g=__();Lt!==r||ht!==i?(af=null,rf=ct()+500,Yl(r,i)):Gl=_r(r,i);e:do try{if(Nt!==0&&st!==null){i=st;var y=qs;t:switch(Nt){case 1:Nt=0,qs=null,Xl(r,i,y,1);break;case 2:case 9:if(Pb(y)){Nt=0,qs=null,T_(i);break}i=function(){Nt!==2&&Nt!==9||Lt!==r||(Nt=7),Zr(r)},y.then(i,i);break e;case 3:Nt=7;break e;case 4:Nt=5;break e;case 7:Pb(y)?(Nt=0,qs=null,T_(i)):(Nt=0,qs=null,Xl(r,i,y,7));break;case 5:var E=null;switch(st.tag){case 26:E=st.memoizedState;case 5:case 27:var S=st;if(!E||rw(E)){Nt=0,qs=null;var q=S.sibling;if(q!==null)st=q;else{var te=S.return;te!==null?(st=te,lf(te)):st=null}break t}}Nt=0,qs=null,Xl(r,i,y,5);break;case 6:Nt=0,qs=null,Xl(r,i,y,6);break;case 8:Up(),rn=6;break e;default:throw Error(n(462))}}rC();break}catch(de){v_(r,de)}while(!0);return wa=No=null,z.H=d,z.A=g,Et=c,st!==null?0:(Lt=null,ht=0,jh(),rn)}function rC(){for(;st!==null&&!Qe();)w_(st)}function w_(r){var i=Y0(r.alternate,r,Ca);r.memoizedProps=r.pendingProps,i===null?lf(r):st=i}function T_(r){var i=r,c=i.alternate;switch(i.tag){case 15:case 0:i=z0(c,i,i.pendingProps,i.type,void 0,ht);break;case 11:i=z0(c,i,i.pendingProps,i.type.render,i.ref,ht);break;case 5:np(i);default:W0(c,i),i=st=Eb(i,Ca),i=Y0(c,i,Ca)}r.memoizedProps=r.pendingProps,i===null?lf(r):st=i}function Xl(r,i,c,d){wa=No=null,np(i),Bl=null,Du=0;var g=i.return;try{if(KI(r,g,i,c,ht)){rn=1,Jh(r,lr(c,r.current)),st=null;return}}catch(y){if(g!==null)throw st=g,y;rn=1,Jh(r,lr(c,r.current)),st=null;return}i.flags&32768?(xt||d===1?r=!0:Gl||(ht&536870912)!==0?r=!1:(hi=r=!0,(d===2||d===9||d===3||d===6)&&(d=hr.current,d!==null&&d.tag===13&&(d.flags|=16384))),E_(i,r)):lf(i)}function lf(r){var i=r;do{if((i.flags&32768)!==0){E_(i,hi);return}r=i.return;var c=YI(i.alternate,i,Ca);if(c!==null){st=c;return}if(i=i.sibling,i!==null){st=i;return}st=i=r}while(i!==null);rn===0&&(rn=5)}function E_(r,i){do{var c=XI(r.alternate,r);if(c!==null){c.flags&=32767,st=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!i&&(r=r.sibling,r!==null)){st=r;return}st=r=c}while(r!==null);rn=6,st=null}function N_(r,i,c,d,g,y,E,S,q){r.cancelPendingCommit=null;do cf();while(Yn!==0);if((Et&6)!==0)throw Error(n(327));if(i!==null){if(i===r.current)throw Error(n(177));if(y=i.lanes|i.childLanes,y|=Rg,ro(r,c,y,E,S,q),r===Lt&&(st=Lt=null,ht=0),Kl=i,gi=r,Ql=c,Op=y,Vp=g,g_=d,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,lC(Gn,function(){return C_(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||d){d=z.T,z.T=null,g=oe.p,oe.p=2,E=Et,Et|=4;try{WI(r,i,c)}finally{Et=E,oe.p=g,z.T=d}}Yn=1,S_(),A_(),j_()}}function S_(){if(Yn===1){Yn=0;var r=gi,i=Kl,c=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||c){c=z.T,z.T=null;var d=oe.p;oe.p=2;var g=Et;Et|=4;try{l_(i,r);var y=Zp,E=mb(r.containerInfo),S=y.focusedElem,q=y.selectionRange;if(E!==S&&S&&S.ownerDocument&&fb(S.ownerDocument.documentElement,S)){if(q!==null&&Sg(S)){var te=q.start,de=q.end;if(de===void 0&&(de=te),"selectionStart"in S)S.selectionStart=te,S.selectionEnd=Math.min(de,S.value.length);else{var me=S.ownerDocument||document,re=me&&me.defaultView||window;if(re.getSelection){var ie=re.getSelection(),He=S.textContent.length,Fe=Math.min(q.start,He),Dt=q.end===void 0?Fe:Math.min(q.end,He);!ie.extend&&Fe>Dt&&(E=Dt,Dt=Fe,Fe=E);var X=hb(S,Fe),K=hb(S,Dt);if(X&&K&&(ie.rangeCount!==1||ie.anchorNode!==X.node||ie.anchorOffset!==X.offset||ie.focusNode!==K.node||ie.focusOffset!==K.offset)){var Z=me.createRange();Z.setStart(X.node,X.offset),ie.removeAllRanges(),Fe>Dt?(ie.addRange(Z),ie.extend(K.node,K.offset)):(Z.setEnd(K.node,K.offset),ie.addRange(Z))}}}}for(me=[],ie=S;ie=ie.parentNode;)ie.nodeType===1&&me.push({element:ie,left:ie.scrollLeft,top:ie.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<me.length;S++){var fe=me[S];fe.element.scrollLeft=fe.left,fe.element.scrollTop=fe.top}}_f=!!Jp,Zp=Jp=null}finally{Et=g,oe.p=d,z.T=c}}r.current=i,Yn=2}}function A_(){if(Yn===2){Yn=0;var r=gi,i=Kl,c=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||c){c=z.T,z.T=null;var d=oe.p;oe.p=2;var g=Et;Et|=4;try{r_(r,i.alternate,i)}finally{Et=g,oe.p=d,z.T=c}}Yn=3}}function j_(){if(Yn===4||Yn===3){Yn=0,gt();var r=gi,i=Kl,c=Ql,d=g_;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?Yn=5:(Yn=0,Kl=gi=null,I_(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(mi=null),Wa(c),i=i.stateNode,pt&&typeof pt.onCommitFiberRoot=="function")try{pt.onCommitFiberRoot(wt,i,void 0,(i.current.flags&128)===128)}catch{}if(d!==null){i=z.T,g=oe.p,oe.p=2,z.T=null;try{for(var y=r.onRecoverableError,E=0;E<d.length;E++){var S=d[E];y(S.value,{componentStack:S.stack})}}finally{z.T=i,oe.p=g}}(Ql&3)!==0&&cf(),Zr(r),g=r.pendingLanes,(c&4194090)!==0&&(g&42)!==0?r===Lp?qu++:(qu=0,Lp=r):qu=0,zu(0)}}function I_(r,i){(r.pooledCacheLanes&=i)===0&&(i=r.pooledCache,i!=null&&(r.pooledCache=null,wu(i)))}function cf(r){return S_(),A_(),j_(),C_()}function C_(){if(Yn!==5)return!1;var r=gi,i=Op;Op=0;var c=Wa(Ql),d=z.T,g=oe.p;try{oe.p=32>c?32:c,z.T=null,c=Vp,Vp=null;var y=gi,E=Ql;if(Yn=0,Kl=gi=null,Ql=0,(Et&6)!==0)throw Error(n(331));var S=Et;if(Et|=4,f_(y.current),u_(y,y.current,E,c),Et=S,zu(0,!1),pt&&typeof pt.onPostCommitFiberRoot=="function")try{pt.onPostCommitFiberRoot(wt,y)}catch{}return!0}finally{oe.p=g,z.T=d,I_(r,i)}}function R_(r,i,c){i=lr(c,i),i=pp(r.stateNode,i,2),r=ai(r,i,2),r!==null&&(cs(r,2),Zr(r))}function Vt(r,i,c){if(r.tag===3)R_(r,r,c);else for(;i!==null;){if(i.tag===3){R_(i,r,c);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(mi===null||!mi.has(d))){r=lr(c,r),c=M0(2),d=ai(i,c,2),d!==null&&(O0(c,d,i,r),cs(d,2),Zr(d));break}}i=i.return}}function qp(r,i,c){var d=r.pingCache;if(d===null){d=r.pingCache=new eC;var g=new Set;d.set(i,g)}else g=d.get(i),g===void 0&&(g=new Set,d.set(i,g));g.has(c)||(kp=!0,g.add(c),r=aC.bind(null,r,i,c),i.then(r,r))}function aC(r,i,c){var d=r.pingCache;d!==null&&d.delete(i),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Lt===r&&(ht&c)===c&&(rn===4||rn===3&&(ht&62914560)===ht&&300>ct()-Mp?(Et&2)===0&&Yl(r,0):Dp|=c,$l===ht&&($l=0)),Zr(r)}function k_(r,i){i===0&&(i=Fr()),r=Rl(r,i),r!==null&&(cs(r,i),Zr(r))}function iC(r){var i=r.memoizedState,c=0;i!==null&&(c=i.retryLane),k_(r,c)}function oC(r,i){var c=0;switch(r.tag){case 13:var d=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(i),k_(r,c)}function lC(r,i){return lt(r,i)}var uf=null,Wl=null,zp=!1,df=!1,Hp=!1,ko=0;function Zr(r){r!==Wl&&r.next===null&&(Wl===null?uf=Wl=r:Wl=Wl.next=r),df=!0,zp||(zp=!0,uC())}function zu(r,i){if(!Hp&&df){Hp=!0;do for(var c=!1,d=uf;d!==null;){if(r!==0){var g=d.pendingLanes;if(g===0)var y=0;else{var E=d.suspendedLanes,S=d.pingedLanes;y=(1<<31-vn(42|r)+1)-1,y&=g&~(E&~S),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,O_(d,y))}else y=ht,y=Lr(d,d===Lt?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(y&3)===0||_r(d,y)||(c=!0,O_(d,y));d=d.next}while(c);Hp=!1}}function cC(){D_()}function D_(){df=zp=!1;var r=0;ko!==0&&(xC()&&(r=ko),ko=0);for(var i=ct(),c=null,d=uf;d!==null;){var g=d.next,y=P_(d,i);y===0?(d.next=null,c===null?uf=g:c.next=g,g===null&&(Wl=c)):(c=d,(r!==0||(y&3)!==0)&&(df=!0)),d=g}zu(r)}function P_(r,i){for(var c=r.suspendedLanes,d=r.pingedLanes,g=r.expirationTimes,y=r.pendingLanes&-62914561;0<y;){var E=31-vn(y),S=1<<E,q=g[E];q===-1?((S&c)===0||(S&d)!==0)&&(g[E]=so(S,i)):q<=i&&(r.expiredLanes|=S),y&=~S}if(i=Lt,c=ht,c=Lr(r,r===i?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,c===0||r===i&&(Nt===2||Nt===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&ze(d),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||_r(r,c)){if(i=c&-c,i===r.callbackPriority)return i;switch(d!==null&&ze(d),Wa(c)){case 2:case 8:c=an;break;case 32:c=Gn;break;case 268435456:c=ks;break;default:c=Gn}return d=M_.bind(null,r),c=lt(c,d),r.callbackPriority=i,r.callbackNode=c,i}return d!==null&&d!==null&&ze(d),r.callbackPriority=2,r.callbackNode=null,2}function M_(r,i){if(Yn!==0&&Yn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(cf()&&r.callbackNode!==c)return null;var d=ht;return d=Lr(r,r===Lt?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(y_(r,d,i),P_(r,ct()),r.callbackNode!=null&&r.callbackNode===c?M_.bind(null,r):null)}function O_(r,i){if(cf())return null;y_(r,i,!0)}function uC(){bC(function(){(Et&6)!==0?lt(Hn,cC):D_()})}function Gp(){return ko===0&&(ko=Ur()),ko}function V_(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:vl(""+r)}function L_(r,i){var c=i.ownerDocument.createElement("input");return c.name=i.name,c.value=i.value,r.id&&c.setAttribute("form",r.id),i.parentNode.insertBefore(c,i),r=new FormData(r),c.parentNode.removeChild(c),r}function dC(r,i,c,d,g){if(i==="submit"&&c&&c.stateNode===g){var y=V_((g[nn]||null).action),E=d.submitter;E&&(i=(i=E[nn]||null)?V_(i.formAction):E.getAttribute("formAction"),i!==null&&(y=i,E=null));var S=new bl("action","action",null,d,g);r.push({event:S,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(ko!==0){var q=E?L_(g,E):new FormData(g);dp(c,{pending:!0,data:q,method:g.method,action:y},null,q)}}else typeof y=="function"&&(S.preventDefault(),q=E?L_(g,E):new FormData(g),dp(c,{pending:!0,data:q,method:g.method,action:y},y,q))},currentTarget:g}]})}}for(var $p=0;$p<Cg.length;$p++){var Kp=Cg[$p],hC=Kp.toLowerCase(),fC=Kp[0].toUpperCase()+Kp.slice(1);Sr(hC,"on"+fC)}Sr(yb,"onAnimationEnd"),Sr(xb,"onAnimationIteration"),Sr(vb,"onAnimationStart"),Sr("dblclick","onDoubleClick"),Sr("focusin","onFocus"),Sr("focusout","onBlur"),Sr(CI,"onTransitionRun"),Sr(RI,"onTransitionStart"),Sr(kI,"onTransitionCancel"),Sr(bb,"onTransitionEnd"),je("onMouseEnter",["mouseout","mouseover"]),je("onMouseLeave",["mouseout","mouseover"]),je("onPointerEnter",["pointerout","pointerover"]),je("onPointerLeave",["pointerout","pointerover"]),ye("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ye("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ye("onBeforeInput",["compositionend","keypress","textInput","paste"]),ye("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ye("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ye("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Hu));function U_(r,i){i=(i&4)!==0;for(var c=0;c<r.length;c++){var d=r[c],g=d.event;d=d.listeners;e:{var y=void 0;if(i)for(var E=d.length-1;0<=E;E--){var S=d[E],q=S.instance,te=S.currentTarget;if(S=S.listener,q!==y&&g.isPropagationStopped())break e;y=S,g.currentTarget=te;try{y(g)}catch(de){Wh(de)}g.currentTarget=null,y=q}else for(E=0;E<d.length;E++){if(S=d[E],q=S.instance,te=S.currentTarget,S=S.listener,q!==y&&g.isPropagationStopped())break e;y=S,g.currentTarget=te;try{y(g)}catch(de){Wh(de)}g.currentTarget=null,y=q}}}}function rt(r,i){var c=i[tr];c===void 0&&(c=i[tr]=new Set);var d=r+"__bubble";c.has(d)||(F_(i,r,2,!1),c.add(d))}function Qp(r,i,c){var d=0;i&&(d|=4),F_(c,r,d,i)}var hf="_reactListening"+Math.random().toString(36).slice(2);function Yp(r){if(!r[hf]){r[hf]=!0,De.forEach(function(c){c!=="selectionchange"&&(mC.has(c)||Qp(c,!1,r),Qp(c,!0,r))});var i=r.nodeType===9?r:r.ownerDocument;i===null||i[hf]||(i[hf]=!0,Qp("selectionchange",!1,i))}}function F_(r,i,c,d){switch(uw(i)){case 2:var g=BC;break;case 8:g=qC;break;default:g=cy}c=g.bind(null,i,c,r),g=void 0,!ir||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(g=!0),d?g!==void 0?r.addEventListener(i,c,{capture:!0,passive:g}):r.addEventListener(i,c,!0):g!==void 0?r.addEventListener(i,c,{passive:g}):r.addEventListener(i,c,!1)}function Xp(r,i,c,d,g){var y=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var E=d.tag;if(E===3||E===4){var S=d.stateNode.containerInfo;if(S===g)break;if(E===4)for(E=d.return;E!==null;){var q=E.tag;if((q===3||q===4)&&E.stateNode.containerInfo===g)return;E=E.return}for(;S!==null;){if(E=nr(S),E===null)return;if(q=E.tag,q===5||q===6||q===26||q===27){d=y=E;continue e}S=S.parentNode}}d=d.return}fh(function(){var te=y,de=ar(c),me=[];e:{var re=_b.get(r);if(re!==void 0){var ie=bl,He=r;switch(r){case"keypress":if(Hr(c)===0)break e;case"keydown":case"keyup":ie=Sl;break;case"focusin":He="focus",ie=Tl;break;case"focusout":He="blur",ie=Tl;break;case"beforeblur":case"afterblur":ie=Tl;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=or;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=wg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=_h;break;case yb:case xb:case vb:ie=El;break;case bb:ie=Th;break;case"scroll":case"scrollend":ie=mh;break;case"wheel":ie=Al;break;case"copy":case"cut":case"paste":ie=Nl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=mu;break;case"toggle":case"beforetoggle":ie=Nh}var Fe=(i&4)!==0,Dt=!Fe&&(r==="scroll"||r==="scrollend"),X=Fe?re!==null?re+"Capture":null:re;Fe=[];for(var K=te,Z;K!==null;){var fe=K;if(Z=fe.stateNode,fe=fe.tag,fe!==5&&fe!==26&&fe!==27||Z===null||X===null||(fe=uo(K,X),fe!=null&&Fe.push(Gu(K,fe,Z))),Dt)break;K=K.return}0<Fe.length&&(re=new ie(re,He,null,c,de),me.push({event:re,listeners:Fe}))}}if((i&7)===0){e:{if(re=r==="mouseover"||r==="pointerover",ie=r==="mouseout"||r==="pointerout",re&&c!==fa&&(He=c.relatedTarget||c.fromElement)&&(nr(He)||He[Yt]))break e;if((ie||re)&&(re=de.window===de?de:(re=de.ownerDocument)?re.defaultView||re.parentWindow:window,ie?(He=c.relatedTarget||c.toElement,ie=te,He=He?nr(He):null,He!==null&&(Dt=l(He),Fe=He.tag,He!==Dt||Fe!==5&&Fe!==27&&Fe!==6)&&(He=null)):(ie=null,He=te),ie!==He)){if(Fe=or,fe="onMouseLeave",X="onMouseEnter",K="mouse",(r==="pointerout"||r==="pointerover")&&(Fe=mu,fe="onPointerLeave",X="onPointerEnter",K="pointer"),Dt=ie==null?re:Os(ie),Z=He==null?re:Os(He),re=new Fe(fe,K+"leave",ie,c,de),re.target=Dt,re.relatedTarget=Z,fe=null,nr(de)===te&&(Fe=new Fe(X,K+"enter",He,c,de),Fe.target=Z,Fe.relatedTarget=Dt,fe=Fe),Dt=fe,ie&&He)t:{for(Fe=ie,X=He,K=0,Z=Fe;Z;Z=Jl(Z))K++;for(Z=0,fe=X;fe;fe=Jl(fe))Z++;for(;0<K-Z;)Fe=Jl(Fe),K--;for(;0<Z-K;)X=Jl(X),Z--;for(;K--;){if(Fe===X||X!==null&&Fe===X.alternate)break t;Fe=Jl(Fe),X=Jl(X)}Fe=null}else Fe=null;ie!==null&&B_(me,re,ie,Fe,!1),He!==null&&Dt!==null&&B_(me,Dt,He,Fe,!0)}}e:{if(re=te?Os(te):window,ie=re.nodeName&&re.nodeName.toLowerCase(),ie==="select"||ie==="input"&&re.type==="file")var Re=ib;else if(wn(re))if(ob)Re=AI;else{Re=NI;var et=EI}else ie=re.nodeName,!ie||ie.toLowerCase()!=="input"||re.type!=="checkbox"&&re.type!=="radio"?te&&ou(te.elementType)&&(Re=ib):Re=SI;if(Re&&(Re=Re(r,te))){xa(me,Re,c,de);break e}et&&et(r,re,te),r==="focusout"&&te&&re.type==="number"&&te.memoizedProps.value!=null&&ei(re,"number",re.value)}switch(et=te?Os(te):window,r){case"focusin":(wn(et)||et.contentEditable==="true")&&(jl=et,Ag=te,yu=null);break;case"focusout":yu=Ag=jl=null;break;case"mousedown":jg=!0;break;case"contextmenu":case"mouseup":case"dragend":jg=!1,gb(me,c,de);break;case"selectionchange":if(II)break;case"keydown":case"keyup":gb(me,c,de)}var Oe;if(Kr)e:{switch(r){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else ut?le(r,c)&&(Be="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Be="onCompositionStart");Be&&(w&&c.locale!=="ko"&&(ut||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&ut&&(Oe=cu()):(zr=de,ti="value"in zr?zr.value:zr.textContent,ut=!0)),et=ff(te,Be),0<et.length&&(Be=new hu(Be,r,null,c,de),me.push({event:Be,listeners:et}),Oe?Be.data=Oe:(Oe=we(c),Oe!==null&&(Be.data=Oe)))),(Oe=v?_n(r,c):dt(r,c))&&(Be=ff(te,"onBeforeInput"),0<Be.length&&(et=new hu("onBeforeInput","beforeinput",null,c,de),me.push({event:et,listeners:Be}),et.data=Oe)),dC(me,r,te,c,de)}U_(me,i)})}function Gu(r,i,c){return{instance:r,listener:i,currentTarget:c}}function ff(r,i){for(var c=i+"Capture",d=[];r!==null;){var g=r,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=uo(r,c),g!=null&&d.unshift(Gu(r,g,y)),g=uo(r,i),g!=null&&d.push(Gu(r,g,y))),r.tag===3)return d;r=r.return}return[]}function Jl(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function B_(r,i,c,d,g){for(var y=i._reactName,E=[];c!==null&&c!==d;){var S=c,q=S.alternate,te=S.stateNode;if(S=S.tag,q!==null&&q===d)break;S!==5&&S!==26&&S!==27||te===null||(q=te,g?(te=uo(c,y),te!=null&&E.unshift(Gu(c,te,q))):g||(te=uo(c,y),te!=null&&E.push(Gu(c,te,q)))),c=c.return}E.length!==0&&r.push({event:i,listeners:E})}var gC=/\r\n?/g,pC=/\u0000|\uFFFD/g;function q_(r){return(typeof r=="string"?r:""+r).replace(gC,`
`).replace(pC,"")}function z_(r,i){return i=q_(i),q_(r)===i}function mf(){}function kt(r,i,c,d,g,y){switch(c){case"children":typeof d=="string"?i==="body"||i==="textarea"&&d===""||rr(r,d):(typeof d=="number"||typeof d=="bigint")&&i!=="body"&&rr(r,""+d);break;case"className":es(r,"class",d);break;case"tabIndex":es(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":es(r,c,d);break;case"style":iu(r,d,y);break;case"data":if(i!=="object"){es(r,"data",d);break}case"src":case"href":if(d===""&&(i!=="a"||c!=="href")){r.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=vl(""+d),r.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(i!=="input"&&kt(r,i,"name",g.name,g,null),kt(r,i,"formEncType",g.formEncType,g,null),kt(r,i,"formMethod",g.formMethod,g,null),kt(r,i,"formTarget",g.formTarget,g,null)):(kt(r,i,"encType",g.encType,g,null),kt(r,i,"method",g.method,g,null),kt(r,i,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=vl(""+d),r.setAttribute(c,d);break;case"onClick":d!=null&&(r.onclick=mf);break;case"onScroll":d!=null&&rt("scroll",r);break;case"onScrollEnd":d!=null&&rt("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}c=vl(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""+d):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":d===!0?r.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,d):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(c,d):r.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(c):r.setAttribute(c,d);break;case"popover":rt("beforetoggle",r),rt("toggle",r),Pn(r,"popover",d);break;case"xlinkActuate":ln(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":ln(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":ln(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":ln(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":ln(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":ln(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":ln(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":ln(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":ln(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Pn(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=bg.get(c)||c,Pn(r,c,d))}}function Wp(r,i,c,d,g,y){switch(c){case"style":iu(r,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"children":typeof d=="string"?rr(r,d):(typeof d=="number"||typeof d=="bigint")&&rr(r,""+d);break;case"onScroll":d!=null&&rt("scroll",r);break;case"onScrollEnd":d!=null&&rt("scrollend",r);break;case"onClick":d!=null&&(r.onclick=mf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Q.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),i=c.slice(2,g?c.length-7:void 0),y=r[nn]||null,y=y!=null?y[c]:null,typeof y=="function"&&r.removeEventListener(i,y,g),typeof d=="function")){typeof y!="function"&&y!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(i,d,g);break e}c in r?r[c]=d:d===!0?r.setAttribute(c,""):Pn(r,c,d)}}}function Xn(r,i,c){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":rt("error",r),rt("load",r);var d=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var E=c[y];if(E!=null)switch(y){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:kt(r,i,y,E,c,null)}}g&&kt(r,i,"srcSet",c.srcSet,c,null),d&&kt(r,i,"src",c.src,c,null);return;case"input":rt("invalid",r);var S=y=E=g=null,q=null,te=null;for(d in c)if(c.hasOwnProperty(d)){var de=c[d];if(de!=null)switch(d){case"name":g=de;break;case"type":E=de;break;case"checked":q=de;break;case"defaultChecked":te=de;break;case"value":y=de;break;case"defaultValue":S=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(n(137,i));break;default:kt(r,i,d,de,c,null)}}oo(r,y,S,q,te,E,g,!1),xl(r);return;case"select":rt("invalid",r),d=E=y=null;for(g in c)if(c.hasOwnProperty(g)&&(S=c[g],S!=null))switch(g){case"value":y=S;break;case"defaultValue":E=S;break;case"multiple":d=S;default:kt(r,i,g,S,c,null)}i=y,c=E,r.multiple=!!d,i!=null?ha(r,!!d,i,!1):c!=null&&ha(r,!!d,c,!0);return;case"textarea":rt("invalid",r),y=g=d=null;for(E in c)if(c.hasOwnProperty(E)&&(S=c[E],S!=null))switch(E){case"value":d=S;break;case"defaultValue":g=S;break;case"children":y=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:kt(r,i,E,S,c,null)}lo(r,d,g,y),xl(r);return;case"option":for(q in c)if(c.hasOwnProperty(q)&&(d=c[q],d!=null))switch(q){case"selected":r.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:kt(r,i,q,d,c,null)}return;case"dialog":rt("beforetoggle",r),rt("toggle",r),rt("cancel",r),rt("close",r);break;case"iframe":case"object":rt("load",r);break;case"video":case"audio":for(d=0;d<Hu.length;d++)rt(Hu[d],r);break;case"image":rt("error",r),rt("load",r);break;case"details":rt("toggle",r);break;case"embed":case"source":case"link":rt("error",r),rt("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(te in c)if(c.hasOwnProperty(te)&&(d=c[te],d!=null))switch(te){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,i));default:kt(r,i,te,d,c,null)}return;default:if(ou(i)){for(de in c)c.hasOwnProperty(de)&&(d=c[de],d!==void 0&&Wp(r,i,de,d,c,void 0));return}}for(S in c)c.hasOwnProperty(S)&&(d=c[S],d!=null&&kt(r,i,S,d,c,null))}function yC(r,i,c,d){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,E=null,S=null,q=null,te=null,de=null;for(ie in c){var me=c[ie];if(c.hasOwnProperty(ie)&&me!=null)switch(ie){case"checked":break;case"value":break;case"defaultValue":q=me;default:d.hasOwnProperty(ie)||kt(r,i,ie,null,d,me)}}for(var re in d){var ie=d[re];if(me=c[re],d.hasOwnProperty(re)&&(ie!=null||me!=null))switch(re){case"type":y=ie;break;case"name":g=ie;break;case"checked":te=ie;break;case"defaultChecked":de=ie;break;case"value":E=ie;break;case"defaultValue":S=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(n(137,i));break;default:ie!==me&&kt(r,i,re,ie,d,me)}}Vs(r,E,S,q,te,de,y,g);return;case"select":ie=E=S=re=null;for(y in c)if(q=c[y],c.hasOwnProperty(y)&&q!=null)switch(y){case"value":break;case"multiple":ie=q;default:d.hasOwnProperty(y)||kt(r,i,y,null,d,q)}for(g in d)if(y=d[g],q=c[g],d.hasOwnProperty(g)&&(y!=null||q!=null))switch(g){case"value":re=y;break;case"defaultValue":S=y;break;case"multiple":E=y;default:y!==q&&kt(r,i,g,y,d,q)}i=S,c=E,d=ie,re!=null?ha(r,!!c,re,!1):!!d!=!!c&&(i!=null?ha(r,!!c,i,!0):ha(r,!!c,c?[]:"",!1));return;case"textarea":ie=re=null;for(S in c)if(g=c[S],c.hasOwnProperty(S)&&g!=null&&!d.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:kt(r,i,S,null,d,g)}for(E in d)if(g=d[E],y=c[E],d.hasOwnProperty(E)&&(g!=null||y!=null))switch(E){case"value":re=g;break;case"defaultValue":ie=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(n(91));break;default:g!==y&&kt(r,i,E,g,d,y)}Ct(r,re,ie);return;case"option":for(var He in c)if(re=c[He],c.hasOwnProperty(He)&&re!=null&&!d.hasOwnProperty(He))switch(He){case"selected":r.selected=!1;break;default:kt(r,i,He,null,d,re)}for(q in d)if(re=d[q],ie=c[q],d.hasOwnProperty(q)&&re!==ie&&(re!=null||ie!=null))switch(q){case"selected":r.selected=re&&typeof re!="function"&&typeof re!="symbol";break;default:kt(r,i,q,re,d,ie)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Fe in c)re=c[Fe],c.hasOwnProperty(Fe)&&re!=null&&!d.hasOwnProperty(Fe)&&kt(r,i,Fe,null,d,re);for(te in d)if(re=d[te],ie=c[te],d.hasOwnProperty(te)&&re!==ie&&(re!=null||ie!=null))switch(te){case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(n(137,i));break;default:kt(r,i,te,re,d,ie)}return;default:if(ou(i)){for(var Dt in c)re=c[Dt],c.hasOwnProperty(Dt)&&re!==void 0&&!d.hasOwnProperty(Dt)&&Wp(r,i,Dt,void 0,d,re);for(de in d)re=d[de],ie=c[de],!d.hasOwnProperty(de)||re===ie||re===void 0&&ie===void 0||Wp(r,i,de,re,d,ie);return}}for(var X in c)re=c[X],c.hasOwnProperty(X)&&re!=null&&!d.hasOwnProperty(X)&&kt(r,i,X,null,d,re);for(me in d)re=d[me],ie=c[me],!d.hasOwnProperty(me)||re===ie||re==null&&ie==null||kt(r,i,me,re,d,ie)}var Jp=null,Zp=null;function gf(r){return r.nodeType===9?r:r.ownerDocument}function H_(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function G_(r,i){if(r===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&i==="foreignObject"?0:r}function ey(r,i){return r==="textarea"||r==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ty=null;function xC(){var r=window.event;return r&&r.type==="popstate"?r===ty?!1:(ty=r,!0):(ty=null,!1)}var $_=typeof setTimeout=="function"?setTimeout:void 0,vC=typeof clearTimeout=="function"?clearTimeout:void 0,K_=typeof Promise=="function"?Promise:void 0,bC=typeof queueMicrotask=="function"?queueMicrotask:typeof K_<"u"?function(r){return K_.resolve(null).then(r).catch(_C)}:$_;function _C(r){setTimeout(function(){throw r})}function yi(r){return r==="head"}function Q_(r,i){var c=i,d=0,g=0;do{var y=c.nextSibling;if(r.removeChild(c),y&&y.nodeType===8)if(c=y.data,c==="/$"){if(0<d&&8>d){c=d;var E=r.ownerDocument;if(c&1&&$u(E.documentElement),c&2&&$u(E.body),c&4)for(c=E.head,$u(c),E=c.firstChild;E;){var S=E.nextSibling,q=E.nodeName;E[Br]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=S}}if(g===0){r.removeChild(y),ed(i);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:d=c.charCodeAt(0)-48;else d=0;c=y}while(c);ed(i)}function ny(r){var i=r.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var c=i;switch(i=i.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":ny(c),kn(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function wC(r,i,c,d){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==i.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[Br])switch(i){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(y=r.getAttribute("rel"),y==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(y!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(y=r.getAttribute("src"),(y!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(i==="input"&&r.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===y)return r}else return r;if(r=jr(r.nextSibling),r===null)break}return null}function TC(r,i,c){if(i==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=jr(r.nextSibling),r===null))return null;return r}function sy(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function EC(r,i){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")i();else{var d=function(){i(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function jr(r){for(;r!=null;r=r.nextSibling){var i=r.nodeType;if(i===1||i===3)break;if(i===8){if(i=r.data,i==="$"||i==="$!"||i==="$?"||i==="F!"||i==="F")break;if(i==="/$")return null}}return r}var ry=null;function Y_(r){r=r.previousSibling;for(var i=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(i===0)return r;i--}else c==="/$"&&i++}r=r.previousSibling}return null}function X_(r,i,c){switch(i=gf(c),r){case"html":if(r=i.documentElement,!r)throw Error(n(452));return r;case"head":if(r=i.head,!r)throw Error(n(453));return r;case"body":if(r=i.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function $u(r){for(var i=r.attributes;i.length;)r.removeAttributeNode(i[0]);kn(r)}var mr=new Map,W_=new Set;function pf(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ra=oe.d;oe.d={f:NC,r:SC,D:AC,C:jC,L:IC,m:CC,X:kC,S:RC,M:DC};function NC(){var r=Ra.f(),i=of();return r||i}function SC(r){var i=Ms(r);i!==null&&i.tag===5&&i.type==="form"?y0(i):Ra.r(r)}var Zl=typeof document>"u"?null:document;function J_(r,i,c){var d=Zl;if(d&&typeof i=="string"&&i){var g=fn(i);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),W_.has(g)||(W_.add(g),r={rel:r,crossOrigin:c,href:i},d.querySelector(g)===null&&(i=d.createElement("link"),Xn(i,"link",r),Xt(i),d.head.appendChild(i)))}}function AC(r){Ra.D(r),J_("dns-prefetch",r,null)}function jC(r,i){Ra.C(r,i),J_("preconnect",r,i)}function IC(r,i,c){Ra.L(r,i,c);var d=Zl;if(d&&r&&i){var g='link[rel="preload"][as="'+fn(i)+'"]';i==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+fn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+fn(c.imageSizes)+'"]')):g+='[href="'+fn(r)+'"]';var y=g;switch(i){case"style":y=ec(r);break;case"script":y=tc(r)}mr.has(y)||(r=x({rel:"preload",href:i==="image"&&c&&c.imageSrcSet?void 0:r,as:i},c),mr.set(y,r),d.querySelector(g)!==null||i==="style"&&d.querySelector(Ku(y))||i==="script"&&d.querySelector(Qu(y))||(i=d.createElement("link"),Xn(i,"link",r),Xt(i),d.head.appendChild(i)))}}function CC(r,i){Ra.m(r,i);var c=Zl;if(c&&r){var d=i&&typeof i.as=="string"?i.as:"script",g='link[rel="modulepreload"][as="'+fn(d)+'"][href="'+fn(r)+'"]',y=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=tc(r)}if(!mr.has(y)&&(r=x({rel:"modulepreload",href:r},i),mr.set(y,r),c.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Qu(y)))return}d=c.createElement("link"),Xn(d,"link",r),Xt(d),c.head.appendChild(d)}}}function RC(r,i,c){Ra.S(r,i,c);var d=Zl;if(d&&r){var g=Dn(d).hoistableStyles,y=ec(r);i=i||"default";var E=g.get(y);if(!E){var S={loading:0,preload:null};if(E=d.querySelector(Ku(y)))S.loading=5;else{r=x({rel:"stylesheet",href:r,"data-precedence":i},c),(c=mr.get(y))&&ay(r,c);var q=E=d.createElement("link");Xt(q),Xn(q,"link",r),q._p=new Promise(function(te,de){q.onload=te,q.onerror=de}),q.addEventListener("load",function(){S.loading|=1}),q.addEventListener("error",function(){S.loading|=2}),S.loading|=4,yf(E,i,d)}E={type:"stylesheet",instance:E,count:1,state:S},g.set(y,E)}}}function kC(r,i){Ra.X(r,i);var c=Zl;if(c&&r){var d=Dn(c).hoistableScripts,g=tc(r),y=d.get(g);y||(y=c.querySelector(Qu(g)),y||(r=x({src:r,async:!0},i),(i=mr.get(g))&&iy(r,i),y=c.createElement("script"),Xt(y),Xn(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function DC(r,i){Ra.M(r,i);var c=Zl;if(c&&r){var d=Dn(c).hoistableScripts,g=tc(r),y=d.get(g);y||(y=c.querySelector(Qu(g)),y||(r=x({src:r,async:!0,type:"module"},i),(i=mr.get(g))&&iy(r,i),y=c.createElement("script"),Xt(y),Xn(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function Z_(r,i,c,d){var g=(g=Ne.current)?pf(g):null;if(!g)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(i=ec(c.href),c=Dn(g).hoistableStyles,d=c.get(i),d||(d={type:"style",instance:null,count:0,state:null},c.set(i,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=ec(c.href);var y=Dn(g).hoistableStyles,E=y.get(r);if(E||(g=g.ownerDocument||g,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(r,E),(y=g.querySelector(Ku(r)))&&!y._p&&(E.instance=y,E.state.loading=5),mr.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},mr.set(r,c),y||PC(g,r,c,E.state))),i&&d===null)throw Error(n(528,""));return E}if(i&&d!==null)throw Error(n(529,""));return null;case"script":return i=c.async,c=c.src,typeof c=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=tc(c),c=Dn(g).hoistableScripts,d=c.get(i),d||(d={type:"script",instance:null,count:0,state:null},c.set(i,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function ec(r){return'href="'+fn(r)+'"'}function Ku(r){return'link[rel="stylesheet"]['+r+"]"}function ew(r){return x({},r,{"data-precedence":r.precedence,precedence:null})}function PC(r,i,c,d){r.querySelector('link[rel="preload"][as="style"]['+i+"]")?d.loading=1:(i=r.createElement("link"),d.preload=i,i.addEventListener("load",function(){return d.loading|=1}),i.addEventListener("error",function(){return d.loading|=2}),Xn(i,"link",c),Xt(i),r.head.appendChild(i))}function tc(r){return'[src="'+fn(r)+'"]'}function Qu(r){return"script[async]"+r}function tw(r,i,c){if(i.count++,i.instance===null)switch(i.type){case"style":var d=r.querySelector('style[data-href~="'+fn(c.href)+'"]');if(d)return i.instance=d,Xt(d),d;var g=x({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),Xt(d),Xn(d,"style",g),yf(d,c.precedence,r),i.instance=d;case"stylesheet":g=ec(c.href);var y=r.querySelector(Ku(g));if(y)return i.state.loading|=4,i.instance=y,Xt(y),y;d=ew(c),(g=mr.get(g))&&ay(d,g),y=(r.ownerDocument||r).createElement("link"),Xt(y);var E=y;return E._p=new Promise(function(S,q){E.onload=S,E.onerror=q}),Xn(y,"link",d),i.state.loading|=4,yf(y,c.precedence,r),i.instance=y;case"script":return y=tc(c.src),(g=r.querySelector(Qu(y)))?(i.instance=g,Xt(g),g):(d=c,(g=mr.get(y))&&(d=x({},c),iy(d,g)),r=r.ownerDocument||r,g=r.createElement("script"),Xt(g),Xn(g,"link",d),r.head.appendChild(g),i.instance=g);case"void":return null;default:throw Error(n(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(d=i.instance,i.state.loading|=4,yf(d,c.precedence,r));return i.instance}function yf(r,i,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,y=g,E=0;E<d.length;E++){var S=d[E];if(S.dataset.precedence===i)y=S;else if(y!==g)break}y?y.parentNode.insertBefore(r,y.nextSibling):(i=c.nodeType===9?c.head:c,i.insertBefore(r,i.firstChild))}function ay(r,i){r.crossOrigin==null&&(r.crossOrigin=i.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=i.referrerPolicy),r.title==null&&(r.title=i.title)}function iy(r,i){r.crossOrigin==null&&(r.crossOrigin=i.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=i.referrerPolicy),r.integrity==null&&(r.integrity=i.integrity)}var xf=null;function nw(r,i,c){if(xf===null){var d=new Map,g=xf=new Map;g.set(c,d)}else g=xf,d=g.get(c),d||(d=new Map,g.set(c,d));if(d.has(r))return d;for(d.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var y=c[g];if(!(y[Br]||y[tn]||r==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var E=y.getAttribute(i)||"";E=r+E;var S=d.get(E);S?S.push(y):d.set(E,[y])}}return d}function sw(r,i,c){r=r.ownerDocument||r,r.head.insertBefore(c,i==="title"?r.querySelector("head > title"):null)}function MC(r,i,c){if(c===1||i.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return r=i.disabled,typeof i.precedence=="string"&&r==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function rw(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var Yu=null;function OC(){}function VC(r,i,c){if(Yu===null)throw Error(n(475));var d=Yu;if(i.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var g=ec(c.href),y=r.querySelector(Ku(g));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(d.count++,d=vf.bind(d),r.then(d,d)),i.state.loading|=4,i.instance=y,Xt(y);return}y=r.ownerDocument||r,c=ew(c),(g=mr.get(g))&&ay(c,g),y=y.createElement("link"),Xt(y);var E=y;E._p=new Promise(function(S,q){E.onload=S,E.onerror=q}),Xn(y,"link",c),i.instance=y}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(i,r),(r=i.state.preload)&&(i.state.loading&3)===0&&(d.count++,i=vf.bind(d),r.addEventListener("load",i),r.addEventListener("error",i))}}function LC(){if(Yu===null)throw Error(n(475));var r=Yu;return r.stylesheets&&r.count===0&&oy(r,r.stylesheets),0<r.count?function(i){var c=setTimeout(function(){if(r.stylesheets&&oy(r,r.stylesheets),r.unsuspend){var d=r.unsuspend;r.unsuspend=null,d()}},6e4);return r.unsuspend=i,function(){r.unsuspend=null,clearTimeout(c)}}:null}function vf(){if(this.count--,this.count===0){if(this.stylesheets)oy(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var bf=null;function oy(r,i){r.stylesheets=null,r.unsuspend!==null&&(r.count++,bf=new Map,i.forEach(UC,r),bf=null,vf.call(r))}function UC(r,i){if(!(i.state.loading&4)){var c=bf.get(r);if(c)var d=c.get(null);else{c=new Map,bf.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var E=g[y];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(c.set(E.dataset.precedence,E),d=E)}d&&c.set(null,d)}g=i.instance,E=g.getAttribute("data-precedence"),y=c.get(E)||d,y===d&&c.set(null,g),c.set(E,g),this.count++,d=vf.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),y?y.parentNode.insertBefore(g,y.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),i.state.loading|=4}}var Xu={$$typeof:B,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function FC(r,i,c,d,g,y,E,S){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=wr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wr(0),this.hiddenUpdates=wr(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function aw(r,i,c,d,g,y,E,S,q,te,de,me){return r=new FC(r,i,c,E,S,q,te,me),i=1,y===!0&&(i|=24),y=Us(3,null,null,i),r.current=y,y.stateNode=r,i=qg(),i.refCount++,r.pooledCache=i,i.refCount++,y.memoizedState={element:d,isDehydrated:c,cache:i},$g(y),r}function iw(r){return r?(r=kl,r):kl}function ow(r,i,c,d,g,y){g=iw(g),d.context===null?d.context=g:d.pendingContext=g,d=ri(i),d.payload={element:c},y=y===void 0?null:y,y!==null&&(d.callback=y),c=ai(r,d,i),c!==null&&(Hs(c,r,i),Su(c,r,i))}function lw(r,i){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<i?c:i}}function ly(r,i){lw(r,i),(r=r.alternate)&&lw(r,i)}function cw(r){if(r.tag===13){var i=Rl(r,67108864);i!==null&&Hs(i,r,67108864),ly(r,67108864)}}var _f=!0;function BC(r,i,c,d){var g=z.T;z.T=null;var y=oe.p;try{oe.p=2,cy(r,i,c,d)}finally{oe.p=y,z.T=g}}function qC(r,i,c,d){var g=z.T;z.T=null;var y=oe.p;try{oe.p=8,cy(r,i,c,d)}finally{oe.p=y,z.T=g}}function cy(r,i,c,d){if(_f){var g=uy(d);if(g===null)Xp(r,i,d,wf,c),dw(r,d);else if(HC(g,r,i,c,d))d.stopPropagation();else if(dw(r,d),i&4&&-1<zC.indexOf(r)){for(;g!==null;){var y=Ms(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var E=Rn(y.pendingLanes);if(E!==0){var S=y;for(S.pendingLanes|=2,S.entangledLanes|=2;E;){var q=1<<31-vn(E);S.entanglements[1]|=q,E&=~q}Zr(y),(Et&6)===0&&(rf=ct()+500,zu(0))}}break;case 13:S=Rl(y,2),S!==null&&Hs(S,y,2),of(),ly(y,2)}if(y=uy(d),y===null&&Xp(r,i,d,wf,c),y===g)break;g=y}g!==null&&d.stopPropagation()}else Xp(r,i,d,null,c)}}function uy(r){return r=ar(r),dy(r)}var wf=null;function dy(r){if(wf=null,r=nr(r),r!==null){var i=l(r);if(i===null)r=null;else{var c=i.tag;if(c===13){if(r=u(i),r!==null)return r;r=null}else if(c===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null)}}return wf=r,null}function uw(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(It()){case Hn:return 2;case an:return 8;case Gn:case br:return 32;case ks:return 268435456;default:return 32}default:return 32}}var hy=!1,xi=null,vi=null,bi=null,Wu=new Map,Ju=new Map,_i=[],zC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function dw(r,i){switch(r){case"focusin":case"focusout":xi=null;break;case"dragenter":case"dragleave":vi=null;break;case"mouseover":case"mouseout":bi=null;break;case"pointerover":case"pointerout":Wu.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ju.delete(i.pointerId)}}function Zu(r,i,c,d,g,y){return r===null||r.nativeEvent!==y?(r={blockedOn:i,domEventName:c,eventSystemFlags:d,nativeEvent:y,targetContainers:[g]},i!==null&&(i=Ms(i),i!==null&&cw(i)),r):(r.eventSystemFlags|=d,i=r.targetContainers,g!==null&&i.indexOf(g)===-1&&i.push(g),r)}function HC(r,i,c,d,g){switch(i){case"focusin":return xi=Zu(xi,r,i,c,d,g),!0;case"dragenter":return vi=Zu(vi,r,i,c,d,g),!0;case"mouseover":return bi=Zu(bi,r,i,c,d,g),!0;case"pointerover":var y=g.pointerId;return Wu.set(y,Zu(Wu.get(y)||null,r,i,c,d,g)),!0;case"gotpointercapture":return y=g.pointerId,Ju.set(y,Zu(Ju.get(y)||null,r,i,c,d,g)),!0}return!1}function hw(r){var i=nr(r.target);if(i!==null){var c=l(i);if(c!==null){if(i=c.tag,i===13){if(i=u(c),i!==null){r.blockedOn=i,Ja(r.priority,function(){if(c.tag===13){var d=zs();d=us(d);var g=Rl(c,d);g!==null&&Hs(g,c,d),ly(c,d)}});return}}else if(i===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Tf(r){if(r.blockedOn!==null)return!1;for(var i=r.targetContainers;0<i.length;){var c=uy(r.nativeEvent);if(c===null){c=r.nativeEvent;var d=new c.constructor(c.type,c);fa=d,c.target.dispatchEvent(d),fa=null}else return i=Ms(c),i!==null&&cw(i),r.blockedOn=c,!1;i.shift()}return!0}function fw(r,i,c){Tf(r)&&c.delete(i)}function GC(){hy=!1,xi!==null&&Tf(xi)&&(xi=null),vi!==null&&Tf(vi)&&(vi=null),bi!==null&&Tf(bi)&&(bi=null),Wu.forEach(fw),Ju.forEach(fw)}function Ef(r,i){r.blockedOn===i&&(r.blockedOn=null,hy||(hy=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,GC)))}var Nf=null;function mw(r){Nf!==r&&(Nf=r,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){Nf===r&&(Nf=null);for(var i=0;i<r.length;i+=3){var c=r[i],d=r[i+1],g=r[i+2];if(typeof d!="function"){if(dy(d||c)===null)continue;break}var y=Ms(c);y!==null&&(r.splice(i,3),i-=3,dp(y,{pending:!0,data:g,method:c.method,action:d},d,g))}}))}function ed(r){function i(q){return Ef(q,r)}xi!==null&&Ef(xi,r),vi!==null&&Ef(vi,r),bi!==null&&Ef(bi,r),Wu.forEach(i),Ju.forEach(i);for(var c=0;c<_i.length;c++){var d=_i[c];d.blockedOn===r&&(d.blockedOn=null)}for(;0<_i.length&&(c=_i[0],c.blockedOn===null);)hw(c),c.blockedOn===null&&_i.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var g=c[d],y=c[d+1],E=g[nn]||null;if(typeof y=="function")E||mw(c);else if(E){var S=null;if(y&&y.hasAttribute("formAction")){if(g=y,E=y[nn]||null)S=E.formAction;else if(dy(g)!==null)continue}else S=E.action;typeof S=="function"?c[d+1]=S:(c.splice(d,3),d-=3),mw(c)}}}function fy(r){this._internalRoot=r}Sf.prototype.render=fy.prototype.render=function(r){var i=this._internalRoot;if(i===null)throw Error(n(409));var c=i.current,d=zs();ow(c,d,r,i,null,null)},Sf.prototype.unmount=fy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var i=r.containerInfo;ow(r.current,2,null,r,null,null),of(),i[Yt]=null}};function Sf(r){this._internalRoot=r}Sf.prototype.unstable_scheduleHydration=function(r){if(r){var i=Tr();r={blockedOn:null,target:r,priority:i};for(var c=0;c<_i.length&&i!==0&&i<_i[c].priority;c++);_i.splice(c,0,r),c===0&&hw(r)}};var gw=e.version;if(gw!=="19.1.1")throw Error(n(527,gw,"19.1.1"));oe.findDOMNode=function(r){var i=r._reactInternals;if(i===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=m(i),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var $C={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Af=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Af.isDisabled&&Af.supportsFiber)try{wt=Af.inject($C),pt=Af}catch{}}return nd.createRoot=function(r,i){if(!a(r))throw Error(n(299));var c=!1,d="",g=R0,y=k0,E=D0,S=null;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(g=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(E=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(S=i.unstable_transitionCallbacks)),i=aw(r,1,!1,null,null,c,d,g,y,E,S,null),r[Yt]=i.current,Yp(r),new fy(i)},nd.hydrateRoot=function(r,i,c){if(!a(r))throw Error(n(299));var d=!1,g="",y=R0,E=k0,S=D0,q=null,te=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(E=c.onCaughtError),c.onRecoverableError!==void 0&&(S=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(q=c.unstable_transitionCallbacks),c.formState!==void 0&&(te=c.formState)),i=aw(r,1,!0,i,c??null,d,g,y,E,S,q,te),i.context=iw(null),c=i.current,d=zs(),d=us(d),g=ri(d),g.callback=null,ai(c,g,d),c=d,i.current.lanes=c,cs(i,c),Zr(i),r[Yt]=i.current,Yp(r),new Sf(i)},nd.version="19.1.1",nd}var Nw;function n1(){if(Nw)return py.exports;Nw=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),py.exports=t1(),py.exports}var s1=n1();const r1=()=>{};var Sw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let a=s.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},a1=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const a=s[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const l=s[t++];e[n++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=s[t++],u=s[t++],h=s[t++],m=((a&7)<<18|(l&63)<<12|(u&63)<<6|h&63)-65536;e[n++]=String.fromCharCode(55296+(m>>10)),e[n++]=String.fromCharCode(56320+(m&1023))}else{const l=s[t++],u=s[t++];e[n++]=String.fromCharCode((a&15)<<12|(l&63)<<6|u&63)}}return e.join("")},JE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<s.length;a+=3){const l=s[a],u=a+1<s.length,h=u?s[a+1]:0,m=a+2<s.length,p=m?s[a+2]:0,x=l>>2,_=(l&3)<<4|h>>4;let b=(h&15)<<2|p>>6,N=p&63;m||(N=64,u||(b=64)),n.push(t[x],t[_],t[b],t[N])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(WE(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):a1(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<s.length;){const l=t[s.charAt(a++)],h=a<s.length?t[s.charAt(a)]:0;++a;const p=a<s.length?t[s.charAt(a)]:64;++a;const _=a<s.length?t[s.charAt(a)]:64;if(++a,l==null||h==null||p==null||_==null)throw new i1;const b=l<<2|h>>4;if(n.push(b),p!==64){const N=h<<4&240|p>>2;if(n.push(N),_!==64){const C=p<<6&192|_;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class i1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o1=function(s){const e=WE(s);return JE.encodeByteArray(e,!0)},am=function(s){return o1(s).replace(/\./g,"")},ZE=function(s){try{return JE.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1=()=>eN().__FIREBASE_DEFAULTS__,c1=()=>{if(typeof process>"u"||typeof Sw>"u")return;const s=Sw.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},u1=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&ZE(s[1]);return e&&JSON.parse(e)},Mm=()=>{try{return r1()||l1()||c1()||u1()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},tN=s=>Mm()?.emulatorHosts?.[s],nN=s=>{const e=tN(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},sN=()=>Mm()?.config,rN=s=>Mm()?.[`_${s}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Om(s){return(await fetch(s,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h1(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=s.iat||0,l=s.sub||s.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...s};return[am(JSON.stringify(t)),am(JSON.stringify(u)),""].join(".")}const xd={};function f1(){const s={prod:[],emulator:[]};for(const e of Object.keys(xd))xd[e]?s.emulator.push(e):s.prod.push(e);return s}function m1(s){let e=document.getElementById(s),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",s),t=!0),{created:t,element:e}}let Aw=!1;function Px(s,e){if(typeof window>"u"||typeof document>"u"||!Ga(window.location.host)||xd[s]===e||xd[s]||Aw)return;xd[s]=e;function t(b){return`__firebase__banner__${b}`}const n="__firebase__banner",l=f1().prod.length>0;function u(){const b=document.getElementById(n);b&&b.remove()}function h(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function m(b,N){b.setAttribute("width","24"),b.setAttribute("id",N),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function p(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{Aw=!0,u()},b}function x(b,N){b.setAttribute("id",N),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function _(){const b=m1(n),N=t("text"),C=document.getElementById(N)||document.createElement("span"),k=t("learnmore"),L=document.getElementById(k)||document.createElement("a"),F=t("preprendIcon"),U=document.getElementById(F)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const B=b.element;h(B),x(L,k);const H=p();m(U,F),B.append(U,C,L,H),document.body.appendChild(B)}l?(C.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",N)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function An(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function g1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(An())}function aN(){const s=Mm()?.forceEnvironment;if(s==="node")return!0;if(s==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function p1(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function iN(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function y1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function x1(){const s=An();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function oN(){return!aN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lN(){return!aN()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Mx(){try{return typeof indexedDB=="object"}catch{return!1}}function cN(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(t){e(t)}})}function v1(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b1="FirebaseError";class vr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=b1,Object.setPrototypeOf(this,vr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ol.prototype.create)}}class ol{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,l=this.errors[e],u=l?_1(l,n):"Error",h=`${this.serviceName}: ${u} (${a}).`;return new vr(a,h,n)}}function _1(s,e){return s.replace(w1,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const w1=/\{\$([^}]+)}/g;function T1(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function pr(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const l=s[a],u=e[a];if(jw(l)&&jw(u)){if(!pr(l,u))return!1}else if(l!==u)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function jw(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $d(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function E1(s,e){const t=new N1(s,e);return t.subscribe.bind(t)}class N1{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");S1(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=by),a.error===void 0&&(a.error=by),a.complete===void 0&&(a.complete=by);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function S1(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function by(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A1=1e3,j1=2,I1=14400*1e3,C1=.5;function Iw(s,e=A1,t=j1){const n=e*Math.pow(t,s),a=Math.round(C1*n*(Math.random()-.5)*2);return Math.min(I1,n+a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(s){return s&&s._delegate?s._delegate:s}class yr{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new d1;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(a){if(n)return null;throw a}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(D1(e))try{this.getOrInitializeService({instanceIdentifier:Po})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:a});n.resolve(l)}catch{}}}}clearInstance(e=Po){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Po){return this.instances.has(e)}getOptions(e=Po){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[l,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(l);n===h&&u.resolve(a)}return a}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),a=this.onInitCallbacks.get(n)??new Set;a.add(e),this.onInitCallbacks.set(n,a);const l=this.instances.get(n);return l&&e(l,n),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:k1(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Po){return this.component?this.component.multipleInstances?e:Po:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function k1(s){return s===Po?void 0:s}function D1(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new R1(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var it;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(it||(it={}));const M1={debug:it.DEBUG,verbose:it.VERBOSE,info:it.INFO,warn:it.WARN,error:it.ERROR,silent:it.SILENT},O1=it.INFO,V1={[it.DEBUG]:"log",[it.VERBOSE]:"log",[it.INFO]:"info",[it.WARN]:"warn",[it.ERROR]:"error"},L1=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),a=V1[e];if(a)console[a](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Vm{constructor(e){this.name=e,this._logLevel=O1,this._logHandler=L1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in it))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?M1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,it.DEBUG,...e),this._logHandler(this,it.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,it.VERBOSE,...e),this._logHandler(this,it.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,it.INFO,...e),this._logHandler(this,it.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,it.WARN,...e),this._logHandler(this,it.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,it.ERROR,...e),this._logHandler(this,it.ERROR,...e)}}const U1=(s,e)=>e.some(t=>s instanceof t);let Cw,Rw;function F1(){return Cw||(Cw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function B1(){return Rw||(Rw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const uN=new WeakMap,$y=new WeakMap,dN=new WeakMap,_y=new WeakMap,Ox=new WeakMap;function q1(s){const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("success",l),s.removeEventListener("error",u)},l=()=>{t(Oi(s.result)),a()},u=()=>{n(s.error),a()};s.addEventListener("success",l),s.addEventListener("error",u)});return e.then(t=>{t instanceof IDBCursor&&uN.set(t,s)}).catch(()=>{}),Ox.set(e,s),e}function z1(s){if($y.has(s))return;const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",u),s.removeEventListener("abort",u)},l=()=>{t(),a()},u=()=>{n(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",l),s.addEventListener("error",u),s.addEventListener("abort",u)});$y.set(s,e)}let Ky={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return $y.get(s);if(e==="objectStoreNames")return s.objectStoreNames||dN.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Oi(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function H1(s){Ky=s(Ky)}function G1(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(wy(this),e,...t);return dN.set(n,e.sort?e.sort():[e]),Oi(n)}:B1().includes(s)?function(...e){return s.apply(wy(this),e),Oi(uN.get(this))}:function(...e){return Oi(s.apply(wy(this),e))}}function $1(s){return typeof s=="function"?G1(s):(s instanceof IDBTransaction&&z1(s),U1(s,F1())?new Proxy(s,Ky):s)}function Oi(s){if(s instanceof IDBRequest)return q1(s);if(_y.has(s))return _y.get(s);const e=$1(s);return e!==s&&(_y.set(s,e),Ox.set(e,s)),e}const wy=s=>Ox.get(s);function hN(s,e,{blocked:t,upgrade:n,blocking:a,terminated:l}={}){const u=indexedDB.open(s,e),h=Oi(u);return n&&u.addEventListener("upgradeneeded",m=>{n(Oi(u.result),m.oldVersion,m.newVersion,Oi(u.transaction),m)}),t&&u.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),h.then(m=>{l&&m.addEventListener("close",()=>l()),a&&m.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),h}const K1=["get","getKey","getAll","getAllKeys","count"],Q1=["put","add","delete","clear"],Ty=new Map;function kw(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Ty.get(e))return Ty.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=Q1.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||K1.includes(t)))return;const l=async function(u,...h){const m=this.transaction(u,a?"readwrite":"readonly");let p=m.store;return n&&(p=p.index(h.shift())),(await Promise.all([p[t](...h),a&&m.done]))[0]};return Ty.set(e,l),l}H1(s=>({...s,get:(e,t,n)=>kw(e,t)||s.get(e,t,n),has:(e,t)=>!!kw(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(X1(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function X1(s){return s.getComponent()?.type==="VERSION"}const Qy="@firebase/app",Dw="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ba=new Vm("@firebase/app"),W1="@firebase/app-compat",J1="@firebase/analytics-compat",Z1="@firebase/analytics",eR="@firebase/app-check-compat",tR="@firebase/app-check",nR="@firebase/auth",sR="@firebase/auth-compat",rR="@firebase/database",aR="@firebase/data-connect",iR="@firebase/database-compat",oR="@firebase/functions",lR="@firebase/functions-compat",cR="@firebase/installations",uR="@firebase/installations-compat",dR="@firebase/messaging",hR="@firebase/messaging-compat",fR="@firebase/performance",mR="@firebase/performance-compat",gR="@firebase/remote-config",pR="@firebase/remote-config-compat",yR="@firebase/storage",xR="@firebase/storage-compat",vR="@firebase/firestore",bR="@firebase/ai",_R="@firebase/firestore-compat",wR="firebase",TR="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const im="[DEFAULT]",ER={[Qy]:"fire-core",[W1]:"fire-core-compat",[Z1]:"fire-analytics",[J1]:"fire-analytics-compat",[tR]:"fire-app-check",[eR]:"fire-app-check-compat",[nR]:"fire-auth",[sR]:"fire-auth-compat",[rR]:"fire-rtdb",[aR]:"fire-data-connect",[iR]:"fire-rtdb-compat",[oR]:"fire-fn",[lR]:"fire-fn-compat",[cR]:"fire-iid",[uR]:"fire-iid-compat",[dR]:"fire-fcm",[hR]:"fire-fcm-compat",[fR]:"fire-perf",[mR]:"fire-perf-compat",[gR]:"fire-rc",[pR]:"fire-rc-compat",[yR]:"fire-gcs",[xR]:"fire-gcs-compat",[vR]:"fire-fst",[_R]:"fire-fst-compat",[bR]:"fire-vertex","fire-js":"fire-js",[wR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const om=new Map,NR=new Map,Yy=new Map;function Pw(s,e){try{s.container.addComponent(e)}catch(t){Ba.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Vr(s){const e=s.name;if(Yy.has(e))return Ba.debug(`There were multiple attempts to register component ${e}.`),!1;Yy.set(e,s);for(const t of om.values())Pw(t,s);for(const t of NR.values())Pw(t,s);return!0}function da(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function SR(s,e,t=im){da(s,e).clearInstance(t)}function Ks(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Vi=new ol("app","Firebase",AR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new yr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Vi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc=TR;function fN(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n={name:im,automaticDataCollectionEnabled:!0,...e},a=n.name;if(typeof a!="string"||!a)throw Vi.create("bad-app-name",{appName:String(a)});if(t||(t=sN()),!t)throw Vi.create("no-options");const l=om.get(a);if(l){if(pr(t,l.options)&&pr(n,l.config))return l;throw Vi.create("duplicate-app",{appName:a})}const u=new P1(a);for(const m of Yy.values())u.addComponent(m);const h=new jR(t,n,u);return om.set(a,h),h}function Lm(s=im){const e=om.get(s);if(!e&&s===im&&sN())return fN();if(!e)throw Vi.create("no-app",{appName:s});return e}function As(s,e,t){let n=ER[s]??s;t&&(n+=`-${t}`);const a=n.match(/\s|\//),l=e.match(/\s|\//);if(a||l){const u=[`Unable to register library "${n}" with version "${e}":`];a&&u.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&l&&u.push("and"),l&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ba.warn(u.join(" "));return}Vr(new yr(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IR="firebase-heartbeat-database",CR=1,Rd="firebase-heartbeat-store";let Ey=null;function mN(){return Ey||(Ey=hN(IR,CR,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(Rd)}catch(t){console.warn(t)}}}}).catch(s=>{throw Vi.create("idb-open",{originalErrorMessage:s.message})})),Ey}async function RR(s){try{const t=(await mN()).transaction(Rd),n=await t.objectStore(Rd).get(gN(s));return await t.done,n}catch(e){if(e instanceof vr)Ba.warn(e.message);else{const t=Vi.create("idb-get",{originalErrorMessage:e?.message});Ba.warn(t.message)}}}async function Mw(s,e){try{const n=(await mN()).transaction(Rd,"readwrite");await n.objectStore(Rd).put(e,gN(s)),await n.done}catch(t){if(t instanceof vr)Ba.warn(t.message);else{const n=Vi.create("idb-set",{originalErrorMessage:t?.message});Ba.warn(n.message)}}}function gN(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kR=1024,DR=30;class PR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new OR(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Ow();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>DR){const a=VR(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ba.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ow(),{heartbeatsToSend:t,unsentEntries:n}=MR(this._heartbeatsCache.heartbeats),a=am(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return Ba.warn(e),""}}}function Ow(){return new Date().toISOString().substring(0,10)}function MR(s,e=kR){const t=[];let n=s.slice();for(const a of s){const l=t.find(u=>u.agent===a.agent);if(l){if(l.dates.push(a.date),Vw(t)>e){l.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Vw(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class OR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Mx()?cN().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await RR(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Mw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Mw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Vw(s){return am(JSON.stringify({version:2,heartbeats:s})).length}function VR(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LR(s){Vr(new yr("platform-logger",e=>new Y1(e),"PRIVATE")),Vr(new yr("heartbeat",e=>new PR(e),"PRIVATE")),As(Qy,Dw,s),As(Qy,Dw,"esm2020"),As("fire-js","")}LR("");function pN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const UR=pN,yN=new ol("auth","Firebase",pN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm=new Vm("@firebase/auth");function FR(s,...e){lm.logLevel<=it.WARN&&lm.warn(`Auth (${zc}): ${s}`,...e)}function Bf(s,...e){lm.logLevel<=it.ERROR&&lm.error(`Auth (${zc}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ca(s,...e){throw Lx(s,...e)}function Pr(s,...e){return Lx(s,...e)}function Vx(s,e,t){const n={...UR(),[e]:t};return new ol("auth","Firebase",n).create(e,{appName:s.name})}function Li(s){return Vx(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xN(s,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&ca(s,"argument-error"),Vx(s,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Lx(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return yN.create(s,...e)}function $e(s,e,...t){if(!s)throw Lx(e,...t)}function Ma(s){const e="INTERNAL ASSERTION FAILED: "+s;throw Bf(e),new Error(e)}function qa(s,e){s||Ma(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xy(){return typeof self<"u"&&self.location?.href||""}function BR(){return Lw()==="http:"||Lw()==="https:"}function Lw(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BR()||iN()||"connection"in navigator)?navigator.onLine:!0}function zR(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t){this.shortDelay=e,this.longDelay=t,qa(t>e,"Short delay should be less than long delay!"),this.isMobile=g1()||y1()}get(){return qR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ux(s,e){qa(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ma("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ma("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ma("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GR=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],$R=new Kd(3e4,6e4);function Fx(s,e){return s.tenantId&&!e.tenantId?{...e,tenantId:s.tenantId}:e}async function Hc(s,e,t,n,a={}){return bN(s,a,async()=>{let l={},u={};n&&(e==="GET"?u=n:l={body:JSON.stringify(n)});const h=$d({key:s.config.apiKey,...u}).slice(1),m=await s._getAdditionalHeaders();m["Content-Type"]="application/json",s.languageCode&&(m["X-Firebase-Locale"]=s.languageCode);const p={method:e,headers:m,...l};return p1()||(p.referrerPolicy="no-referrer"),s.emulatorConfig&&Ga(s.emulatorConfig.host)&&(p.credentials="include"),vN.fetch()(await _N(s,s.config.apiHost,t,h),p)})}async function bN(s,e,t){s._canInitEmulator=!1;const n={...HR,...e};try{const a=new QR(s),l=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw jf(s,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const h=l.ok?u.errorMessage:u.error.message,[m,p]=h.split(" : ");if(m==="FEDERATED_USER_ID_ALREADY_LINKED")throw jf(s,"credential-already-in-use",u);if(m==="EMAIL_EXISTS")throw jf(s,"email-already-in-use",u);if(m==="USER_DISABLED")throw jf(s,"user-disabled",u);const x=n[m]||m.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw Vx(s,x,p);ca(s,x)}}catch(a){if(a instanceof vr)throw a;ca(s,"network-request-failed",{message:String(a)})}}async function KR(s,e,t,n,a={}){const l=await Hc(s,e,t,n,a);return"mfaPendingCredential"in l&&ca(s,"multi-factor-auth-required",{_serverResponse:l}),l}async function _N(s,e,t,n){const a=`${e}${t}?${n}`,l=s,u=l.config.emulator?Ux(s.config,a):`${s.config.apiScheme}://${a}`;return GR.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}class QR{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Pr(this.auth,"network-request-failed")),$R.get())})}}function jf(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=Pr(s,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YR(s,e){return Hc(s,"POST","/v1/accounts:delete",e)}async function cm(s,e){return Hc(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function XR(s,e=!1){const t=mt(s),n=await t.getIdToken(e),a=Bx(n);$e(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,u=l?.sign_in_provider;return{claims:a,token:n,authTime:vd(Ny(a.auth_time)),issuedAtTime:vd(Ny(a.iat)),expirationTime:vd(Ny(a.exp)),signInProvider:u||null,signInSecondFactor:l?.sign_in_second_factor||null}}function Ny(s){return Number(s)*1e3}function Bx(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return Bf("JWT malformed, contained fewer than 3 sections"),null;try{const a=ZE(t);return a?JSON.parse(a):(Bf("Failed to decode base64 JWT payload"),null)}catch(a){return Bf("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Uw(s){const e=Bx(s);return $e(e,"internal-error"),$e(typeof e.exp<"u","internal-error"),$e(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kd(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof vr&&WR(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function WR({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=vd(this.lastLoginAt),this.creationTime=vd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function um(s){const e=s.auth,t=await s.getIdToken(),n=await kd(s,cm(e,{idToken:t}));$e(n?.users.length,e,"internal-error");const a=n.users[0];s._notifyReloadListener(a);const l=a.providerUserInfo?.length?wN(a.providerUserInfo):[],u=e2(s.providerData,l),h=s.isAnonymous,m=!(s.email&&a.passwordHash)&&!u?.length,p=h?m:!1,x={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new Wy(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(s,x)}async function ZR(s){const e=mt(s);await um(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function e2(s,e){return[...s.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function wN(s){return s.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t2(s,e){const t=await bN(s,{},async()=>{const n=$d({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=s.config,u=await _N(s,a,"/v1/token",`key=${l}`),h=await s._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const m={method:"POST",headers:h,body:n};return s.emulatorConfig&&Ga(s.emulatorConfig.host)&&(m.credentials="include"),vN.fetch()(u,m)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function n2(s,e){return Hc(s,"POST","/v2/accounts:revokeToken",Fx(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$e(e.idToken,"internal-error"),$e(typeof e.idToken<"u","internal-error"),$e(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Uw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$e(e.length!==0,"internal-error");const t=Uw(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:($e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:l}=await t2(e,t);this.updateTokensAndExpiration(n,a,Number(l))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:l}=t,u=new mc;return n&&($e(typeof n=="string","internal-error",{appName:e}),u.refreshToken=n),a&&($e(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),l&&($e(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new mc,this.toJSON())}_performRefresh(){return Ma("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ti(s,e){$e(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class kr{constructor({uid:e,auth:t,stsTokenManager:n,...a}){this.providerId="firebase",this.proactiveRefresh=new JR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Wy(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await kd(this,this.stsTokenManager.getToken(this.auth,e));return $e(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return XR(this,e)}reload(){return ZR(this)}_assign(e){this!==e&&($e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new kr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){$e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await um(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ks(this.auth.app))return Promise.reject(Li(this.auth));const e=await this.getIdToken();return await kd(this,YR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,a=t.email??void 0,l=t.phoneNumber??void 0,u=t.photoURL??void 0,h=t.tenantId??void 0,m=t._redirectEventId??void 0,p=t.createdAt??void 0,x=t.lastLoginAt??void 0,{uid:_,emailVerified:b,isAnonymous:N,providerData:C,stsTokenManager:k}=t;$e(_&&k,e,"internal-error");const L=mc.fromJSON(this.name,k);$e(typeof _=="string",e,"internal-error"),Ti(n,e.name),Ti(a,e.name),$e(typeof b=="boolean",e,"internal-error"),$e(typeof N=="boolean",e,"internal-error"),Ti(l,e.name),Ti(u,e.name),Ti(h,e.name),Ti(m,e.name),Ti(p,e.name),Ti(x,e.name);const F=new kr({uid:_,auth:e,email:a,emailVerified:b,displayName:n,isAnonymous:N,photoURL:u,phoneNumber:l,tenantId:h,stsTokenManager:L,createdAt:p,lastLoginAt:x});return C&&Array.isArray(C)&&(F.providerData=C.map(U=>({...U}))),m&&(F._redirectEventId=m),F}static async _fromIdTokenResponse(e,t,n=!1){const a=new mc;a.updateFromServerResponse(t);const l=new kr({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await um(l),l}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];$e(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?wN(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!l?.length,h=new mc;h.updateFromIdToken(n);const m=new kr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:u}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new Wy(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(m,p),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw=new Map;function Oa(s){qa(s instanceof Function,"Expected a class definition");let e=Fw.get(s);return e?(qa(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,Fw.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}TN.type="NONE";const Bw=TN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(s,e,t){return`firebase:${s}:${e}:${t}`}class gc{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:l}=this.auth;this.fullUserKey=qf(this.userKey,a.apiKey,l),this.fullPersistenceKey=qf("persistence",a.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await cm(this.auth,{idToken:e}).catch(()=>{});return t?kr._fromGetAccountInfoResponse(this.auth,t,e):null}return kr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new gc(Oa(Bw),e,n);const a=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||Oa(Bw);const u=qf(n,e.config.apiKey,e.name);let h=null;for(const p of t)try{const x=await p._get(u);if(x){let _;if(typeof x=="string"){const b=await cm(e,{idToken:x}).catch(()=>{});if(!b)break;_=await kr._fromGetAccountInfoResponse(e,b,x)}else _=kr._fromJSON(e,x);p!==l&&(h=_),l=p;break}}catch{}const m=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!m.length?new gc(l,e,n):(l=m[0],h&&await l._set(u,h.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(u)}catch{}})),new gc(l,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(AN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(EN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(IN(e))return"Blackberry";if(CN(e))return"Webos";if(NN(e))return"Safari";if((e.includes("chrome/")||SN(e))&&!e.includes("edge/"))return"Chrome";if(jN(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if(n?.length===2)return n[1]}return"Other"}function EN(s=An()){return/firefox\//i.test(s)}function NN(s=An()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function SN(s=An()){return/crios\//i.test(s)}function AN(s=An()){return/iemobile/i.test(s)}function jN(s=An()){return/android/i.test(s)}function IN(s=An()){return/blackberry/i.test(s)}function CN(s=An()){return/webos/i.test(s)}function qx(s=An()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function s2(s=An()){return qx(s)&&!!window.navigator?.standalone}function r2(){return x1()&&document.documentMode===10}function RN(s=An()){return qx(s)||jN(s)||CN(s)||IN(s)||/windows phone/i.test(s)||AN(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kN(s,e=[]){let t;switch(s){case"Browser":t=qw(An());break;case"Worker":t=`${qw(An())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${zc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a2{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=l=>new Promise((u,h)=>{try{const m=e(l);u(m)}catch(m){h(m)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i2(s,e={}){return Hc(s,"GET","/v2/passwordPolicy",Fx(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=6;class l2{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??o2,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zw(this),this.idTokenSubscription=new zw(this),this.beforeStateQueue=new a2(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Oa(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await gc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cm(this,{idToken:e}),n=await kr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ks(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,u=n?._redirectEventId,h=await this.tryRedirectSignIn(e);(!l||l===u)&&h?.user&&(n=h.user,a=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(n)}catch(l){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return $e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await um(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=zR()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ks(this.app))return Promise.reject(Li(this));const t=e?mt(e):null;return t&&$e(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&$e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ks(this.app)?Promise.reject(Li(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ks(this.app)?Promise.reject(Li(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Oa(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await i2(this),t=new l2(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ol("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await n2(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Oa(e)||this._popupRedirectResolver;$e(t,this,"argument-error"),this.redirectPersistenceManager=await gc.create(this,[Oa(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if($e(h,this,"internal-error"),h.then(()=>{u||l(this.currentUser)}),typeof t=="function"){const m=e.addObserver(t,n,a);return()=>{u=!0,m()}}else{const m=e.addObserver(t);return()=>{u=!0,m()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=kN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Ks(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&FR(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Qd(s){return mt(s)}class zw{constructor(e){this.auth=e,this.observer=null,this.addObserver=E1(t=>this.observer=t)}get next(){return $e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function u2(s){zx=s}function d2(s){return zx.loadJS(s)}function h2(){return zx.gapiScript}function f2(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m2(s,e){const t=da(s,"auth");if(t.isInitialized()){const a=t.getImmediate(),l=t.getOptions();if(pr(l,e??{}))return a;ca(a,"already-initialized")}return t.initialize({options:e})}function g2(s,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(Oa);e?.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e?.popupRedirectResolver)}function p2(s,e,t){const n=Qd(s);$e(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,l=DN(e),{host:u,port:h}=y2(e),m=h===null?"":`:${h}`,p={url:`${l}//${u}${m}/`},x=Object.freeze({host:u,port:h,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!n._canInitEmulator){$e(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),$e(pr(p,n.config.emulator)&&pr(x,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=p,n.emulatorConfig=x,n.settings.appVerificationDisabledForTesting=!0,Ga(u)?(Om(`${l}//${u}${m}`),Px("Auth",!0)):x2()}function DN(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function y2(s){const e=DN(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const l=a[1];return{host:l,port:Hw(n.substr(l.length+1))}}else{const[l,u]=n.split(":");return{host:l,port:Hw(u)}}}function Hw(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function x2(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ma("not implemented")}_getIdTokenResponse(e){return Ma("not implemented")}_linkToIdToken(e,t){return Ma("not implemented")}_getReauthenticationResolver(e){return Ma("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pc(s,e){return KR(s,"POST","/v1/accounts:signInWithIdp",Fx(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v2="http://localhost";class Yo extends PN{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Yo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ca("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a,...l}=t;if(!n||!a)return null;const u=new Yo(n,a);return u.idToken=l.idToken||void 0,u.accessToken=l.accessToken||void 0,u.secret=l.secret,u.nonce=l.nonce,u.pendingToken=l.pendingToken||null,u}_getIdTokenResponse(e){const t=this.buildRequest();return pc(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,pc(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,pc(e,t)}buildRequest(){const e={requestUri:v2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=$d(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd extends Um{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai extends Yd{constructor(){super("facebook.com")}static credential(e){return Yo._fromParams({providerId:Ai.PROVIDER_ID,signInMethod:Ai.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ai.credentialFromTaggedObject(e)}static credentialFromError(e){return Ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ai.credential(e.oauthAccessToken)}catch{return null}}}Ai.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ai.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa extends Yd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Yo._fromParams({providerId:Pa.PROVIDER_ID,signInMethod:Pa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pa.credentialFromTaggedObject(e)}static credentialFromError(e){return Pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Pa.credential(t,n)}catch{return null}}}Pa.GOOGLE_SIGN_IN_METHOD="google.com";Pa.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji extends Yd{constructor(){super("github.com")}static credential(e){return Yo._fromParams({providerId:ji.PROVIDER_ID,signInMethod:ji.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ji.credentialFromTaggedObject(e)}static credentialFromError(e){return ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ji.credential(e.oauthAccessToken)}catch{return null}}}ji.GITHUB_SIGN_IN_METHOD="github.com";ji.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii extends Yd{constructor(){super("twitter.com")}static credential(e,t){return Yo._fromParams({providerId:Ii.PROVIDER_ID,signInMethod:Ii.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ii.credentialFromTaggedObject(e)}static credentialFromError(e){return Ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ii.credential(t,n)}catch{return null}}}Ii.TWITTER_SIGN_IN_METHOD="twitter.com";Ii.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const l=await kr._fromIdTokenResponse(e,n,a),u=Gw(n);return new vc({user:l,providerId:u,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=Gw(n);return new vc({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function Gw(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dm extends vr{constructor(e,t,n,a){super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,dm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new dm(e,t,n,a)}}function MN(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?dm._fromErrorAndOperation(s,l,e,n):l})}async function b2(s,e,t=!1){const n=await kd(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return vc._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _2(s,e,t=!1){const{auth:n}=s;if(Ks(n.app))return Promise.reject(Li(n));const a="reauthenticate";try{const l=await kd(s,MN(n,a,e,s),t);$e(l.idToken,n,"internal-error");const u=Bx(l.idToken);$e(u,n,"internal-error");const{sub:h}=u;return $e(s.uid===h,n,"user-mismatch"),vc._forOperation(s,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&ca(n,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w2(s,e,t=!1){if(Ks(s.app))return Promise.reject(Li(s));const n="signIn",a=await MN(s,n,e),l=await vc._fromIdTokenResponse(s,n,a);return t||await s._updateCurrentUser(l.user),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T2(s,e){return mt(s).setPersistence(e)}function ON(s,e,t,n){return mt(s).onIdTokenChanged(e,t,n)}function E2(s,e,t){return mt(s).beforeAuthStateChanged(e,t)}function N2(s,e,t,n){return mt(s).onAuthStateChanged(e,t,n)}function S2(s){return mt(s).signOut()}const hm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(hm,"1"),this.storage.removeItem(hm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2=1e3,j2=10;class LN extends VN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=RN(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((u,h,m)=>{this.notifyListeners(u,m)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const u=this.storage.getItem(n);!t&&this.localCache[n]===u||this.notifyListeners(n,u)},l=this.storage.getItem(n);r2()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,j2):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},A2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}LN.type="LOCAL";const UN=LN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN extends VN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}FN.type="SESSION";const BN=FN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I2(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new Fm(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:l}=t.data,u=this.handlersMap[a];if(!u?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const h=Array.from(u).map(async p=>p(t.origin,l)),m=await I2(h);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:m})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Fm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,u;return new Promise((h,m)=>{const p=Hx("",20);a.port1.start();const x=setTimeout(()=>{m(new Error("unsupported_event"))},n);u={messageChannel:a,onMessage(_){const b=_;if(b.data.eventId===p)switch(b.data.status){case"ack":clearTimeout(x),l=setTimeout(()=>{m(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),h(b.data.response);break;default:clearTimeout(x),clearTimeout(l),m(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(){return window}function R2(s){ia().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(){return typeof ia().WorkerGlobalScope<"u"&&typeof ia().importScripts=="function"}async function k2(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function D2(){return navigator?.serviceWorker?.controller||null}function P2(){return qN()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN="firebaseLocalStorageDb",M2=1,fm="firebaseLocalStorage",HN="fbase_key";class Xd{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Bm(s,e){return s.transaction([fm],e?"readwrite":"readonly").objectStore(fm)}function O2(){const s=indexedDB.deleteDatabase(zN);return new Xd(s).toPromise()}function Jy(){const s=indexedDB.open(zN,M2);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(fm,{keyPath:HN})}catch(a){t(a)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(fm)?e(n):(n.close(),await O2(),e(await Jy()))})})}async function $w(s,e,t){const n=Bm(s,!0).put({[HN]:e,value:t});return new Xd(n).toPromise()}async function V2(s,e){const t=Bm(s,!1).get(e),n=await new Xd(t).toPromise();return n===void 0?null:n.value}function Kw(s,e){const t=Bm(s,!0).delete(e);return new Xd(t).toPromise()}const L2=800,U2=3;class GN{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Jy(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>U2)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qN()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fm._getInstance(P2()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await k2(),!this.activeServiceWorker)return;this.sender=new C2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||D2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Jy();return await $w(e,hm,"1"),await Kw(e,hm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>$w(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>V2(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Kw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=Bm(a,!1).getAll();return new Xd(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),L2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}GN.type="LOCAL";const F2=GN;new Kd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gx(s,e){return e?Oa(e):($e(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x extends PN{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return pc(e,this._buildIdpRequest())}_linkToIdToken(e,t){return pc(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return pc(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function B2(s){return w2(s.auth,new $x(s),s.bypassAuthState)}function q2(s){const{auth:e,user:t}=s;return $e(t,e,"internal-error"),_2(t,new $x(s),s.bypassAuthState)}async function z2(s){const{auth:e,user:t}=s;return $e(t,e,"internal-error"),b2(t,new $x(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(e,t,n,a,l=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:l,error:u,type:h}=e;if(u){this.reject(u);return}const m={auth:this.auth,requestUri:t,sessionId:n,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(m))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return B2;case"linkViaPopup":case"linkViaRedirect":return z2;case"reauthViaPopup":case"reauthViaRedirect":return q2;default:ca(this.auth,"internal-error")}}resolve(e){qa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=new Kd(2e3,1e4);async function G2(s,e,t){if(Ks(s.app))return Promise.reject(Pr(s,"operation-not-supported-in-this-environment"));const n=Qd(s);xN(s,e,Um);const a=Gx(n,t);return new Bo(n,"signInViaPopup",e,a).executeNotNull()}class Bo extends $N{constructor(e,t,n,a,l){super(e,t,a,l),this.provider=n,this.authWindow=null,this.pollId=null,Bo.currentPopupAction&&Bo.currentPopupAction.cancel(),Bo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $e(e,this.auth,"internal-error"),e}async onExecution(){qa(this.filter.length===1,"Popup operations only handle one event");const e=Hx();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Pr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Pr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Bo.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,H2.get())};e()}}Bo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2="pendingRedirect",zf=new Map;class K2 extends $N{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=zf.get(this.auth._key());if(!e){try{const n=await Q2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}zf.set(this.auth._key(),e)}return this.bypassAuthState||zf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Q2(s,e){const t=QN(e),n=KN(s);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}async function Y2(s,e){return KN(s)._set(QN(e),"true")}function X2(s,e){zf.set(s._key(),e)}function KN(s){return Oa(s._redirectPersistence)}function QN(s){return qf($2,s.config.apiKey,s.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W2(s,e,t){return J2(s,e,t)}async function J2(s,e,t){if(Ks(s.app))return Promise.reject(Li(s));const n=Qd(s);xN(s,e,Um),await n._initializationPromise;const a=Gx(n,t);return await Y2(a,n),a._openRedirect(n,e,"signInViaRedirect")}async function Z2(s,e,t=!1){if(Ks(s.app))return Promise.reject(Li(s));const n=Qd(s),a=Gx(n,e),u=await new K2(n,a,t).execute();return u&&!t&&(delete u.user._redirectEventId,await n._persistUserIfCurrent(u.user),await n._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek=600*1e3;class tk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!nk(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!YN(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Pr(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=ek&&this.cachedEventUids.clear(),this.cachedEventUids.has(Qw(e))}saveEventToCache(e){this.cachedEventUids.add(Qw(e)),this.lastProcessedEventTime=Date.now()}}function Qw(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function YN({type:s,error:e}){return s==="unknown"&&e?.code==="auth/no-auth-event"}function nk(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return YN(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sk(s,e={}){return Hc(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ak=/^https?/;async function ik(s){if(s.config.emulator)return;const{authorizedDomains:e}=await sk(s);for(const t of e)try{if(ok(t))return}catch{}ca(s,"unauthorized-domain")}function ok(s){const e=Xy(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const u=new URL(s);return u.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&u.hostname===n}if(!ak.test(t))return!1;if(rk.test(s))return n===s;const a=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk=new Kd(3e4,6e4);function Yw(){const s=ia().___jsl;if(s?.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function ck(s){return new Promise((e,t)=>{function n(){Yw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Yw(),t(Pr(s,"network-request-failed"))},timeout:lk.get()})}if(ia().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ia().gapi?.load)n();else{const a=f2("iframefcb");return ia()[a]=()=>{gapi.load?n():t(Pr(s,"network-request-failed"))},d2(`${h2()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Hf=null,e})}let Hf=null;function uk(s){return Hf=Hf||ck(s),Hf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=new Kd(5e3,15e3),hk="__/auth/iframe",fk="emulator/auth/iframe",mk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pk(s){const e=s.config;$e(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?Ux(e,fk):`https://${s.config.authDomain}/${hk}`,n={apiKey:e.apiKey,appName:s.name,v:zc},a=gk.get(s.config.apiHost);a&&(n.eid=a);const l=s._getFrameworks();return l.length&&(n.fw=l.join(",")),`${t}?${$d(n).slice(1)}`}async function yk(s){const e=await uk(s),t=ia().gapi;return $e(t,s,"internal-error"),e.open({where:document.body,url:pk(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mk,dontclear:!0},n=>new Promise(async(a,l)=>{await n.restyle({setHideOnLeave:!1});const u=Pr(s,"network-request-failed"),h=ia().setTimeout(()=>{l(u)},dk.get());function m(){ia().clearTimeout(h),a(n)}n.ping(m).then(m,()=>{l(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},vk=500,bk=600,_k="_blank",wk="http://localhost";class Xw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Tk(s,e,t,n=vk,a=bk){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-n)/2,0).toString();let h="";const m={...xk,width:n.toString(),height:a.toString(),top:l,left:u},p=An().toLowerCase();t&&(h=SN(p)?_k:t),EN(p)&&(e=e||wk,m.scrollbars="yes");const x=Object.entries(m).reduce((b,[N,C])=>`${b}${N}=${C},`,"");if(s2(p)&&h!=="_self")return Ek(e||"",h),new Xw(null);const _=window.open(e||"",h,x);$e(_,s,"popup-blocked");try{_.focus()}catch{}return new Xw(_)}function Ek(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="__/auth/handler",Sk="emulator/auth/handler",Ak=encodeURIComponent("fac");async function Ww(s,e,t,n,a,l){$e(s.config.authDomain,s,"auth-domain-config-required"),$e(s.config.apiKey,s,"invalid-api-key");const u={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:zc,eventId:a};if(e instanceof Um){e.setDefaultLanguage(s.languageCode),u.providerId=e.providerId||"",T1(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,_]of Object.entries({}))u[x]=_}if(e instanceof Yd){const x=e.getScopes().filter(_=>_!=="");x.length>0&&(u.scopes=x.join(","))}s.tenantId&&(u.tid=s.tenantId);const h=u;for(const x of Object.keys(h))h[x]===void 0&&delete h[x];const m=await s._getAppCheckToken(),p=m?`#${Ak}=${encodeURIComponent(m)}`:"";return`${jk(s)}?${$d(h).slice(1)}${p}`}function jk({config:s}){return s.emulator?Ux(s,Sk):`https://${s.authDomain}/${Nk}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sy="webStorageSupport";class Ik{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=BN,this._completeRedirectFn=Z2,this._overrideRedirectResult=X2}async _openPopup(e,t,n,a){qa(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await Ww(e,t,n,Xy(),a);return Tk(e,l,Hx())}async _openRedirect(e,t,n,a){await this._originValidation(e);const l=await Ww(e,t,n,Xy(),a);return R2(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:l}=this.eventManagers[t];return a?Promise.resolve(a):(qa(l,"If manager is not set, promise should be"),l)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await yk(e),n=new tk(e);return t.register("authEvent",a=>($e(a?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sy,{type:Sy},a=>{const l=a?.[0]?.[Sy];l!==void 0&&t(!!l),ca(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ik(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return RN()||NN()||qx()}}const Ck=Ik;var Jw="@firebase/auth",Zw="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kk(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Dk(s){Vr(new yr("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=n.options;$e(u&&!u.includes(":"),"invalid-api-key",{appName:n.name});const m={apiKey:u,authDomain:h,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:kN(s)},p=new c2(n,a,l,m);return g2(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Vr(new yr("auth-internal",e=>{const t=Qd(e.getProvider("auth").getImmediate());return(n=>new Rk(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),As(Jw,Zw,kk(s)),As(Jw,Zw,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk=300,Mk=rN("authIdTokenMaxAge")||Pk;let eT=null;const Ok=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Mk)return;const a=t?.token;eT!==a&&(eT=a,await fetch(s,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function Vk(s=Lm()){const e=da(s,"auth");if(e.isInitialized())return e.getImmediate();const t=m2(s,{popupRedirectResolver:Ck,persistence:[F2,UN,BN]}),n=rN("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(n,location.origin);if(location.origin===l.origin){const u=Ok(l.toString());E2(t,u,()=>u(t.currentUser)),ON(t,h=>u(h))}}const a=tN("auth");return a&&p2(t,`http://${a}`),t}function Lk(){return document.getElementsByTagName("head")?.[0]??document}u2({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=a=>{const l=Pr("internal-error");l.customData=a,t(l)},n.type="text/javascript",n.charset="UTF-8",Lk().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Dk("Browser");var Uk="firebase",Fk="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */As(Uk,Fk,"app");var tT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ui,XN;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(R,T){function A(){}A.prototype=T.prototype,R.D=T.prototype,R.prototype=new A,R.prototype.constructor=R,R.C=function(V,I,G){for(var O=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)O[Ve-2]=arguments[Ve];return T.prototype[I].apply(V,O)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(R,T,A){A||(A=0);var V=Array(16);if(typeof T=="string")for(var I=0;16>I;++I)V[I]=T.charCodeAt(A++)|T.charCodeAt(A++)<<8|T.charCodeAt(A++)<<16|T.charCodeAt(A++)<<24;else for(I=0;16>I;++I)V[I]=T[A++]|T[A++]<<8|T[A++]<<16|T[A++]<<24;T=R.g[0],A=R.g[1],I=R.g[2];var G=R.g[3],O=T+(G^A&(I^G))+V[0]+3614090360&4294967295;T=A+(O<<7&4294967295|O>>>25),O=G+(I^T&(A^I))+V[1]+3905402710&4294967295,G=T+(O<<12&4294967295|O>>>20),O=I+(A^G&(T^A))+V[2]+606105819&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(T^I&(G^T))+V[3]+3250441966&4294967295,A=I+(O<<22&4294967295|O>>>10),O=T+(G^A&(I^G))+V[4]+4118548399&4294967295,T=A+(O<<7&4294967295|O>>>25),O=G+(I^T&(A^I))+V[5]+1200080426&4294967295,G=T+(O<<12&4294967295|O>>>20),O=I+(A^G&(T^A))+V[6]+2821735955&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(T^I&(G^T))+V[7]+4249261313&4294967295,A=I+(O<<22&4294967295|O>>>10),O=T+(G^A&(I^G))+V[8]+1770035416&4294967295,T=A+(O<<7&4294967295|O>>>25),O=G+(I^T&(A^I))+V[9]+2336552879&4294967295,G=T+(O<<12&4294967295|O>>>20),O=I+(A^G&(T^A))+V[10]+4294925233&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(T^I&(G^T))+V[11]+2304563134&4294967295,A=I+(O<<22&4294967295|O>>>10),O=T+(G^A&(I^G))+V[12]+1804603682&4294967295,T=A+(O<<7&4294967295|O>>>25),O=G+(I^T&(A^I))+V[13]+4254626195&4294967295,G=T+(O<<12&4294967295|O>>>20),O=I+(A^G&(T^A))+V[14]+2792965006&4294967295,I=G+(O<<17&4294967295|O>>>15),O=A+(T^I&(G^T))+V[15]+1236535329&4294967295,A=I+(O<<22&4294967295|O>>>10),O=T+(I^G&(A^I))+V[1]+4129170786&4294967295,T=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(T^A))+V[6]+3225465664&4294967295,G=T+(O<<9&4294967295|O>>>23),O=I+(T^A&(G^T))+V[11]+643717713&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^T&(I^G))+V[0]+3921069994&4294967295,A=I+(O<<20&4294967295|O>>>12),O=T+(I^G&(A^I))+V[5]+3593408605&4294967295,T=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(T^A))+V[10]+38016083&4294967295,G=T+(O<<9&4294967295|O>>>23),O=I+(T^A&(G^T))+V[15]+3634488961&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^T&(I^G))+V[4]+3889429448&4294967295,A=I+(O<<20&4294967295|O>>>12),O=T+(I^G&(A^I))+V[9]+568446438&4294967295,T=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(T^A))+V[14]+3275163606&4294967295,G=T+(O<<9&4294967295|O>>>23),O=I+(T^A&(G^T))+V[3]+4107603335&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^T&(I^G))+V[8]+1163531501&4294967295,A=I+(O<<20&4294967295|O>>>12),O=T+(I^G&(A^I))+V[13]+2850285829&4294967295,T=A+(O<<5&4294967295|O>>>27),O=G+(A^I&(T^A))+V[2]+4243563512&4294967295,G=T+(O<<9&4294967295|O>>>23),O=I+(T^A&(G^T))+V[7]+1735328473&4294967295,I=G+(O<<14&4294967295|O>>>18),O=A+(G^T&(I^G))+V[12]+2368359562&4294967295,A=I+(O<<20&4294967295|O>>>12),O=T+(A^I^G)+V[5]+4294588738&4294967295,T=A+(O<<4&4294967295|O>>>28),O=G+(T^A^I)+V[8]+2272392833&4294967295,G=T+(O<<11&4294967295|O>>>21),O=I+(G^T^A)+V[11]+1839030562&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^T)+V[14]+4259657740&4294967295,A=I+(O<<23&4294967295|O>>>9),O=T+(A^I^G)+V[1]+2763975236&4294967295,T=A+(O<<4&4294967295|O>>>28),O=G+(T^A^I)+V[4]+1272893353&4294967295,G=T+(O<<11&4294967295|O>>>21),O=I+(G^T^A)+V[7]+4139469664&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^T)+V[10]+3200236656&4294967295,A=I+(O<<23&4294967295|O>>>9),O=T+(A^I^G)+V[13]+681279174&4294967295,T=A+(O<<4&4294967295|O>>>28),O=G+(T^A^I)+V[0]+3936430074&4294967295,G=T+(O<<11&4294967295|O>>>21),O=I+(G^T^A)+V[3]+3572445317&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^T)+V[6]+76029189&4294967295,A=I+(O<<23&4294967295|O>>>9),O=T+(A^I^G)+V[9]+3654602809&4294967295,T=A+(O<<4&4294967295|O>>>28),O=G+(T^A^I)+V[12]+3873151461&4294967295,G=T+(O<<11&4294967295|O>>>21),O=I+(G^T^A)+V[15]+530742520&4294967295,I=G+(O<<16&4294967295|O>>>16),O=A+(I^G^T)+V[2]+3299628645&4294967295,A=I+(O<<23&4294967295|O>>>9),O=T+(I^(A|~G))+V[0]+4096336452&4294967295,T=A+(O<<6&4294967295|O>>>26),O=G+(A^(T|~I))+V[7]+1126891415&4294967295,G=T+(O<<10&4294967295|O>>>22),O=I+(T^(G|~A))+V[14]+2878612391&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~T))+V[5]+4237533241&4294967295,A=I+(O<<21&4294967295|O>>>11),O=T+(I^(A|~G))+V[12]+1700485571&4294967295,T=A+(O<<6&4294967295|O>>>26),O=G+(A^(T|~I))+V[3]+2399980690&4294967295,G=T+(O<<10&4294967295|O>>>22),O=I+(T^(G|~A))+V[10]+4293915773&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~T))+V[1]+2240044497&4294967295,A=I+(O<<21&4294967295|O>>>11),O=T+(I^(A|~G))+V[8]+1873313359&4294967295,T=A+(O<<6&4294967295|O>>>26),O=G+(A^(T|~I))+V[15]+4264355552&4294967295,G=T+(O<<10&4294967295|O>>>22),O=I+(T^(G|~A))+V[6]+2734768916&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~T))+V[13]+1309151649&4294967295,A=I+(O<<21&4294967295|O>>>11),O=T+(I^(A|~G))+V[4]+4149444226&4294967295,T=A+(O<<6&4294967295|O>>>26),O=G+(A^(T|~I))+V[11]+3174756917&4294967295,G=T+(O<<10&4294967295|O>>>22),O=I+(T^(G|~A))+V[2]+718787259&4294967295,I=G+(O<<15&4294967295|O>>>17),O=A+(G^(I|~T))+V[9]+3951481745&4294967295,R.g[0]=R.g[0]+T&4294967295,R.g[1]=R.g[1]+(I+(O<<21&4294967295|O>>>11))&4294967295,R.g[2]=R.g[2]+I&4294967295,R.g[3]=R.g[3]+G&4294967295}n.prototype.u=function(R,T){T===void 0&&(T=R.length);for(var A=T-this.blockSize,V=this.B,I=this.h,G=0;G<T;){if(I==0)for(;G<=A;)a(this,R,G),G+=this.blockSize;if(typeof R=="string"){for(;G<T;)if(V[I++]=R.charCodeAt(G++),I==this.blockSize){a(this,V),I=0;break}}else for(;G<T;)if(V[I++]=R[G++],I==this.blockSize){a(this,V),I=0;break}}this.h=I,this.o+=T},n.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var T=1;T<R.length-8;++T)R[T]=0;var A=8*this.o;for(T=R.length-8;T<R.length;++T)R[T]=A&255,A/=256;for(this.u(R),R=Array(16),T=A=0;4>T;++T)for(var V=0;32>V;V+=8)R[A++]=this.g[T]>>>V&255;return R};function l(R,T){var A=h;return Object.prototype.hasOwnProperty.call(A,R)?A[R]:A[R]=T(R)}function u(R,T){this.h=T;for(var A=[],V=!0,I=R.length-1;0<=I;I--){var G=R[I]|0;V&&G==T||(A[I]=G,V=!1)}this.g=A}var h={};function m(R){return-128<=R&&128>R?l(R,function(T){return new u([T|0],0>T?-1:0)}):new u([R|0],0>R?-1:0)}function p(R){if(isNaN(R)||!isFinite(R))return _;if(0>R)return L(p(-R));for(var T=[],A=1,V=0;R>=A;V++)T[V]=R/A|0,A*=4294967296;return new u(T,0)}function x(R,T){if(R.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(R.charAt(0)=="-")return L(x(R.substring(1),T));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=p(Math.pow(T,8)),V=_,I=0;I<R.length;I+=8){var G=Math.min(8,R.length-I),O=parseInt(R.substring(I,I+G),T);8>G?(G=p(Math.pow(T,G)),V=V.j(G).add(p(O))):(V=V.j(A),V=V.add(p(O)))}return V}var _=m(0),b=m(1),N=m(16777216);s=u.prototype,s.m=function(){if(k(this))return-L(this).m();for(var R=0,T=1,A=0;A<this.g.length;A++){var V=this.i(A);R+=(0<=V?V:4294967296+V)*T,T*=4294967296}return R},s.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(C(this))return"0";if(k(this))return"-"+L(this).toString(R);for(var T=p(Math.pow(R,6)),A=this,V="";;){var I=H(A,T).g;A=F(A,I.j(T));var G=((0<A.g.length?A.g[0]:A.h)>>>0).toString(R);if(A=I,C(A))return G+V;for(;6>G.length;)G="0"+G;V=G+V}},s.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function C(R){if(R.h!=0)return!1;for(var T=0;T<R.g.length;T++)if(R.g[T]!=0)return!1;return!0}function k(R){return R.h==-1}s.l=function(R){return R=F(this,R),k(R)?-1:C(R)?0:1};function L(R){for(var T=R.g.length,A=[],V=0;V<T;V++)A[V]=~R.g[V];return new u(A,~R.h).add(b)}s.abs=function(){return k(this)?L(this):this},s.add=function(R){for(var T=Math.max(this.g.length,R.g.length),A=[],V=0,I=0;I<=T;I++){var G=V+(this.i(I)&65535)+(R.i(I)&65535),O=(G>>>16)+(this.i(I)>>>16)+(R.i(I)>>>16);V=O>>>16,G&=65535,O&=65535,A[I]=O<<16|G}return new u(A,A[A.length-1]&-2147483648?-1:0)};function F(R,T){return R.add(L(T))}s.j=function(R){if(C(this)||C(R))return _;if(k(this))return k(R)?L(this).j(L(R)):L(L(this).j(R));if(k(R))return L(this.j(L(R)));if(0>this.l(N)&&0>R.l(N))return p(this.m()*R.m());for(var T=this.g.length+R.g.length,A=[],V=0;V<2*T;V++)A[V]=0;for(V=0;V<this.g.length;V++)for(var I=0;I<R.g.length;I++){var G=this.i(V)>>>16,O=this.i(V)&65535,Ve=R.i(I)>>>16,ae=R.i(I)&65535;A[2*V+2*I]+=O*ae,U(A,2*V+2*I),A[2*V+2*I+1]+=G*ae,U(A,2*V+2*I+1),A[2*V+2*I+1]+=O*Ve,U(A,2*V+2*I+1),A[2*V+2*I+2]+=G*Ve,U(A,2*V+2*I+2)}for(V=0;V<T;V++)A[V]=A[2*V+1]<<16|A[2*V];for(V=T;V<2*T;V++)A[V]=0;return new u(A,0)};function U(R,T){for(;(R[T]&65535)!=R[T];)R[T+1]+=R[T]>>>16,R[T]&=65535,T++}function B(R,T){this.g=R,this.h=T}function H(R,T){if(C(T))throw Error("division by zero");if(C(R))return new B(_,_);if(k(R))return T=H(L(R),T),new B(L(T.g),L(T.h));if(k(T))return T=H(R,L(T)),new B(L(T.g),T.h);if(30<R.g.length){if(k(R)||k(T))throw Error("slowDivide_ only works with positive integers.");for(var A=b,V=T;0>=V.l(R);)A=$(A),V=$(V);var I=M(A,1),G=M(V,1);for(V=M(V,2),A=M(A,2);!C(V);){var O=G.add(V);0>=O.l(R)&&(I=I.add(A),G=O),V=M(V,1),A=M(A,1)}return T=F(R,I.j(T)),new B(I,T)}for(I=_;0<=R.l(T);){for(A=Math.max(1,Math.floor(R.m()/T.m())),V=Math.ceil(Math.log(A)/Math.LN2),V=48>=V?1:Math.pow(2,V-48),G=p(A),O=G.j(T);k(O)||0<O.l(R);)A-=V,G=p(A),O=G.j(T);C(G)&&(G=b),I=I.add(G),R=F(R,O)}return new B(I,R)}s.A=function(R){return H(this,R).h},s.and=function(R){for(var T=Math.max(this.g.length,R.g.length),A=[],V=0;V<T;V++)A[V]=this.i(V)&R.i(V);return new u(A,this.h&R.h)},s.or=function(R){for(var T=Math.max(this.g.length,R.g.length),A=[],V=0;V<T;V++)A[V]=this.i(V)|R.i(V);return new u(A,this.h|R.h)},s.xor=function(R){for(var T=Math.max(this.g.length,R.g.length),A=[],V=0;V<T;V++)A[V]=this.i(V)^R.i(V);return new u(A,this.h^R.h)};function $(R){for(var T=R.g.length+1,A=[],V=0;V<T;V++)A[V]=R.i(V)<<1|R.i(V-1)>>>31;return new u(A,R.h)}function M(R,T){var A=T>>5;T%=32;for(var V=R.g.length-A,I=[],G=0;G<V;G++)I[G]=0<T?R.i(G+A)>>>T|R.i(G+A+1)<<32-T:R.i(G+A);return new u(I,R.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,XN=n,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=p,u.fromString=x,Ui=u}).apply(typeof tT<"u"?tT:typeof self<"u"?self:typeof window<"u"?window:{});var If=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var WN,fd,JN,Gf,Zy,ZN,eS,tS;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,v,w){return f==Array.prototype||f==Object.prototype||(f[v]=w.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof If=="object"&&If];for(var v=0;v<f.length;++v){var w=f[v];if(w&&w.Math==Math)return w}throw Error("Cannot find global object")}var n=t(this);function a(f,v){if(v)e:{var w=n;f=f.split(".");for(var j=0;j<f.length-1;j++){var J=f[j];if(!(J in w))break e;w=w[J]}f=f[f.length-1],j=w[f],v=v(j),v!=j&&v!=null&&e(w,f,{configurable:!0,writable:!0,value:v})}}function l(f,v){f instanceof String&&(f+="");var w=0,j=!1,J={next:function(){if(!j&&w<f.length){var le=w++;return{value:v(le,f[le]),done:!1}}return j=!0,{done:!0,value:void 0}}};return J[Symbol.iterator]=function(){return J},J}a("Array.prototype.values",function(f){return f||function(){return l(this,function(v,w){return w})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var u=u||{},h=this||self;function m(f){var v=typeof f;return v=v!="object"?v:f?Array.isArray(f)?"array":v:"null",v=="array"||v=="object"&&typeof f.length=="number"}function p(f){var v=typeof f;return v=="object"&&f!=null||v=="function"}function x(f,v,w){return f.call.apply(f.bind,arguments)}function _(f,v,w){if(!f)throw Error();if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var J=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(J,j),f.apply(v,J)}}return function(){return f.apply(v,arguments)}}function b(f,v,w){return b=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?x:_,b.apply(null,arguments)}function N(f,v){var w=Array.prototype.slice.call(arguments,1);return function(){var j=w.slice();return j.push.apply(j,arguments),f.apply(this,j)}}function C(f,v){function w(){}w.prototype=v.prototype,f.aa=v.prototype,f.prototype=new w,f.prototype.constructor=f,f.Qb=function(j,J,le){for(var we=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)we[ut-2]=arguments[ut];return v.prototype[J].apply(j,we)}}function k(f){const v=f.length;if(0<v){const w=Array(v);for(let j=0;j<v;j++)w[j]=f[j];return w}return[]}function L(f,v){for(let w=1;w<arguments.length;w++){const j=arguments[w];if(m(j)){const J=f.length||0,le=j.length||0;f.length=J+le;for(let we=0;we<le;we++)f[J+we]=j[we]}else f.push(j)}}class F{constructor(v,w){this.i=v,this.j=w,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function U(f){return/^[\s\xa0]*$/.test(f)}function B(){var f=h.navigator;return f&&(f=f.userAgent)?f:""}function H(f){return H[" "](f),f}H[" "]=function(){};var $=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function M(f,v,w){for(const j in f)v.call(w,f[j],j,f)}function R(f,v){for(const w in f)v.call(void 0,f[w],w,f)}function T(f){const v={};for(const w in f)v[w]=f[w];return v}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(f,v){let w,j;for(let J=1;J<arguments.length;J++){j=arguments[J];for(w in j)f[w]=j[w];for(let le=0;le<A.length;le++)w=A[le],Object.prototype.hasOwnProperty.call(j,w)&&(f[w]=j[w])}}function I(f){var v=1;f=f.split(":");const w=[];for(;0<v&&f.length;)w.push(f.shift()),v--;return f.length&&w.push(f.join(":")),w}function G(f){h.setTimeout(()=>{throw f},0)}function O(){var f=be;let v=null;return f.g&&(v=f.g,f.g=f.g.next,f.g||(f.h=null),v.next=null),v}class Ve{constructor(){this.h=this.g=null}add(v,w){const j=ae.get();j.set(v,w),this.h?this.h.next=j:this.g=j,this.h=j}}var ae=new F(()=>new z,f=>f.reset());class z{constructor(){this.next=this.g=this.h=null}set(v,w){this.h=v,this.g=w,this.next=null}reset(){this.next=this.g=this.h=null}}let oe,Y=!1,be=new Ve,D=()=>{const f=h.Promise.resolve(void 0);oe=()=>{f.then(se)}};var se=()=>{for(var f;f=O();){try{f.h.call(f.g)}catch(w){G(w)}var v=ae;v.j(f),100>v.h&&(v.h++,f.next=v.g,v.g=f)}Y=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ue(f,v){this.type=f,this.g=this.target=v,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var Ie=(function(){if(!h.addEventListener||!Object.defineProperty)return!1;var f=!1,v=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const w=()=>{};h.addEventListener("test",w,v),h.removeEventListener("test",w,v)}catch{}return f})();function pe(f,v){if(ue.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var w=this.type=f.type,j=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=v,v=f.relatedTarget){if($){e:{try{H(v.nodeName);var J=!0;break e}catch{}J=!1}J||(v=null)}}else w=="mouseover"?v=f.fromElement:w=="mouseout"&&(v=f.toElement);this.relatedTarget=v,j?(this.clientX=j.clientX!==void 0?j.clientX:j.pageX,this.clientY=j.clientY!==void 0?j.clientY:j.pageY,this.screenX=j.screenX||0,this.screenY=j.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Ne[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&pe.aa.h.call(this)}}C(pe,ue);var Ne={2:"touch",3:"pen",4:"mouse"};pe.prototype.h=function(){pe.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var ce="closure_listenable_"+(1e6*Math.random()|0),_e=0;function Se(f,v,w,j,J){this.listener=f,this.proxy=null,this.src=v,this.type=w,this.capture=!!j,this.ha=J,this.key=++_e,this.da=this.fa=!1}function Ue(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Ze(f){this.src=f,this.g={},this.h=0}Ze.prototype.add=function(f,v,w,j,J){var le=f.toString();f=this.g[le],f||(f=this.g[le]=[],this.h++);var we=lt(f,v,j,J);return-1<we?(v=f[we],w||(v.fa=!1)):(v=new Se(v,this.src,le,!!j,J),v.fa=w,f.push(v)),v};function Ge(f,v){var w=v.type;if(w in f.g){var j=f.g[w],J=Array.prototype.indexOf.call(j,v,void 0),le;(le=0<=J)&&Array.prototype.splice.call(j,J,1),le&&(Ue(v),f.g[w].length==0&&(delete f.g[w],f.h--))}}function lt(f,v,w,j){for(var J=0;J<f.length;++J){var le=f[J];if(!le.da&&le.listener==v&&le.capture==!!w&&le.ha==j)return J}return-1}var ze="closure_lm_"+(1e6*Math.random()|0),Qe={};function gt(f,v,w,j,J){if(Array.isArray(v)){for(var le=0;le<v.length;le++)gt(f,v[le],w,j,J);return null}return w=Ps(w),f&&f[ce]?f.K(v,w,p(j)?!!j.capture:!1,J):ct(f,v,w,!1,j,J)}function ct(f,v,w,j,J,le){if(!v)throw Error("Invalid event type");var we=p(J)?!!J.capture:!!J,ut=ks(f);if(ut||(f[ze]=ut=new Ze(f)),w=ut.add(v,w,j,we,le),w.proxy)return w;if(j=It(),w.proxy=j,j.src=f,j.listener=w,f.addEventListener)Ie||(J=we),J===void 0&&(J=!1),f.addEventListener(v.toString(),j,J);else if(f.attachEvent)f.attachEvent(Gn(v.toString()),j);else if(f.addListener&&f.removeListener)f.addListener(j);else throw Error("addEventListener and attachEvent are unavailable.");return w}function It(){function f(w){return v.call(f.src,f.listener,w)}const v=br;return f}function Hn(f,v,w,j,J){if(Array.isArray(v))for(var le=0;le<v.length;le++)Hn(f,v[le],w,j,J);else j=p(j)?!!j.capture:!!j,w=Ps(w),f&&f[ce]?(f=f.i,v=String(v).toString(),v in f.g&&(le=f.g[v],w=lt(le,w,j,J),-1<w&&(Ue(le[w]),Array.prototype.splice.call(le,w,1),le.length==0&&(delete f.g[v],f.h--)))):f&&(f=ks(f))&&(v=f.g[v.toString()],f=-1,v&&(f=lt(v,w,j,J)),(w=-1<f?v[f]:null)&&an(w))}function an(f){if(typeof f!="number"&&f&&!f.da){var v=f.src;if(v&&v[ce])Ge(v.i,f);else{var w=f.type,j=f.proxy;v.removeEventListener?v.removeEventListener(w,j,f.capture):v.detachEvent?v.detachEvent(Gn(w),j):v.addListener&&v.removeListener&&v.removeListener(j),(w=ks(v))?(Ge(w,f),w.h==0&&(w.src=null,v[ze]=null)):Ue(f)}}}function Gn(f){return f in Qe?Qe[f]:Qe[f]="on"+f}function br(f,v){if(f.da)f=!0;else{v=new pe(v,this);var w=f.listener,j=f.ha||f.src;f.fa&&an(f),f=w.call(j,v)}return f}function ks(f){return f=f[ze],f instanceof Ze?f:null}var Ds="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ps(f){return typeof f=="function"?f:(f[Ds]||(f[Ds]=function(v){return f.handleEvent(v)}),f[Ds])}function wt(){xe.call(this),this.i=new Ze(this),this.M=this,this.F=null}C(wt,xe),wt.prototype[ce]=!0,wt.prototype.removeEventListener=function(f,v,w,j){Hn(this,f,v,w,j)};function pt(f,v){var w,j=f.F;if(j)for(w=[];j;j=j.F)w.push(j);if(f=f.M,j=v.type||v,typeof v=="string")v=new ue(v,f);else if(v instanceof ue)v.target=v.target||f;else{var J=v;v=new ue(j,f),V(v,J)}if(J=!0,w)for(var le=w.length-1;0<=le;le--){var we=v.g=w[le];J=Zn(we,j,!0,v)&&J}if(we=v.g=f,J=Zn(we,j,!0,v)&&J,J=Zn(we,j,!1,v)&&J,w)for(le=0;le<w.length;le++)we=v.g=w[le],J=Zn(we,j,!1,v)&&J}wt.prototype.N=function(){if(wt.aa.N.call(this),this.i){var f=this.i,v;for(v in f.g){for(var w=f.g[v],j=0;j<w.length;j++)Ue(w[j]);delete f.g[v],f.h--}}this.F=null},wt.prototype.K=function(f,v,w,j){return this.i.add(String(f),v,!1,w,j)},wt.prototype.L=function(f,v,w,j){return this.i.add(String(f),v,!0,w,j)};function Zn(f,v,w,j){if(v=f.i.g[String(v)],!v)return!0;v=v.concat();for(var J=!0,le=0;le<v.length;++le){var we=v[le];if(we&&!we.da&&we.capture==w){var ut=we.listener,_n=we.ha||we.src;we.fa&&Ge(f.i,we),J=ut.call(_n,j)!==!1&&J}}return J&&!j.defaultPrevented}function vn(f,v,w){if(typeof f=="function")w&&(f=b(f,w));else if(f&&typeof f.handleEvent=="function")f=b(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:h.setTimeout(f,v||0)}function Xa(f){f.g=vn(()=>{f.g=null,f.i&&(f.i=!1,Xa(f))},f.l);const v=f.h;f.h=null,f.m.apply(null,v)}class fl extends xe{constructor(v,w){super(),this.m=v,this.l=w,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:Xa(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Js(f){xe.call(this),this.h=f,this.g={}}C(Js,xe);var Zs=[];function $n(f){M(f.g,function(v,w){this.g.hasOwnProperty(w)&&an(v)},f),f.g={}}Js.prototype.N=function(){Js.aa.N.call(this),$n(this)},Js.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rn=h.JSON.stringify,Lr=h.JSON.parse,_r=class{stringify(f){return h.JSON.stringify(f,void 0)}parse(f){return h.JSON.parse(f,void 0)}};function so(){}so.prototype.h=null;function Ur(f){return f.h||(f.h=f.i())}function Fr(){}var wr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function cs(){ue.call(this,"d")}C(cs,ue);function ro(){ue.call(this,"c")}C(ro,ue);var er={},qt=null;function us(){return qt=qt||new wt}er.La="serverreachability";function Wa(f){ue.call(this,er.La,f)}C(Wa,ue);function Tr(f){const v=us();pt(v,new Wa(v))}er.STAT_EVENT="statevent";function Ja(f,v){ue.call(this,er.STAT_EVENT,f),this.stat=v}C(Ja,ue);function Mt(f){const v=us();pt(v,new Ja(v,f))}er.Ma="timingevent";function tn(f,v){ue.call(this,er.Ma,f),this.size=v}C(tn,ue);function nn(f,v){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){f()},v)}function Yt(){this.g=!0}Yt.prototype.xa=function(){this.g=!1};function tr(f,v,w,j,J,le){f.info(function(){if(f.g)if(le)for(var we="",ut=le.split("&"),_n=0;_n<ut.length;_n++){var dt=ut[_n].split("=");if(1<dt.length){var On=dt[0];dt=dt[1];var wn=On.split("_");we=2<=wn.length&&wn[1]=="type"?we+(On+"="+dt+"&"):we+(On+"=redacted&")}}else we=null;else we=le;return"XMLHTTP REQ ("+j+") [attempt "+J+"]: "+v+`
`+w+`
`+we})}function ml(f,v,w,j,J,le,we){f.info(function(){return"XMLHTTP RESP ("+j+") [ attempt "+J+"]: "+v+`
`+w+`
`+le+" "+we})}function Er(f,v,w,j){f.info(function(){return"XMLHTTP TEXT ("+v+"): "+Br(f,w)+(j?" "+j:"")})}function Za(f,v){f.info(function(){return"TIMEOUT: "+v})}Yt.prototype.info=function(){};function Br(f,v){if(!f.g)return v;if(!v)return null;try{var w=JSON.parse(v);if(w){for(f=0;f<w.length;f++)if(Array.isArray(w[f])){var j=w[f];if(!(2>j.length)){var J=j[1];if(Array.isArray(J)&&!(1>J.length)){var le=J[0];if(le!="noop"&&le!="stop"&&le!="close")for(var we=1;we<J.length;we++)J[we]=""}}}}return Rn(w)}catch{return v}}var kn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},nr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ms;function Os(){}C(Os,so),Os.prototype.g=function(){return new XMLHttpRequest},Os.prototype.i=function(){return{}},Ms=new Os;function Dn(f,v,w,j){this.j=f,this.i=v,this.l=w,this.R=j||1,this.U=new Js(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Xt}function Xt(){this.i=null,this.g="",this.h=!1}var De={},Q={};function ye(f,v,w){f.L=1,f.v=lo(Vs(v)),f.m=w,f.P=!0,je(f,null)}function je(f,v){f.F=Date.now(),Ot(f),f.A=Vs(f.v);var w=f.A,j=f.R;Array.isArray(j)||(j=[String(j)]),lu(w.i,"t",j),f.C=0,w=f.j.J,f.h=new Xt,f.g=Th(f.j,w?v:null,!f.m),0<f.O&&(f.M=new fl(b(f.Y,f,f.g),f.O)),v=f.U,w=f.g,j=f.ca;var J="readystatechange";Array.isArray(J)||(J&&(Zs[0]=J.toString()),J=Zs);for(var le=0;le<J.length;le++){var we=gt(w,J[le],j||v.handleEvent,!1,v.h||v);if(!we)break;v.g[we.key]=we}v=f.H?T(f.H):{},f.m?(f.u||(f.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,v)):(f.u="GET",f.g.ea(f.A,f.u,null,v)),Tr(),tr(f.i,f.u,f.A,f.l,f.R,f.m)}Dn.prototype.ca=function(f){f=f.target;const v=this.M;v&&or(f)==3?v.j():this.Y(f)},Dn.prototype.Y=function(f){try{if(f==this.g)e:{const wn=or(this.g);var v=this.g.Ba();const xa=this.g.Z();if(!(3>wn)&&(wn!=3||this.g&&(this.h.h||this.g.oa()||gh(this.g)))){this.J||wn!=4||v==7||(v==8||0>=xa?Tr(3):Tr(2)),Pn(this);var w=this.g.Z();this.X=w;t:if(Tt(this)){var j=gh(this.g);f="";var J=j.length,le=or(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ln(this),es(this);var we="";break t}this.h.i=new h.TextDecoder}for(v=0;v<J;v++)this.h.h=!0,f+=this.h.i.decode(j[v],{stream:!(le&&v==J-1)});j.length=0,this.h.g+=f,this.C=0,we=this.h.g}else we=this.g.oa();if(this.o=w==200,ml(this.i,this.u,this.A,this.l,this.R,wn,w),this.o){if(this.T&&!this.K){t:{if(this.g){var ut,_n=this.g;if((ut=_n.g?_n.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(ut)){var dt=ut;break t}}dt=null}if(w=dt)Er(this.i,this.l,w,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zt(this,w);else{this.o=!1,this.s=3,Mt(12),ln(this),es(this);break e}}if(this.P){w=!0;let Kn;for(;!this.J&&this.C<we.length;)if(Kn=on(this,we),Kn==Q){wn==4&&(this.s=4,Mt(14),w=!1),Er(this.i,this.l,null,"[Incomplete Response]");break}else if(Kn==De){this.s=4,Mt(15),Er(this.i,this.l,we,"[Invalid Chunk]"),w=!1;break}else Er(this.i,this.l,Kn,null),zt(this,Kn);if(Tt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),wn!=4||we.length!=0||this.h.h||(this.s=1,Mt(16),w=!1),this.o=this.o&&w,!w)Er(this.i,this.l,we,"[Invalid Chunked Response]"),ln(this),es(this);else if(0<we.length&&!this.W){this.W=!0;var On=this.j;On.g==this&&On.ba&&!On.M&&(On.j.info("Great, no buffering proxy detected. Bytes received: "+we.length),yo(On),On.M=!0,Mt(11))}}else Er(this.i,this.l,we,null),zt(this,we);wn==4&&ln(this),this.o&&!this.J&&(wn==4?bh(this.j,this):(this.o=!1,Ot(this)))}else wg(this.g),w==400&&0<we.indexOf("Unknown SID")?(this.s=3,Mt(12)):(this.s=0,Mt(13)),ln(this),es(this)}}}catch{}finally{}};function Tt(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function on(f,v){var w=f.C,j=v.indexOf(`
`,w);return j==-1?Q:(w=Number(v.substring(w,j)),isNaN(w)?De:(j+=1,j+w>v.length?Q:(v=v.slice(j,j+w),f.C=j+w,v)))}Dn.prototype.cancel=function(){this.J=!0,ln(this)};function Ot(f){f.S=Date.now()+f.I,bn(f,f.I)}function bn(f,v){if(f.B!=null)throw Error("WatchDog timer not null");f.B=nn(b(f.ba,f),v)}function Pn(f){f.B&&(h.clearTimeout(f.B),f.B=null)}Dn.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(Za(this.i,this.A),this.L!=2&&(Tr(),Mt(17)),ln(this),this.s=2,es(this)):bn(this,this.S-f)};function es(f){f.j.G==0||f.J||bh(f.j,f)}function ln(f){Pn(f);var v=f.M;v&&typeof v.ma=="function"&&v.ma(),f.M=null,$n(f.U),f.g&&(v=f.g,f.g=null,v.abort(),v.ma())}function zt(f,v){try{var w=f.j;if(w.G!=0&&(w.g==f||su(w.h,f))){if(!f.K&&su(w.h,f)&&w.G==3){try{var j=w.Da.g.parse(v)}catch{j=null}if(Array.isArray(j)&&j.length==3){var J=j;if(J[0]==0){e:if(!w.u){if(w.g)if(w.g.F+3e3<f.F)Sl(w),El(w);else break e;fu(w),Mt(18)}}else w.za=J[1],0<w.za-w.T&&37500>J[2]&&w.F&&w.v==0&&!w.C&&(w.C=nn(b(w.Za,w),6e3));if(1>=pl(w.h)&&w.ca){try{w.ca()}catch{}w.ca=void 0}}else ya(w,11)}else if((f.K||w.g==f)&&Sl(w),!U(v))for(J=w.Da.g.parse(v),v=0;v<J.length;v++){let dt=J[v];if(w.T=dt[0],dt=dt[1],w.G==2)if(dt[0]=="c"){w.K=dt[1],w.ia=dt[2];const On=dt[3];On!=null&&(w.la=On,w.j.info("VER="+w.la));const wn=dt[4];wn!=null&&(w.Aa=wn,w.j.info("SVER="+w.Aa));const xa=dt[5];xa!=null&&typeof xa=="number"&&0<xa&&(j=1.5*xa,w.L=j,w.j.info("backChannelRequestTimeoutMs_="+j)),j=w;const Kn=f.g;if(Kn){const Qr=Kn.g?Kn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Qr){var le=j.h;le.g||Qr.indexOf("spdy")==-1&&Qr.indexOf("quic")==-1&&Qr.indexOf("h2")==-1||(le.j=le.l,le.g=new Set,le.h&&(yl(le,le.h),le.h=null))}if(j.D){const gu=Kn.g?Kn.g.getResponseHeader("X-HTTP-Session-Id"):null;gu&&(j.ya=gu,Ct(j.I,j.D,gu))}}w.G=3,w.l&&w.l.ua(),w.ba&&(w.R=Date.now()-f.F,w.j.info("Handshake RTT: "+w.R+"ms")),j=w;var we=f;if(j.qa=wh(j,j.J?j.ia:null,j.W),we.K){ds(j.h,we);var ut=we,_n=j.L;_n&&(ut.I=_n),ut.B&&(Pn(ut),Ot(ut)),j.g=we}else xh(j);0<w.i.length&&Nl(w)}else dt[0]!="stop"&&dt[0]!="close"||ya(w,7);else w.G==3&&(dt[0]=="stop"||dt[0]=="close"?dt[0]=="stop"?ya(w,7):du(w):dt[0]!="noop"&&w.l&&w.l.ta(dt),w.v=0)}}Tr(4)}catch{}}var ao=class{constructor(f,v){this.g=f,this.map=v}};function sr(f){this.l=f||10,h.PerformanceNavigationTiming?(f=h.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(h.chrome&&h.chrome.loadTimes&&h.chrome.loadTimes()&&h.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gl(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function pl(f){return f.h?1:f.g?f.g.size:0}function su(f,v){return f.h?f.h==v:f.g?f.g.has(v):!1}function yl(f,v){f.g?f.g.add(v):f.h=v}function ds(f,v){f.h&&f.h==v?f.h=null:f.g&&f.g.has(v)&&f.g.delete(v)}sr.prototype.cancel=function(){if(this.i=ru(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function ru(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let v=f.i;for(const w of f.g.values())v=v.concat(w.D);return v}return k(f.i)}function xg(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(m(f)){for(var v=[],w=f.length,j=0;j<w;j++)v.push(f[j]);return v}v=[],w=0;for(j in f)v[w++]=f[j];return v}function xl(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(m(f)||typeof f=="string"){var v=[];f=f.length;for(var w=0;w<f;w++)v.push(w);return v}v=[],w=0;for(const j in f)v[w++]=j;return v}}}function au(f,v){if(f.forEach&&typeof f.forEach=="function")f.forEach(v,void 0);else if(m(f)||typeof f=="string")Array.prototype.forEach.call(f,v,void 0);else for(var w=xl(f),j=xg(f),J=j.length,le=0;le<J;le++)v.call(void 0,j[le],w&&w[le],f)}var io=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vg(f,v){if(f){f=f.split("&");for(var w=0;w<f.length;w++){var j=f[w].indexOf("="),J=null;if(0<=j){var le=f[w].substring(0,j);J=f[w].substring(j+1)}else le=f[w];v(le,J?decodeURIComponent(J.replace(/\+/g," ")):"")}}}function fn(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof fn){this.h=f.h,oo(this,f.j),this.o=f.o,this.g=f.g,ei(this,f.s),this.l=f.l;var v=f.i,w=new fa;w.i=v.i,v.g&&(w.g=new Map(v.g),w.h=v.h),ha(this,w),this.m=f.m}else f&&(v=String(f).match(io))?(this.h=!1,oo(this,v[1]||"",!0),this.o=rr(v[2]||""),this.g=rr(v[3]||"",!0),ei(this,v[4]),this.l=rr(v[5]||"",!0),ha(this,v[6]||"",!0),this.m=rr(v[7]||"")):(this.h=!1,this.i=new fa(null,this.h))}fn.prototype.toString=function(){var f=[],v=this.j;v&&f.push(co(v,iu,!0),":");var w=this.g;return(w||v=="file")&&(f.push("//"),(v=this.o)&&f.push(co(v,iu,!0),"@"),f.push(encodeURIComponent(String(w)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),w=this.s,w!=null&&f.push(":",String(w))),(w=this.l)&&(this.g&&w.charAt(0)!="/"&&f.push("/"),f.push(co(w,w.charAt(0)=="/"?bg:ou,!0))),(w=this.i.toString())&&f.push("?",w),(w=this.m)&&f.push("#",co(w,vl)),f.join("")};function Vs(f){return new fn(f)}function oo(f,v,w){f.j=w?rr(v,!0):v,f.j&&(f.j=f.j.replace(/:$/,""))}function ei(f,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);f.s=v}else f.s=null}function ha(f,v,w){v instanceof fa?(f.i=v,fh(f.i,f.h)):(w||(v=co(v,_g)),f.i=new fa(v,f.h))}function Ct(f,v,w){f.i.set(v,w)}function lo(f){return Ct(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function rr(f,v){return f?v?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function co(f,v,w){return typeof f=="string"?(f=encodeURI(f).replace(v,hh),w&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function hh(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var iu=/[#\/\?@]/g,ou=/[#\?:]/g,bg=/[#\?]/g,_g=/[#\?@]/g,vl=/#/g;function fa(f,v){this.h=this.g=null,this.i=f||null,this.j=!!v}function ar(f){f.g||(f.g=new Map,f.h=0,f.i&&vg(f.i,function(v,w){f.add(decodeURIComponent(v.replace(/\+/g," ")),w)}))}s=fa.prototype,s.add=function(f,v){ar(this),this.i=null,f=qr(this,f);var w=this.g.get(f);return w||this.g.set(f,w=[]),w.push(v),this.h+=1,this};function ma(f,v){ar(f),v=qr(f,v),f.g.has(v)&&(f.i=null,f.h-=f.g.get(v).length,f.g.delete(v))}function ga(f,v){return ar(f),v=qr(f,v),f.g.has(v)}s.forEach=function(f,v){ar(this),this.g.forEach(function(w,j){w.forEach(function(J){f.call(v,J,j,this)},this)},this)},s.na=function(){ar(this);const f=Array.from(this.g.values()),v=Array.from(this.g.keys()),w=[];for(let j=0;j<v.length;j++){const J=f[j];for(let le=0;le<J.length;le++)w.push(v[j])}return w},s.V=function(f){ar(this);let v=[];if(typeof f=="string")ga(this,f)&&(v=v.concat(this.g.get(qr(this,f))));else{f=Array.from(this.g.values());for(let w=0;w<f.length;w++)v=v.concat(f[w])}return v},s.set=function(f,v){return ar(this),this.i=null,f=qr(this,f),ga(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[v]),this.h+=1,this},s.get=function(f,v){return f?(f=this.V(f),0<f.length?String(f[0]):v):v};function lu(f,v,w){ma(f,v),0<w.length&&(f.i=null,f.g.set(qr(f,v),k(w)),f.h+=w.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],v=Array.from(this.g.keys());for(var w=0;w<v.length;w++){var j=v[w];const le=encodeURIComponent(String(j)),we=this.V(j);for(j=0;j<we.length;j++){var J=le;we[j]!==""&&(J+="="+encodeURIComponent(String(we[j]))),f.push(J)}}return this.i=f.join("&")};function qr(f,v){return v=String(v),f.j&&(v=v.toLowerCase()),v}function fh(f,v){v&&!f.j&&(ar(f),f.i=null,f.g.forEach(function(w,j){var J=j.toLowerCase();j!=J&&(ma(this,j),lu(this,J,w))},f)),f.j=v}function uo(f,v){const w=new Yt;if(h.Image){const j=new Image;j.onload=N(ir,w,"TestLoadImage: loaded",!0,v,j),j.onerror=N(ir,w,"TestLoadImage: error",!1,v,j),j.onabort=N(ir,w,"TestLoadImage: abort",!1,v,j),j.ontimeout=N(ir,w,"TestLoadImage: timeout",!1,v,j),h.setTimeout(function(){j.ontimeout&&j.ontimeout()},1e4),j.src=f}else v(!1)}function Nr(f,v){const w=new Yt,j=new AbortController,J=setTimeout(()=>{j.abort(),ir(w,"TestPingServer: timeout",!1,v)},1e4);fetch(f,{signal:j.signal}).then(le=>{clearTimeout(J),le.ok?ir(w,"TestPingServer: ok",!0,v):ir(w,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(J),ir(w,"TestPingServer: error",!1,v)})}function ir(f,v,w,j,J){try{J&&(J.onload=null,J.onerror=null,J.onabort=null,J.ontimeout=null),j(w)}catch{}}function ho(){this.g=new _r}function zr(f,v,w){const j=w||"";try{au(f,function(J,le){let we=J;p(J)&&(we=Rn(J)),v.push(j+le+"="+encodeURIComponent(we))})}catch(J){throw v.push(j+"type="+encodeURIComponent("_badmap")),J}}function ti(f){this.l=f.Ub||null,this.j=f.eb||!1}C(ti,so),ti.prototype.g=function(){return new pa(this.l,this.j)},ti.prototype.i=(function(f){return function(){return f}})({});function pa(f,v){wt.call(this),this.D=f,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(pa,wt),s=pa.prototype,s.open=function(f,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=v,this.readyState=1,Gr(this)},s.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(v.body=f),(this.D||h).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},s.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Gr(this)),this.g&&(this.readyState=3,Gr(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof h.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cu(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function cu(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}s.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var v=f.value?f.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!f.done}))&&(this.response=this.responseText+=v)}f.done?Hr(this):Gr(this),this.readyState==3&&cu(this)}},s.Ra=function(f){this.g&&(this.response=this.responseText=f,Hr(this))},s.Qa=function(f){this.g&&(this.response=f,Hr(this))},s.ga=function(){this.g&&Hr(this)};function Hr(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Gr(f)}s.setRequestHeader=function(f,v){this.u.append(f,v)},s.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],v=this.h.entries();for(var w=v.next();!w.done;)w=w.value,f.push(w[0]+": "+w[1]),w=v.next();return f.join(`\r
`)};function Gr(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(pa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function uu(f){let v="";return M(f,function(w,j){v+=j,v+=":",v+=w,v+=`\r
`}),v}function Mn(f,v,w){e:{for(j in w){var j=!1;break e}j=!0}j||(w=uu(w),typeof f=="string"?w!=null&&encodeURIComponent(String(w)):Ct(f,v,w))}function bt(f){wt.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(bt,wt);var bl=/^https?$/i,fo=["POST","PUT"];s=bt.prototype,s.Ha=function(f){this.J=f},s.ea=function(f,v,w,j){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);v=v?v.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ms.g(),this.v=this.o?Ur(this.o):Ur(Ms),this.g.onreadystatechange=b(this.Ea,this);try{this.B=!0,this.g.open(v,String(f),!0),this.B=!1}catch(le){mh(this,le);return}if(f=w||"",w=new Map(this.headers),j)if(Object.getPrototypeOf(j)===Object.prototype)for(var J in j)w.set(J,j[J]);else if(typeof j.keys=="function"&&typeof j.get=="function")for(const le of j.keys())w.set(le,j.get(le));else throw Error("Unknown input type for opt_headers: "+String(j));j=Array.from(w.keys()).find(le=>le.toLowerCase()=="content-type"),J=h.FormData&&f instanceof h.FormData,!(0<=Array.prototype.indexOf.call(fo,v,void 0))||j||J||w.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[le,we]of w)this.g.setRequestHeader(le,we);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{mo(this),this.u=!0,this.g.send(f),this.u=!1}catch(le){mh(this,le)}};function mh(f,v){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=v,f.m=5,_l(f),$r(f)}function _l(f){f.A||(f.A=!0,pt(f,"complete"),pt(f,"error"))}s.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,pt(this,"complete"),pt(this,"abort"),$r(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$r(this,!0)),bt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?wl(this):this.bb())},s.bb=function(){wl(this)};function wl(f){if(f.h&&typeof u<"u"&&(!f.v[1]||or(f)!=4||f.Z()!=2)){if(f.u&&or(f)==4)vn(f.Ea,0,f);else if(pt(f,"readystatechange"),or(f)==4){f.h=!1;try{const we=f.Z();e:switch(we){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var w;if(!(w=v)){var j;if(j=we===0){var J=String(f.D).match(io)[1]||null;!J&&h.self&&h.self.location&&(J=h.self.location.protocol.slice(0,-1)),j=!bl.test(J?J.toLowerCase():"")}w=j}if(w)pt(f,"complete"),pt(f,"success");else{f.m=6;try{var le=2<or(f)?f.g.statusText:""}catch{le=""}f.l=le+" ["+f.Z()+"]",_l(f)}}finally{$r(f)}}}}function $r(f,v){if(f.g){mo(f);const w=f.g,j=f.v[0]?()=>{}:null;f.g=null,f.v=null,v||pt(f,"ready");try{w.onreadystatechange=j}catch{}}}function mo(f){f.I&&(h.clearTimeout(f.I),f.I=null)}s.isActive=function(){return!!this.g};function or(f){return f.g?f.g.readyState:0}s.Z=function(){try{return 2<or(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(f){if(this.g){var v=this.g.responseText;return f&&v.indexOf(f)==0&&(v=v.substring(f.length)),Lr(v)}};function gh(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function wg(f){const v={};f=(f.g&&2<=or(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let j=0;j<f.length;j++){if(U(f[j]))continue;var w=I(f[j]);const J=w[0];if(w=w[1],typeof w!="string")continue;w=w.trim();const le=v[J]||[];v[J]=le,le.push(w)}R(v,function(j){return j.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function go(f,v,w){return w&&w.internalChannelParams&&w.internalChannelParams[f]||v}function Tl(f){this.Aa=0,this.i=[],this.j=new Yt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=go("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=go("baseRetryDelayMs",5e3,f),this.cb=go("retryDelaySeedMs",1e4,f),this.Wa=go("forwardChannelMaxRetries",2,f),this.wa=go("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new sr(f&&f.concurrentRequestLimit),this.Da=new ho,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Tl.prototype,s.la=8,s.G=1,s.connect=function(f,v,w,j){Mt(0),this.W=f,this.H=v||{},w&&j!==void 0&&(this.H.OSID=w,this.H.OAID=j),this.F=this.X,this.I=wh(this,null,this.W),Nl(this)};function du(f){if(ph(f),f.G==3){var v=f.U++,w=Vs(f.I);if(Ct(w,"SID",f.K),Ct(w,"RID",v),Ct(w,"TYPE","terminate"),po(f,w),v=new Dn(f,f.j,v),v.L=2,v.v=lo(Vs(w)),w=!1,h.navigator&&h.navigator.sendBeacon)try{w=h.navigator.sendBeacon(v.v.toString(),"")}catch{}!w&&h.Image&&(new Image().src=v.v,w=!0),w||(v.g=Th(v.j,null),v.g.ea(v.v)),v.F=Date.now(),Ot(v)}_h(f)}function El(f){f.g&&(yo(f),f.g.cancel(),f.g=null)}function ph(f){El(f),f.u&&(h.clearTimeout(f.u),f.u=null),Sl(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&h.clearTimeout(f.s),f.s=null)}function Nl(f){if(!gl(f.h)&&!f.s){f.s=!0;var v=f.Ga;oe||D(),Y||(oe(),Y=!0),be.add(v,f),f.B=0}}function Tg(f,v){return pl(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=v.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=nn(b(f.Ga,f,v),mu(f,f.B)),f.B++,!0)}s.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const J=new Dn(this,this.j,f);let le=this.o;if(this.S&&(le?(le=T(le),V(le,this.S)):le=this.S),this.m!==null||this.O||(J.H=le,le=null),this.P)e:{for(var v=0,w=0;w<this.i.length;w++){t:{var j=this.i[w];if("__data__"in j.map&&(j=j.map.__data__,typeof j=="string")){j=j.length;break t}j=void 0}if(j===void 0)break;if(v+=j,4096<v){v=w;break e}if(v===4096||w===this.i.length-1){v=w+1;break e}}v=1e3}else v=1e3;v=yh(this,J,v),w=Vs(this.I),Ct(w,"RID",f),Ct(w,"CVER",22),this.D&&Ct(w,"X-HTTP-Session-Id",this.D),po(this,w),le&&(this.O?v="headers="+encodeURIComponent(String(uu(le)))+"&"+v:this.m&&Mn(w,this.m,le)),yl(this.h,J),this.Ua&&Ct(w,"TYPE","init"),this.P?(Ct(w,"$req",v),Ct(w,"SID","null"),J.T=!0,ye(J,w,null)):ye(J,w,v),this.G=2}}else this.G==3&&(f?hu(this,f):this.i.length==0||gl(this.h)||hu(this))};function hu(f,v){var w;v?w=v.l:w=f.U++;const j=Vs(f.I);Ct(j,"SID",f.K),Ct(j,"RID",w),Ct(j,"AID",f.T),po(f,j),f.m&&f.o&&Mn(j,f.m,f.o),w=new Dn(f,f.j,w,f.B+1),f.m===null&&(w.H=f.o),v&&(f.i=v.D.concat(f.i)),v=yh(f,w,1e3),w.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),yl(f.h,w),ye(w,j,v)}function po(f,v){f.H&&M(f.H,function(w,j){Ct(v,j,w)}),f.l&&au({},function(w,j){Ct(v,j,w)})}function yh(f,v,w){w=Math.min(f.i.length,w);var j=f.l?b(f.l.Na,f.l,f):null;e:{var J=f.i;let le=-1;for(;;){const we=["count="+w];le==-1?0<w?(le=J[0].g,we.push("ofs="+le)):le=0:we.push("ofs="+le);let ut=!0;for(let _n=0;_n<w;_n++){let dt=J[_n].g;const On=J[_n].map;if(dt-=le,0>dt)le=Math.max(0,J[_n].g-100),ut=!1;else try{zr(On,we,"req"+dt+"_")}catch{j&&j(On)}}if(ut){j=we.join("&");break e}}}return f=f.i.splice(0,w),v.D=f,j}function xh(f){if(!f.g&&!f.u){f.Y=1;var v=f.Fa;oe||D(),Y||(oe(),Y=!0),be.add(v,f),f.v=0}}function fu(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=nn(b(f.Fa,f),mu(f,f.v)),f.v++,!0)}s.Fa=function(){if(this.u=null,vh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=nn(b(this.ab,this),f)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mt(10),El(this),vh(this))};function yo(f){f.A!=null&&(h.clearTimeout(f.A),f.A=null)}function vh(f){f.g=new Dn(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var v=Vs(f.qa);Ct(v,"RID","rpc"),Ct(v,"SID",f.K),Ct(v,"AID",f.T),Ct(v,"CI",f.F?"0":"1"),!f.F&&f.ja&&Ct(v,"TO",f.ja),Ct(v,"TYPE","xmlhttp"),po(f,v),f.m&&f.o&&Mn(v,f.m,f.o),f.L&&(f.g.I=f.L);var w=f.g;f=f.ia,w.L=1,w.v=lo(Vs(v)),w.m=null,w.P=!0,je(w,f)}s.Za=function(){this.C!=null&&(this.C=null,El(this),fu(this),Mt(19))};function Sl(f){f.C!=null&&(h.clearTimeout(f.C),f.C=null)}function bh(f,v){var w=null;if(f.g==v){Sl(f),yo(f),f.g=null;var j=2}else if(su(f.h,v))w=v.D,ds(f.h,v),j=1;else return;if(f.G!=0){if(v.o)if(j==1){w=v.m?v.m.length:0,v=Date.now()-v.F;var J=f.B;j=us(),pt(j,new tn(j,w)),Nl(f)}else xh(f);else if(J=v.s,J==3||J==0&&0<v.X||!(j==1&&Tg(f,v)||j==2&&fu(f)))switch(w&&0<w.length&&(v=f.h,v.i=v.i.concat(w)),J){case 1:ya(f,5);break;case 4:ya(f,10);break;case 3:ya(f,6);break;default:ya(f,2)}}}function mu(f,v){let w=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(w*=2),w*v}function ya(f,v){if(f.j.info("Error code "+v),v==2){var w=b(f.fb,f),j=f.Xa;const J=!j;j=new fn(j||"//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||oo(j,"https"),lo(j),J?uo(j.toString(),w):Nr(j.toString(),w)}else Mt(2);f.G=0,f.l&&f.l.sa(v),_h(f),ph(f)}s.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Mt(2)):(this.j.info("Failed to ping google.com"),Mt(1))};function _h(f){if(f.G=0,f.ka=[],f.l){const v=ru(f.h);(v.length!=0||f.i.length!=0)&&(L(f.ka,v),L(f.ka,f.i),f.h.i.length=0,k(f.i),f.i.length=0),f.l.ra()}}function wh(f,v,w){var j=w instanceof fn?Vs(w):new fn(w);if(j.g!="")v&&(j.g=v+"."+j.g),ei(j,j.s);else{var J=h.location;j=J.protocol,v=v?v+"."+J.hostname:J.hostname,J=+J.port;var le=new fn(null);j&&oo(le,j),v&&(le.g=v),J&&ei(le,J),w&&(le.l=w),j=le}return w=f.D,v=f.ya,w&&v&&Ct(j,w,v),Ct(j,"VER",f.la),po(f,j),j}function Th(f,v,w){if(v&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return v=f.Ca&&!f.pa?new bt(new ti({eb:w})):new bt(f.pa),v.Ha(f.J),v}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Eh(){}s=Eh.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Al(){}Al.prototype.g=function(f,v){return new hs(f,v)};function hs(f,v){wt.call(this),this.g=new Tl(v),this.l=f,this.h=v&&v.messageUrlParams||null,f=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(f?f["X-WebChannel-Content-Type"]=v.messageContentType:f={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(f?f["X-WebChannel-Client-Profile"]=v.va:f={"X-WebChannel-Client-Profile":v.va}),this.g.S=f,(f=v&&v.Sb)&&!U(f)&&(this.g.m=f),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!U(v)&&(this.g.D=v,f=this.h,f!==null&&v in f&&(f=this.h,v in f&&delete f[v])),this.j=new Kr(this)}C(hs,wt),hs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hs.prototype.close=function(){du(this.g)},hs.prototype.o=function(f){var v=this.g;if(typeof f=="string"){var w={};w.__data__=f,f=w}else this.u&&(w={},w.__data__=Rn(f),f=w);v.i.push(new ao(v.Ya++,f)),v.G==3&&Nl(v)},hs.prototype.N=function(){this.g.l=null,delete this.j,du(this.g),delete this.g,hs.aa.N.call(this)};function Nh(f){cs.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var v=f.__sm__;if(v){e:{for(const w in v){f=w;break e}f=void 0}(this.i=f)&&(f=this.i,v=v!==null&&f in v?v[f]:void 0),this.data=v}else this.data=f}C(Nh,cs);function Sh(){ro.call(this),this.status=1}C(Sh,ro);function Kr(f){this.g=f}C(Kr,Eh),Kr.prototype.ua=function(){pt(this.g,"a")},Kr.prototype.ta=function(f){pt(this.g,new Nh(f))},Kr.prototype.sa=function(f){pt(this.g,new Sh)},Kr.prototype.ra=function(){pt(this.g,"b")},Al.prototype.createWebChannel=Al.prototype.g,hs.prototype.send=hs.prototype.o,hs.prototype.open=hs.prototype.m,hs.prototype.close=hs.prototype.close,tS=function(){return new Al},eS=function(){return us()},ZN=er,Zy={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},kn.NO_ERROR=0,kn.TIMEOUT=8,kn.HTTP_ERROR=6,Gf=kn,nr.COMPLETE="complete",JN=nr,Fr.EventType=wr,wr.OPEN="a",wr.CLOSE="b",wr.ERROR="c",wr.MESSAGE="d",wt.prototype.listen=wt.prototype.K,fd=Fr,bt.prototype.listenOnce=bt.prototype.L,bt.prototype.getLastError=bt.prototype.Ka,bt.prototype.getLastErrorCode=bt.prototype.Ba,bt.prototype.getStatus=bt.prototype.Z,bt.prototype.getResponseJson=bt.prototype.Oa,bt.prototype.getResponseText=bt.prototype.oa,bt.prototype.send=bt.prototype.ea,bt.prototype.setWithCredentials=bt.prototype.Ha,WN=bt}).apply(typeof If<"u"?If:typeof self<"u"?self:typeof window<"u"?window:{});const nT="@firebase/firestore",sT="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}qn.UNAUTHENTICATED=new qn(null),qn.GOOGLE_CREDENTIALS=new qn("google-credentials-uid"),qn.FIRST_PARTY=new qn("first-party-uid"),qn.MOCK_USER=new qn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi=new Vm("@firebase/firestore");function uc(){return Bi.logLevel}function Bk(s){Bi.setLogLevel(s)}function ge(s,...e){if(Bi.logLevel<=it.DEBUG){const t=e.map(Kx);Bi.debug(`Firestore (${Gc}): ${s}`,...t)}}function dn(s,...e){if(Bi.logLevel<=it.ERROR){const t=e.map(Kx);Bi.error(`Firestore (${Gc}): ${s}`,...t)}}function Xs(s,...e){if(Bi.logLevel<=it.WARN){const t=e.map(Kx);Bi.warn(`Firestore (${Gc}): ${s}`,...t)}}function Kx(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(s,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,nS(s,n,t)}function nS(s,e,t){let n=`FIRESTORE (${Gc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${s.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw dn(n),new Error(n)}function ke(s,e,t,n){let a="Unexpected state";typeof t=="string"?a=t:n=t,s||nS(e,a,n)}function qk(s,e){s||Ae(57014,e)}function Ee(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends vr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(qn.UNAUTHENTICATED)))}shutdown(){}}class zk{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Hk{constructor(e){this.t=e,this.currentUser=qn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ke(this.o===void 0,42304);let n=this.i;const a=m=>this.i!==n?(n=this.i,t(m)):Promise.resolve();let l=new zn;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new zn,e.enqueueRetryable((()=>a(this.currentUser)))};const u=()=>{const m=l;e.enqueueRetryable((async()=>{await m.promise,await a(this.currentUser)}))},h=m=>{ge("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((m=>h(m))),setTimeout((()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?h(m):(ge("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new zn)}}),0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(ge("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ke(typeof n.accessToken=="string",31837,{l:n}),new sS(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ke(e===null||typeof e=="string",2055,{h:e}),new qn(e)}}class Gk{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=qn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class $k{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Gk(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(qn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ex{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Kk{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ks(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ke(this.o===void 0,3512);const n=l=>{l.error!=null&&ge("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.m;return this.m=l.token,ge("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>n(l)))};const a=l=>{ge("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>a(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):ge("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ex(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ke(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ex(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class Qk{getToken(){return Promise.resolve(new ex(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yk(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const a=Yk(40);for(let l=0;l<a.length;++l)n.length<20&&a[l]<t&&(n+=e.charAt(a[l]%62))}return n}}function qe(s,e){return s<e?-1:s>e?1:0}function tx(s,e){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++){const a=s.charAt(n),l=e.charAt(n);if(a!==l)return Ay(a)===Ay(l)?qe(a,l):Ay(a)?1:-1}return qe(s.length,e.length)}const Xk=55296,Wk=57343;function Ay(s){const e=s.charCodeAt(0);return e>=Xk&&e<=Wk}function bc(s,e,t){return s.length===e.length&&s.every(((n,a)=>t(n,e[a])))}function aS(s){return s+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx="__name__";class ea{constructor(e,t,n){t===void 0?t=0:t>e.length&&Ae(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Ae(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ea.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ea?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const l=ea.compareSegments(e.get(a),t.get(a));if(l!==0)return l}return qe(e.length,t.length)}static compareSegments(e,t){const n=ea.isNumericId(e),a=ea.isNumericId(t);return n&&!a?-1:!n&&a?1:n&&a?ea.extractNumericId(e).compare(ea.extractNumericId(t)):tx(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ui.fromString(e.substring(4,e.length-2))}}class tt extends ea{construct(e,t,n){return new tt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new he(ne.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((a=>a.length>0)))}return new tt(t)}static emptyPath(){return new tt([])}}const Jk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bt extends ea{construct(e,t,n){return new Bt(e,t,n)}static isValidIdentifier(e){return Jk.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===nx}static keyField(){return new Bt([nx])}static fromServerFormat(e){const t=[];let n="",a=0;const l=()=>{if(n.length===0)throw new he(ne.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let u=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new he(ne.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[a+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new he(ne.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=m,a+=2}else h==="`"?(u=!u,a++):h!=="."||u?(n+=h,a++):(l(),a++)}if(l(),u)throw new he(ne.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bt(t)}static emptyPath(){return new Bt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.path=e}static fromPath(e){return new Te(tt.fromString(e))}static fromName(e){return new Te(tt.fromString(e).popFirst(5))}static empty(){return new Te(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return tt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Te(new tt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qx(s,e,t){if(!t)throw new he(ne.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function iS(s,e,t,n){if(e===!0&&n===!0)throw new he(ne.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function rT(s){if(!Te.isDocumentKey(s))throw new he(ne.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function aT(s){if(Te.isDocumentKey(s))throw new he(ne.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function oS(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}function zm(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":Ae(12329,{type:typeof s})}function nt(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new he(ne.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=zm(s);throw new he(ne.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}function lS(s,e){if(e<=0)throw new he(ne.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(s,e){const t={typeString:s};return e&&(t.value=e),t}function ll(s,e){if(!oS(s))throw new he(ne.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const a=e[n].typeString,l="value"in e[n]?{value:e[n].value}:void 0;if(!(n in s)){t=`JSON missing required field: '${n}'`;break}const u=s[n];if(a&&typeof u!==a){t=`JSON field '${n}' must be a ${a}.`;break}if(l!==void 0&&u!==l.value){t=`Expected '${n}' field to equal '${l.value}'`;break}}if(t)throw new he(ne.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT=-62135596800,oT=1e6;class _t{static now(){return _t.fromMillis(Date.now())}static fromDate(e){return _t.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*oT);return new _t(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<iT)throw new he(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oT}_compareTo(e){return this.seconds===e.seconds?qe(this.nanoseconds,e.nanoseconds):qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:_t._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ll(e,_t._jsonSchema))return new _t(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-iT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}_t._jsonSchemaVersion="firestore/timestamp/1.0",_t._jsonSchema={type:xn("string",_t._jsonSchemaVersion),seconds:xn("number"),nanoseconds:xn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{static fromTimestamp(e){return new Me(e)}static min(){return new Me(new _t(0,0))}static max(){return new Me(new _t(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _c=-1;class wc{constructor(e,t,n,a){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=a}}function sx(s){return s.fields.find((e=>e.kind===2))}function Mo(s){return s.fields.filter((e=>e.kind!==2))}function Zk(s,e){let t=qe(s.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let n=0;n<Math.min(s.fields.length,e.fields.length);++n)if(t=eD(s.fields[n],e.fields[n]),t!==0)return t;return qe(s.fields.length,e.fields.length)}wc.UNKNOWN_ID=-1;class Ho{constructor(e,t){this.fieldPath=e,this.kind=t}}function eD(s,e){const t=Bt.comparator(s.fieldPath,e.fieldPath);return t!==0?t:qe(s.kind,e.kind)}class Tc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Tc(0,Ws.min())}}function cS(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,a=Me.fromTimestamp(n===1e9?new _t(t+1,0):new _t(t,n));return new Ws(a,Te.empty(),e)}function uS(s){return new Ws(s.readTime,s.key,_c)}class Ws{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ws(Me.min(),Te.empty(),_c)}static max(){return new Ws(Me.max(),Te.empty(),_c)}}function Yx(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=Te.comparator(s.documentKey,e.documentKey),t!==0?t:qe(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yi(s){if(s.code!==ne.FAILED_PRECONDITION||s.message!==dS)throw s;ge("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ae(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new W(((n,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(n,a)},this.catchCallback=l=>{this.wrapFailure(t,l).next(n,a)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof W?t:W.resolve(t)}catch(t){return W.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):W.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):W.reject(t)}static resolve(e){return new W(((t,n)=>{t(e)}))}static reject(e){return new W(((t,n)=>{n(e)}))}static waitFor(e){return new W(((t,n)=>{let a=0,l=0,u=!1;e.forEach((h=>{++a,h.next((()=>{++l,u&&l===a&&t()}),(m=>n(m)))})),u=!0,l===a&&t()}))}static or(e){let t=W.resolve(!1);for(const n of e)t=t.next((a=>a?W.resolve(a):n()));return t}static forEach(e,t){const n=[];return e.forEach(((a,l)=>{n.push(t.call(this,a,l))})),this.waitFor(n)}static mapArray(e,t){return new W(((n,a)=>{const l=e.length,u=new Array(l);let h=0;for(let m=0;m<l;m++){const p=m;t(e[p]).next((x=>{u[p]=x,++h,h===l&&n(u)}),(x=>a(x)))}}))}static doWhile(e,t){return new W(((n,a)=>{const l=()=>{e()===!0?t().next((()=>{l()}),a):n()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs="SimpleDb";class Hm{static open(e,t,n,a){try{return new Hm(t,e.transaction(a,n))}catch(l){throw new bd(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new zn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new bd(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const a=Xx(n.target.error);this.S.reject(new bd(e,a))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ge(Gs,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new nD(t)}}class oa{static delete(e){return ge(Gs,"Removing database:",e),Vo(eN().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Mx())return!1;if(oa.F())return!0;const e=An(),t=oa.M(e),n=0<t&&t<10,a=fS(e),l=0<a&&a<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||l)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,oa.M(An())===12.2&&dn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ge(Gs,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const a=indexedDB.open(this.name,this.version);a.onsuccess=l=>{const u=l.target.result;t(u)},a.onblocked=()=>{n(new bd(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=l=>{const u=l.target.error;u.name==="VersionError"?n(new he(ne.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):u.name==="InvalidStateError"?n(new he(ne.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u)):n(new bd(e,u))},a.onupgradeneeded=l=>{ge(Gs,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const u=l.target.result;this.N.k(u,a.transaction,l.oldVersion,this.version).next((()=>{ge(Gs,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,a){const l=t==="readonly";let u=0;for(;;){++u;try{this.db=await this.L(e);const h=Hm.open(this.db,e,l?"readonly":"readwrite",n),m=a(h).next((p=>(h.C(),p))).catch((p=>(h.abort(p),W.reject(p)))).toPromise();return m.catch((()=>{})),await h.D,m}catch(h){const m=h,p=m.name!=="FirebaseError"&&u<3;if(ge(Gs,"Transaction failed with error:",m.message,"Retrying:",p),this.close(),!p)return Promise.reject(m)}}}close(){this.db&&this.db.close(),this.db=void 0}}function fS(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class tD{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Vo(this.U.delete())}}class bd extends he{constructor(e,t){super(ne.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Xi(s){return s.name==="IndexedDbTransactionError"}class nD{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(ge(Gs,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(ge(Gs,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Vo(n)}add(e){return ge(Gs,"ADD",this.store.name,e,e),Vo(this.store.add(e))}get(e){return Vo(this.store.get(e)).next((t=>(t===void 0&&(t=null),ge(Gs,"GET",this.store.name,e,t),t)))}delete(e){return ge(Gs,"DELETE",this.store.name,e),Vo(this.store.delete(e))}count(){return ge(Gs,"COUNT",this.store.name),Vo(this.store.count())}J(e,t){const n=this.options(e,t),a=n.index?this.store.index(n.index):this.store;if(typeof a.getAll=="function"){const l=a.getAll(n.range);return new W(((u,h)=>{l.onerror=m=>{h(m.target.error)},l.onsuccess=m=>{u(m.target.result)}}))}{const l=this.cursor(n),u=[];return this.H(l,((h,m)=>{u.push(m)})).next((()=>u))}}Y(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new W(((a,l)=>{n.onerror=u=>{l(u.target.error)},n.onsuccess=u=>{a(u.target.result)}}))}Z(e,t){ge(Gs,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const a=this.cursor(n);return this.H(a,((l,u,h)=>h.delete()))}ee(e,t){let n;t?n=e:(n={},t=e);const a=this.cursor(n);return this.H(a,t)}te(e){const t=this.cursor({});return new W(((n,a)=>{t.onerror=l=>{const u=Xx(l.target.error);a(u)},t.onsuccess=l=>{const u=l.target.result;u?e(u.primaryKey,u.value).next((h=>{h?u.continue():n()})):n()}}))}H(e,t){const n=[];return new W(((a,l)=>{e.onerror=u=>{l(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void a();const m=new tD(h),p=t(h.primaryKey,h.value,m);if(p instanceof W){const x=p.catch((_=>(m.done(),W.reject(_))));n.push(x)}m.isDone?a():m.G===null?h.continue():h.continue(m.G)}})).next((()=>W.waitFor(n)))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Vo(s){return new W(((e,t)=>{s.onsuccess=n=>{const a=n.target.result;e(a)},s.onerror=n=>{const a=Xx(n.target.error);t(a)}}))}let lT=!1;function Xx(s){const e=oa.M(An());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(s.message.indexOf(t)>=0){const n=new he("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return lT||(lT=!0,setTimeout((()=>{throw n}),0)),n}}return s}const _d="IndexBackfiller";class sD{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){ge(_d,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();ge(_d,`Documents written: ${t}`)}catch(t){Xi(t)?ge(_d,"Ignoring IndexedDB error during index backfill: ",t):await Yi(t)}await this.re(6e4)}))}}class rD{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const n=new Set;let a=t,l=!0;return W.doWhile((()=>l===!0&&a>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((u=>{if(u!==null&&!n.has(u))return ge(_d,`Processing collection: ${u}`),this.oe(e,u,a).next((h=>{a-=h,n.add(u)}));l=!1})))).next((()=>t-a))}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((a=>this.localStore.localDocuments.getNextDocuments(e,t,a,n).next((l=>{const u=l.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next((()=>this._e(a,l))).next((h=>(ge(_d,`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h)))).next((()=>u.size))}))))}_e(e,t){let n=e;return t.changes.forEach(((a,l)=>{const u=uS(l);Yx(u,n)>0&&(n=u)})),new Ws(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ws.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fi=-1;function Wd(s){return s==null}function Dd(s){return s===0&&1/s==-1/0}function mS(s){return typeof s=="number"&&Number.isInteger(s)&&!Dd(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm="";function os(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=cT(e)),e=aD(s.get(t),e);return cT(e)}function aD(s,e){let t=e;const n=s.length;for(let a=0;a<n;a++){const l=s.charAt(a);switch(l){case"\0":t+="";break;case mm:t+="";break;default:t+=l}}return t}function cT(s){return s+mm+""}function ra(s){const e=s.length;if(ke(e>=2,64408,{path:s}),e===2)return ke(s.charAt(0)===mm&&s.charAt(1)==="",56145,{path:s}),tt.emptyPath();const t=e-2,n=[];let a="";for(let l=0;l<e;){const u=s.indexOf(mm,l);switch((u<0||u>t)&&Ae(50515,{path:s}),s.charAt(u+1)){case"":const h=s.substring(l,u);let m;a.length===0?m=h:(a+=h,m=a,a=""),n.push(m);break;case"":a+=s.substring(l,u),a+="\0";break;case"":a+=s.substring(l,u+1);break;default:Ae(61167,{path:s})}l=u+2}return new tt(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo="remoteDocuments",Jd="owner",nc="owner",Pd="mutationQueues",iD="userId",Rr="mutations",uT="batchId",qo="userMutationsIndex",dT=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $f(s,e){return[s,os(e)]}function gS(s,e,t){return[s,os(e),t]}const oD={},Ec="documentMutations",gm="remoteDocumentsV14",lD=["prefixPath","collectionGroup","readTime","documentId"],Kf="documentKeyIndex",cD=["prefixPath","collectionGroup","documentId"],pS="collectionGroupIndex",uD=["collectionGroup","readTime","prefixPath","documentId"],Md="remoteDocumentGlobal",rx="remoteDocumentGlobalKey",Nc="targets",yS="queryTargetsIndex",dD=["canonicalId","targetId"],Sc="targetDocuments",hD=["targetId","path"],Wx="documentTargetsIndex",fD=["path","targetId"],pm="targetGlobalKey",Go="targetGlobal",Od="collectionParents",mD=["collectionId","parent"],Ac="clientMetadata",gD="clientId",Gm="bundles",pD="bundleId",$m="namedQueries",yD="name",Jx="indexConfiguration",xD="indexId",ax="collectionGroupIndex",vD="collectionGroup",wd="indexState",bD=["indexId","uid"],xS="sequenceNumberIndex",_D=["uid","sequenceNumber"],Td="indexEntries",wD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vS="documentKeyIndex",TD=["indexId","uid","orderedDocumentKey"],Km="documentOverlays",ED=["userId","collectionPath","documentId"],ix="collectionPathOverlayIndex",ND=["userId","collectionPath","largestBatchId"],bS="collectionGroupOverlayIndex",SD=["userId","collectionGroup","largestBatchId"],Zx="globals",AD="name",_S=[Pd,Rr,Ec,Oo,Nc,Jd,Go,Sc,Ac,Md,Od,Gm,$m],jD=[..._S,Km],wS=[Pd,Rr,Ec,gm,Nc,Jd,Go,Sc,Ac,Md,Od,Gm,$m,Km],TS=wS,ev=[...TS,Jx,wd,Td],ID=ev,ES=[...ev,Zx],CD=ES;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox extends hS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function In(s,e){const t=Ee(s);return oa.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function Wi(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function NS(s,e){const t=[];for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.push(e(s[n],n,s));return t}function SS(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t){this.comparator=e,this.root=t||Wn.EMPTY}insert(e,t){return new Ut(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wn.BLACK,null,null))}remove(e){return new Ut(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cf(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cf(this.root,e,this.comparator,!0)}}class Cf{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?n(e.key,t):1,t&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wn{constructor(e,t,n,a,l){this.key=e,this.value=t,this.color=n??Wn.RED,this.left=a??Wn.EMPTY,this.right=l??Wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,l){return new Wn(e??this.key,t??this.value,n??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const l=n(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,t,n),null):l===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Wn.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ae(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ae(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ae(27949);return e+(this.isRed()?0:1)}}Wn.EMPTY=null,Wn.RED=!0,Wn.BLACK=!1;Wn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ae(57766)}get value(){throw Ae(16141)}get color(){throw Ae(16727)}get left(){throw Ae(29726)}get right(){throw Ae(36894)}copy(e,t,n,a,l){return this}insert(e,t,n){return new Wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new Ut(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fT(this.data.getIterator())}getIteratorFrom(e){return new fT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=n.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new jt(this.comparator);return t.data=e,t}}class fT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sc(s){return s.hasNext()?s.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e){this.fields=e,e.sort(Bt.comparator)}static empty(){return new Ts([])}unionWith(e){let t=new jt(Bt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ts(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return bc(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new AS("Invalid base64 string: "+l):l}})(e);return new en(t)}static fromUint8Array(e){const t=(function(a){let l="";for(let u=0;u<a.length;++u)l+=String.fromCharCode(a[u]);return l})(e);return new en(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}en.EMPTY_BYTE_STRING=new en("");const kD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function za(s){if(ke(!!s,39018),typeof s=="string"){let e=0;const t=kD.exec(s);if(ke(!!t,46558,{timestamp:s}),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Gt(s.seconds),nanos:Gt(s.nanos)}}function Gt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Ha(s){return typeof s=="string"?en.fromBase64String(s):en.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jS="server_timestamp",IS="__type__",CS="__previous_value__",RS="__local_write_time__";function Qm(s){return(s?.mapValue?.fields||{})[IS]?.stringValue===jS}function Ym(s){const e=s.mapValue.fields[CS];return Qm(e)?Ym(e):e}function Vd(s){const e=za(s.mapValue.fields[RS].timestampValue);return new _t(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(e,t,n,a,l,u,h,m,p,x){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=m,this.useFetchStreams=p,this.isUsingEmulator=x}}const Ld="(default)";class qi{constructor(e,t){this.projectId=e,this.database=t||Ld}static empty(){return new qi("","")}get isDefaultDatabase(){return this.database===Ld}isEqual(e){return e instanceof qi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tv="__type__",kS="__max__",Di={mapValue:{fields:{__type__:{stringValue:kS}}}},nv="__vector__",jc="value",Qf={nullValue:"NULL_VALUE"};function zi(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?Qm(s)?4:DS(s)?9007199254740991:Xm(s)?10:11:Ae(28295,{value:s})}function ua(s,e){if(s===e)return!0;const t=zi(s);if(t!==zi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return Vd(s).isEqual(Vd(e));case 3:return(function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const u=za(a.timestampValue),h=za(l.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(s,e);case 5:return s.stringValue===e.stringValue;case 6:return(function(a,l){return Ha(a.bytesValue).isEqual(Ha(l.bytesValue))})(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return(function(a,l){return Gt(a.geoPointValue.latitude)===Gt(l.geoPointValue.latitude)&&Gt(a.geoPointValue.longitude)===Gt(l.geoPointValue.longitude)})(s,e);case 2:return(function(a,l){if("integerValue"in a&&"integerValue"in l)return Gt(a.integerValue)===Gt(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const u=Gt(a.doubleValue),h=Gt(l.doubleValue);return u===h?Dd(u)===Dd(h):isNaN(u)&&isNaN(h)}return!1})(s,e);case 9:return bc(s.arrayValue.values||[],e.arrayValue.values||[],ua);case 10:case 11:return(function(a,l){const u=a.mapValue.fields||{},h=l.mapValue.fields||{};if(hT(u)!==hT(h))return!1;for(const m in u)if(u.hasOwnProperty(m)&&(h[m]===void 0||!ua(u[m],h[m])))return!1;return!0})(s,e);default:return Ae(52216,{left:s})}}function Ud(s,e){return(s.values||[]).find((t=>ua(t,e)))!==void 0}function Hi(s,e){if(s===e)return 0;const t=zi(s),n=zi(e);if(t!==n)return qe(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return qe(s.booleanValue,e.booleanValue);case 2:return(function(l,u){const h=Gt(l.integerValue||l.doubleValue),m=Gt(u.integerValue||u.doubleValue);return h<m?-1:h>m?1:h===m?0:isNaN(h)?isNaN(m)?0:-1:1})(s,e);case 3:return mT(s.timestampValue,e.timestampValue);case 4:return mT(Vd(s),Vd(e));case 5:return tx(s.stringValue,e.stringValue);case 6:return(function(l,u){const h=Ha(l),m=Ha(u);return h.compareTo(m)})(s.bytesValue,e.bytesValue);case 7:return(function(l,u){const h=l.split("/"),m=u.split("/");for(let p=0;p<h.length&&p<m.length;p++){const x=qe(h[p],m[p]);if(x!==0)return x}return qe(h.length,m.length)})(s.referenceValue,e.referenceValue);case 8:return(function(l,u){const h=qe(Gt(l.latitude),Gt(u.latitude));return h!==0?h:qe(Gt(l.longitude),Gt(u.longitude))})(s.geoPointValue,e.geoPointValue);case 9:return gT(s.arrayValue,e.arrayValue);case 10:return(function(l,u){const h=l.fields||{},m=u.fields||{},p=h[jc]?.arrayValue,x=m[jc]?.arrayValue,_=qe(p?.values?.length||0,x?.values?.length||0);return _!==0?_:gT(p,x)})(s.mapValue,e.mapValue);case 11:return(function(l,u){if(l===Di.mapValue&&u===Di.mapValue)return 0;if(l===Di.mapValue)return 1;if(u===Di.mapValue)return-1;const h=l.fields||{},m=Object.keys(h),p=u.fields||{},x=Object.keys(p);m.sort(),x.sort();for(let _=0;_<m.length&&_<x.length;++_){const b=tx(m[_],x[_]);if(b!==0)return b;const N=Hi(h[m[_]],p[x[_]]);if(N!==0)return N}return qe(m.length,x.length)})(s.mapValue,e.mapValue);default:throw Ae(23264,{he:t})}}function mT(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return qe(s,e);const t=za(s),n=za(e),a=qe(t.seconds,n.seconds);return a!==0?a:qe(t.nanos,n.nanos)}function gT(s,e){const t=s.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const l=Hi(t[a],n[a]);if(l)return l}return qe(t.length,n.length)}function Ic(s){return lx(s)}function lx(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?(function(t){const n=za(t);return`time(${n.seconds},${n.nanos})`})(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?(function(t){return Ha(t).toBase64()})(s.bytesValue):"referenceValue"in s?(function(t){return Te.fromName(t).toString()})(s.referenceValue):"geoPointValue"in s?(function(t){return`geo(${t.latitude},${t.longitude})`})(s.geoPointValue):"arrayValue"in s?(function(t){let n="[",a=!0;for(const l of t.values||[])a?a=!1:n+=",",n+=lx(l);return n+"]"})(s.arrayValue):"mapValue"in s?(function(t){const n=Object.keys(t.fields||{}).sort();let a="{",l=!0;for(const u of n)l?l=!1:a+=",",a+=`${u}:${lx(t.fields[u])}`;return a+"}"})(s.mapValue):Ae(61005,{value:s})}function Yf(s){switch(zi(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ym(s);return e?16+Yf(e):16;case 5:return 2*s.stringValue.length;case 6:return Ha(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((a,l)=>a+Yf(l)),0)})(s.arrayValue);case 10:case 11:return(function(n){let a=0;return Wi(n.fields,((l,u)=>{a+=l.length+Yf(u)})),a})(s.mapValue);default:throw Ae(13486,{value:s})}}function Xo(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function cx(s){return!!s&&"integerValue"in s}function Fd(s){return!!s&&"arrayValue"in s}function pT(s){return!!s&&"nullValue"in s}function yT(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function Xf(s){return!!s&&"mapValue"in s}function Xm(s){return(s?.mapValue?.fields||{})[tv]?.stringValue===nv}function Ed(s){if(s.geoPointValue)return{geoPointValue:{...s.geoPointValue}};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:{...s.timestampValue}};if(s.mapValue){const e={mapValue:{fields:{}}};return Wi(s.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ed(n))),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ed(s.arrayValue.values[t]);return e}return{...s}}function DS(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===kS}const PS={mapValue:{fields:{[tv]:{stringValue:nv},[jc]:{arrayValue:{}}}}};function PD(s){return"nullValue"in s?Qf:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?Xo(qi.empty(),Te.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?Xm(s)?PS:{mapValue:{}}:Ae(35942,{value:s})}function MD(s){return"nullValue"in s?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?Xo(qi.empty(),Te.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?PS:"mapValue"in s?Xm(s)?{mapValue:{}}:Di:Ae(61959,{value:s})}function xT(s,e){const t=Hi(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?-1:!s.inclusive&&e.inclusive?1:0}function vT(s,e){const t=Hi(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?1:!s.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.value=e}static empty(){return new Jn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Xf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ed(t)}setAll(e){let t=Bt.emptyPath(),n={},a=[];e.forEach(((u,h)=>{if(!t.isImmediateParentOf(h)){const m=this.getFieldsMap(t);this.applyChanges(m,n,a),n={},a=[],t=h.popLast()}u?n[h.lastSegment()]=Ed(u):a.push(h.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,n,a)}delete(e){const t=this.field(e.popLast());Xf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ua(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];Xf(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){Wi(t,((a,l)=>e[a]=l));for(const a of n)delete e[a]}clone(){return new Jn(Ed(this.value))}}function MS(s){const e=[];return Wi(s.fields,((t,n)=>{const a=new Bt([t]);if(Xf(n)){const l=MS(n.mapValue).fields;if(l.length===0)e.push(a);else for(const u of l)e.push(a.child(u))}else e.push(a)})),new Ts(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,t,n,a,l,u,h){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=l,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Ft(e,0,Me.min(),Me.min(),Me.min(),Jn.empty(),0)}static newFoundDocument(e,t,n,a){return new Ft(e,1,t,Me.min(),n,a,0)}static newNoDocument(e,t){return new Ft(e,2,t,Me.min(),Me.min(),Jn.empty(),0)}static newUnknownDocument(e,t){return new Ft(e,3,t,Me.min(),Me.min(),Jn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Jn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Jn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ft&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ft(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,t){this.position=e,this.inclusive=t}}function bT(s,e,t){let n=0;for(let a=0;a<s.position.length;a++){const l=e[a],u=s.position[a];if(l.field.isKeyField()?n=Te.comparator(Te.fromName(u.referenceValue),t.key):n=Hi(u,t.data.field(l.field)),l.dir==="desc"&&(n*=-1),n!==0)break}return n}function _T(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!ua(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,t="asc"){this.field=e,this.dir=t}}function OD(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OS{}class ot extends OS{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new VD(e,t,n):t==="array-contains"?new FD(e,n):t==="in"?new qS(e,n):t==="not-in"?new BD(e,n):t==="array-contains-any"?new qD(e,n):new ot(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new LD(e,n):new UD(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Hi(t,this.value)):t!==null&&zi(this.value)===zi(t)&&this.matchesComparison(Hi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ae(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class St extends OS{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new St(e,t)}matches(e){return Cc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Cc(s){return s.op==="and"}function ux(s){return s.op==="or"}function sv(s){return VS(s)&&Cc(s)}function VS(s){for(const e of s.filters)if(e instanceof St)return!1;return!0}function dx(s){if(s instanceof ot)return s.field.canonicalString()+s.op.toString()+Ic(s.value);if(sv(s))return s.filters.map((e=>dx(e))).join(",");{const e=s.filters.map((t=>dx(t))).join(",");return`${s.op}(${e})`}}function LS(s,e){return s instanceof ot?(function(n,a){return a instanceof ot&&n.op===a.op&&n.field.isEqual(a.field)&&ua(n.value,a.value)})(s,e):s instanceof St?(function(n,a){return a instanceof St&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce(((l,u,h)=>l&&LS(u,a.filters[h])),!0):!1})(s,e):void Ae(19439)}function US(s,e){const t=s.filters.concat(e);return St.create(t,s.op)}function FS(s){return s instanceof ot?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ic(t.value)}`})(s):s instanceof St?(function(t){return t.op.toString()+" {"+t.getFilters().map(FS).join(" ,")+"}"})(s):"Filter"}class VD extends ot{constructor(e,t,n){super(e,t,n),this.key=Te.fromName(n.referenceValue)}matches(e){const t=Te.comparator(e.key,this.key);return this.matchesComparison(t)}}class LD extends ot{constructor(e,t){super(e,"in",t),this.keys=BS("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class UD extends ot{constructor(e,t){super(e,"not-in",t),this.keys=BS("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function BS(s,e){return(e.arrayValue?.values||[]).map((t=>Te.fromName(t.referenceValue)))}class FD extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Fd(t)&&Ud(t.arrayValue,this.value)}}class qS extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ud(this.value.arrayValue,t)}}class BD extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ud(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ud(this.value.arrayValue,t)}}class qD extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Fd(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>Ud(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e,t=null,n=[],a=[],l=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=l,this.startAt=u,this.endAt=h,this.Te=null}}function hx(s,e=null,t=[],n=[],a=null,l=null,u=null){return new zD(s,e,t,n,a,l,u)}function Wo(s){const e=Ee(s);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>dx(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(l){return l.field.canonicalString()+l.dir})(n))).join(","),Wd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>Ic(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>Ic(n))).join(",")),e.Te=t}return e.Te}function Zd(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!OD(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!LS(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!_T(s.startAt,e.startAt)&&_T(s.endAt,e.endAt)}function ym(s){return Te.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}function xm(s,e){return s.filters.filter((t=>t instanceof ot&&t.field.isEqual(e)))}function wT(s,e,t){let n=Qf,a=!0;for(const l of xm(s,e)){let u=Qf,h=!0;switch(l.op){case"<":case"<=":u=PD(l.value);break;case"==":case"in":case">=":u=l.value;break;case">":u=l.value,h=!1;break;case"!=":case"not-in":u=Qf}xT({value:n,inclusive:a},{value:u,inclusive:h})<0&&(n=u,a=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];xT({value:n,inclusive:a},{value:u,inclusive:t.inclusive})<0&&(n=u,a=t.inclusive);break}}return{value:n,inclusive:a}}function TT(s,e,t){let n=Di,a=!0;for(const l of xm(s,e)){let u=Di,h=!0;switch(l.op){case">=":case">":u=MD(l.value),h=!1;break;case"==":case"in":case"<=":u=l.value;break;case"<":u=l.value,h=!1;break;case"!=":case"not-in":u=Di}vT({value:n,inclusive:a},{value:u,inclusive:h})>0&&(n=u,a=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];vT({value:n,inclusive:a},{value:u,inclusive:t.inclusive})>0&&(n=u,a=t.inclusive);break}}return{value:n,inclusive:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e,t=null,n=[],a=[],l=null,u="F",h=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=l,this.limitType=u,this.startAt=h,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function zS(s,e,t,n,a,l,u,h){return new $a(s,e,t,n,a,l,u,h)}function $c(s){return new $a(s)}function ET(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function rv(s){return s.collectionGroup!==null}function yc(s){const e=Ee(s);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new jt(Bt.comparator);return u.filters.forEach((m=>{m.getFlattenedFilters().forEach((p=>{p.isInequality()&&(h=h.add(p.field))}))})),h})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new Bd(l,n))})),t.has(Bt.keyField().canonicalString())||e.Ie.push(new Bd(Bt.keyField(),n))}return e.Ie}function ls(s){const e=Ee(s);return e.Ee||(e.Ee=GS(e,yc(s))),e.Ee}function HS(s){const e=Ee(s);return e.de||(e.de=GS(e,s.explicitOrderBy)),e.de}function GS(s,e){if(s.limitType==="F")return hx(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map((a=>{const l=a.dir==="desc"?"asc":"desc";return new Bd(a.field,l)}));const t=s.endAt?new Gi(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new Gi(s.startAt.position,s.startAt.inclusive):null;return hx(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function fx(s,e){const t=s.filters.concat([e]);return new $a(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function vm(s,e,t){return new $a(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function eh(s,e){return Zd(ls(s),ls(e))&&s.limitType===e.limitType}function $S(s){return`${Wo(ls(s))}|lt:${s.limitType}`}function dc(s){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((a=>FS(a))).join(", ")}]`),Wd(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((a=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(a))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((a=>Ic(a))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((a=>Ic(a))).join(",")),`Target(${n})`})(ls(s))}; limitType=${s.limitType})`}function th(s,e){return e.isFoundDocument()&&(function(n,a){const l=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(l):Te.isDocumentKey(n.path)?n.path.isEqual(l):n.path.isImmediateParentOf(l)})(s,e)&&(function(n,a){for(const l of yc(n))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0})(s,e)&&(function(n,a){for(const l of n.filters)if(!l.matches(a))return!1;return!0})(s,e)&&(function(n,a){return!(n.startAt&&!(function(u,h,m){const p=bT(u,h,m);return u.inclusive?p<=0:p<0})(n.startAt,yc(n),a)||n.endAt&&!(function(u,h,m){const p=bT(u,h,m);return u.inclusive?p>=0:p>0})(n.endAt,yc(n),a))})(s,e)}function KS(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function QS(s){return(e,t)=>{let n=!1;for(const a of yc(s)){const l=HD(a,e,t);if(l!==0)return l;n=n||a.field.isKeyField()}return 0}}function HD(s,e,t){const n=s.field.isKeyField()?Te.comparator(e.key,t.key):(function(l,u,h){const m=u.data.field(l),p=h.data.field(l);return m!==null&&p!==null?Hi(m,p):Ae(42886)})(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return Ae(19790,{direction:s.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,l]of n)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Wi(this.inner,((t,n)=>{for(const[a,l]of n)e(a,l)}))}isEmpty(){return SS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD=new Ut(Te.comparator);function Es(){return GD}const YS=new Ut(Te.comparator);function md(...s){let e=YS;for(const t of s)e=e.insert(t.key,t);return e}function XS(s){let e=YS;return s.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function aa(){return Nd()}function WS(){return Nd()}function Nd(){return new Ka((s=>s.toString()),((s,e)=>s.isEqual(e)))}const $D=new Ut(Te.comparator),KD=new jt(Te.comparator);function Xe(...s){let e=KD;for(const t of s)e=e.add(t);return e}const QD=new jt(qe);function av(){return QD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iv(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dd(e)?"-0":e}}function JS(s){return{integerValue:""+s}}function ZS(s,e){return mS(e)?JS(e):iv(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(){this._=void 0}}function YD(s,e,t){return s instanceof Rc?(function(a,l){const u={fields:{[IS]:{stringValue:jS},[RS]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&Qm(l)&&(l=Ym(l)),l&&(u.fields[CS]=l),{mapValue:u}})(t,e):s instanceof Jo?tA(s,e):s instanceof Zo?nA(s,e):(function(a,l){const u=eA(a,l),h=NT(u)+NT(a.Ae);return cx(u)&&cx(a.Ae)?JS(h):iv(a.serializer,h)})(s,e)}function XD(s,e,t){return s instanceof Jo?tA(s,e):s instanceof Zo?nA(s,e):t}function eA(s,e){return s instanceof kc?(function(n){return cx(n)||(function(l){return!!l&&"doubleValue"in l})(n)})(e)?e:{integerValue:0}:null}class Rc extends Wm{}class Jo extends Wm{constructor(e){super(),this.elements=e}}function tA(s,e){const t=sA(e);for(const n of s.elements)t.some((a=>ua(a,n)))||t.push(n);return{arrayValue:{values:t}}}class Zo extends Wm{constructor(e){super(),this.elements=e}}function nA(s,e){let t=sA(e);for(const n of s.elements)t=t.filter((a=>!ua(a,n)));return{arrayValue:{values:t}}}class kc extends Wm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function NT(s){return Gt(s.integerValue||s.doubleValue)}function sA(s){return Fd(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t){this.field=e,this.transform=t}}function WD(s,e){return s.field.isEqual(e.field)&&(function(n,a){return n instanceof Jo&&a instanceof Jo||n instanceof Zo&&a instanceof Zo?bc(n.elements,a.elements,ua):n instanceof kc&&a instanceof kc?ua(n.Ae,a.Ae):n instanceof Rc&&a instanceof Rc})(s.transform,e.transform)}class JD{constructor(e,t){this.version=e,this.transformResults=t}}class Kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Kt}static exists(e){return new Kt(void 0,e)}static updateTime(e){return new Kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wf(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class Jm{}function rA(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new Qc(s.key,Kt.none()):new Kc(s.key,s.data,Kt.none());{const t=s.data,n=Jn.empty();let a=new jt(Bt.comparator);for(let l of e.fields)if(!a.has(l)){let u=t.field(l);u===null&&l.length>1&&(l=l.popLast(),u=t.field(l)),u===null?n.delete(l):n.set(l,u),a=a.add(l)}return new Qa(s.key,n,new Ts(a.toArray()),Kt.none())}}function ZD(s,e,t){s instanceof Kc?(function(a,l,u){const h=a.value.clone(),m=AT(a.fieldTransforms,l,u.transformResults);h.setAll(m),l.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(s,e,t):s instanceof Qa?(function(a,l,u){if(!Wf(a.precondition,l))return void l.convertToUnknownDocument(u.version);const h=AT(a.fieldTransforms,l,u.transformResults),m=l.data;m.setAll(aA(a)),m.setAll(h),l.convertToFoundDocument(u.version,m).setHasCommittedMutations()})(s,e,t):(function(a,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,t)}function Sd(s,e,t,n){return s instanceof Kc?(function(l,u,h,m){if(!Wf(l.precondition,u))return h;const p=l.value.clone(),x=jT(l.fieldTransforms,m,u);return p.setAll(x),u.convertToFoundDocument(u.version,p).setHasLocalMutations(),null})(s,e,t,n):s instanceof Qa?(function(l,u,h,m){if(!Wf(l.precondition,u))return h;const p=jT(l.fieldTransforms,m,u),x=u.data;return x.setAll(aA(l)),x.setAll(p),u.convertToFoundDocument(u.version,x).setHasLocalMutations(),h===null?null:h.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((_=>_.field)))})(s,e,t,n):(function(l,u,h){return Wf(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(s,e,t)}function eP(s,e){let t=null;for(const n of s.fieldTransforms){const a=e.data.field(n.field),l=eA(n.transform,a||null);l!=null&&(t===null&&(t=Jn.empty()),t.set(n.field,l))}return t||null}function ST(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!(function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&bc(n,a,((l,u)=>WD(l,u)))})(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class Kc extends Jm{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Qa extends Jm{constructor(e,t,n,a,l=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function aA(s){const e=new Map;return s.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}})),e}function AT(s,e,t){const n=new Map;ke(s.length===t.length,32656,{Re:t.length,Ve:s.length});for(let a=0;a<t.length;a++){const l=s[a],u=l.transform,h=e.data.field(l.field);n.set(l.field,XD(u,h,t[a]))}return n}function jT(s,e,t){const n=new Map;for(const a of s){const l=a.transform,u=t.data.field(a.field);n.set(a.field,YD(l,u,e))}return n}class Qc extends Jm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ov extends Jm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&ZD(l,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Sd(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Sd(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=WS();return this.mutations.forEach((a=>{const l=e.get(a.key),u=l.overlayedDocument;let h=this.applyToLocalView(u,l.mutatedFields);h=t.has(a.key)?null:h;const m=rA(u,h);m!==null&&n.set(a.key,m),u.isValidDocument()||u.convertToNoDocument(Me.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Xe())}isEqual(e){return this.batchId===e.batchId&&bc(this.mutations,e.mutations,((t,n)=>ST(t,n)))&&bc(this.baseMutations,e.baseMutations,((t,n)=>ST(t,n)))}}class cv{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){ke(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let a=(function(){return $D})();const l=e.mutations;for(let u=0;u<l.length;u++)a=a.insert(l[u].key,n[u].version);return new cv(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pn,ft;function oA(s){switch(s){case ne.OK:return Ae(64938);case ne.CANCELLED:case ne.UNKNOWN:case ne.DEADLINE_EXCEEDED:case ne.RESOURCE_EXHAUSTED:case ne.INTERNAL:case ne.UNAVAILABLE:case ne.UNAUTHENTICATED:return!1;case ne.INVALID_ARGUMENT:case ne.NOT_FOUND:case ne.ALREADY_EXISTS:case ne.PERMISSION_DENIED:case ne.FAILED_PRECONDITION:case ne.ABORTED:case ne.OUT_OF_RANGE:case ne.UNIMPLEMENTED:case ne.DATA_LOSS:return!0;default:return Ae(15467,{code:s})}}function lA(s){if(s===void 0)return dn("GRPC error has no .code"),ne.UNKNOWN;switch(s){case pn.OK:return ne.OK;case pn.CANCELLED:return ne.CANCELLED;case pn.UNKNOWN:return ne.UNKNOWN;case pn.DEADLINE_EXCEEDED:return ne.DEADLINE_EXCEEDED;case pn.RESOURCE_EXHAUSTED:return ne.RESOURCE_EXHAUSTED;case pn.INTERNAL:return ne.INTERNAL;case pn.UNAVAILABLE:return ne.UNAVAILABLE;case pn.UNAUTHENTICATED:return ne.UNAUTHENTICATED;case pn.INVALID_ARGUMENT:return ne.INVALID_ARGUMENT;case pn.NOT_FOUND:return ne.NOT_FOUND;case pn.ALREADY_EXISTS:return ne.ALREADY_EXISTS;case pn.PERMISSION_DENIED:return ne.PERMISSION_DENIED;case pn.FAILED_PRECONDITION:return ne.FAILED_PRECONDITION;case pn.ABORTED:return ne.ABORTED;case pn.OUT_OF_RANGE:return ne.OUT_OF_RANGE;case pn.UNIMPLEMENTED:return ne.UNIMPLEMENTED;case pn.DATA_LOSS:return ne.DATA_LOSS;default:return Ae(39323,{code:s})}}(ft=pn||(pn={}))[ft.OK=0]="OK",ft[ft.CANCELLED=1]="CANCELLED",ft[ft.UNKNOWN=2]="UNKNOWN",ft[ft.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ft[ft.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ft[ft.NOT_FOUND=5]="NOT_FOUND",ft[ft.ALREADY_EXISTS=6]="ALREADY_EXISTS",ft[ft.PERMISSION_DENIED=7]="PERMISSION_DENIED",ft[ft.UNAUTHENTICATED=16]="UNAUTHENTICATED",ft[ft.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ft[ft.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ft[ft.ABORTED=10]="ABORTED",ft[ft.OUT_OF_RANGE=11]="OUT_OF_RANGE",ft[ft.UNIMPLEMENTED=12]="UNIMPLEMENTED",ft[ft.INTERNAL=13]="INTERNAL",ft[ft.UNAVAILABLE=14]="UNAVAILABLE",ft[ft.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mx=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cA(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP=new Ui([4294967295,4294967295],0);function IT(s){const e=cA().encode(s),t=new XN;return t.update(e),new Uint8Array(t.digest())}function CT(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new Ui([t,n],0),new Ui([a,l],0)]}class dv{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new gd(`Invalid padding: ${t}`);if(n<0)throw new gd(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new gd(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new gd(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ui.fromNumber(this.ge)}ye(e,t,n){let a=e.add(t.multiply(Ui.fromNumber(n)));return a.compare(nP)===1&&(a=new Ui([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=IT(e),[n,a]=CT(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,a,l);if(!this.we(u))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new dv(l,a,t);return n.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const t=IT(e),[n,a]=CT(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,a,l);this.Se(u)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class gd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(e,t,n,a,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,rh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new sh(Me.min(),a,new Ut(qe),Es(),Xe())}}class rh{constructor(e,t,n,a,l){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new rh(n,t,Xe(),Xe(),Xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e,t,n,a){this.be=e,this.removedTargetIds=t,this.key=n,this.De=a}}class uA{constructor(e,t){this.targetId=e,this.Ce=t}}class dA{constructor(e,t,n=en.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class RT{constructor(){this.ve=0,this.Fe=kT(),this.Me=en.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Xe(),t=Xe(),n=Xe();return this.Fe.forEach(((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:Ae(38017,{changeType:l})}})),new rh(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=kT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ke(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class sP{constructor(e){this.Ge=e,this.ze=new Map,this.je=Es(),this.Je=Rf(),this.He=Rf(),this.Ye=new Ut(qe)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Ae(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,a)=>{this.rt(a)&&t(a)}))}st(e){const t=e.targetId,n=e.Ce.count,a=this.ot(t);if(a){const l=a.target;if(ym(l))if(n===0){const u=new Te(l.path);this.et(t,u,Ft.newNoDocument(u,Me.min()))}else ke(n===1,20013,{expectedCount:n});else{const u=this._t(t);if(u!==n){const h=this.ut(e),m=h?this.ct(h,e,u):1;if(m!==0){this.it(t);const p=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}mx?.lt((function(x,_,b,N,C){const k={localCacheCount:x,existenceFilterCount:_.count,databaseId:b.database,projectId:b.projectId},L=_.unchangedNames;return L&&(k.bloomFilter={applied:C===0,hashCount:L?.hashCount??0,bitmapLength:L?.bits?.bitmap?.length??0,padding:L?.bits?.padding??0,mightContain:F=>N?.mightContain(F)??!1}),k})(u,e.Ce,this.Ge.ht(),h,m))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:l=0}=t;let u,h;try{u=Ha(n).toUint8Array()}catch(m){if(m instanceof AS)return Xs("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{h=new dv(u,a,l)}catch(m){return Xs(m instanceof gd?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return h.ge===0?null:h}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let a=0;return n.forEach((l=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(h)||(this.et(t,l,null),a++)})),a}Tt(e){const t=new Map;this.ze.forEach(((l,u)=>{const h=this.ot(u);if(h){if(l.current&&ym(h.target)){const m=new Te(h.target.path);this.It(m).has(u)||this.Et(u,m)||this.et(u,m,Ft.newNoDocument(m,e))}l.Be&&(t.set(u,l.ke()),l.qe())}}));let n=Xe();this.He.forEach(((l,u)=>{let h=!0;u.forEachWhile((m=>{const p=this.ot(m);return!p||p.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(n=n.add(l))})),this.je.forEach(((l,u)=>u.setReadTime(e)));const a=new sh(e,t,this.Ye,this.je,n);return this.je=Es(),this.Je=Rf(),this.He=Rf(),this.Ye=new Ut(qe),a}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,t)?a.Qe(t,1):a.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new RT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new jt(qe),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new jt(qe),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ge("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new RT),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Rf(){return new Ut(Te.comparator)}function kT(){return new Ut(Te.comparator)}const rP={asc:"ASCENDING",desc:"DESCENDING"},aP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iP={and:"AND",or:"OR"};class oP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function gx(s,e){return s.useProto3Json||Wd(e)?e:{value:e}}function Dc(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hA(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function lP(s,e){return Dc(s,e.toTimestamp())}function hn(s){return ke(!!s,49232),Me.fromTimestamp((function(t){const n=za(t);return new _t(n.seconds,n.nanos)})(s))}function hv(s,e){return px(s,e).canonicalString()}function px(s,e){const t=(function(a){return new tt(["projects",a.projectId,"databases",a.database])})(s).child("documents");return e===void 0?t:t.child(e)}function fA(s){const e=tt.fromString(s);return ke(wA(e),10190,{key:e.toString()}),e}function qd(s,e){return hv(s.databaseId,e.path)}function la(s,e){const t=fA(e);if(t.get(1)!==s.databaseId.projectId)throw new he(ne.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new he(ne.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new Te(pA(t))}function mA(s,e){return hv(s.databaseId,e)}function gA(s){const e=fA(s);return e.length===4?tt.emptyPath():pA(e)}function yx(s){return new tt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function pA(s){return ke(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function DT(s,e,t){return{name:qd(s,e),fields:t.value.mapValue.fields}}function Zm(s,e,t){const n=la(s,e.name),a=hn(e.updateTime),l=e.createTime?hn(e.createTime):Me.min(),u=new Jn({mapValue:{fields:e.fields}}),h=Ft.newFoundDocument(n,a,l,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function cP(s,e){return"found"in e?(function(n,a){ke(!!a.found,43571),a.found.name,a.found.updateTime;const l=la(n,a.found.name),u=hn(a.found.updateTime),h=a.found.createTime?hn(a.found.createTime):Me.min(),m=new Jn({mapValue:{fields:a.found.fields}});return Ft.newFoundDocument(l,u,h,m)})(s,e):"missing"in e?(function(n,a){ke(!!a.missing,3894),ke(!!a.readTime,22933);const l=la(n,a.missing),u=hn(a.readTime);return Ft.newNoDocument(l,u)})(s,e):Ae(7234,{result:e})}function uP(s,e){let t;if("targetChange"in e){e.targetChange;const n=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:Ae(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=(function(p,x){return p.useProto3Json?(ke(x===void 0||typeof x=="string",58123),en.fromBase64String(x||"")):(ke(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),en.fromUint8Array(x||new Uint8Array))})(s,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(p){const x=p.code===void 0?ne.UNKNOWN:lA(p.code);return new he(x,p.message||"")})(u);t=new dA(n,a,l,h||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=la(s,n.document.name),l=hn(n.document.updateTime),u=n.document.createTime?hn(n.document.createTime):Me.min(),h=new Jn({mapValue:{fields:n.document.fields}}),m=Ft.newFoundDocument(a,l,u,h),p=n.targetIds||[],x=n.removedTargetIds||[];t=new Jf(p,x,m.key,m)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=la(s,n.document),l=n.readTime?hn(n.readTime):Me.min(),u=Ft.newNoDocument(a,l),h=n.removedTargetIds||[];t=new Jf([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=la(s,n.document),l=n.removedTargetIds||[];t=new Jf([],l,a,null)}else{if(!("filter"in e))return Ae(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:l}=n,u=new tP(a,l),h=n.targetId;t=new uA(h,u)}}return t}function zd(s,e){let t;if(e instanceof Kc)t={update:DT(s,e.key,e.value)};else if(e instanceof Qc)t={delete:qd(s,e.key)};else if(e instanceof Qa)t={update:DT(s,e.key,e.data),updateMask:pP(e.fieldMask)};else{if(!(e instanceof ov))return Ae(16599,{Vt:e.type});t={verify:qd(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(l,u){const h=u.transform;if(h instanceof Rc)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Jo)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof Zo)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof kc)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw Ae(20930,{transform:u.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(a,l){return l.updateTime!==void 0?{updateTime:lP(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Ae(27497)})(s,e.precondition)),t}function xx(s,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?Kt.updateTime(hn(l.updateTime)):l.exists!==void 0?Kt.exists(l.exists):Kt.none()})(e.currentDocument):Kt.none(),n=e.updateTransforms?e.updateTransforms.map((a=>(function(u,h){let m=null;if("setToServerValue"in h)ke(h.setToServerValue==="REQUEST_TIME",16630,{proto:h}),m=new Rc;else if("appendMissingElements"in h){const x=h.appendMissingElements.values||[];m=new Jo(x)}else if("removeAllFromArray"in h){const x=h.removeAllFromArray.values||[];m=new Zo(x)}else"increment"in h?m=new kc(u,h.increment):Ae(16584,{proto:h});const p=Bt.fromServerFormat(h.fieldPath);return new nh(p,m)})(s,a))):[];if(e.update){e.update.name;const a=la(s,e.update.name),l=new Jn({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=(function(m){const p=m.fieldPaths||[];return new Ts(p.map((x=>Bt.fromServerFormat(x))))})(e.updateMask);return new Qa(a,l,u,t,n)}return new Kc(a,l,t,n)}if(e.delete){const a=la(s,e.delete);return new Qc(a,t)}if(e.verify){const a=la(s,e.verify);return new ov(a,t)}return Ae(1463,{proto:e})}function dP(s,e){return s&&s.length>0?(ke(e!==void 0,14353),s.map((t=>(function(a,l){let u=a.updateTime?hn(a.updateTime):hn(l);return u.isEqual(Me.min())&&(u=hn(l)),new JD(u,a.transformResults||[])})(t,e)))):[]}function yA(s,e){return{documents:[mA(s,e.path)]}}function eg(s,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=mA(s,a);const l=(function(p){if(p.length!==0)return _A(St.create(p,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const u=(function(p){if(p.length!==0)return p.map((x=>(function(b){return{field:Ci(b.field),direction:fP(b.dir)}})(x)))})(e.orderBy);u&&(t.structuredQuery.orderBy=u);const h=gx(s,e.limit);return h!==null&&(t.structuredQuery.limit=h),e.startAt&&(t.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:t,parent:a}}function xA(s,e,t,n){const{ft:a,parent:l}=eg(s,e),u={},h=[];let m=0;return t.forEach((p=>{const x=n?p.alias:"aggregate_"+m++;u[x]=p.alias,p.aggregateType==="count"?h.push({alias:x,count:{}}):p.aggregateType==="avg"?h.push({alias:x,avg:{field:Ci(p.fieldPath)}}):p.aggregateType==="sum"&&h.push({alias:x,sum:{field:Ci(p.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:a.structuredQuery},parent:a.parent},gt:u,parent:l}}function vA(s){let e=gA(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){ke(n===1,65062);const x=t.from[0];x.allDescendants?a=x.collectionId:e=e.child(x.collectionId)}let l=[];t.where&&(l=(function(_){const b=bA(_);return b instanceof St&&sv(b)?b.getFilters():[b]})(t.where));let u=[];t.orderBy&&(u=(function(_){return _.map((b=>(function(C){return new Bd(hc(C.field),(function(L){switch(L){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(b)))})(t.orderBy));let h=null;t.limit&&(h=(function(_){let b;return b=typeof _=="object"?_.value:_,Wd(b)?null:b})(t.limit));let m=null;t.startAt&&(m=(function(_){const b=!!_.before,N=_.values||[];return new Gi(N,b)})(t.startAt));let p=null;return t.endAt&&(p=(function(_){const b=!_.before,N=_.values||[];return new Gi(N,b)})(t.endAt)),zS(e,a,u,l,h,"F",m,p)}function hP(s,e){const t=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ae(28987,{purpose:a})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function bA(s){return s.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=hc(t.unaryFilter.field);return ot.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=hc(t.unaryFilter.field);return ot.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=hc(t.unaryFilter.field);return ot.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=hc(t.unaryFilter.field);return ot.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ae(61313);default:return Ae(60726)}})(s):s.fieldFilter!==void 0?(function(t){return ot.create(hc(t.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ae(58110);default:return Ae(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(s):s.compositeFilter!==void 0?(function(t){return St.create(t.compositeFilter.filters.map((n=>bA(n))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ae(1026)}})(t.compositeFilter.op))})(s):Ae(30097,{filter:s})}function fP(s){return rP[s]}function mP(s){return aP[s]}function gP(s){return iP[s]}function Ci(s){return{fieldPath:s.canonicalString()}}function hc(s){return Bt.fromServerFormat(s.fieldPath)}function _A(s){return s instanceof ot?(function(t){if(t.op==="=="){if(yT(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NAN"}};if(pT(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(yT(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NAN"}};if(pT(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ci(t.field),op:mP(t.op),value:t.value}}})(s):s instanceof St?(function(t){const n=t.getFilters().map((a=>_A(a)));return n.length===1?n[0]:{compositeFilter:{op:gP(t.op),filters:n}}})(s):Ae(54877,{filter:s})}function pP(s){const e=[];return s.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function wA(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e,t,n,a,l=Me.min(),u=Me.min(),h=en.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=m}withSequenceNumber(e){return new Va(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Va(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Va(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Va(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e){this.yt=e}}function yP(s,e){let t;if(e.document)t=Zm(s.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=Te.fromSegments(e.noDocument.path),a=tl(e.noDocument.readTime);t=Ft.newNoDocument(n,a),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ae(56709);{const n=Te.fromSegments(e.unknownDocument.path),a=tl(e.unknownDocument.version);t=Ft.newUnknownDocument(n,a)}}return e.readTime&&t.setReadTime((function(a){const l=new _t(a[0],a[1]);return Me.fromTimestamp(l)})(e.readTime)),t}function PT(s,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:bm(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(l,u){return{name:qd(l,u.key),fields:u.data.value.mapValue.fields,updateTime:Dc(l,u.version.toTimestamp()),createTime:Dc(l,u.createTime.toTimestamp())}})(s.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:el(e.version)};else{if(!e.isUnknownDocument())return Ae(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:el(e.version)}}return n}function bm(s){const e=s.toTimestamp();return[e.seconds,e.nanoseconds]}function el(s){const e=s.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function tl(s){const e=new _t(s.seconds,s.nanoseconds);return Me.fromTimestamp(e)}function Lo(s,e){const t=(e.baseMutations||[]).map((l=>xx(s.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const u=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const h=e.mutations[l+1];u.updateTransforms=h.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const n=e.mutations.map((l=>xx(s.yt,l))),a=_t.fromMillis(e.localWriteTimeMs);return new lv(e.batchId,a,t,n)}function pd(s){const e=tl(s.readTime),t=s.lastLimboFreeSnapshotVersion!==void 0?tl(s.lastLimboFreeSnapshotVersion):Me.min();let n;return n=(function(l){return l.documents!==void 0})(s.query)?(function(l){const u=l.documents.length;return ke(u===1,1966,{count:u}),ls($c(gA(l.documents[0])))})(s.query):(function(l){return ls(vA(l))})(s.query),new Va(n,s.targetId,"TargetPurposeListen",s.lastListenSequenceNumber,e,t,en.fromBase64String(s.resumeToken))}function EA(s,e){const t=el(e.snapshotVersion),n=el(e.lastLimboFreeSnapshotVersion);let a;a=ym(e.target)?yA(s.yt,e.target):eg(s.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Wo(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:a}}function tg(s){const e=vA({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?vm(e,e.limit,"L"):e}function jy(s,e){return new uv(e.largestBatchId,xx(s.yt,e.overlayMutation))}function MT(s,e){const t=e.path.lastSegment();return[s,os(e.path.popLast()),t]}function OT(s,e,t,n){return{indexId:s,uid:e,sequenceNumber:t,readTime:el(n.readTime),documentKey:os(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{getBundleMetadata(e,t){return VT(e).get(t).next((n=>{if(n)return(function(l){return{id:l.bundleId,createTime:tl(l.createTime),version:l.version}})(n)}))}saveBundleMetadata(e,t){return VT(e).put((function(a){return{bundleId:a.id,createTime:el(hn(a.createTime)),version:a.version}})(t))}getNamedQuery(e,t){return LT(e).get(t).next((n=>{if(n)return(function(l){return{name:l.name,query:tg(l.bundledQuery),readTime:tl(l.readTime)}})(n)}))}saveNamedQuery(e,t){return LT(e).put((function(a){return{name:a.name,readTime:el(hn(a.readTime)),bundledQuery:a.bundledQuery}})(t))}}function VT(s){return In(s,Gm)}function LT(s){return In(s,$m)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new ng(e,n)}getOverlay(e,t){return sd(e).get(MT(this.userId,t)).next((n=>n?jy(this.serializer,n):null))}getOverlays(e,t){const n=aa();return W.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&n.set(a,l)})))).next((()=>n))}saveOverlays(e,t,n){const a=[];return n.forEach(((l,u)=>{const h=new uv(t,u);a.push(this.St(e,h))})),W.waitFor(a)}removeOverlaysForBatchId(e,t,n){const a=new Set;t.forEach((u=>a.add(os(u.getCollectionPath()))));const l=[];return a.forEach((u=>{const h=IDBKeyRange.bound([this.userId,u,n],[this.userId,u,n+1],!1,!0);l.push(sd(e).Z(ix,h))})),W.waitFor(l)}getOverlaysForCollection(e,t,n){const a=aa(),l=os(t),u=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,Number.POSITIVE_INFINITY],!0);return sd(e).J(ix,u).next((h=>{for(const m of h){const p=jy(this.serializer,m);a.set(p.getKey(),p)}return a}))}getOverlaysForCollectionGroup(e,t,n,a){const l=aa();let u;const h=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return sd(e).ee({index:bS,range:h},((m,p,x)=>{const _=jy(this.serializer,p);l.size()<a||_.largestBatchId===u?(l.set(_.getKey(),_),u=_.largestBatchId):x.done()})).next((()=>l))}St(e,t){return sd(e).put((function(a,l,u){const[h,m,p]=MT(l,u.mutation.key);return{userId:l,collectionPath:m,documentId:p,collectionGroup:u.mutation.key.getCollectionGroup(),largestBatchId:u.largestBatchId,overlayMutation:zd(a.yt,u.mutation)}})(this.serializer,this.userId,t))}}function sd(s){return In(s,Km)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{bt(e){return In(e,Zx)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const n=t?.value;return n?en.fromUint8Array(n):en.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Gt(e.integerValue));else if("doubleValue"in e){const n=Gt(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Dd(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=za(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ha(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?DS(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Xm(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Ae(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const a of Object.keys(n))this.Ot(a,t),this.Ct(n[a],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const a=jc,l=n[a].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Gt(l)),this.Ot(a,t),this.Ct(n[a],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const a of n)this.Ct(a,t)}Lt(e,t){this.Ft(t,37),Te.fromName(e).path.forEach((n=>{this.Ft(t,60),this.Ut(n,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Uo.Kt=new Uo;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rc=255;function bP(s){if(s===0)return 8;let e=0;return s>>4||(e+=4,s<<=4),s>>6||(e+=2,s<<=2),s>>7||(e+=1),e}function UT(s){const e=64-(function(n){let a=0;for(let l=0;l<8;++l){const u=bP(255&n[l]);if(a+=u,u!==8)break}return a})(s);return Math.ceil(e/8)}class _P{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const a=t.codePointAt(0);this.Gt(240|a>>>18),this.Gt(128|63&a>>>12),this.Gt(128|63&a>>>6),this.Gt(128|63&a)}}this.zt()}Zt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const a=t.codePointAt(0);this.Jt(240|a>>>18),this.Jt(128|63&a>>>12),this.Jt(128|63&a>>>6),this.Jt(128|63&a)}}this.Ht()}Xt(e){const t=this.en(e),n=UT(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let a=t.length-n;a<t.length;++a)this.buffer[this.position++]=255&t[a]}nn(e){const t=this.en(e),n=UT(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let a=t.length-n;a<t.length;++a)this.buffer[this.position++]=~(255&t[a])}rn(){this.sn(rc),this.sn(255)}_n(){this.an(rc),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const u=new DataView(new ArrayBuffer(8));return u.setFloat64(0,l,!1),new Uint8Array(u.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let a=1;a<t.length;++a)t[a]^=n?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===rc?(this.sn(rc),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===rc?(this.an(rc),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const a=new Uint8Array(n);a.set(this.buffer),this.buffer=a}}class wP{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class TP{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class rd{constructor(){this.cn=new _P,this.ln=new wP(this.cn),this.hn=new TP(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,t,n,a){this.Tn=e,this.In=t,this.En=n,this.dn=a}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new Fo(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:Zf(this.En),directionalValue:Zf(this.dn),orderedDocumentKey:Zf(t),documentKey:n.path.toArray()}}Vn(e,t,n){const a=this.Rn(e,t,n);return[a.indexId,a.uid,a.arrayValue,a.directionalValue,a.orderedDocumentKey,a.documentKey]}}function Ei(s,e){let t=s.Tn-e.Tn;return t!==0?t:(t=FT(s.En,e.En),t!==0?t:(t=FT(s.dn,e.dn),t!==0?t:Te.comparator(s.In,e.In)))}function FT(s,e){for(let t=0;t<s.length&&t<e.length;++t){const n=s[t]-e[t];if(n!==0)return n}return s.length-e.length}function Zf(s){return lN()?(function(t){let n="";for(let a=0;a<t.length;a++)n+=String.fromCharCode(t[a]);return n})(s):s}function BT(s){return typeof s!="string"?s:(function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n})(s)}class qT{constructor(e){this.mn=new jt(((t,n)=>Bt.comparator(t.field,n.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(ke(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=sx(e);if(t!==void 0&&!this.wn(t))return!1;const n=Mo(e);let a=new Set,l=0,u=0;for(;l<n.length&&this.wn(n[l]);++l)a=a.add(n[l].fieldPath.canonicalString());if(l===n.length)return!0;if(this.mn.size>0){const h=this.mn.getIterator().getNext();if(!a.has(h.field.canonicalString())){const m=n[l];if(!this.Sn(h,m)||!this.bn(this.fn[u++],m))return!1}++l}for(;l<n.length;++l){const h=n[l];if(u>=this.fn.length||!this.bn(this.fn[u++],h))return!1}return!0}Dn(){if(this.pn)return null;let e=new jt(Bt.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Ho(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Ho(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Ho(n.field,n.dir==="asc"?0:1)));return new wc(wc.UNKNOWN_ID,this.collectionId,t,Tc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NA(s){if(ke(s instanceof ot||s instanceof St,20012),s instanceof ot){if(s instanceof qS){const t=s.value.arrayValue?.values?.map((n=>ot.create(s.field,"==",n)))||[];return St.create(t,"or")}return s}const e=s.filters.map((t=>NA(t)));return St.create(e,s.op)}function EP(s){if(s.getFilters().length===0)return[];const e=_x(NA(s));return ke(SA(e),7391),vx(e)||bx(e)?[e]:e.getFilters()}function vx(s){return s instanceof ot}function bx(s){return s instanceof St&&sv(s)}function SA(s){return vx(s)||bx(s)||(function(t){if(t instanceof St&&ux(t)){for(const n of t.getFilters())if(!vx(n)&&!bx(n))return!1;return!0}return!1})(s)}function _x(s){if(ke(s instanceof ot||s instanceof St,34018),s instanceof ot)return s;if(s.filters.length===1)return _x(s.filters[0]);const e=s.filters.map((n=>_x(n)));let t=St.create(e,s.op);return t=_m(t),SA(t)?t:(ke(t instanceof St,64498),ke(Cc(t),40251),ke(t.filters.length>1,57927),t.filters.reduce(((n,a)=>fv(n,a))))}function fv(s,e){let t;return ke(s instanceof ot||s instanceof St,38388),ke(e instanceof ot||e instanceof St,25473),t=s instanceof ot?e instanceof ot?(function(a,l){return St.create([a,l],"and")})(s,e):zT(s,e):e instanceof ot?zT(e,s):(function(a,l){if(ke(a.filters.length>0&&l.filters.length>0,48005),Cc(a)&&Cc(l))return US(a,l.getFilters());const u=ux(a)?a:l,h=ux(a)?l:a,m=u.filters.map((p=>fv(p,h)));return St.create(m,"or")})(s,e),_m(t)}function zT(s,e){if(Cc(e))return US(e,s.getFilters());{const t=e.filters.map((n=>fv(s,n)));return St.create(t,"or")}}function _m(s){if(ke(s instanceof ot||s instanceof St,11850),s instanceof ot)return s;const e=s.getFilters();if(e.length===1)return _m(e[0]);if(VS(s))return s;const t=e.map((a=>_m(a))),n=[];return t.forEach((a=>{a instanceof ot?n.push(a):a instanceof St&&(a.op===s.op?n.push(...a.filters):n.push(a))})),n.length===1?n[0]:St.create(n,s.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(){this.Cn=new mv}addToCollectionParentIndex(e,t){return this.Cn.add(t),W.resolve()}getCollectionParents(e,t){return W.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return W.resolve()}deleteFieldIndex(e,t){return W.resolve()}deleteAllFieldIndexes(e){return W.resolve()}createTargetIndexes(e,t){return W.resolve()}getDocumentsMatchingTarget(e,t){return W.resolve(null)}getIndexType(e,t){return W.resolve(0)}getFieldIndexes(e,t){return W.resolve([])}getNextCollectionGroupToUpdate(e){return W.resolve(null)}getMinOffset(e,t){return W.resolve(Ws.min())}getMinOffsetFromCollectionGroup(e,t){return W.resolve(Ws.min())}updateCollectionGroup(e,t,n){return W.resolve()}updateIndexEntries(e,t){return W.resolve()}}class mv{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new jt(tt.comparator),l=!a.has(n);return this.index[t]=a.add(n),l}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new jt(tt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT="IndexedDbIndexManager",kf=new Uint8Array(0);class SP{constructor(e,t){this.databaseId=t,this.vn=new mv,this.Fn=new Ka((n=>Wo(n)),((n,a)=>Zd(n,a))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),a=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:n,parent:os(a)};return GT(e).put(l)}return W.resolve()}getCollectionParents(e,t){const n=[],a=IDBKeyRange.bound([t,""],[aS(t),""],!1,!0);return GT(e).J(a).next((l=>{for(const u of l){if(u.collectionId!==t)break;n.push(ra(u.parent))}return n}))}addFieldIndex(e,t){const n=ad(e),a=(function(h){return{indexId:h.indexId,collectionGroup:h.collectionGroup,fields:h.fields.map((m=>[m.fieldPath.canonicalString(),m.kind]))}})(t);delete a.indexId;const l=n.add(a);if(t.indexState){const u=ic(e);return l.next((h=>{u.put(OT(h,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const n=ad(e),a=ic(e),l=ac(e);return n.delete(t.indexId).next((()=>a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=ad(e),n=ac(e),a=ic(e);return t.Z().next((()=>n.Z())).next((()=>a.Z()))}createTargetIndexes(e,t){return W.forEach(this.Mn(t),(n=>this.getIndexType(e,n).next((a=>{if(a===0||a===1){const l=new qT(n).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const n=ac(e);let a=!0;const l=new Map;return W.forEach(this.Mn(t),(u=>this.xn(e,u).next((h=>{a&&(a=!!h),l.set(u,h)})))).next((()=>{if(a){let u=Xe();const h=[];return W.forEach(l,((m,p)=>{ge(HT,`Using index ${(function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map((H=>`${H.fieldPath}:${H.kind}`)).join(",")}`})(m)} to execute ${Wo(t)}`);const x=(function(B,H){const $=sx(H);if($===void 0)return null;for(const M of xm(B,$.fieldPath))switch(M.op){case"array-contains-any":return M.value.arrayValue.values||[];case"array-contains":return[M.value]}return null})(p,m),_=(function(B,H){const $=new Map;for(const M of Mo(H))for(const R of xm(B,M.fieldPath))switch(R.op){case"==":case"in":$.set(M.fieldPath.canonicalString(),R.value);break;case"not-in":case"!=":return $.set(M.fieldPath.canonicalString(),R.value),Array.from($.values())}return null})(p,m),b=(function(B,H){const $=[];let M=!0;for(const R of Mo(H)){const T=R.kind===0?wT(B,R.fieldPath,B.startAt):TT(B,R.fieldPath,B.startAt);$.push(T.value),M&&(M=T.inclusive)}return new Gi($,M)})(p,m),N=(function(B,H){const $=[];let M=!0;for(const R of Mo(H)){const T=R.kind===0?TT(B,R.fieldPath,B.endAt):wT(B,R.fieldPath,B.endAt);$.push(T.value),M&&(M=T.inclusive)}return new Gi($,M)})(p,m),C=this.On(m,p,b),k=this.On(m,p,N),L=this.Nn(m,p,_),F=this.Bn(m.indexId,x,C,b.inclusive,k,N.inclusive,L);return W.forEach(F,(U=>n.Y(U,t.limit).next((B=>{B.forEach((H=>{const $=Te.fromSegments(H.documentKey);u.has($)||(u=u.add($),h.push($))}))}))))})).next((()=>h))}return W.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=EP(St.create(e.filters,"and")).map((n=>hx(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,n,a,l,u,h){const m=(t!=null?t.length:1)*Math.max(n.length,l.length),p=m/(t!=null?t.length:1),x=[];for(let _=0;_<m;++_){const b=t?this.Ln(t[_/p]):kf,N=this.kn(e,b,n[_%p],a),C=this.qn(e,b,l[_%p],u),k=h.map((L=>this.kn(e,b,L,!0)));x.push(...this.createRange(N,C,k))}return x}kn(e,t,n,a){const l=new Fo(e,Te.empty(),t,n);return a?l:l.An()}qn(e,t,n,a){const l=new Fo(e,Te.empty(),t,n);return a?l.An():l}xn(e,t){const n=new qT(t),a=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,a).next((l=>{let u=null;for(const h of l)n.yn(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u}))}getIndexType(e,t){let n=2;const a=this.Mn(t);return W.forEach(a,(l=>this.xn(e,l).next((u=>{u?n!==0&&u.fields.length<(function(m){let p=new jt(Bt.comparator),x=!1;for(const _ of m.filters)for(const b of _.getFlattenedFilters())b.field.isKeyField()||(b.op==="array-contains"||b.op==="array-contains-any"?x=!0:p=p.add(b.field));for(const _ of m.orderBy)_.field.isKeyField()||(p=p.add(_.field));return p.size+(x?1:0)})(l)&&(n=1):n=0})))).next((()=>(function(u){return u.limit!==null})(t)&&a.length>1&&n===2?1:n))}Qn(e,t){const n=new rd;for(const a of Mo(e)){const l=t.data.field(a.fieldPath);if(l==null)return null;const u=n.Pn(a.kind);Uo.Kt.Dt(l,u)}return n.un()}Ln(e){const t=new rd;return Uo.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new rd;return Uo.Kt.Dt(Xo(this.databaseId,t),n.Pn((function(l){const u=Mo(l);return u.length===0?0:u[u.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let a=[];a.push(new rd);let l=0;for(const u of Mo(e)){const h=n[l++];for(const m of a)if(this.Un(t,u.fieldPath)&&Fd(h))a=this.Kn(a,u,h);else{const p=m.Pn(u.kind);Uo.Kt.Dt(h,p)}}return this.Wn(a)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const a=[...e],l=[];for(const u of n.arrayValue.values||[])for(const h of a){const m=new rd;m.seed(h.un()),Uo.Kt.Dt(u,m.Pn(t.kind)),l.push(m)}return l}Un(e,t){return!!e.filters.find((n=>n instanceof ot&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(e,t){const n=ad(e),a=ic(e);return(t?n.J(ax,IDBKeyRange.bound(t,t)):n.J()).next((l=>{const u=[];return W.forEach(l,(h=>a.get([h.indexId,this.uid]).next((m=>{u.push((function(x,_){const b=_?new Tc(_.sequenceNumber,new Ws(tl(_.readTime),new Te(ra(_.documentKey)),_.largestBatchId)):Tc.empty(),N=x.fields.map((([C,k])=>new Ho(Bt.fromServerFormat(C),k)));return new wc(x.indexId,x.collectionGroup,N,b)})(h,m))})))).next((()=>u))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((n,a)=>{const l=n.indexState.sequenceNumber-a.indexState.sequenceNumber;return l!==0?l:qe(n.collectionGroup,a.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,n){const a=ad(e),l=ic(e);return this.Gn(e).next((u=>a.J(ax,IDBKeyRange.bound(t,t)).next((h=>W.forEach(h,(m=>l.put(OT(m.indexId,this.uid,u,n))))))))}updateIndexEntries(e,t){const n=new Map;return W.forEach(t,((a,l)=>{const u=n.get(a.collectionGroup);return(u?W.resolve(u):this.getFieldIndexes(e,a.collectionGroup)).next((h=>(n.set(a.collectionGroup,h),W.forEach(h,(m=>this.zn(e,a,m).next((p=>{const x=this.jn(l,m);return p.isEqual(x)?W.resolve():this.Jn(e,l,m,p,x)})))))))}))}Hn(e,t,n,a){return ac(e).put(a.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,a){return ac(e).delete(a.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const a=ac(e);let l=new jt(Ei);return a.ee({index:vS,range:IDBKeyRange.only([n.indexId,this.uid,Zf(this.$n(n,t))])},((u,h)=>{l=l.add(new Fo(n.indexId,t,BT(h.arrayValue),BT(h.directionalValue)))})).next((()=>l))}jn(e,t){let n=new jt(Ei);const a=this.Qn(t,e);if(a==null)return n;const l=sx(t);if(l!=null){const u=e.data.field(l.fieldPath);if(Fd(u))for(const h of u.arrayValue.values||[])n=n.add(new Fo(t.indexId,e.key,this.Ln(h),a))}else n=n.add(new Fo(t.indexId,e.key,kf,a));return n}Jn(e,t,n,a,l){ge(HT,"Updating index entries for document '%s'",t.key);const u=[];return(function(m,p,x,_,b){const N=m.getIterator(),C=p.getIterator();let k=sc(N),L=sc(C);for(;k||L;){let F=!1,U=!1;if(k&&L){const B=x(k,L);B<0?U=!0:B>0&&(F=!0)}else k!=null?U=!0:F=!0;F?(_(L),L=sc(C)):U?(b(k),k=sc(N)):(k=sc(N),L=sc(C))}})(a,l,Ei,(h=>{u.push(this.Hn(e,t,n,h))}),(h=>{u.push(this.Yn(e,t,n,h))})),W.waitFor(u)}Gn(e){let t=1;return ic(e).ee({index:xS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,a,l)=>{l.done(),t=a.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((u,h)=>Ei(u,h))).filter(((u,h,m)=>!h||Ei(u,m[h-1])!==0));const a=[];a.push(e);for(const u of n){const h=Ei(u,e),m=Ei(u,t);if(h===0)a[0]=e.An();else if(h>0&&m<0)a.push(u),a.push(u.An());else if(m>0)break}a.push(t);const l=[];for(let u=0;u<a.length;u+=2){if(this.Zn(a[u],a[u+1]))return[];const h=a[u].Vn(this.uid,kf,Te.empty()),m=a[u+1].Vn(this.uid,kf,Te.empty());l.push(IDBKeyRange.bound(h,m))}return l}Zn(e,t){return Ei(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($T)}getMinOffset(e,t){return W.mapArray(this.Mn(t),(n=>this.xn(e,n).next((a=>a||Ae(44426))))).next($T)}}function GT(s){return In(s,Od)}function ac(s){return In(s,Td)}function ad(s){return In(s,Jx)}function ic(s){return In(s,wd)}function $T(s){ke(s.length!==0,28825);let e=s[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<s.length;n++){const a=s[n].indexState.offset;Yx(a,e)<0&&(e=a),t<a.largestBatchId&&(t=a.largestBatchId)}return new Ws(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},AA=41943040;class rs{static withCacheSize(e){return new rs(e,rs.DEFAULT_COLLECTION_PERCENTILE,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jA(s,e,t){const n=s.store(Rr),a=s.store(Ec),l=[],u=IDBKeyRange.only(t.batchId);let h=0;const m=n.ee({range:u},((x,_,b)=>(h++,b.delete())));l.push(m.next((()=>{ke(h===1,47070,{batchId:t.batchId})})));const p=[];for(const x of t.mutations){const _=gS(e,x.key.path,t.batchId);l.push(a.delete(_)),p.push(x.key)}return W.waitFor(l).next((()=>p))}function wm(s){if(!s)return 0;let e;if(s.document)e=s.document;else if(s.unknownDocument)e=s.unknownDocument;else{if(!s.noDocument)throw Ae(14731);e=s.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rs.DEFAULT_COLLECTION_PERCENTILE=10,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rs.DEFAULT=new rs(AA,rs.DEFAULT_COLLECTION_PERCENTILE,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rs.DISABLED=new rs(-1,0,0);class sg{constructor(e,t,n,a){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=a,this.Xn={}}static wt(e,t,n,a){ke(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new sg(l,t,n,a)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ni(e).ee({index:qo,range:n},((a,l,u)=>{t=!1,u.done()})).next((()=>t))}addMutationBatch(e,t,n,a){const l=fc(e),u=Ni(e);return u.add({}).next((h=>{ke(typeof h=="number",49019);const m=new lv(h,t,n,a),p=(function(N,C,k){const L=k.baseMutations.map((U=>zd(N.yt,U))),F=k.mutations.map((U=>zd(N.yt,U)));return{userId:C,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:L,mutations:F}})(this.serializer,this.userId,m),x=[];let _=new jt(((b,N)=>qe(b.canonicalString(),N.canonicalString())));for(const b of a){const N=gS(this.userId,b.key.path,h);_=_.add(b.key.path.popLast()),x.push(u.put(p)),x.push(l.put(N,oD))}return _.forEach((b=>{x.push(this.indexManager.addToCollectionParentIndex(e,b))})),e.addOnCommittedListener((()=>{this.Xn[h]=m.keys()})),W.waitFor(x).next((()=>m))}))}lookupMutationBatch(e,t){return Ni(e).get(t).next((n=>n?(ke(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),Lo(this.serializer,n)):null))}er(e,t){return this.Xn[t]?W.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((n=>{if(n){const a=n.keys();return this.Xn[t]=a,a}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=IDBKeyRange.lowerBound([this.userId,n]);let l=null;return Ni(e).ee({index:qo,range:a},((u,h,m)=>{h.userId===this.userId&&(ke(h.batchId>=n,47524,{tr:n}),l=Lo(this.serializer,h)),m.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Fi;return Ni(e).ee({index:qo,range:t,reverse:!0},((a,l,u)=>{n=l.batchId,u.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Fi],[this.userId,Number.POSITIVE_INFINITY]);return Ni(e).J(qo,t).next((n=>n.map((a=>Lo(this.serializer,a)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=$f(this.userId,t.path),a=IDBKeyRange.lowerBound(n),l=[];return fc(e).ee({range:a},((u,h,m)=>{const[p,x,_]=u,b=ra(x);if(p===this.userId&&t.path.isEqual(b))return Ni(e).get(_).next((N=>{if(!N)throw Ae(61480,{nr:u,batchId:_});ke(N.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:N.userId,batchId:_}),l.push(Lo(this.serializer,N))}));m.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new jt(qe);const a=[];return t.forEach((l=>{const u=$f(this.userId,l.path),h=IDBKeyRange.lowerBound(u),m=fc(e).ee({range:h},((p,x,_)=>{const[b,N,C]=p,k=ra(N);b===this.userId&&l.path.isEqual(k)?n=n.add(C):_.done()}));a.push(m)})),W.waitFor(a).next((()=>this.rr(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1,l=$f(this.userId,n),u=IDBKeyRange.lowerBound(l);let h=new jt(qe);return fc(e).ee({range:u},((m,p,x)=>{const[_,b,N]=m,C=ra(b);_===this.userId&&n.isPrefixOf(C)?C.length===a&&(h=h.add(N)):x.done()})).next((()=>this.rr(e,h)))}rr(e,t){const n=[],a=[];return t.forEach((l=>{a.push(Ni(e).get(l).next((u=>{if(u===null)throw Ae(35274,{batchId:l});ke(u.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:u.userId,batchId:l}),n.push(Lo(this.serializer,u))})))})),W.waitFor(a).next((()=>n))}removeMutationBatch(e,t){return jA(e.le,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),W.forEach(n,(a=>this.referenceDelegate.markPotentiallyOrphaned(e,a))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return W.resolve();const n=IDBKeyRange.lowerBound((function(u){return[u]})(this.userId)),a=[];return fc(e).ee({range:n},((l,u,h)=>{if(l[0]===this.userId){const m=ra(l[1]);a.push(m)}else h.done()})).next((()=>{ke(a.length===0,56720,{sr:a.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return IA(e,this.userId,t)}_r(e){return CA(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Fi,lastStreamToken:""}))}}function IA(s,e,t){const n=$f(e,t.path),a=n[1],l=IDBKeyRange.lowerBound(n);let u=!1;return fc(s).ee({range:l,X:!0},((h,m,p)=>{const[x,_,b]=h;x===e&&_===a&&(u=!0),p.done()})).next((()=>u))}function Ni(s){return In(s,Rr)}function fc(s){return In(s,Ec)}function CA(s){return In(s,Pd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new nl(0)}static cr(){return new nl(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const n=new nl(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>Me.fromTimestamp(new _t(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.lr(e).next((a=>(a.highestListenSequenceNumber=t,n&&(a.lastRemoteSnapshotVersion=n.toTimestamp()),t>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=t),this.hr(e,a))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>oc(e).delete(t.targetId))).next((()=>this.lr(e))).next((n=>(ke(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n))))}removeTargets(e,t,n){let a=0;const l=[];return oc(e).ee(((u,h)=>{const m=pd(h);m.sequenceNumber<=t&&n.get(m.targetId)===null&&(a++,l.push(this.removeTargetData(e,m)))})).next((()=>W.waitFor(l))).next((()=>a))}forEachTarget(e,t){return oc(e).ee(((n,a)=>{const l=pd(a);t(l)}))}lr(e){return QT(e).get(pm).next((t=>(ke(t!==null,2888),t)))}hr(e,t){return QT(e).put(pm,t)}Pr(e,t){return oc(e).put(EA(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const n=Wo(t),a=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let l=null;return oc(e).ee({range:a,index:yS},((u,h,m)=>{const p=pd(h);Zd(t,p.target)&&(l=p,m.done())})).next((()=>l))}addMatchingKeys(e,t,n){const a=[],l=Ri(e);return t.forEach((u=>{const h=os(u.path);a.push(l.put({targetId:n,path:h})),a.push(this.referenceDelegate.addReference(e,n,u))})),W.waitFor(a)}removeMatchingKeys(e,t,n){const a=Ri(e);return W.forEach(t,(l=>{const u=os(l.path);return W.waitFor([a.delete([n,u]),this.referenceDelegate.removeReference(e,n,l)])}))}removeMatchingKeysForTargetId(e,t){const n=Ri(e),a=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(a)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),a=Ri(e);let l=Xe();return a.ee({range:n,X:!0},((u,h,m)=>{const p=ra(u[1]),x=new Te(p);l=l.add(x)})).next((()=>l))}containsKey(e,t){const n=os(t.path),a=IDBKeyRange.bound([n],[aS(n)],!1,!0);let l=0;return Ri(e).ee({index:Wx,X:!0,range:a},(([u,h],m,p)=>{u!==0&&(l++,p.done())})).next((()=>l>0))}At(e,t){return oc(e).get(t).next((n=>n?pd(n):null))}}function oc(s){return In(s,Nc)}function QT(s){return In(s,Go)}function Ri(s){return In(s,Sc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YT="LruGarbageCollector",RA=1048576;function XT([s,e],[t,n]){const a=qe(s,t);return a===0?qe(e,n):a}class jP{constructor(e){this.Ir=e,this.buffer=new jt(XT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();XT(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class kA{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ge(YT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xi(t)?ge(YT,"Ignoring IndexedDB error during garbage collection: ",t):await Yi(t)}await this.Vr(3e5)}))}}class IP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return W.resolve(ws.ce);const n=new jP(t);return this.mr.forEachTarget(e,(a=>n.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>n.Ar(a))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ge("LruGarbageCollector","Garbage collection skipped; disabled"),W.resolve(KT)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ge("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),KT):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,a,l,u,h,m,p;const x=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(ge("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),a=this.params.maximumSequenceNumbersToCollect):a=_,u=Date.now(),this.nthSequenceNumber(e,a)))).next((_=>(n=_,h=Date.now(),this.removeTargets(e,n,t)))).next((_=>(l=_,m=Date.now(),this.removeOrphanedDocuments(e,n)))).next((_=>(p=Date.now(),uc()<=it.DEBUG&&ge("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-x}ms
	Determined least recently used ${a} in `+(h-u)+`ms
	Removed ${l} targets in `+(m-h)+`ms
	Removed ${_} documents in `+(p-m)+`ms
Total Duration: ${p-x}ms`),W.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:_}))))}}function DA(s,e){return new IP(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e,t){this.db=e,this.garbageCollector=DA(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((n=>t.next((a=>n+a))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((n,a)=>t(a)))}addReference(e,t,n){return Df(e,n)}removeReference(e,t,n){return Df(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Df(e,t)}br(e,t){return(function(a,l){let u=!1;return CA(a).te((h=>IA(a,h,l).next((m=>(m&&(u=!0),W.resolve(!m)))))).next((()=>u))})(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[];let l=0;return this.Sr(e,((u,h)=>{if(h<=t){const m=this.br(e,u).next((p=>{if(!p)return l++,n.getEntry(e,u).next((()=>(n.removeEntry(u,Me.min()),Ri(e).delete((function(_){return[0,os(_.path)]})(u)))))}));a.push(m)}})).next((()=>W.waitFor(a))).next((()=>n.apply(e))).next((()=>l))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Df(e,t)}Sr(e,t){const n=Ri(e);let a,l=ws.ce;return n.ee({index:Wx},(([u,h],{path:m,sequenceNumber:p})=>{u===0?(l!==ws.ce&&t(new Te(ra(a)),l),l=p,a=m):l=ws.ce})).next((()=>{l!==ws.ce&&t(new Te(ra(a)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Df(s,e){return Ri(s).put((function(n,a){return{targetId:0,path:os(n.path),sequenceNumber:a}})(e,s.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(){this.changes=new Ka((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?W.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Do(e).put(n)}removeEntry(e,t,n){return Do(e).delete((function(l,u){const h=l.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],bm(u),h[h.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Dr(e,n))))}getEntry(e,t){let n=Ft.newInvalidDocument(t);return Do(e).ee({index:Kf,range:IDBKeyRange.only(id(t))},((a,l)=>{n=this.Cr(t,l)})).next((()=>n))}vr(e,t){let n={size:0,document:Ft.newInvalidDocument(t)};return Do(e).ee({index:Kf,range:IDBKeyRange.only(id(t))},((a,l)=>{n={document:this.Cr(t,l),size:wm(l)}})).next((()=>n))}getEntries(e,t){let n=Es();return this.Fr(e,t,((a,l)=>{const u=this.Cr(a,l);n=n.insert(a,u)})).next((()=>n))}Mr(e,t){let n=Es(),a=new Ut(Te.comparator);return this.Fr(e,t,((l,u)=>{const h=this.Cr(l,u);n=n.insert(l,h),a=a.insert(l,wm(u))})).next((()=>({documents:n,Or:a})))}Fr(e,t,n){if(t.isEmpty())return W.resolve();let a=new jt(ZT);t.forEach((m=>a=a.add(m)));const l=IDBKeyRange.bound(id(a.first()),id(a.last())),u=a.getIterator();let h=u.getNext();return Do(e).ee({index:Kf,range:l},((m,p,x)=>{const _=Te.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;h&&ZT(h,_)<0;)n(h,null),h=u.getNext();h&&h.isEqual(_)&&(n(h,p),h=u.hasNext()?u.getNext():null),h?x.j(id(h)):x.done()})).next((()=>{for(;h;)n(h,null),h=u.hasNext()?u.getNext():null}))}getDocumentsMatchingQuery(e,t,n,a,l){const u=t.path,h=[u.popLast().toArray(),u.lastSegment(),bm(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],m=[u.popLast().toArray(),u.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Do(e).J(IDBKeyRange.bound(h,m,!0)).next((p=>{l?.incrementDocumentReadCount(p.length);let x=Es();for(const _ of p){const b=this.Cr(Te.fromSegments(_.prefixPath.concat(_.collectionGroup,_.documentId)),_);b.isFoundDocument()&&(th(t,b)||a.has(b.key))&&(x=x.insert(b.key,b))}return x}))}getAllFromCollectionGroup(e,t,n,a){let l=Es();const u=JT(t,n),h=JT(t,Ws.max());return Do(e).ee({index:pS,range:IDBKeyRange.bound(u,h,!0)},((m,p,x)=>{const _=this.Cr(Te.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);l=l.insert(_.key,_),l.size===a&&x.done()})).next((()=>l))}newChangeBuffer(e){return new kP(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return WT(e).get(rx).next((t=>(ke(!!t,20021),t)))}Dr(e,t){return WT(e).put(rx,t)}Cr(e,t){if(t){const n=yP(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Me.min())))return n}return Ft.newInvalidDocument(e)}}function MA(s){return new RP(s)}class kP extends PA{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Ka((n=>n.toString()),((n,a)=>n.isEqual(a)))}applyChanges(e){const t=[];let n=0,a=new jt(((l,u)=>qe(l.canonicalString(),u.canonicalString())));return this.changes.forEach(((l,u)=>{const h=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,h.readTime)),u.isValidDocument()){const m=PT(this.Nr.serializer,u);a=a.add(l.path.popLast());const p=wm(m);n+=p-h.size,t.push(this.Nr.addEntry(e,l,m))}else if(n-=h.size,this.trackRemovals){const m=PT(this.Nr.serializer,u.convertToNoDocument(Me.min()));t.push(this.Nr.addEntry(e,l,m))}})),a.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,n)),W.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:n,Or:a})=>(a.forEach(((l,u)=>{this.Br.set(l,{size:u,readTime:n.get(l).readTime})})),n)))}}function WT(s){return In(s,Md)}function Do(s){return In(s,gm)}function id(s){const e=s.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function JT(s,e){const t=e.documentKey.path.toArray();return[s,bm(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ZT(s,e){const t=s.path.toArray(),n=e.path.toArray();let a=0;for(let l=0;l<t.length-2&&l<n.length-2;++l)if(a=qe(t[l],n[l]),a)return a;return a=qe(t.length,n.length),a||(a=qe(t[t.length-2],n[n.length-2]),a||qe(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OA{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((a=>(n=a,this.remoteDocumentCache.getEntry(e,t)))).next((a=>(n!==null&&Sd(n.mutation,a,Ts.empty(),_t.now()),a)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,Xe()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=Xe()){const a=aa();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,n).next((l=>{let u=md();return l.forEach(((h,m)=>{u=u.insert(h,m.overlayedDocument)})),u}))))}getOverlayedDocuments(e,t){const n=aa();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Xe())))}populateOverlays(e,t,n){const a=[];return n.forEach((l=>{t.has(l)||a.push(l)})),this.documentOverlayCache.getOverlays(e,a).next((l=>{l.forEach(((u,h)=>{t.set(u,h)}))}))}computeViews(e,t,n,a){let l=Es();const u=Nd(),h=(function(){return Nd()})();return t.forEach(((m,p)=>{const x=n.get(p.key);a.has(p.key)&&(x===void 0||x.mutation instanceof Qa)?l=l.insert(p.key,p):x!==void 0?(u.set(p.key,x.mutation.getFieldMask()),Sd(x.mutation,p,x.mutation.getFieldMask(),_t.now())):u.set(p.key,Ts.empty())})),this.recalculateAndSaveOverlays(e,l).next((m=>(m.forEach(((p,x)=>u.set(p,x))),t.forEach(((p,x)=>h.set(p,new DP(x,u.get(p)??null)))),h)))}recalculateAndSaveOverlays(e,t){const n=Nd();let a=new Ut(((u,h)=>u-h)),l=Xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((u=>{for(const h of u)h.keys().forEach((m=>{const p=t.get(m);if(p===null)return;let x=n.get(m)||Ts.empty();x=h.applyToLocalView(p,x),n.set(m,x);const _=(a.get(h.batchId)||Xe()).add(m);a=a.insert(h.batchId,_)}))})).next((()=>{const u=[],h=a.getReverseIterator();for(;h.hasNext();){const m=h.getNext(),p=m.key,x=m.value,_=WS();x.forEach((b=>{if(!l.has(b)){const N=rA(t.get(b),n.get(b));N!==null&&_.set(b,N),l=l.add(b)}})),u.push(this.documentOverlayCache.saveOverlays(e,p,_))}return W.waitFor(u)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,a){return(function(u){return Te.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rv(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next((l=>{const u=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-l.size):W.resolve(aa());let h=_c,m=l;return u.next((p=>W.forEach(p,((x,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),l.get(x)?W.resolve():this.remoteDocumentCache.getEntry(e,x).next((b=>{m=m.insert(x,b)}))))).next((()=>this.populateOverlays(e,p,l))).next((()=>this.computeViews(e,m,p,Xe()))).next((x=>({batchId:h,changes:XS(x)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Te(t)).next((n=>{let a=md();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const l=t.collectionGroup;let u=md();return this.indexManager.getCollectionParents(e,l).next((h=>W.forEach(h,(m=>{const p=(function(_,b){return new $a(b,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,n,a).next((x=>{x.forEach(((_,b)=>{u=u.insert(_,b)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,t,n,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,l,a)))).next((u=>{l.forEach(((m,p)=>{const x=p.getKey();u.get(x)===null&&(u=u.insert(x,Ft.newInvalidDocument(x)))}));let h=md();return u.forEach(((m,p)=>{const x=l.get(m);x!==void 0&&Sd(x.mutation,p,Ts.empty(),_t.now()),th(t,p)&&(h=h.insert(m,p))})),h}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return W.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(a){return{id:a.id,version:a.version,createTime:hn(a.createTime)}})(t)),W.resolve()}getNamedQuery(e,t){return W.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(a){return{name:a.name,query:tg(a.bundledQuery),readTime:hn(a.readTime)}})(t)),W.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(){this.overlays=new Ut(Te.comparator),this.qr=new Map}getOverlay(e,t){return W.resolve(this.overlays.get(t))}getOverlays(e,t){const n=aa();return W.forEach(t,(a=>this.getOverlay(e,a).next((l=>{l!==null&&n.set(a,l)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((a,l)=>{this.St(e,t,l)})),W.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.qr.get(n);return a!==void 0&&(a.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(n)),W.resolve()}getOverlaysForCollection(e,t,n){const a=aa(),l=t.length+1,u=new Te(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const m=h.getNext().value,p=m.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&m.largestBatchId>n&&a.set(m.getKey(),m)}return W.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let l=new Ut(((p,x)=>p-x));const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>n){let x=l.get(p.largestBatchId);x===null&&(x=aa(),l=l.insert(p.largestBatchId,x)),x.set(p.getKey(),p)}}const h=aa(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach(((p,x)=>h.set(p,x))),!(h.size()>=a)););return W.resolve(h)}St(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const u=this.qr.get(a.largestBatchId).delete(n.key);this.qr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(n.key,new uv(t,n));let l=this.qr.get(t);l===void 0&&(l=Xe(),this.qr.set(t,l)),this.qr.set(t,l.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(){this.sessionToken=en.EMPTY_BYTE_STRING}getSessionToken(e){return W.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,W.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(){this.Qr=new jt(Bn.$r),this.Ur=new jt(Bn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Bn(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new Bn(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new Te(new tt([])),n=new Bn(t,e),a=new Bn(t,e+1),l=[];return this.Ur.forEachInRange([n,a],(u=>{this.Gr(u),l.push(u.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Te(new tt([])),n=new Bn(t,e),a=new Bn(t,e+1);let l=Xe();return this.Ur.forEachInRange([n,a],(u=>{l=l.add(u.key)})),l}containsKey(e){const t=new Bn(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Bn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Te.comparator(e.key,t.key)||qe(e.Yr,t.Yr)}static Kr(e,t){return qe(e.Yr,t.Yr)||Te.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new jt(Bn.$r)}checkEmpty(e){return W.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new lv(l,t,n,a);this.mutationQueue.push(u);for(const h of a)this.Zr=this.Zr.add(new Bn(h.key,l)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return W.resolve(u)}lookupMutationBatch(e,t){return W.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.ei(n),l=a<0?0:a;return W.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return W.resolve(this.mutationQueue.length===0?Fi:this.tr-1)}getAllMutationBatches(e){return W.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Bn(t,0),a=new Bn(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([n,a],(u=>{const h=this.Xr(u.Yr);l.push(h)})),W.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new jt(qe);return t.forEach((a=>{const l=new Bn(a,0),u=new Bn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,u],(h=>{n=n.add(h.Yr)}))})),W.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let l=n;Te.isDocumentKey(l)||(l=l.child(""));const u=new Bn(new Te(l),0);let h=new jt(qe);return this.Zr.forEachWhile((m=>{const p=m.key.path;return!!n.isPrefixOf(p)&&(p.length===a&&(h=h.add(m.Yr)),!0)}),u),W.resolve(this.ti(h))}ti(e){const t=[];return e.forEach((n=>{const a=this.Xr(n);a!==null&&t.push(a)})),t}removeMutationBatch(e,t){ke(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return W.forEach(t.mutations,(a=>{const l=new Bn(a.key,t.batchId);return n=n.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new Bn(t,0),a=this.Zr.firstAfterOrEqual(n);return W.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,W.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(e){this.ri=e,this.docs=(function(){return new Ut(Te.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),l=a?a.size:0,u=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return W.resolve(n?n.document.mutableCopy():Ft.newInvalidDocument(t))}getEntries(e,t){let n=Es();return t.forEach((a=>{const l=this.docs.get(a);n=n.insert(a,l?l.document.mutableCopy():Ft.newInvalidDocument(a))})),W.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let l=Es();const u=t.path,h=new Te(u.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(h);for(;m.hasNext();){const{key:p,value:{document:x}}=m.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||Yx(uS(x),n)<=0||(a.has(x.key)||th(t,x))&&(l=l.insert(x.key,x.mutableCopy()))}return W.resolve(l)}getAllFromCollectionGroup(e,t,n,a){Ae(9500)}ii(e,t){return W.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new UP(this)}getSize(e){return W.resolve(this.size)}}class UP extends PA{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,a)=>{a.isValidDocument()?t.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(n)})),W.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FP{constructor(e){this.persistence=e,this.si=new Ka((t=>Wo(t)),Zd),this.lastRemoteSnapshotVersion=Me.min(),this.highestTargetId=0,this.oi=0,this._i=new gv,this.targetCount=0,this.ai=nl.ur()}forEachTarget(e,t){return this.si.forEach(((n,a)=>t(a))),W.resolve()}getLastRemoteSnapshotVersion(e){return W.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return W.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),W.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),W.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new nl(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,W.resolve()}updateTargetData(e,t){return this.Pr(t),W.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,W.resolve()}removeTargets(e,t,n){let a=0;const l=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=t&&n.get(h.targetId)===null&&(this.si.delete(u),l.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),W.waitFor(l).next((()=>a))}getTargetCount(e){return W.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return W.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),W.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const a=this.persistence.referenceDelegate,l=[];return a&&t.forEach((u=>{l.push(a.markPotentiallyOrphaned(e,u))})),W.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),W.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return W.resolve(n)}containsKey(e,t){return W.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e,t){this.ui={},this.overlays={},this.ci=new ws(0),this.li=!1,this.li=!0,this.hi=new OP,this.referenceDelegate=e(this),this.Pi=new FP(this),this.indexManager=new NP,this.remoteDocumentCache=(function(a){return new LP(a)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new TA(t),this.Ii=new PP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new MP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new VP(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){ge("MemoryPersistence","Starting transaction:",e);const a=new BP(this.ci.next());return this.referenceDelegate.Ei(),n(a).next((l=>this.referenceDelegate.di(a).next((()=>l)))).toPromise().then((l=>(a.raiseOnCommittedEvent(),l)))}Ai(e,t){return W.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class BP extends hS{constructor(e){super(),this.currentSequenceNumber=e}}class rg{constructor(e){this.persistence=e,this.Ri=new gv,this.Vi=null}static mi(e){return new rg(e)}get fi(){if(this.Vi)return this.Vi;throw Ae(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),W.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),W.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),W.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((a=>this.fi.add(a.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((a=>{a.forEach((l=>this.fi.add(l.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return W.forEach(this.fi,(n=>{const a=Te.fromPath(n);return this.gi(e,a).next((l=>{l||t.removeEntry(a,Me.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return W.or([()=>W.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Tm{constructor(e,t){this.persistence=e,this.pi=new Ka((n=>os(n.path)),((n,a)=>n.isEqual(a))),this.garbageCollector=DA(this,t)}static mi(e,t){return new Tm(e,t)}Ei(){}di(e){return W.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((a=>n+a))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return W.forEach(this.pi,((n,a)=>this.br(e,n,a).next((l=>l?W.resolve():t(a)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ii(e,(u=>this.br(e,u,t).next((h=>{h||(n++,l.removeEntry(u,Me.min()))})))).next((()=>l.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),W.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),W.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),W.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),W.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Yf(e.data.value)),t}br(e,t,n){return W.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const a=this.pi.get(t);return W.resolve(a!==void 0&&a>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(e){this.serializer=e}k(e,t,n,a){const l=new Hm("createOrUpgrade",t);n<1&&a>=1&&((function(m){m.createObjectStore(Jd)})(e),(function(m){m.createObjectStore(Pd,{keyPath:iD}),m.createObjectStore(Rr,{keyPath:uT,autoIncrement:!0}).createIndex(qo,dT,{unique:!0}),m.createObjectStore(Ec)})(e),eE(e),(function(m){m.createObjectStore(Oo)})(e));let u=W.resolve();return n<3&&a>=3&&(n!==0&&((function(m){m.deleteObjectStore(Sc),m.deleteObjectStore(Nc),m.deleteObjectStore(Go)})(e),eE(e)),u=u.next((()=>(function(m){const p=m.store(Go),x={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Me.min().toTimestamp(),targetCount:0};return p.put(pm,x)})(l)))),n<4&&a>=4&&(n!==0&&(u=u.next((()=>(function(m,p){return p.store(Rr).J().next((_=>{m.deleteObjectStore(Rr),m.createObjectStore(Rr,{keyPath:uT,autoIncrement:!0}).createIndex(qo,dT,{unique:!0});const b=p.store(Rr),N=_.map((C=>b.put(C)));return W.waitFor(N)}))})(e,l)))),u=u.next((()=>{(function(m){m.createObjectStore(Ac,{keyPath:gD})})(e)}))),n<5&&a>=5&&(u=u.next((()=>this.yi(l)))),n<6&&a>=6&&(u=u.next((()=>((function(m){m.createObjectStore(Md)})(e),this.wi(l))))),n<7&&a>=7&&(u=u.next((()=>this.Si(l)))),n<8&&a>=8&&(u=u.next((()=>this.bi(e,l)))),n<9&&a>=9&&(u=u.next((()=>{(function(m){m.objectStoreNames.contains("remoteDocumentChanges")&&m.deleteObjectStore("remoteDocumentChanges")})(e)}))),n<10&&a>=10&&(u=u.next((()=>this.Di(l)))),n<11&&a>=11&&(u=u.next((()=>{(function(m){m.createObjectStore(Gm,{keyPath:pD})})(e),(function(m){m.createObjectStore($m,{keyPath:yD})})(e)}))),n<12&&a>=12&&(u=u.next((()=>{(function(m){const p=m.createObjectStore(Km,{keyPath:ED});p.createIndex(ix,ND,{unique:!1}),p.createIndex(bS,SD,{unique:!1})})(e)}))),n<13&&a>=13&&(u=u.next((()=>(function(m){const p=m.createObjectStore(gm,{keyPath:lD});p.createIndex(Kf,cD),p.createIndex(pS,uD)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(Oo)))),n<14&&a>=14&&(u=u.next((()=>this.Fi(e,l)))),n<15&&a>=15&&(u=u.next((()=>(function(m){m.createObjectStore(Jx,{keyPath:xD,autoIncrement:!0}).createIndex(ax,vD,{unique:!1}),m.createObjectStore(wd,{keyPath:bD}).createIndex(xS,_D,{unique:!1}),m.createObjectStore(Td,{keyPath:wD}).createIndex(vS,TD,{unique:!1})})(e)))),n<16&&a>=16&&(u=u.next((()=>{t.objectStore(wd).clear()})).next((()=>{t.objectStore(Td).clear()}))),n<17&&a>=17&&(u=u.next((()=>{(function(m){m.createObjectStore(Zx,{keyPath:AD})})(e)}))),n<18&&a>=18&&lN()&&(u=u.next((()=>{t.objectStore(wd).clear()})).next((()=>{t.objectStore(Td).clear()}))),u}wi(e){let t=0;return e.store(Oo).ee(((n,a)=>{t+=wm(a)})).next((()=>{const n={byteSize:t};return e.store(Md).put(rx,n)}))}yi(e){const t=e.store(Pd),n=e.store(Rr);return t.J().next((a=>W.forEach(a,(l=>{const u=IDBKeyRange.bound([l.userId,Fi],[l.userId,l.lastAcknowledgedBatchId]);return n.J(qo,u).next((h=>W.forEach(h,(m=>{ke(m.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:m.batchId});const p=Lo(this.serializer,m);return jA(e,l.userId,p).next((()=>{}))}))))}))))}Si(e){const t=e.store(Sc),n=e.store(Oo);return e.store(Go).get(pm).next((a=>{const l=[];return n.ee(((u,h)=>{const m=new tt(u),p=(function(_){return[0,os(_)]})(m);l.push(t.get(p).next((x=>x?W.resolve():(_=>t.put({targetId:0,path:os(_),sequenceNumber:a.highestListenSequenceNumber}))(m))))})).next((()=>W.waitFor(l)))}))}bi(e,t){e.createObjectStore(Od,{keyPath:mD});const n=t.store(Od),a=new mv,l=u=>{if(a.add(u)){const h=u.lastSegment(),m=u.popLast();return n.put({collectionId:h,parent:os(m)})}};return t.store(Oo).ee({X:!0},((u,h)=>{const m=new tt(u);return l(m.popLast())})).next((()=>t.store(Ec).ee({X:!0},(([u,h,m],p)=>{const x=ra(h);return l(x.popLast())}))))}Di(e){const t=e.store(Nc);return t.ee(((n,a)=>{const l=pd(a),u=EA(this.serializer,l);return t.put(u)}))}Ci(e,t){const n=t.store(Oo),a=[];return n.ee(((l,u)=>{const h=t.store(gm),m=(function(_){return _.document?new Te(tt.fromString(_.document.name).popFirst(5)):_.noDocument?Te.fromSegments(_.noDocument.path):_.unknownDocument?Te.fromSegments(_.unknownDocument.path):Ae(36783)})(u).path.toArray(),p={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};a.push(h.put(p))})).next((()=>W.waitFor(a)))}Fi(e,t){const n=t.store(Rr),a=MA(this.serializer),l=new pv(rg.mi,this.serializer.yt);return n.J().next((u=>{const h=new Map;return u.forEach((m=>{let p=h.get(m.userId)??Xe();Lo(this.serializer,m).keys().forEach((x=>p=p.add(x))),h.set(m.userId,p)})),W.forEach(h,((m,p)=>{const x=new qn(p),_=ng.wt(this.serializer,x),b=l.getIndexManager(x),N=sg.wt(x,this.serializer,b,l.referenceDelegate);return new OA(a,N,_,b).recalculateAndSaveOverlaysForDocumentKeys(new ox(t,ws.ce),m).next()}))}))}}function eE(s){s.createObjectStore(Sc,{keyPath:hD}).createIndex(Wx,fD,{unique:!0}),s.createObjectStore(Nc,{keyPath:"targetId"}).createIndex(yS,dD,{unique:!0}),s.createObjectStore(Go)}const Si="IndexedDbPersistence",Iy=18e5,Cy=5e3,Ry="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",VA="main";class yv{constructor(e,t,n,a,l,u,h,m,p,x,_=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=l,this.window=u,this.document=h,this.xi=p,this.Oi=x,this.Ni=_,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=b=>Promise.resolve(),!yv.v())throw new he(ne.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new CP(this,a),this.$i=t+VA,this.serializer=new TA(m),this.Ui=new oa(this.$i,this.Ni,new qP(this.serializer)),this.hi=new vP,this.Pi=new AP(this.referenceDelegate,this.serializer),this.remoteDocumentCache=MA(this.serializer),this.Ii=new xP,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,x===!1&&dn(Si,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new he(ne.FAILED_PRECONDITION,Ry);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new ws(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Pf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(Xi(e))return ge(Si,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ge(Si,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return od(e).get(nc).next((t=>W.resolve(this.es(t))))}ts(e){return Pf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Iy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const n=In(t,Ac);return n.J().next((a=>{const l=this.ss(a,Iy),u=a.filter((h=>l.indexOf(h)===-1));return W.forEach(u,(h=>n.delete(h.clientId))).next((()=>u))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?W.resolve(!0):od(e).get(nc).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Cy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new he(ne.FAILED_PRECONDITION,Ry);return!1}}return!(!this.networkEnabled||!this.inForeground)||Pf(e).J().next((n=>this.ss(n,Cy).find((a=>{if(this.clientId!==a.clientId){const l=!this.networkEnabled&&a.networkEnabled,u=!this.inForeground&&a.inForeground,h=this.networkEnabled===a.networkEnabled;if(l||u&&h)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&ge(Si,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Jd,Ac],(e=>{const t=new ox(e,ws.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>Pf(e).J().next((t=>this.ss(t,Iy).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return sg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new SP(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return ng.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){ge(Si,"Starting transaction:",e);const a=t==="readonly"?"readonly":"readwrite",l=(function(m){return m===18?CD:m===17?ES:m===16?ID:m===15?ev:m===14?TS:m===13?wS:m===12?jD:m===11?_S:void Ae(60245)})(this.Ni);let u;return this.Ui.runTransaction(e,a,l,(h=>(u=new ox(h,this.ci?this.ci.next():ws.ce),t==="readwrite-primary"?this.Hi(u).next((m=>!!m||this.Yi(u))).next((m=>{if(!m)throw dn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new he(ne.FAILED_PRECONDITION,dS);return n(u)})).next((m=>this.Xi(u).next((()=>m)))):this.Is(u).next((()=>n(u)))))).then((h=>(u.raiseOnCommittedEvent(),h)))}Is(e){return od(e).get(nc).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Cy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new he(ne.FAILED_PRECONDITION,Ry)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return od(e).put(nc,t)}static v(){return oa.v()}Zi(e){const t=od(e);return t.get(nc).next((n=>this.es(n)?(ge(Si,"Releasing primary lease."),t.delete(nc)):W.resolve()))}rs(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(dn(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;oN()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return ge(Si,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return dn(Si,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){dn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function od(s){return In(s,Jd)}function Pf(s){return In(s,Ac)}function xv(s,e){let t=s.projectId;return s.isDefaultDatabase||(t+="."+s.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=a}static As(e,t){let n=Xe(),a=Xe();for(const l of t.docChanges)switch(l.type){case 0:n=n.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new vv(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return oN()?8:fS(An())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,a){const l={result:null};return this.ys(e,t).next((u=>{l.result=u})).next((()=>{if(!l.result)return this.ws(e,t,a,n).next((u=>{l.result=u}))})).next((()=>{if(l.result)return;const u=new zP;return this.Ss(e,t,u).next((h=>{if(l.result=h,this.Vs)return this.bs(e,t,u,h.size)}))})).next((()=>l.result))}bs(e,t,n,a){return n.documentReadCount<this.fs?(uc()<=it.DEBUG&&ge("QueryEngine","SDK will not create cache indexes for query:",dc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),W.resolve()):(uc()<=it.DEBUG&&ge("QueryEngine","Query:",dc(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.gs*a?(uc()<=it.DEBUG&&ge("QueryEngine","The SDK decides to create cache indexes for query:",dc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ls(t))):W.resolve())}ys(e,t){if(ET(t))return W.resolve(null);let n=ls(t);return this.indexManager.getIndexType(e,n).next((a=>a===0?null:(t.limit!==null&&a===1&&(t=vm(t,null,"F"),n=ls(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((l=>{const u=Xe(...l);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,n).next((m=>{const p=this.Ds(t,h);return this.Cs(t,p,u,m.readTime)?this.ys(e,vm(t,null,"F")):this.vs(e,p,t,m)}))))})))))}ws(e,t,n,a){return ET(t)||a.isEqual(Me.min())?W.resolve(null):this.ps.getDocuments(e,n).next((l=>{const u=this.Ds(t,l);return this.Cs(t,u,n,a)?W.resolve(null):(uc()<=it.DEBUG&&ge("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),dc(t)),this.vs(e,u,t,cS(a,_c)).next((h=>h)))}))}Ds(e,t){let n=new jt(QS(e));return t.forEach(((a,l)=>{th(e,l)&&(n=n.add(l))})),n}Cs(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Ss(e,t,n){return uc()<=it.DEBUG&&ge("QueryEngine","Using full collection scan to execute query:",dc(t)),this.ps.getDocumentsMatchingQuery(e,t,Ws.min(),n)}vs(e,t,n,a){return this.ps.getDocumentsMatchingQuery(e,n,a).next((l=>(t.forEach((u=>{l=l.insert(u.key,u)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bv="LocalStore",HP=3e8;class GP{constructor(e,t,n,a){this.persistence=e,this.Fs=t,this.serializer=a,this.Ms=new Ut(qe),this.xs=new Ka((l=>Wo(l)),Zd),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new OA(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function UA(s,e,t,n){return new GP(s,e,t,n)}async function FA(s,e){const t=Ee(s);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next((l=>(a=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((l=>{const u=[],h=[];let m=Xe();for(const p of a){u.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}for(const p of l){h.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}return t.localDocuments.getDocuments(n,m).next((p=>({Ls:p,removedBatchIds:u,addedBatchIds:h})))}))}))}function $P(s,e){const t=Ee(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const a=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,m,p,x){const _=p.batch,b=_.keys();let N=W.resolve();return b.forEach((C=>{N=N.next((()=>x.getEntry(m,C))).next((k=>{const L=p.docVersions.get(C);ke(L!==null,48541),k.version.compareTo(L)<0&&(_.applyToRemoteDocument(k,p),k.isValidDocument()&&(k.setReadTime(p.commitVersion),x.addEntry(k)))}))})),N.next((()=>h.mutationQueue.removeMutationBatch(m,_)))})(t,n,e,l).next((()=>l.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(h){let m=Xe();for(let p=0;p<h.mutationResults.length;++p)h.mutationResults[p].transformResults.length>0&&(m=m.add(h.batch.mutations[p].key));return m})(e)))).next((()=>t.localDocuments.getDocuments(n,a)))}))}function BA(s){const e=Ee(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function KP(s,e){const t=Ee(s),n=e.snapshotVersion;let a=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const u=t.Ns.newChangeBuffer({trackRemovals:!0});a=t.Ms;const h=[];e.targetChanges.forEach(((x,_)=>{const b=a.get(_);if(!b)return;h.push(t.Pi.removeMatchingKeys(l,x.removedDocuments,_).next((()=>t.Pi.addMatchingKeys(l,x.addedDocuments,_))));let N=b.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(_)!==null?N=N.withResumeToken(en.EMPTY_BYTE_STRING,Me.min()).withLastLimboFreeSnapshotVersion(Me.min()):x.resumeToken.approximateByteSize()>0&&(N=N.withResumeToken(x.resumeToken,n)),a=a.insert(_,N),(function(k,L,F){return k.resumeToken.approximateByteSize()===0||L.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=HP?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0})(b,N,x)&&h.push(t.Pi.updateTargetData(l,N))}));let m=Es(),p=Xe();if(e.documentUpdates.forEach((x=>{e.resolvedLimboDocuments.has(x)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(l,x))})),h.push(qA(l,u,e.documentUpdates).next((x=>{m=x.ks,p=x.qs}))),!n.isEqual(Me.min())){const x=t.Pi.getLastRemoteSnapshotVersion(l).next((_=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,n)));h.push(x)}return W.waitFor(h).next((()=>u.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,m,p))).next((()=>m))})).then((l=>(t.Ms=a,l)))}function qA(s,e,t){let n=Xe(),a=Xe();return t.forEach((l=>n=n.add(l))),e.getEntries(s,n).next((l=>{let u=Es();return t.forEach(((h,m)=>{const p=l.get(h);m.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(h)),m.isNoDocument()&&m.version.isEqual(Me.min())?(e.removeEntry(h,m.readTime),u=u.insert(h,m)):!p.isValidDocument()||m.version.compareTo(p.version)>0||m.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(m),u=u.insert(h,m)):ge(bv,"Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",m.version)})),{ks:u,qs:a}}))}function QP(s,e){const t=Ee(s);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Fi),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function Pc(s,e){const t=Ee(s);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let a;return t.Pi.getTargetData(n,e).next((l=>l?(a=l,W.resolve(a)):t.Pi.allocateTargetId(n).next((u=>(a=new Va(e,u,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,a).next((()=>a)))))))})).then((n=>{const a=t.Ms.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function Mc(s,e,t){const n=Ee(s),a=n.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",l,(u=>n.persistence.referenceDelegate.removeTarget(u,a)))}catch(u){if(!Xi(u))throw u;ge(bv,`Failed to update sequence numbers for target ${e}: ${u}`)}n.Ms=n.Ms.remove(e),n.xs.delete(a.target)}function Em(s,e,t){const n=Ee(s);let a=Me.min(),l=Xe();return n.persistence.runTransaction("Execute query","readwrite",(u=>(function(m,p,x){const _=Ee(m),b=_.xs.get(x);return b!==void 0?W.resolve(_.Ms.get(b)):_.Pi.getTargetData(p,x)})(n,u,ls(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(u,h.targetId).next((m=>{l=m}))})).next((()=>n.Fs.getDocumentsMatchingQuery(u,e,t?a:Me.min(),t?l:Xe()))).next((h=>(GA(n,KS(e),h),{documents:h,Qs:l})))))}function zA(s,e){const t=Ee(s),n=Ee(t.Pi),a=t.Ms.get(e);return a?Promise.resolve(a.target):t.persistence.runTransaction("Get target data","readonly",(l=>n.At(l,e).next((u=>u?u.target:null))))}function HA(s,e){const t=Ee(s),n=t.Os.get(e)||Me.min();return t.persistence.runTransaction("Get new document changes","readonly",(a=>t.Ns.getAllFromCollectionGroup(a,e,cS(n,_c),Number.MAX_SAFE_INTEGER))).then((a=>(GA(t,e,a),a)))}function GA(s,e,t){let n=s.Os.get(e)||Me.min();t.forEach(((a,l)=>{l.readTime.compareTo(n)>0&&(n=l.readTime)})),s.Os.set(e,n)}async function YP(s,e,t,n){const a=Ee(s);let l=Xe(),u=Es();for(const p of t){const x=e.$s(p.metadata.name);p.document&&(l=l.add(x));const _=e.Us(p);_.setReadTime(e.Ks(p.metadata.readTime)),u=u.insert(x,_)}const h=a.Ns.newChangeBuffer({trackRemovals:!0}),m=await Pc(a,(function(x){return ls($c(tt.fromString(`__bundle__/docs/${x}`)))})(n));return a.persistence.runTransaction("Apply bundle documents","readwrite",(p=>qA(p,h,u).next((x=>(h.apply(p),x))).next((x=>a.Pi.removeMatchingKeysForTargetId(p,m.targetId).next((()=>a.Pi.addMatchingKeys(p,l,m.targetId))).next((()=>a.localDocuments.getLocalViewOfDocuments(p,x.ks,x.qs))).next((()=>x.ks))))))}async function XP(s,e,t=Xe()){const n=await Pc(s,ls(tg(e.bundledQuery))),a=Ee(s);return a.persistence.runTransaction("Save named query","readwrite",(l=>{const u=hn(e.readTime);if(n.snapshotVersion.compareTo(u)>=0)return a.Ii.saveNamedQuery(l,e);const h=n.withResumeToken(en.EMPTY_BYTE_STRING,u);return a.Ms=a.Ms.insert(h.targetId,h),a.Pi.updateTargetData(l,h).next((()=>a.Pi.removeMatchingKeysForTargetId(l,n.targetId))).next((()=>a.Pi.addMatchingKeys(l,t,n.targetId))).next((()=>a.Ii.saveNamedQuery(l,e)))}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $A="firestore_clients";function tE(s,e){return`${$A}_${s}_${e}`}const KA="firestore_mutations";function nE(s,e,t){let n=`${KA}_${s}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}const QA="firestore_targets";function ky(s,e){return`${QA}_${s}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta="SharedClientState";class Nm{constructor(e,t,n,a){this.user=e,this.batchId=t,this.state=n,this.error=a}static Ws(e,t,n){const a=JSON.parse(n);let l,u=typeof a=="object"&&["pending","acknowledged","rejected"].indexOf(a.state)!==-1&&(a.error===void 0||typeof a.error=="object");return u&&a.error&&(u=typeof a.error.message=="string"&&typeof a.error.code=="string",u&&(l=new he(a.error.code,a.error.message))),u?new Nm(e,t,a.state,l):(dn(ta,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ad{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ws(e,t){const n=JSON.parse(t);let a,l=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return l&&n.error&&(l=typeof n.error.message=="string"&&typeof n.error.code=="string",l&&(a=new he(n.error.code,n.error.message))),l?new Ad(e,n.state,a):(dn(ta,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sm{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const n=JSON.parse(t);let a=typeof n=="object"&&n.activeTargetIds instanceof Array,l=av();for(let u=0;a&&u<n.activeTargetIds.length;++u)a=mS(n.activeTargetIds[u]),l=l.add(n.activeTargetIds[u]);return a?new Sm(e,l):(dn(ta,`Failed to parse client data for instance '${e}': ${t}`),null)}}class _v{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new _v(t.clientId,t.onlineState):(dn(ta,`Failed to parse online state: ${e}`),null)}}class wx{constructor(){this.activeTargetIds=av()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Dy{constructor(e,t,n,a,l){this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=a,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Ut(qe),this.started=!1,this.Xs=[];const u=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.eo=tE(this.persistenceKey,this.Js),this.no=(function(m){return`firestore_sequence_number_${m}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new wx),this.ro=new RegExp(`^${$A}_${u}_([^_]*)$`),this.io=new RegExp(`^${KA}_${u}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${QA}_${u}_(\\d+)$`),this.oo=(function(m){return`firestore_online_state_${m}`})(this.persistenceKey),this._o=(function(m){return`firestore_bundle_loaded_v2_${m}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const n of e){if(n===this.Js)continue;const a=this.getItem(tE(this.persistenceKey,n));if(a){const l=Sm.Ws(n,a);l&&(this.Zs=this.Zs.insert(l.clientId,l))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const n=this.uo(t);n&&this.co(n)}for(const n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((n,a)=>{a.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const a=this.storage.getItem(ky(this.persistenceKey,e));if(a){const l=Ad.Ws(e,a);l&&(n=l.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ky(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach((a=>{this.Po(a)})),this.currentUser=e,n.forEach((a=>{this.addPendingMutation(a)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ge(ta,"READ",e,t),t}setItem(e,t){ge(ta,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ge(ta,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(ge(ta,"EVENT",t.key,t.newValue),t.key===this.eo)return void dn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const n=this.Ro(t.key);return this.Vo(n,null)}{const n=this.mo(t.key,t.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(t.key)){if(t.newValue!==null){const n=this.fo(t.key,t.newValue);if(n)return this.po(n)}}else if(this.so.test(t.key)){if(t.newValue!==null){const n=this.yo(t.key,t.newValue);if(n)return this.wo(n)}}else if(t.key===this.oo){if(t.newValue!==null){const n=this.uo(t.newValue);if(n)return this.co(n)}}else if(t.key===this.no){const n=(function(l){let u=ws.ce;if(l!=null)try{const h=JSON.parse(l);ke(typeof h=="number",30636,{So:l}),u=h}catch(h){dn(ta,"Failed to read sequence number from WebStorage",h)}return u})(t.newValue);n!==ws.ce&&this.sequenceNumberHandler(n)}else if(t.key===this._o){const n=this.bo(t.newValue);await Promise.all(n.map((a=>this.syncEngine.Do(a))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){const a=new Nm(this.currentUser,e,t,n),l=nE(this.persistenceKey,this.currentUser,e);this.setItem(l,a.Gs())}Po(e){const t=nE(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){const a=ky(this.persistenceKey,e),l=new Ad(e,t,n);this.setItem(a,l.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const n=this.Ro(e);return Sm.Ws(n,t)}fo(e,t){const n=this.io.exec(e),a=Number(n[1]),l=n[2]!==void 0?n[2]:null;return Nm.Ws(new qn(l),a,t)}yo(e,t){const n=this.so.exec(e),a=Number(n[1]);return Ad.Ws(a,t)}uo(e){return _v.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);ge(ta,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const n=t?this.Zs.insert(e,t):this.Zs.remove(e),a=this.lo(this.Zs),l=this.lo(n),u=[],h=[];return l.forEach((m=>{a.has(m)||u.push(m)})),a.forEach((m=>{l.has(m)||h.push(m)})),this.syncEngine.Fo(u,h).then((()=>{this.Zs=n}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=av();return e.forEach(((n,a)=>{t=t.unionWith(a.activeTargetIds)})),t}}class YA{constructor(){this.Mo=new wx,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new wx,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE="ConnectivityMonitor";class rE{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ge(sE,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ge(sE,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mf=null;function Tx(){return Mf===null?Mf=(function(){return 268435456+Math.round(2147483648*Math.random())})():Mf++,"0x"+Mf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Py="RestConnection",JP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ZP{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${a}`,this.Wo=this.databaseId.database===Ld?`project_id=${n}`:`project_id=${n}&database_id=${a}`}Go(e,t,n,a,l){const u=Tx(),h=this.zo(e,t.toUriEncodedString());ge(Py,`Sending RPC '${e}' ${u}:`,h,n);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,a,l);const{host:p}=new URL(h),x=Ga(p);return this.Jo(e,h,m,n,x).then((_=>(ge(Py,`Received RPC '${e}' ${u}: `,_),_)),(_=>{throw Xs(Py,`RPC '${e}' ${u} failed with error: `,_,"url: ",h,"request:",n),_}))}Ho(e,t,n,a,l,u){return this.Go(e,t,n,a,l)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Gc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((a,l)=>e[l]=a)),n&&n.headers.forEach(((a,l)=>e[l]=a))}zo(e,t){const n=JP[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ss="WebChannelConnection";class t4 extends ZP{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,a,l){const u=Tx();return new Promise(((h,m)=>{const p=new WN;p.setWithCredentials(!0),p.listenOnce(JN.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case Gf.NO_ERROR:const _=p.getResponseJson();ge(ss,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(_)),h(_);break;case Gf.TIMEOUT:ge(ss,`RPC '${e}' ${u} timed out`),m(new he(ne.DEADLINE_EXCEEDED,"Request time out"));break;case Gf.HTTP_ERROR:const b=p.getStatus();if(ge(ss,`RPC '${e}' ${u} failed with status:`,b,"response text:",p.getResponseText()),b>0){let N=p.getResponseJson();Array.isArray(N)&&(N=N[0]);const C=N?.error;if(C&&C.status&&C.message){const k=(function(F){const U=F.toLowerCase().replace(/_/g,"-");return Object.values(ne).indexOf(U)>=0?U:ne.UNKNOWN})(C.status);m(new he(k,C.message))}else m(new he(ne.UNKNOWN,"Server responded with status "+p.getStatus()))}else m(new he(ne.UNAVAILABLE,"Connection failed."));break;default:Ae(9055,{l_:e,streamId:u,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{ge(ss,`RPC '${e}' ${u} completed.`)}}));const x=JSON.stringify(a);ge(ss,`RPC '${e}' ${u} sending request:`,a),p.send(t,"POST",x,n,15)}))}T_(e,t,n){const a=Tx(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=tS(),h=eS(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(m.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,n),m.encodeInitMessageHeaders=!0;const x=l.join("");ge(ss,`Creating RPC '${e}' stream ${a}: ${x}`,m);const _=u.createWebChannel(x,m);this.I_(_);let b=!1,N=!1;const C=new e4({Yo:L=>{N?ge(ss,`Not sending because RPC '${e}' stream ${a} is closed:`,L):(b||(ge(ss,`Opening RPC '${e}' stream ${a} transport.`),_.open(),b=!0),ge(ss,`RPC '${e}' stream ${a} sending:`,L),_.send(L))},Zo:()=>_.close()}),k=(L,F,U)=>{L.listen(F,(B=>{try{U(B)}catch(H){setTimeout((()=>{throw H}),0)}}))};return k(_,fd.EventType.OPEN,(()=>{N||(ge(ss,`RPC '${e}' stream ${a} transport opened.`),C.o_())})),k(_,fd.EventType.CLOSE,(()=>{N||(N=!0,ge(ss,`RPC '${e}' stream ${a} transport closed`),C.a_(),this.E_(_))})),k(_,fd.EventType.ERROR,(L=>{N||(N=!0,Xs(ss,`RPC '${e}' stream ${a} transport errored. Name:`,L.name,"Message:",L.message),C.a_(new he(ne.UNAVAILABLE,"The operation could not be completed")))})),k(_,fd.EventType.MESSAGE,(L=>{if(!N){const F=L.data[0];ke(!!F,16349);const U=F,B=U?.error||U[0]?.error;if(B){ge(ss,`RPC '${e}' stream ${a} received error:`,B);const H=B.status;let $=(function(T){const A=pn[T];if(A!==void 0)return lA(A)})(H),M=B.message;$===void 0&&($=ne.INTERNAL,M="Unknown error status: "+H+" with message "+B.message),N=!0,C.a_(new he($,M)),_.close()}else ge(ss,`RPC '${e}' stream ${a} received:`,F),C.u_(F)}})),k(h,ZN.STAT_EVENT,(L=>{L.stat===Zy.PROXY?ge(ss,`RPC '${e}' stream ${a} detected buffering proxy`):L.stat===Zy.NOPROXY&&ge(ss,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XA(){return typeof window<"u"?window:null}function em(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(s){return new oP(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e,t,n=1e3,a=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=a,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),a=Math.max(0,t-n);a>0&&ge("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE="PersistentStream";class WA{constructor(e,t,n,a,l,u,h,m){this.Mi=e,this.S_=n,this.b_=a,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new wv(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ne.RESOURCE_EXHAUSTED?(dn(t.toString()),dn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ne.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,a])=>{this.D_===t&&this.G_(n,a)}),(n=>{e((()=>{const a=new he(ne.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(a)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{n((()=>this.z_(a)))})),this.stream.onMessage((a=>{n((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return ge(aE,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(ge(aE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class n4 extends WA{constructor(e,t,n,a,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,u),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=uP(this.serializer,e),n=(function(l){if(!("targetChange"in l))return Me.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?Me.min():u.readTime?hn(u.readTime):Me.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=yx(this.serializer),t.addTarget=(function(l,u){let h;const m=u.target;if(h=ym(m)?{documents:yA(l,m)}:{query:eg(l,m).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=hA(l,u.resumeToken);const p=gx(l,u.expectedCount);p!==null&&(h.expectedCount=p)}else if(u.snapshotVersion.compareTo(Me.min())>0){h.readTime=Dc(l,u.snapshotVersion.toTimestamp());const p=gx(l,u.expectedCount);p!==null&&(h.expectedCount=p)}return h})(this.serializer,e);const n=hP(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=yx(this.serializer),t.removeTarget=e,this.q_(t)}}class s4 extends WA{constructor(e,t,n,a,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,u),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ke(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ke(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ke(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=dP(e.writeResults,e.commitTime),n=hn(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=yx(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>zd(this.serializer,n)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{}class a4 extends r4{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new he(ne.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Go(e,px(t,n),a,l,u))).catch((l=>{throw l.name==="FirebaseError"?(l.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new he(ne.UNKNOWN,l.toString())}))}Ho(e,t,n,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,px(t,n),a,u,h,l))).catch((u=>{throw u.name==="FirebaseError"?(u.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new he(ne.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class i4{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(dn(t),this.aa=!1):ge("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl="RemoteStore";class o4{constructor(e,t,n,a,l){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((u=>{n.enqueueAndForget((async()=>{Ji(this)&&(ge(sl,"Restarting streams for network reachability change."),await(async function(m){const p=Ee(m);p.Ea.add(4),await Yc(p),p.Ra.set("Unknown"),p.Ea.delete(4),await ah(p)})(this))}))})),this.Ra=new i4(n,a)}}async function ah(s){if(Ji(s))for(const e of s.da)await e(!0)}async function Yc(s){for(const e of s.da)await e(!1)}function ag(s,e){const t=Ee(s);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Nv(t)?Ev(t):Wc(t).O_()&&Tv(t,e))}function Oc(s,e){const t=Ee(s),n=Wc(t);t.Ia.delete(e),n.O_()&&JA(t,e),t.Ia.size===0&&(n.O_()?n.L_():Ji(t)&&t.Ra.set("Unknown"))}function Tv(s,e){if(s.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Me.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wc(s).Y_(e)}function JA(s,e){s.Va.Ue(e),Wc(s).Z_(e)}function Ev(s){s.Va=new sP({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),At:e=>s.Ia.get(e)||null,ht:()=>s.datastore.serializer.databaseId}),Wc(s).start(),s.Ra.ua()}function Nv(s){return Ji(s)&&!Wc(s).x_()&&s.Ia.size>0}function Ji(s){return Ee(s).Ea.size===0}function ZA(s){s.Va=void 0}async function l4(s){s.Ra.set("Online")}async function c4(s){s.Ia.forEach(((e,t)=>{Tv(s,e)}))}async function u4(s,e){ZA(s),Nv(s)?(s.Ra.ha(e),Ev(s)):s.Ra.set("Unknown")}async function d4(s,e,t){if(s.Ra.set("Online"),e instanceof dA&&e.state===2&&e.cause)try{await(async function(a,l){const u=l.cause;for(const h of l.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,u),a.Ia.delete(h),a.Va.removeTarget(h))})(s,e)}catch(n){ge(sl,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Am(s,n)}else if(e instanceof Jf?s.Va.Ze(e):e instanceof uA?s.Va.st(e):s.Va.tt(e),!t.isEqual(Me.min()))try{const n=await BA(s.localStore);t.compareTo(n)>=0&&await(function(l,u){const h=l.Va.Tt(u);return h.targetChanges.forEach(((m,p)=>{if(m.resumeToken.approximateByteSize()>0){const x=l.Ia.get(p);x&&l.Ia.set(p,x.withResumeToken(m.resumeToken,u))}})),h.targetMismatches.forEach(((m,p)=>{const x=l.Ia.get(m);if(!x)return;l.Ia.set(m,x.withResumeToken(en.EMPTY_BYTE_STRING,x.snapshotVersion)),JA(l,m);const _=new Va(x.target,m,p,x.sequenceNumber);Tv(l,_)})),l.remoteSyncer.applyRemoteEvent(h)})(s,t)}catch(n){ge(sl,"Failed to raise snapshot:",n),await Am(s,n)}}async function Am(s,e,t){if(!Xi(e))throw e;s.Ea.add(1),await Yc(s),s.Ra.set("Offline"),t||(t=()=>BA(s.localStore)),s.asyncQueue.enqueueRetryable((async()=>{ge(sl,"Retrying IndexedDB access"),await t(),s.Ea.delete(1),await ah(s)}))}function ej(s,e){return e().catch((t=>Am(s,t,e)))}async function Xc(s){const e=Ee(s),t=$i(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Fi;for(;h4(e);)try{const a=await QP(e.localStore,n);if(a===null){e.Ta.length===0&&t.L_();break}n=a.batchId,f4(e,a)}catch(a){await Am(e,a)}tj(e)&&nj(e)}function h4(s){return Ji(s)&&s.Ta.length<10}function f4(s,e){s.Ta.push(e);const t=$i(s);t.O_()&&t.X_&&t.ea(e.mutations)}function tj(s){return Ji(s)&&!$i(s).x_()&&s.Ta.length>0}function nj(s){$i(s).start()}async function m4(s){$i(s).ra()}async function g4(s){const e=$i(s);for(const t of s.Ta)e.ea(t.mutations)}async function p4(s,e,t){const n=s.Ta.shift(),a=cv.from(n,e,t);await ej(s,(()=>s.remoteSyncer.applySuccessfulWrite(a))),await Xc(s)}async function y4(s,e){e&&$i(s).X_&&await(async function(n,a){if((function(u){return oA(u)&&u!==ne.ABORTED})(a.code)){const l=n.Ta.shift();$i(n).B_(),await ej(n,(()=>n.remoteSyncer.rejectFailedWrite(l.batchId,a))),await Xc(n)}})(s,e),tj(s)&&nj(s)}async function iE(s,e){const t=Ee(s);t.asyncQueue.verifyOperationInProgress(),ge(sl,"RemoteStore received new credentials");const n=Ji(t);t.Ea.add(3),await Yc(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ah(t)}async function Ex(s,e){const t=Ee(s);e?(t.Ea.delete(2),await ah(t)):e||(t.Ea.add(2),await Yc(t),t.Ra.set("Unknown"))}function Wc(s){return s.ma||(s.ma=(function(t,n,a){const l=Ee(t);return l.sa(),new n4(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(s.datastore,s.asyncQueue,{Xo:l4.bind(null,s),t_:c4.bind(null,s),r_:u4.bind(null,s),H_:d4.bind(null,s)}),s.da.push((async e=>{e?(s.ma.B_(),Nv(s)?Ev(s):s.Ra.set("Unknown")):(await s.ma.stop(),ZA(s))}))),s.ma}function $i(s){return s.fa||(s.fa=(function(t,n,a){const l=Ee(t);return l.sa(),new s4(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(s.datastore,s.asyncQueue,{Xo:()=>Promise.resolve(),t_:m4.bind(null,s),r_:y4.bind(null,s),ta:g4.bind(null,s),na:p4.bind(null,s)}),s.da.push((async e=>{e?(s.fa.B_(),await Xc(s)):(await s.fa.stop(),s.Ta.length>0&&(ge(sl,`Stopping write stream with ${s.Ta.length} pending writes`),s.Ta=[]))}))),s.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,t,n,a,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=l,this.deferred=new zn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,l){const u=Date.now()+n,h=new Sv(e,t,u,a,l);return h.start(n),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(ne.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Jc(s,e){if(dn("AsyncQueue",`${e}: ${s}`),Xi(s))return new he(ne.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{static emptySet(e){return new $o(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Te.comparator(t.key,n.key):(t,n)=>Te.comparator(t.key,n.key),this.keyedMap=md(),this.sortedSet=new Ut(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $o)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=n.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new $o;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(){this.ga=new Ut(Te.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ae(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class rl{constructor(e,t,n,a,l,u,h,m,p){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=m,this.hasCachedResults=p}static fromInitialDocuments(e,t,n,a,l){const u=[];return t.forEach((h=>{u.push({type:0,doc:h})})),new rl(e,t,$o.emptySet(t),u,n,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&eh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class v4{constructor(){this.queries=lE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const a=Ee(t),l=a.queries;a.queries=lE(),l.forEach(((u,h)=>{for(const m of h.Sa)m.onError(n)}))})(this,new he(ne.ABORTED,"Firestore shutting down"))}}function lE(){return new Ka((s=>$S(s)),eh)}async function Av(s,e){const t=Ee(s);let n=3;const a=e.query;let l=t.queries.get(a);l?!l.ba()&&e.Da()&&(n=2):(l=new x4,n=e.Da()?0:1);try{switch(n){case 0:l.wa=await t.onListen(a,!0);break;case 1:l.wa=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(u){const h=Jc(u,`Initialization of query '${dc(e.query)}' failed`);return void e.onError(h)}t.queries.set(a,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&Iv(t)}async function jv(s,e){const t=Ee(s),n=e.query;let a=3;const l=t.queries.get(n);if(l){const u=l.Sa.indexOf(e);u>=0&&(l.Sa.splice(u,1),l.Sa.length===0?a=e.Da()?0:1:!l.ba()&&e.Da()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function b4(s,e){const t=Ee(s);let n=!1;for(const a of e){const l=a.query,u=t.queries.get(l);if(u){for(const h of u.Sa)h.Fa(a)&&(n=!0);u.wa=a}}n&&Iv(t)}function _4(s,e,t){const n=Ee(s),a=n.queries.get(e);if(a)for(const l of a.Sa)l.onError(t);n.queries.delete(e)}function Iv(s){s.Ca.forEach((e=>{e.next()}))}var Nx,cE;(cE=Nx||(Nx={})).Ma="default",cE.Cache="cache";class Cv{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new rl(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=rl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Nx.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE{constructor(e){this.serializer=e}$s(e){return la(this.serializer,e)}Us(e){return e.metadata.exists?Zm(this.serializer,e.document,!1):Ft.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return hn(e)}}class Rv{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=rj(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const n=tt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,n=new uE(this.serializer);for(const a of e)if(a.metadata.queries){const l=n.$s(a.metadata.name);for(const u of a.metadata.queries){const h=(t.get(u)||Xe()).add(l);t.set(u,h)}}return t}async ja(e){const t=await YP(e,new uE(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(const a of this.Ka)await XP(e,a,n.get(a.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function rj(s){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(e){this.key=e}}class ij{constructor(e){this.key=e}}class oj{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Xe(),this.mutatedKeys=Xe(),this.eu=QS(e),this.tu=new $o(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new oE,a=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,u=a,h=!1;const m=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((x,_)=>{const b=a.get(x),N=th(this.query,_)?_:null,C=!!b&&this.mutatedKeys.has(b.key),k=!!N&&(N.hasLocalMutations||this.mutatedKeys.has(N.key)&&N.hasCommittedMutations);let L=!1;b&&N?b.data.isEqual(N.data)?C!==k&&(n.track({type:3,doc:N}),L=!0):this.su(b,N)||(n.track({type:2,doc:N}),L=!0,(m&&this.eu(N,m)>0||p&&this.eu(N,p)<0)&&(h=!0)):!b&&N?(n.track({type:0,doc:N}),L=!0):b&&!N&&(n.track({type:1,doc:b}),L=!0,(m||p)&&(h=!0)),L&&(N?(u=u.add(N),l=k?l.add(x):l.delete(x)):(u=u.delete(x),l=l.delete(x)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const x=this.query.limitType==="F"?u.last():u.first();u=u.delete(x.key),l=l.delete(x.key),n.track({type:1,doc:x})}return{tu:u,iu:n,Cs:h,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((x,_)=>(function(N,C){const k=L=>{switch(L){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ae(20277,{Rt:L})}};return k(N)-k(C)})(x.type,_.type)||this.eu(x.doc,_.doc))),this.ou(n),a=a??!1;const h=t&&!a?this._u():[],m=this.Xa.size===0&&this.current&&!a?1:0,p=m!==this.Za;return this.Za=m,u.length!==0||p?{snapshot:new rl(this.query,e.tu,l,u,e.mutatedKeys,m===0,p,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Xe(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new ij(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new aj(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=Xe();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return rl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Zi="SyncEngine";class w4{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class T4{constructor(e){this.key=e,this.hu=!1}}class E4{constructor(e,t,n,a,l,u){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new Ka((h=>$S(h)),eh),this.Iu=new Map,this.Eu=new Set,this.du=new Ut(Te.comparator),this.Au=new Map,this.Ru=new gv,this.Vu={},this.mu=new Map,this.fu=nl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function N4(s,e,t=!0){const n=ig(s);let a;const l=n.Tu.get(e);return l?(n.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await lj(n,e,t,!0),a}async function S4(s,e){const t=ig(s);await lj(t,e,!0,!1)}async function lj(s,e,t,n){const a=await Pc(s.localStore,ls(e)),l=a.targetId,u=s.sharedClientState.addLocalQueryTarget(l,t);let h;return n&&(h=await kv(s,e,l,u==="current",a.resumeToken)),s.isPrimaryClient&&t&&ag(s.remoteStore,a),h}async function kv(s,e,t,n,a){s.pu=(_,b,N)=>(async function(k,L,F,U){let B=L.view.ru(F);B.Cs&&(B=await Em(k.localStore,L.query,!1).then((({documents:R})=>L.view.ru(R,B))));const H=U&&U.targetChanges.get(L.targetId),$=U&&U.targetMismatches.get(L.targetId)!=null,M=L.view.applyChanges(B,k.isPrimaryClient,H,$);return Sx(k,L.targetId,M.au),M.snapshot})(s,_,b,N);const l=await Em(s.localStore,e,!0),u=new oj(e,l.Qs),h=u.ru(l.documents),m=rh.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",a),p=u.applyChanges(h,s.isPrimaryClient,m);Sx(s,t,p.au);const x=new w4(e,t,u);return s.Tu.set(e,x),s.Iu.has(t)?s.Iu.get(t).push(e):s.Iu.set(t,[e]),p.snapshot}async function A4(s,e,t){const n=Ee(s),a=n.Tu.get(e),l=n.Iu.get(a.targetId);if(l.length>1)return n.Iu.set(a.targetId,l.filter((u=>!eh(u,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await Mc(n.localStore,a.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(a.targetId),t&&Oc(n.remoteStore,a.targetId),Vc(n,a.targetId)})).catch(Yi)):(Vc(n,a.targetId),await Mc(n.localStore,a.targetId,!0))}async function j4(s,e){const t=Ee(s),n=t.Tu.get(e),a=t.Iu.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Oc(t.remoteStore,n.targetId))}async function I4(s,e,t){const n=Ov(s);try{const a=await(function(u,h){const m=Ee(u),p=_t.now(),x=h.reduce(((N,C)=>N.add(C.key)),Xe());let _,b;return m.persistence.runTransaction("Locally write mutations","readwrite",(N=>{let C=Es(),k=Xe();return m.Ns.getEntries(N,x).next((L=>{C=L,C.forEach(((F,U)=>{U.isValidDocument()||(k=k.add(F))}))})).next((()=>m.localDocuments.getOverlayedDocuments(N,C))).next((L=>{_=L;const F=[];for(const U of h){const B=eP(U,_.get(U.key).overlayedDocument);B!=null&&F.push(new Qa(U.key,B,MS(B.value.mapValue),Kt.exists(!0)))}return m.mutationQueue.addMutationBatch(N,p,F,h)})).next((L=>{b=L;const F=L.applyToLocalDocumentSet(_,k);return m.documentOverlayCache.saveOverlays(N,L.batchId,F)}))})).then((()=>({batchId:b.batchId,changes:XS(_)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),(function(u,h,m){let p=u.Vu[u.currentUser.toKey()];p||(p=new Ut(qe)),p=p.insert(h,m),u.Vu[u.currentUser.toKey()]=p})(n,a.batchId,t),await Ya(n,a.changes),await Xc(n.remoteStore)}catch(a){const l=Jc(a,"Failed to persist write");t.reject(l)}}async function cj(s,e){const t=Ee(s);try{const n=await KP(t.localStore,e);e.targetChanges.forEach(((a,l)=>{const u=t.Au.get(l);u&&(ke(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?u.hu=!0:a.modifiedDocuments.size>0?ke(u.hu,14607):a.removedDocuments.size>0&&(ke(u.hu,42227),u.hu=!1))})),await Ya(t,n,e)}catch(n){await Yi(n)}}function dE(s,e,t){const n=Ee(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Tu.forEach(((l,u)=>{const h=u.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(u,h){const m=Ee(u);m.onlineState=h;let p=!1;m.queries.forEach(((x,_)=>{for(const b of _.Sa)b.va(h)&&(p=!0)})),p&&Iv(m)})(n.eventManager,e),a.length&&n.Pu.H_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function C4(s,e,t){const n=Ee(s);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Au.get(e),l=a&&a.key;if(l){let u=new Ut(Te.comparator);u=u.insert(l,Ft.newNoDocument(l,Me.min()));const h=Xe().add(l),m=new sh(Me.min(),new Map,new Ut(qe),u,h);await cj(n,m),n.du=n.du.remove(l),n.Au.delete(e),Mv(n)}else await Mc(n.localStore,e,!1).then((()=>Vc(n,e,t))).catch(Yi)}async function R4(s,e){const t=Ee(s),n=e.batch.batchId;try{const a=await $P(t.localStore,e);Pv(t,n,null),Dv(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Ya(t,a)}catch(a){await Yi(a)}}async function k4(s,e,t){const n=Ee(s);try{const a=await(function(u,h){const m=Ee(u);return m.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let x;return m.mutationQueue.lookupMutationBatch(p,h).next((_=>(ke(_!==null,37113),x=_.keys(),m.mutationQueue.removeMutationBatch(p,_)))).next((()=>m.mutationQueue.performConsistencyCheck(p))).next((()=>m.documentOverlayCache.removeOverlaysForBatchId(p,x,h))).next((()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,x))).next((()=>m.localDocuments.getDocuments(p,x)))}))})(n.localStore,e);Pv(n,e,t),Dv(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Ya(n,a)}catch(a){await Yi(a)}}async function D4(s,e){const t=Ee(s);Ji(t.remoteStore)||ge(Zi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=await(function(u){const h=Ee(u);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(m=>h.mutationQueue.getHighestUnacknowledgedBatchId(m)))})(t.localStore);if(n===Fi)return void e.resolve();const a=t.mu.get(n)||[];a.push(e),t.mu.set(n,a)}catch(n){const a=Jc(n,"Initialization of waitForPendingWrites() operation failed");e.reject(a)}}function Dv(s,e){(s.mu.get(e)||[]).forEach((t=>{t.resolve()})),s.mu.delete(e)}function Pv(s,e,t){const n=Ee(s);let a=n.Vu[n.currentUser.toKey()];if(a){const l=a.get(e);l&&(t?l.reject(t):l.resolve(),a=a.remove(e)),n.Vu[n.currentUser.toKey()]=a}}function Vc(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Iu.get(e))s.Tu.delete(n),t&&s.Pu.yu(n,t);s.Iu.delete(e),s.isPrimaryClient&&s.Ru.jr(e).forEach((n=>{s.Ru.containsKey(n)||uj(s,n)}))}function uj(s,e){s.Eu.delete(e.path.canonicalString());const t=s.du.get(e);t!==null&&(Oc(s.remoteStore,t),s.du=s.du.remove(e),s.Au.delete(t),Mv(s))}function Sx(s,e,t){for(const n of t)n instanceof aj?(s.Ru.addReference(n.key,e),P4(s,n)):n instanceof ij?(ge(Zi,"Document no longer in limbo: "+n.key),s.Ru.removeReference(n.key,e),s.Ru.containsKey(n.key)||uj(s,n.key)):Ae(19791,{wu:n})}function P4(s,e){const t=e.key,n=t.path.canonicalString();s.du.get(t)||s.Eu.has(n)||(ge(Zi,"New document in limbo: "+t),s.Eu.add(n),Mv(s))}function Mv(s){for(;s.Eu.size>0&&s.du.size<s.maxConcurrentLimboResolutions;){const e=s.Eu.values().next().value;s.Eu.delete(e);const t=new Te(tt.fromString(e)),n=s.fu.next();s.Au.set(n,new T4(t)),s.du=s.du.insert(t,n),ag(s.remoteStore,new Va(ls($c(t.path)),n,"TargetPurposeLimboResolution",ws.ce))}}async function Ya(s,e,t){const n=Ee(s),a=[],l=[],u=[];n.Tu.isEmpty()||(n.Tu.forEach(((h,m)=>{u.push(n.pu(m,e,t).then((p=>{if((p||t)&&n.isPrimaryClient){const x=p?!p.fromCache:t?.targetChanges.get(m.targetId)?.current;n.sharedClientState.updateQueryState(m.targetId,x?"current":"not-current")}if(p){a.push(p);const x=vv.As(m.targetId,p);l.push(x)}})))})),await Promise.all(u),n.Pu.H_(a),await(async function(m,p){const x=Ee(m);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>W.forEach(p,(b=>W.forEach(b.Es,(N=>x.persistence.referenceDelegate.addReference(_,b.targetId,N))).next((()=>W.forEach(b.ds,(N=>x.persistence.referenceDelegate.removeReference(_,b.targetId,N)))))))))}catch(_){if(!Xi(_))throw _;ge(bv,"Failed to update sequence numbers: "+_)}for(const _ of p){const b=_.targetId;if(!_.fromCache){const N=x.Ms.get(b),C=N.snapshotVersion,k=N.withLastLimboFreeSnapshotVersion(C);x.Ms=x.Ms.insert(b,k)}}})(n.localStore,l))}async function M4(s,e){const t=Ee(s);if(!t.currentUser.isEqual(e)){ge(Zi,"User change. New user:",e.toKey());const n=await FA(t.localStore,e);t.currentUser=e,(function(l,u){l.mu.forEach((h=>{h.forEach((m=>{m.reject(new he(ne.CANCELLED,u))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Ya(t,n.Ls)}}function O4(s,e){const t=Ee(s),n=t.Au.get(e);if(n&&n.hu)return Xe().add(n.key);{let a=Xe();const l=t.Iu.get(e);if(!l)return a;for(const u of l){const h=t.Tu.get(u);a=a.unionWith(h.view.nu)}return a}}async function V4(s,e){const t=Ee(s),n=await Em(t.localStore,e.query,!0),a=e.view.cu(n);return t.isPrimaryClient&&Sx(t,e.targetId,a.au),a}async function L4(s,e){const t=Ee(s);return HA(t.localStore,e).then((n=>Ya(t,n)))}async function U4(s,e,t,n){const a=Ee(s),l=await(function(h,m){const p=Ee(h),x=Ee(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",(_=>x.er(_,m).next((b=>b?p.localDocuments.getDocuments(_,b):W.resolve(null)))))})(a.localStore,e);l!==null?(t==="pending"?await Xc(a.remoteStore):t==="acknowledged"||t==="rejected"?(Pv(a,e,n||null),Dv(a,e),(function(h,m){Ee(Ee(h).mutationQueue).ir(m)})(a.localStore,e)):Ae(6720,"Unknown batchState",{Su:t}),await Ya(a,l)):ge(Zi,"Cannot apply mutation batch with id: "+e)}async function F4(s,e){const t=Ee(s);if(ig(t),Ov(t),e===!0&&t.gu!==!0){const n=t.sharedClientState.getAllActiveQueryTargets(),a=await hE(t,n.toArray());t.gu=!0,await Ex(t.remoteStore,!0);for(const l of a)ag(t.remoteStore,l)}else if(e===!1&&t.gu!==!1){const n=[];let a=Promise.resolve();t.Iu.forEach(((l,u)=>{t.sharedClientState.isLocalQueryTarget(u)?n.push(u):a=a.then((()=>(Vc(t,u),Mc(t.localStore,u,!0)))),Oc(t.remoteStore,u)})),await a,await hE(t,n),(function(u){const h=Ee(u);h.Au.forEach(((m,p)=>{Oc(h.remoteStore,p)})),h.Ru.Jr(),h.Au=new Map,h.du=new Ut(Te.comparator)})(t),t.gu=!1,await Ex(t.remoteStore,!1)}}async function hE(s,e,t){const n=Ee(s),a=[],l=[];for(const u of e){let h;const m=n.Iu.get(u);if(m&&m.length!==0){h=await Pc(n.localStore,ls(m[0]));for(const p of m){const x=n.Tu.get(p),_=await V4(n,x);_.snapshot&&l.push(_.snapshot)}}else{const p=await zA(n.localStore,u);h=await Pc(n.localStore,p),await kv(n,dj(p),u,!1,h.resumeToken)}a.push(h)}return n.Pu.H_(l),a}function dj(s){return zS(s.path,s.collectionGroup,s.orderBy,s.filters,s.limit,"F",s.startAt,s.endAt)}function B4(s){return(function(t){return Ee(Ee(t).persistence).Ts()})(Ee(s).localStore)}async function q4(s,e,t,n){const a=Ee(s);if(a.gu)return void ge(Zi,"Ignoring unexpected query state notification.");const l=a.Iu.get(e);if(l&&l.length>0)switch(t){case"current":case"not-current":{const u=await HA(a.localStore,KS(l[0])),h=sh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",en.EMPTY_BYTE_STRING);await Ya(a,u,h);break}case"rejected":await Mc(a.localStore,e,!0),Vc(a,e,n);break;default:Ae(64155,t)}}async function z4(s,e,t){const n=ig(s);if(n.gu){for(const a of e){if(n.Iu.has(a)&&n.sharedClientState.isActiveQueryTarget(a)){ge(Zi,"Adding an already active target "+a);continue}const l=await zA(n.localStore,a),u=await Pc(n.localStore,l);await kv(n,dj(l),u.targetId,!1,u.resumeToken),ag(n.remoteStore,u)}for(const a of t)n.Iu.has(a)&&await Mc(n.localStore,a,!1).then((()=>{Oc(n.remoteStore,a),Vc(n,a)})).catch(Yi)}}function ig(s){const e=Ee(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=cj.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=O4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=C4.bind(null,e),e.Pu.H_=b4.bind(null,e.eventManager),e.Pu.yu=_4.bind(null,e.eventManager),e}function Ov(s){const e=Ee(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=R4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=k4.bind(null,e),e}function H4(s,e,t){const n=Ee(s);(async function(l,u,h){try{const m=await u.getMetadata();if(await(function(N,C){const k=Ee(N),L=hn(C.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",(F=>k.Ii.getBundleMetadata(F,C.id))).then((F=>!!F&&F.createTime.compareTo(L)>=0))})(l.localStore,m))return await u.close(),h._completeWith((function(N){return{taskState:"Success",documentsLoaded:N.totalDocuments,bytesLoaded:N.totalBytes,totalDocuments:N.totalDocuments,totalBytes:N.totalBytes}})(m)),Promise.resolve(new Set);h._updateProgress(rj(m));const p=new Rv(m,u.serializer);let x=await u.bu();for(;x;){const b=await p.Ga(x);b&&h._updateProgress(b),x=await u.bu()}const _=await p.ja(l.localStore);return await Ya(l,_.Ha,void 0),await(function(N,C){const k=Ee(N);return k.persistence.runTransaction("Save bundle","readwrite",(L=>k.Ii.saveBundleMetadata(L,C)))})(l.localStore,m),h._completeWith(_.progress),Promise.resolve(_.Ja)}catch(m){return Xs(Zi,`Loading bundle failed with ${m}`),h._failWith(m),Promise.resolve(new Set)}})(n,e,t).then((a=>{n.sharedClientState.notifyBundleLoaded(a)}))}class Lc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=cl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return UA(this.persistence,new LA,e.initialUser,this.serializer)}Cu(e){return new pv(rg.mi,this.serializer)}Du(e){return new YA}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Lc.provider={build:()=>new Lc};class Vv extends Lc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ke(this.persistence.referenceDelegate instanceof Tm,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new kA(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?rs.withCacheSize(this.cacheSizeBytes):rs.DEFAULT;return new pv((n=>Tm.mi(n,t)),this.serializer)}}class Lv extends Lc{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Ov(this.xu.syncEngine),await Xc(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return UA(this.persistence,new LA,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new kA(n,e.asyncQueue,t)}Mu(e,t){const n=new rD(t,this.persistence);return new sD(e.asyncQueue,n)}Cu(e){const t=xv(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?rs.withCacheSize(this.cacheSizeBytes):rs.DEFAULT;return new yv(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,XA(),em(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new YA}}class hj extends Lv{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Dy&&(this.sharedClientState.syncEngine={Co:U4.bind(null,t),vo:q4.bind(null,t),Fo:z4.bind(null,t),Ts:B4.bind(null,t),Do:L4.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async n=>{await F4(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))}Du(e){const t=XA();if(!Dy.v(t))throw new he(ne.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=xv(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Dy(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Ki{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>dE(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=M4.bind(null,this.syncEngine),await Ex(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new v4})()}createDatastore(e){const t=cl(e.databaseInfo.databaseId),n=(function(l){return new t4(l)})(e.databaseInfo);return(function(l,u,h,m){return new a4(l,u,h,m)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,a,l,u,h){return new o4(n,a,l,u,h)})(this.localStore,this.datastore,e.asyncQueue,(t=>dE(this.syncEngine,t,0)),(function(){return rE.v()?new rE:new WP})())}createSyncEngine(e,t){return(function(a,l,u,h,m,p,x){const _=new E4(a,l,u,h,m,p);return x&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=Ee(t);ge(sl,"RemoteStore shutting down."),n.Ea.add(5),await Yc(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ki.provider={build:()=>new Ki};function fE(s,e=10240){let t=0;return{async read(){if(t<s.byteLength){const n={value:s.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):dn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new zn,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((n=>{n&&n.$a()?this.metadata.resolve(n.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.Qa)}`))}),(n=>this.metadata.reject(n)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),n=Number(t);isNaN(n)&&this.Qu(`length string (${t}) is not valid number`);const a=await this.$u(n);return new sj(JSON.parse(a),e.length+n)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.Qa)}`);this.metadata=n;do n=this.bu(),n!==null&&this.elements.push(n);while(n!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new sj(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new he(ne.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new he(ne.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(a,l){const u=Ee(a),h={documents:l.map((_=>qd(u.serializer,_)))},m=await u.Ho("BatchGetDocuments",u.serializer.databaseId,tt.emptyPath(),h,l.length),p=new Map;m.forEach((_=>{const b=cP(u.serializer,_);p.set(b.key.toString(),b)}));const x=[];return l.forEach((_=>{const b=p.get(_.toString());ke(!!b,55234,{key:_}),x.push(b)})),x})(this.datastore,e);return t.forEach((n=>this.recordVersion(n))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Qc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,n)=>{const a=Te.fromPath(n);this.mutations.push(new ov(a,this.precondition(a)))})),await(async function(n,a){const l=Ee(n),u={writes:a.map((h=>zd(l.serializer,h)))};await l.Go("Commit",l.serializer.databaseId,tt.emptyPath(),u)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ae(50498,{Gu:e.constructor.name});t=Me.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new he(ne.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Me.min())?Kt.exists(!1):Kt.updateTime(t):Kt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Me.min()))throw new he(ne.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Kt.updateTime(t)}return Kt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{constructor(e,t,n,a,l){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=a,this.deferred=l,this.zu=n.maxAttempts,this.M_=new wv(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new K4(this.datastore),t=this.Hu(e);t&&t.then((n=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(n)})).catch((a=>{this.Yu(a)}))))})).catch((n=>{this.Yu(n)}))}))}Hu(e){try{const t=this.updateFunction(e);return!Wd(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!oA(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qi="FirestoreClient";class Y4{constructor(e,t,n,a,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=qn.UNAUTHENTICATED,this.clientId=qm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(n,(async u=>{ge(Qi,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(n,(u=>(ge(Qi,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Jc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function My(s,e){s.asyncQueue.verifyOperationInProgress(),ge(Qi,"Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener((async a=>{n.isEqual(a)||(await FA(e.localStore,a),n=a)})),e.persistence.setDatabaseDeletedListener((()=>s.terminate())),s._offlineComponents=e}async function mE(s,e){s.asyncQueue.verifyOperationInProgress();const t=await Uv(s);ge(Qi,"Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener((n=>iE(e.remoteStore,n))),s.setAppCheckTokenChangeListener(((n,a)=>iE(e.remoteStore,a))),s._onlineComponents=e}async function Uv(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){ge(Qi,"Using user provided OfflineComponentProvider");try{await My(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(a){return a.name==="FirebaseError"?a.code===ne.FAILED_PRECONDITION||a.code===ne.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(t))throw t;Xs("Error using user provided cache. Falling back to memory cache: "+t),await My(s,new Lc)}}else ge(Qi,"Using default OfflineComponentProvider"),await My(s,new Vv(void 0));return s._offlineComponents}async function lg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(ge(Qi,"Using user provided OnlineComponentProvider"),await mE(s,s._uninitializedComponentsProvider._online)):(ge(Qi,"Using default OnlineComponentProvider"),await mE(s,new Ki))),s._onlineComponents}function fj(s){return Uv(s).then((e=>e.persistence))}function Zc(s){return Uv(s).then((e=>e.localStore))}function mj(s){return lg(s).then((e=>e.remoteStore))}function Fv(s){return lg(s).then((e=>e.syncEngine))}function gj(s){return lg(s).then((e=>e.datastore))}async function Uc(s){const e=await lg(s),t=e.eventManager;return t.onListen=N4.bind(null,e.syncEngine),t.onUnlisten=A4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=S4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=j4.bind(null,e.syncEngine),t}function X4(s){return s.asyncQueue.enqueue((async()=>{const e=await fj(s),t=await mj(s);return e.setNetworkEnabled(!0),(function(a){const l=Ee(a);return l.Ea.delete(0),ah(l)})(t)}))}function W4(s){return s.asyncQueue.enqueue((async()=>{const e=await fj(s),t=await mj(s);return e.setNetworkEnabled(!1),(async function(a){const l=Ee(a);l.Ea.add(0),await Yc(l),l.Ra.set("Offline")})(t)}))}function J4(s,e){const t=new zn;return s.asyncQueue.enqueueAndForget((async()=>(async function(a,l,u){try{const h=await(function(p,x){const _=Ee(p);return _.persistence.runTransaction("read document","readonly",(b=>_.localDocuments.getDocument(b,x)))})(a,l);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new he(ne.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const m=Jc(h,`Failed to get document '${l} from cache`);u.reject(m)}})(await Zc(s),e,t))),t.promise}function pj(s,e,t={}){const n=new zn;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new og({next:b=>{x.Nu(),u.enqueueAndForget((()=>jv(l,_)));const N=b.docs.has(h);!N&&b.fromCache?p.reject(new he(ne.UNAVAILABLE,"Failed to get document because the client is offline.")):N&&b.fromCache&&m&&m.source==="server"?p.reject(new he(ne.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(b)},error:b=>p.reject(b)}),_=new Cv($c(h.path),x,{includeMetadataChanges:!0,qa:!0});return Av(l,_)})(await Uc(s),s.asyncQueue,e,t,n))),n.promise}function Z4(s,e){const t=new zn;return s.asyncQueue.enqueueAndForget((async()=>(async function(a,l,u){try{const h=await Em(a,l,!0),m=new oj(l,h.Qs),p=m.ru(h.documents),x=m.applyChanges(p,!1);u.resolve(x.snapshot)}catch(h){const m=Jc(h,`Failed to execute query '${l} against cache`);u.reject(m)}})(await Zc(s),e,t))),t.promise}function yj(s,e,t={}){const n=new zn;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new og({next:b=>{x.Nu(),u.enqueueAndForget((()=>jv(l,_))),b.fromCache&&m.source==="server"?p.reject(new he(ne.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(b)},error:b=>p.reject(b)}),_=new Cv(h,x,{includeMetadataChanges:!0,qa:!0});return Av(l,_)})(await Uc(s),s.asyncQueue,e,t,n))),n.promise}function eM(s,e,t){const n=new zn;return s.asyncQueue.enqueueAndForget((async()=>{try{const a=await gj(s);n.resolve((async function(u,h,m){const p=Ee(u),{request:x,gt:_,parent:b}=xA(p.serializer,HS(h),m);p.connection.$o||delete x.parent;const N=(await p.Ho("RunAggregationQuery",p.serializer.databaseId,b,x,1)).filter((k=>!!k.result));ke(N.length===1,64727);const C=N[0].result?.aggregateFields;return Object.keys(C).reduce(((k,L)=>(k[_[L]]=C[L],k)),{})})(a,e,t))}catch(a){n.reject(a)}})),n.promise}function tM(s,e){const t=new og(e);return s.asyncQueue.enqueueAndForget((async()=>(function(a,l){Ee(a).Ca.add(l),l.next()})(await Uc(s),t))),()=>{t.Nu(),s.asyncQueue.enqueueAndForget((async()=>(function(a,l){Ee(a).Ca.delete(l)})(await Uc(s),t)))}}function nM(s,e,t,n){const a=(function(u,h){let m;return m=typeof u=="string"?cA().encode(u):u,(function(x,_){return new G4(x,_)})((function(x,_){if(x instanceof Uint8Array)return fE(x,_);if(x instanceof ArrayBuffer)return fE(new Uint8Array(x),_);if(x instanceof ReadableStream)return x.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(m),h)})(t,cl(e));s.asyncQueue.enqueueAndForget((async()=>{H4(await Fv(s),a,n)}))}function sM(s,e){return s.asyncQueue.enqueue((async()=>(function(n,a){const l=Ee(n);return l.persistence.runTransaction("Get named query","readonly",(u=>l.Ii.getNamedQuery(u,a)))})(await Zc(s),e)))}function xj(s,e){return(function(n,a){return new $4(n,a)})(s,e)}function rM(s,e){return s.asyncQueue.enqueue((async()=>(async function(n,a){const l=Ee(n),u=l.indexManager,h=[];return l.persistence.runTransaction("Configure indexes","readwrite",(m=>u.getFieldIndexes(m).next((p=>(function(_,b,N,C,k){_=[..._],b=[...b],_.sort(N),b.sort(N);const L=_.length,F=b.length;let U=0,B=0;for(;U<F&&B<L;){const H=N(_[B],b[U]);H<0?k(_[B++]):H>0?C(b[U++]):(U++,B++)}for(;U<F;)C(b[U++]);for(;B<L;)k(_[B++])})(p,a,Zk,(x=>{h.push(u.addFieldIndex(m,x))}),(x=>{h.push(u.deleteFieldIndex(m,x))})))).next((()=>W.waitFor(h)))))})(await Zc(s),e)))}function aM(s,e){return s.asyncQueue.enqueue((async()=>(function(n,a){Ee(n).Fs.Vs=a})(await Zc(s),e)))}function iM(s){return s.asyncQueue.enqueue((async()=>(function(t){const n=Ee(t),a=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",(l=>a.deleteAllFieldIndexes(l)))})(await Zc(s))))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vj(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gE=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bj="firestore.googleapis.com",pE=!0;class yE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new he(ne.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bj,this.ssl=pE}else this.host=e.host,this.ssl=e.ssl??pE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=AA;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<RA)throw new he(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}iS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vj(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new he(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new he(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new he(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,a){return n.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ih{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(ne.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(ne.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new rS;switch(n.type){case"firstParty":return new $k(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new he(ne.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=gE.get(t);n&&(ge("ComponentProvider","Removing Datastore"),gE.delete(t),n.terminate())})(this),Promise.resolve()}}function _j(s,e,t,n={}){s=nt(s,ih);const a=Ga(e),l=s._getSettings(),u={...l,emulatorOptions:s._getEmulatorOptions()},h=`${e}:${t}`;a&&(Om(`https://${h}`),Px("Firestore",!0)),l.host!==bj&&l.host!==h&&Xs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...l,host:h,ssl:a,emulatorOptions:n};if(!pr(m,u)&&(s._setSettings(m),n.mockUserToken)){let p,x;if(typeof n.mockUserToken=="string")p=n.mockUserToken,x=qn.MOCK_USER;else{p=h1(n.mockUserToken,s._app?.options.projectId);const _=n.mockUserToken.sub||n.mockUserToken.user_id;if(!_)throw new he(ne.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new qn(_)}s._authCredentials=new zk(new sS(p,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new jn(this.firestore,e,this._query)}}class At{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new At(this.firestore,e,this._key)}toJSON(){return{type:At._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ll(t,At._jsonSchema))return new At(e,n||null,new Te(tt.fromString(t.referencePath)))}}At._jsonSchemaVersion="firestore/documentReference/1.0",At._jsonSchema={type:xn("string",At._jsonSchemaVersion),referencePath:xn("string")};class Mr extends jn{constructor(e,t,n){super(e,t,$c(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new At(this.firestore,null,new Te(e))}withConverter(e){return new Mr(this.firestore,e,this._path)}}function Ce(s,e,...t){if(s=mt(s),Qx("collection","path",e),s instanceof ih){const n=tt.fromString(e,...t);return aT(n),new Mr(s,null,n)}{if(!(s instanceof At||s instanceof Mr))throw new he(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(tt.fromString(e,...t));return aT(n),new Mr(s.firestore,null,n)}}function oM(s,e){if(s=nt(s,ih),Qx("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new he(ne.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new jn(s,null,(function(n){return new $a(tt.emptyPath(),n)})(e))}function ve(s,e,...t){if(s=mt(s),arguments.length===1&&(e=qm.newId()),Qx("doc","path",e),s instanceof ih){const n=tt.fromString(e,...t);return rT(n),new At(s,null,new Te(n))}{if(!(s instanceof At||s instanceof Mr))throw new he(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(tt.fromString(e,...t));return rT(n),new At(s.firestore,s instanceof Mr?s.converter:null,new Te(n))}}function lM(s,e){return s=mt(s),e=mt(e),(s instanceof At||s instanceof Mr)&&(e instanceof At||e instanceof Mr)&&s.firestore===e.firestore&&s.path===e.path&&s.converter===e.converter}function Bv(s,e){return s=mt(s),e=mt(e),s instanceof jn&&e instanceof jn&&s.firestore===e.firestore&&eh(s._query,e._query)&&s.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xE="AsyncQueue";class vE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new wv(this,"async_queue_retry"),this._c=()=>{const n=em();n&&ge(xE,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=em();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=em();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new zn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Xi(e))throw e;ge(xE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,dn("INTERNAL UNHANDLED ERROR: ",bE(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const a=Sv.createAndSchedule(this,e,t,n,(l=>this.hc(l)));return this.tc.push(a),a}uc(){this.nc&&Ae(47125,{Pc:bE(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function bE(s){let e=s.message||"";return s.stack&&(e=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(s){return(function(t,n){if(typeof t!="object"||t===null)return!1;const a=t;for(const l of n)if(l in a&&typeof a[l]=="function")return!0;return!1})(s,["next","error","complete"])}class wj{constructor(){this._progressObserver={},this._taskCompletionResolver=new zn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM=-1;class Pt extends ih{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new vE,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vE(e),this._firestoreClient=void 0,await e}}}function uM(s,e,t){t||(t=Ld);const n=da(s,"firestore");if(n.isInitialized(t)){const a=n.getImmediate({identifier:t}),l=n.getOptions(t);if(pr(l,e))return a;throw new he(ne.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new he(ne.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<RA)throw new he(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Ga(e.host)&&Om(e.host),n.initialize({options:e,instanceIdentifier:t})}function Tj(s,e){const t=typeof s=="object"?s:Lm(),n=typeof s=="string"?s:e||Ld,a=da(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const l=nN("firestore");l&&_j(a,...l)}return a}function Qt(s){if(s._terminated)throw new he(ne.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||Ej(s),s._firestoreClient}function Ej(s){const e=s._freezeSettings(),t=(function(a,l,u,h){return new DD(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,vj(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(s._databaseId,s._app?.options.appId||"",s._persistenceKey,e);s._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(s._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),s._firestoreClient=new Y4(s._authCredentials,s._appCheckCredentials,s._queue,t,s._componentsProvider&&(function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}})(s._componentsProvider))}function dM(s,e){Xs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=s._freezeSettings();return Nj(s,Ki.provider,{build:n=>new Lv(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function hM(s){Xs("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=s._freezeSettings();Nj(s,Ki.provider,{build:t=>new hj(t,e.cacheSizeBytes)})}function Nj(s,e,t){if((s=nt(s,Pt))._firestoreClient||s._terminated)throw new he(ne.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(s._componentsProvider||s._getSettings().localCache)throw new he(ne.FAILED_PRECONDITION,"SDK cache is already specified.");s._componentsProvider={_online:e,_offline:t},Ej(s)}function fM(s){if(s._initialized&&!s._terminated)throw new he(ne.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new zn;return s._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(n){if(!oa.v())return Promise.resolve();const a=n+VA;await oa.delete(a)})(xv(s._databaseId,s._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function mM(s){return(function(t){const n=new zn;return t.asyncQueue.enqueueAndForget((async()=>D4(await Fv(t),n))),n.promise})(Qt(s=nt(s,Pt)))}function gM(s){return X4(Qt(s=nt(s,Pt)))}function pM(s){return W4(Qt(s=nt(s,Pt)))}function yM(s){return SR(s.app,"firestore",s._databaseId.database),s._delete()}function Ax(s,e){const t=Qt(s=nt(s,Pt)),n=new wj;return nM(t,s._databaseId,e,n),n}function Sj(s,e){return sM(Qt(s=nt(s,Pt)),e).then((t=>t?new jn(s,null,t.query):null))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class Aj{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _s(en.fromBase64String(e))}catch(t){throw new he(ne.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _s(en.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:_s._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ll(e,_s._jsonSchema))return _s.fromBase64String(e.bytes)}}_s._jsonSchemaVersion="firestore/bytes/1.0",_s._jsonSchema={type:xn("string",_s._jsonSchemaVersion),bytes:xn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(ne.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function xM(){return new eo(nx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(ne.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(ne.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return qe(this._lat,e._lat)||qe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Or._jsonSchemaVersion}}static fromJSON(e){if(ll(e,Or._jsonSchema))return new Or(e.latitude,e.longitude)}}Or._jsonSchemaVersion="firestore/geoPoint/1.0",Or._jsonSchema={type:xn("string",Or._jsonSchemaVersion),latitude:xn("number"),longitude:xn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,a){if(n.length!==a.length)return!1;for(let l=0;l<n.length;++l)if(n[l]!==a[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:gr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ll(e,gr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new gr(e.vectorValues);throw new he(ne.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}gr._jsonSchemaVersion="firestore/vectorValue/1.0",gr._jsonSchema={type:xn("string",gr._jsonSchemaVersion),vectorValues:xn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vM=/^__.*__$/;class bM{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Qa(e,this.data,this.fieldMask,t,this.fieldTransforms):new Kc(e,this.data,t,this.fieldTransforms)}}class jj{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Qa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ij(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ae(40011,{Ac:s})}}class cg{constructor(e,t,n,a,l,u){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new cg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return jm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Ij(this.Ac)&&vM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class _M{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||cl(e)}Cc(e,t,n,a=!1){return new cg({Ac:e,methodName:t,Dc:n,path:Bt.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ul(s){const e=s._freezeSettings(),t=cl(s._databaseId);return new _M(s._databaseId,!!e.ignoreUndefinedProperties,t)}function ug(s,e,t,n,a,l={}){const u=s.Cc(l.merge||l.mergeFields?2:0,e,t,a);Qv("Data must be an object, but it was:",u,n);const h=kj(n,u);let m,p;if(l.merge)m=new Ts(u.fieldMask),p=u.fieldTransforms;else if(l.mergeFields){const x=[];for(const _ of l.mergeFields){const b=Hd(e,_,t);if(!u.contains(b))throw new he(ne.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);Pj(x,b)||x.push(b)}m=new Ts(x),p=u.fieldTransforms.filter((_=>m.covers(_.field)))}else m=null,p=u.fieldTransforms;return new bM(new Jn(h),m,p)}class oh extends to{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof oh}}function Cj(s,e,t){return new cg({Ac:3,Dc:e.settings.Dc,methodName:s._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class qv extends to{_toFieldTransform(e){return new nh(e.path,new Rc)}isEqual(e){return e instanceof qv}}class zv extends to{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Cj(this,e,!0),n=this.vc.map((l=>dl(l,t))),a=new Jo(n);return new nh(e.path,a)}isEqual(e){return e instanceof zv&&pr(this.vc,e.vc)}}class Hv extends to{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Cj(this,e,!0),n=this.vc.map((l=>dl(l,t))),a=new Zo(n);return new nh(e.path,a)}isEqual(e){return e instanceof Hv&&pr(this.vc,e.vc)}}class Gv extends to{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new kc(e.serializer,ZS(e.serializer,this.Fc));return new nh(e.path,t)}isEqual(e){return e instanceof Gv&&this.Fc===e.Fc}}function $v(s,e,t,n){const a=s.Cc(1,e,t);Qv("Data must be an object, but it was:",a,n);const l=[],u=Jn.empty();Wi(n,((m,p)=>{const x=dg(e,m,t);p=mt(p);const _=a.yc(x);if(p instanceof oh)l.push(x);else{const b=dl(p,_);b!=null&&(l.push(x),u.set(x,b))}}));const h=new Ts(l);return new jj(u,h,a.fieldTransforms)}function Kv(s,e,t,n,a,l){const u=s.Cc(1,e,t),h=[Hd(e,n,t)],m=[a];if(l.length%2!=0)throw new he(ne.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<l.length;b+=2)h.push(Hd(e,l[b])),m.push(l[b+1]);const p=[],x=Jn.empty();for(let b=h.length-1;b>=0;--b)if(!Pj(p,h[b])){const N=h[b];let C=m[b];C=mt(C);const k=u.yc(N);if(C instanceof oh)p.push(N);else{const L=dl(C,k);L!=null&&(p.push(N),x.set(N,L))}}const _=new Ts(p);return new jj(x,_,u.fieldTransforms)}function Rj(s,e,t,n=!1){return dl(t,s.Cc(n?4:3,e))}function dl(s,e){if(Dj(s=mt(s)))return Qv("Unsupported field value:",e,s),kj(s,e);if(s instanceof to)return(function(n,a){if(!Ij(a.Ac))throw a.Sc(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${n._methodName}() is not currently supported inside arrays`);const l=n._toFieldTransform(a);l&&a.fieldTransforms.push(l)})(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,a){const l=[];let u=0;for(const h of n){let m=dl(h,a.wc(u));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),u++}return{arrayValue:{values:l}}})(s,e)}return(function(n,a){if((n=mt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ZS(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const l=_t.fromDate(n);return{timestampValue:Dc(a.serializer,l)}}if(n instanceof _t){const l=new _t(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Dc(a.serializer,l)}}if(n instanceof Or)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof _s)return{bytesValue:hA(a.serializer,n._byteString)};if(n instanceof At){const l=a.databaseId,u=n.firestore._databaseId;if(!u.isEqual(l))throw a.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:hv(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof gr)return(function(u,h){return{mapValue:{fields:{[tv]:{stringValue:nv},[jc]:{arrayValue:{values:u.toArray().map((p=>{if(typeof p!="number")throw h.Sc("VectorValues must only contain numeric values.");return iv(h.serializer,p)}))}}}}}})(n,a);throw a.Sc(`Unsupported field value: ${zm(n)}`)})(s,e)}function kj(s,e){const t={};return SS(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wi(s,((n,a)=>{const l=dl(a,e.mc(n));l!=null&&(t[n]=l)})),{mapValue:{fields:t}}}function Dj(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof _t||s instanceof Or||s instanceof _s||s instanceof At||s instanceof to||s instanceof gr)}function Qv(s,e,t){if(!Dj(t)||!oS(t)){const n=zm(t);throw n==="an object"?e.Sc(s+" a custom object"):e.Sc(s+" "+n)}}function Hd(s,e,t){if((e=mt(e))instanceof eo)return e._internalPath;if(typeof e=="string")return dg(s,e);throw jm("Field path arguments must be of type string or ",s,!1,void 0,t)}const wM=new RegExp("[~\\*/\\[\\]]");function dg(s,e,t){if(e.search(wM)>=0)throw jm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new eo(...e.split("."))._internalPath}catch{throw jm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function jm(s,e,t,n,a){const l=n&&!n.isEmpty(),u=a!==void 0;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let m="";return(l||u)&&(m+=" (found",l&&(m+=` in field ${n}`),u&&(m+=` in document ${a}`),m+=")"),new he(ne.INVALID_ARGUMENT,h+s+m)}function Pj(s,e){return s.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,t,n,a,l){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new At(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new TM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(hg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class TM extends Gd{data(){return super.data()}}function hg(s,e){return typeof e=="string"?dg(s,e):e instanceof eo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mj(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new he(ne.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Yv{}class eu extends Yv{}function Le(s,e,...t){let n=[];e instanceof Yv&&n.push(e),n=n.concat(t),(function(l){const u=l.filter((m=>m instanceof hl)).length,h=l.filter((m=>m instanceof tu)).length;if(u>1||u>0&&h>0)throw new he(ne.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const a of n)s=a._apply(s);return s}class tu extends eu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new tu(e,t,n)}_apply(e){const t=this._parse(e);return Vj(e._query,t),new jn(e.firestore,e.converter,fx(e._query,t))}_parse(e){const t=ul(e.firestore);return(function(l,u,h,m,p,x,_){let b;if(p.isKeyField()){if(x==="array-contains"||x==="array-contains-any")throw new he(ne.INVALID_ARGUMENT,`Invalid Query. You can't perform '${x}' queries on documentId().`);if(x==="in"||x==="not-in"){wE(_,x);const C=[];for(const k of _)C.push(_E(m,l,k));b={arrayValue:{values:C}}}else b=_E(m,l,_)}else x!=="in"&&x!=="not-in"&&x!=="array-contains-any"||wE(_,x),b=Rj(h,u,_,x==="in"||x==="not-in");return ot.create(p,x,b)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ye(s,e,t){const n=e,a=hg("where",s);return tu._create(a,n,t)}class hl extends Yv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hl(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:St.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(a,l){let u=a;const h=l.getFlattenedFilters();for(const m of h)Vj(u,m),u=fx(u,m)})(e._query,t),new jn(e.firestore,e.converter,fx(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function EM(...s){return s.forEach((e=>Lj("or",e))),hl._create("or",s)}function NM(...s){return s.forEach((e=>Lj("and",e))),hl._create("and",s)}class fg extends eu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new fg(e,t)}_apply(e){const t=(function(a,l,u){if(a.startAt!==null)throw new he(ne.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new he(ne.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bd(l,u)})(e._query,this._field,this._direction);return new jn(e.firestore,e.converter,(function(a,l){const u=a.explicitOrderBy.concat([l]);return new $a(a.path,a.collectionGroup,u,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)})(e._query,t))}}function Jt(s,e="asc"){const t=e,n=hg("orderBy",s);return fg._create(n,t)}class lh extends eu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new lh(e,t,n)}_apply(e){return new jn(e.firestore,e.converter,vm(e._query,this._limit,this._limitType))}}function Zt(s){return lS("limit",s),lh._create("limit",s,"F")}function SM(s){return lS("limitToLast",s),lh._create("limitToLast",s,"L")}class ch extends eu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ch(e,t,n)}_apply(e){const t=Oj(e,this.type,this._docOrFields,this._inclusive);return new jn(e.firestore,e.converter,(function(a,l){return new $a(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,l,a.endAt)})(e._query,t))}}function AM(...s){return ch._create("startAt",s,!0)}function jM(...s){return ch._create("startAfter",s,!1)}class uh extends eu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new uh(e,t,n)}_apply(e){const t=Oj(e,this.type,this._docOrFields,this._inclusive);return new jn(e.firestore,e.converter,(function(a,l){return new $a(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,l)})(e._query,t))}}function IM(...s){return uh._create("endBefore",s,!1)}function CM(...s){return uh._create("endAt",s,!0)}function Oj(s,e,t,n){if(t[0]=mt(t[0]),t[0]instanceof Gd)return(function(l,u,h,m,p){if(!m)throw new he(ne.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const x=[];for(const _ of yc(l))if(_.field.isKeyField())x.push(Xo(u,m.key));else{const b=m.data.field(_.field);if(Qm(b))throw new he(ne.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(b===null){const N=_.field.canonicalString();throw new he(ne.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${N}' (used as the orderBy) does not exist.`)}x.push(b)}return new Gi(x,p)})(s._query,s.firestore._databaseId,e,t[0]._document,n);{const a=ul(s.firestore);return(function(u,h,m,p,x,_){const b=u.explicitOrderBy;if(x.length>b.length)throw new he(ne.INVALID_ARGUMENT,`Too many arguments provided to ${p}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const N=[];for(let C=0;C<x.length;C++){const k=x[C];if(b[C].field.isKeyField()){if(typeof k!="string")throw new he(ne.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${p}(), but got a ${typeof k}`);if(!rv(u)&&k.indexOf("/")!==-1)throw new he(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${p}() must be a plain document ID, but '${k}' contains a slash.`);const L=u.path.child(tt.fromString(k));if(!Te.isDocumentKey(L))throw new he(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${p}() must result in a valid document path, but '${L}' is not because it contains an odd number of segments.`);const F=new Te(L);N.push(Xo(h,F))}else{const L=Rj(m,p,k);N.push(L)}}return new Gi(N,_)})(s._query,s.firestore._databaseId,a,e,t,n)}}function _E(s,e,t){if(typeof(t=mt(t))=="string"){if(t==="")throw new he(ne.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rv(e)&&t.indexOf("/")!==-1)throw new he(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(tt.fromString(t));if(!Te.isDocumentKey(n))throw new he(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Xo(s,new Te(n))}if(t instanceof At)return Xo(s,t._key);throw new he(ne.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${zm(t)}.`)}function wE(s,e){if(!Array.isArray(s)||s.length===0)throw new he(ne.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Vj(s,e){const t=(function(a,l){for(const u of a)for(const h of u.getFlattenedFilters())if(l.indexOf(h.op)>=0)return h.op;return null})(s.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new he(ne.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new he(ne.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Lj(s,e){if(!(e instanceof tu||e instanceof hl))throw new he(ne.INVALID_ARGUMENT,`Function ${s}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Xv{convertValue(e,t="none"){switch(zi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Gt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ha(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ae(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Wi(e,((a,l)=>{n[a]=this.convertValue(l,t)})),n}convertVectorValue(e){const t=e.fields?.[jc].arrayValue?.values?.map((n=>Gt(n.doubleValue)));return new gr(t)}convertGeoPoint(e){return new Or(Gt(e.latitude),Gt(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ym(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Vd(e));default:return null}}convertTimestamp(e){const t=za(e);return new _t(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=tt.fromString(e);ke(wA(n),9688,{name:e});const a=new qi(n.get(1),n.get(3)),l=new Te(n.popFirst(5));return a.isEqual(t)||dn(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mg(s,e,t){let n;return n=s?t&&(t.merge||t.mergeFields)?s.toFirestore(e,t):s.toFirestore(e):e,n}class Wv extends Xv{constructor(e){super(),this.firestore=e}convertBytes(e){return new _s(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(s){return new Fc("sum",Hd("sum",s))}function kM(s){return new Fc("avg",Hd("average",s))}function Uj(){return new Fc("count")}function DM(s,e){return s instanceof Fc&&e instanceof Fc&&s.aggregateType===e.aggregateType&&s._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function PM(s,e){return Bv(s.query,e.query)&&pr(s.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj="NOT SUPPORTED";class La{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class js extends Gd{constructor(e,t,n,a,l,u){super(e,t,n,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new jd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(hg("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new he(ne.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=js._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function MM(s,e,t){if(ll(e,js._jsonSchema)){if(e.bundle===Fj)throw new he(ne.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=cl(s._databaseId),a=xj(e.bundle,n),l=a.Wu(),u=new Rv(a.getMetadata(),n);for(const x of l)u.Ga(x);const h=u.documents;if(h.length!==1)throw new he(ne.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);const m=Zm(n,h[0].document),p=new Te(tt.fromString(e.bundleName));return new js(s,new Wv(s),p,m,new La(!1,!1),t||null)}}js._jsonSchemaVersion="firestore/documentSnapshot/1.0",js._jsonSchema={type:xn("string",js._jsonSchemaVersion),bundleSource:xn("string","DocumentSnapshot"),bundleName:xn("string"),bundle:xn("string")};class jd extends js{data(e={}){return super.data(e)}}class Is{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new La(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new jd(this._firestore,this._userDataWriter,n.key,n,new La(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(ne.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(a,l){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map((h=>{const m=new jd(a._firestore,a._userDataWriter,h.doc.key,h.doc,new La(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:m,oldIndex:-1,newIndex:u++}}))}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>l||h.type!==3)).map((h=>{const m=new jd(a._firestore,a._userDataWriter,h.doc.key,h.doc,new La(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,x=-1;return h.type!==0&&(p=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),x=u.indexOf(h.doc.key)),{type:VM(h.type),doc:m,oldIndex:p,newIndex:x}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new he(ne.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Is._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=qm.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],a=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),n.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function OM(s,e,t){if(ll(e,Is._jsonSchema)){if(e.bundle===Fj)throw new he(ne.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=cl(s._databaseId),a=xj(e.bundle,n),l=a.Wu(),u=new Rv(a.getMetadata(),n);for(const b of l)u.Ga(b);if(u.queries.length!==1)throw new he(ne.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${u.queries.length} queries.`);const h=tg(u.queries[0].bundledQuery),m=u.documents;let p=new $o;m.map((b=>{const N=Zm(n,b.document);p=p.add(N)}));const x=rl.fromInitialDocuments(h,p,Xe(),!1,!1),_=new jn(s,t||null,h);return new Is(s,new Wv(s),_,x)}}function VM(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ae(61501,{type:s})}}function LM(s,e){return s instanceof js&&e instanceof js?s._firestore===e._firestore&&s._key.isEqual(e._key)&&(s._document===null?e._document===null:s._document.isEqual(e._document))&&s._converter===e._converter:s instanceof Is&&e instanceof Is&&s._firestore===e._firestore&&Bv(s.query,e.query)&&s.metadata.isEqual(e.metadata)&&s._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vt(s){s=nt(s,At);const e=nt(s.firestore,Pt);return pj(Qt(e),s._key).then((t=>Jv(e,s,t)))}Is._jsonSchemaVersion="firestore/querySnapshot/1.0",Is._jsonSchema={type:xn("string",Is._jsonSchemaVersion),bundleSource:xn("string","QuerySnapshot"),bundleName:xn("string"),bundle:xn("string")};class no extends Xv{constructor(e){super(),this.firestore=e}convertBytes(e){return new _s(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}function UM(s){s=nt(s,At);const e=nt(s.firestore,Pt),t=Qt(e),n=new no(e);return J4(t,s._key).then((a=>new js(e,n,s._key,a,new La(a!==null&&a.hasLocalMutations,!0),s.converter)))}function FM(s){s=nt(s,At);const e=nt(s.firestore,Pt);return pj(Qt(e),s._key,{source:"server"}).then((t=>Jv(e,s,t)))}function Ke(s){s=nt(s,jn);const e=nt(s.firestore,Pt),t=Qt(e),n=new no(e);return Mj(s._query),yj(t,s._query).then((a=>new Is(e,n,s,a)))}function BM(s){s=nt(s,jn);const e=nt(s.firestore,Pt),t=Qt(e),n=new no(e);return Z4(t,s._query).then((a=>new Is(e,n,s,a)))}function qM(s){s=nt(s,jn);const e=nt(s.firestore,Pt),t=Qt(e),n=new no(e);return yj(t,s._query,{source:"server"}).then((a=>new Is(e,n,s,a)))}function Cs(s,e,t){s=nt(s,At);const n=nt(s.firestore,Pt),a=mg(s.converter,e,t);return nu(n,[ug(ul(n),"setDoc",s._key,a,s.converter!==null,t).toMutation(s._key,Kt.none())])}function $t(s,e,t,...n){s=nt(s,At);const a=nt(s.firestore,Pt),l=ul(a);let u;return u=typeof(e=mt(e))=="string"||e instanceof eo?Kv(l,"updateDoc",s._key,e,t,n):$v(l,"updateDoc",s._key,e),nu(a,[u.toMutation(s._key,Kt.exists(!0))])}function Ko(s){return nu(nt(s.firestore,Pt),[new Qc(s._key,Kt.none())])}function Qs(s,e){const t=nt(s.firestore,Pt),n=ve(s),a=mg(s.converter,e);return nu(t,[ug(ul(s.firestore),"addDoc",n._key,a,s.converter!==null,{}).toMutation(n._key,Kt.exists(!1))]).then((()=>n))}function Im(s,...e){s=mt(s);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||xc(e[n])||(t=e[n++]);const a={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(xc(e[n])){const m=e[n];e[n]=m.next?.bind(m),e[n+1]=m.error?.bind(m),e[n+2]=m.complete?.bind(m)}let l,u,h;if(s instanceof At)u=nt(s.firestore,Pt),h=$c(s._key.path),l={next:m=>{e[n]&&e[n](Jv(u,s,m))},error:e[n+1],complete:e[n+2]};else{const m=nt(s,jn);u=nt(m.firestore,Pt),h=m._query;const p=new no(u);l={next:x=>{e[n]&&e[n](new Is(u,p,m,x))},error:e[n+1],complete:e[n+2]},Mj(s._query)}return(function(p,x,_,b){const N=new og(b),C=new Cv(x,N,_);return p.asyncQueue.enqueueAndForget((async()=>Av(await Uc(p),C))),()=>{N.Nu(),p.asyncQueue.enqueueAndForget((async()=>jv(await Uc(p),C)))}})(Qt(u),h,a,l)}function zM(s,e,...t){const n=mt(s),a=(function(m){const p={bundle:"",bundleName:"",bundleSource:""},x=["bundle","bundleName","bundleSource"];for(const _ of x){if(!(_ in m)){p.error=`snapshotJson missing required field: ${_}`;break}const b=m[_];if(typeof b!="string"){p.error=`snapshotJson field '${_}' must be a string.`;break}if(b.length===0){p.error=`snapshotJson field '${_}' cannot be an empty string.`;break}_==="bundle"?p.bundle=b:_==="bundleName"?p.bundleName=b:_==="bundleSource"&&(p.bundleSource=b)}return p})(e);if(a.error)throw new he(ne.INVALID_ARGUMENT,a.error);let l,u=0;if(typeof t[u]!="object"||xc(t[u])||(l=t[u++]),a.bundleSource==="QuerySnapshot"){let h=null;if(typeof t[u]=="object"&&xc(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,_,b,N){let C,k=!1;return Ax(p,x.bundle).then((()=>Sj(p,x.bundleName))).then((F=>{F&&!k&&(N&&F.withConverter(N),C=Im(F,_||{},b))})).catch((F=>(b.error&&b.error(F),()=>{}))),()=>{k||(k=!0,C&&C())}})(n,a,l,h,t[u])}if(a.bundleSource==="DocumentSnapshot"){let h=null;if(typeof t[u]=="object"&&xc(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,_,b,N){let C,k=!1;return Ax(p,x.bundle).then((()=>{if(!k){const F=new At(p,N||null,Te.fromPath(x.bundleName));C=Im(F,_||{},b)}})).catch((F=>(b.error&&b.error(F),()=>{}))),()=>{k||(k=!0,C&&C())}})(n,a,l,h,t[u])}throw new he(ne.INVALID_ARGUMENT,`unsupported bundle source: ${a.bundleSource}`)}function HM(s,e){return tM(Qt(s=nt(s,Pt)),xc(e)?e:{next:e})}function nu(s,e){return(function(n,a){const l=new zn;return n.asyncQueue.enqueueAndForget((async()=>I4(await Fv(n),a,l))),l.promise})(Qt(s),e)}function Jv(s,e,t){const n=t.docs.get(e._key),a=new no(s);return new js(s,a,e._key,n,new La(t.hasPendingWrites,t.fromCache),e.converter)}function GM(s){return Bj(s,{count:Uj()})}function Bj(s,e){const t=nt(s.firestore,Pt),n=Qt(t),a=NS(e,((l,u)=>new iA(u,l.aggregateType,l._internalFieldPath)));return eM(n,s._query,a).then((l=>(function(h,m,p){const x=new no(h);return new Aj(m,x,p)})(t,s,l)))}class $M{constructor(e){this.kind="memory",this._onlineComponentProvider=Ki.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Vv(void 0)}}toJSON(){return{kind:this.kind}}}class KM{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=qj(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class QM{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Lc.provider}toJSON(){return{kind:this.kind}}}class YM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Vv(e)}}toJSON(){return{kind:this.kind}}}function XM(){return new QM}function WM(s){return new YM(s?.cacheSizeBytes)}function JM(s){return new $M(s)}function ZM(s){return new KM(s)}class eO{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ki.provider,this._offlineComponentProvider={build:t=>new Lv(t,e?.cacheSizeBytes,this.forceOwnership)}}}class tO{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ki.provider,this._offlineComponentProvider={build:t=>new hj(t,e?.cacheSizeBytes)}}}function qj(s){return new eO(s?.forceOwnership)}function nO(){return new tO}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ul(e)}set(e,t,n){this._verifyNotCommitted();const a=Pi(e,this._firestore),l=mg(a.converter,t,n),u=ug(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,n);return this._mutations.push(u.toMutation(a._key,Kt.none())),this}update(e,t,n,...a){this._verifyNotCommitted();const l=Pi(e,this._firestore);let u;return u=typeof(t=mt(t))=="string"||t instanceof eo?Kv(this._dataReader,"WriteBatch.update",l._key,t,n,a):$v(this._dataReader,"WriteBatch.update",l._key,t),this._mutations.push(u.toMutation(l._key,Kt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Pi(e,this._firestore);return this._mutations=this._mutations.concat(new Qc(t._key,Kt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new he(ne.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Pi(s,e){if((s=mt(s)).firestore!==e)throw new he(ne.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ul(e)}get(e){const t=Pi(e,this._firestore),n=new Wv(this._firestore);return this._transaction.lookup([t._key]).then((a=>{if(!a||a.length!==1)return Ae(24041);const l=a[0];if(l.isFoundDocument())return new Gd(this._firestore,n,l.key,l,t.converter);if(l.isNoDocument())return new Gd(this._firestore,n,t._key,null,t.converter);throw Ae(18433,{doc:l})}))}set(e,t,n){const a=Pi(e,this._firestore),l=mg(a.converter,t,n),u=ug(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,n);return this._transaction.set(a._key,u),this}update(e,t,n,...a){const l=Pi(e,this._firestore);let u;return u=typeof(t=mt(t))=="string"||t instanceof eo?Kv(this._dataReader,"Transaction.update",l._key,t,n,a):$v(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,u),this}delete(e){const t=Pi(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hj extends rO{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Pi(e,this._firestore),n=new no(this._firestore);return super.get(e).then((a=>new js(this._firestore,n,t._key,a._document,new La(!1,!1),t.converter)))}}function yd(s,e,t){s=nt(s,Pt);const n={...sO,...t};return(function(l){if(l.maxAttempts<1)throw new he(ne.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(l,u,h){const m=new zn;return l.asyncQueue.enqueueAndForget((async()=>{const p=await gj(l);new Q4(l.asyncQueue,p,h,u,m).ju()})),m.promise})(Qt(s),(a=>e(new Hj(s,a))),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(){return new oh("deleteField")}function Pe(){return new qv("serverTimestamp")}function Bc(...s){return new zv("arrayUnion",s)}function Cm(...s){return new Hv("arrayRemove",s)}function tm(s){return new Gv("increment",s)}function iO(s){return new gr(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(s){return Qt(s=nt(s,Pt)),new zj(s,(e=>nu(s,e)))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oO(s,e){const t=Qt(s=nt(s,Pt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Xs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const n=(function(l){const u=typeof l=="string"?(function(p){try{return JSON.parse(p)}catch(x){throw new he(ne.INVALID_ARGUMENT,"Failed to parse JSON: "+x?.message)}})(l):l,h=[];if(Array.isArray(u.indexes))for(const m of u.indexes){const p=TE(m,"collectionGroup"),x=[];if(Array.isArray(m.fields))for(const _ of m.fields){const b=dg("setIndexConfiguration",TE(_,"fieldPath"));_.arrayConfig==="CONTAINS"?x.push(new Ho(b,2)):_.order==="ASCENDING"?x.push(new Ho(b,0)):_.order==="DESCENDING"&&x.push(new Ho(b,1))}h.push(new wc(wc.UNKNOWN_ID,p,x,Tc.empty()))}return h})(e);return rM(t,n)}function TE(s,e){if(typeof s[e]!="string")throw new he(ne.INVALID_ARGUMENT,"Missing string value for: "+e);return s[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function lO(s){s=nt(s,Pt);const e=EE.get(s);if(e)return e;if(Qt(s)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const n=new Gj(s);return EE.set(s,n),n}function cO(s){$j(s,!0)}function uO(s){$j(s,!1)}function dO(s){iM(Qt(s._firestore)).then((e=>ge("deleting all persistent cache indexes succeeded"))).catch((e=>Xs("deleting all persistent cache indexes failed",e)))}function $j(s,e){aM(Qt(s._firestore),e).then((t=>ge(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>Xs(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const EE=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hO(s){const e=Qt(nt(s.firestore,Pt)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:eg(t,ls(s._query)).ft}function fO(s,e){const t=NS(e,((l,u)=>new iA(u,l.aggregateType,l._internalFieldPath))),n=Qt(nt(s.firestore,Pt)),a=n._onlineComponents?.datastore.serializer;return a===void 0?null:xA(a,HS(s._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mO{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Zv.instance.onExistenceFilterMismatch(e)}}class Zv{constructor(){this.Mc=new Map}static get instance(){return Of||(Of=new Zv,(function(t){if(mx)throw new Error("a TestingHooksSpi instance is already set");mx=t})(Of)),Of}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.Mc;return n.set(t,e),()=>n.delete(t)}}let Of=null;(function(e,t=!0){(function(a){Gc=a})(zc),Vr(new yr("firestore",((n,{instanceIdentifier:a,options:l})=>{const u=n.getProvider("app").getImmediate(),h=new Pt(new Hk(n.getProvider("auth-internal")),new Kk(u,n.getProvider("app-check-internal")),(function(p,x){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new he(ne.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qi(p.options.projectId,x)})(u,a),u);return l={useFetchStreams:t,...l},h._setSettings(l),h}),"PUBLIC").setMultipleInstances(!0)),As(nT,sT,e),As(nT,sT,"esm2020")})();const sa=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Xv,AggregateField:Fc,AggregateQuerySnapshot:Aj,Bytes:_s,CACHE_SIZE_UNLIMITED:cM,CollectionReference:Mr,DocumentReference:At,DocumentSnapshot:js,FieldPath:eo,FieldValue:to,Firestore:Pt,FirestoreError:he,GeoPoint:Or,LoadBundleTask:wj,PersistentCacheIndexManager:Gj,Query:jn,QueryCompositeFilterConstraint:hl,QueryConstraint:eu,QueryDocumentSnapshot:jd,QueryEndAtConstraint:uh,QueryFieldFilterConstraint:tu,QueryLimitConstraint:lh,QueryOrderByConstraint:fg,QuerySnapshot:Is,QueryStartAtConstraint:ch,SnapshotMetadata:La,Timestamp:_t,Transaction:Hj,VectorValue:gr,WriteBatch:zj,_AutoId:qm,_ByteString:en,_DatabaseId:qi,_DocumentKey:Te,_EmptyAppCheckTokenProvider:Qk,_EmptyAuthCredentialsProvider:rS,_FieldPath:Bt,_TestingHooks:mO,_cast:nt,_debugAssert:qk,_internalAggregationQueryToProtoRunAggregationQueryRequest:fO,_internalQueryToProtoQueryTarget:hO,_isBase64Available:RD,_logWarn:Xs,_validateIsNotUsedTogether:iS,addDoc:Qs,aggregateFieldEqual:DM,aggregateQuerySnapshotEqual:PM,and:NM,arrayRemove:Cm,arrayUnion:Bc,average:kM,clearIndexedDbPersistence:fM,collection:Ce,collectionGroup:oM,connectFirestoreEmulator:_j,count:Uj,deleteAllPersistentCacheIndexes:dO,deleteDoc:Ko,deleteField:aO,disableNetwork:pM,disablePersistentCacheIndexAutoCreation:uO,doc:ve,documentId:xM,documentSnapshotFromJSON:MM,enableIndexedDbPersistence:dM,enableMultiTabIndexedDbPersistence:hM,enableNetwork:gM,enablePersistentCacheIndexAutoCreation:cO,endAt:CM,endBefore:IM,ensureFirestoreConfigured:Qt,executeWrite:nu,getAggregateFromServer:Bj,getCountFromServer:GM,getDoc:vt,getDocFromCache:UM,getDocFromServer:FM,getDocs:Ke,getDocsFromCache:BM,getDocsFromServer:qM,getFirestore:Tj,getPersistentCacheIndexManager:lO,increment:tm,initializeFirestore:uM,limit:Zt,limitToLast:SM,loadBundle:Ax,memoryEagerGarbageCollector:XM,memoryLocalCache:JM,memoryLruGarbageCollector:WM,namedQuery:Sj,onSnapshot:Im,onSnapshotResume:zM,onSnapshotsInSync:HM,or:EM,orderBy:Jt,persistentLocalCache:ZM,persistentMultipleTabManager:nO,persistentSingleTabManager:qj,query:Le,queryEqual:Bv,querySnapshotFromJSON:OM,refEqual:lM,runTransaction:yd,serverTimestamp:Pe,setDoc:Cs,setIndexConfiguration:oO,setLogLevel:Bk,snapshotEqual:LM,startAfter:jM,startAt:AM,sum:RM,terminate:yM,updateDoc:$t,vector:iO,waitForPendingWrites:mM,where:Ye,writeBatch:Qo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gO="type.googleapis.com/google.protobuf.Int64Value",pO="type.googleapis.com/google.protobuf.UInt64Value";function Kj(s,e){const t={};for(const n in s)s.hasOwnProperty(n)&&(t[n]=e(s[n]));return t}function Rm(s){if(s==null)return null;if(s instanceof Number&&(s=s.valueOf()),typeof s=="number"&&isFinite(s)||s===!0||s===!1||Object.prototype.toString.call(s)==="[object String]")return s;if(s instanceof Date)return s.toISOString();if(Array.isArray(s))return s.map(e=>Rm(e));if(typeof s=="function"||typeof s=="object")return Kj(s,e=>Rm(e));throw new Error("Data cannot be encoded in JSON: "+s)}function qc(s){if(s==null)return s;if(s["@type"])switch(s["@type"]){case gO:case pO:{const e=Number(s.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+s);return e}default:throw new Error("Data cannot be decoded from JSON: "+s)}return Array.isArray(s)?s.map(e=>qc(e)):typeof s=="function"||typeof s=="object"?Kj(s,e=>qc(e)):s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NE={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ns extends vr{constructor(e,t,n){super(`${eb}/${e}`,t||""),this.details=n,Object.setPrototypeOf(this,Ns.prototype)}}function yO(s){if(s>=200&&s<300)return"ok";switch(s){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function km(s,e){let t=yO(s),n=t,a;try{const l=e&&e.error;if(l){const u=l.status;if(typeof u=="string"){if(!NE[u])return new Ns("internal","internal");t=NE[u],n=u}const h=l.message;typeof h=="string"&&(n=h),a=l.details,a!==void 0&&(a=qc(a))}}catch{}return t==="ok"?null:new Ns(t,n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{constructor(e,t,n,a){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Ks(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(l=>this.auth=l,()=>{}),this.messaging||n.get().then(l=>this.messaging=l,()=>{}),this.appCheck||a?.get().then(l=>this.appCheck=l,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),n=await this.getMessagingToken(),a=await this.getAppCheckToken(e);return{authToken:t,messagingToken:n,appCheckToken:a}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jx="us-central1",vO=/^data: (.*?)(?:\n|$)/;function bO(s){let e=null;return{promise:new Promise((t,n)=>{e=setTimeout(()=>{n(new Ns("deadline-exceeded","deadline-exceeded"))},s)}),cancel:()=>{e&&clearTimeout(e)}}}class _O{constructor(e,t,n,a,l=jx,u=(...h)=>fetch(...h)){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new xO(e,t,n,a),this.cancelAllRequests=new Promise(h=>{this.deleteService=()=>Promise.resolve(h())});try{const h=new URL(l);this.customDomain=h.origin+(h.pathname==="/"?"":h.pathname),this.region=jx}catch{this.customDomain=null,this.region=l}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function wO(s,e,t){const n=Ga(e);s.emulatorOrigin=`http${n?"s":""}://${e}:${t}`,n&&(Om(s.emulatorOrigin+"/backends"),Px("Functions",!0))}function TO(s,e,t){const n=a=>NO(s,e,a,{});return n.stream=(a,l)=>AO(s,e,a,l),n}function Qj(s){return s.emulatorOrigin&&Ga(s.emulatorOrigin)?"include":void 0}async function EO(s,e,t,n,a){t["Content-Type"]="application/json";let l;try{l=await n(s,{method:"POST",body:JSON.stringify(e),headers:t,credentials:Qj(a)})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function Yj(s,e){const t={},n=await s.contextProvider.getContext(e.limitedUseAppCheckTokens);return n.authToken&&(t.Authorization="Bearer "+n.authToken),n.messagingToken&&(t["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=n.appCheckToken),t}function NO(s,e,t,n){const a=s._url(e);return SO(s,a,t,n)}async function SO(s,e,t,n){t=Rm(t);const a={data:t},l=await Yj(s,n),u=n.timeout||7e4,h=bO(u),m=await Promise.race([EO(e,a,l,s.fetchImpl,s),h.promise,s.cancelAllRequests]);if(h.cancel(),!m)throw new Ns("cancelled","Firebase Functions instance was deleted.");const p=km(m.status,m.json);if(p)throw p;if(!m.json)throw new Ns("internal","Response is not valid JSON object.");let x=m.json.data;if(typeof x>"u"&&(x=m.json.result),typeof x>"u")throw new Ns("internal","Response is missing data field.");return{data:qc(x)}}function AO(s,e,t,n){const a=s._url(e);return jO(s,a,t,n||{})}async function jO(s,e,t,n){t=Rm(t);const a={data:t},l=await Yj(s,n);l["Content-Type"]="application/json",l.Accept="text/event-stream";let u;try{u=await s.fetchImpl(e,{method:"POST",body:JSON.stringify(a),headers:l,signal:n?.signal,credentials:Qj(s)})}catch(b){if(b instanceof Error&&b.name==="AbortError"){const C=new Ns("cancelled","Request was cancelled.");return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}const N=km(0,null);return{data:Promise.reject(N),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(N)}}}}}}let h,m;const p=new Promise((b,N)=>{h=b,m=N});n?.signal?.addEventListener("abort",()=>{const b=new Ns("cancelled","Request was cancelled.");m(b)});const x=u.body.getReader(),_=IO(x,h,m,n?.signal);return{stream:{[Symbol.asyncIterator](){const b=_.getReader();return{async next(){const{value:N,done:C}=await b.read();return{value:N,done:C}},async return(){return await b.cancel(),{done:!0,value:void 0}}}}},data:p}}function IO(s,e,t,n){const a=(u,h)=>{const m=u.match(vO);if(!m)return;const p=m[1];try{const x=JSON.parse(p);if("result"in x){e(qc(x.result));return}if("message"in x){h.enqueue(qc(x.message));return}if("error"in x){const _=km(0,x);h.error(_),t(_);return}}catch(x){if(x instanceof Ns){h.error(x),t(x);return}}},l=new TextDecoder;return new ReadableStream({start(u){let h="";return m();async function m(){if(n?.aborted){const p=new Ns("cancelled","Request was cancelled");return u.error(p),t(p),Promise.resolve()}try{const{value:p,done:x}=await s.read();if(x){h.trim()&&a(h.trim(),u),u.close();return}if(n?.aborted){const b=new Ns("cancelled","Request was cancelled");u.error(b),t(b),await s.cancel();return}h+=l.decode(p,{stream:!0});const _=h.split(`
`);h=_.pop()||"";for(const b of _)b.trim()&&a(b.trim(),u);return m()}catch(p){const x=p instanceof Ns?p:km(0,null);u.error(x),t(x)}}},cancel(){return s.cancel()}})}const SE="@firebase/functions",AE="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO="auth-internal",RO="app-check-internal",kO="messaging-internal";function DO(s){const e=(t,{instanceIdentifier:n})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider(CO),u=t.getProvider(kO),h=t.getProvider(RO);return new _O(a,l,u,h,n)};Vr(new yr(eb,e,"PUBLIC").setMultipleInstances(!0)),As(SE,AE,s),As(SE,AE,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PO(s=Lm(),e=jx){const n=da(mt(s),eb).getImmediate({identifier:e}),a=nN("functions");return a&&MO(n,...a),n}function MO(s,e,t){wO(mt(s),e,t)}function Mi(s,e,t){return TO(mt(s),e)}DO();const Xj="@firebase/installations",tb="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wj=1e4,Jj=`w:${tb}`,Zj="FIS_v2",OO="https://firebaseinstallations.googleapis.com/v1",VO=3600*1e3,LO="installations",UO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},al=new ol(LO,UO,FO);function eI(s){return s instanceof vr&&s.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tI({projectId:s}){return`${OO}/projects/${s}/installations`}function nI(s){return{token:s.token,requestStatus:2,expiresIn:qO(s.expiresIn),creationTime:Date.now()}}async function sI(s,e){const n=(await e.json()).error;return al.create("request-failed",{requestName:s,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function rI({apiKey:s}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":s})}function BO(s,{refreshToken:e}){const t=rI(s);return t.append("Authorization",zO(e)),t}async function aI(s){const e=await s();return e.status>=500&&e.status<600?s():e}function qO(s){return Number(s.replace("s","000"))}function zO(s){return`${Zj} ${s}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HO({appConfig:s,heartbeatServiceProvider:e},{fid:t}){const n=tI(s),a=rI(s),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&a.append("x-firebase-client",p)}const u={fid:t,authVersion:Zj,appId:s.appId,sdkVersion:Jj},h={method:"POST",headers:a,body:JSON.stringify(u)},m=await aI(()=>fetch(n,h));if(m.ok){const p=await m.json();return{fid:p.fid||t,registrationStatus:2,refreshToken:p.refreshToken,authToken:nI(p.authToken)}}else throw await sI("Create Installation",m)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iI(s){return new Promise(e=>{setTimeout(e,s)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GO(s){return btoa(String.fromCharCode(...s)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $O=/^[cdef][\w-]{21}$/,Ix="";function KO(){try{const s=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(s),s[0]=112+s[0]%16;const t=QO(s);return $O.test(t)?t:Ix}catch{return Ix}}function QO(s){return GO(s).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(s){return`${s.appName}!${s.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oI=new Map;function lI(s,e){const t=gg(s);cI(t,e),YO(t,e)}function cI(s,e){const t=oI.get(s);if(t)for(const n of t)n(e)}function YO(s,e){const t=XO();t&&t.postMessage({key:s,fid:e}),WO()}let zo=null;function XO(){return!zo&&"BroadcastChannel"in self&&(zo=new BroadcastChannel("[Firebase] FID Change"),zo.onmessage=s=>{cI(s.data.key,s.data.fid)}),zo}function WO(){oI.size===0&&zo&&(zo.close(),zo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO="firebase-installations-database",ZO=1,il="firebase-installations-store";let Oy=null;function nb(){return Oy||(Oy=hN(JO,ZO,{upgrade:(s,e)=>{switch(e){case 0:s.createObjectStore(il)}}})),Oy}async function Dm(s,e){const t=gg(s),a=(await nb()).transaction(il,"readwrite"),l=a.objectStore(il),u=await l.get(t);return await l.put(e,t),await a.done,(!u||u.fid!==e.fid)&&lI(s,e.fid),e}async function uI(s){const e=gg(s),n=(await nb()).transaction(il,"readwrite");await n.objectStore(il).delete(e),await n.done}async function pg(s,e){const t=gg(s),a=(await nb()).transaction(il,"readwrite"),l=a.objectStore(il),u=await l.get(t),h=e(u);return h===void 0?await l.delete(t):await l.put(h,t),await a.done,h&&(!u||u.fid!==h.fid)&&lI(s,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sb(s){let e;const t=await pg(s.appConfig,n=>{const a=eV(n),l=tV(s,a);return e=l.registrationPromise,l.installationEntry});return t.fid===Ix?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function eV(s){const e=s||{fid:KO(),registrationStatus:0};return dI(e)}function tV(s,e){if(e.registrationStatus===0){if(!navigator.onLine){const a=Promise.reject(al.create("app-offline"));return{installationEntry:e,registrationPromise:a}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=nV(s,t);return{installationEntry:t,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:sV(s)}:{installationEntry:e}}async function nV(s,e){try{const t=await HO(s,e);return Dm(s.appConfig,t)}catch(t){throw eI(t)&&t.customData.serverCode===409?await uI(s.appConfig):await Dm(s.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function sV(s){let e=await jE(s.appConfig);for(;e.registrationStatus===1;)await iI(100),e=await jE(s.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:n}=await sb(s);return n||t}return e}function jE(s){return pg(s,e=>{if(!e)throw al.create("installation-not-found");return dI(e)})}function dI(s){return rV(s)?{fid:s.fid,registrationStatus:0}:s}function rV(s){return s.registrationStatus===1&&s.registrationTime+Wj<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aV({appConfig:s,heartbeatServiceProvider:e},t){const n=iV(s,t),a=BO(s,t),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&a.append("x-firebase-client",p)}const u={installation:{sdkVersion:Jj,appId:s.appId}},h={method:"POST",headers:a,body:JSON.stringify(u)},m=await aI(()=>fetch(n,h));if(m.ok){const p=await m.json();return nI(p)}else throw await sI("Generate Auth Token",m)}function iV(s,{fid:e}){return`${tI(s)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rb(s,e=!1){let t;const n=await pg(s.appConfig,l=>{if(!hI(l))throw al.create("not-registered");const u=l.authToken;if(!e&&cV(u))return l;if(u.requestStatus===1)return t=oV(s,e),l;{if(!navigator.onLine)throw al.create("app-offline");const h=dV(l);return t=lV(s,h),h}});return t?await t:n.authToken}async function oV(s,e){let t=await IE(s.appConfig);for(;t.authToken.requestStatus===1;)await iI(100),t=await IE(s.appConfig);const n=t.authToken;return n.requestStatus===0?rb(s,e):n}function IE(s){return pg(s,e=>{if(!hI(e))throw al.create("not-registered");const t=e.authToken;return hV(t)?{...e,authToken:{requestStatus:0}}:e})}async function lV(s,e){try{const t=await aV(s,e),n={...e,authToken:t};return await Dm(s.appConfig,n),t}catch(t){if(eI(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await uI(s.appConfig);else{const n={...e,authToken:{requestStatus:0}};await Dm(s.appConfig,n)}throw t}}function hI(s){return s!==void 0&&s.registrationStatus===2}function cV(s){return s.requestStatus===2&&!uV(s)}function uV(s){const e=Date.now();return e<s.creationTime||s.creationTime+s.expiresIn<e+VO}function dV(s){const e={requestStatus:1,requestTime:Date.now()};return{...s,authToken:e}}function hV(s){return s.requestStatus===1&&s.requestTime+Wj<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fV(s){const e=s,{installationEntry:t,registrationPromise:n}=await sb(e);return n?n.catch(console.error):rb(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mV(s,e=!1){const t=s;return await gV(t),(await rb(t,e)).token}async function gV(s){const{registrationPromise:e}=await sb(s);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(s){if(!s||!s.options)throw Vy("App Configuration");if(!s.name)throw Vy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!s.options[t])throw Vy(t);return{appName:s.name,projectId:s.options.projectId,apiKey:s.options.apiKey,appId:s.options.appId}}function Vy(s){return al.create("missing-app-config-values",{valueName:s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI="installations",yV="installations-internal",xV=s=>{const e=s.getProvider("app").getImmediate(),t=pV(e),n=da(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},vV=s=>{const e=s.getProvider("app").getImmediate(),t=da(e,fI).getImmediate();return{getId:()=>fV(t),getToken:a=>mV(t,a)}};function bV(){Vr(new yr(fI,xV,"PUBLIC")),Vr(new yr(yV,vV,"PRIVATE"))}bV();As(Xj,tb);As(Xj,tb,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pm="analytics",_V="firebase_id",wV="origin",TV=60*1e3,EV="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ab="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs=new Vm("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NV={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Ys=new ol("analytics","Analytics",NV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SV(s){if(!s.startsWith(ab)){const e=Ys.create("invalid-gtag-resource",{gtagURL:s});return Rs.warn(e.message),""}return s}function mI(s){return Promise.all(s.map(e=>e.catch(t=>t)))}function AV(s,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(s,e)),t}function jV(s,e){const t=AV("firebase-js-sdk-policy",{createScriptURL:SV}),n=document.createElement("script"),a=`${ab}?l=${s}&id=${e}`;n.src=t?t?.createScriptURL(a):a,n.async=!0,document.head.appendChild(n)}function IV(s){let e=[];return Array.isArray(window[s])?e=window[s]:window[s]=e,e}async function CV(s,e,t,n,a,l){const u=n[a];try{if(u)await e[u];else{const m=(await mI(t)).find(p=>p.measurementId===a);m&&await e[m.appId]}}catch(h){Rs.error(h)}s("config",a,l)}async function RV(s,e,t,n,a){try{let l=[];if(a&&a.send_to){let u=a.send_to;Array.isArray(u)||(u=[u]);const h=await mI(t);for(const m of u){const p=h.find(_=>_.measurementId===m),x=p&&e[p.appId];if(x)l.push(x);else{l=[];break}}}l.length===0&&(l=Object.values(e)),await Promise.all(l),s("event",n,a||{})}catch(l){Rs.error(l)}}function kV(s,e,t,n){async function a(l,...u){try{if(l==="event"){const[h,m]=u;await RV(s,e,t,h,m)}else if(l==="config"){const[h,m]=u;await CV(s,e,t,n,h,m)}else if(l==="consent"){const[h,m]=u;s("consent",h,m)}else if(l==="get"){const[h,m,p]=u;s("get",h,m,p)}else if(l==="set"){const[h]=u;s("set",h)}else s(l,...u)}catch(h){Rs.error(h)}}return a}function DV(s,e,t,n,a){let l=function(...u){window[n].push(arguments)};return window[a]&&typeof window[a]=="function"&&(l=window[a]),window[a]=kV(l,s,e,t),{gtagCore:l,wrappedGtag:window[a]}}function PV(s){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(ab)&&t.src.includes(s))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MV=30,OV=1e3;class VV{constructor(e={},t=OV){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const gI=new VV;function LV(s){return new Headers({Accept:"application/json","x-goog-api-key":s})}async function UV(s){const{appId:e,apiKey:t}=s,n={method:"GET",headers:LV(t)},a=EV.replace("{app-id}",e),l=await fetch(a,n);if(l.status!==200&&l.status!==304){let u="";try{const h=await l.json();h.error?.message&&(u=h.error.message)}catch{}throw Ys.create("config-fetch-failed",{httpStatus:l.status,responseMessage:u})}return l.json()}async function FV(s,e=gI,t){const{appId:n,apiKey:a,measurementId:l}=s.options;if(!n)throw Ys.create("no-app-id");if(!a){if(l)return{measurementId:l,appId:n};throw Ys.create("no-api-key")}const u=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new zV;return setTimeout(async()=>{h.abort()},TV),pI({appId:n,apiKey:a,measurementId:l},u,h,e)}async function pI(s,{throttleEndTimeMillis:e,backoffCount:t},n,a=gI){const{appId:l,measurementId:u}=s;try{await BV(n,e)}catch(h){if(u)return Rs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:l,measurementId:u};throw h}try{const h=await UV(s);return a.deleteThrottleMetadata(l),h}catch(h){const m=h;if(!qV(m)){if(a.deleteThrottleMetadata(l),u)return Rs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${m?.message}]`),{appId:l,measurementId:u};throw h}const p=Number(m?.customData?.httpStatus)===503?Iw(t,a.intervalMillis,MV):Iw(t,a.intervalMillis),x={throttleEndTimeMillis:Date.now()+p,backoffCount:t+1};return a.setThrottleMetadata(l,x),Rs.debug(`Calling attemptFetch again in ${p} millis`),pI(s,x,n,a)}}function BV(s,e){return new Promise((t,n)=>{const a=Math.max(e-Date.now(),0),l=setTimeout(t,a);s.addEventListener(()=>{clearTimeout(l),n(Ys.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function qV(s){if(!(s instanceof vr)||!s.customData)return!1;const e=Number(s.customData.httpStatus);return e===429||e===500||e===503||e===504}class zV{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function HV(s,e,t,n,a){if(a&&a.global){s("event",t,n);return}else{const l=await e,u={...n,send_to:l};s("event",t,u)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GV(){if(Mx())try{await cN()}catch(s){return Rs.warn(Ys.create("indexeddb-unavailable",{errorInfo:s?.toString()}).message),!1}else return Rs.warn(Ys.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function $V(s,e,t,n,a,l,u){const h=FV(s);h.then(b=>{t[b.measurementId]=b.appId,s.options.measurementId&&b.measurementId!==s.options.measurementId&&Rs.warn(`The measurement ID in the local Firebase config (${s.options.measurementId}) does not match the measurement ID fetched from the server (${b.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(b=>Rs.error(b)),e.push(h);const m=GV().then(b=>{if(b)return n.getId()}),[p,x]=await Promise.all([h,m]);PV(l)||jV(l,p.measurementId),a("js",new Date);const _=u?.config??{};return _[wV]="firebase",_.update=!0,x!=null&&(_[_V]=x),a("config",p.measurementId,_),p.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let KV=class{constructor(e){this.app=e}_delete(){return delete Id[this.app.options.appId],Promise.resolve()}},Id={},CE=[];const RE={};let Ly="dataLayer",QV="gtag",kE,yI,DE=!1;function YV(){const s=[];if(iN()&&s.push("This is a browser extension environment."),v1()||s.push("Cookies are not available."),s.length>0){const e=s.map((n,a)=>`(${a+1}) ${n}`).join(" "),t=Ys.create("invalid-analytics-context",{errorInfo:e});Rs.warn(t.message)}}function XV(s,e,t){YV();const n=s.options.appId;if(!n)throw Ys.create("no-app-id");if(!s.options.apiKey)if(s.options.measurementId)Rs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${s.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Ys.create("no-api-key");if(Id[n]!=null)throw Ys.create("already-exists",{id:n});if(!DE){IV(Ly);const{wrappedGtag:l,gtagCore:u}=DV(Id,CE,RE,Ly,QV);yI=l,kE=u,DE=!0}return Id[n]=$V(s,CE,RE,e,kE,Ly,t),new KV(s)}function WV(s=Lm()){s=mt(s);const e=da(s,Pm);return e.isInitialized()?e.getImmediate():JV(s)}function JV(s,e={}){const t=da(s,Pm);if(t.isInitialized()){const a=t.getImmediate();if(pr(e,t.getOptions()))return a;throw Ys.create("already-initialized")}return t.initialize({options:e})}function na(s,e,t,n){s=mt(s),HV(yI,Id[s.app.options.appId],e,t,n).catch(a=>Rs.error(a))}const PE="@firebase/analytics",ME="0.10.18";function ZV(){Vr(new yr(Pm,(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("installations-internal").getImmediate();return XV(n,a,t)},"PUBLIC")),Vr(new yr("analytics-internal",s,"PRIVATE")),As(PE,ME),As(PE,ME,"esm2020");function s(e){try{const t=e.getProvider(Pm).getImmediate();return{logEvent:(n,a,l)=>na(t,n,a,l)}}catch(t){throw Ys.create("interop-component-reg-failed",{reason:t})}}}ZV();const e3={apiKey:"AIzaSyDQnrbvsx52ikiWELf6hc4YiXQTC1G5tpY",authDomain:"three-sided-flashcard-app.firebaseapp.com",projectId:"three-sided-flashcard-app",storageBucket:"three-sided-flashcard-app.firebasestorage.app",messagingSenderId:"47503676879",appId:"1:47503676879:web:27fb875159cc4459a12eba",measurementId:"G-PBP1G21Q29"},yg=fN(e3),bs=Vk(yg),ee=Tj(yg),Ua=PO(yg),Nn=WV(yg),Fa=Object.freeze(Object.defineProperty({__proto__:null,analytics:Nn,auth:bs,db:ee,functions:Ua},Symbol.toStringTag,{value:"Module"}));class $s{static sanitizeInput(e,t={}){if(!e||typeof e!="string")return"";const{maxLength:n=1e4,allowHtml:a=!1,allowLatex:l=!0,stripScripts:u=!0,stripUrls:h=!1}=t;let m=e;return m.length>n&&(m=m.substring(0,n)),(!a||u)&&(m=m.replace(/<script[^>]*>.*?<\/script>/gi,""),m=m.replace(/on\w+\s*=\s*["'][^"']*["']/gi,""),m=m.replace(/javascript:/gi,""),a||(m=m.replace(/data:/gi,"")),["script","iframe","object","embed","form","input","textarea","button"].forEach(x=>{const _=new RegExp(`<${x}[^>]*>.*?</${x}>`,"gi");m=m.replace(_,"");const b=new RegExp(`<${x}[^>]*/?>`,"gi");m=m.replace(b,"")})),h&&(m=m.replace(/https?:\/\/[^\s]+/gi,"[URL_REMOVED]")),m.trim()}static validateFlashcardInput(e){const t=[],n={};if(!e.statement||typeof e.statement!="string"?t.push("Statement is required and must be text"):e.statement.length<3?t.push("Statement must be at least 3 characters long"):e.statement.length>5e3?t.push("Statement must be less than 5000 characters"):n.statement=this.sanitizeInput(e.statement,{maxLength:5e3,allowLatex:!0,allowHtml:!1}),e.hints&&typeof e.hints=="string"&&(e.hints.length>5e3?t.push("Hints must be less than 5000 characters"):n.hints=this.sanitizeInput(e.hints,{maxLength:5e3,allowLatex:!0,allowHtml:!1})),e.proof&&typeof e.proof=="string"&&(e.proof.length>1e4?t.push("Proof must be less than 10000 characters"):n.proof=this.sanitizeInput(e.proof,{maxLength:1e4,allowLatex:!0,allowHtml:!1})),e.tags)if(typeof e.tags=="string"){const a=e.tags.split(",").map(l=>l.trim()).filter(l=>l);a.length>20&&t.push("Maximum 20 tags allowed"),n.tags=a.map(l=>this.sanitizeInput(l,{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(l=>l&&/^[a-zA-Z0-9\s\-_]+$/.test(l))}else Array.isArray(e.tags)&&(e.tags.length>20&&t.push("Maximum 20 tags allowed"),n.tags=e.tags.slice(0,20).map(a=>this.sanitizeInput(String(a),{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(a=>a&&/^[a-zA-Z0-9\s\-_]+$/.test(a)));return e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),n.isPublic=!!e.isPublic,{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static validateProfileInput(e){const t=[],n={};return!e.displayName||typeof e.displayName!="string"?t.push("Display name is required"):e.displayName.length<2?t.push("Display name must be at least 2 characters"):e.displayName.length>50?t.push("Display name must be less than 50 characters"):/^[a-zA-Z0-9\s\-_\.]+$/.test(e.displayName)?n.displayName=this.sanitizeInput(e.displayName,{maxLength:50,allowLatex:!1,allowHtml:!1}):t.push("Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods"),e.bio&&typeof e.bio=="string"&&(e.bio.length>500?t.push("Bio must be less than 500 characters"):n.bio=this.sanitizeInput(e.bio,{maxLength:500,allowLatex:!1,allowHtml:!1})),e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static rateLimiter=new Map;static checkRateLimit(e,t=10,n=6e4){const a=Date.now(),u=(this.rateLimiter.get(e)||[]).filter(h=>a-h<n);return u.length>=t?{allowed:!1,retryAfter:n-(a-u[0]),message:`Rate limit exceeded. Try again in ${Math.ceil((n-(a-u[0]))/1e3)} seconds.`}:(u.push(a),this.rateLimiter.set(e,u),{allowed:!0,remaining:t-u.length})}static getPublicErrorMessage(e,t=!0){if(!t)return e.message||"Unknown error";const n={"auth/user-not-found":"Invalid email or password","auth/wrong-password":"Invalid email or password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password should be at least 6 characters","auth/invalid-email":"Please enter a valid email address","auth/user-disabled":"This account has been disabled","auth/too-many-requests":"Too many failed attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","auth/popup-closed-by-user":"Sign-in was cancelled","auth/popup-blocked":"Sign-in popup was blocked. Please disable popup blockers","permission-denied":"You don't have permission to perform this action","not-found":"The requested item was not found","already-exists":"This item already exists","resource-exhausted":"Service temporarily unavailable. Please try again","failed-precondition":"Unable to complete request. Please try again",aborted:"Request was cancelled. Please try again","out-of-range":"Request parameters are invalid",unimplemented:"This feature is not yet available",internal:"Internal error. Please try again",unavailable:"Service temporarily unavailable. Please try again","data-loss":"Data error occurred. Please contact support","functions/invalid-argument":"Invalid request parameters","functions/failed-precondition":"Unable to process request","functions/out-of-range":"Request parameters are out of range","functions/unauthenticated":"Please sign in to continue","functions/permission-denied":"You don't have permission for this action","functions/not-found":"Requested service not found","functions/already-exists":"Resource already exists","functions/resource-exhausted":"Service limit reached. Please try again later","functions/cancelled":"Request was cancelled","functions/unknown":"An unexpected error occurred","functions/deadline-exceeded":"Request timed out. Please try again","validation-error":"Please check your input and try again","rate-limit-exceeded":"Too many requests. Please wait and try again","content-too-long":"Content is too long. Please shorten and try again","invalid-content":"Content contains invalid characters","network-error":"Network error. Please check your connection"},a=e.code||e.name||"unknown";return n[a]||"Something went wrong. Please try again"}static INACTIVITY_TIMEOUT=7200*1e3;static lastActivity=Date.now();static timeoutWarningShown=!1;static updateActivity(){this.lastActivity=Date.now(),this.timeoutWarningShown=!1}static checkInactivity(e,t){const n=Date.now()-this.lastActivity;return n>this.INACTIVITY_TIMEOUT*.83&&!this.timeoutWarningShown&&(this.timeoutWarningShown=!0,e&&e()),n>this.INACTIVITY_TIMEOUT?(t&&t(),!0):!1}static setupActivityTracking(e,t){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(a=>{document.addEventListener(a,this.updateActivity.bind(this),{passive:!0})}),setInterval(()=>{this.checkInactivity(e,t)},6e4)}static detectSuspiciousContent(e){const t=[/<script[\s\S]*?>[\s\S]*?<\/script>/gi,/javascript:/gi,/vbscript:/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/union\s+select/gi,/drop\s+table/gi,/delete\s+from/gi,/data:text\/html/gi,/data:application/gi,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g],n=[];return t.forEach((a,l)=>{const u=e.match(a);u&&n.push({pattern:l,matches:u.length,content:u[0]})}),{isSuspicious:n.length>0,findings:n}}static generateSecureId(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";const a=new Uint8Array(e);crypto.getRandomValues(a);for(let l=0;l<e;l++)n+=t[a[l]%t.length];return n}static async hashForLogging(e){const n=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(a)).map(u=>u.toString(16).padStart(2,"0")).join("")}}const xI=P.createContext(void 0),OE=s=>{switch(s){case"auth/popup-closed-by-user":return"Sign-in popup was closed.";case"auth/cancelled-popup-request":return"Another sign-in is in progress.";case"auth/popup-blocked":return"Popup blocked by the browser. Try again or disable the blocker.";case"auth/network-request-failed":return"Network error. Check your connection and try again.";case"auth/user-disabled":return"This account has been disabled.";default:return"Sign-in failed. Please try again."}},Cn=()=>{const s=P.useContext(xI);if(!s)throw new Error("useAuth must be used within <AuthProvider>");return s},t3=({children:s,fallback:e=null})=>{const[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState(!0),[m,p]=P.useState(null),[x,_]=P.useState(!1),b=P.useRef(!1);P.useEffect(()=>{T2(bs,UN).catch(U=>{console.warn("Auth persistence failed, falling back to default:",U)})},[]),P.useEffect(()=>{const U=N2(bs,H=>{n(H),b.current||(b.current=!0,h(!1))}),B=ON(bs,async H=>{if(H)try{const $=await H.getIdToken(!1);l($)}catch($){console.warn("Failed to get ID token:",$),l(null)}else l(null)});return()=>{U(),B()}},[]);const N=async()=>{if(!bs.currentUser)return null;try{const U=await bs.currentUser.getIdToken(!0);return l(U),U}catch(U){return console.warn("getFreshIdToken error:",U),null}},C=async()=>{p(null);const U=new Pa;U.setCustomParameters({prompt:"select_account"});try{return(await G2(bs,U)).user}catch(B){if(B?.code==="auth/popup-blocked"||B?.code==="auth/popup-closed-by-user"||B?.code==="auth/cancelled-popup-request")try{return await W2(bs,U),null}catch(H){throw p(OE(H.code)),H}throw p(OE(B.code)),B}},k=async()=>{p(null);try{await S2(bs)}catch(U){throw p("Error signing out. Please try again."),U}};P.useEffect(()=>{if(t){const U=()=>{_(!0)},B=()=>{alert("Your session has expired due to inactivity. Please sign in again."),k()};$s.setupActivityTracking(U,B)}},[t]);const L=()=>{_(!1),$s.updateActivity()},F=P.useMemo(()=>({user:t,idToken:a,loading:u,authError:m,sessionWarning:x,dismissSessionWarning:L,signInWithGoogle:C,logout:k,getFreshIdToken:N}),[t,a,u,m,x]);return o.jsx(xI.Provider,{value:F,children:u?e:s})};class Ss{static async isSlugTaken(e){try{return(await vt(ve(ee,"profiles",e))).exists()}catch(t){throw console.error("Error checking slug availability:",t),t}}static slugify(e){if(!e||typeof e!="string")return"";const n=e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").slice(0,30);return n.length>=3?n:""}static async createProfile(e,t,n){try{const{displayName:a,bio:l="",institution:u="",email:h}=n;if(await this.isSlugTaken(t))throw new Error(`Slug '${t}' is already taken`);const m={userId:e,displayName:a,bio:l,institution:u,email:h,createdAt:Pe(),updatedAt:Pe(),flashcardCount:0,upvotesReceived:0,loginStreak:0,lastLoginDate:Pe()};await Cs(ve(ee,"profiles",t),m),await Cs(ve(ee,"userToSlug",e),{slug:t}),console.log(" Profile created successfully:",{userId:e,slug:t})}catch(a){throw console.error(" Error creating profile:",a),a}}static async getProfileBySlug(e){try{const t=await vt(ve(ee,"profiles",e));return t.exists()?{id:t.id,slug:t.id,...t.data()}:null}catch(t){throw console.error("Error getting profile by slug:",t),t}}static async getProfileByUserId(e){try{const t=await vt(ve(ee,"userToSlug",e));if(!t.exists())return null;const{slug:n}=t.data();return await this.getProfileBySlug(n)}catch(t){throw console.error("Error getting profile by user ID:",t),t}}static async updateProfile(e,t){try{const n={...t,updatedAt:Pe()};await $t(ve(ee,"profiles",e),n),console.log(" Profile updated successfully:",e)}catch(n){throw console.error(" Error updating profile:",n),n}}static async searchProfiles(e,t=20){try{const n=e.toLowerCase().trim();if(!n)return[];const a=Le(Ce(ee,"profiles")),l=await Ke(a),u=[];return l.docs.forEach(h=>{const m=h.data(),p=(m.displayName||"").toLowerCase(),x=(m.email||"").toLowerCase();(p.includes(n)||x.includes(n))&&u.push({slug:h.id,userId:m.userId,displayName:m.displayName,email:m.email,institution:m.institution,flashcardCount:m.flashcardCount||0})}),u.slice(0,t)}catch(n){throw console.error("Error searching profiles:",n),n}}static async getUserSlug(e){try{const t=await vt(ve(ee,"userToSlug",e));return t.exists()?t.data().slug:null}catch(t){return console.error("Error getting user slug:",t),null}}static async hasProfile(e){try{return!!await this.getUserSlug(e)}catch(t){return console.error("Error checking if user has profile:",t),!1}}static async updateUserStats(e,t){try{const n=await this.getUserSlug(e);if(!n)return;await this.updateProfile(n,t)}catch(n){throw console.error("Error updating user stats:",n),n}}}class as{static async createDeck(e,t){try{const n=await Qs(Ce(ee,"decks"),{name:t.name||"Untitled Deck",description:t.description||"",userId:e,isPublic:t.isPublic||!1,isDefault:t.isDefault||!1,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,color:t.color||"#635BFF",icon:t.icon||"",createdAt:Pe(),updatedAt:Pe(),authorSlug:t.authorSlug||null,slug:t.slug||null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0});return t.isPublic&&t.slug&&t.authorSlug&&await Qs(Ce(ee,"publicDecks"),{deckId:n.id,name:t.name,description:t.description,authorSlug:t.authorSlug,slug:t.slug,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,likeCount:0,importCount:0,createdAt:Pe()}),n.id}catch(n){throw console.error("Error creating deck:",n),n}}static async getUserDecks(e,t=!0){try{let n=Le(Ce(ee,"decks"),Ye("userId","==",e),Jt("updatedAt","desc"));return t||(n=Le(Ce(ee,"decks"),Ye("userId","==",e),Ye("isDefault","==",!1),Jt("updatedAt","desc"))),(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user decks:",n),n}}static async getDeck(e){try{const t=await vt(ve(ee,"decks",e));if(!t.exists())throw new Error("Deck not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching deck:",t),t}}static async updateDeck(e,t){try{const n={...t,updatedAt:Pe()};await $t(ve(ee,"decks",e),n);const a=await this.getDeck(e);if(a.isPublic&&a.slug){const l=Le(Ce(ee,"publicDecks"),Ye("deckId","==",e),Zt(1)),u=await Ke(l);if(!u.empty){const h=u.docs[0];await $t(ve(ee,"publicDecks",h.id),{name:t.name||a.name,description:t.description||a.description,subject:t.subject||a.subject,difficulty:t.difficulty||a.difficulty,tags:t.tags||a.tags})}}return!0}catch(n){throw console.error("Error updating deck:",n),n}}static async deleteDeck(e){try{const t=Qo(ee),n=Le(Ce(ee,"deckCards"),Ye("deckId","==",e)),a=await Ke(n);for(const h of a.docs){t.delete(ve(ee,"deckCards",h.id));const m=h.data().cardId,p=ve(ee,"cards",m);t.update(p,{deckIds:Cm(e)})}t.delete(ve(ee,"decks",e));const l=Le(Ce(ee,"publicDecks"),Ye("deckId","==",e)),u=await Ke(l);for(const h of u.docs)t.delete(ve(ee,"publicDecks",h.id));return await t.commit(),!0}catch(t){throw console.error("Error deleting deck:",t),t}}static async addCardToDeck(e,t,n=null){try{return await yd(ee,async a=>{const l=ve(ee,"decks",e),u=await a.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data().cardCount||0,m=n!==null?n:h+1,p=ve(Ce(ee,"deckCards"));a.set(p,{deckId:e,cardId:t,position:m,addedAt:Pe(),addedBy:u.data().userId});const x=ve(ee,"cards",t);return a.update(x,{deckIds:Bc(e)}),a.update(l,{cardCount:h+1,updatedAt:Pe()}),p.id})}catch(a){throw console.error("Error adding card to deck:",a),a}}static async removeCardFromDeck(e,t){try{return await yd(ee,async n=>{const a=Le(Ce(ee,"deckCards"),Ye("deckId","==",e),Ye("cardId","==",t),Zt(1)),l=await Ke(a);if(l.empty)throw new Error("Card not found in deck");const u=l.docs[0];n.delete(ve(ee,"deckCards",u.id));const h=ve(ee,"cards",t);n.update(h,{deckIds:Cm(e)});const m=ve(ee,"decks",e),x=(await n.get(m)).data().cardCount||0;return n.update(m,{cardCount:Math.max(0,x-1),updatedAt:Pe()}),!0})}catch(n){throw console.error("Error removing card from deck:",n),n}}static async getDeckCards(e,t=100){try{const n=Le(Ce(ee,"deckCards"),Ye("deckId","==",e),Jt("position","asc"),Zt(t)),l=(await Ke(n)).docs.map(h=>h.data().cardId);if(l.length===0)return[];const u=[];for(const h of l)try{const m=await vt(ve(ee,"cards",h));m.exists()&&u.push({id:m.id,...m.data()})}catch(m){console.warn(`Failed to fetch card ${h}:`,m)}return u}catch(n){throw console.error("Error fetching deck cards:",n),n}}static async reorderCardsInDeck(e,t){try{const n=Qo(ee);for(const{cardId:a,position:l}of t){const u=Le(Ce(ee,"deckCards"),Ye("deckId","==",e),Ye("cardId","==",a),Zt(1)),h=await Ke(u);if(!h.empty){const m=h.docs[0];n.update(ve(ee,"deckCards",m.id),{position:l})}}return await n.commit(),!0}catch(n){throw console.error("Error reordering deck cards:",n),n}}static async createDefaultDeck(e){try{const t={name:"My Flashcards",description:"Your complete collection - contains all your flashcards",isDefault:!0,isPublic:!1,subject:"",difficulty:"mixed",tags:[],color:"#635BFF",icon:""};return{id:await this.createDeck(e,t),...t}}catch(t){throw console.error("Error creating default deck:",t),t}}static async getOrCreateDefaultDeck(e){try{const t=Le(Ce(ee,"decks"),Ye("userId","==",e),Ye("isDefault","==",!0),Zt(1)),n=await Ke(t);if(!n.empty){const a=n.docs[0];return{id:a.id,...a.data()}}return await this.createDefaultDeck(e)}catch(t){throw console.error("Error getting or creating default deck:",t),t}}static async migrateCardsToDefaultDeck(e){try{console.log(` Starting deck migration for user: ${e}`);const t=await this.getOrCreateDefaultDeck(e);console.log(` Default deck: ${t.name} (${t.id})`);const[n,a]=await Promise.all([this.getUserCardsFromCollection("cards",e),this.getUserCardsFromCollection("flashcards",e)]),l=[...n,...a];if(console.log(` Found ${l.length} cards to migrate`),l.length===0)return console.log(" No cards to migrate"),{migratedCount:0,defaultDeck:t};let u=0;const h=Qo(ee);for(const m of l)try{const p=ve(Ce(ee,"deckCards"));h.set(p,{deckId:t.id,cardId:m.id,position:u+1,addedAt:Pe(),addedBy:e});const x=ve(ee,m.collection,m.id),_=m.deckIds||[],b=_.includes(t.id)?_:[..._,t.id];h.update(x,{deckIds:b,defaultDeckId:t.id}),u++}catch(p){console.warn(`Failed to migrate card ${m.id}:`,p)}if(u>0){const m=ve(ee,"decks",t.id);h.update(m,{cardCount:u,updatedAt:Pe()}),await h.commit()}return console.log(` Migration complete: ${u} cards migrated`),{migratedCount:u,defaultDeck:t}}catch(t){throw console.error("Error migrating cards to default deck:",t),t}}static async getUserCardsFromCollection(e,t){try{const n=Le(Ce(ee,e),Ye("userId","==",t),Jt("createdAt","desc"));return(await Ke(n)).docs.map(l=>({id:l.id,collection:e,...l.data()}))}catch(n){return console.error(`Error fetching cards from ${e}:`,n),[]}}static async makeDeckPublic(e,t,n){try{return await yd(ee,async a=>{const l=ve(ee,"decks",e),u=await a.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data();a.update(l,{isPublic:!0,authorSlug:t,slug:n,updatedAt:Pe()});const m=ve(Ce(ee,"publicDecks"));return a.set(m,{deckId:e,name:h.name,description:h.description,authorSlug:t,slug:n,subject:h.subject||"",difficulty:h.difficulty||"beginner",tags:h.tags||[],cardCount:h.cardCount||0,likeCount:0,importCount:0,createdAt:h.createdAt}),!0})}catch(a){throw console.error("Error making deck public:",a),a}}static async getPublicDecks(e={},t=50){try{let n=Le(Ce(ee,"publicDecks"));return e.subject&&(n=Le(n,Ye("subject","==",e.subject))),e.difficulty&&(n=Le(n,Ye("difficulty","==",e.difficulty))),e.tag&&(n=Le(n,Ye("tags","array-contains",e.tag))),e.sortBy==="popular"?n=Le(n,Jt("likeCount","desc"),Jt("createdAt","desc")):e.sortBy==="imported"?n=Le(n,Jt("importCount","desc"),Jt("createdAt","desc")):n=Le(n,Jt("createdAt","desc")),n=Le(n,Zt(t)),(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching public decks:",n),n}}static async importPublicDeck(e,t){try{return await yd(ee,async n=>{const a=ve(ee,"decks",e),l=await n.get(a);if(!l.exists())throw new Error("Source deck not found");const u=l.data(),h=ve(Ce(ee,"decks"));n.set(h,{...u,userId:t,isPublic:!1,isDefault:!1,name:`${u.name} (Imported)`,authorSlug:null,slug:null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0,createdAt:Pe(),updatedAt:Pe()});const m=Le(Ce(ee,"deckCards"),Ye("deckId","==",e)),p=await Ke(m);for(const b of p.docs){const N=b.data(),C=ve(ee,"cards",N.cardId),k=await n.get(C);if(k.exists()){const L=k.data(),F=ve(Ce(ee,"cards"));n.set(F,{...L,userId:t,isPublic:!1,deckIds:[h.id],defaultDeckId:h.id,createdAt:Pe(),originalCardId:N.cardId});const U=ve(Ce(ee,"deckCards"));n.set(U,{deckId:h.id,cardId:F.id,position:N.position,addedAt:Pe(),addedBy:t})}}const x=Le(Ce(ee,"publicDecks"),Ye("deckId","==",e),Zt(1)),_=await Ke(x);if(!_.empty){const b=_.docs[0];n.update(ve(ee,"publicDecks",b.id),{importCount:(b.data().importCount||0)+1})}return h.id})}catch(n){throw console.error("Error importing public deck:",n),n}}static async updateDeckStats(e,t){try{const n=ve(ee,"decks",e);return await $t(n,{...t,lastStudied:Pe(),updatedAt:Pe()}),!0}catch(n){throw console.error("Error updating deck stats:",n),n}}static async getDeckAnalytics(e){try{const t=await this.getDeck(e),n=await this.getDeckCards(e);return{cardCount:n.length,studyStreak:t.studyStreak||0,averageScore:t.averageScore||0,lastStudied:t.lastStudied,createdAt:t.createdAt,subjects:[...new Set(n.map(a=>a.subject).filter(Boolean))],tags:[...new Set(n.flatMap(a=>a.tags||[]))]}}catch(t){throw console.error("Error getting deck analytics:",t),t}}static async generateUniqueSlug(e,t){try{const n=`${e.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,30)}-${t}`;let a=n,l=0;for(;l<5;){const u=Le(Ce(ee,"publicDecks"),Ye("slug","==",a),Zt(1));if((await Ke(u)).empty)return a;a=`${n}-${Math.floor(Math.random()*1e4)}`,l++}throw new Error("Failed to generate unique slug")}catch(n){throw console.error("Error generating unique slug:",n),n}}}class nm{static async getUserProfile(e){try{return await Ss.getProfileByUserId(e)}catch(t){throw console.error("Error fetching user profile:",t),t}}static async createUserProfile(e,t){try{const n=ve(ee,"users",e);return await Cs(n,{...t,createdAt:Pe(),updatedAt:Pe(),isPremium:!1,flashcardCount:0,upvotes:0,streak:0}),e}catch(n){throw console.error("Error creating user profile:",n),n}}static async updateUserProfile(e,t){try{const n=ve(ee,"users",e);await $t(n,{...t,updatedAt:Pe()})}catch(n){throw console.error("Error updating user profile:",n),n}}static async getUserStats(e){try{const t=await this.getUserProfile(e);if(!t)return null;const n=[Le(Ce(ee,"cards"),Ye("userId","==",e)),Le(Ce(ee,"flashcards"),Ye("userId","==",e)),Le(Ce(ee,"publicCards"),Ye("userId","==",e))],[a,l,u]=await Promise.all(n.map(p=>Ke(p))),h=a.size+l.size+u.size,m=[];return h>0&&m.push("first_card"),h>=10&&m.push("ten_cards"),h>=100&&m.push("hundred_cards"),t.upvotesReceived>50&&m.push("popular_creator"),{...t,flashcardCount:h,achievements:m,studySessions:Math.floor(Math.random()*20)+1,followers:Math.floor(Math.random()*100),rating:(Math.random()*2+3).toFixed(1)}}catch(t){throw console.error("Error fetching user stats:",t),t}}static async checkOnboardingStatus(e){try{const t=await this.getUserProfile(e);if(!t)return{hasProfile:!1,hasCards:!1};const n=Le(Ce(ee,"flashcards"),Ye("authorId","==",e),Zt(1));return{hasProfile:!0,hasCards:!(await Ke(n)).empty,profile:t}}catch(t){throw console.error("Error checking onboarding status:",t),t}}static async getTopUsers(e=20,t="allTime"){try{const n=Le(Ce(ee,"users"),Jt("flashcardCount","desc"),Jt("upvotes","desc"),Zt(e));return(await Ke(n)).docs.map(l=>({uid:l.id,...l.data()}))}catch(n){return console.error("Error fetching top users:",n),[]}}static async getStudyHistory(e){try{return[{date:"2024-01-15",duration:45,cardsStudied:12,accuracy:85},{date:"2024-01-14",duration:30,cardsStudied:8,accuracy:92},{date:"2024-01-13",duration:60,cardsStudied:20,accuracy:78},{date:"2024-01-12",duration:25,cardsStudied:6,accuracy:95},{date:"2024-01-11",duration:40,cardsStudied:15,accuracy:88}]}catch(t){return console.error("Error fetching study history:",t),[]}}static async needsDeckMigration(e){try{if((await as.getUserDecks(e)).length>0)return!1;const n=Le(Ce(ee,"cards"),Ye("userId","==",e),Zt(1)),a=await Ke(n),l=Le(Ce(ee,"flashcards"),Ye("userId","==",e),Zt(1)),u=await Ke(l);return!a.empty||!u.empty}catch(t){return console.error("Error checking deck migration status:",t),!1}}static async migrateUserToDecks(e){try{if(console.log(` Starting deck migration for user: ${e}`),!await this.needsDeckMigration(e))return console.log(" User already migrated or has no cards"),{success:!0,message:"No migration needed"};const n=await as.migrateCardsToDefaultDeck(e),a=ve(ee,"users",e);return await Cs(a,{deckMigrationCompleted:!0,deckMigrationDate:Pe(),updatedAt:Pe()},{merge:!0}),console.log(` Deck migration completed for user: ${e}`),console.log(" Migration stats:",n),{success:!0,message:`Successfully migrated ${n.migratedCount} cards`,migrationResult:n}}catch(t){console.error("Error migrating user to decks:",t);try{const n=ve(ee,"users",e);await Cs(n,{deckMigrationFailed:!0,deckMigrationError:t.message,deckMigrationAttemptDate:Pe(),updatedAt:Pe()},{merge:!0})}catch(n){console.error("Failed to log migration error:",n)}return{success:!1,message:`Migration failed: ${t.message}`,error:t}}}static async autoMigrateUserDecks(e){try{const t=await vt(ve(ee,"users",e)),n=t.exists()?t.data():{};if(n.deckMigrationCompleted)return{success:!0,message:"Already migrated"};if(n.deckMigrationFailed&&n.deckMigrationAttemptDate){const a=n.deckMigrationAttemptDate.toMillis();if((Date.now()-a)/(1e3*60*60)<24)return{success:!1,message:"Migration failed recently, will retry later"}}return await this.migrateUserToDecks(e)}catch(t){return console.error("Error in auto-migration:",t),{success:!1,message:"Auto-migration failed",error:t}}}}class is{static async getUserFlashcards(e,t=50){try{const n=Le(Ce(ee,"cards"),Ye("userId","==",e),Jt("createdAt","desc"),Zt(t));return(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user flashcards:",n),n}}static async getPublicFlashcards(e=50){try{const t=Le(Ce(ee,"publicCards"),Jt("createdAt","desc"),Zt(e));return(await Ke(t)).docs.map(a=>({id:a.id,...a.data()}))}catch(t){throw console.error("Error fetching public flashcards:",t),t}}static async getPublicFlashcardsByUser(e,t=50){try{const n=Le(Ce(ee,"publicCards"),Ye("userId","==",e),Jt("createdAt","desc"),Zt(t));return(await Ke(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user public flashcards:",n),n}}static async createFlashcard(e,t,n=null){try{if(console.log(" Creating flashcard for user:",t,"with data:",e),!t||typeof t!="string")throw new Error("Valid user ID is required to create flashcard");const a=await as.getOrCreateDefaultDeck(t);console.log(" Default deck obtained:",a.id);const l=n||a.id,u=n&&n!==a.id?[a.id,l]:[a.id],h={statement:e.statement||e.question||"",hints:e.hints||e.answer||"",proof:e.proof||"",tags:Array.isArray(e.tags)?e.tags:typeof e.tags=="string"?e.tags.split(",").map(p=>p.trim()).filter(p=>p):[],subject:e.subject||"",userId:t,createdAt:Pe(),isPublic:e.isPublic||!1,defaultDeckId:a.id,deckIds:u};console.log(" Creating card document:",h);const m=await Qs(Ce(ee,"cards"),h);if(e.isPublic){let p=null;const x=await vt(ve(ee,"userToSlug",t));if(x.exists())p=x.data().slug;else{const N=await vt(ve(ee,"users",t));if(N.exists()&&N.data().username)p=N.data().username;else throw new Error("You must create a profile before posting public cards. Please create your profile first.")}const _=(e.question||e.statement).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,50),b=await this.ensureUniqueCardSlug(_);await Cs(ve(ee,"publicCards",b),{statement:e.question||e.statement,hints:e.hints||e.answer,proof:e.proof||e.answer,tags:e.tags||[],userId:t,authorSlug:p,slug:b,id:b,createdAt:Pe(),likeCount:0,viewCount:0,importCount:0})}for(const p of u)await as.addCardToDeck(p,m.id);return m.id}catch(a){throw console.error("Error creating flashcard:",a),a}}static async updateCardDeck(e,t){try{const n=ve(ee,"cards",e),a=await vt(n);if(!a.exists())throw new Error("Card not found");const u=a.data().deckIds||[];if(!u.includes(t)){const h=[...u,t];await $t(n,{deckIds:h})}return!0}catch(n){throw console.error("Error updating card deck:",n),n}}static async ensureUniqueCardSlug(e){let t=e,n=0;for(;n<5;){const a=ve(ee,"publicCards",t);if(!(await vt(a)).exists())return t;t=e+"-"+Math.floor(Math.random()*1e4),n++}throw new Error("Failed to generate unique card slug after multiple attempts.")}static async updateFlashcard(e,t){try{const n=ve(ee,"cards",e);await $t(n,{...t,updatedAt:Pe()})}catch(n){throw console.error("Error updating flashcard:",n),n}}static async deleteFlashcard(e){try{const t=ve(ee,"cards",e);await Ko(t)}catch(t){throw console.error("Error deleting flashcard:",t),t}}static async searchFlashcards(e,t={},n=20){try{const a=[Ye("isPublic","==",!0)];t.subject&&a.push(Ye("subject","==",t.subject));let l="createdAt",u="desc";t.sortBy==="oldest"?(l="createdAt",u="asc"):t.sortBy==="popular"&&(l="upvotes",u="desc");const h=Le(Ce(ee,"flashcards"),...a,Jt(l,u),Zt(n*3));let p=(await Ke(h)).docs.map(x=>({id:x.id,...x.data()}));if(e&&e.trim()){const x=e.toLowerCase();p=p.filter(_=>_.question?.toLowerCase().includes(x)||_.answer?.toLowerCase().includes(x)||Array.isArray(_.hints)&&_.hints.some(b=>b.toLowerCase().includes(x))||Array.isArray(_.tags)&&_.tags.some(b=>b.toLowerCase().includes(x)))}return p.slice(0,n)}catch(a){return console.error("Error searching flashcards:",a),await this.getPublicFlashcards(n)}}static async getSubjects(){try{const e=await this.getPublicFlashcards(1e3),t=new Set;return e.forEach(n=>{n.subject&&t.add(n.subject)}),Array.from(t).sort()}catch(e){return console.error("Error fetching subjects:",e),["Mathematics","Physics","Chemistry","Biology","Computer Science"]}}static async getPopularTags(e=20){try{const t=await this.getPublicFlashcards(1e3),n={};return t.forEach(a=>{a.tags&&a.tags.forEach(l=>{n[l]=(n[l]||0)+1})}),Object.entries(n).sort(([,a],[,l])=>l-a).slice(0,e).map(([a])=>a)}catch(t){return console.error("Error fetching popular tags:",t),["calculus","algebra","geometry","trigonometry","statistics"]}}static async getUserFavorites(e){try{return(await this.getPublicFlashcards(20)).slice(0,10)}catch(t){return console.error("Error fetching user favorites:",t),[]}}static async removeFromFavorites(e,t){try{return!0}catch(n){throw console.error("Error removing from favorites:",n),n}}static async getDeckFlashcards(e,t=100){try{return await as.getDeckCards(e,t)}catch(n){throw console.error("Error fetching deck flashcards:",n),n}}static async moveCardToDeck(e,t,n){try{return t&&await as.removeCardFromDeck(t,e),await as.addCardToDeck(n,e),await $t(ve(ee,"cards",e),{defaultDeckId:n,deckIds:Bc(n)}),t&&await $t(ve(ee,"cards",e),{deckIds:Cm(t)}),!0}catch(a){throw console.error("Error moving card to deck:",a),a}}static async getUserFlashcardsByDeck(e){try{const t=await as.getUserDecks(e),n={};for(const a of t)n[a.id]={deck:a,cards:await this.getDeckFlashcards(a.id)};return n}catch(t){throw console.error("Error fetching user flashcards by deck:",t),t}}static async createFlashcardInDeck(e,t,n){try{return await this.createFlashcard(e,t,n)}catch(a){throw console.error("Error creating flashcard in deck:",a),a}}static async getFlashcardsFromDecks(e,t=200){try{const n=[];for(const l of e){const u=await this.getDeckFlashcards(l,t);n.push(...u)}return n.reduce((l,u)=>(l.find(h=>h.id===u.id)||l.push(u),l),[]).sort((l,u)=>{const h=l.createdAt?.toMillis?.()||l.createdAt?.getTime?.()||0;return(u.createdAt?.toMillis?.()||u.createdAt?.getTime?.()||0)-h})}catch(n){throw console.error("Error fetching flashcards from multiple decks:",n),n}}static async getPublicFlashcard(e){try{const t=await vt(ve(ee,"publicCards",e));if(!t.exists())throw new Error("Public flashcard not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching public flashcard:",t),t}}static async updatePublicFlashcard(e,t,n){try{const a=await vt(ve(ee,"publicCards",e));if(!a.exists())throw new Error("Public flashcard not found");if(a.data().userId!==n)throw new Error("You can only edit your own public flashcards");const u=ve(ee,"publicCards",e);return await $t(u,{...t,updatedAt:Pe()}),{success:!0}}catch(a){throw console.error("Error updating public flashcard:",a),a}}static async deletePublicFlashcard(e,t){try{const n=await vt(ve(ee,"publicCards",e));if(!n.exists())throw new Error("Public flashcard not found");if(n.data().userId!==t)throw new Error("You can only delete your own public flashcards");return await Ko(ve(ee,"publicCards",e)),{success:!0}}catch(n){throw console.error("Error deleting public flashcard:",n),n}}static async toggleFlashcardPublic(e,t,n=!0){try{return n?await this.makeFlashcardPublic(e,t):await this.makeFlashcardPrivate(e,t),{success:!0}}catch(a){throw console.error("Error toggling flashcard public status:",a),a}}static async makeFlashcardPublic(e,t){try{const n=await this.getFlashcard(e,t),a=await vt(ve(ee,"userToSlug",t));if(!a.exists())throw new Error("You must create a profile before making cards public");const l=a.data().slug,u=this.generateSlugFromStatement(n.statement),h=await this.ensureUniqueSlug(u),m={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,authorSlug:l,slug:h,createdAt:n.createdAt||Pe(),updatedAt:Pe(),likeCount:0,viewCount:0,importCount:0};return await Cs(ve(ee,"publicCards",h),m),await $t(ve(ee,"cards",e),{isPublic:!0,publicSlug:h,updatedAt:Pe()}),{success:!0,publicSlug:h,publicUrl:`/card/${h}`}}catch(n){throw console.error("Error making flashcard public:",n),n}}static async makeFlashcardPrivate(e,t){try{const n=await vt(ve(ee,"cards",e));if(!n.exists())throw new Error("Private flashcard not found");const a=n.data();if(a.userId!==t)throw new Error("You can only modify your own flashcards");return a.publicSlug&&await Ko(ve(ee,"publicCards",a.publicSlug)),await $t(ve(ee,"cards",e),{isPublic:!1,publicSlug:null,updatedAt:Pe()}),{success:!0}}catch(n){throw console.error("Error making flashcard private:",n),n}}static async importPublicFlashcard(e,t){try{const n=await this.getPublicFlashcard(e),a={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,createdAt:Pe(),isPublic:!1,originalCardId:e,originalAuthor:n.userId,importedAt:Pe()},l=await Qs(Ce(ee,"cards"),a);return await $t(ve(ee,"publicCards",e),{importCount:increment(1)}),{success:!0,cardId:l.id}}catch(n){throw console.error("Error importing public flashcard:",n),n}}static generateSlugFromStatement(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().replace(/\s+/g,"-").slice(0,50)}static async ensureUniqueSlug(e){let t=e,n=0;const a=10;for(;n<a;){if(!(await vt(ve(ee,"publicCards",t))).exists())return t;n++,t=`${e}-${Math.floor(Math.random()*1e4)}`}throw new Error("Failed to generate unique slug after multiple attempts")}}class sm{static async autoFillFromStatement(e){try{const t=await bs.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/deepseekAutofill",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}const a=await n.json();return{hints:a.hints||"",proof:a.proof||"",tags:a.tags||[]}}catch(t){throw console.error("Error with AI autofill:",t),t}}static async autoTagOnly(e){try{const t=await bs.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/autoTagOnly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).tags||[]}catch(t){throw console.error("Error with AI auto-tagging:",t),t}}static async convertToLaTeX(e){try{const t=await bs.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/convertToLatex",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({input:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).latex||e}catch(t){throw console.error("Error converting to LaTeX:",t),t}}}const n3="modulepreload",s3=function(s){return"/new/"+s},VE={},Sn=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let p=function(x){return Promise.all(x.map(_=>Promise.resolve(_).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var u=p;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),m=h?.nonce||h?.getAttribute("nonce");a=p(t.map(x=>{if(x=s3(x),x in VE)return;VE[x]=!0;const _=x.endsWith(".css"),b=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${b}`))return;const N=document.createElement("link");if(N.rel=_?"stylesheet":n3,_||(N.as="script"),N.crossOrigin="",N.href=x,m&&N.setAttribute("nonce",m),document.head.appendChild(N),_)return new Promise((C,k)=>{N.addEventListener("load",C),N.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${x}`)))})}))}function l(h){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=h,window.dispatchEvent(m),!m.defaultPrevented)throw h}return a.then(h=>{for(const m of h||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})},r3=({value:s,onChange:e,className:t="",placeholder:n="Type tags here or click existing tags below"})=>{const{user:a}=Cn(),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[_,b]=P.useState([]),N=P.useRef(null);P.useEffect(()=>{const $=s?s.split(",").map(M=>M.trim()).filter(M=>M):[];b($)},[s]);const C=()=>{if(!s)return l;const $=s.split(",").map(R=>R.trim()),M=$[$.length-1].toLowerCase();return M?l.filter(R=>R.toLowerCase().includes(M)&&!_.includes(R)).sort((R,T)=>{const A=R.toLowerCase().startsWith(M),V=T.toLowerCase().startsWith(M);return A&&!V?-1:!A&&V?1:R.localeCompare(T)}):l};P.useEffect(()=>{k()},[a]);const k=async()=>{if(!a?.uid){m(!1);return}try{m(!0);const $=await is.getUserFlashcards(a.uid,200),{collection:M,query:R,where:T,getDocs:A}=await Sn(async()=>{const{collection:oe,query:Y,where:be,getDocs:D}=await Promise.resolve().then(()=>sa);return{collection:oe,query:Y,where:be,getDocs:D}},void 0),{db:V}=await Sn(async()=>{const{db:oe}=await Promise.resolve().then(()=>Fa);return{db:oe}},void 0),I=R(M(V,"flashcards"),T("userId","==",a.uid)),O=(await A(I)).docs.map(oe=>oe.data()),Ve=[...$,...O],ae=new Set;Ve.forEach(oe=>{oe.tags&&Array.isArray(oe.tags)?oe.tags.forEach(Y=>{Y&&typeof Y=="string"&&ae.add(Y.trim())}):typeof oe.tags=="string"&&oe.tags.split(",").forEach(Y=>{const be=Y.trim();be&&ae.add(be)})});const z=Array.from(ae).sort();u(z)}catch($){console.error("Error loading existing tags:",$),u([])}finally{m(!1)}},L=$=>{const M=_.slice();if(M.includes($))return;const R=[...M,$],T=R.join(", ");b(R),e(T)},F=$=>{const M=_.filter(T=>T!==$),R=M.join(", ");b(M),e(R)},U=$=>{e($.target.value)},B=$=>{if($.key==="Tab"){const M=C();M.length>0&&($.preventDefault(),L(M[0]))}},H=()=>{x(!p)};return o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"mb-3",children:o.jsx("textarea",{ref:N,value:s,onChange:U,onKeyDown:B,placeholder:n,className:`claude-input w-full resize-none ${t}`,rows:"2"})}),_.length>0&&o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Selected tags:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(($,M)=>o.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:["#",$,o.jsx("button",{onClick:()=>F($),className:"ml-1 hover:bg-white/20 rounded-full w-4 h-4 flex items-center justify-center text-xs",title:"Remove tag",children:""})]},M))})]}),o.jsxs("div",{className:"existing-tags-section",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("div",{className:"text-sm claude-text-secondary",children:s?`Filtered tags (${C().length}):`:"Click to add existing tags:"}),l.length>6&&o.jsxs("button",{onClick:H,className:"text-sm px-2 py-1 rounded",style:{color:"var(--claude-accent)",backgroundColor:"var(--claude-accent-bg)"},children:["View All (",l.length,")"]})]}),o.jsx("div",{className:"existing-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",maxHeight:"120px",overflowY:"auto",padding:"0.75rem",backgroundColor:"var(--claude-surface)",border:"1px solid var(--claude-border)",borderRadius:"8px"},children:h?o.jsx("div",{className:"claude-text-muted italic",children:"Loading existing tags..."}):l.length===0?o.jsx("div",{className:"claude-text-muted italic",children:"No existing tags found. Create your first card to see tags here!"}):C().length===0&&s?o.jsxs("div",{className:"claude-text-muted italic",children:['No tags match your search. Press Enter to add "',s.split(",").pop()?.trim(),'" as a new tag.']}):C().slice(0,p?C().length:12).map($=>{const M=_.includes($);return o.jsxs("button",{onClick:()=>L($),className:`tag-btn transition-all duration-200 ${M?"selected":""}`,style:{backgroundColor:M?"var(--claude-accent)":"var(--claude-subtle)",color:M?"white":"var(--claude-primary-text)",border:"none",padding:"0.25rem 0.75rem",borderRadius:"20px",fontSize:"0.85rem",cursor:"pointer",whiteSpace:"nowrap",opacity:M?.7:1},onMouseEnter:R=>{M||(R.target.style.backgroundColor="var(--claude-border)",R.target.style.color="var(--claude-heading)")},onMouseLeave:R=>{M||(R.target.style.backgroundColor="var(--claude-subtle)",R.target.style.color="var(--claude-primary-text)")},title:M?"Already selected":`Add "${$}" tag`,children:["#",$]},$)})})]}),p&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"claude-card max-w-2xl w-full mx-4 p-6 max-h-[80vh] overflow-hidden",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Select Tags"}),o.jsx("button",{onClick:()=>x(!1),className:"claude-text-muted hover:claude-text-secondary transition-colors text-2xl",style:{color:"var(--claude-text-muted)"},onMouseEnter:$=>$.target.style.color="var(--claude-text-secondary)",onMouseLeave:$=>$.target.style.color="var(--claude-text-muted)",children:""})]}),o.jsx("div",{className:"mb-4",children:o.jsx("p",{className:"claude-text-secondary",children:"Click tags to add them to your flashcard:"})}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-96 overflow-y-auto p-2",children:l.map($=>{const M=_.includes($);return o.jsxs("button",{onClick:()=>{L($)},className:`p-3 rounded-lg border text-left transition-all duration-200 ${M?"border-purple-500 bg-purple-500/20":"border-gray-600 hover:border-purple-500 hover:bg-purple-500/10"}`,children:[o.jsxs("div",{className:"font-medium",style:{color:M?"var(--claude-accent)":"var(--claude-primary-text)"},children:["#",$]}),o.jsx("div",{className:"text-sm claude-text-secondary",children:M?" Selected":"Click to add"})]},$)})}),o.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:o.jsxs("button",{onClick:()=>x(!1),className:"claude-button-primary flex-1",children:["Done (",_.length," selected)"]})})]})})]})},a3=({value:s,onChange:e,className:t="",placeholder:n="Select or type a subject"})=>{const{user:a}=Cn(),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[_,b]=P.useState(!1),N=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Statistics","Calculus","Linear Algebra","Differential Equations","Organic Chemistry","Molecular Biology","Machine Learning","Data Science","Literature","World History","European History","American History","Political Science"];P.useEffect(()=>{C()},[a]);const C=async()=>{if(!a?.uid){m(!1);return}try{m(!0);const M=await is.getUserFlashcards(a.uid,200),{collection:R,query:T,where:A,getDocs:V}=await Sn(async()=>{const{collection:Y,query:be,where:D,getDocs:se}=await Promise.resolve().then(()=>sa);return{collection:Y,query:be,where:D,getDocs:se}},void 0),{db:I}=await Sn(async()=>{const{db:Y}=await Promise.resolve().then(()=>Fa);return{db:Y}},void 0),G=T(R(I,"flashcards"),A("userId","==",a.uid)),Ve=(await V(G)).docs.map(Y=>Y.data()),ae=[...M,...Ve],z=new Set;ae.forEach(Y=>{if(Y.subject&&typeof Y.subject=="string"){const be=Y.subject.trim();be&&be!=="General"&&z.add(be)}});const oe=Array.from(z).sort();u(oe)}catch(M){console.error("Error loading existing subjects:",M),u([])}finally{m(!1)}},k=()=>{const M=new Set([...N,...l]),R=s?.toLowerCase()||"";return R?Array.from(M).filter(T=>T.toLowerCase().includes(R)).sort((T,A)=>{const V=T.toLowerCase().startsWith(R),I=A.toLowerCase().startsWith(R);return V&&!I?-1:!V&&I?1:T.localeCompare(A)}):Array.from(M).sort()},L=M=>{e(M),x(!1)},F=M=>{e(M.target.value),x(!0)},U=()=>{b(!0),x(!0)},B=()=>{b(!1),setTimeout(()=>x(!1),150)},H=k(),$=l.length>0;return o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"text",value:s||"",onChange:F,onFocus:U,onBlur:B,placeholder:n,className:`claude-input w-full ${t}`}),p&&(_||s)&&o.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:h?o.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading subjects..."}):o.jsxs(o.Fragment,{children:[$&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-purple-400",children:" Your Subjects"})}),l.filter(M=>!s||M.toLowerCase().includes(s.toLowerCase())).slice(0,5).map(M=>o.jsx("button",{onClick:()=>L(M),className:"w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-purple-400",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:M}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"From your cards"})]})]})},`existing-${M}`))]}),o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-blue-400",children:" Popular Subjects"})}),H.filter(M=>!l.includes(M)).slice(0,8).map(M=>o.jsx("button",{onClick:()=>L(M),className:"w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-blue-400",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:M}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Popular choice"})]})]})},`popular-${M}`)),H.length===0&&s&&o.jsxs("div",{className:"p-4 text-center",children:[o.jsx("div",{className:"claude-text-muted mb-2",children:"No matching subjects found"}),o.jsxs("button",{onClick:()=>L(s),className:"px-4 py-2 rounded text-sm",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:['Create "',s,'"']})]}),s&&!H.some(M=>M.toLowerCase()===s.toLowerCase())&&o.jsx("button",{onClick:()=>L(s),className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-green-500/10 transition-colors",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-green-400",children:""}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:['Create "',s,'"']}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"New custom subject"})]})]})})]})}),!_&&!s&&$&&o.jsxs("div",{className:"mt-3",children:[o.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Recent subjects:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:l.slice(0,6).map(M=>o.jsx("button",{onClick:()=>L(M),className:"px-3 py-1 rounded-full text-sm font-medium transition-all duration-200",style:{backgroundColor:"#e2e8f0",color:"#4a5568"},onMouseEnter:R=>{R.target.style.backgroundColor="var(--claude-accent)",R.target.style.color="white"},onMouseLeave:R=>{R.target.style.backgroundColor="#e2e8f0",R.target.style.color="#4a5568"},children:M},M))})]})]})},i3=({value:s,onChange:e,className:t="",placeholder:n="Select a deck for this card",rememberSelection:a=!0})=>{const{user:l}=Cn(),[u,h]=P.useState([]),[m,p]=P.useState(!0),[x,_]=P.useState(!1),[b,N]=P.useState(null);P.useEffect(()=>{C(),k()},[l]);const C=async()=>{if(!l?.uid){p(!1);return}try{p(!0);const H=await as.getUserDecks(l.uid,!0);h(H)}catch(H){console.error("Error loading user decks:",H),h([])}finally{p(!1)}},k=()=>{if(!a||!l?.uid)return;const H=localStorage.getItem(`selectedDeck_${l.uid}`);if(H&&!s){const $=u.find(M=>M.id===H);$&&(N($),e(H))}};P.useEffect(()=>{if(u.length>0&&!s&&a&&l?.uid){const H=localStorage.getItem(`selectedDeck_${l.uid}`);if(H){const $=u.find(M=>M.id===H);$&&(N($),e(H))}}},[u,s,a,l?.uid,e]),P.useEffect(()=>{if(s&&u.length>0){const H=u.find($=>$.id===s);N(H||null)}else N(null)},[s,u]);const L=H=>{N(H),e(H.id),_(!1),a&&l?.uid&&localStorage.setItem(`selectedDeck_${l.uid}`,H.id)},F=()=>{N(null),e(""),a&&l?.uid&&localStorage.removeItem(`selectedDeck_${l.uid}`)},U=u.find(H=>H.isDefault),B=u.filter(H=>!H.isDefault);return o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:`relative ${t}`,onClick:()=>_(!x),children:o.jsxs("div",{className:"claude-input w-full cursor-pointer flex items-center justify-between",style:{minHeight:"44px"},children:[b?o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:b.icon||""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:b.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[b.cardCount||0," cards  ",b.subject||"General"]})]})]}):o.jsx("span",{className:"claude-text-muted",children:n}),o.jsxs("div",{className:"flex items-center gap-2",children:[b&&o.jsx("button",{onClick:H=>{H.stopPropagation(),F()},className:"transition-colors p-1",style:{color:"var(--claude-text-muted)"},onMouseEnter:H=>H.target.style.color="var(--claude-primary-text)",onMouseLeave:H=>H.target.style.color="var(--claude-text-muted)",title:"Clear selection",children:""}),o.jsx("span",{className:"text-gray-400",children:x?"":""})]})]})}),x&&o.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:m?o.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading decks..."}):u.length===0?o.jsxs("div",{className:"p-4 text-center",children:[o.jsx("div",{className:"claude-text-muted mb-3",children:"No decks found"}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Create a deck first to organize your cards"})]}):o.jsxs(o.Fragment,{children:[U&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-blue-400",children:" Default Collection"})}),o.jsx("button",{onClick:()=>L(U),className:`w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 ${b?.id===U.id?"bg-blue-500/20":""}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:U.icon||""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:U.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[U.cardCount||0," cards  All your flashcards"]})]})]})})]}),B.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-purple-400",children:" Your Decks"})}),B.map(H=>o.jsx("button",{onClick:()=>L(H),className:`w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0 ${b?.id===H.id?"bg-purple-500/20":""}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:H.icon||""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:H.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[H.cardCount||0," cards  ",H.subject||"General"]})]})]})},H.id))]}),o.jsx("button",{onClick:()=>{F(),_(!1)},className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-gray-500/10 transition-colors",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-gray-400",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-gray-300 font-medium",children:"No specific deck"}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Just use default collection"})]})]})})]})}),a&&b&&o.jsxs("div",{className:"mt-2 text-xs claude-text-secondary flex items-center gap-1",children:[o.jsx("span",{children:""}),o.jsx("span",{children:"This deck will be remembered for future cards"})]}),x&&o.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>_(!1)})]})},o3=({onCardCreated:s,onClose:e})=>{const{user:t}=Cn(),[n,a]=P.useState({statement:"",hints:"",proof:"",tags:"",subject:"",isPublic:!0,deckId:""}),[l,u]=P.useState(!1),[h,m]=P.useState(""),[p,x]=P.useState(!1),[_,b]=P.useState({autoFill:!1,autoTag:!1,convertLatex:!1});P.useEffect(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},[n]),P.useEffect(()=>{if(!t?.uid)return;const U=localStorage.getItem(`flashcard_draft_${t.uid}`);if(U)try{const B=JSON.parse(U);Date.now()-(B.timestamp||0)<1440*60*1e3?a($=>({...$,...B.data})):localStorage.removeItem(`flashcard_draft_${t.uid}`)}catch(B){console.warn("Failed to restore draft:",B),localStorage.removeItem(`flashcard_draft_${t.uid}`)}},[t?.uid]),P.useEffect(()=>{if(!t?.uid||!(n.statement.trim()||n.hints.trim()||n.proof.trim()))return;const B=setTimeout(()=>{const H={data:n,timestamp:Date.now()};localStorage.setItem(`flashcard_draft_${t.uid}`,JSON.stringify(H))},2e3);return()=>clearTimeout(B)},[n,t?.uid]);const N=(U,B)=>{a(H=>({...H,[U]:B})),m("")},C=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}b(U=>({...U,autoFill:!0})),m("");try{const U=await sm.autoFillFromStatement(n.statement);a(B=>({...B,hints:U.hints||B.hints,proof:U.proof||B.proof,tags:U.tags?U.tags.join(", "):B.tags})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(U){console.error("AI autofill error:",U),m(`AI autofill failed: ${U.message}`)}finally{b(U=>({...U,autoFill:!1}))}},k=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}b(U=>({...U,autoTag:!0})),m("");try{const U=await sm.autoTagOnly(n.statement);a(B=>({...B,tags:U.join(", ")}))}catch(U){console.error("AI auto-tag error:",U),m(`AI auto-tag failed: ${U.message}`)}finally{b(U=>({...U,autoTag:!1}))}},L=async U=>{const B=n[U];if(!B.trim()){m(`Please enter some ${U} content first`);return}b(H=>({...H,convertLatex:!0})),m("");try{const H=await sm.convertToLaTeX(B);a($=>({...$,[U]:H})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(H){console.error("LaTeX conversion error:",H),m(`LaTeX conversion failed: ${H.message}`)}finally{b(H=>({...H,convertLatex:!1}))}},F=async U=>{if(U.preventDefault(),!t){m("Please sign in to create flashcards");return}const B=$s.checkRateLimit(`flashcard_create_${t.uid}`,5,3e5);if(!B.allowed){m(B.message);return}const H=$s.validateFlashcardInput(n);if(!H.isValid){m(H.errors[0]);return}const $=$s.detectSuspiciousContent(`${n.statement} ${n.hints} ${n.proof}`);if($.isSuspicious){m("Content contains potentially unsafe elements. Please review and try again."),console.warn("Suspicious content detected:",$.findings);return}u(!0),m("");try{const M={...H.sanitizedData,createdAt:new Date};await is.createFlashcard(M,t.uid,n.deckId||null),localStorage.removeItem(`flashcard_draft_${t.uid}`),a(R=>({statement:"",hints:"",proof:"",tags:R.tags,subject:R.subject,isPublic:R.isPublic,deckId:R.deckId})),x(!0),s&&s(),setTimeout(()=>{x(!1)},2e3)}catch(M){console.error("Error creating flashcard:",M);const R=$s.getPublicErrorMessage(M,!0);m(R)}finally{u(!1)}};return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Create Flashcard"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Build a three-sided flashcard with statement, hints, and proof"}),p&&o.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 border border-green-200 rounded-xl text-sm shadow-md",children:[o.jsx("div",{className:"text-lg",children:""}),o.jsx("span",{className:"font-medium",children:"Flashcard created successfully! Ready to create another?"})]}),t&&!p&&(n.statement.trim()||n.hints.trim()||n.proof.trim())&&o.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),o.jsx("span",{children:"Auto-saving draft..."})]})]}),o.jsxs("form",{onSubmit:F,className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-10 h-10 claude-gradient rounded-xl flex items-center justify-center text-white font-bold",children:"1"}),o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Statement"}),o.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),o.jsx("textarea",{value:n.statement,onChange:U=>N("statement",U.target.value),placeholder:`Enter the problem statement, theorem, or question here...

Example: Prove that the derivative of sin(x) is cos(x)`,className:"claude-input w-full h-32 resize-none",required:!0}),n.statement.trim()&&o.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[o.jsxs("button",{type:"button",onClick:C,disabled:_.autoFill,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:_.autoFill?"var(--claude-muted)":"linear-gradient(135deg, #635BFF 0%, #7C3AED 100%)"},children:[_.autoFill?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:""}),o.jsx("span",{children:_.autoFill?"Generating...":"Autofill Hints, Proof & Tags"})]}),o.jsxs("button",{type:"button",onClick:k,disabled:_.autoTag,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:_.autoTag?"var(--claude-muted)":"linear-gradient(135deg, #10B981 0%, #059669 100%)"},children:[_.autoTag?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:""}),o.jsx("span",{children:_.autoTag?"Generating...":"Auto Tag Only"})]})]}),n.statement&&o.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[o.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),o.jsx("div",{style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.statement}})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, #9333ea 0%, #a855f7 100%)"},children:"2"}),o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Hints"}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Optional"})]}),o.jsx("textarea",{value:n.hints,onChange:U=>N("hints",U.target.value),placeholder:`Provide helpful hints or guidance...

Example: Start by using the definition of derivative as a limit. Consider the addition formula for sine.`,className:"claude-input w-full h-24 resize-none"}),n.hints.trim()&&o.jsx("div",{className:"mt-3",children:o.jsxs("button",{type:"button",onClick:()=>L("hints"),disabled:_.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:_.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[_.convertLatex?o.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:""}),o.jsx("span",{children:_.convertLatex?"Converting...":"Convert to LaTeX"})]})})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, var(--claude-success) 0%, #10b981 100%)"},children:"3"}),o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Proof / Answer"}),o.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),o.jsx("textarea",{value:n.proof,onChange:U=>N("proof",U.target.value),placeholder:`Provide the complete proof, solution, or detailed answer...

Example: Using the definition of derivative:
f'(x) = lim(h0) [sin(x+h) - sin(x)]/h
= lim(h0) [sin(x)cos(h) + cos(x)sin(h) - sin(x)]/h
...`,className:"claude-input w-full h-40 resize-none",required:!0}),n.proof.trim()&&o.jsx("div",{className:"mt-3",children:o.jsxs("button",{type:"button",onClick:()=>L("proof"),disabled:_.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:_.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[_.convertLatex?o.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:""}),o.jsx("span",{children:_.convertLatex?"Converting...":"Convert to LaTeX"})]})}),n.proof&&o.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[o.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),o.jsx("div",{className:"whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.proof}})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Card Details"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),o.jsx(a3,{value:n.subject,onChange:U=>N("subject",U),placeholder:"Select or type a subject (e.g. Calculus, Physics)"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),o.jsx(r3,{value:n.tags,onChange:U=>N("tags",U),placeholder:"Type tags here or click existing tags below"})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck ",o.jsx("span",{className:"text-sm claude-text-muted",children:"(optional)"})]}),o.jsx(i3,{value:n.deckId,onChange:U=>N("deckId",U),placeholder:"Choose a deck to organize this card",rememberSelection:!0})]})]}),o.jsx("div",{className:"mt-6",children:o.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:n.isPublic,onChange:U=>N("isPublic",U.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--claude-accent)",backgroundColor:n.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),o.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this flashcard public (others can discover and study it)"})]})})]}),h&&o.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:o.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[o.jsx("span",{children:""}),o.jsx("span",{children:h})]})}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&o.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{type:"submit",disabled:l||!n.statement.trim()||!n.proof.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:l||!n.statement.trim()||!n.proof.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:l?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""}),"Create Flashcard"]})})]})]}),o.jsxs("div",{className:"mt-8 p-6 rounded-2xl",style:{backgroundColor:"rgba(68, 90, 255, 0.1)",border:"1px solid var(--claude-accent-blue)"},children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:"var(--claude-accent-blue)"},children:" LaTeX Math Support"}),o.jsxs("div",{className:"claude-text-secondary text-sm space-y-2",children:[o.jsx("p",{children:"Use LaTeX for mathematical expressions:"}),o.jsxs("div",{className:"claude-card p-3 font-mono text-xs",children:[o.jsxs("div",{children:["Inline: ",o.jsx("code",{children:"$f(x) = x^2 + 2x + 1$"})]}),o.jsxs("div",{children:["Block: ",o.jsxs("code",{children:["$$\\int_0^1 x^2 dx = \\frac",1,3,"$$"]})]})]})]})]})]})})};class Cd{static isPermissionOrIndexError(e){const t=e.message||"";return t.includes("Missing or insufficient permissions")||t.includes("requires an index")||t.includes("permission-denied")}static async startStudySession(e,t={}){try{const n={userId:e,sessionId:this.generateSessionId(),startTime:Pe(),mode:t.mode||"study",deckId:t.deckId||null,deckName:t.deckName||null,cardsStudied:0,cardsCorrect:0,cardsIncorrect:0,cardResults:[],isActive:!0},a=await Qs(Ce(ee,"studySessions"),n);if(Nn)try{na(Nn,"study_session_start",{mode:t.mode,deck_id:t.deckId,user_id:e})}catch(l){console.warn("Firebase Analytics not available:",l)}return{id:a.id,...n}}catch(n){throw console.error("Error starting study session:",n),n}}static async endStudySession(e,t){try{const n=ve(ee,"studySessions",e),a=await vt(n);if(!a.exists())throw new Error("Session not found");const l=a.data(),u=l.startTime.toMillis(),h=Date.now(),m=Math.round((h-u)/1e3),p=l.cardsStudied>0?l.cardsCorrect/l.cardsStudied:0,x=l.cardsStudied>0?m/l.cardsStudied:0;if(await $t(n,{endTime:Pe(),duration:m,accuracy:p,averageTimePerCard:x,isActive:!1}),await this.updateUserAnalytics(t,{sessionDuration:m,cardsStudied:l.cardsStudied,accuracy:p,deckId:l.deckId}),await this.updateDailyStats(t,{studyTime:m,sessionsCount:1,cardsStudied:l.cardsStudied,accuracy:p}),Nn)try{na(Nn,"study_session_end",{duration:m,cards_studied:l.cardsStudied,accuracy:p,user_id:t})}catch(_){console.warn("Firebase Analytics not available:",_)}return{duration:m,cardsStudied:l.cardsStudied,accuracy:p,averageTimePerCard:x}}catch(n){if(this.isPermissionOrIndexError(n))return{duration:0,cardsStudied:0,accuracy:0,averageTimePerCard:0};throw console.error("Error ending study session:",n),n}}static async recordCardAnswer(e,t){try{const n=ve(ee,"studySessions",e),a=await vt(n);if(!a.exists())throw new Error("Session not found");const l=Qo(ee),u={cardId:t.cardId,timeSpent:t.timeSpent,wasCorrect:t.wasCorrect,attempts:t.attempts||1,difficulty:t.difficulty||"medium",confidenceLevel:t.confidenceLevel||3,timestamp:Pe()};if(l.update(n,{cardsStudied:Bc(u),[`cards${t.wasCorrect?"Correct":"Incorrect"}`]:(a.data()[`cards${t.wasCorrect?"Correct":"Incorrect"}`]||0)+1}),await this.updateCardProgress(t.userId,t.cardId,{wasCorrect:t.wasCorrect,timeSpent:t.timeSpent,confidenceLevel:t.confidenceLevel}),await l.commit(),Nn)try{na(Nn,"card_answered",{card_id:t.cardId,was_correct:t.wasCorrect,time_spent:t.timeSpent,user_id:t.userId})}catch(h){console.warn("Firebase Analytics not available:",h)}return!0}catch(n){throw console.error("Error recording card answer:",n),n}}static async updateCardProgress(e,t,n){try{const a=ve(ee,"learningProgress",e,"cards",t),l=await vt(a);let u;l.exists()?u=l.data():u={cardId:t,userId:e,totalReviews:0,correctReviews:0,accuracy:0,averageTimeToAnswer:0,fastestTime:1/0,slowestTime:0,masteryLevel:0,improvementRate:0,createdAt:Pe()},u.totalReviews+=1,n.wasCorrect&&(u.correctReviews+=1),u.accuracy=u.correctReviews/u.totalReviews;const h=n.timeSpent;u.averageTimeToAnswer=(u.averageTimeToAnswer*(u.totalReviews-1)+h)/u.totalReviews,u.fastestTime=Math.min(u.fastestTime,h),u.slowestTime=Math.max(u.slowestTime,h);const m=u.accuracy,p=1-(u.slowestTime-u.fastestTime)/u.slowestTime,x=(n.confidenceLevel||3)/5;return u.masteryLevel=m*.5+p*.3+x*.2,u.lastMasteryUpdate=Pe(),await Cs(a,u,{merge:!0}),u}catch(a){throw console.error("Error updating card progress:",a),a}}static async getCardProgress(e,t=null){try{const n=Ce(ee,"learningProgress",e,"cards");let a=n;t&&t.length>0&&(a=Le(n,Ye("cardId","in",t)));const l=await Ke(a),u={};return l.docs.forEach(h=>{const m=h.data();u[m.cardId]=m}),u}catch(n){if(this.isPermissionOrIndexError(n))return{};throw console.error("Error getting card progress:",n),n}}static async updateUserAnalytics(e,t){try{const n=ve(ee,"userAnalytics",e),a=await vt(n);let l;if(a.exists()?l=a.data():l={userId:e,totalStudyTime:0,totalSessions:0,studyStreak:0,longestStreak:0,overallAccuracy:0,improvementRate:0,subjectStats:{},deckStats:{},createdAt:Pe()},l.totalStudyTime+=t.sessionDuration,l.totalSessions+=1,l.overallAccuracy=(l.overallAccuracy*(l.totalSessions-1)+t.accuracy)/l.totalSessions,t.deckId){l.deckStats[t.deckId]||(l.deckStats[t.deckId]={studyTime:0,sessions:0,accuracy:0});const u=l.deckStats[t.deckId];u.studyTime+=t.sessionDuration,u.sessions+=1,u.accuracy=(u.accuracy*(u.sessions-1)+t.accuracy)/u.sessions}return l.lastUpdated=Pe(),await Cs(n,l,{merge:!0}),l}catch(n){throw console.error("Error updating user analytics:",n),n}}static async updateDailyStats(e,t){try{const n=new Date().toISOString().split("T")[0],a=ve(ee,"dailyStats",e,"days",n),l=await vt(a);let u;return l.exists()?u=l.data():u={date:n,userId:e,studyTime:0,sessionsCount:0,cardsStudied:0,accuracy:0,decksStudied:[],subjectsStudied:[]},u.studyTime+=t.studyTime,u.sessionsCount+=t.sessionsCount,u.cardsStudied+=t.cardsStudied,u.sessionsCount>0&&(u.accuracy=(u.accuracy*(u.sessionsCount-1)+t.accuracy)/u.sessionsCount),await Cs(a,u,{merge:!0}),u}catch(n){throw console.error("Error updating daily stats:",n),n}}static async getUserInsights(e,t="week"){try{const[n,a,l]=await Promise.all([this.getUserAnalytics(e),this.getRecentSessions(e,t),this.getCardProgress(e)]);return{accuracyTrend:this.calculateTrend(a,"accuracy"),studyTimeTrend:this.calculateTrend(a,"duration"),masteryProgress:this.calculateMasteryProgress(l),strugglingCards:this.identifyStrugglingCards(l),strongSubjects:this.identifyStrongSubjects(n.subjectStats),optimalStudyTime:this.identifyOptimalStudyTime(a),consistencyScore:this.calculateConsistencyScore(a),recommendations:this.generateRecommendations(n,l)}}catch(n){if(this.isPermissionOrIndexError(n))return{studyStreaks:{current:0,longest:0},totalStudyTime:0,averageAccuracy:0,cardsStudied:0,sessionsCompleted:0,improvementTrend:"stable",weeklyProgress:[],strongSubjects:[],weakSubjects:[]};throw console.error("Error getting user insights:",n),n}}static async getRecentSessions(e,t="week"){try{const n=t==="week"?7:t==="month"?30:1,a=new Date(Date.now()-n*24*60*60*1e3),l=Le(Ce(ee,"studySessions"),Ye("userId","==",e),Ye("startTime",">=",a),Ye("isActive","==",!1),Jt("startTime","desc"),Zt(100));return(await Ke(l)).docs.map(h=>({id:h.id,...h.data()}))}catch(n){return this.isPermissionOrIndexError(n)?[]:(console.error("Error getting recent sessions:",n),[])}}static async getUserAnalytics(e){try{const t=ve(ee,"userAnalytics",e),n=await vt(t);return n.exists()?n.data():{totalStudyTime:0,totalSessions:0,overallAccuracy:0,studyStreak:0,subjectStats:{},deckStats:{}}}catch(t){throw console.error("Error getting user analytics:",t),t}}static generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static calculateTrend(e,t){if(e.length<2)return 0;const n=e.slice(0,Math.floor(e.length/2)),a=e.slice(Math.floor(e.length/2)),l=n.reduce((h,m)=>h+(m[t]||0),0)/n.length,u=a.reduce((h,m)=>h+(m[t]||0),0)/a.length;return u>0?(l-u)/u:0}static calculateMasteryProgress(e){const t=Object.values(e);return t.length===0?0:t.reduce((n,a)=>n+(a.masteryLevel||0),0)/t.length}static identifyStrugglingCards(e){return Object.values(e).filter(t=>t.accuracy<.6&&t.totalReviews>=3).sort((t,n)=>t.accuracy-n.accuracy).slice(0,5)}static identifyStrongSubjects(e){return Object.entries(e).filter(([t,n])=>n.accuracy>.8).sort(([t,n],[a,l])=>l.accuracy-n.accuracy).slice(0,3).map(([t,n])=>t)}static identifyOptimalStudyTime(e){const t={morning:[],afternoon:[],evening:[]};e.forEach(l=>{const u=new Date(l.startTime.toMillis()).getHours();let h="afternoon";u<12?h="morning":u>18&&(h="evening"),t[h].push(l.accuracy||0)});let n="afternoon",a=0;return Object.entries(t).forEach(([l,u])=>{if(u.length>0){const h=u.reduce((m,p)=>m+p)/u.length;h>a&&(a=h,n=l)}}),n}static calculateConsistencyScore(e){if(e.length<3)return 0;const t=e.map(u=>u.duration||0),n=t.reduce((u,h)=>u+h)/t.length,a=t.reduce((u,h)=>u+Math.pow(h-n,2),0)/t.length,l=Math.sqrt(a);return Math.max(0,1-l/n)}static generateRecommendations(e,t){const n=[];e.totalStudyTime<3600&&n.push({type:"study_time",title:"Increase Study Time",description:"Try to study for at least 20 minutes per day to see better results.",priority:"high"}),e.overallAccuracy<.7&&n.push({type:"accuracy",title:"Focus on Understanding",description:"Review the hints and explanations more carefully before answering.",priority:"high"});const a=this.identifyStrugglingCards(t);return a.length>0&&n.push({type:"struggling_cards",title:"Review Difficult Cards",description:`You have ${a.length} cards that need extra attention.`,priority:"medium"}),n}}const dh=(s=[],e)=>{P.useEffect(()=>{let t=!1;const n=()=>{if(!window.MathJax?.typesetPromise)return;const a=typeof e=="string"?document.querySelector(e):e||document.body;window.MathJax.typesetClear&&window.MathJax.typesetClear([a]),window.MathJax.typesetPromise([a]).catch(l=>{t||console.error("MathJax typeset error:",l)})};if(window.MathJax&&window.MathJax.typesetPromise)n();else if(window.MathJaxReady)n();else{const a=()=>{t||(window.MathJax?.typesetPromise||window.MathJaxReady?n():requestAnimationFrame(a))},l=()=>!t&&n();return document.addEventListener("mathjax:ready",l),a(),()=>{t=!0,document.removeEventListener("mathjax:ready",l)}}return()=>{t=!0}},s)},l3=()=>{const{user:s}=Cn(),[e,t]=P.useState([]),[n,a]=P.useState(0),[l,u]=P.useState(0),[h,m]=P.useState(!0),[p,x]=P.useState(""),[_,b]=P.useState(null),[N,C]=P.useState(null),[k,L]=P.useState(!1),[F,U]=P.useState({}),B=P.useRef(null),H=P.useRef(!1),$=P.useRef(null),M=e[n],R=P.useMemo(()=>{const D=M?.statement??M?.question??"No statement available",se=Array.isArray(M?.hints)?M.hints.join(`
`):M?.hints??M?.hint??"No hint available",xe=M?.proof??M?.answer??"No proof available";return[D,se,xe]},[M?.statement,M?.question,M?.hints,M?.hint,M?.proof,M?.answer]),T=["Statement","Hint","Proof"];dh([n,l],$?.current),P.useEffect(()=>{G()},[s]),P.useEffect(()=>{s&&e.length>0&&!_&&A()},[s,e.length,_]),P.useEffect(()=>{M&&C(Date.now())},[n]),P.useEffect(()=>()=>{_&&V()},[_]);const A=async()=>{try{const D=await Cd.startStudySession(s.uid,{mode:"study",deckId:null,deckName:"All Cards"});b(D),console.log("Study session started:",D.sessionId)}catch(D){console.error("Failed to start study session:",D)}},V=async()=>{if(_)try{const D=await Cd.endStudySession(_.sessionId,s.uid);console.log("Study session ended:",D),b(null)}catch(D){console.warn("Analytics not available for session end:",D),b(null)}},I=async(D,se=3)=>{if(!_||!M||!N)return;const xe=Math.round((Date.now()-N)/1e3);try{await Cd.recordCardAnswer(_.sessionId,{cardId:M.id,userId:s.uid,timeSpent:xe,wasCorrect:D,attempts:1,difficulty:"medium",confidenceLevel:se}),U(ue=>({...ue,[M.id]:D})),setTimeout(()=>{O()},1e3)}catch(ue){console.warn("Analytics not available, but rating recorded locally:",ue),U(Ie=>({...Ie,[M.id]:D})),setTimeout(()=>{O()},1e3)}},G=P.useCallback(async()=>{try{m(!0),x("");let D=[];if(s)try{const se=await is.getUserFlashcards(s.uid,50),{collection:xe,query:ue,where:Ie,orderBy:pe,limit:Ne,getDocs:ce}=await Sn(async()=>{const{collection:Ge,query:lt,where:ze,orderBy:Qe,limit:gt,getDocs:ct}=await Promise.resolve().then(()=>sa);return{collection:Ge,query:lt,where:ze,orderBy:Qe,limit:gt,getDocs:ct}},void 0),{db:_e}=await Sn(async()=>{const{db:Ge}=await Promise.resolve().then(()=>Fa);return{db:Ge}},void 0),Se=ue(xe(_e,"flashcards"),Ie("userId","==",s.uid),pe("createdAt","desc"),Ne(50)),Ze=(await ce(Se)).docs.map(Ge=>({id:Ge.id,...Ge.data()}));D=[...se,...Ze].sort((Ge,lt)=>{const ze=Ge.createdAt?.toMillis?.()||Ge.createdAt?.getTime?.()||0;return(lt.createdAt?.toMillis?.()||lt.createdAt?.getTime?.()||0)-ze})}catch(se){console.warn("Failed to load user cards, falling back to public:",se)}D.length||(D=await is.getPublicFlashcards(50)),Array.isArray(D)&&D.length>0?(t(D),a(0),u(0)):(t([]),a(0),u(0))}catch(D){x("Failed to load flashcards"),console.error("Error loading flashcards:",D),t([])}finally{m(!1)}},[s]),O=P.useCallback(()=>{e.length>0&&(a(D=>Math.min(D+1,e.length-1)),u(0))},[e.length]),Ve=P.useCallback(()=>{e.length>0&&(a(D=>Math.max(D-1,0)),u(0))},[e.length]),ae=P.useCallback(()=>{u(D=>(D+1)%3)},[]),z=P.useCallback(D=>{D.key==="ArrowRight"?O():D.key==="ArrowLeft"?Ve():(D.key===" "||D.code==="Space")&&(D.preventDefault(),ae())},[O,Ve,ae]),oe=D=>{B.current=D.touches[0].clientX,H.current=!1},Y=D=>{H.current=!0},be=D=>{if(!B.current)return;const se=B.current-D.changedTouches[0].clientX;if(B.current=null,Math.abs(se)>50)return se>0?O():Ve();H.current||ae()};return P.useEffect(()=>(window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)),[z]),h?o.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[o.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-6"}),o.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:" Loading Flashcards..."}),o.jsx("p",{className:"text-slate-300",children:"Please wait while we load your study materials."})]})}):p?o.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:o.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-3xl p-12 text-center max-w-lg",children:[o.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-4",children:" Error Loading Flashcards"}),o.jsx("p",{className:"text-red-300 mb-6",children:p}),o.jsx("button",{onClick:G,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-xl transition-all duration-200",children:"Try Again"})]})}):e.length===0?o.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-6",children:""}),o.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"No Flashcards Available"}),o.jsx("p",{className:"text-slate-300",children:"Create your first flashcard to start studying!"})]})}):M?o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},role:"main",children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-8",children:[o.jsx("h2",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:" Study Mode"}),o.jsx("div",{className:"claude-card px-4 py-2",children:o.jsxs("span",{className:"claude-text-secondary font-medium",children:[n+1," of ",e.length]})})]}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"flex justify-center mb-6",children:o.jsx("div",{className:"flex claude-card p-2",children:T.map((D,se)=>o.jsx("button",{onClick:()=>u(se),className:`px-6 py-2 rounded-xl font-medium transition-colors duration-200 ${l===se?"bg-[var(--claude-accent)] text-white":"text-[var(--claude-secondary-text)] hover:bg-[var(--claude-surface-hover)] hover:text-[var(--claude-primary-text)]"}`,"aria-pressed":l===se,"aria-label":`Show ${D} (${se+1} of ${T.length})`,children:D},se))})}),o.jsxs("div",{onClick:ae,onTouchStart:oe,onTouchMove:Y,onTouchEnd:be,onKeyDown:D=>{(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),ae())},className:"claude-card p-12 min-h-[400px] flex flex-col justify-center items-center cursor-pointer transition-all duration-300 group hover:-translate-y-0.5 hover:border-[var(--claude-accent)] focus:outline-none focus:ring-2 focus:ring-[var(--claude-accent)] focus:ring-opacity-50",style:{borderRadius:"24px"},tabIndex:0,role:"button","aria-label":`Show ${T[l]} content. Press Space or Enter to continue.`,children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-sm font-medium mb-4 uppercase tracking-wider",style:{color:"var(--claude-accent)"},children:T[l]}),o.jsx("div",{ref:$,className:"text-xl leading-relaxed transition-colors whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},children:R[l]})]}),o.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 claude-text-muted text-sm",children:l<2?"Tap to see next side":"Tap to restart"})]}),o.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[M.subject&&o.jsx("span",{className:"claude-tag",children:M.subject}),M.slug?o.jsxs("a",{href:`/card/${M.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-primary inline-flex items-center gap-2 text-sm",children:[o.jsx("span",{children:""}),"View Public Card"]}):o.jsxs("div",{className:"claude-button-secondary inline-flex items-center gap-2 text-sm opacity-50 cursor-not-allowed",children:[o.jsx("span",{children:""}),"Private Card"]})]}),l===2&&_&&o.jsxs("div",{className:"mt-6 claude-card p-4 bg-blue-50 border-blue-200",children:[o.jsxs("div",{className:"text-center mb-4",children:[o.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"How well did you know this?"}),o.jsx("p",{className:"text-sm text-blue-600",children:"This helps track your learning progress"})]}),o.jsxs("div",{className:"flex justify-center gap-2",children:[o.jsx("button",{onClick:()=>I(!1,1),className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg transition-colors text-sm font-medium",children:" Struggled"}),o.jsx("button",{onClick:()=>I(!1,2),className:"px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 rounded-lg transition-colors text-sm font-medium",children:" Unsure"}),o.jsx("button",{onClick:()=>I(!0,4),className:"px-4 py-2 bg-green-100 hover:bg-green-200 text-green-800 rounded-lg transition-colors text-sm font-medium",children:" Good"}),o.jsx("button",{onClick:()=>I(!0,5),className:"px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition-colors text-sm font-medium",children:" Perfect"})]}),F[M.id]!==void 0&&o.jsx("div",{className:"mt-3 text-center",children:o.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${F[M.id]?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:F[M.id]?" Recorded as correct":" Recorded as incorrect"})})]})]}),o.jsxs("div",{className:"flex justify-between items-center mt-8",children:[o.jsx("button",{onClick:Ve,disabled:n===0,className:"claude-button-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:" Previous"}),o.jsx("div",{className:"claude-text-muted text-sm",children:"Use arrow keys or swipe to navigate  Space to flip sides"}),o.jsx("button",{onClick:O,disabled:n===e.length-1,className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:n===e.length-1?"var(--claude-muted)":"var(--claude-accent)"},children:"Next "})]}),o.jsx("span",{className:"sr-only","aria-live":"polite",children:T[l]})]})}):o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-6",children:""}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Card Not Found"}),o.jsx("p",{className:"claude-text-secondary",children:"Unable to load the requested flashcard."}),o.jsx("button",{onClick:G,className:"claude-button-primary mt-6",children:"Reload Cards"})]})})},c3=()=>{const{user:s}=Cn(),[e,t]=P.useState(""),[n,a]=P.useState(""),[l,u]=P.useState(!0),[h,m]=P.useState([]),[p,x]=P.useState("recent"),[_,b]=P.useState(""),[N,C]=P.useState(new Set),[k,L]=P.useState(1),[F,U]=P.useState(new Set),[B,H]=P.useState(new Set),[$,M]=P.useState(new Set),[R,T]=P.useState(new Set),[A,V]=P.useState(""),I=12;P.useEffect(()=>{const ce=setTimeout(()=>a(e),200);return()=>clearTimeout(ce)},[e]);const G=P.useCallback(ce=>ce?.toMillis?ce.toMillis():ce||0,[]),O=P.useCallback(ce=>{if(!ce)return"Unknown date";const _e=ce.toDate?ce.toDate():new Date(ce);return Number.isNaN(_e.getTime())?"Unknown date":_e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},[]),Ve=P.useCallback(async()=>{const ce=await Sn(()=>Promise.resolve().then(()=>sa),void 0),{db:_e}=await Sn(async()=>{const{db:Se}=await Promise.resolve().then(()=>Fa);return{db:Se}},void 0);return{db:_e,firestore:ce}},[]),ae=P.useMemo(()=>{const ce=n.trim().toLowerCase(),_e=h.filter(Se=>{const Ue=Array.isArray(Se.hints)?Se.hints.join(" "):typeof Se.hints=="string"?Se.hints:"",Ze=!ce||(Se.statement||"").toLowerCase().includes(ce)||Ue.toLowerCase().includes(ce)||(Se.proof||"").toLowerCase().includes(ce)||(Se.authorSlug||"").toLowerCase().includes(ce)||(Se.tags||[]).some(lt=>(lt||"").toLowerCase().includes(ce)),Ge=!_||(Se.tags||[]).includes(_);return Ze&&Ge});switch(p){case"upvotes":_e.sort((Se,Ue)=>(Ue.likeCount||0)-(Se.likeCount||0));break;case"oldest":_e.sort((Se,Ue)=>G(Se.createdAt)-G(Ue.createdAt));break;case"alphabetical":_e.sort((Se,Ue)=>(Se.statement||"").localeCompare(Ue.statement||""));break;default:_e.sort((Se,Ue)=>G(Ue.createdAt)-G(Se.createdAt))}return _e},[h,n,p,_]);dh([ae,k]),P.useEffect(()=>{oe(),s&&z()},[s]);const z=async()=>{if(s)try{const{collection:ce,query:_e,where:Se,getDocs:Ue}=await Sn(async()=>{const{collection:gt,query:ct,where:It,getDocs:Hn}=await Promise.resolve().then(()=>sa);return{collection:gt,query:ct,where:It,getDocs:Hn}},void 0),{db:Ze}=await Sn(async()=>{const{db:gt}=await Promise.resolve().then(()=>Fa);return{db:gt}},void 0),Ge=await Ue(_e(ce(Ze,"userUpvotes"),Se("userId","==",s.uid))),lt=new Set(Ge.docs.map(gt=>gt.data().cardId));U(lt);const ze=await Ue(_e(ce(Ze,"flashcards"),Se("userId","==",s.uid))),Qe=new Set;ze.docs.forEach(gt=>{Qe.add(gt.data().statement)}),H(Qe)}catch(ce){console.error("Error loading user data:",ce)}},oe=P.useCallback(async()=>{try{u(!0);const{db:ce,firestore:_e}=await Ve(),{collection:Se,orderBy:Ue,query:Ze,getDocs:Ge}=_e;console.log(" Loading public cards...");const lt=Ze(Se(ce,"publicCards"),Ue("createdAt","desc")),ze=await Ge(lt),Qe=new Set,gt=ze.docs.map(ct=>{const It=ct.data();return(It.tags||[]).forEach(Hn=>Qe.add(Hn)),{id:ct.id,...It}});console.log(" Loaded public cards:",gt.length,gt.slice(0,3)),m(gt),C(Qe)}catch(ce){console.error(" Error loading public cards:",ce),m([]),C(new Set)}finally{u(!1)}},[Ve]);P.useEffect(()=>{L(1)},[n,p,_]);const Y=P.useCallback(async ce=>{if(s&&!$.has(ce)){M(_e=>new Set(_e).add(ce));try{const{runTransaction:_e,doc:Se,serverTimestamp:Ue}=await Sn(async()=>{const{runTransaction:ze,doc:Qe,serverTimestamp:gt}=await Promise.resolve().then(()=>sa);return{runTransaction:ze,doc:Qe,serverTimestamp:gt}},void 0),{db:Ze}=await Sn(async()=>{const{db:ze}=await Promise.resolve().then(()=>Fa);return{db:ze}},void 0),Ge=Se(Ze,"userUpvotes",`${s.uid}_${ce}`),lt=Se(Ze,"publicCards",ce);await _e(Ze,async ze=>{const Qe=await ze.get(Ge),ct=(await ze.get(lt)).data()?.likeCount||0;Qe.exists()?(ze.delete(Ge),ze.update(lt,{likeCount:Math.max(0,ct-1)})):(ze.set(Ge,{userId:s.uid,cardId:ce,createdAt:Ue()}),ze.update(lt,{likeCount:ct+1}))}),U(ze=>{const Qe=new Set(ze);return Qe.has(ce)?Qe.delete(ce):Qe.add(ce),Qe}),m(ze=>ze.map(Qe=>Qe.id===ce?{...Qe,likeCount:Math.max(0,(Qe.likeCount||0)+(F.has(ce)?-1:1))}:Qe))}catch(_e){console.error("Error upvoting card:",_e),V("Error upvoting card. Please try again."),setTimeout(()=>V(""),5e3)}finally{M(_e=>{const Se=new Set(_e);return Se.delete(ce),Se})}}},[s,F,$,m]),be=P.useCallback(async ce=>{if(!s||R.has(ce))return;const _e=h.find(Se=>Se.id===ce);if(_e){if(B.has(_e.statement)){V("Card already imported"),setTimeout(()=>V(""),3e3);return}T(Se=>new Set(Se).add(ce));try{const{collection:Se,addDoc:Ue,doc:Ze,updateDoc:Ge,increment:lt}=await Sn(async()=>{const{collection:It,addDoc:Hn,doc:an,updateDoc:Gn,increment:br}=await Promise.resolve().then(()=>sa);return{collection:It,addDoc:Hn,doc:an,updateDoc:Gn,increment:br}},void 0),{serverTimestamp:ze}=await Sn(async()=>{const{serverTimestamp:It}=await Promise.resolve().then(()=>sa);return{serverTimestamp:It}},void 0),{db:Qe}=await Sn(async()=>{const{db:It}=await Promise.resolve().then(()=>Fa);return{db:It}},void 0);await Ue(Se(Qe,"flashcards"),{userId:s.uid,statement:_e.statement,hints:_e.hints,proof:_e.proof||"",tags:_e.tags||[],createdAt:ze(),updatedAt:ze(),importedFrom:ce}),await Ge(Ze(Qe,"publicCards",ce),{importCount:lt(1)});const gt=new Set(B);gt.add(_e.statement),H(gt);const ct=h.map(It=>It.id===ce?{...It,importCount:(It.importCount||0)+1}:It);m(ct),V("Card imported successfully!"),setTimeout(()=>V(""),3e3)}catch(Se){console.error("Error importing card:",Se),V("Error importing card. Please try again."),setTimeout(()=>V(""),5e3)}finally{T(Se=>{const Ue=new Set(Se);return Ue.delete(ce),Ue})}}},[s,h,B,Ve,R]),D=ce=>{if(!ce)return"";const _e=document.createElement("div");return _e.textContent=ce,_e.innerHTML},se=ce=>{const _e=s&&F.has(ce.id),Se=s&&B.has(ce.statement),Ue=$.has(ce.id),Ze=R.has(ce.id),Ge=O(ce.createdAt),lt=ce.authorSlug?ce.authorSlug.charAt(0).toUpperCase():"U";return o.jsxs("div",{className:"claude-card p-6 hover:shadow-lg transition-all duration-200",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm",style:{backgroundColor:"var(--claude-accent)"},children:lt}),o.jsxs("div",{children:[ce.authorSlug?o.jsx("a",{href:`/profile/${ce.authorSlug}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium hover:underline",style:{color:"var(--claude-accent)"},children:ce.authorSlug}):o.jsx("span",{className:"font-medium claude-text-secondary",children:"Anonymous User"}),o.jsx("div",{className:"claude-text-muted text-sm",children:Ge})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Statement"}),o.jsx("div",{className:"text-sm leading-relaxed",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:D(ce.statement)}})]}),ce.hints&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"font-medium mb-1 claude-text-secondary text-sm",children:"Hints"}),o.jsx("div",{className:"text-sm claude-text-secondary",dangerouslySetInnerHTML:{__html:D(ce.hints)}})]}),ce.proof&&o.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",borderLeft:"4px solid var(--claude-accent)"},children:[o.jsx("div",{className:"text-xs font-semibold claude-text-secondary mb-1 uppercase tracking-wider",children:"Proof Preview"}),o.jsx("div",{className:"text-sm",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:D(ce.proof.substring(0,150)+(ce.proof.length>150?"...":""))}})]}),o.jsxs("div",{className:"flex gap-4 mb-4 text-sm claude-text-muted",children:[o.jsxs("span",{children:[" ",Math.max(0,ce.viewCount||0)," views"]}),o.jsxs("span",{children:[" ",Math.max(0,ce.importCount||0)," imports"]})]}),ce.tags&&ce.tags.length>0&&o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ce.tags.map(ze=>o.jsx("span",{className:"claude-tag cursor-pointer hover:opacity-80",onClick:()=>b(ze),children:ze},ze))}),o.jsxs("div",{className:"flex gap-3 items-center",children:[o.jsxs("button",{onClick:()=>Y(ce.id),disabled:!s||Ue,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${_e?"text-white":"claude-button-secondary"} ${!s||Ue?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:_e?"var(--claude-accent)":void 0,border:_e?"none":void 0},title:s?`${_e?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards","aria-label":s?`${_e?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards",children:[Ue?"":""," ",Math.max(0,ce.likeCount||0)]}),o.jsx("button",{onClick:()=>be(ce.id),disabled:!s||Se||Ze,className:`claude-button-primary text-sm ${!s||Se||Ze?"opacity-50 cursor-not-allowed":""}`,title:s?Se?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards","aria-label":s?Se?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards",children:Ze?" Importing...":Se?" Imported":" Import"}),o.jsx("a",{href:`/card/${ce.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary text-sm",children:" View"})]})]},ce.id)},xe=Math.ceil(ae.length/I),ue=(k-1)*I,Ie=ue+I,pe=ae.slice(ue,Ie),Ne=P.useCallback(ce=>{ce<1||ce>xe||(L(ce),window.scrollTo({top:0,behavior:"smooth"}))},[xe]);return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Search Flashcards"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Discover and import flashcards from the community"})]}),A&&o.jsx("div",{className:`mb-6 p-4 rounded-lg border ${A.includes("successfully")?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{children:A}),o.jsx("button",{onClick:()=>V(""),className:"ml-2 text-lg font-bold opacity-60 hover:opacity-100",children:""})]})}),!s&&o.jsxs("div",{className:"text-center p-4 mb-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--claude-accent) 0%, var(--claude-accent-blue) 100%)",color:"white"},children:[o.jsx("p",{className:"mb-3",children:"Unlock the full experience!"}),o.jsx("a",{href:"/index.html",className:"inline-block px-6 py-2 rounded-lg font-semibold transition-all hover:scale-105",style:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",textDecoration:"none"},onMouseEnter:ce=>ce.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:ce=>ce.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Sign in"}),o.jsx("span",{children:" to upvote and import flashcards to your account."})]}),o.jsx("div",{className:"claude-card p-6 mb-8",children:o.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[o.jsxs("div",{className:"relative flex-1 w-full",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:o.jsx("span",{className:"claude-text-muted",children:""})}),o.jsx("input",{type:"text",value:e,onChange:ce=>t(ce.target.value),placeholder:"Search flashcards, tags, or authors...",className:"claude-input w-full pl-10"}),e&&o.jsx("button",{onClick:()=>t(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center claude-text-muted hover:opacity-70",children:""})]}),o.jsxs("div",{className:"flex gap-3 items-center",children:[o.jsxs("select",{value:p,onChange:ce=>x(ce.target.value),className:"claude-input",children:[o.jsx("option",{value:"recent",children:"Most Recent"}),o.jsx("option",{value:"upvotes",children:"Most Upvoted"}),o.jsx("option",{value:"oldest",children:"Oldest First"}),o.jsx("option",{value:"alphabetical",children:"Alphabetical"})]}),o.jsxs("select",{value:_,onChange:ce=>b(ce.target.value),className:"claude-input",children:[o.jsx("option",{value:"",children:"All Tags"}),Array.from(N).sort().map(ce=>o.jsx("option",{value:ce,children:ce},ce))]})]})]})}),ae.length>0&&o.jsx("div",{className:"claude-card p-4 mb-6",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"claude-text-secondary",children:[o.jsx("span",{className:"font-semibold",children:ae.length})," flashcards found"]}),o.jsxs("div",{className:"claude-text-muted text-sm",children:["Showing ",ue+1,"-",Math.min(Ie,ae.length)," of ",ae.length]})]})}),l&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-10 h-10 border-4 border-t-4 rounded-full animate-spin mx-auto mb-4",style:{borderColor:"var(--claude-border)",borderTopColor:"var(--claude-accent)"}}),o.jsx("div",{className:"claude-text-secondary",children:"Loading flashcards..."})]}),!l&&ae.length===0&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4 opacity-50",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No flashcards found"}),o.jsx("p",{className:"claude-text-muted",children:"Try adjusting your search terms or filters"})]}),!l&&pe.length>0&&o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:pe.map(se)}),xe>1&&o.jsxs("div",{className:"flex justify-center items-center gap-2",children:[o.jsx("button",{onClick:()=>Ne(k-1),disabled:k===1,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:" Previous"}),Array.from({length:Math.min(5,xe)},(ce,_e)=>{const Se=_e+1;return o.jsx("button",{onClick:()=>Ne(Se),className:`px-4 py-2 rounded-lg font-medium transition-all ${Se===k?"text-white":"claude-button-secondary"}`,style:{backgroundColor:Se===k?"var(--claude-accent)":void 0},children:Se},Se)}),o.jsx("button",{onClick:()=>Ne(k+1),disabled:k===xe,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Next "})]})]})})},LE=new Map,u3=300*1e3,d3=()=>{const{user:s}=Cn(),[e,t]=P.useState([]),[n,a]=P.useState({totalUsers:0,totalCards:0,totalViews:0}),[l,u]=P.useState(!0),[h,m]=P.useState("creators"),[p,x]=P.useState(!1);P.useEffect(()=>{_(),b()},[h]);const _=async(k=!1)=>{try{u(!0);let L="upvotes";h==="creators"?L="flashcards":h==="streak"&&(L="streak");const F=`leaderboard_${L}`;if(!k){const H=LE.get(F);if(H&&Date.now()-H.timestamp<u3){console.log(" Using cached leaderboard data for:",L),t(H.data),x(!0),u(!1);return}}console.log(" Loading leaderboard using backend API for:",L);const U=await fetch(`https://us-central1-three-sided-flashcard-app.cloudfunctions.net/getLeaderboard?sort=${encodeURIComponent(L)}`);if(!U.ok)throw new Error(`HTTP error! status: ${U.status}`);const B=await U.json();if(console.log(" Leaderboard data loaded:",B),!B.leaderboard||!Array.isArray(B.leaderboard))throw new Error("Invalid leaderboard data format");LE.set(F,{data:B.leaderboard,timestamp:Date.now()}),t(B.leaderboard),x(!1),console.log(" Leaderboard loaded:",B.leaderboard.length,"entries")}catch(L){console.error(" Error loading leaderboard:",L),t([])}finally{u(!1)}},b=async()=>{try{const k=Le(Ce(ee,"profiles")),L=await Ke(k),F=Le(Ce(ee,"publicCards")),U=await Ke(F);let B=0;U.docs.forEach(H=>{const $=H.data();B+=$.viewCount||0}),a({totalUsers:L.size,totalCards:U.size,totalViews:B})}catch(k){console.error("Error loading community stats:",k)}},N=k=>k?k.split(" ").map(L=>L.charAt(0)).join("").toUpperCase().slice(0,2):"?",C=k=>{switch(k){case 0:return"";case 1:return"";case 2:return"";default:return`#${k+1}`}};return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Community Leaderboard"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Celebrating our top contributors and creators"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:""}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:n.totalUsers.toLocaleString()}),o.jsx("div",{className:"claude-text-secondary",children:"Community Members"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:""}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:n.totalCards.toLocaleString()}),o.jsx("div",{className:"claude-text-secondary",children:"Total Flashcards"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:""}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:n.totalViews.toLocaleString()}),o.jsx("div",{className:"claude-text-secondary",children:"Total Views"})]})]}),o.jsx("div",{className:"claude-card p-2 mb-8",children:o.jsx("div",{className:"flex",children:[{id:"popular",label:"Most Upvoted",icon:""},{id:"creators",label:"Top Creators",icon:""},{id:"streak",label:"Login Streak",icon:""}].map(k=>o.jsxs("button",{onClick:()=>m(k.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200",style:{backgroundColor:h===k.id?"var(--claude-accent)":"transparent",color:h===k.id?"white":"var(--claude-secondary-text)"},onMouseEnter:L=>{h!==k.id&&(L.target.style.backgroundColor="var(--claude-surface-hover)",L.target.style.color="var(--claude-primary-text)")},onMouseLeave:L=>{h!==k.id&&(L.target.style.backgroundColor="transparent",L.target.style.color="var(--claude-secondary-text)")},children:[o.jsx("span",{children:k.icon}),k.label]},k.id))})}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:h==="creators"?" Top Creators":h==="popular"?" Most Upvoted":" Login Streak Champions"}),o.jsxs("div",{className:"flex items-center gap-3",children:[p&&o.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:" Cached"}),o.jsx("button",{onClick:()=>_(!0),className:"claude-button-primary",title:"Force refresh from server (bypasses cache)",children:"Refresh"})]})]}),l?o.jsx("div",{className:"space-y-4",children:Array.from({length:10}).map((k,L)=>o.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl animate-pulse",style:{backgroundColor:"var(--claude-subtle)"},children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),o.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]},L))}):e.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),o.jsx("p",{className:"claude-text-muted",children:"Be the first to create some flashcards!"})]}):o.jsx("div",{className:"space-y-3",children:e.map((k,L)=>o.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:scale-105",style:{backgroundColor:L<3?"rgba(255, 215, 0, 0.1)":"var(--claude-subtle)",border:`1px solid ${L<3?"rgba(255, 215, 0, 0.3)":"var(--claude-border)"}`},children:[o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg",style:{background:L<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:L<3?"white":"var(--claude-background)"},children:C(L)}),o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:N(k.displayName)}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:k.displayName||"Anonymous"}),k.slug&&o.jsxs("a",{href:`/profile/${k.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",k.slug]})]}),o.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?`${k.flashcardCount||0} flashcards created`:h==="popular"?`${k.upvotesReceived||0} upvotes received`:`${k.loginStreak||0} day login streak`})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:L<3?"#B8860B":"var(--claude-accent-blue)"},children:h==="creators"?k.flashcardCount||0:h==="popular"?k.upvotesReceived||0:k.loginStreak||0}),o.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?"cards":h==="popular"?"upvotes":"day streak"})]})]},k.slug||k.id))})]}),s&&o.jsxs("div",{className:"mt-8 bg-slate-800/30 border border-slate-700 rounded-2xl p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Your Position"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:N(s.displayName)}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-white",children:s.displayName}),o.jsx("div",{className:"text-slate-400 text-sm",children:"That's you!"})]})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-xl font-bold text-blue-400",children:["#",e.findIndex(k=>k.id===s.uid)+1||"Unranked"]}),o.jsx("div",{className:"text-slate-400 text-sm",children:"Position"})]})]})]})]})})},h3=({onClose:s,refreshCallback:e})=>{const{user:t}=Cn(),[n,a]=P.useState([]),[l,u]=P.useState(!0),[h,m]=P.useState(""),[p,x]=P.useState(null),[_,b]=P.useState(null),[N,C]=P.useState({statement:"",hints:"",proof:"",subject:"",tags:""});P.useEffect(()=>{t&&k()},[t]);const k=async()=>{try{u(!0);const T=await is.getPublicFlashcardsByUser(t.uid);a(T),m("")}catch(T){console.error("Error loading public cards:",T),m("Failed to load your public flashcards")}finally{u(!1)}},L=T=>{x(T),C({statement:T.statement||"",hints:Array.isArray(T.hints)?T.hints.join(`
`):T.hints||"",proof:T.proof||"",subject:T.subject||"",tags:Array.isArray(T.tags)?T.tags.join(", "):""})},F=async()=>{if(p)try{const T=$s.checkRateLimit(`edit_public_${t.uid}`,10,3e5);if(!T.allowed){m(T.message);return}const A=$s.validateFlashcardInput(N);if(!A.isValid){m(A.errors[0]);return}await is.updatePublicFlashcard(p.id,A.sanitizedData,t.uid),x(null),m(""),await k(),e&&e()}catch(T){console.error("Error updating public card:",T);const A=$s.getPublicErrorMessage(T,!0);m(A)}},U=async T=>{try{const A=$s.checkRateLimit(`delete_public_${t.uid}`,5,3e5);if(!A.allowed){m(A.message);return}await is.deletePublicFlashcard(T,t.uid),b(null),m(""),await k(),e&&e()}catch(A){console.error("Error deleting public card:",A);const V=$s.getPublicErrorMessage(A,!0);m(V)}},B=async T=>{try{const A=$s.checkRateLimit(`toggle_public_${t.uid}`,10,3e5);if(!A.allowed){m(A.message);return}await is.toggleFlashcardPublic(T,t.uid,!1),m(""),await k(),e&&e()}catch(A){console.error("Error making card private:",A);const V=$s.getPublicErrorMessage(A,!0);m(V)}},H=(T,A)=>{C(V=>({...V,[T]:A}))},$=T=>T?(T.toDate?T.toDate():new Date(T)).toLocaleDateString():"Unknown",M=T=>`${window.location.origin}/card/${T.slug}`,R=T=>{const A=M(T);navigator.clipboard.writeText(A).then(()=>{alert("Card URL copied to clipboard!")})};return l?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:o.jsx("div",{className:"claude-card p-8 rounded-2xl shadow-2xl max-w-md",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading your public flashcards..."})]})})}):o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:" Manage Public Flashcards"}),o.jsx("button",{onClick:s,className:"claude-text-muted hover:text-gray-700 text-3xl transition-colors","aria-label":"Close manager",children:""})]}),h&&o.jsx("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-700 text-sm",children:h})}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:n.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No Public Flashcards Yet"}),o.jsx("p",{className:"claude-text-secondary mb-4",children:"Create flashcards and make them public to share your knowledge with the world!"}),o.jsx("button",{onClick:s,className:"claude-button-primary",children:"Create Your First Public Card"})]}):o.jsx("div",{className:"space-y-4",children:n.map(T=>o.jsxs("div",{className:"claude-card p-6 rounded-xl border-l-4 border-l-blue-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-lg mb-2",style:{color:"var(--claude-heading)"},children:T.statement?.length>100?`${T.statement.slice(0,100)}...`:T.statement}),o.jsxs("div",{className:"flex gap-4 text-sm claude-text-secondary",children:[o.jsxs("span",{children:["Created: ",$(T.createdAt)]}),o.jsxs("span",{children:[" ",T.likeCount||0," likes"]}),o.jsxs("span",{children:[" ",T.viewCount||0," views"]}),o.jsxs("span",{children:[" ",T.importCount||0," imports"]})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>R(T),className:"claude-button-secondary text-sm px-3 py-1",title:"Copy public URL",children:" Copy Link"}),o.jsx("button",{onClick:()=>L(T),className:"claude-button-secondary text-sm px-3 py-1",children:" Edit"}),o.jsx("button",{onClick:()=>B(T.id),className:"claude-button-secondary text-sm px-3 py-1 text-orange-600",title:"Make private (remove from public)",children:" Make Private"}),o.jsx("button",{onClick:()=>b(T.id),className:"claude-button-secondary text-sm px-3 py-1 text-red-600",children:" Delete"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Subject & Tags:"}),o.jsxs("div",{className:"flex gap-2 flex-wrap",children:[o.jsx("span",{className:"claude-tag",children:T.subject||"General"}),T.tags?.map((A,V)=>o.jsx("span",{className:"claude-tag",children:A},V))]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Public URL:"}),o.jsx("a",{href:M(T),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 text-xs break-all",children:M(T)})]})]})]},T.id))})}),p&&o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Edit Public Flashcard"}),o.jsx("button",{onClick:()=>x(null),className:"claude-text-muted hover:text-gray-700 text-2xl",children:""})]}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-140px)]",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Statement *"}),o.jsx("textarea",{value:N.statement,onChange:T=>H("statement",T.target.value),className:"claude-input w-full h-24 resize-none",placeholder:"Enter the main statement or question...",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Hints"}),o.jsx("textarea",{value:N.hints,onChange:T=>H("hints",T.target.value),className:"claude-input w-full h-20 resize-none",placeholder:"Helpful hints (optional)..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Proof/Answer *"}),o.jsx("textarea",{value:N.proof,onChange:T=>H("proof",T.target.value),className:"claude-input w-full h-32 resize-none",placeholder:"Enter the proof, solution, or answer...",required:!0})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Subject"}),o.jsx("input",{type:"text",value:N.subject,onChange:T=>H("subject",T.target.value),className:"claude-input w-full",placeholder:"Mathematics, Physics, etc."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Tags"}),o.jsx("input",{type:"text",value:N.tags,onChange:T=>H("tags",T.target.value),className:"claude-input w-full",placeholder:"algebra, calculus, geometry (comma-separated)"})]})]})]})}),o.jsxs("div",{className:"px-6 py-4 border-t border-gray-300 flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>x(null),className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{onClick:F,className:"claude-button-primary",disabled:!N.statement.trim()||!N.proof.trim(),children:"Save Changes"})]})]})}),_&&o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:o.jsx("div",{className:"claude-card rounded-2xl shadow-2xl max-w-md w-full mx-4",children:o.jsxs("div",{className:"p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-bold mb-2 text-red-600",children:"Delete Public Flashcard?"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:"This will permanently delete this flashcard from the public collection. This action cannot be undone."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx("button",{onClick:()=>b(null),className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{onClick:()=>U(_),className:"claude-button-secondary bg-red-100 text-red-800 hover:bg-red-200 border-red-300",children:"Delete Forever"})]})]})})})]})})},lc=(...s)=>!1,Cx=s=>{if(!s)return null;if(typeof s?.toDate=="function")return s.toDate();const e=new Date(s);return Number.isNaN(e.getTime())?null:e},f3=(s,e=0)=>({id:s.id??`card-${e}`,subject:s.subject??"General",question:s.question??s.statement??"",answer:s.answer??s.proof??"",createdAt:Cx(s.createdAt)??new Date(0),...s}),UE=(s,e)=>typeof s=="string"?s.length>e?s.slice(0,e)+"":s:"",m3=()=>{const{user:s}=Cn(),[e,t]=P.useState(null),[n,a]=P.useState([]),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[_,b]=P.useState("overview"),[N,C]=P.useState(null),[k,L]=P.useState(!1),[F,U]=P.useState(!1),[B,H]=P.useState(null),[$,M]=P.useState([]),[R,T]=P.useState(!1);P.useEffect(()=>{if(!s?.uid){t(null),a([]),u([]),m(!1);return}A()},[s?.uid]);const A=P.useCallback(async()=>{let Y=!0;m(!0),b(be=>be);try{const be=s.uid;lc(" Loading user data for:",be);const D=[nm.getUserProfile(be),(async()=>{try{const _e=await is.getUserFlashcards(be,100),{collection:Se,query:Ue,where:Ze,orderBy:Ge,limit:lt,getDocs:ze}=await Sn(async()=>{const{collection:an,query:Gn,where:br,orderBy:ks,limit:Ds,getDocs:Ps}=await Promise.resolve().then(()=>sa);return{collection:an,query:Gn,where:br,orderBy:ks,limit:Ds,getDocs:Ps}},void 0),{db:Qe}=await Sn(async()=>{const{db:an}=await Promise.resolve().then(()=>Fa);return{db:an}},void 0),gt=Ue(Se(Qe,"flashcards"),Ze("userId","==",be),Ge("createdAt","desc"),lt(100)),It=(await ze(gt)).docs.map(an=>({id:an.id,...an.data()}));return[..._e,...It].sort((an,Gn)=>{const br=an.createdAt?.toMillis?.()||an.createdAt?.getTime?.()||0;return(Gn.createdAt?.toMillis?.()||Gn.createdAt?.getTime?.()||0)-br})}catch(_e){return lc("Failed to load user cards:",_e),[]}})(),(async()=>{try{const{collection:_e,query:Se,where:Ue,getDocs:Ze}=await Sn(async()=>{const{collection:Qe,query:gt,where:ct,getDocs:It}=await Promise.resolve().then(()=>sa);return{collection:Qe,query:gt,where:ct,getDocs:It}},void 0),{db:Ge}=await Sn(async()=>{const{db:Qe}=await Promise.resolve().then(()=>Fa);return{db:Qe}},void 0),lt=Se(_e(Ge,"cards"),Ue("userId","==",be),Ue("originalCardId","!=",null));return(await Ze(lt)).docs.map(Qe=>({id:Qe.id,...Qe.data()}))}catch(_e){return lc("Failed to load imported cards:",_e),[]}})()],[se,xe,ue]=await Promise.allSettled(D);if(!Y)return;const Ie=se.status==="fulfilled"?se.value:null,Ne=(xe.status==="fulfilled"?xe.value??[]:[]).map(f3),ce=ue.status==="fulfilled"?ue.value??[]:[];lc(" User profile:",Ie),lc(" Private cards found:",Ne.length),lc(" Imported cards found:",ce.length),t(Ie),a(Ne),u(ce)}catch(be){console.error(" Error loading user data:",be)}finally{Y&&m(!1)}return()=>{Y=!1}},[s?.uid]),V=async Y=>{if(!confirm("Delete this card? This cannot be undone."))return;const be=n;a(D=>D.filter(se=>se.id!==Y));try{await is.deleteFlashcard(Y)}catch(D){console.error("Error deleting card:",D),a(be)}},I=P.useCallback(async()=>{try{if(!s?.uid)return;const Y=await as.getUserDecks(s.uid,!0);M(Y)}catch(Y){console.error("Error loading user decks:",Y)}},[s?.uid]);P.useEffect(()=>{I()},[I]);const G=Y=>{H(Y),T(!0)},O=async Y=>{if(B)try{await as.addCardToDeck(Y,B.id),await is.updateCardDeck(B.id,Y),T(!1),H(null),await A()}catch(be){console.error("Error moving card to deck:",be),alert("Failed to move card. Please try again.")}},Ve=async()=>{x(!0),await A(),x(!1)},ae=P.useCallback(Y=>{C(Y),L(!0)},[]),z=P.useCallback(()=>{L(!1),C(null)},[]);dh([N]);const oe=P.useMemo(()=>!n||n.length===0?0:new Set(n.map(be=>be.subject??"General")).size,[n]);return h?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-t-transparent rounded-full mx-auto mb-6",style:{borderColor:"var(--claude-accent)",borderTopColor:"transparent"}}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Loading Dashboard..."}),o.jsx("p",{className:"claude-text-secondary",children:"Fetching your data"})]})}):o.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Your Dashboard"}),o.jsxs("p",{className:"claude-text-secondary text-lg",children:["Welcome back, ",s?.displayName||"Student","!"]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs("div",{className:"claude-card p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:o.jsx("span",{className:"text-2xl",children:""})}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Total"})]}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:n.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards Created"})]}),o.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:o.jsx("span",{className:"text-2xl",children:""})}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Imported"})]}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:l.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported"})]}),o.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"p-3 bg-green-500/20 rounded-xl",children:o.jsx("span",{className:"text-2xl",children:""})}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Streak"})]}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:e?.loginStreak||0}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]}),o.jsx("div",{role:"tablist","aria-label":"Dashboard sections",className:"flex claude-card rounded-2xl p-2 mb-8",children:[{id:"overview",label:"Overview",icon:""},{id:"profile",label:"My Profile",icon:""},{id:"cards",label:"My Cards",icon:""},{id:"public",label:"Public Cards",icon:""},{id:"imported",label:"Imported Cards",icon:""}].map((Y,be)=>{const D=[{id:"overview",label:"Overview",icon:""},{id:"profile",label:"My Profile",icon:""},{id:"cards",label:"My Cards",icon:""},{id:"public",label:"Public Cards",icon:""},{id:"imported",label:"Imported Cards",icon:""}],se=_===Y.id;return o.jsxs("button",{role:"tab","aria-selected":se,"aria-controls":`${Y.id}-panel`,id:`${Y.id}-tab`,tabIndex:se?0:-1,onKeyDown:xe=>{xe.key==="ArrowRight"&&b(D[(be+1)%D.length].id),xe.key==="ArrowLeft"&&b(D[(be-1+D.length)%D.length].id)},onClick:()=>b(Y.id),className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 ${se?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"claude-text-secondary hover:text-gray-700 hover:bg-gray-100"}`,children:[o.jsx("span",{children:Y.icon}),Y.label]},Y.id)})}),_==="overview"&&o.jsxs("div",{role:"tabpanel",id:"overview-panel","aria-labelledby":"overview-tab",className:"space-y-8",children:[o.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),o.jsxs("div",{className:"space-y-4",children:[n.slice(0,5).map(Y=>o.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/30 rounded-xl",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:[Y.question?.slice(0,60),"..."]}),o.jsxs("p",{className:"claude-text-muted text-sm",children:["Created ",new Date(Y.createdAt?.toDate?.()||Y.createdAt).toLocaleDateString()]})]}),o.jsx("span",{className:"text-blue-400 text-sm",children:Y.subject||"General"})]},Y.id)),n.length===0&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards yet"}),o.jsx("p",{className:"claude-text-muted",children:"Create your first flashcard to get started!"})]})]})]}),o.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Quick Stats"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:n.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Total Cards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:l.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported Cards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:oe}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Subjects"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:e?.loginStreak||0}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]})]})]}),_==="profile"&&o.jsxs("div",{role:"tabpanel",id:"profile-panel","aria-labelledby":"profile-tab",className:"claude-card rounded-3xl p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" My Profile"}),e?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Display Name"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsx("span",{className:"claude-text-primary",children:e.displayName||"Not set"})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Profile URL"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsxs("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 transition-colors",children:["three-sided.com/profile/",e.slug]})})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Bio"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsx("span",{className:"claude-text-primary",children:e.bio||"No bio added yet"})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Institution"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsx("span",{className:"claude-text-primary",children:e.institution||"Not specified"})})]}),o.jsxs("div",{className:"flex gap-4 pt-4",children:[o.jsx("button",{onClick:()=>{console.log("Edit profile")},className:"claude-button-primary",children:" Edit Profile"}),o.jsx("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary",children:" View Public Profile"})]})]}):o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No profile yet"}),o.jsx("p",{className:"claude-text-muted mb-6",children:"Create a profile to share your flashcards publicly and connect with other students."}),o.jsx("button",{onClick:()=>{console.log("Create profile")},className:"claude-button-primary",children:" Create My Profile"})]})]}),_==="cards"&&o.jsxs("div",{role:"tabpanel",id:"cards-panel","aria-labelledby":"cards-tab",className:"claude-card rounded-3xl p-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:[" My Cards (",n.length,")"]}),o.jsx("button",{onClick:Ve,disabled:p,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-60 rounded-lg transition-all duration-200",style:{color:"white"},children:p?"Refreshing":"Refresh"})]}),n.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards found"}),o.jsx("p",{className:"claude-text-muted mb-6",children:"It looks like you haven't created any flashcards yet, or there might be a connection issue."}),o.jsxs("div",{className:"space-x-4",children:[o.jsx("a",{href:"#",onClick:Y=>{Y.preventDefault(),window.location.href="/#create"},className:"inline-block px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-xl transition-all duration-200",style:{color:"white"},children:"Create a Flashcard"}),o.jsx("button",{onClick:Ve,disabled:p,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:opacity-60 font-semibold rounded-xl transition-all duration-200",style:{color:"white"},children:p?"Refreshing":"Try Loading Again"})]})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(Y=>o.jsxs("div",{className:"group claude-card border hover:border-blue-500/50 rounded-2xl p-6 transition-all duration-300",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("span",{className:"text-sm text-blue-400 font-medium",children:Y.subject||"General"}),o.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-200",children:[o.jsx("button",{onClick:()=>G(Y),className:"text-purple-400 hover:text-purple-300 text-sm px-2 py-1 rounded bg-purple-500/10 hover:bg-purple-500/20",title:"Move to deck",children:""}),o.jsx("button",{onClick:()=>V(Y.id),className:"text-red-400 hover:text-red-300",title:"Delete card",children:""})]})]}),o.jsx("h3",{className:"font-semibold mb-3 group-hover:text-blue-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:UE(Y.question,80)}),o.jsx("p",{className:"claude-text-secondary text-sm mb-4 leading-relaxed",children:UE(Y.answer,100)}),o.jsxs("div",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"claude-text-muted",children:Cx(Y.createdAt)?.toLocaleDateString()??""}),o.jsx("div",{className:"flex gap-2",children:Y.slug?o.jsx("a",{href:`/card/${Y.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"View Public "}):o.jsx("button",{onClick:()=>ae(Y),className:"text-blue-400 hover:text-blue-300 font-medium transition-colors cursor-pointer",children:" Inspect"})})]})]},Y.id))})]}),_==="public"&&o.jsxs("div",{role:"tabpanel",id:"public-panel","aria-labelledby":"public-tab",className:"claude-card rounded-3xl p-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:" Your Public Cards"}),o.jsx("button",{onClick:()=>U(!0),className:"claude-button-primary",children:" Manage Public Cards"})]}),o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Public Flashcard Management"}),o.jsx("p",{className:"claude-text-muted mb-6",children:"View, edit, and manage all your public flashcards in one place. Control what the world sees and track engagement."}),o.jsx("button",{onClick:()=>U(!0),className:"claude-button-primary",children:"Open Public Card Manager"})]})]}),_==="imported"&&o.jsxs("div",{role:"tabpanel",id:"imported-panel","aria-labelledby":"imported-tab",className:"claude-card rounded-3xl p-8",children:[o.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" Imported Cards (",l.length,")"]}),l.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No imported cards yet"}),o.jsx("p",{className:"claude-text-muted",children:"Import useful cards from the public library!"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(Y=>o.jsxs("div",{className:"group claude-card border hover:border-purple-500/50 rounded-2xl p-6 transition-all duration-300",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("span",{className:"text-sm text-purple-400 font-medium",children:Y.subject||"General"}),o.jsx("span",{className:"text-blue-400",children:""})]}),o.jsx("h3",{className:"font-semibold mb-3 group-hover:text-purple-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:Y.question?.length>80?Y.question.slice(0,80)+"...":Y.question}),o.jsx("p",{className:"claude-text-secondary text-sm leading-relaxed",children:Y.answer?.length>100?Y.answer.slice(0,100)+"...":Y.answer})]},Y.id))})]})]}),k&&N&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[o.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Card Inspector"}),o.jsx("button",{onClick:z,className:"claude-text-muted hover:text-gray-700 text-2xl transition-colors","aria-label":"Close inspector",children:""})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:[o.jsxs("div",{className:"flex gap-4 mb-6",children:[o.jsx("span",{className:"claude-tag",children:N.subject||"General"}),o.jsxs("span",{className:"claude-text-muted text-sm",children:["Created: ",Cx(N.createdAt)?.toLocaleDateString()??"Unknown"]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-purple-400 mb-3",children:"Statement"}),o.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:N.statement||N.question||"No statement available"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-3",children:"Hints"}),o.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:Array.isArray(N.hints)?N.hints.join(`
`):N.hints||N.hint||"No hints available"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-green-400 mb-3",children:"Proof"}),o.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:N.proof||N.answer||"No proof available"})]}),N.tags&&N.tags.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-orange-400 mb-3",children:"Tags"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:N.tags.map((Y,be)=>o.jsx("span",{className:"claude-tag",children:Y},be))})]}),o.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-300",children:[o.jsx("button",{onClick:()=>{console.log("Edit card:",N.id)},className:"claude-button-secondary",children:" Edit Card"}),o.jsx("button",{onClick:async()=>{await V(N.id),z()},className:"claude-button-danger",children:" Delete Card"}),o.jsx("button",{onClick:z,className:"claude-button-primary ml-auto",children:" Close"})]})]})]})}),F&&o.jsx(h3,{onClose:()=>U(!1),refreshCallback:A}),R&&B&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"claude-card max-w-md w-full mx-4 p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Move Card to Deck"}),o.jsx("button",{onClick:()=>T(!1),className:"transition-colors",style:{color:"var(--claude-text-muted)"},onMouseEnter:Y=>Y.target.style.color="var(--claude-primary-text)",onMouseLeave:Y=>Y.target.style.color="var(--claude-text-muted)",children:""})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("p",{className:"claude-text-secondary mb-2",children:"Moving card:"}),o.jsx("p",{className:"font-medium truncate",style:{color:"var(--claude-primary-text)"},children:B.statement||B.question||"Untitled Card"})]}),o.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[$.map(Y=>o.jsx("button",{onClick:()=>O(Y.id),className:"w-full text-left p-3 rounded-lg border border-gray-600 hover:border-purple-500 hover:bg-purple-500/10 transition-all duration-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:Y.icon||""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:Y.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[Y.cardCount||0," cards  ",Y.subject||"General"]})]})]})},Y.id)),$.length===0&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"claude-text-secondary",children:"No decks available"}),o.jsx("p",{className:"text-sm claude-text-muted mt-2",children:"Create a deck first to organize your cards"})]})]}),o.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:o.jsx("button",{onClick:()=>T(!1),className:"claude-button-secondary flex-1",children:"Cancel"})})]})})]})},cc=s=>s.trim().toLowerCase().replace(/[\s_]+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,40),g3=(s,e=200)=>{const[t,n]=P.useState(s);return P.useEffect(()=>{const a=setTimeout(()=>n(s),e);return()=>clearTimeout(a)},[s,e]),t},p3=({selectedTags:s=[],onTagsChange:e,onClose:t,isVisible:n=!1,maxSelected:a})=>{const[l,u]=P.useState([]),[h,m]=P.useState(""),[p,x]=P.useState(!0),[_,b]=P.useState(""),[N,C]=P.useState(""),k=P.useRef(null),L=g3(N,150);P.useEffect(()=>{if(!n)return;const T=document.body.style.overflow;document.body.style.overflow="hidden",setTimeout(()=>k.current?.focus(),0);const A=V=>{V.key==="Escape"&&t?.()};return window.addEventListener("keydown",A),()=>{document.body.style.overflow=T,window.removeEventListener("keydown",A)}},[n,t]),P.useEffect(()=>{if(!n)return;let T=!0;return(async()=>{x(!0),b("");try{const A=await is.getPopularTags(100);if(!T)return;const V=Array.from(new Set((A||[]).map(I=>cc(String(I||""))).filter(Boolean))).sort((I,G)=>I.localeCompare(G));u(V.length?V:F())}catch(A){if(console.error("Error loading tags:",A),!T)return;u(F()),b("Could not load popular tags. Showing common tags.")}finally{T&&x(!1)}})(),()=>{T=!1}},[n]);const F=()=>["calculus","algebra","geometry","trigonometry","statistics","physics","chemistry","biology","computer-science","mathematics","linear-algebra","differential-equations","real-analysis","abstract-algebra","topology","number-theory","combinatorics","probability","optimization"],U=P.useMemo(()=>Array.from(new Set(s.map(T=>cc(T)).filter(Boolean))),[s]),B=T=>typeof a=="number"?T<=a:!0,H=P.useCallback(T=>{const A=cc(T),I=U.includes(A)?U.filter(G=>G!==A):[...U,A];B(I.length)&&e?.(I)},[U,e,a]),$=P.useCallback(()=>{const T=cc(h);if(T){if(!l.includes(T)){const A=[...l,T].sort((V,I)=>V.localeCompare(I));u(A)}if(!U.includes(T)){const A=[...U,T];B(A.length)&&e?.(A)}m("")}},[h,l,U,e,a]),M=P.useCallback(T=>{const A=cc(T),V=U.filter(I=>I!==A);e?.(V)},[U,e]),R=P.useMemo(()=>{const T=L.trim().toLowerCase();return T?l.filter(A=>A.includes(T)):l},[l,L]);return n?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:o.jsxs("div",{ref:k,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"tags-title",className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden outline-none",children:[o.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"tags-title",className:"text-2xl font-bold",children:" Tag Management"}),o.jsx("button",{onClick:t,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Organize your flashcards with tags"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:[_&&o.jsx("div",{className:"mb-4 p-3 rounded-lg border border-yellow-200 bg-yellow-50 text-yellow-900",children:_}),U.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Selected Tags"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(T=>o.jsxs("span",{className:"inline-flex items-center gap-2 bg-primary-100 text-primary-800 px-3 py-2 rounded-full text-sm font-medium",children:["#",T,o.jsx("button",{onClick:()=>M(T),className:"text-primary-600 hover:text-primary-800 transition-colors","aria-label":`Remove tag ${T}`,children:""})]},T))})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Add Custom Tag"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:h,onChange:T=>m(T.target.value),placeholder:"Enter new tag (e.g., linear-algebra)",className:"input flex-1",onKeyDown:T=>T.key==="Enter"&&$(),"aria-label":"New tag"}),o.jsx("button",{onClick:$,className:"btn btn-primary whitespace-nowrap",disabled:!cc(h),children:"Add Tag"})]}),!!a&&o.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[U.length,"/",a," selected"]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Browse Tags"}),o.jsx("input",{type:"text",value:N,onChange:T=>C(T.target.value),placeholder:"Search tags",className:"input","aria-label":"Search tags"})]}),o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:["Available Tags (",R.length,")"]}),p?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-neutral-600",children:"Loading tags"})]}):R.length===0?o.jsxs("div",{className:"text-center py-8 text-neutral-600",children:['No tags found matching "',L,'"']}):o.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-4",children:R.map(T=>{const A=U.includes(T),V=!A&&a&&U.length>=a;return o.jsxs("button",{onClick:()=>H(T),disabled:V,className:`p-3 rounded-lg text-sm font-medium transition-all duration-200 text-left
                        ${A?"bg-primary-100 text-primary-800 border-2 border-primary-300":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200 border-2 border-transparent"}
                        ${V?"opacity-50 cursor-not-allowed":""}`,"aria-pressed":A,"aria-label":`Tag ${T}`,title:V?"Maximum selected":`#${T}`,children:["#",T]},T)})})]})]}),o.jsx("div",{className:"bg-neutral-50 px-6 py-4 border-t border-neutral-200",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"text-sm text-neutral-600",children:[U.length," tag",U.length!==1?"s":""," selected",a?`  max ${a}`:""]}),o.jsx("button",{onClick:t,className:"btn btn-primary",children:"Done"})]})})]})}):null},y3=1.3;function x3(s,e,t){const n={repetition:s.repetition??0,interval:s.interval??0,easeFactor:s.easeFactor??2.5};let{repetition:a,interval:l,easeFactor:u}=n;if(e<3)a=0,l=1;else{a===0?l=1:a===1?l=6:l=Math.round(l*u),a+=1;const p=.1-(5-e)*(.08+(5-e)*.02);u=Math.max(y3,parseFloat((u+p).toFixed(2)))}const h=new Date(t+l*24*60*60*1e3);return{next:{...s,repetition:a,interval:l,easeFactor:u,reviewCount:(s.reviewCount??0)+1,lastReviewed:new Date(t),nextReview:h}}}const v3=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState([]),[a,l]=P.useState(0),[u,h]=P.useState(!1),[m,p]=P.useState(!0),[x,_]=P.useState({total:0,due:0,new:0,learning:0,reviewing:0}),b=P.useRef(!0);P.useEffect(()=>(b.current=!0,e&&N(),()=>{b.current=!1}),[e]),P.useEffect(()=>{if(!e)return;const H=$=>{if($.key==="Escape")return s?.();if(t.length){if(!u&&($.key===" "||$.key==="Enter")){$.preventDefault(),h(!0);return}u&&"12345".includes($.key)&&($.preventDefault(),k(parseInt($.key,10))),$.key.toLowerCase()==="r"&&L()}};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[e,t.length,u]),P.useEffect(()=>{if(!e)return;const H=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=H}},[e]);const N=async()=>{try{p(!0);const H=await is.getPublicFlashcards(50);if(!b.current)return;const $=Date.now(),R=H.map((T,A)=>({...T,id:T.id||`card-${A}`,repetition:T.repetition??0,interval:T.interval??0,easeFactor:T.easeFactor??2.5,reviewCount:T.reviewCount??0,nextReview:T.nextReview?new Date(T.nextReview):new Date($),difficulty:T.difficulty??3,lastReviewed:T.lastReviewed?new Date(T.lastReviewed):null,question:T.statement??T.question??"",answer:T.proof??T.answer??"",hints:Array.isArray(T.hints)?T.hints:T.hints?[T.hints]:[]})).sort((T,A)=>T.nextReview-A.nextReview);if(!b.current)return;n(R),C(R)}catch(H){console.error("Error loading cards:",H),b.current&&n([])}finally{b.current&&p(!1)}},C=H=>{const $=Date.now(),M=H.length,R=H.filter(V=>(V.nextReview?.getTime?.()??V.nextReview)<=$).length,T=V=>V.reviewCount??0,A={total:M,due:R,new:H.filter(V=>T(V)===0).length,learning:H.filter(V=>T(V)>0&&T(V)<5).length,reviewing:H.filter(V=>T(V)>=5).length};_(A)},k=H=>{const $=Date.now();n(M=>{if(!M.length)return M;const R=M[a];if(!R)return M;const{next:T}=x3(R,H,$),A=[...M];A[a]=T;const V=[...A].sort((I,G)=>I.nextReview-G.nextReview);return C(V),V}),l(M=>Math.min(M+1,t.length-1)),h(!1)},L=()=>{l(0),h(!1)},F=()=>t[a]||null,U=F();dh([U,u]);const B=()=>[{value:1,label:"Again",color:"bg-danger-500 hover:bg-danger-600"},{value:2,label:"Hard",color:"bg-warning-500 hover:bg-warning-600"},{value:3,label:"Good",color:"bg-success-500 hover:bg-success-600"},{value:4,label:"Easy",color:"bg-primary-500 hover:bg-primary-600"},{value:5,label:"Perfect",color:"bg-accent-500 hover:bg-accent-600"}];return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:o.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"sr-title",className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",tabIndex:-1,children:[o.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"sr-title",className:"text-2xl font-bold",children:" Spaced Repetition"}),o.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close spaced repetition",title:"Close (Esc)",children:""})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Intelligent study scheduling for optimal learning"})]}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:m?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-neutral-600 text-lg",children:"Loading your study session..."})]}):t.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"No cards available"}),o.jsx("p",{className:"text-neutral-600",children:"Create some flashcards to start studying!"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-primary-600",children:x.total}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Total"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-danger-600",children:x.due}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Due"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-accent-600",children:x.new}),o.jsx("div",{className:"text-sm text-neutral-600",children:"New"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-warning-600",children:x.learning}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Learning"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-success-600",children:x.reviewing}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Reviewing"})]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:["Card ",a+1," of ",t.length]}),o.jsxs("span",{className:"text-sm text-neutral-500",children:[Math.round((a+1)/t.length*100),"% complete"]})]}),o.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:o.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-secondary-500 h-2 rounded-full transition-all duration-300",style:{width:`${(a+1)/t.length*100}%`}})})]}),o.jsx("div",{className:"card p-8 mb-8",children:o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex justify-center gap-4 mb-6 text-sm text-neutral-600",children:[o.jsxs("span",{children:["Interval: ",F()?.interval||0," days"]}),o.jsxs("span",{children:["Reviews: ",F()?.reviewCount||0]}),o.jsxs("span",{children:["Ease: ",F()?.easeFactor?.toFixed(1)||"2.5"]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Question"}),o.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:F()?.question||"Loading..."})]}),u&&o.jsxs("div",{className:"mb-8 animate-fade-in",children:[o.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Answer"}),o.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:F()?.answer||"No answer available"}),F()?.hints&&F().hints.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("h4",{className:"text-lg font-medium text-neutral-700 mb-2",children:"Hints"}),o.jsx("div",{className:"space-y-2",children:F().hints.map((H,$)=>o.jsxs("div",{className:"bg-accent-50 p-3 rounded-lg text-neutral-700",children:[" ",H]},$))})]})]}),u?o.jsxs("div",{className:"space-y-4",children:[o.jsx("h4",{className:"text-lg font-semibold text-neutral-800",children:"How well did you know this?"}),o.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:B().map(({value:H,label:$,color:M})=>o.jsxs("button",{onClick:()=>k(H),className:`btn text-white px-6 py-3 ${M}`,title:`${$} (${H})`,"aria-label":`Rate as ${$} (Press ${H})`,children:[H,". ",$]},H))})]}):o.jsx("button",{onClick:()=>h(!0),className:"btn btn-primary text-lg px-8 py-4",title:"Show Answer (Space or Enter)",children:"Show Answer"})]})}),o.jsxs("div",{className:"text-center mt-6 p-4 bg-gray-50 rounded-lg",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:" Keyboard Shortcuts"}),o.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Space"})," Show Answer"]}),o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"1-5"})," Rate Quality"]}),o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"R"})," Reset Session"]}),o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Esc"})," Close"]})]})]}),o.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[o.jsx("button",{onClick:L,className:"btn btn-secondary",title:"Reset Session (R)",children:" Reset Session"}),o.jsx("button",{onClick:s,className:"btn btn-primary",title:"Finish Session (Esc)",children:"Finish Session"})]})]})})]})}):null},b3=(s,e=200)=>{const[t,n]=P.useState(s);return P.useEffect(()=>{const a=setTimeout(()=>n(s),e);return()=>clearTimeout(a)},[s,e]),t},_3=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState(""),[a,l]=P.useState(""),[u,h]=P.useState(!1),[m,p]=P.useState(!1),[x,_]=P.useState(""),b=P.useRef(null),N=P.useRef(null),[C]=P.useState(["A direct sum B","The integral from 0 to infinity of x squared dx","The limit as x approaches 0 of sin x over x","The matrix with rows [1,2] and [3,4]","The set of all real numbers x such that x is greater than 0","The derivative of f with respect to x","The sum from n equals 1 to infinity of 1 over n squared","The product from i equals 1 to n of i","The square root of a squared plus b squared","The absolute value of x minus 3"]),k=b3(a,150);P.useEffect(()=>{e&&setTimeout(()=>b.current?.focus(),0)},[e]),P.useEffect(()=>{if(!e)return;const $=M=>{M.key==="Escape"&&s?.()};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[e,s]),dh([k],N.current);const L=P.useCallback(async()=>{if(!(!t.trim()||u)){h(!0),_(""),p(!1);try{const $=await sm.convertToLaTeX(t);l($||"")}catch($){console.error("Error converting to LaTeX:",$),_("Could not convert to LaTeX. Please try again.")}finally{h(!1)}}},[t,u]),F=async $=>{n($),setTimeout(()=>{L()},0)},U=async()=>{if(a)try{await navigator.clipboard.writeText(a),p(!0),setTimeout(()=>p(!1),1500)}catch($){console.error("Failed to copy:",$),p(!1)}},B=()=>{n(""),l(""),p(!1),_(""),h(!1)},H=$=>{($.ctrlKey||$.metaKey)&&$.key==="Enter"&&($.preventDefault(),L())};return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},role:"dialog","aria-modal":"true","aria-labelledby":"latex-converter-title",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"latex-converter-title",className:"text-2xl font-bold",children:" LaTeX Converter"}),o.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Convert natural language to beautiful mathematical notation"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Input"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"nl-input",className:"block text-sm font-medium claude-text-secondary mb-2",children:"Natural Language Description"}),o.jsx("textarea",{id:"nl-input",ref:b,value:t,onChange:$=>n($.target.value),placeholder:"e.g., A direct sum B, The integral from 0 to infinity of x squared dx...",className:"claude-input h-32",onKeyDown:H}),o.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Press Ctrl/ + Enter to convert"})]}),o.jsx("button",{onClick:L,disabled:!t.trim()||u,className:"claude-button-primary w-full mb-4 disabled:opacity-60",children:u?o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Converting..."]}):" Convert to LaTeX"}),x&&o.jsxs("div",{className:"claude-alert claude-alert-error mb-4",children:[x," ",o.jsx("button",{className:"underline ml-1 font-medium",onClick:L,disabled:u,children:"Retry"})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-medium claude-text-secondary mb-3",children:"Quick Examples"}),o.jsx("div",{className:"space-y-2",children:C.map(($,M)=>o.jsx("button",{onClick:()=>F($),className:"claude-card block w-full text-left p-3 text-sm claude-text-secondary transition-all hover:shadow-md","aria-label":`Use example: ${$}`,children:$},M))})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Output"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"latex-output",className:"block text-sm font-medium claude-text-secondary mb-2",children:"LaTeX Code"}),o.jsxs("div",{className:"relative",children:[o.jsx("textarea",{id:"latex-output",value:a,readOnly:!0,placeholder:"LaTeX will appear here...",className:"claude-input h-32 font-mono",style:{backgroundColor:"var(--background-modal)"}}),o.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[a&&o.jsx("button",{onClick:U,className:"claude-button-secondary p-2",title:"Copy to clipboard","aria-label":"Copy LaTeX to clipboard",children:""}),m&&o.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},role:"status","aria-live":"polite",children:"Copied!"})]})]})]}),a&&o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Preview"}),o.jsxs("div",{className:"claude-card p-4 min-h-[100px]",style:{border:"2px dashed var(--border-light)"},children:[o.jsx("div",{ref:N,className:"prose max-w-none",children:k}),!window.MathJax&&o.jsx("div",{className:"text-center mt-2 claude-text-muted text-xs",children:"(MathJax not loaded  preview shows raw TeX)"})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:B,disabled:!t&&!a&&!x,className:"claude-button-secondary w-full disabled:opacity-60",children:" Clear All"}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-sm claude-text-secondary",children:" Tip: Use this tool to quickly convert mathematical expressions"}),o.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Perfect for creating flashcards with LaTeX support"})]})]})]})]}),o.jsxs("div",{className:"mt-8 p-4 rounded-xl",style:{background:"linear-gradient(to right, var(--background-modal), rgba(68, 90, 255, 0.05))"},children:[o.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--heading)"},children:"How to use LaTeX in Three-Sided:"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm claude-text-secondary",children:[o.jsxs("div",{children:[o.jsx("strong",{children:"Inline math:"})," Wrap with ",o.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$ $"}),o.jsx("br",{}),o.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",o.jsx("code",{children:"$x^2 + y^2 = z^2$"})]})]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Block math:"})," Wrap with ",o.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$$ $$"}),o.jsx("br",{}),o.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",o.jsxs("code",{children:["$$\\int_0^\\infty e^","{-x}"," \\, dx = 1$$"]})]})]})]})]})]})]})}):null};class Uy{static async createCheckoutSession(){try{const e=await bs.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to create checkout session")}return(await t.json()).id}catch(e){throw console.error("Error creating checkout session:",e),e}}static async createPortalLink(){try{const e=await bs.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createPortalLink",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to create portal link")}return(await t.json()).url}catch(e){throw console.error("Error creating portal link:",e),e}}static async redirectToCheckout(e){const t=window.Stripe?window.Stripe("pk_live_51RUu9KE3qmOAkttRGqw7Cr2wJ6qRHtCz9qXpHJHO0Bv4Q7gGHg5QXI9GFdXGh4IhQD5Xf9XUvLFCr9G2PHK0003w0Q"):null;if(!t)throw new Error("Stripe.js not loaded. Please include the Stripe script in your HTML.");const{error:n}=await t.redirectToCheckout({sessionId:e});if(n)throw new Error(n.message)}}const ka={monthly:{label:"Monthly",displayPrice:"5",period:"month",savings:null,popular:!1,priceId:"price_1RUvcJE3qmOAkttR2Rh4YzOY",interval:"month"},yearly:{label:"Yearly",displayPrice:"50",period:"year",savings:"10",popular:!0,priceId:"price_YEARLY_REPLACE_ME",interval:"year"}},w3=[{name:"Spaced Repetition Mode",description:"Advanced algorithm for optimal learning",free:"",premium:"",icon:""},{name:"AI Autofill (Hint, Proof, Tags)",description:"Generate content with AI assistance",free:" Limited (1/day)",premium:" Unlimited",icon:""},{name:"AI Auto-Tagging",description:"Automatic tag suggestions",free:" Limited (1/day)",premium:" Unlimited",icon:""},{name:"AI LaTeX Conversion",description:"Convert text to mathematical notation",free:" Unlimited",premium:" Unlimited",icon:""},{name:"Public Profile & Sharing",description:"Share your flashcards with the community",free:"",premium:" + Custom Themes",icon:""},{name:"Advanced Analytics",description:"Detailed learning progress tracking",free:"",premium:"",icon:""},{name:"Priority Support",description:"Get help when you need it most",free:"",premium:"",icon:""},{name:"Export & Backup",description:"Download your data anytime",free:"",premium:"",icon:""}],T3=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState("monthly"),[a,l]=P.useState(!1),[u,h]=P.useState(!1),[m,p]=P.useState(""),x=P.useRef(null);P.useEffect(()=>{if(e){const N=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=N}}},[e]),P.useEffect(()=>{if(!e)return;setTimeout(()=>x.current?.focus(),0);const N=C=>{C.key==="Escape"&&s?.()};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[e,s]);const _=P.useCallback(async()=>{p("");try{l(!0);const N=await Uy.createCheckoutSession();await Uy.redirectToCheckout(N)}catch(N){console.error("Error creating subscription:",N),p("Failed to start subscription. Please check your connection and try again.")}finally{l(!1)}},[t]),b=P.useCallback(async()=>{p("");try{h(!0);const N=await Uy.createPortalLink();window.location.href=N}catch(N){console.error("Error accessing subscription management:",N),p("Failed to open the billing portal. Please try again.")}finally{h(!1)}},[]);return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:o.jsxs("div",{ref:x,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"premium-title",className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden outline-none",children:[o.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"premium-title",className:"text-2xl font-bold",children:" Premium Features"}),o.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:""})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Unlock the full potential of Three-Sided"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[m&&o.jsx("div",{className:"claude-alert claude-alert-error mb-4",children:m}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Choose Your Plan"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto",role:"radiogroup","aria-label":"Billing plan",children:[o.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 ${t==="monthly"?"claude-card-elevated":""}`,style:{border:t==="monthly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="monthly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[o.jsx("input",{type:"radio",name:"plan",value:"monthly",className:"sr-only",checked:t==="monthly",onChange:()=>n("monthly"),"aria-label":"Monthly plan"}),o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:ka.monthly.label}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:ka.monthly.displayPrice}),o.jsxs("div",{className:"claude-text-secondary mb-4",children:["per ",ka.monthly.period]}),o.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto border-2",style:{backgroundColor:t==="monthly"?"var(--accent-primary)":"transparent",borderColor:t==="monthly"?"var(--accent-primary)":"var(--border-light)"}})]})]}),o.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 relative ${t==="yearly"?"claude-card-elevated":""}`,style:{border:t==="yearly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="yearly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[o.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:o.jsx("span",{className:"text-white px-3 py-1 rounded-full text-xs font-bold",style:{backgroundColor:"var(--accent-secondary)"},children:"MOST POPULAR"})}),o.jsx("input",{type:"radio",name:"plan",value:"yearly",className:"sr-only",checked:t==="yearly",onChange:()=>n("yearly"),"aria-label":"Yearly plan"}),o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:ka.yearly.label}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:ka.yearly.displayPrice}),o.jsxs("div",{className:"claude-text-secondary mb-2",children:["per ",ka.yearly.period]}),o.jsxs("div",{className:"font-bold mb-4",style:{color:"var(--success)"},children:["Save ",ka.yearly.savings,"!"]}),o.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto",style:{backgroundColor:t==="yearly"?"var(--accent-primary)":"transparent",borderColor:t==="yearly"?"var(--accent-primary)":"var(--border-light)"}})]})]})]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Feature Comparison"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:"2px solid var(--border-light)"},children:[o.jsx("th",{className:"text-left p-4 font-semibold",style:{color:"var(--heading)"},children:"Feature"}),o.jsx("th",{className:"text-center p-4 font-semibold",style:{color:"var(--heading)"},children:"Free"}),o.jsx("th",{className:"text-center p-4 font-semibold rounded-lg",style:{color:"var(--heading)",background:"linear-gradient(to right, rgba(99, 91, 255, 0.1), rgba(68, 90, 255, 0.1))"},children:"Premium"})]})}),o.jsx("tbody",{children:w3.map((N,C)=>o.jsxs("tr",{className:"claude-card hover:shadow-sm transition-all",style:{border:"none",marginBottom:"4px"},children:[o.jsx("td",{className:"p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:N.icon}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--heading)"},children:N.name}),o.jsx("div",{className:"text-sm claude-text-secondary",children:N.description})]})]})}),o.jsx("td",{className:"p-4 text-center",children:o.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:N.free===""?"rgba(91, 200, 162, 0.1)":N.free.startsWith("")?"rgba(255, 213, 84, 0.1)":"var(--background-modal)",color:N.free===""?"var(--success)":N.free.startsWith("")?"var(--warning)":"var(--text-secondary)"},children:N.free})}),o.jsx("td",{className:"p-4 text-center",style:{background:"linear-gradient(to right, rgba(99, 91, 255, 0.05), rgba(68, 90, 255, 0.05))"},children:o.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:N.premium})})]},C))})]})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Why Go Premium?"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Accelerate Learning"}),o.jsx("p",{className:"claude-text-secondary",children:"Unlimited AI assistance helps you create better flashcards faster"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Track Progress"}),o.jsx("p",{className:"claude-text-secondary",children:"Advanced analytics show your learning journey and improvement"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Study Smarter"}),o.jsx("p",{className:"claude-text-secondary",children:"Spaced repetition algorithm optimizes your study schedule"})]})]})]}),o.jsxs("div",{className:"text-center space-y-4",children:[o.jsx("button",{onClick:_,disabled:a,className:"claude-button-primary text-lg px-12 py-4 disabled:opacity-60 disabled:cursor-not-allowed",style:{boxShadow:"0 0 20px rgba(99, 91, 255, 0.3)"},children:a?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):`Go Premium - ${ka[t].displayPrice}/${ka[t].period}`}),o.jsxs("div",{className:"flex justify-center gap-4",children:[o.jsx("button",{onClick:b,disabled:u,className:"claude-button-secondary disabled:opacity-60 disabled:cursor-not-allowed",children:u?"Opening":"Manage Subscription"}),o.jsx("button",{onClick:s,className:"claude-button-secondary",children:"Maybe Later"})]})]}),o.jsx("div",{className:"mt-8 p-4 rounded-xl text-center",style:{backgroundColor:"var(--background-modal)"},children:o.jsx("p",{className:"text-sm claude-text-secondary",children:" Secure payment powered by Stripe  Cancel anytime  30-day money-back guarantee"})})]})]})}):null},E3=({onProfileCreated:s,onClose:e})=>{const{user:t}=Cn(),[n,a]=P.useState({displayName:"",bio:"",institution:""}),[l,u]=P.useState(""),[h,m]=P.useState({state:"idle",message:""}),[p,x]=P.useState(!1),[_,b]=P.useState(null),N={displayName:50,bio:1e3,institution:100},C=P.useCallback(async B=>{const H=Ss.slugify(B);if(u(H),!H){m({state:"idle",message:""});return}m({state:"checking",message:"Checking availability..."});try{const $=await Ss.isSlugTaken(H);m($?{state:"taken",message:` ${H} is already taken`}:{state:"available",message:` ${H} is available!`})}catch{m({state:"error",message:" Error checking availability. Please try again."})}},[]),k=B=>{a($=>({...$,displayName:B})),_&&clearTimeout(_);const H=setTimeout(()=>{C(B)},400);b(H)},L=async B=>{if(B.preventDefault(),!t){alert("You must be logged in to create a profile.");return}if(n.displayName.length<2||n.displayName.length>N.displayName){alert(`Display name must be between 2 and ${N.displayName} characters.`);return}if(n.bio.length>N.bio){alert(`Bio must be ${N.bio} characters or less.`);return}if(n.institution.length>N.institution){alert(`Institution must be ${N.institution} characters or less.`);return}if(!l||h.state!=="available"){alert("Please wait for slug availability check or choose a different name.");return}x(!0);try{if(await Ss.isSlugTaken(l)){alert(`Username "${l}" was just taken. Please choose another name.`),await C(n.displayName);return}await Ss.createProfile(t.uid,l,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim(),email:t.email}),s&&s()}catch(H){console.error("Error creating profile:",H),alert("Something went wrong. Please try again.")}finally{x(!1)}},F=({current:B,max:H,label:$})=>{const M=B/H*100;let R="text-sm ";return M>90?R+="text-red-500":M>70?R+="text-yellow-500":R+="text-gray-500",o.jsxs("div",{className:R,children:[B,"/",H," ",$]})};P.useEffect(()=>()=>{_&&clearTimeout(_)},[_]);const U=n.displayName.length>=2&&n.displayName.length<=N.displayName&&n.bio.length<=N.bio&&n.institution.length<=N.institution&&h.state==="available";return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Create Your Profile"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Set up your public profile to connect with others"})]}),o.jsx("div",{className:"claude-card p-8",children:o.jsxs("form",{onSubmit:L,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),o.jsx("input",{type:"text",value:n.displayName,onChange:B=>k(B.target.value),placeholder:"Enter your display name",maxLength:N.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:B=>{B.target.style.borderColor="var(--claude-accent)",B.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:B=>{B.target.style.borderColor="var(--claude-border)",B.target.style.boxShadow="none"}}),o.jsx("div",{className:"flex justify-between items-center mt-2",children:o.jsx(F,{current:n.displayName.length,max:N.displayName,label:"characters"})}),o.jsxs("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[o.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your profile URL: ",o.jsxs("strong",{children:["three-sided.app/profile/",o.jsx("span",{className:"font-mono",children:l||"..."})]})]}),h.message&&o.jsxs("div",{className:`text-sm mt-1 ${h.state==="checking"?"text-blue-500":h.state==="available"?"text-green-500":(h.state==="taken","text-red-500")}`,children:[h.state==="checking"&&o.jsxs("span",{className:"inline-flex items-center gap-2",children:[o.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),h.message]}),h.state!=="checking"&&h.message]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Short Bio"}),o.jsx("textarea",{value:n.bio,onChange:B=>a(H=>({...H,bio:B.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:N.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:B=>{B.target.style.borderColor="var(--claude-accent)",B.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:B=>{B.target.style.borderColor="var(--claude-border)",B.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),o.jsx(F,{current:n.bio.length,max:N.bio,label:"characters"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),o.jsx("input",{type:"text",value:n.institution,onChange:B=>a(H=>({...H,institution:B.target.value})),placeholder:"University, company, or organization (optional)",maxLength:N.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:B=>{B.target.style.borderColor="var(--claude-accent)",B.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:B=>{B.target.style.borderColor="var(--claude-border)",B.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{}),o.jsx(F,{current:n.institution.length,max:N.institution,label:"characters"})]})]}),o.jsxs("div",{className:"flex gap-4 pt-4",children:[o.jsx("button",{type:"submit",disabled:!U||p,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:p?o.jsxs("span",{className:"flex items-center justify-center gap-2",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Profile..."]}):"Create Profile"}),e&&o.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 rounded-xl font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:B=>{B.target.style.backgroundColor="var(--claude-surface-hover)"},onMouseLeave:B=>{B.target.style.backgroundColor="var(--claude-subtle)"},children:"Cancel"})]})]})})]})})};class yn{static async getFriendRequests(e){try{const t=Le(Ce(ee,"friendRequests"),Ye("to","==",e),Jt("timestamp","desc")),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data(),h=u.from,m=await Ss.getProfileByUserId(h);a.push({id:l.id,fromId:h,toId:u.to,timestamp:u.timestamp,senderProfile:m||{displayName:"Unknown User",slug:null}})}return a}catch(t){throw console.error("Error getting friend requests:",t),t}}static async sendFriendRequest(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs");const[n,a]=await Promise.all([this.checkExistingRequest(e,t),this.checkExistingRequest(t,e)]);if(n)throw new Error("Friend request already sent");if(a)throw new Error("This user has already sent you a friend request");if(await this.areFriends(e,t))throw new Error("You are already friends");const u=3;let h;for(let m=1;m<=u;m++)try{await Qs(Ce(ee,"friendRequests"),{from:e,to:t,timestamp:Pe(),status:"pending"}),console.log(" Friend request sent:",{fromId:e,toId:t});return}catch(p){h=p,m<u&&(console.warn(`Retry ${m}/${u} for friend request:`,p.message),await new Promise(x=>setTimeout(x,1e3*m)))}throw h}catch(n){throw console.error(" Error sending friend request:",n),n}}static async acceptFriendRequest(e,t,n){try{if(!e||!t||!n||t===n)throw new Error("Invalid parameters for accepting friend request");const a=await vt(ve(ee,"friendRequests",e));if(!a.exists())throw new Error("Friend request not found");const l=a.data();if(l.from!==t||l.to!==n)throw new Error("Friend request does not match the specified users");if(await this.areFriends(t,n)){await Ko(ve(ee,"friendRequests",e)),console.log("Users were already friends, cleaned up request");return}const h=Qo(ee),m=ve(ee,"userFriends",n,"friends",t),p=ve(ee,"userFriends",t,"friends",n),x={addedAt:Pe(),requestAcceptedAt:Pe(),status:"active"};h.set(m,x),h.set(p,x);const _=ve(ee,"friendRequests",e);h.delete(_);const b=3;let N;for(let C=1;C<=b;C++)try{await h.commit(),console.log(" Friend request accepted:",{fromId:t,toId:n,requestId:e});return}catch(k){N=k,C<b&&(console.warn(`Retry ${C}/${b} for accepting friend request:`,k.message),await new Promise(L=>setTimeout(L,1e3*C)))}throw N}catch(a){throw console.error(" Error accepting friend request:",a),a}}static async rejectFriendRequest(e){try{await Ko(ve(ee,"friendRequests",e)),console.log(" Friend request rejected:",e)}catch(t){throw console.error(" Error rejecting friend request:",t),t}}static async removeFriend(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs for removing friend");if(!await this.areFriends(e,t)){console.log("Users are not friends, nothing to remove");return}const a=Qo(ee),l=ve(ee,"userFriends",e,"friends",t),u=ve(ee,"userFriends",t,"friends",e);a.delete(l),a.delete(u);const h=3;let m;for(let p=1;p<=h;p++)try{await a.commit(),console.log(" Friend removed:",{userId:e,friendId:t});return}catch(x){m=x,p<h&&(console.warn(`Retry ${p}/${h} for removing friend:`,x.message),await new Promise(_=>setTimeout(_,1e3*p)))}throw m}catch(n){throw console.error(" Error removing friend:",n),n}}static async getFriends(e){try{const t=Le(Ce(ee,"userFriends",e,"friends")),n=await Ke(t),a=[];for(const l of n.docs){const u=l.id,h=l.data(),m=await Ss.getProfileByUserId(u);m&&a.push({userId:u,addedAt:h.addedAt,...m})}return a}catch(t){throw console.error("Error getting friends:",t),t}}static async getFriendshipStatus(e,t){try{const n=await this.areFriends(e,t),a=await this.checkExistingRequest(e,t),l=await this.checkExistingRequest(t,e);return{areFriends:n,sentRequest:!!a,receivedRequest:!!l,receivedRequestId:l?.id||null}}catch(n){return console.error("Error getting friendship status:",n),{areFriends:!1,sentRequest:!1,receivedRequest:!1,receivedRequestId:null}}}static async areFriends(e,t){try{return(await vt(ve(ee,"userFriends",e,"friends",t))).exists()}catch(n){return console.error("Error checking friendship:",n),!1}}static async checkExistingRequest(e,t){try{const n=Le(Ce(ee,"friendRequests"),Ye("from","==",e),Ye("to","==",t)),a=await Ke(n);if(!a.empty){const l=a.docs[0];return{id:l.id,...l.data()}}return null}catch(n){return console.error("Error checking existing request:",n),null}}static async getMutualFriends(e,t){try{const[n,a]=await Promise.all([this.getFriendIds(e),this.getFriendIds(t)]),l=n.filter(h=>a.includes(h)),u=[];for(let h=0;h<Math.min(3,l.length);h++){const m=await Ss.getProfileByUserId(l[h]);m&&u.push(m)}return{total:l.length,profiles:u,hasMore:l.length>3}}catch(n){return console.error("Error getting mutual friends:",n),{total:0,profiles:[],hasMore:!1}}}static async getFriendCount(e){try{const t=Le(Ce(ee,"userFriends",e,"friends"));return(await Ke(t)).size}catch(t){return console.error("Error getting friend count:",t),0}}static async getFriendIds(e){try{const t=Le(Ce(ee,"userFriends",e,"friends"));return(await Ke(t)).docs.map(a=>a.id)}catch(t){return console.error("Error getting friend IDs:",t),[]}}}const N3=({onViewProfile:s})=>{const{user:e}=Cn(),[t,n]=P.useState("friends"),[a,l]=P.useState([]),[u,h]=P.useState([]),[m,p]=P.useState([]),[x,_]=P.useState(""),[b,N]=P.useState(!1),[C,k]=P.useState([]),[L,F]=P.useState({friendCount:0,requestCount:0,sharedCardsCount:0,mutualConnections:0});P.useEffect(()=>{e&&U()},[e]),P.useEffect(()=>{switch(t){case"friends":B();break;case"requests":H();break;case"leaderboard":V();break}},[t]);const U=async()=>{try{const[ae,z,oe]=await Promise.all([yn.getFriendCount(e.uid),yn.getFriendRequests(e.uid),is.getPublicFlashcardsByUser(e.uid)]);F(Y=>({...Y,friendCount:ae,requestCount:z.length,sharedCardsCount:oe.length}))}catch(ae){console.error("Error loading initial data:",ae)}},B=async()=>{N(!0);try{const ae=await yn.getFriends(e.uid);l(ae),F(z=>({...z,friendCount:ae.length}))}catch(ae){console.error("Error loading friends:",ae)}finally{N(!1)}},H=async()=>{N(!0);try{const ae=await yn.getFriendRequests(e.uid);h(ae),F(z=>({...z,requestCount:ae.length}))}catch(ae){console.error("Error loading friend requests:",ae)}finally{N(!1)}},$=async()=>{if(x.trim()){N(!0);try{const z=(await Ss.searchProfiles(x)).filter(Y=>Y.userId!==e.uid),oe=await Promise.all(z.map(async Y=>{const be=await yn.getFriendshipStatus(e.uid,Y.userId),D=await yn.getMutualFriends(e.uid,Y.userId);return{...Y,friendshipStatus:be,mutualFriends:D}}));p(oe)}catch(ae){console.error("Error searching users:",ae)}finally{N(!1)}}},M=async ae=>{try{await yn.sendFriendRequest(e.uid,ae),I("Friend request sent!"),x&&await $(),await U()}catch(z){console.error("Error sending friend request:",z),I("Failed to send friend request",!0)}},R=async ae=>{try{await yn.acceptFriendRequest(ae.id,ae.fromId,e.uid),I("Friend request accepted!"),await H(),await U(),t==="friends"&&await B()}catch(z){console.error("Error accepting friend request:",z),I("Failed to accept friend request",!0)}},T=async ae=>{try{await yn.rejectFriendRequest(ae),I("Friend request declined"),await H(),await U()}catch(z){console.error("Error rejecting friend request:",z),I("Failed to reject friend request",!0)}},A=async(ae,z)=>{if(confirm(`Remove ${z} from your friends?`))try{await yn.removeFriend(e.uid,ae),I("Friend removed"),await B(),await U()}catch(oe){console.error("Error removing friend:",oe),I("Failed to remove friend",!0)}},V=async()=>{N(!0);try{const ae=await yn.getFriendIds(e.uid),z=[e.uid,...ae],oe=[];for(const be of z){const D=await Ss.getProfileByUserId(be);D&&oe.push({...D,userId:be})}const Y=await Promise.all(oe.map(async be=>{const D=await yn.getFriendCount(be.userId);return{...be,friendCount:D,isCurrentUser:be.userId===e.uid}}));Y.sort((be,D)=>D.friendCount-be.friendCount),k(Y)}catch(ae){console.error("Error loading leaderboard:",ae)}finally{N(!1)}},I=(ae,z=!1)=>{const oe=document.createElement("div");oe.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",oe.style.backgroundColor=z?"#ef4444":"#10b981",oe.textContent=ae,document.body.appendChild(oe),setTimeout(()=>{oe.style.transform="translateX(0)"},100),setTimeout(()=>{oe.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(oe)},300)},3e3)},G=ae=>ae?ae.split(" ").map(z=>z.charAt(0)).join("").toUpperCase().slice(0,2):"?",O=(ae,z,oe,Y=!0)=>{const be=()=>Y?z?.areFriends?o.jsx("button",{onClick:()=>A(ae.userId,ae.displayName),className:"px-3 py-1 rounded-lg text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove"}):z?.sentRequest?o.jsx("span",{className:"px-3 py-1 rounded-lg text-sm font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):z?.receivedRequest?o.jsx("button",{onClick:()=>R({id:z.receivedRequestId,fromId:ae.userId}),className:"px-3 py-1 rounded-lg text-sm font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}):o.jsx("button",{onClick:()=>M(ae.userId),className:"px-3 py-1 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}):null,D=()=>z?.areFriends?o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-green-100 text-green-800",children:"Friends"}):z?.sentRequest?o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"Pending"}):z?.receivedRequest?o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"Wants to connect"}):null;return o.jsx("div",{className:"claude-card p-4 hover:scale-[1.02] transition-transform",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:G(ae.displayName)}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:s&&ae.slug?o.jsx("button",{onClick:()=>s(ae.slug),className:"hover:underline transition-colors",style:{color:"var(--claude-heading)"},children:ae.displayName||"Unknown User"}):ae.displayName||"Unknown User"}),D()]}),o.jsxs("div",{className:"text-sm claude-text-secondary space-y-1",children:[ae.email&&o.jsx("div",{children:ae.email}),ae.institution&&o.jsxs("div",{children:[" ",ae.institution]}),oe?.total>0&&o.jsxs("div",{className:"text-green-600 font-medium",children:[oe.total," mutual friend",oe.total>1?"s":""]})]})]})]}),o.jsx("div",{className:"flex items-center gap-2",children:be()})]})},ae.userId)},Ve=[{id:"friends",label:"My Friends",icon:""},{id:"discover",label:"Discover",icon:""},{id:"requests",label:"Requests",icon:"",badge:L.requestCount},{id:"leaderboard",label:"Leaderboard",icon:""}];return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:" Friends & Social"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Connect with fellow learners and share your progress"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:""}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:L.friendCount}),o.jsx("div",{className:"claude-text-secondary",children:"Friends"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:""}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:L.sharedCardsCount}),o.jsx("div",{className:"claude-text-secondary",children:"Cards Shared"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:""}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:L.requestCount}),o.jsx("div",{className:"claude-text-secondary",children:"Pending Requests"})]})]}),o.jsx("div",{className:"claude-card p-2 mb-8",children:o.jsx("div",{className:"flex",children:Ve.map(ae=>o.jsxs("button",{onClick:()=>n(ae.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 relative",style:{backgroundColor:t===ae.id?"var(--claude-accent)":"transparent",color:t===ae.id?"white":"var(--claude-secondary-text)"},children:[o.jsx("span",{children:ae.icon}),ae.label,ae.badge>0&&o.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:ae.badge})]},ae.id))})}),o.jsxs("div",{className:"claude-card p-8",children:[t==="friends"&&o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" My Friends (",L.friendCount,")"]}),b?o.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ae,z)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},z))}):a.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No friends yet"}),o.jsx("p",{className:"claude-text-secondary",children:"Search for users to add your first friend!"})]}):o.jsx("div",{className:"space-y-4",children:a.map(ae=>O(ae,{areFriends:!0},null,!0))})]}),t==="discover"&&o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Discover Users"}),o.jsxs("div",{className:"flex gap-4 mb-6",children:[o.jsx("input",{type:"text",value:x,onChange:ae=>_(ae.target.value),onKeyPress:ae=>ae.key==="Enter"&&$(),placeholder:"Search by email or display name...",className:"flex-1 px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"}}),o.jsxs("button",{onClick:$,disabled:!x.trim()||b,className:"claude-button-primary disabled:opacity-50",children:[b?"":""," Search"]})]}),o.jsx("p",{className:"text-sm claude-text-secondary mb-6",children:" Tip: Search by email address or display name for best results"}),b?o.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ae,z)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},z))}):m.length===0&&x?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),o.jsx("p",{className:"claude-text-secondary",children:"Try searching with a different email or username"})]}):m.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Discover new friends"}),o.jsx("p",{className:"claude-text-secondary",children:"Search for users to connect with and share your learning journey!"})]}):o.jsx("div",{className:"space-y-4",children:m.map(ae=>O(ae,ae.friendshipStatus,ae.mutualFriends,!0))})]}),t==="requests"&&o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:[" Friend Requests (",L.requestCount,")"]}),b?o.jsx("div",{className:"space-y-4",children:Array.from({length:2}).map((ae,z)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},z))}):u.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No pending requests"}),o.jsx("p",{className:"claude-text-secondary",children:"You're all caught up! New friend requests will appear here."})]}):o.jsx("div",{className:"space-y-4",children:u.map(ae=>o.jsx("div",{className:"claude-card p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:G(ae.senderProfile.displayName)}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:ae.senderProfile.displayName||"Unknown User"}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Wants to connect with you"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>R(ae),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}),o.jsx("button",{onClick:()=>T(ae.id),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Decline"})]})]})},ae.id))})]}),t==="leaderboard"&&o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:" Friends Leaderboard"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:"Top learners among you and your friends"}),b?o.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((ae,z)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),o.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]})},z))}):C.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No leaderboard data"}),o.jsx("p",{className:"claude-text-secondary",children:"Add some friends to see the leaderboard!"})]}):o.jsx("div",{className:"space-y-3",children:C.map((ae,z)=>o.jsx("div",{className:`claude-card p-4 transition-all duration-300 hover:scale-[1.02] ${ae.isCurrentUser?"ring-2 ring-blue-500 bg-blue-50/10":""}`,style:{backgroundColor:z<3&&!ae.isCurrentUser?"rgba(255, 215, 0, 0.1)":ae.isCurrentUser?"rgba(59, 130, 246, 0.1)":"var(--claude-surface)",border:`1px solid ${z<3&&!ae.isCurrentUser?"rgba(255, 215, 0, 0.3)":ae.isCurrentUser?"rgba(59, 130, 246, 0.3)":"var(--claude-border)"}`},children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm",style:{background:z<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:z<3?"white":"var(--claude-text)"},children:z===0?"":z===1?"":z===2?"":z+1}),o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:G(ae.displayName)}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:[ae.displayName||"Unknown User",ae.isCurrentUser&&o.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"You"})]}),ae.slug&&o.jsxs("button",{onClick:()=>s&&s(ae.slug),className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",ae.slug]})]}),o.jsx("div",{className:"claude-text-secondary text-sm",children:ae.institution&&` ${ae.institution}`})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-xl font-bold",style:{color:z<3?"#FFD700":"var(--claude-accent-blue)"},children:ae.friendCount}),o.jsxs("div",{className:"claude-text-secondary text-sm",children:["friend",ae.friendCount!==1?"s":""]})]})]})},ae.userId))})]})]})]})})},S3=({profile:s,onSave:e,onCancel:t})=>{const[n,a]=P.useState({displayName:"",bio:"",institution:""}),[l,u]=P.useState(!1),h={displayName:50,bio:1e3,institution:100};P.useEffect(()=>{s&&a({displayName:s.displayName||"",bio:s.bio||"",institution:s.institution||""})},[s]);const m=async x=>{if(x.preventDefault(),n.displayName.length<2||n.displayName.length>h.displayName){alert(`Display name must be between 2 and ${h.displayName} characters.`);return}if(n.bio.length>h.bio){alert(`Bio must be ${h.bio} characters or less.`);return}if(n.institution.length>h.institution){alert(`Institution must be ${h.institution} characters or less.`);return}u(!0);try{await Ss.updateProfile(s.slug,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()}),e&&e({...s,displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()})}catch(_){console.error("Error updating profile:",_),alert("Something went wrong. Please try again.")}finally{u(!1)}},p=({current:x,max:_,label:b})=>{const N=x/_*100;let C="text-sm ";return N>90?C+="text-red-500":N>70?C+="text-yellow-500":C+="text-gray-500",o.jsxs("div",{className:C,children:[x,"/",_," ",b]})};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"claude-card p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Edit Profile"}),o.jsx("p",{className:"claude-text-secondary",children:"Update your public profile information"})]}),o.jsxs("form",{onSubmit:m,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),o.jsx("input",{type:"text",value:n.displayName,onChange:x=>a(_=>({..._,displayName:x.target.value})),placeholder:"Enter your display name",maxLength:h.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your username @",s?.slug," cannot be changed"]}),o.jsx(p,{current:n.displayName.length,max:h.displayName,label:"characters"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Bio"}),o.jsx("textarea",{value:n.bio,onChange:x=>a(_=>({..._,bio:x.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:h.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),o.jsx(p,{current:n.bio.length,max:h.bio,label:"characters"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),o.jsx("input",{type:"text",value:n.institution,onChange:x=>a(_=>({..._,institution:x.target.value})),placeholder:"University, company, or organization (optional)",maxLength:h.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{}),o.jsx(p,{current:n.institution.length,max:h.institution,label:"characters"})]})]}),o.jsxs("div",{className:"flex gap-4 pt-4",children:[o.jsx("button",{type:"submit",disabled:l,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?o.jsxs("span",{className:"flex items-center justify-center gap-2",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"}),o.jsx("button",{type:"button",onClick:t,disabled:l,className:"px-6 py-3 rounded-xl font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:x=>{l||(x.target.style.backgroundColor="var(--claude-surface-hover)")},onMouseLeave:x=>{l||(x.target.style.backgroundColor="var(--claude-subtle)")},children:"Cancel"})]})]})]})})},A3=({profileSlug:s,onClose:e})=>{const{user:t}=Cn(),[n,a]=P.useState(null),[l,u]=P.useState([]),[h,m]=P.useState(null),[p,x]=P.useState(null),[_,b]=P.useState({cardCount:0,friendCount:0}),[N,C]=P.useState(!0),[k,L]=P.useState("upvotes"),[F,U]=P.useState(!1),[B,H]=P.useState(null);P.useEffect(()=>{s&&$()},[s]),P.useEffect(()=>{n&&n.userId&&M()},[n,k]);const $=async()=>{C(!0);try{const z=await Ss.getProfileBySlug(s);if(!z)throw new Error("Profile not found");a(z)}catch(z){console.error("Error loading profile:",z),alert("Profile not found or error loading profile"),e&&e()}finally{C(!1)}},M=async()=>{try{const[z,oe,Y,be]=await Promise.all([R(),yn.getFriendCount(n.userId),t?yn.getFriendshipStatus(t.uid,n.userId):null,t?yn.getMutualFriends(t.uid,n.userId):null]);b({cardCount:z.length,friendCount:oe}),m(Y),x(be)}catch(z){console.error("Error loading profile data:",z)}},R=async()=>{try{const oe=(await is.getPublicFlashcardsByUser(n.userId)).sort((Y,be)=>{switch(k){case"upvotes":return(be.upvotes||0)-(Y.upvotes||0);case"date":return new Date(be.createdAt)-new Date(Y.createdAt);default:return 0}});return u(oe),oe}catch(z){return console.error("Error loading public cards:",z),[]}},T=async z=>{if(!t){alert("Please sign in to connect with friends");return}try{switch(z){case"send_request":await yn.sendFriendRequest(t.uid,n.userId),A("Friend request sent!");break;case"accept_request":await yn.acceptFriendRequest(h.receivedRequestId,n.userId,t.uid),A("Friend request accepted!");break;case"remove_friend":confirm(`Remove ${n.displayName} from your friends?`)&&(await yn.removeFriend(t.uid,n.userId),A("Friend removed"));break}const oe=await yn.getFriendshipStatus(t.uid,n.userId);m(oe);const Y=await yn.getFriendCount(n.userId);b(be=>({...be,friendCount:Y}))}catch(oe){console.error("Error with friend action:",oe),A("Failed to perform action",!0)}},A=(z,oe=!1)=>{const Y=document.createElement("div");Y.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",Y.style.backgroundColor=oe?"#ef4444":"#10b981",Y.textContent=z,document.body.appendChild(Y),setTimeout(()=>{Y.style.transform="translateX(0)"},100),setTimeout(()=>{Y.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(Y)},300)},3e3)},V=z=>z?z.split(" ").map(oe=>oe.charAt(0)).join("").toUpperCase().slice(0,2):"?",I=()=>!t||!h?null:h.areFriends?o.jsx("button",{onClick:()=>T("remove_friend"),className:"px-4 py-2 rounded-lg font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove Friend"}):h.sentRequest?o.jsx("span",{className:"px-4 py-2 rounded-lg font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):h.receivedRequest?o.jsx("button",{onClick:()=>T("accept_request"),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept Friend Request"}):o.jsx("button",{onClick:()=>T("send_request"),className:"px-4 py-2 rounded-lg font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}),G=z=>z?(z.toDate?z.toDate():new Date(z)).toLocaleDateString():"Unknown",O=z=>{a(z),U(!1),A("Profile updated successfully!")},Ve=()=>{U(!1)};if(N)return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading profile..."})]})})});if(!n)return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:"Profile not found"}),o.jsx("p",{className:"claude-text-secondary mb-4",children:"The profile you're looking for doesn't exist or has been removed."}),e&&o.jsx("button",{onClick:e,className:"claude-button-primary",children:"Go Back"})]})})});const ae=t&&t.uid===n.userId;return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e&&o.jsx("button",{onClick:e,className:"mb-4 px-4 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},children:" Back"}),o.jsx("div",{className:"claude-card p-8 mb-8",children:o.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[o.jsxs("div",{className:"text-center md:text-left",children:[o.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto md:mx-0 mb-4",style:{background:"var(--claude-accent)"},children:V(n.displayName)}),o.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:n.displayName||"Anonymous User"}),o.jsxs("p",{className:"claude-text-secondary text-lg mb-2",children:["@",n.slug]}),n.institution&&o.jsxs("p",{className:"claude-text-secondary",children:[" ",n.institution]})]}),o.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[n.bio&&o.jsx("div",{className:"mb-4",children:o.jsx("p",{className:"claude-text-primary",children:n.bio})}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent-blue)"},children:_.cardCount}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent)"},children:_.friendCount}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Friends"})]})]}),p&&p.total>0&&o.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[o.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--claude-heading)"},children:[p.total," mutual friend",p.total>1?"s":""]}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[p.profiles.map(z=>z.displayName).join(", "),p.hasMore&&` and ${p.total-p.profiles.length} more`]})]}),o.jsxs("div",{className:"flex gap-3",children:[I(),ae&&o.jsx("button",{onClick:()=>U(!0),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Edit Profile"})]})]})]})}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:["Public Flashcards (",_.cardCount,")"]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("label",{className:"text-sm font-medium",style:{color:"var(--claude-secondary-text)"},children:"Sort by:"}),o.jsxs("select",{value:k,onChange:z=>L(z.target.value),className:"px-3 py-1 rounded-lg border",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},children:[o.jsx("option",{value:"upvotes",children:"Upvotes"}),o.jsx("option",{value:"date",children:"Date Created"})]})]})]}),l.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No public flashcards"}),o.jsx("p",{className:"claude-text-secondary",children:ae?"You haven't shared any flashcards publicly yet.":`${n.displayName} hasn't shared any flashcards publicly yet.`})]}):o.jsx("div",{className:"grid gap-4",children:l.map(z=>o.jsxs("div",{className:"border rounded-xl p-6 transition-all hover:shadow-md",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)"},children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:z.statement||z.question||"Untitled Card"}),z.subject&&o.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 mb-2",children:z.subject}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:["Created ",G(z.createdAt)]})]}),o.jsxs("div",{className:"flex items-center gap-3 text-sm claude-text-secondary",children:[o.jsxs("span",{children:[" ",z.upvotes||0]}),o.jsxs("span",{children:[" ",z.viewCount||0]})]})]}),z.tags&&z.tags.length>0&&o.jsx("div",{className:"flex flex-wrap gap-2",children:z.tags.map((oe,Y)=>o.jsxs("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:"var(--claude-border)",color:"var(--claude-secondary-text)"},children:["#",oe]},Y))})]},z.id))})]}),F&&o.jsx(S3,{profile:n,onSave:O,onCancel:Ve})]})})},FE=({onDeckCreated:s,onClose:e,editingDeck:t=null})=>{const{user:n}=Cn(),[a,l]=P.useState({name:"",description:"",subject:"",difficulty:"beginner",tags:"",color:"#635BFF",icon:"",isPublic:!1}),[u,h]=P.useState(!1),[m,p]=P.useState(""),[x,_]=P.useState(!1),b=["#635BFF","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"],N=["","","","","","","","","","","","","","","",""],C=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Other"];P.useEffect(()=>{t&&l({name:t.name||"",description:t.description||"",subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:(t.tags||[]).join(", "),color:t.color||"#635BFF",icon:t.icon||"",isPublic:t.isPublic||!1})},[t]);const k=(F,U)=>{l(B=>({...B,[F]:U})),p("")},L=async F=>{if(F.preventDefault(),!n){p("Please sign in to create decks");return}if(!a.name.trim()){p("Deck name is required");return}h(!0),p("");try{const U={name:a.name.trim(),description:a.description.trim(),subject:a.subject,difficulty:a.difficulty,tags:a.tags.split(",").map(H=>H.trim()).filter(H=>H),color:a.color,icon:a.icon,isPublic:a.isPublic};if(a.isPublic){const H=await Ss.getUserSlug(n.uid);if(!H){p("You must create a profile before making public decks."),h(!1);return}U.authorSlug=H,U.slug=await as.generateUniqueSlug(a.name,H)}let B;t?(await as.updateDeck(t.id,U),B=t.id):B=await as.createDeck(n.uid,U),_(!0),setTimeout(()=>{s&&s(B),e&&e()},1500)}catch(U){console.error("Error saving deck:",U),p(U.message||"Failed to save deck. Please try again.")}finally{h(!1)}};return x?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-2xl font-bold claude-success mb-4",children:t?"Deck Updated!":"Deck Created!"}),o.jsxs("p",{className:"claude-text-secondary",children:["Your deck has been ",t?"updated":"created"," successfully."]})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:t?" Edit Deck":" Create New Deck"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:t?"Update your deck details":"Organize your flashcards into a themed collection"})]}),o.jsxs("form",{onSubmit:L,className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Basic Information"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck Name ",o.jsx("span",{className:"claude-error",children:"*"})]}),o.jsx("input",{type:"text",value:a.name,onChange:F=>k("name",F.target.value),placeholder:"e.g. Calculus I - Derivatives",className:"claude-input w-full",maxLength:100,required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Description"}),o.jsx("textarea",{value:a.description,onChange:F=>k("description",F.target.value),placeholder:"Brief description of what this deck covers...",className:"claude-input w-full h-24 resize-none",maxLength:300}),o.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:[a.description.length,"/300 characters"]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),o.jsxs("select",{value:a.subject,onChange:F=>k("subject",F.target.value),className:"claude-input w-full",children:[o.jsx("option",{value:"",children:"Select a subject"}),C.map(F=>o.jsx("option",{value:F,children:F},F))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Difficulty Level"}),o.jsxs("select",{value:a.difficulty,onChange:F=>k("difficulty",F.target.value),className:"claude-input w-full",children:[o.jsx("option",{value:"beginner",children:"Beginner"}),o.jsx("option",{value:"intermediate",children:"Intermediate"}),o.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),o.jsx("input",{type:"text",value:a.tags,onChange:F=>k("tags",F.target.value),placeholder:"e.g. calculus, derivatives, math (comma-separated)",className:"claude-input w-full"}),o.jsx("div",{className:"text-xs claude-text-muted mt-1",children:"Separate tags with commas"})]})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Appearance"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Color"}),o.jsx("div",{className:"flex flex-wrap gap-3",children:b.map(F=>o.jsx("button",{type:"button",onClick:()=>k("color",F),className:`w-12 h-12 rounded-xl border-4 transition-all duration-200 ${a.color===F?"border-white shadow-lg scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:F},title:F},F))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Icon"}),o.jsx("div",{className:"flex flex-wrap gap-3",children:N.map(F=>o.jsx("button",{type:"button",onClick:()=>k("icon",F),className:`w-12 h-12 rounded-xl text-2xl flex items-center justify-center transition-all duration-200 ${a.icon===F?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg scale-110":"claude-card hover:scale-105"}`,title:F,children:F},F))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Preview"}),o.jsxs("div",{className:"claude-card p-6 max-w-xs rounded-2xl shadow-lg",style:{borderLeft:`6px solid ${a.color}`},children:[o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{backgroundColor:a.color,color:"white"},children:a.icon}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold claude-text-primary",children:a.name||"Deck Name"}),o.jsx("p",{className:"text-sm claude-text-muted",children:a.subject||"Subject"})]})]}),a.description&&o.jsx("p",{className:"text-sm claude-text-secondary",children:a.description})]})]})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Privacy & Sharing"}),o.jsx("div",{className:"space-y-4",children:o.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:a.isPublic,onChange:F=>k("isPublic",F.target.checked),className:"w-5 h-5 rounded mt-1",style:{accentColor:"var(--claude-accent)",backgroundColor:a.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),o.jsxs("div",{children:[o.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this deck public"}),o.jsx("p",{className:"text-sm claude-text-muted mt-1",children:"Public decks can be discovered and imported by other users. You need a profile to create public decks."})]})]})})]}),m&&o.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:o.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[o.jsx("span",{children:""}),o.jsx("span",{children:m})]})}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&o.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{type:"submit",disabled:u||!a.name.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:u||!a.name.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:u?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t?"Updating...":"Creating..."]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:t?"":""}),t?"Update Deck":"Create Deck"]})})]})]})]})})},j3=({onCreateDeck:s,onEditDeck:e,onSelectDeck:t})=>{const{user:n}=Cn(),[a,l]=P.useState([]),[u,h]=P.useState(!0),[m,p]=P.useState(""),[x,_]=P.useState(""),[b,N]=P.useState("all");P.useEffect(()=>{n&&C()},[n]);const C=async()=>{try{h(!0),p("");const F=await as.getUserDecks(n.uid);l(F)}catch(F){console.error("Error loading decks:",F),p("Failed to load decks. Please try again.")}finally{h(!1)}},k=async(F,U)=>{if(window.confirm(`Are you sure you want to delete "${U}"? This action cannot be undone.`))try{await as.deleteDeck(F),l(a.filter(B=>B.id!==F))}catch(B){console.error("Error deleting deck:",B),p("Failed to delete deck. Please try again.")}},L=a.filter(F=>{const U=!x||F.name.toLowerCase().includes(x.toLowerCase())||F.description.toLowerCase().includes(x.toLowerCase())||F.subject&&F.subject.toLowerCase().includes(x.toLowerCase()),B=b==="all"||b==="public"&&F.isPublic||b==="private"&&!F.isPublic;return U&&B});return u?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading your decks..."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" My Decks"}),o.jsx("p",{className:"claude-text-secondary",children:"Organize and manage your flashcard collections"})]}),o.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary mt-4 md:mt-0 flex items-center gap-2",children:[o.jsx("span",{children:""}),"Create New Deck"]})]}),o.jsxs("div",{className:"claude-card p-6 mb-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[o.jsx("div",{className:"flex-1",children:o.jsx("input",{type:"text",value:x,onChange:F=>_(F.target.value),placeholder:"Search decks by name, subject, or description...",className:"claude-input w-full"})}),o.jsx("div",{className:"md:w-48",children:o.jsxs("select",{value:b,onChange:F=>N(F.target.value),className:"claude-input w-full",children:[o.jsx("option",{value:"all",children:"All Decks"}),o.jsx("option",{value:"private",children:"Private Only"}),o.jsx("option",{value:"public",children:"Public Only"})]})})]}),o.jsxs("div",{className:"flex flex-wrap gap-6 mt-4 pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.length}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Total Decks"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.reduce((F,U)=>F+(U.cardCount||0),0)}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Total Cards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:a.filter(F=>F.isPublic).length}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Public Decks"})]})]})]}),m&&o.jsx("div",{className:"p-4 rounded-2xl mb-6",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:o.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[o.jsx("span",{children:""}),o.jsx("span",{children:m})]})}),L.length===0?o.jsxs("div",{className:"claude-card p-12 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:x||b!=="all"?"No matching decks found":"No decks yet"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:x||b!=="all"?"Try adjusting your search or filter criteria":"Create your first deck to start organizing your flashcards"}),!x&&b==="all"&&o.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary flex items-center gap-2 mx-auto",children:[o.jsx("span",{children:""}),"Create Your First Deck"]})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:L.map(F=>o.jsx(I3,{deck:F,onEdit:()=>e&&e(F),onDelete:()=>k(F.id,F.name),onSelect:()=>t&&t(F)},F.id))})]})})},I3=({deck:s,onEdit:e,onDelete:t,onSelect:n})=>{const a=l=>l?(l.toDate?l.toDate():new Date(l)).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"Unknown";return o.jsxs("div",{className:"claude-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer relative group",style:{borderLeft:`6px solid ${s.color||"#635BFF"}`},onClick:()=>n&&n(),children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl text-white",style:{backgroundColor:s.color||"#635BFF"},children:s.icon||""}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"font-bold claude-text-primary truncate",children:s.name}),o.jsx("p",{className:"text-sm claude-text-muted",children:s.subject||"No subject"})]})]}),o.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:l=>{l.stopPropagation(),e()},className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 hover:text-gray-800",title:"Edit deck",children:""}),!s.isDefault&&o.jsx("button",{onClick:l=>{l.stopPropagation(),t()},className:"p-2 rounded-lg hover:bg-red-100 text-red-600 hover:text-red-800",title:"Delete deck",children:""})]})})]}),s.description&&o.jsx("p",{className:"text-sm claude-text-secondary mb-4 line-clamp-2",children:s.description}),o.jsxs("div",{className:"flex items-center justify-between text-sm claude-text-muted mb-4",children:[o.jsxs("span",{children:[s.cardCount||0," cards"]}),o.jsx("span",{children:s.difficulty||"Mixed"})]}),s.tags&&s.tags.length>0&&o.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[s.tags.slice(0,3).map((l,u)=>o.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${s.color||"#635BFF"}20`,color:s.color||"#635BFF"},children:l},u)),s.tags.length>3&&o.jsxs("span",{className:"px-2 py-1 rounded-full text-xs claude-text-muted",children:["+",s.tags.length-3]})]}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[o.jsxs("div",{className:"flex items-center gap-2",children:[s.isPublic&&o.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700",children:"Public"}),s.isDefault&&o.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700",children:"Default"})]}),o.jsx("span",{className:"text-xs claude-text-muted",children:a(s.updatedAt||s.createdAt)})]})]})},C3=({onClose:s})=>{const{user:e}=Cn(),[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState("week"),[m,p]=P.useState(!0),[x,_]=P.useState("overview");P.useEffect(()=>{e&&b()},[e,u]);const b=async()=>{try{p(!0);const[k,L]=await Promise.all([Cd.getUserAnalytics(e.uid),Cd.getUserInsights(e.uid,u)]);n(k),l(L)}catch(k){console.error("Error loading analytics:",k)}finally{p(!1)}},N=k=>{const L=Math.floor(k/3600),F=Math.floor(k%3600/60);return L>0?`${L}h ${F}m`:`${F}m`},C=k=>`${Math.round(k*100)}%`;return m?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading your analytics..."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" Learning Analytics"}),o.jsx("p",{className:"claude-text-secondary",children:"Track your progress, identify patterns, and optimize your learning"})]}),o.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[o.jsxs("select",{value:u,onChange:k=>h(k.target.value),className:"claude-input",children:[o.jsx("option",{value:"day",children:"Today"}),o.jsx("option",{value:"week",children:"This Week"}),o.jsx("option",{value:"month",children:"This Month"})]}),s&&o.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close"})]})]}),o.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"performance",label:" Performance",icon:""},{id:"insights",label:" Insights",icon:""},{id:"progress",label:" Progress",icon:""}].map(k=>o.jsxs("button",{onClick:()=>_(k.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===k.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[o.jsx("span",{className:"mr-2",children:k.icon}),o.jsx("span",{className:"hidden sm:inline",children:k.label.replace(/^.+\s/,"")})]},k.id))}),x==="overview"&&o.jsx(R3,{analytics:t,insights:a,formatTime:N,formatPercentage:C}),x==="performance"&&o.jsx(k3,{analytics:t,insights:a,formatPercentage:C}),x==="insights"&&o.jsx(D3,{insights:a,formatTime:N}),x==="progress"&&o.jsx(P3,{analytics:t,insights:a,formatPercentage:C})]})})},R3=({analytics:s,insights:e,formatTime:t,formatPercentage:n})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(Vf,{title:"Total Study Time",value:t(s?.totalStudyTime||0),icon:"",color:"blue",trend:e?.studyTimeTrend}),o.jsx(Vf,{title:"Study Sessions",value:s?.totalSessions||0,icon:"",color:"green"}),o.jsx(Vf,{title:"Overall Accuracy",value:n(s?.overallAccuracy||0),icon:"",color:"purple",trend:e?.accuracyTrend}),o.jsx(Vf,{title:"Study Streak",value:`${s?.studyStreak||0} days`,icon:"",color:"orange"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),o.jsxs("div",{className:"space-y-4",children:[s?.deckStats&&Object.entries(s.deckStats).slice(0,5).map(([a,l])=>o.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",children:["Deck ",a.slice(-6)]}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[l.sessions," sessions"]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"font-bold text-green-600",children:n(l.accuracy)}),o.jsx("div",{className:"text-sm claude-text-muted",children:t(l.studyTime)})]})]},a)),(!s?.deckStats||Object.keys(s.deckStats).length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No study activity yet. Start studying to see your progress!"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Performance Trends"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(BE,{label:"Accuracy Trend",value:e?.accuracyTrend||0,description:"How your accuracy has changed recently"}),o.jsx(BE,{label:"Study Time Trend",value:e?.studyTimeTrend||0,description:"How your study duration has changed"}),o.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"font-medium text-blue-800",children:"Mastery Progress"}),o.jsxs("div",{className:"text-sm text-blue-600 mb-2",children:["Overall understanding: ",n(e?.masteryProgress||0)]}),o.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(e?.masteryProgress||0)*100}%`}})})]})]})]})]})]}),k3=({analytics:s,insights:e,formatPercentage:t})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Subject Performance"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s?.subjectStats&&Object.entries(s.subjectStats).map(([n,a])=>o.jsxs("div",{className:"p-4 border rounded-lg",children:[o.jsx("div",{className:"font-medium mb-2",children:n||"General"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm claude-text-muted",children:"Accuracy:"}),o.jsx("span",{className:"font-medium",children:t(a.accuracy)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm claude-text-muted",children:"Mastery:"}),o.jsx("span",{className:"font-medium",children:t(a.masteryLevel||0)})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${a.accuracy*100}%`}})})]})]},n)),(!s?.subjectStats||Object.keys(s.subjectStats).length===0)&&o.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"No subject data available yet. Study more to see subject breakdown!"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Cards Needing Attention"}),o.jsx("div",{className:"space-y-4",children:e?.strugglingCards&&e.strugglingCards.length>0?e.strugglingCards.map((n,a)=>o.jsxs("div",{className:"flex items-center justify-between p-4 border-l-4 border-red-500 bg-red-50",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",children:["Card ",n.cardId.slice(-6)]}),o.jsxs("div",{className:"text-sm text-red-600",children:[n.totalReviews," attempts"]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-red-700 font-bold",children:t(n.accuracy)}),o.jsx("div",{className:"text-sm text-red-600",children:"accuracy"})]})]},n.cardId)):o.jsx("div",{className:"text-center py-8 text-green-600",children:" Great job! No cards need special attention right now."})})]})]}),D3=({insights:s,formatTime:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Personalized Recommendations"}),o.jsx("div",{className:"space-y-4",children:s?.recommendations&&s.recommendations.length>0?s.recommendations.map((t,n)=>o.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${t.priority==="high"?"border-red-500 bg-red-50":t.priority==="medium"?"border-yellow-500 bg-yellow-50":"border-blue-500 bg-blue-50"}`,children:[o.jsx("div",{className:`font-medium ${t.priority==="high"?"text-red-800":t.priority==="medium"?"text-yellow-800":"text-blue-800"}`,children:t.title}),o.jsx("div",{className:`text-sm mt-1 ${t.priority==="high"?"text-red-600":t.priority==="medium"?"text-yellow-600":"text-blue-600"}`,children:t.description})]},n)):o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"Keep studying to get personalized recommendations!"})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Optimal Study Time"}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:s?.optimalStudyTime==="morning"?"":s?.optimalStudyTime==="afternoon"?"":""}),o.jsx("div",{className:"text-lg font-medium capitalize",children:s?.optimalStudyTime||"Not enough data"}),o.jsx("div",{className:"text-sm claude-text-muted mt-2",children:"You perform best during this time"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Consistency Score"}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:[Math.round((s?.consistencyScore||0)*100),"%"]}),o.jsx("div",{className:"text-sm claude-text-muted",children:"How consistent your study sessions are"}),o.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-3",children:o.jsx("div",{className:"claude-gradient h-3 rounded-full transition-all duration-300",style:{width:`${(s?.consistencyScore||0)*100}%`}})})]})]})]})]}),P3=({analytics:s,insights:e,formatPercentage:t})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Learning Progress"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-success)"},children:t(e?.masteryProgress||0)}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Overall Mastery"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:s?.studyStreak||0}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Day Streak"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-warning)"},children:s?.longestStreak||0}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Longest Streak"})]})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Your Strongest Subjects"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e?.strongSubjects&&e.strongSubjects.length>0?e.strongSubjects.map((n,a)=>o.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border-2 border-green-200",children:[o.jsx("div",{className:"text-2xl mb-2",children:""}),o.jsx("div",{className:"font-medium text-green-800",children:n}),o.jsx("div",{className:"text-sm text-green-600",children:"Strong performance"})]},n)):o.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"Keep studying to identify your strongest subjects!"})})]})]}),Vf=({title:s,value:e,icon:t,color:n,trend:a})=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl relative overflow-hidden",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"text-2xl",children:t}),a!==void 0&&o.jsxs("div",{className:`text-sm font-medium ${a>0?"text-green-600":a<0?"text-red-600":"text-gray-600"}`,children:[a>0?"":a<0?"":""," ",Math.abs(a*100).toFixed(1),"%"]})]}),o.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),o.jsx("div",{className:"text-sm claude-text-muted",children:s})]}),BE=({label:s,value:e,description:t})=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:s}),o.jsx("div",{className:"text-sm claude-text-muted",children:t})]}),o.jsxs("div",{className:`text-right ${e>0?"text-green-600":e<0?"text-red-600":"text-gray-600"}`,children:[o.jsxs("div",{className:"font-bold",children:[e>0?"":e<0?"":""," ",Math.abs(e*100).toFixed(1),"%"]}),o.jsx("div",{className:"text-sm",children:e>0?"Improving":e<0?"Declining":"Stable"})]})]});class Fn{static async initializeSession(e=null){try{const t=this.generateSessionId(),n={sessionId:t,userId:e||null,startTime:Pe(),isActive:!0,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},referrer:document.referrer||null,initialUrl:window.location.href,pageViews:0,clicks:0,timeSpent:0,pagesVisited:[],actionsPerformed:[],isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isTablet:/iPad/i.test(navigator.userAgent),platform:navigator.platform};if(await Cs(ve(ee,"websiteSessions",t),n),localStorage.setItem("website_session_id",t),Nn)try{na(Nn,"session_start",{session_id:t,user_id:e,is_mobile:n.isMobile})}catch(a){console.warn("Firebase Analytics not available:",a)}return this.setupVisibilityTracking(t),this.setupUnloadTracking(t),t}catch(t){throw console.error("Error initializing session:",t),t}}static async trackPageView(e,t=null,n=null){try{const a=t||localStorage.getItem("website_session_id");if(!a)return;const l={sessionId:a,userId:n||null,page:e,url:window.location.href,timestamp:Pe(),referrer:document.referrer||null,timeOnPage:0,scrollDepth:0,interactions:0},u=await Qs(Ce(ee,"pageViews"),l),h=ve(ee,"websiteSessions",a);if(await $t(h,{pageViews:tm(1),pagesVisited:Bc(e),lastPageView:Pe(),currentPage:e}),Nn)try{na(Nn,"page_view",{page_title:document.title,page_location:window.location.href,session_id:a,user_id:n})}catch(m){console.warn("Firebase Analytics not available:",m)}return this.startPageTimeTracking(u.id,a),u.id}catch(a){console.error("Error tracking page view:",a)}}static async trackInteraction(e,t=null,n=null){try{const a=t||localStorage.getItem("website_session_id");if(!a)return;const l={sessionId:a,userId:n||null,timestamp:Pe(),page:window.location.pathname,...e};await Qs(Ce(ee,"interactions"),l);const u=ve(ee,"websiteSessions",a);if(await $t(u,{clicks:tm(1),actionsPerformed:Bc(e.action||"unknown"),lastActivity:Pe()}),Nn)try{na(Nn,"user_interaction",{action:e.action,element:e.element,session_id:a,user_id:n})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(a){console.error("Error tracking interaction:",a)}}static async trackScrollDepth(e,t=null){try{const n=t||localStorage.getItem("website_session_id");if(!n)return;const a=Le(Ce(ee,"pageViews"),Ye("sessionId","==",n),Jt("timestamp","desc"),Zt(1)),l=await Ke(a);if(!l.empty){const u=l.docs[0];await $t(u.ref,{scrollDepth:Math.max(e,u.data().scrollDepth||0)})}}catch(n){if(n.message&&(n.message.includes("requires an index")||n.message.includes("Missing or insufficient permissions")||n.message.includes("permission-denied")))return;console.error("Error tracking scroll depth:",n)}}static async trackFeatureUsage(e,t,n={},a=null){try{const l=localStorage.getItem("website_session_id"),u={sessionId:l,userId:a||null,feature:e,action:t,metadata:n,timestamp:Pe(),page:window.location.pathname};if(await Qs(Ce(ee,"featureUsage"),u),Nn)try{na(Nn,"feature_usage",{feature_name:e,action_type:t,session_id:l,user_id:a})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(l){console.error("Error tracking feature usage:",l)}}static async trackConversion(e,t=null,n=null){try{const a=localStorage.getItem("website_session_id"),l={sessionId:a,userId:n||null,conversionType:e,value:t,timestamp:Pe(),page:window.location.pathname};if(await Qs(Ce(ee,"conversions"),l),Nn)try{na(Nn,"conversion",{conversion_type:e,conversion_value:t,session_id:a,user_id:n})}catch(u){console.warn("Firebase Analytics not available:",u)}}catch(a){console.error("Error tracking conversion:",a)}}static async trackUserFlow(e,t,n="navigation",a=null){try{const u={sessionId:localStorage.getItem("website_session_id"),userId:a||null,fromPage:e,toPage:t,action:n,timestamp:Pe()};await Qs(Ce(ee,"userFlows"),u)}catch(l){console.error("Error tracking user flow:",l)}}static async trackClick(e,t={},n=null){try{await this.trackInteraction({action:"click",element:e,context:t,elementText:t.text||"",elementId:t.id||"",elementClass:t.className||""},null,n)}catch(a){console.error("Error tracking click:",a)}}static async trackFormInteraction(e,t,n=null,a=null){try{await this.trackInteraction({action:"form_interaction",element:"form",formName:e,formAction:t,field:n},null,a)}catch(l){console.error("Error tracking form interaction:",l)}}static startPageTimeTracking(e,t){window.pageTimeTracking||(window.pageTimeTracking={}),window.pageTimeTracking[e]={startTime:Date.now(),sessionId:t,pageViewId:e}}static async endPageTimeTracking(e){try{if(!window.pageTimeTracking||!window.pageTimeTracking[e])return;const t=window.pageTimeTracking[e],n=Math.round((Date.now()-t.startTime)/1e3),a=ve(ee,"pageViews",e);await $t(a,{timeOnPage:n});const l=ve(ee,"websiteSessions",t.sessionId);await $t(l,{timeSpent:tm(n)}),delete window.pageTimeTracking[e]}catch(t){console.error("Error ending page time tracking:",t)}}static async endSession(e=null){try{const t=e||localStorage.getItem("website_session_id");if(!t)return;if(window.pageTimeTracking)for(const a of Object.keys(window.pageTimeTracking))await this.endPageTimeTracking(a);const n=ve(ee,"websiteSessions",t);if(await $t(n,{endTime:Pe(),isActive:!1}),localStorage.removeItem("website_session_id"),Nn)try{na(Nn,"session_end",{session_id:t})}catch(a){console.warn("Firebase Analytics not available:",a)}}catch(t){console.error("Error ending session:",t)}}static async getAnalyticsSummary(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),a=Le(Ce(ee,"websiteSessions"),Ye("startTime",">=",n)),u=(await Ke(a)).docs.map(M=>({id:M.id,...M.data()})),h=Le(Ce(ee,"pageViews"),Ye("timestamp",">=",n)),p=(await Ke(h)).docs.map(M=>({id:M.id,...M.data()})),x=Le(Ce(ee,"interactions"),Ye("timestamp",">=",n)),b=(await Ke(x)).docs.map(M=>({id:M.id,...M.data()})),N=new Set(u.filter(M=>M.userId).map(M=>M.userId)).size,C=u.length,k=p.length,L=b.length,F=u.reduce((M,R)=>M+(R.timeSpent||0),0)/u.length,U=k/C,B={};p.forEach(M=>{const R=M.page||"unknown";B[R]||(B[R]={views:0,totalTime:0,interactions:0}),B[R].views++,B[R].totalTime+=M.timeOnPage||0}),b.forEach(M=>{const R=M.page||"unknown";B[R]&&B[R].interactions++});const H=Object.entries(B).map(([M,R])=>({page:M,...R,avgTimeOnPage:R.totalTime/R.views})).sort((M,R)=>R.views-M.views).slice(0,10),$={mobile:u.filter(M=>M.isMobile).length,tablet:u.filter(M=>M.isTablet).length,desktop:u.filter(M=>!M.isMobile&&!M.isTablet).length};return{summary:{uniqueUsers:N,totalSessions:C,totalPageViews:k,totalInteractions:L,avgSessionDuration:Math.round(F),avgPagesPerSession:Math.round(U*10)/10},popularPages:H,deviceStats:$,sessions:u,timeframe:e}}catch(t){throw console.error("Error getting analytics summary:",t),t}}static async getUserJourneyAnalytics(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),a=Le(Ce(ee,"userFlows"),Ye("timestamp",">=",n)),u=(await Ke(a)).docs.map(_=>({id:_.id,..._.data()})),h={};u.forEach(_=>{const b=`${_.fromPage}  ${_.toPage}`;h[b]=(h[b]||0)+1});const m=Object.entries(h).map(([_,b])=>({path:_,count:b})).sort((_,b)=>b.count-_.count).slice(0,10),p={},x={};return u.forEach(_=>{p[_.fromPage]=(p[_.fromPage]||0)+1,x[_.toPage]=(x[_.toPage]||0)+1}),{commonPaths:m,entryPoints:Object.entries(p).map(([_,b])=>({page:_,count:b})).sort((_,b)=>b.count-_.count).slice(0,5),exitPoints:Object.entries(x).map(([_,b])=>({page:_,count:b})).sort((_,b)=>b.count-_.count).slice(0,5)}}catch(t){throw console.error("Error getting user journey analytics:",t),t}}static generateSessionId(){return`ws_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static setupVisibilityTracking(e){let t=!document.hidden,n=Date.now();const a=()=>{const l=Date.now();if(document.hidden&&t){const u=l-n;this.trackInteraction({action:"page_hidden",element:"page",timeVisible:u},e),t=!1}else!document.hidden&&!t&&(this.trackInteraction({action:"page_visible",element:"page"},e),t=!0,n=l)};document.addEventListener("visibilitychange",a)}static setupUnloadTracking(e){const t=()=>{this.endSession(e)};window.addEventListener("beforeunload",t)}static setupScrollTracking(){let e=0,t;const n=()=>{const a=window.pageYOffset||document.documentElement.scrollTop,l=document.documentElement.scrollHeight-window.innerHeight,u=l>0?a/l*100:0;e=Math.max(e,u),clearTimeout(t),t=setTimeout(()=>{this.trackScrollDepth(Math.round(e))},1e3)};window.addEventListener("scroll",n,{passive:!0})}static setupAutoClickTracking(){document.addEventListener("click",e=>{const t=e.target.closest("[data-track]");if(t){const n={action:t.getAttribute("data-track"),text:t.textContent.trim(),id:t.id,className:t.className};this.trackClick(t.tagName.toLowerCase(),n)}})}static initializeAutoTracking(e=null){this.initializeSession(e),this.setupScrollTracking(),this.setupAutoClickTracking(),setTimeout(()=>{this.trackPageView(window.location.pathname,null,e)},100)}}const M3=({onClose:s})=>{const{user:e}=Cn(),[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState("week"),[m,p]=P.useState(!0),[x,_]=P.useState("overview"),[b,N]=P.useState({activeSessions:0,currentPageViews:0,recentInteractions:[]});P.useEffect(()=>{if(e){C();const F=setInterval(C,3e4);return()=>clearInterval(F)}},[e,u]);const C=async()=>{try{p(!0);const[F,U]=await Promise.all([Fn.getAnalyticsSummary(u),Fn.getUserJourneyAnalytics(u)]);n(F),l(U);const B=F.sessions.filter($=>$.isActive).length,H=F.sessions.flatMap($=>$.actionsPerformed||[]).slice(-10);N({activeSessions:B,currentPageViews:F.summary.totalPageViews,recentInteractions:H})}catch(F){console.error("Error loading analytics:",F)}finally{p(!1)}},k=F=>{const U=Math.floor(F/3600),B=Math.floor(F%3600/60),H=F%60;return U>0?`${U}h ${B}m ${H}s`:B>0?`${B}m ${H}s`:`${H}s`},L=F=>`${Math.round(F*100)}%`;return m?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading website analytics..."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:" Website Analytics"}),o.jsx("p",{className:"claude-text-secondary",children:"Track growth, engagement, and user behavior across your platform"})]}),o.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[o.jsxs("select",{value:u,onChange:F=>h(F.target.value),className:"claude-input",children:[o.jsx("option",{value:"day",children:"Today"}),o.jsx("option",{value:"week",children:"This Week"}),o.jsx("option",{value:"month",children:"This Month"})]}),o.jsx("button",{onClick:C,className:"claude-button-secondary",children:" Refresh"}),s&&o.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close"})]})]}),o.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),o.jsx("span",{className:"font-medium",children:"Live Now"})]}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[b.activeSessions," active sessions  ",b.currentPageViews," page views today"]})]}),o.jsxs("div",{className:"text-xs claude-text-muted",children:["Last updated: ",new Date().toLocaleTimeString()]})]})}),o.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"traffic",label:" Traffic",icon:""},{id:"engagement",label:" Engagement",icon:""},{id:"journeys",label:" User Journeys",icon:""},{id:"realtime",label:" Real-time",icon:""}].map(F=>o.jsxs("button",{onClick:()=>_(F.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===F.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[o.jsx("span",{className:"mr-2",children:F.icon}),o.jsx("span",{className:"hidden sm:inline",children:F.label.replace(/^.+\s/,"")})]},F.id))}),x==="overview"&&o.jsx(O3,{analytics:t,formatDuration:k,formatPercentage:L}),x==="traffic"&&o.jsx(V3,{analytics:t,formatDuration:k}),x==="engagement"&&o.jsx(L3,{analytics:t,formatDuration:k}),x==="journeys"&&o.jsx(U3,{userJourney:a}),x==="realtime"&&o.jsx(F3,{realTimeData:b,analytics:t})]})})},O3=({analytics:s,formatDuration:e,formatPercentage:t})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(Dr,{title:"Unique Users",value:s?.summary?.uniqueUsers||0,icon:"",color:"blue",description:"Distinct users this period"}),o.jsx(Dr,{title:"Total Sessions",value:s?.summary?.totalSessions||0,icon:"",color:"green",description:"User sessions tracked"}),o.jsx(Dr,{title:"Page Views",value:s?.summary?.totalPageViews||0,icon:"",color:"purple",description:"Total pages visited"}),o.jsx(Dr,{title:"Avg Session Duration",value:e(s?.summary?.avgSessionDuration||0),icon:"",color:"orange",description:"Average time per session"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Popular Pages"}),o.jsxs("div",{className:"space-y-4",children:[s?.popularPages?.slice(0,8).map((n,a)=>o.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-bold text-blue-800",children:a+1}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:n.page}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[n.views," views"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"font-bold text-blue-600",children:e(n.avgTimeOnPage||0)}),o.jsx("div",{className:"text-sm claude-text-muted",children:"avg time"})]})]},n.page)),(!s?.popularPages||s.popularPages.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No page data available yet"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Device Breakdown"}),o.jsx("div",{className:"space-y-4",children:s?.deviceStats&&Object.entries(s.deviceStats).map(([n,a])=>{const l=Object.values(s.deviceStats).reduce((m,p)=>m+p,0),u=l>0?a/l*100:0,h=n==="mobile"?"":n==="tablet"?"":"";return o.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:h}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium capitalize",children:n}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[a," sessions"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"font-bold text-green-600",children:[Math.round(u),"%"]}),o.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2 mt-1",children:o.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})]})]},n)})})]})]})]}),V3=({analytics:s,formatDuration:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsx(Dr,{title:"Pages per Session",value:s?.summary?.avgPagesPerSession||0,icon:"",color:"blue",description:"Average pages viewed per session"}),o.jsx(Dr,{title:"Total Interactions",value:s?.summary?.totalInteractions||0,icon:"",color:"green",description:"Total clicks and interactions"}),o.jsx(Dr,{title:"Bounce Rate",value:`${Math.round(((s?.summary?.totalSessions-s?.summary?.totalPageViews)/s?.summary?.totalSessions||0)*100)}%`,icon:"",color:"orange",description:"Single page sessions"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Detailed Page Analytics"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"border-b",children:[o.jsx("th",{className:"text-left py-3 px-4 font-medium claude-text-secondary",children:"Page"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Views"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Avg Time"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Interactions"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Engagement"})]})}),o.jsx("tbody",{children:s?.popularPages?.map((t,n)=>{const a=t.views>0?t.interactions/t.views*100:0;return o.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[o.jsx("td",{className:"py-3 px-4",children:o.jsx("div",{className:"font-medium",children:t.page})}),o.jsx("td",{className:"text-right py-3 px-4 font-medium",children:t.views}),o.jsx("td",{className:"text-right py-3 px-4",children:e(t.avgTimeOnPage||0)}),o.jsx("td",{className:"text-right py-3 px-4",children:t.interactions}),o.jsx("td",{className:"text-right py-3 px-4",children:o.jsxs("span",{className:`font-medium ${a>50?"text-green-600":a>20?"text-yellow-600":"text-red-600"}`,children:[Math.round(a),"%"]})})]},t.page)})})]})})]})]}),L3=({analytics:s,formatDuration:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(Dr,{title:"Click Rate",value:`${Math.round((s?.summary?.totalInteractions/s?.summary?.totalPageViews||0)*100)}%`,icon:"",color:"blue",description:"Interactions per page view"}),o.jsx(Dr,{title:"Session Depth",value:s?.summary?.avgPagesPerSession||0,icon:"",color:"green",description:"Pages explored per session"}),o.jsx(Dr,{title:"Return Rate",value:`${Math.round((s?.summary?.uniqueUsers/s?.summary?.totalSessions||0)*100)}%`,icon:"",color:"purple",description:"Users who return"}),o.jsx(Dr,{title:"Engagement Score",value:Math.round((s?.summary?.avgSessionDuration||0)/60*(s?.summary?.avgPagesPerSession||0)),icon:"",color:"orange",description:"Overall engagement rating"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Engaging Content"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s?.popularPages?.slice(0,6).map((t,n)=>{const a=(t.avgTimeOnPage||0)*(t.interactions||0)/100;return o.jsxs("div",{className:"p-4 border rounded-lg hover:border-blue-500 transition-colors",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsx("h4",{className:"font-medium",children:t.page}),o.jsxs("span",{className:"text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["#",n+1]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Time on Page"}),o.jsx("div",{className:"font-medium",children:e(t.avgTimeOnPage||0)})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Interactions"}),o.jsx("div",{className:"font-medium",children:t.interactions||0})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Views"}),o.jsx("div",{className:"font-medium",children:t.views})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Engagement"}),o.jsx("div",{className:"font-medium text-green-600",children:Math.round(a)})]})]})]},t.page)})})]})]}),U3=({userJourney:s})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Most Common User Paths"}),o.jsxs("div",{className:"space-y-4",children:[s?.commonPaths?.slice(0,8).map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-800",children:t+1}),o.jsx("div",{className:"font-mono text-sm",children:e.path})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"font-bold text-purple-600",children:e.count}),o.jsx("div",{className:"text-sm claude-text-muted",children:"transitions"})]})]},e.path)),(!s?.commonPaths||s.commonPaths.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No user journey data available yet"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Top Entry Points"}),o.jsxs("div",{className:"space-y-3",children:[s?.entryPoints?.map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[o.jsx("div",{className:"font-medium",children:e.page}),o.jsx("div",{className:"text-green-700 font-bold",children:e.count})]},e.page)),(!s?.entryPoints||s.entryPoints.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No entry data"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Top Exit Points"}),o.jsxs("div",{className:"space-y-3",children:[s?.exitPoints?.map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[o.jsx("div",{className:"font-medium",children:e.page}),o.jsx("div",{className:"text-red-700 font-bold",children:e.count})]},e.page)),(!s?.exitPoints||s.exitPoints.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No exit data"})]})]})]})]}),F3=({realTimeData:s,analytics:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full animate-pulse"}),o.jsx("h3",{className:"font-bold text-green-800",children:"Active Now"})]}),o.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:s.activeSessions}),o.jsx("div",{className:"text-sm text-green-700",children:"Active sessions"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsx("h3",{className:"font-bold text-blue-800",children:"Page Views"})]}),o.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:s.currentPageViews}),o.jsx("div",{className:"text-sm text-blue-700",children:"Total today"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsx("h3",{className:"font-bold text-purple-800",children:"Interactions"})]}),o.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:e?.summary?.totalInteractions||0}),o.jsx("div",{className:"text-sm text-purple-700",children:"Total clicks"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Recent Activity"}),o.jsxs("div",{className:"space-y-3",children:[s.recentInteractions.slice(0,10).map((t,n)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),o.jsx("span",{className:"font-medium",children:t})]}),o.jsx("span",{className:"text-sm claude-text-muted",children:"Just now"})]},n)),s.recentInteractions.length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No recent interactions"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:" Active Sessions Detail"}),o.jsxs("div",{className:"space-y-4",children:[e?.sessions?.filter(t=>t.isActive).slice(0,5).map((t,n)=>o.jsxs("div",{className:"p-4 border rounded-lg",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{className:"font-medium",children:["Session ",t.sessionId.slice(-6)]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),o.jsx("span",{className:"text-sm text-green-600",children:"Active"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Device"}),o.jsx("div",{children:t.isMobile?" Mobile":t.isTablet?" Tablet":" Desktop"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Page Views"}),o.jsx("div",{children:t.pageViews||0})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Duration"}),o.jsxs("div",{children:[Math.round((t.timeSpent||0)/60),"m"]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Current Page"}),o.jsx("div",{className:"truncate",children:t.currentPage||"Unknown"})]})]})]},t.sessionId)),e?.sessions?.filter(t=>t.isActive).length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No active sessions"})]})]})]}),Dr=({title:s,value:e,icon:t,color:n,description:a})=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("div",{className:"flex items-center justify-between mb-4",children:o.jsx("div",{className:"text-2xl",children:t})}),o.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),o.jsx("div",{className:"text-sm font-medium mb-1",children:s}),a&&o.jsx("div",{className:"text-xs claude-text-muted",children:a})]});class Ir{static ADMIN_EMAILS=["three.dash.sided@gmail.com"];static isAdmin(e){return!e||!e.email?!1:this.ADMIN_EMAILS.includes(e.email)}static async getAdminStatus(e){try{const n=(await vt(ve(ee,"users",e))).data();return{isAdmin:n?.isAdmin||!1,adminLevel:n?.adminLevel||"none",permissions:n?.adminPermissions||[]}}catch(t){return console.error("Error getting admin status:",t),{isAdmin:!1,adminLevel:"none",permissions:[]}}}static async verifyAdminAccess(e){return!e||!this.isAdmin(e)?!1:(await this.getAdminStatus(e.uid)).isAdmin}static async getAllUsers(e=100){try{const t=Le(Ce(ee,"users"),Jt("createdAt","desc"),Zt(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await vt(l(ee,"profiles",l.id));m.exists()&&(h=m.data())}catch{console.warn("Could not load profile for user:",l.id)}a.push({id:l.id,...u,profile:h,displayName:h.displayName||u.displayName||u.email?.split("@")[0]||"Unknown",joinDate:u.createdAt?.toDate?.()||new Date,lastSeen:u.lastLogin?.toDate?.()||u.createdAt?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting all users:",t),t}}static async updateUserPremium(e,t){try{return await $t(ve(ee,"users",e),{isPremium:t,premiumUpdatedAt:new Date,premiumUpdatedBy:"admin"}),!0}catch(n){throw console.error("Error updating user premium status:",n),n}}static async updateUserAdmin(e,t,n="admin"){try{const a={isAdmin:t,adminUpdatedAt:new Date,adminUpdatedBy:"super_admin"};return t?(a.adminLevel=n,a.adminPermissions=this.getDefaultPermissions(n)):(a.adminLevel="none",a.adminPermissions=[]),await $t(ve(ee,"users",e),a),!0}catch(a){throw console.error("Error updating user admin status:",a),a}}static getDefaultPermissions(e){switch(e){case"super":return["user_management","content_moderation","system_settings","analytics_access","data_export","admin_management"];case"admin":return["user_management","content_moderation","analytics_access"];case"moderator":return["content_moderation"];default:return[]}}static async getPublicCardsForModeration(e=50){try{const t=Le(Ce(ee,"publicCards"),Jt("createdAt","desc"),Zt(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{if(u.userId){const m=await vt(l(ee,"users",u.userId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}}catch{console.warn("Could not load author info for card:",l.id)}a.push({id:l.id,...u,author:h,createdDate:u.createdAt?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting public cards:",t),t}}static async moderateCard(e,t,n=""){try{const a={moderatedAt:new Date,moderatedBy:"admin",moderationAction:t,moderationReason:n};return t==="hide"?a.isHidden=!0:t==="remove"&&(a.isRemoved=!0),await $t(ve(ee,"publicCards",e),a),!0}catch(a){throw console.error("Error moderating card:",a),a}}static async getSystemStats(){try{const[e,t,n]=await Promise.all([Ke(Ce(ee,"users")),Ke(Ce(ee,"cards")),Ke(Ce(ee,"publicCards"))]),a=e.docs.map(C=>C.data()),l=a.length,u=a.filter(C=>C.isPremium).length,h=a.filter(C=>C.isAdmin).length,m=new Date(Date.now()-10080*60*1e3),p=a.filter(C=>C.createdAt?.toDate?.()>m||C.lastLogin?.toDate?.()>m).length,x=t.size,_=n.size,N=n.docs.map(C=>C.data()).filter(C=>C.createdAt?.toDate?.()>m).length;return{users:{total:l,premium:u,admin:h,recentlyActive:p,conversionRate:l>0?(u/l*100).toFixed(1):0},content:{totalPrivateCards:x,totalPublicCards:_,totalCards:x+_,recentPublicCards:N,avgCardsPerUser:l>0?((x+_)/l).toFixed(1):0},system:{lastUpdated:new Date,status:"operational"}}}catch(e){throw console.error("Error getting system stats:",e),e}}static async logAdminAction(e,t,n={}){try{await Qs(Ce(ee,"adminLogs"),{adminUserId:e,action:t,details:n,timestamp:new Date,userAgent:navigator.userAgent,ip:null})}catch(a){console.error("Error logging admin action:",a)}}static async getAdminActivity(e=50){try{const t=Le(Ce(ee,"adminLogs"),Jt("timestamp","desc"),Zt(e)),n=await Ke(t),a=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await vt(l(ee,"users",u.adminUserId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}catch{console.warn("Could not load admin info for log:",l.id)}a.push({id:l.id,...u,admin:h,timestamp:u.timestamp?.toDate?.()||new Date})}return a}catch(t){throw console.error("Error getting admin activity:",t),t}}}const B3=()=>{const[s,e]=P.useState([]),[t,n]=P.useState(!1),[a,l]=P.useState(0),[u,h]=P.useState(new Set),m=async()=>{n(!0);try{const C=(await Mi(Ua,"findBrokenCards")()).data;e(C.brokenCards||[]),l(C.totalCards||0)}catch(b){console.error("Error finding broken cards:",b),alert(` Failed to find broken cards: ${b.message}`)}finally{n(!1)}},p=async(b,N)=>{if(confirm(`Are you sure you want to delete this card?

ID: ${b}
Slug: ${N||"MISSING"}

This action cannot be undone.`)){h(C=>new Set(C).add(b));try{await Mi(Ua,"deleteCard")({cardId:b,cardSlug:N}),e(k=>k.filter(L=>L.id!==b))}catch(C){console.error("Error deleting card:",C),alert(` Failed to delete card: ${C.message}`)}finally{h(C=>{const k=new Set(C);return k.delete(b),k})}}},x=b=>{if(!b)return"Unknown";try{const N=b.toDate?b.toDate():new Date(b);return N.toLocaleDateString()+" "+N.toLocaleTimeString()}catch{return"Invalid date"}},_=async()=>{if(s.length===0||!confirm(` DANGER: Delete ALL ${s.length} broken cards?

This will permanently delete all cards with missing/broken slugs.

This action cannot be undone. Are you absolutely sure?`))return;n(!0);let b=0,N=0;for(const C of s)try{await Mi(Ua,"deleteCard")({cardId:C.id,cardSlug:C.slug}),b++}catch(k){console.error(`Failed to delete card ${C.id}:`,k),N++}e([]),n(!1),alert(` Bulk delete completed!

 Deleted: ${b}
 Failed: ${N}`)};return P.useEffect(()=>{m()},[]),o.jsx("div",{className:"space-y-6",children:o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:" Broken Cards Review"}),o.jsx("button",{onClick:m,disabled:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Searching...":" Refresh"})]}),o.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a}),o.jsx("div",{className:"text-sm text-gray-600",children:"Total Cards"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.length}),o.jsx("div",{className:"text-sm text-gray-600",children:"Broken Cards"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:a-s.length}),o.jsx("div",{className:"text-sm text-gray-600",children:"Healthy Cards"})]})]})}),s.length>0&&o.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("h4",{className:"font-medium text-yellow-800",children:[" Found ",s.length," broken cards"]}),o.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:'These cards have missing or invalid slugs and show as "undefined" when users try to view them.'})]}),o.jsx("button",{onClick:_,disabled:t,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:" Delete All Broken"})]})}),t&&s.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),o.jsx("p",{className:"text-gray-600 mt-2",children:"Searching for broken cards..."})]}):s.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-2",children:""}),o.jsx("h4",{className:"text-lg font-medium text-green-600 mb-1",children:"No broken cards found!"}),o.jsx("p",{className:"text-gray-600",children:"All cards have valid slugs and are working properly."})]}):o.jsx("div",{className:"space-y-4",children:s.map(b=>o.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded text-red-600",children:["ID: ",b.id]}),o.jsxs("span",{className:"text-sm font-mono bg-red-100 px-2 py-1 rounded text-red-700",children:["Slug: ",b.slug||"MISSING"]}),b.isBotPost&&o.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:" Bot Post"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{children:[o.jsx("strong",{className:"text-sm text-gray-700",children:"Statement:"}),o.jsx("p",{className:"text-sm text-gray-900 mt-1 bg-gray-50 p-2 rounded",children:b.statement.length>200?b.statement.substring(0,200)+"...":b.statement})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-gray-600",children:[o.jsxs("div",{children:[o.jsx("strong",{children:"Views:"})," ",b.viewCount]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Likes:"})," ",b.likeCount]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Author:"})," ",b.authorId?.substring(0,8)||"Unknown","..."]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Created:"})," ",x(b.createdAt)]})]})]})]}),o.jsx("button",{onClick:()=>p(b.id,b.slug),disabled:u.has(b.id),className:"ml-4 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 flex items-center gap-1",children:u.has(b.id)?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Deleting..."]}):o.jsx(o.Fragment,{children:" Delete"})})]})},b.id))})]})})},q3=()=>{const[s,e]=P.useState([]),[t,n]=P.useState(!0),[a,l]=P.useState(!0);P.useEffect(()=>{if(!a)return;const b=Le(Ce(ee,"automationLogs"),Jt("timestamp","desc"),Zt(50)),N=Im(b,C=>{const k=C.docs.map(L=>({id:L.id,...L.data(),timestamp:L.data().timestamp?.toDate()}));e(k),n(!1)},C=>{console.error("Error listening to automation logs:",C),n(!1)});return()=>N()},[a]);const u=b=>b?b.toLocaleString():"Unknown",h=b=>{switch(b){case"started":return"";case"step_success":return"";case"step_failed":return"";case"success":return"";case"failed":return"";case"skipped":return"";case"retry_scheduled":return"";case"retrying":return"";default:return""}},m=b=>{switch(b){case"started":return"text-blue-600 bg-blue-50 border-blue-200";case"step_success":return"text-green-600 bg-green-50 border-green-200";case"step_failed":return"text-red-600 bg-red-50 border-red-200";case"success":return"text-green-700 bg-green-100 border-green-300";case"failed":return"text-red-700 bg-red-100 border-red-300";case"skipped":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"retry_scheduled":return"text-orange-600 bg-orange-50 border-orange-200";case"retrying":return"text-blue-700 bg-blue-100 border-blue-300";default:return"text-gray-600 bg-gray-50 border-gray-200"}},p=b=>{const N=s.filter(U=>U.details?.runId===b);if(N.length===0)return{total:0,completed:0,status:"unknown"};const C=N.some(U=>U.status==="started"),k=N.some(U=>U.status==="success"),L=N.some(U=>U.status==="failed"),F=N.filter(U=>U.status==="step_success").length;return{total:C?6:0,completed:F,status:L?"failed":k?"success":C?"running":"unknown"}},x=s.reduce((b,N)=>{const C=N.details?.runId||"unknown";return b[C]||(b[C]=[]),b[C].push(N),b},{}),_=Object.entries(x).sort((b,N)=>{const C=Math.max(...b[1].map(L=>L.timestamp?.getTime()||0));return Math.max(...N[1].map(L=>L.timestamp?.getTime()||0))-C});return t?o.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),o.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Loading Automation Monitor..."})]})}):o.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:" Automation Monitor"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:`h-2 w-2 rounded-full ${a?"bg-green-500 animate-pulse":"bg-gray-400"}`}),o.jsx("span",{className:"text-sm text-gray-600",children:a?"Live":"Paused"}),o.jsx("button",{onClick:()=>l(!a),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${a?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a?"Pause":"Resume"})]})]}),s.length===0?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-2",children:""}),o.jsx("h4",{className:"text-lg font-medium text-gray-600 mb-1",children:"No automation logs yet"}),o.jsx("p",{className:"text-gray-500",children:"Logs will appear here when the automation runs"})]}):o.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:_.slice(0,10).map(([b,N])=>{const C=p(b),k=N[0],L=k.timestamp&&Date.now()-k.timestamp.getTime()<300*1e3;return o.jsxs("div",{className:`border rounded-lg p-4 ${L?"ring-2 ring-blue-200 border-blue-300":"border-gray-200"}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:[b.substring(0,12),"..."]}),o.jsxs("span",{className:`text-xs px-2 py-1 rounded border ${m(C.status)}`,children:[h(C.status)," ",C.status.toUpperCase()]}),C.total>0&&o.jsxs("span",{className:"text-xs text-gray-500",children:[C.completed,"/",C.total," steps"]})]}),o.jsx("span",{className:"text-xs text-gray-500",children:u(k.timestamp)})]}),C.total>0&&o.jsx("div",{className:"mb-3",children:o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${C.status==="failed"?"bg-red-500":C.status==="success"?"bg-green-500":"bg-blue-500"}`,style:{width:`${C.completed/C.total*100}%`}})})}),o.jsxs("div",{className:"space-y-1",children:[N.slice(0,3).map((F,U)=>o.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[o.jsx("span",{className:"text-xs",children:h(F.status)}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"text-gray-700",children:F.details?.message||"No message"}),F.details?.error&&o.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Error: ",F.details.error]}),F.details?.step&&o.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["[",F.details.step,"]"]})]}),o.jsx("span",{className:"text-xs text-gray-400",children:u(F.timestamp)})]},F.id)),N.length>3&&o.jsxs("div",{className:"text-xs text-gray-500 pl-4",children:["+",N.length-3," more logs..."]})]})]},b)})}),o.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:o.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[o.jsx("span",{children:"Showing last 50 automation logs"}),o.jsx("span",{children:"Updates automatically every few seconds"})]})})]})};class ki{static async getBotAccounts(){try{const e=Ce(ee,"botAccounts");return(await Ke(e)).docs.map(n=>({id:n.id,...n.data()}))}catch(e){throw console.error("Error getting bot accounts:",e),e}}static async getAutomationSettings(){try{const e=ve(ee,"automation","settings"),t=await vt(e);return t.exists()?t.data():{enabled:!1,interval:24,maxPostsPerDay:5,tags:["math","mathematics"],subjects:["mathematics"]}}catch(e){throw console.error("Error getting automation settings:",e),e}}static async updateAutomationSettings(e){try{const t=ve(ee,"automation","settings");await Cs(t,{...e,updatedAt:Pe()})}catch(t){throw console.error("Error updating automation settings:",t),t}}static async createBotAccount(e){try{const t=ve(Ce(ee,"botAccounts"));return await Cs(t,{...e,createdAt:Pe(),isActive:!0}),t.id}catch(t){throw console.error("Error creating bot account:",t),t}}static async deleteBotAccount(e){try{const t=ve(ee,"botAccounts",e);await Ko(t)}catch(t){throw console.error("Error deleting bot account:",t),t}}}/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:vI,setPrototypeOf:qE,isFrozen:z3,getPrototypeOf:H3,getOwnPropertyDescriptor:G3}=Object;let{freeze:gs,seal:xr,create:bI}=Object,{apply:Rx,construct:kx}=typeof Reflect<"u"&&Reflect;gs||(gs=function(e){return e});xr||(xr=function(e){return e});Rx||(Rx=function(e,t,n){return e.apply(t,n)});kx||(kx=function(e,t){return new e(...t)});const Lf=ps(Array.prototype.forEach),$3=ps(Array.prototype.lastIndexOf),zE=ps(Array.prototype.pop),ld=ps(Array.prototype.push),K3=ps(Array.prototype.splice),rm=ps(String.prototype.toLowerCase),Fy=ps(String.prototype.toString),HE=ps(String.prototype.match),cd=ps(String.prototype.replace),Q3=ps(String.prototype.indexOf),Y3=ps(String.prototype.trim),Cr=ps(Object.prototype.hasOwnProperty),ms=ps(RegExp.prototype.test),ud=X3(TypeError);function ps(s){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return Rx(s,e,n)}}function X3(s){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return kx(s,t)}}function at(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rm;qE&&qE(s,null);let n=e.length;for(;n--;){let a=e[n];if(typeof a=="string"){const l=t(a);l!==a&&(z3(e)||(e[n]=l),a=l)}s[a]=!0}return s}function W3(s){for(let e=0;e<s.length;e++)Cr(s,e)||(s[e]=null);return s}function Da(s){const e=bI(null);for(const[t,n]of vI(s))Cr(s,t)&&(Array.isArray(n)?e[t]=W3(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=Da(n):e[t]=n);return e}function dd(s,e){for(;s!==null;){const n=G3(s,e);if(n){if(n.get)return ps(n.get);if(typeof n.value=="function")return ps(n.value)}s=H3(s)}function t(){return null}return t}const GE=gs(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),By=gs(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),qy=gs(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),J3=gs(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),zy=gs(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Z3=gs(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),$E=gs(["#text"]),KE=gs(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Hy=gs(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),QE=gs(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Uf=gs(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),e6=xr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),t6=xr(/<%[\w\W]*|[\w\W]*%>/gm),n6=xr(/\$\{[\w\W]*/gm),s6=xr(/^data-[\-\w.\u00B7-\uFFFF]+$/),r6=xr(/^aria-[\-\w]+$/),_I=xr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),a6=xr(/^(?:\w+script|data):/i),i6=xr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),wI=xr(/^html$/i),o6=xr(/^[a-z][.\w]*(-[.\w]+)+$/i);var YE=Object.freeze({__proto__:null,ARIA_ATTR:r6,ATTR_WHITESPACE:i6,CUSTOM_ELEMENT:o6,DATA_ATTR:s6,DOCTYPE_NAME:wI,ERB_EXPR:t6,IS_ALLOWED_URI:_I,IS_SCRIPT_OR_DATA:a6,MUSTACHE_EXPR:e6,TMPLIT_EXPR:n6});const hd={element:1,text:3,progressingInstruction:7,comment:8,document:9},l6=function(){return typeof window>"u"?null:window},c6=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const a="data-tt-policy-suffix";t&&t.hasAttribute(a)&&(n=t.getAttribute(a));const l="dompurify"+(n?"#"+n:"");try{return e.createPolicy(l,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},XE=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function TI(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:l6();const e=De=>TI(De);if(e.version="3.2.6",e.removed=[],!s||!s.document||s.document.nodeType!==hd.document||!s.Element)return e.isSupported=!1,e;let{document:t}=s;const n=t,a=n.currentScript,{DocumentFragment:l,HTMLTemplateElement:u,Node:h,Element:m,NodeFilter:p,NamedNodeMap:x=s.NamedNodeMap||s.MozNamedAttrMap,HTMLFormElement:_,DOMParser:b,trustedTypes:N}=s,C=m.prototype,k=dd(C,"cloneNode"),L=dd(C,"remove"),F=dd(C,"nextSibling"),U=dd(C,"childNodes"),B=dd(C,"parentNode");if(typeof u=="function"){const De=t.createElement("template");De.content&&De.content.ownerDocument&&(t=De.content.ownerDocument)}let H,$="";const{implementation:M,createNodeIterator:R,createDocumentFragment:T,getElementsByTagName:A}=t,{importNode:V}=n;let I=XE();e.isSupported=typeof vI=="function"&&typeof B=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:G,ERB_EXPR:O,TMPLIT_EXPR:Ve,DATA_ATTR:ae,ARIA_ATTR:z,IS_SCRIPT_OR_DATA:oe,ATTR_WHITESPACE:Y,CUSTOM_ELEMENT:be}=YE;let{IS_ALLOWED_URI:D}=YE,se=null;const xe=at({},[...GE,...By,...qy,...zy,...$E]);let ue=null;const Ie=at({},[...KE,...Hy,...QE,...Uf]);let pe=Object.seal(bI(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ne=null,ce=null,_e=!0,Se=!0,Ue=!1,Ze=!0,Ge=!1,lt=!0,ze=!1,Qe=!1,gt=!1,ct=!1,It=!1,Hn=!1,an=!0,Gn=!1;const br="user-content-";let ks=!0,Ds=!1,Ps={},wt=null;const pt=at({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Zn=null;const vn=at({},["audio","video","img","source","image","track"]);let Xa=null;const fl=at({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Js="http://www.w3.org/1998/Math/MathML",Zs="http://www.w3.org/2000/svg",$n="http://www.w3.org/1999/xhtml";let Rn=$n,Lr=!1,_r=null;const so=at({},[Js,Zs,$n],Fy);let Ur=at({},["mi","mo","mn","ms","mtext"]),Fr=at({},["annotation-xml"]);const wr=at({},["title","style","font","a","script"]);let cs=null;const ro=["application/xhtml+xml","text/html"],er="text/html";let qt=null,us=null;const Wa=t.createElement("form"),Tr=function(Q){return Q instanceof RegExp||Q instanceof Function},Ja=function(){let Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(us&&us===Q)){if((!Q||typeof Q!="object")&&(Q={}),Q=Da(Q),cs=ro.indexOf(Q.PARSER_MEDIA_TYPE)===-1?er:Q.PARSER_MEDIA_TYPE,qt=cs==="application/xhtml+xml"?Fy:rm,se=Cr(Q,"ALLOWED_TAGS")?at({},Q.ALLOWED_TAGS,qt):xe,ue=Cr(Q,"ALLOWED_ATTR")?at({},Q.ALLOWED_ATTR,qt):Ie,_r=Cr(Q,"ALLOWED_NAMESPACES")?at({},Q.ALLOWED_NAMESPACES,Fy):so,Xa=Cr(Q,"ADD_URI_SAFE_ATTR")?at(Da(fl),Q.ADD_URI_SAFE_ATTR,qt):fl,Zn=Cr(Q,"ADD_DATA_URI_TAGS")?at(Da(vn),Q.ADD_DATA_URI_TAGS,qt):vn,wt=Cr(Q,"FORBID_CONTENTS")?at({},Q.FORBID_CONTENTS,qt):pt,Ne=Cr(Q,"FORBID_TAGS")?at({},Q.FORBID_TAGS,qt):Da({}),ce=Cr(Q,"FORBID_ATTR")?at({},Q.FORBID_ATTR,qt):Da({}),Ps=Cr(Q,"USE_PROFILES")?Q.USE_PROFILES:!1,_e=Q.ALLOW_ARIA_ATTR!==!1,Se=Q.ALLOW_DATA_ATTR!==!1,Ue=Q.ALLOW_UNKNOWN_PROTOCOLS||!1,Ze=Q.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ge=Q.SAFE_FOR_TEMPLATES||!1,lt=Q.SAFE_FOR_XML!==!1,ze=Q.WHOLE_DOCUMENT||!1,ct=Q.RETURN_DOM||!1,It=Q.RETURN_DOM_FRAGMENT||!1,Hn=Q.RETURN_TRUSTED_TYPE||!1,gt=Q.FORCE_BODY||!1,an=Q.SANITIZE_DOM!==!1,Gn=Q.SANITIZE_NAMED_PROPS||!1,ks=Q.KEEP_CONTENT!==!1,Ds=Q.IN_PLACE||!1,D=Q.ALLOWED_URI_REGEXP||_I,Rn=Q.NAMESPACE||$n,Ur=Q.MATHML_TEXT_INTEGRATION_POINTS||Ur,Fr=Q.HTML_INTEGRATION_POINTS||Fr,pe=Q.CUSTOM_ELEMENT_HANDLING||{},Q.CUSTOM_ELEMENT_HANDLING&&Tr(Q.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(pe.tagNameCheck=Q.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Q.CUSTOM_ELEMENT_HANDLING&&Tr(Q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(pe.attributeNameCheck=Q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Q.CUSTOM_ELEMENT_HANDLING&&typeof Q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(pe.allowCustomizedBuiltInElements=Q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ge&&(Se=!1),It&&(ct=!0),Ps&&(se=at({},$E),ue=[],Ps.html===!0&&(at(se,GE),at(ue,KE)),Ps.svg===!0&&(at(se,By),at(ue,Hy),at(ue,Uf)),Ps.svgFilters===!0&&(at(se,qy),at(ue,Hy),at(ue,Uf)),Ps.mathMl===!0&&(at(se,zy),at(ue,QE),at(ue,Uf))),Q.ADD_TAGS&&(se===xe&&(se=Da(se)),at(se,Q.ADD_TAGS,qt)),Q.ADD_ATTR&&(ue===Ie&&(ue=Da(ue)),at(ue,Q.ADD_ATTR,qt)),Q.ADD_URI_SAFE_ATTR&&at(Xa,Q.ADD_URI_SAFE_ATTR,qt),Q.FORBID_CONTENTS&&(wt===pt&&(wt=Da(wt)),at(wt,Q.FORBID_CONTENTS,qt)),ks&&(se["#text"]=!0),ze&&at(se,["html","head","body"]),se.table&&(at(se,["tbody"]),delete Ne.tbody),Q.TRUSTED_TYPES_POLICY){if(typeof Q.TRUSTED_TYPES_POLICY.createHTML!="function")throw ud('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Q.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ud('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');H=Q.TRUSTED_TYPES_POLICY,$=H.createHTML("")}else H===void 0&&(H=c6(N,a)),H!==null&&typeof $=="string"&&($=H.createHTML(""));gs&&gs(Q),us=Q}},Mt=at({},[...By,...qy,...J3]),tn=at({},[...zy,...Z3]),nn=function(Q){let ye=B(Q);(!ye||!ye.tagName)&&(ye={namespaceURI:Rn,tagName:"template"});const je=rm(Q.tagName),Tt=rm(ye.tagName);return _r[Q.namespaceURI]?Q.namespaceURI===Zs?ye.namespaceURI===$n?je==="svg":ye.namespaceURI===Js?je==="svg"&&(Tt==="annotation-xml"||Ur[Tt]):!!Mt[je]:Q.namespaceURI===Js?ye.namespaceURI===$n?je==="math":ye.namespaceURI===Zs?je==="math"&&Fr[Tt]:!!tn[je]:Q.namespaceURI===$n?ye.namespaceURI===Zs&&!Fr[Tt]||ye.namespaceURI===Js&&!Ur[Tt]?!1:!tn[je]&&(wr[je]||!Mt[je]):!!(cs==="application/xhtml+xml"&&_r[Q.namespaceURI]):!1},Yt=function(Q){ld(e.removed,{element:Q});try{B(Q).removeChild(Q)}catch{L(Q)}},tr=function(Q,ye){try{ld(e.removed,{attribute:ye.getAttributeNode(Q),from:ye})}catch{ld(e.removed,{attribute:null,from:ye})}if(ye.removeAttribute(Q),Q==="is")if(ct||It)try{Yt(ye)}catch{}else try{ye.setAttribute(Q,"")}catch{}},ml=function(Q){let ye=null,je=null;if(gt)Q="<remove></remove>"+Q;else{const Ot=HE(Q,/^[\r\n\t ]+/);je=Ot&&Ot[0]}cs==="application/xhtml+xml"&&Rn===$n&&(Q='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Q+"</body></html>");const Tt=H?H.createHTML(Q):Q;if(Rn===$n)try{ye=new b().parseFromString(Tt,cs)}catch{}if(!ye||!ye.documentElement){ye=M.createDocument(Rn,"template",null);try{ye.documentElement.innerHTML=Lr?$:Tt}catch{}}const on=ye.body||ye.documentElement;return Q&&je&&on.insertBefore(t.createTextNode(je),on.childNodes[0]||null),Rn===$n?A.call(ye,ze?"html":"body")[0]:ze?ye.documentElement:on},Er=function(Q){return R.call(Q.ownerDocument||Q,Q,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},Za=function(Q){return Q instanceof _&&(typeof Q.nodeName!="string"||typeof Q.textContent!="string"||typeof Q.removeChild!="function"||!(Q.attributes instanceof x)||typeof Q.removeAttribute!="function"||typeof Q.setAttribute!="function"||typeof Q.namespaceURI!="string"||typeof Q.insertBefore!="function"||typeof Q.hasChildNodes!="function")},Br=function(Q){return typeof h=="function"&&Q instanceof h};function kn(De,Q,ye){Lf(De,je=>{je.call(e,Q,ye,us)})}const nr=function(Q){let ye=null;if(kn(I.beforeSanitizeElements,Q,null),Za(Q))return Yt(Q),!0;const je=qt(Q.nodeName);if(kn(I.uponSanitizeElement,Q,{tagName:je,allowedTags:se}),lt&&Q.hasChildNodes()&&!Br(Q.firstElementChild)&&ms(/<[/\w!]/g,Q.innerHTML)&&ms(/<[/\w!]/g,Q.textContent)||Q.nodeType===hd.progressingInstruction||lt&&Q.nodeType===hd.comment&&ms(/<[/\w]/g,Q.data))return Yt(Q),!0;if(!se[je]||Ne[je]){if(!Ne[je]&&Os(je)&&(pe.tagNameCheck instanceof RegExp&&ms(pe.tagNameCheck,je)||pe.tagNameCheck instanceof Function&&pe.tagNameCheck(je)))return!1;if(ks&&!wt[je]){const Tt=B(Q)||Q.parentNode,on=U(Q)||Q.childNodes;if(on&&Tt){const Ot=on.length;for(let bn=Ot-1;bn>=0;--bn){const Pn=k(on[bn],!0);Pn.__removalCount=(Q.__removalCount||0)+1,Tt.insertBefore(Pn,F(Q))}}}return Yt(Q),!0}return Q instanceof m&&!nn(Q)||(je==="noscript"||je==="noembed"||je==="noframes")&&ms(/<\/no(script|embed|frames)/i,Q.innerHTML)?(Yt(Q),!0):(Ge&&Q.nodeType===hd.text&&(ye=Q.textContent,Lf([G,O,Ve],Tt=>{ye=cd(ye,Tt," ")}),Q.textContent!==ye&&(ld(e.removed,{element:Q.cloneNode()}),Q.textContent=ye)),kn(I.afterSanitizeElements,Q,null),!1)},Ms=function(Q,ye,je){if(an&&(ye==="id"||ye==="name")&&(je in t||je in Wa))return!1;if(!(Se&&!ce[ye]&&ms(ae,ye))){if(!(_e&&ms(z,ye))){if(!ue[ye]||ce[ye]){if(!(Os(Q)&&(pe.tagNameCheck instanceof RegExp&&ms(pe.tagNameCheck,Q)||pe.tagNameCheck instanceof Function&&pe.tagNameCheck(Q))&&(pe.attributeNameCheck instanceof RegExp&&ms(pe.attributeNameCheck,ye)||pe.attributeNameCheck instanceof Function&&pe.attributeNameCheck(ye))||ye==="is"&&pe.allowCustomizedBuiltInElements&&(pe.tagNameCheck instanceof RegExp&&ms(pe.tagNameCheck,je)||pe.tagNameCheck instanceof Function&&pe.tagNameCheck(je))))return!1}else if(!Xa[ye]){if(!ms(D,cd(je,Y,""))){if(!((ye==="src"||ye==="xlink:href"||ye==="href")&&Q!=="script"&&Q3(je,"data:")===0&&Zn[Q])){if(!(Ue&&!ms(oe,cd(je,Y,"")))){if(je)return!1}}}}}}return!0},Os=function(Q){return Q!=="annotation-xml"&&HE(Q,be)},Dn=function(Q){kn(I.beforeSanitizeAttributes,Q,null);const{attributes:ye}=Q;if(!ye||Za(Q))return;const je={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ue,forceKeepAttr:void 0};let Tt=ye.length;for(;Tt--;){const on=ye[Tt],{name:Ot,namespaceURI:bn,value:Pn}=on,es=qt(Ot),ln=Pn;let zt=Ot==="value"?ln:Y3(ln);if(je.attrName=es,je.attrValue=zt,je.keepAttr=!0,je.forceKeepAttr=void 0,kn(I.uponSanitizeAttribute,Q,je),zt=je.attrValue,Gn&&(es==="id"||es==="name")&&(tr(Ot,Q),zt=br+zt),lt&&ms(/((--!?|])>)|<\/(style|title)/i,zt)){tr(Ot,Q);continue}if(je.forceKeepAttr)continue;if(!je.keepAttr){tr(Ot,Q);continue}if(!Ze&&ms(/\/>/i,zt)){tr(Ot,Q);continue}Ge&&Lf([G,O,Ve],sr=>{zt=cd(zt,sr," ")});const ao=qt(Q.nodeName);if(!Ms(ao,es,zt)){tr(Ot,Q);continue}if(H&&typeof N=="object"&&typeof N.getAttributeType=="function"&&!bn)switch(N.getAttributeType(ao,es)){case"TrustedHTML":{zt=H.createHTML(zt);break}case"TrustedScriptURL":{zt=H.createScriptURL(zt);break}}if(zt!==ln)try{bn?Q.setAttributeNS(bn,Ot,zt):Q.setAttribute(Ot,zt),Za(Q)?Yt(Q):zE(e.removed)}catch{tr(Ot,Q)}}kn(I.afterSanitizeAttributes,Q,null)},Xt=function De(Q){let ye=null;const je=Er(Q);for(kn(I.beforeSanitizeShadowDOM,Q,null);ye=je.nextNode();)kn(I.uponSanitizeShadowNode,ye,null),nr(ye),Dn(ye),ye.content instanceof l&&De(ye.content);kn(I.afterSanitizeShadowDOM,Q,null)};return e.sanitize=function(De){let Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ye=null,je=null,Tt=null,on=null;if(Lr=!De,Lr&&(De="<!-->"),typeof De!="string"&&!Br(De))if(typeof De.toString=="function"){if(De=De.toString(),typeof De!="string")throw ud("dirty is not a string, aborting")}else throw ud("toString is not a function");if(!e.isSupported)return De;if(Qe||Ja(Q),e.removed=[],typeof De=="string"&&(Ds=!1),Ds){if(De.nodeName){const Pn=qt(De.nodeName);if(!se[Pn]||Ne[Pn])throw ud("root node is forbidden and cannot be sanitized in-place")}}else if(De instanceof h)ye=ml("<!---->"),je=ye.ownerDocument.importNode(De,!0),je.nodeType===hd.element&&je.nodeName==="BODY"||je.nodeName==="HTML"?ye=je:ye.appendChild(je);else{if(!ct&&!Ge&&!ze&&De.indexOf("<")===-1)return H&&Hn?H.createHTML(De):De;if(ye=ml(De),!ye)return ct?null:Hn?$:""}ye&&gt&&Yt(ye.firstChild);const Ot=Er(Ds?De:ye);for(;Tt=Ot.nextNode();)nr(Tt),Dn(Tt),Tt.content instanceof l&&Xt(Tt.content);if(Ds)return De;if(ct){if(It)for(on=T.call(ye.ownerDocument);ye.firstChild;)on.appendChild(ye.firstChild);else on=ye;return(ue.shadowroot||ue.shadowrootmode)&&(on=V.call(n,on,!0)),on}let bn=ze?ye.outerHTML:ye.innerHTML;return ze&&se["!doctype"]&&ye.ownerDocument&&ye.ownerDocument.doctype&&ye.ownerDocument.doctype.name&&ms(wI,ye.ownerDocument.doctype.name)&&(bn="<!DOCTYPE "+ye.ownerDocument.doctype.name+`>
`+bn),Ge&&Lf([G,O,Ve],Pn=>{bn=cd(bn,Pn," ")}),H&&Hn?H.createHTML(bn):bn},e.setConfig=function(){let De=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ja(De),Qe=!0},e.clearConfig=function(){us=null,Qe=!1},e.isValidAttribute=function(De,Q,ye){us||Ja({});const je=qt(De),Tt=qt(Q);return Ms(je,Tt,ye)},e.addHook=function(De,Q){typeof Q=="function"&&ld(I[De],Q)},e.removeHook=function(De,Q){if(Q!==void 0){const ye=$3(I[De],Q);return ye===-1?void 0:K3(I[De],ye,1)[0]}return zE(I[De])},e.removeHooks=function(De){I[De]=[]},e.removeAllHooks=function(){I=XE()},e}var Gy=TI();const u6=()=>{const{user:s}=Cn(),[e,t]=P.useState(""),[n,a]=P.useState(!1),[l,u]=P.useState(null),[h,m]=P.useState(!1),[p,x]=P.useState([]),[_,b]=P.useState(!1),[N,C]=P.useState(""),[k,L]=P.useState({enabled:!1,interval:24,lastRun:null,nextRun:null});P.useEffect(()=>{F(),U()},[]);const F=async()=>{try{const I=await ki.getBotAccounts();x(I)}catch(I){console.error("Error loading bots:",I)}},U=async()=>{try{const I=await ki.getAutomationSettings();L(I)}catch(I){console.error("Error loading automation settings:",I)}},B=async()=>{a(!0);try{const O=(await Mi(Ua,"getRandomMathPost")()).data;t(O.url),confirm(`Found: "${O.question.title}" (${O.question.score} votes)

Auto-convert to flashcard?`)&&await H(O.url)}catch(I){console.error("Error getting random post:",I),alert("Failed to get random math post: "+I.message)}finally{a(!1)}},H=async(I=null)=>{const G=I||e;if(!G){alert("Please enter a Stack Exchange URL");return}a(!0);try{const Ve=await Mi(Ua,"convertStackExchangePost")({url:G});u(Ve.data),m(!1)}catch(O){console.error("Error converting post:",O),alert("Failed to convert post: "+O.message)}finally{a(!1)}},$=(I,G)=>{u(O=>({...O,[I]:G}))},M=async()=>{if(!N){alert("Please select a bot account");return}if(!l){alert("No conversion data available");return}a(!0);try{const G=await Mi(Ua,"publishStackExchangeFlashcard")({conversion:l,botId:N});alert("Flashcard published successfully!"),u(null),t(""),C("")}catch(I){console.error("Error publishing flashcard:",I),alert("Failed to publish flashcard: "+I.message)}finally{a(!1)}},R=async()=>{try{const I={...k,enabled:!k.enabled};await ki.updateAutomationSettings(I),L(I)}catch(I){console.error("Error updating automation:",I),alert("Failed to update automation settings")}},T=async I=>{try{const G={...k,interval:parseInt(I)};await ki.updateAutomationSettings(G),L(G)}catch(G){console.error("Error updating automation interval:",G),alert("Failed to update automation interval")}},A=async()=>{if(p.length===0){alert(` No bots available!

You need to create at least one bot account before triggering automation.

Go to the "Bots" tab to create a bot first.`);return}const I=p.filter(G=>G.isActive);if(I.length===0){alert(` No active bots!

You have bots, but none are currently active.

Activate at least one bot in the "Bots" tab before triggering automation.`);return}if(confirm(`This will trigger the full automation pipeline:

1. Select random bot (from ${I.length} active bots)
2. Get random StackExchange post
3. Convert to flashcard with DeepSeek AI
4. Publish as bot
5. Bot likes own post

Continue?`)){a(!0);try{const Ve=(await Mi(Ua,"triggerAutomation")()).data;alert(` Automation completed successfully!

Bot: ${Ve.botName}
Post ID: ${Ve.postId}
Card URL: ${Ve.cardUrl||"Not available"}
Source: ${Ve.stackExchangeUrl}

Check the Cloud Functions logs for detailed execution info.`),F(),U()}catch(G){console.error("Error triggering automation:",G);let O=G.message;O.includes("Failed to get random math post")?O="StackExchange API issue - likely rate limited. Try again in a few minutes.":O.includes("No active bot accounts")?O="No active bots found. Create and activate a bot first.":O.includes("DeepSeek")&&(O="AI conversion failed. Check DeepSeek API key and credits."),alert(` Automation failed: ${O}

Check the browser console and Cloud Functions logs for more details.`)}finally{a(!1)}}},V=async()=>{if(confirm("Are you sure you want to stop the automation? This will disable all scheduled automated posting."))try{const I={...k,enabled:!1,lastStopped:new Date().toISOString()};await ki.updateAutomationSettings(I),L(I),alert(" Automation has been stopped. No more automated posts will be created.")}catch(I){console.error("Error stopping automation:",I),alert("Failed to stop automation: "+I.message)}};return o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:" StackExchange to Flashcard Converter"}),o.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:" Automation Settings"}),o.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${k.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${k.enabled?"bg-green-500":"bg-gray-400"}`}),k.enabled?"ACTIVE":"STOPPED"]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Automated Posting Control:"}),o.jsx("div",{className:"flex gap-2",children:k.enabled?o.jsx("button",{onClick:V,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:" Stop Automation"}):o.jsxs("button",{onClick:R,disabled:n||p.length===0||p.filter(I=>I.isActive).length===0,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[o.jsx("span",{className:"animate-pulse",children:""}),"Start Automation"]})})]}),p.length===0&&o.jsx("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-1 rounded",children:" Create bots first"}),p.length>0&&p.filter(I=>I.isActive).length===0&&o.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:" Activate bots first"})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Post every:"}),o.jsxs("select",{value:k.interval,onChange:I=>T(I.target.value),disabled:!k.enabled,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",children:[o.jsx("option",{value:15,children:"15 minutes"}),o.jsx("option",{value:30,children:"30 minutes"}),o.jsx("option",{value:60,children:"1 hour"}),o.jsx("option",{value:180,children:"3 hours"}),o.jsx("option",{value:360,children:"6 hours"}),o.jsx("option",{value:720,children:"12 hours"}),o.jsx("option",{value:1440,children:"24 hours"})]})]}),k.lastRun&&o.jsxs("p",{className:"text-sm text-gray-600",children:["Last run: ",new Date(k.lastRun).toLocaleString()]}),k.nextRun&&o.jsxs("p",{className:"text-sm text-gray-600",children:["Next run: ",new Date(k.nextRun).toLocaleString()]})]})]}),o.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Manual Conversion"}),o.jsxs("div",{className:"flex gap-3 mb-4",children:[o.jsx("input",{type:"url",value:e,onChange:I=>t(I.target.value),placeholder:"https://math.stackexchange.com/questions/...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),o.jsx("button",{onClick:()=>H(),disabled:n||!e,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:n?"Converting...":"Convert to Flashcard"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:B,disabled:n,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:" Test: Get Random Math Post"}),o.jsxs("button",{onClick:()=>b(!_),disabled:n,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:[_?" Hide":" Review"," Broken Cards"]})]}),o.jsxs("div",{className:"border-t pt-3",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Manual Testing:"}),p.length===0&&o.jsx("span",{className:"text-xs text-red-600 bg-red-100 px-2 py-1 rounded",children:" Create bots first"}),p.length>0&&p.filter(I=>I.isActive).length===0&&o.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:" Activate bots first"})]}),o.jsx("button",{onClick:A,disabled:n||p.length===0||p.filter(I=>I.isActive).length===0,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:" Test Full Pipeline Once"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This runs the entire automation once for testing. The scheduled automation above runs automatically."})]})]})]}),l&&o.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Conversion Result"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Statement:"}),h?o.jsx("textarea",{value:l.statement,onChange:I=>$("statement",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4}):o.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:Gy.sanitize(l.statement)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hints:"}),h?o.jsx("textarea",{value:l.hints,onChange:I=>$("hints",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}):o.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:Gy.sanitize(l.hints)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof:"}),h?o.jsx("textarea",{value:l.proof,onChange:I=>$("proof",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4}):o.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg prose max-w-none",dangerouslySetInnerHTML:{__html:Gy.sanitize(l.proof)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags:"}),h?o.jsx("input",{type:"text",value:l.tags?.join(", ")||"",onChange:I=>$("tags",I.target.value.split(",").map(G=>G.trim())),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"tag1, tag2, tag3"}):o.jsx("div",{className:"flex flex-wrap gap-2",children:l.tags?.map(I=>o.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:["#",I]},I))})]})]}),o.jsxs("div",{className:"flex gap-3 mt-6",children:[o.jsx("button",{onClick:()=>m(!h),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:h?"Preview":"Edit"}),o.jsx("button",{onClick:()=>H(),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Regenerate"})]})]}),l&&o.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Publish Flashcard"}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Bot Account:"}),o.jsxs("select",{value:N,onChange:I=>C(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[o.jsx("option",{value:"",children:"Choose a bot..."}),p.map(I=>o.jsxs("option",{value:I.id,children:[I.displayName," (",I.email,")"]},I.id))]})]}),o.jsx("button",{onClick:M,disabled:n||!N,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:n?"Publishing...":"Publish Flashcard"})]}),_&&o.jsx(B3,{}),o.jsx(q3,{})]})},d6=()=>{const[s,e]=P.useState([]),[t,n]=P.useState(!1),[a,l]=P.useState({displayName:"",email:"",password:"",bio:"",avatar:""}),[u,h]=P.useState(!1);P.useEffect(()=>{m()},[]);const m=async()=>{n(!0);try{const b=await ki.getBotAccounts();e(b)}catch(b){console.error("Error loading bots:",b),alert("Failed to load bot accounts")}finally{n(!1)}},p=async()=>{if(!a.displayName||!a.email||!a.password){alert("Please fill in all required fields");return}n(!0);try{const b=await ki.createBotAccount(a);alert("Bot account created successfully!"),l({displayName:"",email:"",password:"",bio:"",avatar:""}),h(!1),m()}catch(b){console.error("Error creating bot:",b),alert("Failed to create bot account: "+b.message)}finally{n(!1)}},x=async b=>{if(confirm("Are you sure you want to delete this bot account? This action cannot be undone.")){n(!0);try{await ki.deleteBotAccount(b),alert("Bot account deleted successfully!"),m()}catch(N){console.error("Error deleting bot:",N),alert("Failed to delete bot account: "+N.message)}finally{n(!1)}}},_=async(b,N)=>{n(!0);try{await Mi(Ua,"updateBotStatus")({botId:b,isActive:!N}),m()}catch(C){console.error("Error updating bot status:",C),alert("Failed to update bot status: "+C.message)}finally{n(!1)}};return o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:" Bot Account Management"}),o.jsxs("div",{className:"flex gap-4 mb-6",children:[o.jsx("button",{onClick:()=>h(!u),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:u?"Cancel":"+ Create New Bot"}),o.jsx("button",{onClick:m,disabled:t,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Loading...":"Refresh"})]}),u&&o.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Bot Account"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name:"}),o.jsx("input",{type:"text",value:a.displayName,onChange:b=>l({...a,displayName:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., MathBot Pro"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email:"}),o.jsx("input",{type:"email",value:a.email,onChange:b=>l({...a,email:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., mathbot1@example.com"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password:"}),o.jsx("input",{type:"password",value:a.password,onChange:b=>l({...a,password:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Strong password"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar URL (optional):"}),o.jsx("input",{type:"url",value:a.avatar,onChange:b=>l({...a,avatar:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com/avatar.jpg"})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio:"}),o.jsx("textarea",{value:a.bio,onChange:b=>l({...a,bio:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Brief description of this bot..."})]}),a.avatar&&o.jsxs("div",{className:"mt-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar Preview:"}),o.jsx("img",{src:a.avatar,alt:"Avatar preview",className:"w-16 h-16 rounded-full object-cover border border-gray-300",onError:b=>{b.target.style.display="none"}})]}),o.jsxs("div",{className:"flex gap-3 mt-6",children:[o.jsx("button",{onClick:p,disabled:t,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:t?"Creating...":"Create Bot"}),o.jsx("button",{onClick:()=>h(!1),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"})]})]}),o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Bot Accounts (",s.length,")"]}),t&&o.jsx("div",{className:"text-gray-600 py-4",children:"Loading bot accounts..."}),s.length===0&&!t&&o.jsx("div",{className:"text-gray-600 py-8 text-center",children:o.jsx("p",{children:"No bot accounts found. Create your first bot to get started!"})}),o.jsx("div",{className:"grid gap-4",children:s.map(b=>o.jsx("div",{className:`p-4 rounded-lg border ${b.isActive?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[o.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:b.displayName}),o.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${b.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:b.isActive?"Active":"Inactive"})]}),o.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Email:"})," ",b.email]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Bio:"})," ",b.bio||"No bio set"]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Created:"})," ",b.createdAt?b.createdAt.toDate?b.createdAt.toDate().toLocaleDateString():new Date(b.createdAt).toLocaleDateString():"Unknown"]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Posts:"})," ",b.postCount||0]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Last Active:"})," ",b.lastActive?new Date(b.lastActive).toLocaleString():"Never"]})]})]}),o.jsxs("div",{className:"flex gap-2 ml-4",children:[o.jsx("button",{onClick:()=>_(b.id,b.isActive),disabled:t,className:`px-3 py-1 rounded text-sm font-medium transition-colors ${b.isActive?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:b.isActive?"Deactivate":"Activate"}),o.jsx("button",{onClick:()=>x(b.id),disabled:t,className:"px-3 py-1 rounded text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition-colors",children:"Delete"})]})]})},b.id))})]})]})},h6=({onClose:s})=>{const{user:e}=Cn(),[t,n]=P.useState(null),[a,l]=P.useState(!0),[u,h]=P.useState("overview"),[m,p]=P.useState(null),[x,_]=P.useState([]),[b,N]=P.useState([]),[C,k]=P.useState([]);P.useEffect(()=>{e&&L()},[e]);const L=async()=>{try{if(l(!0),!await Ir.verifyAdminAccess(e)){console.log(" No admin access, closing dashboard"),s&&s();return}const A=await Ir.getAdminStatus(e.uid);n(A),await F()}catch(T){console.error(" Error checking admin access:",T),s&&s()}finally{l(!1)}},F=async()=>{try{const T=await Ir.getSystemStats();p(T)}catch(T){console.error("Error loading system stats:",T)}},U=async()=>{try{const T=await Ir.getAllUsers(100);_(T)}catch(T){console.error("Error loading users:",T)}},B=async()=>{try{const T=await Ir.getPublicCardsForModeration(50);N(T)}catch(T){console.error("Error loading public cards:",T)}},H=async()=>{try{const T=await Ir.getAdminActivity(30);k(T)}catch(T){console.error("Error loading admin activity:",T)}},$=async T=>{switch(h(T),T){case"users":await U();break;case"content":await B();break;case"activity":await H();break}},M=async(T,A)=>{try{await Ir.updateUserPremium(T,A),await Ir.logAdminAction(e.uid,"user_premium_update",{targetUserId:T,newStatus:A}),await U()}catch(V){console.error("Error updating user premium:",V),alert("Failed to update user premium status")}},R=async(T,A,V="")=>{try{await Ir.moderateCard(T,A,V),await Ir.logAdminAction(e.uid,"content_moderation",{cardId:T,action:A,reason:V}),await B()}catch(I){console.error("Error moderating card:",I),alert("Failed to moderate content")}};return a?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-red-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Verifying admin access..."})]})}):t?.isAdmin?o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2 text-red-600",children:" Admin Dashboard"}),o.jsx("p",{className:"claude-text-secondary",children:"System management and content moderation"}),o.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[o.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[t.adminLevel.toUpperCase()," ADMIN"]}),o.jsxs("span",{className:"text-sm claude-text-muted",children:["Logged in as: ",e.email]})]})]}),o.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[o.jsx("button",{onClick:F,className:"claude-button-secondary",children:" Refresh Data"}),s&&o.jsx("button",{onClick:s,className:"claude-button-secondary",children:" Close Admin"})]})]}),o.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-red-50 to-orange-50 border-red-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-semibold text-red-800",children:"Administrator Mode Active"}),o.jsx("div",{className:"text-sm text-red-600",children:"All actions are logged. Use admin privileges responsibly."})]})]})}),o.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:" Overview",icon:""},{id:"users",label:" Users",icon:""},{id:"content",label:" Content",icon:""},{id:"activity",label:" Activity",icon:""},{id:"stackexchange",label:" StackExchange",icon:""},{id:"bots",label:" Bots",icon:""}].map(T=>o.jsxs("button",{onClick:()=>$(T.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${u===T.id?"bg-blue-500 text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[o.jsx("span",{className:"mr-2",children:T.icon}),o.jsx("span",{className:"hidden sm:inline",children:T.label.replace(/^.+\s/,"")})]},T.id))}),u==="overview"&&o.jsx(f6,{systemStats:m}),u==="users"&&o.jsx(m6,{users:x,onPremiumToggle:M}),u==="content"&&o.jsx(g6,{publicCards:b,onModerate:R}),u==="stackexchange"&&o.jsxs("div",{className:"admin-section",children:[o.jsx("h3",{children:" StackExchange Integration"}),o.jsx(u6,{})]}),u==="bots"&&o.jsxs("div",{className:"admin-section",children:[o.jsx("h3",{children:" Bot Management"}),o.jsx(d6,{})]}),u==="activity"&&o.jsx(p6,{adminActivity:C})]})}):o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center max-w-md",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Access Denied"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:"You don't have administrator privileges to access this dashboard."}),o.jsx("button",{onClick:s,className:"claude-button-primary",children:"Return to App"})]})})},f6=({systemStats:s})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(Ff,{title:"Total Users",value:s?.users?.total||0,icon:"",color:"blue",subtitle:`${s?.users?.recentlyActive||0} active this week`}),o.jsx(Ff,{title:"Premium Users",value:s?.users?.premium||0,icon:"",color:"gold",subtitle:`${s?.users?.conversionRate||0}% conversion rate`}),o.jsx(Ff,{title:"Total Content",value:s?.content?.totalCards||0,icon:"",color:"green",subtitle:`${s?.content?.totalPublicCards||0} public cards`}),o.jsx(Ff,{title:"Recent Activity",value:s?.content?.recentPublicCards||0,icon:"",color:"purple",subtitle:"New public cards this week"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[o.jsx("span",{className:"text-green-500",children:""}),"System Status"]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Database"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Authentication"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"File Storage"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Analytics"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",children:" Usage Statistics"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Avg Cards per User"}),o.jsx("span",{className:"font-medium",children:s?.content?.avgCardsPerUser||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Admin Users"}),o.jsx("span",{className:"font-medium",children:s?.users?.admin||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Public vs Private"}),o.jsxs("span",{className:"font-medium",children:[s?.content?.totalPublicCards||0," / ",s?.content?.totalPrivateCards||0]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Last Updated"}),o.jsx("span",{className:"font-medium text-sm",children:s?.system?.lastUpdated?new Date(s.system.lastUpdated).toLocaleTimeString():"Never"})]})]})]})]})]}),m6=({users:s,onPremiumToggle:e})=>o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",children:"User Management"}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," users loaded"]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold",children:t.displayName}),o.jsx("p",{className:"text-sm claude-text-muted",children:t.email}),o.jsxs("p",{className:"text-xs claude-text-muted",children:["Joined: ",t.joinDate.toLocaleDateString()]})]}),o.jsxs("div",{className:"flex flex-col gap-1",children:[t.isPremium&&o.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"Premium"}),t.isAdmin&&o.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Admin"})]})]}),o.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Profile:"}),o.jsx("span",{children:t.profile?.displayName?"Complete":"Incomplete"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Last Seen:"}),o.jsx("span",{children:t.lastSeen.toLocaleDateString()})]})]}),o.jsx("div",{className:"space-y-2",children:o.jsx("button",{onClick:()=>e(t.id,!t.isPremium),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t.isPremium?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.isPremium?" Remove Premium":" Grant Premium"})})]},t.id))})]}),g6=({publicCards:s,onModerate:e})=>o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",children:"Content Moderation"}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," public cards"]})]}),o.jsxs("div",{className:"space-y-4",children:[s.map(t=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("h4",{className:"font-bold mb-2",children:[t.statement?.substring(0,100),"..."]}),o.jsxs("div",{className:"flex items-center gap-4 text-sm claude-text-muted",children:[o.jsxs("span",{children:["By: ",t.author?.displayName||t.author?.email||"Unknown"]}),o.jsxs("span",{children:["Created: ",t.createdDate.toLocaleDateString()]}),o.jsxs("span",{children:["Likes: ",t.likeCount||0]}),o.jsxs("span",{children:["Views: ",t.viewCount||0]})]})]}),o.jsxs("div",{className:"flex gap-2 ml-4",children:[o.jsx("button",{onClick:()=>e(t.id,"hide","Hidden by admin"),className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-sm hover:bg-yellow-200",children:" Hide"}),o.jsx("button",{onClick:()=>e(t.id,"remove","Removed by admin"),className:"px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200",children:" Remove"})]})]}),t.isHidden&&o.jsx("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:" This card is currently hidden from public view"}),t.isRemoved&&o.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:" This card has been removed"})]},t.id)),s.length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No public cards found"})]})]}),p6=({adminActivity:s})=>o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",children:"Admin Activity Log"}),o.jsxs("div",{className:"text-sm claude-text-muted",children:["Recent ",s.length," actions"]})]}),o.jsxs("div",{className:"space-y-3",children:[s.map(e=>o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:e.action.replace(/_/g," ").toUpperCase()}),o.jsxs("div",{className:"text-sm claude-text-muted",children:["By: ",e.admin?.displayName||e.admin?.email||"Unknown"]}),e.details&&Object.keys(e.details).length>0&&o.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:["Details: ",JSON.stringify(e.details,null,2)]})]}),o.jsx("div",{className:"text-xs claude-text-muted",children:e.timestamp.toLocaleString()})]})},e.id)),s.length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No admin activity recorded"})]})]}),Ff=({title:s,value:e,icon:t,color:n,subtitle:a})=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"text-2xl",children:t}),o.jsx("div",{className:`w-3 h-3 rounded-full bg-${n}-500`})]}),o.jsx("div",{className:`text-2xl font-bold mb-1 text-${n}-600`,children:e}),o.jsx("div",{className:"text-sm font-medium mb-1",children:s}),a&&o.jsx("div",{className:"text-xs claude-text-muted",children:a})]});function y6(){const[s,e]=P.useState("home"),[t,n]=P.useState(null),[a,l]=P.useState(null),[u,h]=P.useState(null),[m,p]=P.useState({hasProfile:!1,hasCards:!1}),[x,_]=P.useState(!1),[b,N]=P.useState(!1),[C,k]=P.useState(!1),[L,F]=P.useState(!1),[U,B]=P.useState(0),[H,$]=P.useState(!1),{user:M,signInWithGoogle:R,logout:T,authError:A,getFreshIdToken:V,sessionWarning:I,dismissSessionWarning:G}=Cn();P.useEffect(()=>{M&&Ve()},[M]),P.useEffect(()=>{Fn.initializeAutoTracking(M?.uid),Fn.trackFeatureUsage("app","loaded",{userLoggedIn:!!M},M?.uid)},[]),P.useEffect(()=>{if(s){Fn.trackPageView(`/new/${s}`,null,M?.uid),Fn.trackUserFlow(localStorage.getItem("lastMode")||"home",s,"navigation",M?.uid),localStorage.setItem("lastMode",s);const pe=new URL(window.location);pe.searchParams.set("mode",s),window.history.replaceState({mode:s},"",pe.toString())}},[s]),P.useEffect(()=>{const pe=_e=>{const Ue=new URLSearchParams(window.location.search).get("mode")||_e.state?.mode||"home";e(Ue)};window.addEventListener("popstate",pe);const ce=new URLSearchParams(window.location.search).get("mode");return ce&&e(ce),()=>window.removeEventListener("popstate",pe)},[]),P.useEffect(()=>{M?(Fn.trackConversion("user_login",1,M.uid),Fn.trackFeatureUsage("auth","login_success",{},M.uid),O()):$(!1)},[M]);const O=async()=>{try{const pe=await Ir.verifyAdminAccess(M);$(pe)}catch(pe){console.error("Error checking admin status:",pe),$(!1)}},Ve=async()=>{try{const pe=await nm.checkOnboardingStatus(M.uid),Ne=await Ss.hasProfile(M.uid);try{const ce=await nm.autoMigrateUserDecks(M.uid);ce.success&&ce.migrationResult&&console.log(" Deck migration completed:",ce.message)}catch(ce){console.warn("Deck migration failed:",ce)}p({...pe,hasProfile:pe.hasProfile||Ne})}catch(pe){console.error("Error checking onboarding status:",pe)}},ae=async()=>{try{await R()}catch(pe){console.error("Error signing in:",pe)}},z=async()=>{try{await T()}catch(pe){console.error("Error signing out:",pe)}},oe=async()=>{if(!M){await ae();return}try{const pe=await nm.getUserProfile(M.uid);e(pe?"dashboard":"create-profile")}catch(pe){console.error("Error checking profile:",pe),e("create-profile")}},Y=async pe=>{if(!M){await ae();return}pe==="profile"&&!m.hasProfile&&e("create-profile")},be=async()=>{await Ve(),e("home")},D=pe=>{n(pe),e("profile")},se=()=>{B(pe=>pe+1),M&&Ve()},xe=()=>{switch(s){case"create":return o.jsx(o3,{onCardCreated:se,onClose:()=>e("home")});case"study":return o.jsx(l3,{},U);case"search":return o.jsx(c3,{});case"decks":return o.jsx(j3,{onCreateDeck:()=>e("create-deck"),onEditDeck:pe=>{l(pe),e("edit-deck")},onSelectDeck:pe=>{h(pe),e("study")}});case"create-deck":return o.jsx(FE,{onDeckCreated:()=>e("decks"),onClose:()=>e("decks")});case"edit-deck":return o.jsx(FE,{editingDeck:a,onDeckCreated:()=>{l(null),e("decks")},onClose:()=>{l(null),e("decks")}});case"analytics":return o.jsx(C3,{onClose:()=>e("home")});case"admin-analytics":return o.jsx(M3,{onClose:()=>e("home")});case"admin-dashboard":return o.jsx(h6,{onClose:()=>e("home")});case"leaderboard":return o.jsx(d3,{});case"dashboard":return o.jsx(m3,{});case"create-profile":return o.jsx(E3,{onProfileCreated:be,onClose:()=>e("home")});case"social":return o.jsx(N3,{onViewProfile:D});case"profile":return o.jsx(A3,{profileSlug:t,onClose:()=>e("home")});default:return Ie()}},ue=()=>{const[pe,Ne]=P.useState(!1),[ce,_e]=P.useState(!1),[Se,Ue]=P.useState(!1),[Ze,Ge]=P.useState(!1);return o.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-md border-b",style:{backgroundColor:"rgba(246, 245, 236, 0.8)",borderBottomColor:"var(--border-light)"},children:[o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3 group cursor-pointer",onClick:()=>e("home"),children:[o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"40",height:"40",className:"rounded-xl shadow-lg group-hover:shadow-blue-500/25 transition-all duration-300 group-hover:scale-105"}),o.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"})]}),o.jsx("span",{className:"text-xl md:text-2xl font-extrabold tracking-tight",style:{color:"var(--claude-heading)"},children:"ThreeSided"})]}),s==="home"&&M&&o.jsxs("div",{className:"hidden lg:flex items-center gap-3",children:[o.jsx("button",{className:"claude-button-secondary",onClick:()=>e("search"),children:" Search"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>_e(!ce),onBlur:()=>setTimeout(()=>_e(!1),200),children:" Study "}),ce&&o.jsxs("div",{className:"absolute top-full mt-1 left-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),_e(!1)},children:" My Decks"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),_e(!1)},children:" Study Mode"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),_e(!1)},children:" Create Flashcard"})]})]}),o.jsx("button",{className:"claude-button-secondary",onClick:()=>e("social"),children:" Social"}),o.jsx("button",{className:"claude-button-secondary",onClick:()=>e("leaderboard"),children:" Leaderboard"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>Ue(!Se),onBlur:()=>setTimeout(()=>Ue(!1),200),children:" Account "}),Se&&o.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Ue(!1)},children:" My Dashboard"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{oe(),Ue(!1)},children:" My Profile"}),o.jsx("div",{className:"border-t border-gray-200 my-1"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Ue(!1),Fn.trackClick("button",{text:"Analytics",action:"view_analytics"},M?.uid)},children:" Learning Analytics"})]})]}),H&&o.jsxs("div",{className:"relative",children:[o.jsx("button",{className:"claude-button-secondary bg-red-50 text-red-700 hover:bg-red-100 border-red-200 flex items-center gap-1",onClick:()=>Ge(!Ze),onBlur:()=>setTimeout(()=>Ge(!1),200),children:" Admin "}),Ze&&o.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("admin-analytics"),Ge(!1),Fn.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},M?.uid)},children:" Website Analytics"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors text-red-600",onClick:()=>{e("admin-dashboard"),Ge(!1),Fn.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},M?.uid)},children:" Admin Dashboard"})]})]})]}),s!=="home"&&o.jsx("div",{className:"hidden md:block",children:o.jsxs("span",{className:"text-lg font-bold",style:{color:"var(--claude-heading)"},children:[s==="create"&&" Create Flashcard",s==="study"&&" Study Mode",s==="search"&&" Search & Discovery",s==="decks"&&" My Decks",s==="create-deck"&&" Create Deck",s==="edit-deck"&&" Edit Deck",s==="analytics"&&" Learning Analytics",s==="admin-analytics"&&" Website Analytics",s==="admin-dashboard"&&" Admin Dashboard",s==="leaderboard"&&" Leaderboard & Stats",s==="dashboard"&&" My Dashboard",t&&" Profile",!t&&s==="social"&&" Social Hub",!t&&s==="create-profile"&&" Create Profile"]})}),o.jsxs("div",{className:"flex items-center gap-3",children:[M&&o.jsx("button",{className:"lg:hidden claude-button-secondary",onClick:()=>Ne(!pe),children:""}),M?o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-2 rounded-xl",style:{backgroundColor:"rgba(91, 200, 162, 0.15)",border:"1px solid var(--success)",color:"var(--success)"},children:[o.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),o.jsx("span",{className:"text-sm font-medium",children:M.displayName?.split(" ")[0]||"User"})]}),o.jsx("button",{className:"claude-button-secondary",style:{borderColor:"var(--error)",color:"var(--error)"},onClick:z,children:"Sign Out"})]}):o.jsxs("div",{className:"flex flex-col items-end gap-2",children:[A&&o.jsx("div",{className:"text-xs text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200 max-w-xs text-right",children:A}),o.jsx("button",{className:"claude-button-primary transform hover:scale-105 transition-all duration-200",onClick:ae,children:" Sign In"})]})]})]}),M&&pe&&o.jsx("div",{className:"lg:hidden bg-white border-t border-gray-200 shadow-lg",children:o.jsxs("div",{className:"px-4 py-3 space-y-2",children:[o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("search"),Ne(!1)},children:" Search"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),Ne(!1)},children:" My Decks"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),Ne(!1)},children:" Study Mode"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),Ne(!1)},children:" Create Flashcard"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("social"),Ne(!1)},children:" Social"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("leaderboard"),Ne(!1)},children:" Leaderboard"}),o.jsx("div",{className:"border-t border-gray-200 my-2"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Ne(!1)},children:" My Dashboard"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{oe(),Ne(!1)},children:" My Profile"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Ne(!1),Fn.trackClick("button",{text:"Analytics",action:"view_analytics"},M?.uid)},children:" Learning Analytics"}),H&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-red-200 my-2"}),o.jsx("div",{className:"px-3 py-1 text-xs font-semibold text-red-600 bg-red-50 rounded-lg mb-2",children:" ADMIN CONTROLS"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-analytics"),Ne(!1),Fn.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},M?.uid)},children:" Website Analytics"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-dashboard"),Ne(!1),Fn.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},M?.uid)},children:" Admin Dashboard"})]})]})})]})},Ie=()=>o.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[!M&&o.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, var(--claude-background) 0%, var(--claude-subtle) 50%, var(--claude-surface) 100%)"},children:[o.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234B284E' fill-opacity='0.05'%3E%3Cpath d='m36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),o.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(99, 91, 255, 0.08)"}}),o.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(68, 90, 255, 0.08)",animationDelay:"1s"}}),o.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full blur-2xl animate-pulse",style:{backgroundColor:"rgba(91, 194, 162, 0.08)",animationDelay:"2s"}})]}),o.jsxs("div",{className:"max-w-7xl mx-auto px-4 relative z-10 text-center py-24",children:[o.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full mb-8",style:{backgroundColor:"rgba(91, 194, 162, 0.15)",border:"1px solid var(--claude-success)",color:"var(--claude-success)"},children:[o.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--claude-success)"}}),o.jsx("span",{className:"text-sm font-semibold",children:" New React Version - Live Now"})]}),o.jsxs("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-extrabold tracking-tight mb-8",style:{color:"var(--heading)"},children:["Master Any Subject",o.jsx("br",{}),o.jsx("span",{style:{color:"var(--accent-primary)"},children:"with ThreeSided"})]}),o.jsxs("p",{className:"text-xl md:text-2xl max-w-4xl mx-auto mb-12 leading-relaxed claude-text-secondary",children:["Create, study, and share flashcards with ",o.jsx("span",{style:{color:"var(--claude-accent)",fontWeight:"600"},children:"AI assistance"}),". Learn faster with ",o.jsx("span",{style:{color:"var(--claude-accent-blue)",fontWeight:"600"},children:"spaced repetition"})," and a",o.jsx("span",{style:{color:"var(--claude-success)",fontWeight:"600"},children:" community library"}),"."]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[o.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group relative min-w-[200px] transform hover:scale-105 transition-all duration-300",style:{background:"var(--claude-accent)",boxShadow:"0 8px 32px rgba(99, 91, 255, 0.25)"},children:[o.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[" ",o.jsx("span",{children:"Search Flashcards"})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),o.jsx("button",{onClick:()=>e("leaderboard"),className:"claude-button-secondary group transform hover:scale-105 transition-all duration-300 min-w-[200px]",children:o.jsxs("span",{className:"flex items-center gap-3",children:[" ",o.jsx("span",{children:"View Leaderboard"})]})})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-8 justify-center items-center mt-16",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"500+"}),o.jsx("div",{className:"claude-text-muted",children:"Flashcards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),o.jsx("div",{className:"claude-text-muted",children:"Students"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),o.jsx("div",{className:"claude-text-muted",children:"Public"})]})]})]}),o.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce",children:o.jsx("div",{className:"w-6 h-10 border-2 border-neutral-400 rounded-full flex justify-center",children:o.jsx("div",{className:"w-1 h-3 bg-neutral-400 rounded-full mt-2 animate-pulse"})})})]}),o.jsxs("div",{className:`max-w-7xl mx-auto px-4 ${M?"py-8":"py-16"}`,children:[M&&o.jsxs("div",{className:"relative p-8 mb-16 rounded-3xl bg-neutral-800/50 border border-neutral-700 backdrop-blur-sm shadow-2xl",children:[o.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r from-blue-500/5 to-purple-500/5"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--claude-heading)"},children:" Quick Actions"}),o.jsx("p",{className:"text-neutral-300 text-lg",children:"Jump into your learning journey"})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6",children:[o.jsxs("button",{onClick:()=>{e("create"),Fn.trackClick("homepage_action",{action:"create_flashcard",location:"quick_actions"},M?.uid),Fn.trackFeatureUsage("flashcard","create_started",{},M?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--success) 0%, #10b981 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:""}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Create"}),o.jsx("div",{className:"text-white/90 text-sm",children:"New Flashcard"})]})]}),o.jsxs("button",{onClick:()=>{e("study"),Fn.trackClick("homepage_action",{action:"study_mode",location:"quick_actions"},M?.uid),Fn.trackFeatureUsage("study","session_started",{},M?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--accent-secondary) 0%, #3D4EE6 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:""}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Study"}),o.jsx("div",{className:"text-white/90 text-sm",children:"Practice Mode"})]})]}),o.jsxs("button",{onClick:()=>e("search"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--accent-primary) 0%, #5B54E6 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:""}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Search"}),o.jsx("div",{className:"text-white/90 text-sm",children:"& Discover"})]})]}),o.jsxs("button",{onClick:()=>e("dashboard"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--warning) 0%, #E6A441 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:""}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Dashboard"}),o.jsx("div",{className:"text-white/90 text-sm",children:"My Progress"})]})]}),o.jsxs("button",{onClick:()=>e("decks"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:""}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Decks"}),o.jsx("div",{className:"text-white/90 text-sm",children:"Organize Cards"})]})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 gap-8 mb-16 lg:grid-cols-3",children:[o.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:""}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"CommunityDriven"}),o.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Discover and share flashcards with students worldwide. Learn from the community's collective knowledge and contribute your own."})]})]}),o.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:""}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"AIPowered Assistance"}),o.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Get AIgenerated hints, proofs, and suggestions to help you create better flashcards faster and study more effectively."})]})]}),o.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:""}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"LaTeX Support"}),o.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Beautiful mathematical notation with full LaTeX rendering. Use $...$ for inline math and $$...$$ for display blocks."})]})]})]}),o.jsxs("div",{className:"claude-card relative p-8 mb-16 backdrop-blur-sm shadow-2xl",children:[o.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-success-500/5 to-accent-500/5"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--heading)"},children:" Get Started"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Complete these quick steps to join our community"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 cursor-pointer ${M?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10"}`,onClick:()=>Y("login"),children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${M?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:M?"":"1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:M?"Signed In":"Sign In"}),o.jsx("div",{className:"claude-text-secondary text-sm",children:M?`Welcome, ${M.displayName?.split(" ")[0]||"User"}!`:"Use Google to get started"})]})]})}),o.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasProfile?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":M?"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10 cursor-pointer":"bg-white/5 border-white/10 opacity-50"}`,onClick:M&&!m.hasProfile?()=>Y("profile"):void 0,children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasProfile?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:m.hasProfile?"":"2"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasProfile?"Profile Created":"Create Profile"}),o.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasProfile?"Profile is ready!":"Set display name & avatar"})]})]})}),o.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasCards?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":M?"bg-white/5 border-white/20":"bg-white/5 border-white/10 opacity-50"}`,children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasCards?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:m.hasCards?"":"3"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasCards?"First Card Published":"Publish First Card"}),o.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasCards?"Nice work!":"Share with the community"})]})]})})]}),M&&!m.hasCards&&o.jsx("div",{className:"text-center mt-8",children:o.jsx("button",{onClick:()=>e("create"),className:"claude-button-primary px-8 py-4 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:" Create Your First Card"})})]})]}),o.jsxs("div",{className:"relative overflow-hidden p-16 mb-16 rounded-3xl bg-gradient-to-br from-accent-500/20 via-primary-500/20 to-secondary-500/20 border border-white/20 text-center group hover:scale-105 transition-all duration-500",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-accent-500/10 to-primary-500/10"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-accent-400 to-primary-500 rounded-3xl mb-8 text-5xl shadow-2xl group-hover:shadow-glow/80 transition-all duration-300",children:""}),o.jsx("h2",{className:"text-4xl md:text-5xl font-extrabold mb-6",style:{color:"var(--heading)"},children:" Looking for something specific?"}),o.jsxs("p",{className:"text-xl claude-text-secondary max-w-3xl mx-auto mb-8 leading-relaxed",children:["Search our community database of ",o.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"600"},children:"10,000+ flashcards"})," from",o.jsx("span",{style:{color:"var(--accent-secondary)",fontWeight:"600"},children:" students worldwide"}),". Find exactly what you need to ace your studies."]}),o.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group/btn relative overflow-hidden px-12 py-6 font-semibold text-lg shadow-2xl transform hover:scale-105 transition-all duration-300",children:[o.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[" ",o.jsx("span",{children:"Search Community Flashcards"})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 opacity-0 group-hover/btn:opacity-100 transition-opacity duration-300"})]})]})]}),o.jsx("footer",{className:"claude-card relative overflow-hidden mt-24 py-16",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[o.jsxs("div",{className:"text-center mb-12",children:[o.jsxs("div",{className:"inline-flex items-center gap-3 mb-4",children:[o.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"48",height:"48",className:"rounded-xl shadow-lg"}),o.jsx("span",{className:"text-3xl font-extrabold",style:{color:"var(--heading)"},children:"ThreeSided"})]}),o.jsx("p",{className:"claude-text-secondary text-lg max-w-2xl mx-auto",children:"Empowering students worldwide with AI-enhanced flashcards and collaborative learning."})]}),o.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-8 pt-8",style:{borderTop:"1px solid var(--border-light)"},children:[o.jsxs("div",{className:"claude-text-muted",children:[" ",new Date().getFullYear()," ThreeSided. Made with  for students."]}),o.jsxs("div",{className:"flex items-center gap-8",children:[o.jsx("a",{href:"mailto:amirbattye@gmail.com",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-primary)"},children:"Contact"}),o.jsx("a",{href:"/latex_guide.html",target:"_blank",rel:"noreferrer",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-secondary)"},children:"LaTeX Guide"}),o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:[o.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),o.jsx("span",{className:"font-medium",children:"Beta"})]})]})]})]})})]})]});return o.jsxs("div",{className:"min-h-screen",children:[o.jsx(ue,{}),xe(),o.jsx(p3,{isVisible:x,onClose:()=>_(!1),selectedTags:[],onTagsChange:()=>{}}),o.jsx(v3,{isVisible:b,onClose:()=>N(!1)}),o.jsx(_3,{isVisible:C,onClose:()=>k(!1)}),o.jsx(T3,{isVisible:L,onClose:()=>F(!1)}),I&&o.jsx("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4 shadow-2xl",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsx("h3",{className:"text-lg font-bold text-orange-600",children:"Session Timeout Warning"})]}),o.jsx("p",{className:"text-gray-700 mb-6",children:`Your session will expire soon due to inactivity. Click "Stay Active" to continue, or you'll be signed out automatically.`}),o.jsxs("div",{className:"flex gap-3 justify-end",children:[o.jsx("button",{onClick:()=>{G(),T()},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Sign Out"}),o.jsx("button",{onClick:G,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Stay Active"})]})]})})]})}const x6=()=>o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"var(--background-main)"},children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-t-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-lg font-medium",style:{color:"var(--text-main)"},children:"Loading Three-Sided..."})]})});s1.createRoot(document.getElementById("root")).render(o.jsx(P.StrictMode,{children:o.jsx(t3,{fallback:o.jsx(x6,{}),children:o.jsx(y6,{})})}));
