(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();var Hp={exports:{}},Pu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U_;function e1(){if(U_)return Pu;U_=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,l){var u=null;if(l!==void 0&&(u=""+l),i.key!==void 0&&(u=""+i.key),"key"in i){l={};for(var h in i)h!=="key"&&(l[h]=i[h])}else l=i;return i=l.ref,{$$typeof:s,type:n,key:u,ref:i!==void 0?i:null,props:l}}return Pu.Fragment=e,Pu.jsx=t,Pu.jsxs=t,Pu}var F_;function t1(){return F_||(F_=1,Hp.exports=e1()),Hp.exports}var o=t1(),$p={exports:{}},Ge={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q_;function n1(){if(q_)return Ge;q_=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),b=Symbol.iterator;function w(j){return j===null||typeof j!="object"?null:(j=b&&j[b]||j["@@iterator"],typeof j=="function"?j:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V=Object.assign,D={};function q(j,oe,ge){this.props=j,this.context=oe,this.refs=D,this.updater=ge||N}q.prototype.isReactComponent={},q.prototype.setState=function(j,oe){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,oe,"setState")},q.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function z(){}z.prototype=q.prototype;function B(j,oe,ge){this.props=j,this.context=oe,this.refs=D,this.updater=ge||N}var L=B.prototype=new z;L.constructor=B,V(L,q.prototype),L.isPureReactComponent=!0;var G=Array.isArray,H={H:null,A:null,T:null,S:null,V:null},R=Object.prototype.hasOwnProperty;function C(j,oe,ge,me,Ae,we){return ge=we.ref,{$$typeof:s,type:j,key:oe,ref:ge!==void 0?ge:null,props:we}}function T(j,oe){return C(j.type,oe,void 0,void 0,void 0,j.props)}function A(j){return typeof j=="object"&&j!==null&&j.$$typeof===s}function k(j){var oe={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(ge){return oe[ge]})}var U=/\/+/g;function $(j,oe){return typeof j=="object"&&j!==null&&j.key!=null?k(""+j.key):oe.toString(36)}function M(){}function ze(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(M,M):(j.status="pending",j.then(function(oe){j.status==="pending"&&(j.status="fulfilled",j.value=oe)},function(oe){j.status==="pending"&&(j.status="rejected",j.reason=oe)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function se(j,oe,ge,me,Ae){var we=typeof j;(we==="undefined"||we==="boolean")&&(j=null);var Ee=!1;if(j===null)Ee=!0;else switch(we){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(j.$$typeof){case s:case e:Ee=!0;break;case x:return Ee=j._init,se(Ee(j._payload),oe,ge,me,Ae)}}if(Ee)return Ae=Ae(j),Ee=me===""?"."+$(j,0):me,G(Ae)?(ge="",Ee!=null&&(ge=Ee.replace(U,"$&/")+"/"),se(Ae,oe,ge,"",function(Te){return Te})):Ae!=null&&(A(Ae)&&(Ae=T(Ae,ge+(Ae.key==null||j&&j.key===Ae.key?"":(""+Ae.key).replace(U,"$&/")+"/")+Ee)),oe.push(Ae)),1;Ee=0;var le=me===""?".":me+":";if(G(j))for(var ye=0;ye<j.length;ye++)me=j[ye],we=le+$(me,ye),Ee+=se(me,oe,ge,we,Ae);else if(ye=w(j),typeof ye=="function")for(j=ye.call(j),ye=0;!(me=j.next()).done;)me=me.value,we=le+$(me,ye++),Ee+=se(me,oe,ge,we,Ae);else if(we==="object"){if(typeof j.then=="function")return se(ze(j),oe,ge,me,Ae);throw oe=String(j),Error("Objects are not valid as a React child (found: "+(oe==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":oe)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function F(j,oe,ge){if(j==null)return j;var me=[],Ae=0;return se(j,me,"","",function(we){return oe.call(ge,we,Ae++)}),me}function ie(j){if(j._status===-1){var oe=j._result;oe=oe(),oe.then(function(ge){(j._status===0||j._status===-1)&&(j._status=1,j._result=ge)},function(ge){(j._status===0||j._status===-1)&&(j._status=2,j._result=ge)}),j._status===-1&&(j._status=0,j._result=oe)}if(j._status===1)return j._result.default;throw j._result}var K=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var oe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(oe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)};function pe(){}return Ge.Children={map:F,forEach:function(j,oe,ge){F(j,function(){oe.apply(this,arguments)},ge)},count:function(j){var oe=0;return F(j,function(){oe++}),oe},toArray:function(j){return F(j,function(oe){return oe})||[]},only:function(j){if(!A(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},Ge.Component=q,Ge.Fragment=t,Ge.Profiler=i,Ge.PureComponent=B,Ge.StrictMode=n,Ge.Suspense=m,Ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Ge.__COMPILER_RUNTIME={__proto__:null,c:function(j){return H.H.useMemoCache(j)}},Ge.cache=function(j){return function(){return j.apply(null,arguments)}},Ge.cloneElement=function(j,oe,ge){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var me=V({},j.props),Ae=j.key,we=void 0;if(oe!=null)for(Ee in oe.ref!==void 0&&(we=void 0),oe.key!==void 0&&(Ae=""+oe.key),oe)!R.call(oe,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&oe.ref===void 0||(me[Ee]=oe[Ee]);var Ee=arguments.length-2;if(Ee===1)me.children=ge;else if(1<Ee){for(var le=Array(Ee),ye=0;ye<Ee;ye++)le[ye]=arguments[ye+2];me.children=le}return C(j.type,Ae,void 0,void 0,we,me)},Ge.createContext=function(j){return j={$$typeof:u,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:l,_context:j},j},Ge.createElement=function(j,oe,ge){var me,Ae={},we=null;if(oe!=null)for(me in oe.key!==void 0&&(we=""+oe.key),oe)R.call(oe,me)&&me!=="key"&&me!=="__self"&&me!=="__source"&&(Ae[me]=oe[me]);var Ee=arguments.length-2;if(Ee===1)Ae.children=ge;else if(1<Ee){for(var le=Array(Ee),ye=0;ye<Ee;ye++)le[ye]=arguments[ye+2];Ae.children=le}if(j&&j.defaultProps)for(me in Ee=j.defaultProps,Ee)Ae[me]===void 0&&(Ae[me]=Ee[me]);return C(j,we,void 0,void 0,null,Ae)},Ge.createRef=function(){return{current:null}},Ge.forwardRef=function(j){return{$$typeof:h,render:j}},Ge.isValidElement=A,Ge.lazy=function(j){return{$$typeof:x,_payload:{_status:-1,_result:j},_init:ie}},Ge.memo=function(j,oe){return{$$typeof:p,type:j,compare:oe===void 0?null:oe}},Ge.startTransition=function(j){var oe=H.T,ge={};H.T=ge;try{var me=j(),Ae=H.S;Ae!==null&&Ae(ge,me),typeof me=="object"&&me!==null&&typeof me.then=="function"&&me.then(pe,K)}catch(we){K(we)}finally{H.T=oe}},Ge.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Ge.use=function(j){return H.H.use(j)},Ge.useActionState=function(j,oe,ge){return H.H.useActionState(j,oe,ge)},Ge.useCallback=function(j,oe){return H.H.useCallback(j,oe)},Ge.useContext=function(j){return H.H.useContext(j)},Ge.useDebugValue=function(){},Ge.useDeferredValue=function(j,oe){return H.H.useDeferredValue(j,oe)},Ge.useEffect=function(j,oe,ge){var me=H.H;if(typeof ge=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return me.useEffect(j,oe)},Ge.useId=function(){return H.H.useId()},Ge.useImperativeHandle=function(j,oe,ge){return H.H.useImperativeHandle(j,oe,ge)},Ge.useInsertionEffect=function(j,oe){return H.H.useInsertionEffect(j,oe)},Ge.useLayoutEffect=function(j,oe){return H.H.useLayoutEffect(j,oe)},Ge.useMemo=function(j,oe){return H.H.useMemo(j,oe)},Ge.useOptimistic=function(j,oe){return H.H.useOptimistic(j,oe)},Ge.useReducer=function(j,oe,ge){return H.H.useReducer(j,oe,ge)},Ge.useRef=function(j){return H.H.useRef(j)},Ge.useState=function(j){return H.H.useState(j)},Ge.useSyncExternalStore=function(j,oe,ge){return H.H.useSyncExternalStore(j,oe,ge)},Ge.useTransition=function(){return H.H.useTransition()},Ge.version="19.1.1",Ge}var B_;function sx(){return B_||(B_=1,$p.exports=n1()),$p.exports}var P=sx(),Qp={exports:{}},Mu={},Kp={exports:{}},Yp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z_;function s1(){return z_||(z_=1,(function(s){function e(F,ie){var K=F.length;F.push(ie);e:for(;0<K;){var pe=K-1>>>1,j=F[pe];if(0<i(j,ie))F[pe]=ie,F[K]=j,K=pe;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var ie=F[0],K=F.pop();if(K!==ie){F[0]=K;e:for(var pe=0,j=F.length,oe=j>>>1;pe<oe;){var ge=2*(pe+1)-1,me=F[ge],Ae=ge+1,we=F[Ae];if(0>i(me,K))Ae<j&&0>i(we,me)?(F[pe]=we,F[Ae]=K,pe=Ae):(F[pe]=me,F[ge]=K,pe=ge);else if(Ae<j&&0>i(we,K))F[pe]=we,F[Ae]=K,pe=Ae;else break e}}return ie}function i(F,ie){var K=F.sortIndex-ie.sortIndex;return K!==0?K:F.id-ie.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;s.unstable_now=function(){return l.now()}}else{var u=Date,h=u.now();s.unstable_now=function(){return u.now()-h}}var m=[],p=[],x=1,b=null,w=3,N=!1,V=!1,D=!1,q=!1,z=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function G(F){for(var ie=t(p);ie!==null;){if(ie.callback===null)n(p);else if(ie.startTime<=F)n(p),ie.sortIndex=ie.expirationTime,e(m,ie);else break;ie=t(p)}}function H(F){if(D=!1,G(F),!V)if(t(m)!==null)V=!0,R||(R=!0,$());else{var ie=t(p);ie!==null&&se(H,ie.startTime-F)}}var R=!1,C=-1,T=5,A=-1;function k(){return q?!0:!(s.unstable_now()-A<T)}function U(){if(q=!1,R){var F=s.unstable_now();A=F;var ie=!0;try{e:{V=!1,D&&(D=!1,B(C),C=-1),N=!0;var K=w;try{t:{for(G(F),b=t(m);b!==null&&!(b.expirationTime>F&&k());){var pe=b.callback;if(typeof pe=="function"){b.callback=null,w=b.priorityLevel;var j=pe(b.expirationTime<=F);if(F=s.unstable_now(),typeof j=="function"){b.callback=j,G(F),ie=!0;break t}b===t(m)&&n(m),G(F)}else n(m);b=t(m)}if(b!==null)ie=!0;else{var oe=t(p);oe!==null&&se(H,oe.startTime-F),ie=!1}}break e}finally{b=null,w=K,N=!1}ie=void 0}}finally{ie?$():R=!1}}}var $;if(typeof L=="function")$=function(){L(U)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,ze=M.port2;M.port1.onmessage=U,$=function(){ze.postMessage(null)}}else $=function(){z(U,0)};function se(F,ie){C=z(function(){F(s.unstable_now())},ie)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(F){F.callback=null},s.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<F?Math.floor(1e3/F):5},s.unstable_getCurrentPriorityLevel=function(){return w},s.unstable_next=function(F){switch(w){case 1:case 2:case 3:var ie=3;break;default:ie=w}var K=w;w=ie;try{return F()}finally{w=K}},s.unstable_requestPaint=function(){q=!0},s.unstable_runWithPriority=function(F,ie){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var K=w;w=F;try{return ie()}finally{w=K}},s.unstable_scheduleCallback=function(F,ie,K){var pe=s.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?pe+K:pe):K=pe,F){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=K+j,F={id:x++,callback:ie,priorityLevel:F,startTime:K,expirationTime:j,sortIndex:-1},K>pe?(F.sortIndex=K,e(p,F),t(m)===null&&F===t(p)&&(D?(B(C),C=-1):D=!0,se(H,K-pe))):(F.sortIndex=j,e(m,F),V||N||(V=!0,R||(R=!0,$()))),F},s.unstable_shouldYield=k,s.unstable_wrapCallback=function(F){var ie=w;return function(){var K=w;w=ie;try{return F.apply(this,arguments)}finally{w=K}}}})(Yp)),Yp}var G_;function r1(){return G_||(G_=1,Kp.exports=s1()),Kp.exports}var Xp={exports:{}},Mn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H_;function a1(){if(H_)return Mn;H_=1;var s=sx();function e(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(m,p,x){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:b==null?null:""+b,children:m,containerInfo:p,implementation:x}}var u=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Mn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Mn.createPortal=function(m,p){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(m,p,null,x)},Mn.flushSync=function(m){var p=u.T,x=n.p;try{if(u.T=null,n.p=2,m)return m()}finally{u.T=p,n.p=x,n.d.f()}},Mn.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,n.d.C(m,p))},Mn.prefetchDNS=function(m){typeof m=="string"&&n.d.D(m)},Mn.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var x=p.as,b=h(x,p.crossOrigin),w=typeof p.integrity=="string"?p.integrity:void 0,N=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;x==="style"?n.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:w,fetchPriority:N}):x==="script"&&n.d.X(m,{crossOrigin:b,integrity:w,fetchPriority:N,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Mn.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var x=h(p.as,p.crossOrigin);n.d.M(m,{crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&n.d.M(m)},Mn.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var x=p.as,b=h(x,p.crossOrigin);n.d.L(m,x,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Mn.preloadModule=function(m,p){if(typeof m=="string")if(p){var x=h(p.as,p.crossOrigin);n.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else n.d.m(m)},Mn.requestFormReset=function(m){n.d.r(m)},Mn.unstable_batchedUpdates=function(m,p){return m(p)},Mn.useFormState=function(m,p,x){return u.H.useFormState(m,p,x)},Mn.useFormStatus=function(){return u.H.useHostTransitionStatus()},Mn.version="19.1.1",Mn}var $_;function i1(){if($_)return Xp.exports;$_=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Xp.exports=a1(),Xp.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q_;function o1(){if(Q_)return Mu;Q_=1;var s=r1(),e=sx(),t=i1();function n(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var a=r,c=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(c=a.return),r=a.return;while(r)}return a.tag===3?c:null}function u(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function h(r){if(l(r)!==r)throw Error(n(188))}function m(r){var a=r.alternate;if(!a){if(a=l(r),a===null)throw Error(n(188));return a!==r?null:r}for(var c=r,d=a;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(d=g.return,d!==null){c=d;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return h(g),r;if(y===d)return h(g),a;y=y.sibling}throw Error(n(188))}if(c.return!==d.return)c=g,d=y;else{for(var E=!1,S=g.child;S;){if(S===c){E=!0,c=g,d=y;break}if(S===d){E=!0,d=g,c=y;break}S=S.sibling}if(!E){for(S=y.child;S;){if(S===c){E=!0,c=y,d=g;break}if(S===d){E=!0,d=y,c=g;break}S=S.sibling}if(!E)throw Error(n(189))}}if(c.alternate!==d)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?r:a}function p(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=p(r),a!==null)return a;r=r.sibling}return null}var x=Object.assign,b=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),B=Symbol.for("react.consumer"),L=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),k=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function $(r){return r===null||typeof r!="object"?null:(r=U&&r[U]||r["@@iterator"],typeof r=="function"?r:null)}var M=Symbol.for("react.client.reference");function ze(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===M?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case V:return"Fragment";case q:return"Profiler";case D:return"StrictMode";case H:return"Suspense";case R:return"SuspenseList";case A:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case N:return"Portal";case L:return(r.displayName||"Context")+".Provider";case B:return(r._context.displayName||"Context")+".Consumer";case G:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case C:return a=r.displayName||null,a!==null?a:ze(r.type)||"Memo";case T:a=r._payload,r=r._init;try{return ze(r(a))}catch{}}return null}var se=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},pe=[],j=-1;function oe(r){return{current:r}}function ge(r){0>j||(r.current=pe[j],pe[j]=null,j--)}function me(r,a){j++,pe[j]=r.current,r.current=a}var Ae=oe(null),we=oe(null),Ee=oe(null),le=oe(null);function ye(r,a){switch(me(Ee,a),me(we,r),me(Ae,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?f_(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=f_(a),r=m_(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ge(Ae),me(Ae,r)}function Te(){ge(Ae),ge(we),ge(Ee)}function Oe(r){r.memoizedState!==null&&me(le,r);var a=Ae.current,c=m_(a,r.type);a!==c&&(me(we,r),me(Ae,c))}function nt(r){we.current===r&&(ge(Ae),ge(we)),le.current===r&&(ge(le),ju._currentValue=K)}var He=Object.prototype.hasOwnProperty,ut=s.unstable_scheduleCallback,$e=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,vt=s.unstable_requestPaint,St=s.unstable_now,Lt=s.unstable_getCurrentPriorityLevel,ws=s.unstable_ImmediatePriority,gn=s.unstable_UserBlockingPriority,$n=s.unstable_NormalPriority,Ir=s.unstable_LowPriority,jr=s.unstable_IdlePriority,Ti=s.log,Oo=s.unstable_setDisableYieldValue,qt=null,ft=null;function os(r){if(typeof Ti=="function"&&Oo(r),ft&&typeof ft.setStrictMode=="function")try{ft.setStrictMode(qt,r)}catch{}}var Dn=Math.clz32?Math.clz32:Ei,Fd=Math.log,Qm=Math.LN2;function Ei(r){return r>>>=0,r===0?32:31-(Fd(r)/Qm|0)|0}var Si=256,Ni=4194304;function Us(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Lo(r,a,c){var d=r.pendingLanes;if(d===0)return 0;var g=0,y=r.suspendedLanes,E=r.pingedLanes;r=r.warmLanes;var S=d&134217727;return S!==0?(d=S&~y,d!==0?g=Us(d):(E&=S,E!==0?g=Us(E):c||(c=S&~r,c!==0&&(g=Us(c))))):(S=d&~y,S!==0?g=Us(S):E!==0?g=Us(E):c||(c=d&~r,c!==0&&(g=Us(c)))),g===0?0:a!==0&&a!==g&&(a&y)===0&&(y=g&-g,c=a&-a,y>=c||y===32&&(c&4194048)!==0)?a:g}function Ai(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function jc(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cc(){var r=Si;return Si<<=1,(Si&4194048)===0&&(Si=256),r}function Rc(){var r=Ni;return Ni<<=1,(Ni&62914560)===0&&(Ni=4194304),r}function Cr(r){for(var a=[],c=0;31>c;c++)a.push(r);return a}function Rr(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function kc(r,a,c,d,g,y){var E=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var S=r.entanglements,O=r.expirationTimes,Z=r.hiddenUpdates;for(c=E&~c;0<c;){var ce=31-Dn(c),he=1<<ce;S[ce]=0,O[ce]=-1;var ne=Z[ce];if(ne!==null)for(Z[ce]=null,ce=0;ce<ne.length;ce++){var re=ne[ce];re!==null&&(re.lane&=-536870913)}c&=~he}d!==0&&er(r,d,0),y!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=y&~(E&~a))}function er(r,a,c){r.pendingLanes|=a,r.suspendedLanes&=~a;var d=31-Dn(a);r.entangledLanes|=a,r.entanglements[d]=r.entanglements[d]|1073741824|c&4194090}function Dc(r,a){var c=r.entangledLanes|=a;for(r=r.entanglements;c;){var d=31-Dn(c),g=1<<d;g&a|r[d]&a&&(r[d]|=a),c&=~g}}function pa(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Uo(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function ya(){var r=ie.p;return r!==0?r:(r=window.event,r===void 0?32:D_(r.type))}function qd(r,a){var c=ie.p;try{return ie.p=r,a()}finally{ie.p=c}}var kt=Math.random().toString(36).slice(2),an="__reactFiber$"+kt,Jt="__reactProps$"+kt,Ts="__reactContainer$"+kt,Pc="__reactEvents$"+kt,Km="__reactListeners$"+kt,xa="__reactHandles$"+kt,Bd="__reactResources$"+kt,Ii="__reactMarker$"+kt;function va(r){delete r[an],delete r[Jt],delete r[Pc],delete r[Km],delete r[xa]}function kr(r){var a=r[an];if(a)return a;for(var c=r.parentNode;c;){if(a=c[Ts]||c[an]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(r=x_(r);r!==null;){if(c=r[an])return c;r=x_(r)}return a}r=c,c=r.parentNode}return null}function tr(r){if(r=r[an]||r[Ts]){var a=r.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return r}return null}function nr(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(n(33))}function Bn(r){var a=r[Bd];return a||(a=r[Bd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function $t(r){r[Ii]=!0}var Mc=new Set,Fo={};function Fs(r,a){Dr(r,a),Dr(r+"Capture",a)}function Dr(r,a){for(Fo[r]=a,r=0;r<a.length;r++)Mc.add(a[r])}var zd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Gd={},ji={};function Hd(r){return He.call(ji,r)?!0:He.call(Gd,r)?!1:zd.test(r)?ji[r]=!0:(Gd[r]=!0,!1)}function ba(r,a,c){if(Hd(a))if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+c)}}function sr(r,a,c){if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+c)}}function Nn(r,a,c,d){if(d===null)r.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(a,c,""+d)}}var Ci,$d;function Pr(r){if(Ci===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);Ci=a&&a[1]||"",$d=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ci+r+$d}var qo=!1;function Bo(r,a){if(!r||qo)return"";qo=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var he=function(){throw Error()};if(Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch(re){var ne=re}Reflect.construct(r,[],he)}else{try{he.call()}catch(re){ne=re}r.call(he.prototype)}}else{try{throw Error()}catch(re){ne=re}(he=r())&&typeof he.catch=="function"&&he.catch(function(){})}}catch(re){if(re&&ne&&typeof re.stack=="string")return[re.stack,ne.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=d.DetermineComponentFrameRoot(),E=y[0],S=y[1];if(E&&S){var O=E.split(`
`),Z=S.split(`
`);for(g=d=0;d<O.length&&!O[d].includes("DetermineComponentFrameRoot");)d++;for(;g<Z.length&&!Z[g].includes("DetermineComponentFrameRoot");)g++;if(d===O.length||g===Z.length)for(d=O.length-1,g=Z.length-1;1<=d&&0<=g&&O[d]!==Z[g];)g--;for(;1<=d&&0<=g;d--,g--)if(O[d]!==Z[g]){if(d!==1||g!==1)do if(d--,g--,0>g||O[d]!==Z[g]){var ce=`
`+O[d].replace(" at new "," at ");return r.displayName&&ce.includes("<anonymous>")&&(ce=ce.replace("<anonymous>",r.displayName)),ce}while(1<=d&&0<=g);break}}}finally{qo=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Pr(c):""}function Vc(r){switch(r.tag){case 26:case 27:case 5:return Pr(r.type);case 16:return Pr("Lazy");case 13:return Pr("Suspense");case 19:return Pr("SuspenseList");case 0:case 15:return Bo(r.type,!1);case 11:return Bo(r.type.render,!1);case 1:return Bo(r.type,!0);case 31:return Pr("Activity");default:return""}}function zo(r){try{var a="";do a+=Vc(r),r=r.return;while(r);return a}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function zn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Oc(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ym(r){var a=Oc(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,a),d=""+r[a];if(!r.hasOwnProperty(a)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,y=c.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return g.call(this)},set:function(E){d=""+E,y.call(this,E)}}),Object.defineProperty(r,a,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(E){d=""+E},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function Go(r){r._valueTracker||(r._valueTracker=Ym(r))}function Lc(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var c=a.getValue(),d="";return r&&(d=Oc(r)?r.checked?"true":"false":r.value),r=d,r!==c?(a.setValue(r),!0):!1}function Ri(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Xm=/[\n"\\]/g;function Zt(r){return r.replace(Xm,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function ls(r,a,c,d,g,y,E,S){r.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?r.type=E:r.removeAttribute("type"),a!=null?E==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+zn(a)):r.value!==""+zn(a)&&(r.value=""+zn(a)):E!=="submit"&&E!=="reset"||r.removeAttribute("value"),a!=null?_a(r,E,zn(a)):c!=null?_a(r,E,zn(c)):d!=null&&r.removeAttribute("value"),g==null&&y!=null&&(r.defaultChecked=!!y),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?r.name=""+zn(S):r.removeAttribute("name")}function ki(r,a,c,d,g,y,E,S){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(r.type=y),a!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||a!=null))return;c=c!=null?""+zn(c):"",a=a!=null?""+zn(a):c,S||a===r.value||(r.value=a),r.defaultValue=a}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=S?r.checked:!!d,r.defaultChecked=!!d,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(r.name=E)}function _a(r,a,c){a==="number"&&Ri(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Mr(r,a,c,d){if(r=r.options,a){a={};for(var g=0;g<c.length;g++)a["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=a.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&d&&(r[c].defaultSelected=!0)}else{for(c=""+zn(c),a=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,d&&(r[g].defaultSelected=!0);return}a!==null||r[g].disabled||(a=r[g])}a!==null&&(a.selected=!0)}}function bt(r,a,c){if(a!=null&&(a=""+zn(a),a!==r.value&&(r.value=a),c==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=c!=null?""+zn(c):""}function Di(r,a,c,d){if(a==null){if(d!=null){if(c!=null)throw Error(n(92));if(se(d)){if(1<d.length)throw Error(n(93));d=d[0]}c=d}c==null&&(c=""),a=c}c=zn(a),r.defaultValue=c,d=r.textContent,d===c&&d!==""&&d!==null&&(r.value=d)}function Es(r,a){if(a){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=a;return}}r.textContent=a}var Pi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qd(r,a,c){var d=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":d?r.setProperty(a,c):typeof c!="number"||c===0||Pi.has(a)?a==="float"?r.cssFloat=c:r[a]=(""+c).trim():r[a]=c+"px"}function Uc(r,a,c){if(a!=null&&typeof a!="object")throw Error(n(62));if(r=r.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var g in a)d=a[g],a.hasOwnProperty(g)&&c[g]!==d&&Qd(r,g,d)}else for(var y in a)a.hasOwnProperty(y)&&Qd(r,y,a[y])}function Fc(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wm=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Jm=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ho(r){return Jm.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var Vr=null;function Ss(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Or=null,Lr=null;function qc(r){var a=tr(r);if(a&&(r=a.stateNode)){var c=r[Jt]||null;e:switch(r=a.stateNode,a.type){case"input":if(ls(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Zt(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var d=c[a];if(d!==r&&d.form===r.form){var g=d[Jt]||null;if(!g)throw Error(n(90));ls(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(a=0;a<c.length;a++)d=c[a],d.form===r.form&&Lc(d)}break e;case"textarea":bt(r,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Mr(r,!!c.multiple,a,!1)}}}var rr=!1;function Kd(r,a,c){if(rr)return r(a,c);rr=!0;try{var d=r(a);return d}finally{if(rr=!1,(Or!==null||Lr!==null)&&(qh(),Or&&(a=Or,r=Lr,Lr=Or=null,qc(a),r)))for(a=0;a<r.length;a++)qc(r[a])}}function Mi(r,a){var c=r.stateNode;if(c===null)return null;var d=c[Jt]||null;if(d===null)return null;c=d[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(n(231,a,typeof c));return c}var qs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ns=!1;if(qs)try{var Vi={};Object.defineProperty(Vi,"passive",{get:function(){Ns=!0}}),window.addEventListener("test",Vi,Vi),window.removeEventListener("test",Vi,Vi)}catch{Ns=!1}var ar=null,wa=null,Ur=null;function Bc(){if(Ur)return Ur;var r,a=wa,c=a.length,d,g="value"in ar?ar.value:ar.textContent,y=g.length;for(r=0;r<c&&a[r]===g[r];r++);var E=c-r;for(d=1;d<=E&&a[c-d]===g[y-d];d++);return Ur=g.slice(r,1<d?1-d:void 0)}function ir(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function or(){return!0}function zc(){return!1}function pn(r){function a(c,d,g,y,E){this._reactName=c,this._targetInst=g,this.type=d,this.nativeEvent=y,this.target=E,this.currentTarget=null;for(var S in r)r.hasOwnProperty(S)&&(c=r[S],this[S]=c?c(y):y[S]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?or:zc,this.isPropagationStopped=zc,this}return x(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=or)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=or)},persist:function(){},isPersistent:or}),a}var dt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$o=pn(dt),Oi=x({},dt,{view:0,detail:0}),Yd=pn(Oi),Qo,Ko,lr,Li=x({},Oi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qi,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==lr&&(lr&&r.type==="mousemove"?(Qo=r.screenX-lr.screenX,Ko=r.screenY-lr.screenY):Ko=Qo=0,lr=r),Qo)},movementY:function(r){return"movementY"in r?r.movementY:Ko}}),As=pn(Li),Xd=x({},Li,{dataTransfer:0}),Zm=pn(Xd),Ui=x({},Oi,{relatedTarget:0}),Yo=pn(Ui),Gc=x({},dt,{animationName:0,elapsedTime:0,pseudoElement:0}),Xo=pn(Gc),Wd=x({},dt,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Wo=pn(Wd),eg=x({},dt,{data:0}),Hc=pn(eg),Fi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $c(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=Zd[r])?!!a[r]:!1}function qi(){return $c}var eh=x({},Oi,{key:function(r){if(r.key){var a=Fi[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=ir(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Jd[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qi,charCode:function(r){return r.type==="keypress"?ir(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ir(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Jo=pn(eh),th=x({},Li,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qc=pn(th),Fr=x({},Oi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qi}),nh=pn(Fr),sh=x({},dt,{propertyName:0,elapsedTime:0,pseudoElement:0}),rh=pn(sh),ah=x({},Li,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Zo=pn(ah),Gn=x({},dt,{newState:0,oldState:0}),ih=pn(Gn),oh=[9,13,27,32],cr=qs&&"CompositionEvent"in window,f=null;qs&&"documentMode"in document&&(f=document.documentMode);var v=qs&&"TextEvent"in window&&!f,_=qs&&(!cr||f&&8<f&&11>=f),I=" ",W=!1;function ae(r,a){switch(r){case"keyup":return oh.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ve(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var st=!1;function on(r,a){switch(r){case"compositionend":return ve(a);case"keypress":return a.which!==32?null:(W=!0,I);case"textInput":return r=a.data,r===I&&W?null:r;default:return null}}function rt(r,a){if(st)return r==="compositionend"||!cr&&ae(r,a)?(r=Bc(),Ur=wa=ar=null,st=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return _&&a.locale!=="ko"?null:a.data;default:return null}}var yn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ln(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!yn[r.type]:a==="textarea"}function qr(r,a,c,d){Or?Lr?Lr.push(d):Lr=[d]:Or=d,a=Qh(a,"onChange"),0<a.length&&(c=new $o("onChange","change",null,c,d),r.push({event:c,listeners:a}))}var An=null,ur=null;function Kc(r){l_(r,0)}function lh(r){var a=nr(r);if(Lc(a))return r}function jv(r,a){if(r==="change")return a}var Cv=!1;if(qs){var tg;if(qs){var ng="oninput"in document;if(!ng){var Rv=document.createElement("div");Rv.setAttribute("oninput","return;"),ng=typeof Rv.oninput=="function"}tg=ng}else tg=!1;Cv=tg&&(!document.documentMode||9<document.documentMode)}function kv(){An&&(An.detachEvent("onpropertychange",Dv),ur=An=null)}function Dv(r){if(r.propertyName==="value"&&lh(ur)){var a=[];qr(a,ur,r,Ss(r)),Kd(Kc,a)}}function CI(r,a,c){r==="focusin"?(kv(),An=a,ur=c,An.attachEvent("onpropertychange",Dv)):r==="focusout"&&kv()}function RI(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return lh(ur)}function kI(r,a){if(r==="click")return lh(a)}function DI(r,a){if(r==="input"||r==="change")return lh(a)}function PI(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var cs=typeof Object.is=="function"?Object.is:PI;function Yc(r,a){if(cs(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var c=Object.keys(r),d=Object.keys(a);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var g=c[d];if(!He.call(a,g)||!cs(r[g],a[g]))return!1}return!0}function Pv(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Mv(r,a){var c=Pv(r);r=0;for(var d;c;){if(c.nodeType===3){if(d=r+c.textContent.length,r<=a&&d>=a)return{node:c,offset:a-r};r=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Pv(c)}}function Vv(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?Vv(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function Ov(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=Ri(r.document);a instanceof r.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)r=a.contentWindow;else break;a=Ri(r.document)}return a}function sg(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var MI=qs&&"documentMode"in document&&11>=document.documentMode,el=null,rg=null,Xc=null,ag=!1;function Lv(r,a,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;ag||el==null||el!==Ri(d)||(d=el,"selectionStart"in d&&sg(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Xc&&Yc(Xc,d)||(Xc=d,d=Qh(rg,"onSelect"),0<d.length&&(a=new $o("onSelect","select",null,a,c),r.push({event:a,listeners:d}),a.target=el)))}function Bi(r,a){var c={};return c[r.toLowerCase()]=a.toLowerCase(),c["Webkit"+r]="webkit"+a,c["Moz"+r]="moz"+a,c}var tl={animationend:Bi("Animation","AnimationEnd"),animationiteration:Bi("Animation","AnimationIteration"),animationstart:Bi("Animation","AnimationStart"),transitionrun:Bi("Transition","TransitionRun"),transitionstart:Bi("Transition","TransitionStart"),transitioncancel:Bi("Transition","TransitionCancel"),transitionend:Bi("Transition","TransitionEnd")},ig={},Uv={};qs&&(Uv=document.createElement("div").style,"AnimationEvent"in window||(delete tl.animationend.animation,delete tl.animationiteration.animation,delete tl.animationstart.animation),"TransitionEvent"in window||delete tl.transitionend.transition);function zi(r){if(ig[r])return ig[r];if(!tl[r])return r;var a=tl[r],c;for(c in a)if(a.hasOwnProperty(c)&&c in Uv)return ig[r]=a[c];return r}var Fv=zi("animationend"),qv=zi("animationiteration"),Bv=zi("animationstart"),VI=zi("transitionrun"),OI=zi("transitionstart"),LI=zi("transitioncancel"),zv=zi("transitionend"),Gv=new Map,og="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");og.push("scrollEnd");function Bs(r,a){Gv.set(r,a),Fs(a,[r])}var Hv=new WeakMap;function Is(r,a){if(typeof r=="object"&&r!==null){var c=Hv.get(r);return c!==void 0?c:(a={value:r,source:a,stack:zo(a)},Hv.set(r,a),a)}return{value:r,source:a,stack:zo(a)}}var js=[],nl=0,lg=0;function ch(){for(var r=nl,a=lg=nl=0;a<r;){var c=js[a];js[a++]=null;var d=js[a];js[a++]=null;var g=js[a];js[a++]=null;var y=js[a];if(js[a++]=null,d!==null&&g!==null){var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}y!==0&&$v(c,g,y)}}function uh(r,a,c,d){js[nl++]=r,js[nl++]=a,js[nl++]=c,js[nl++]=d,lg|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function cg(r,a,c,d){return uh(r,a,c,d),dh(r)}function sl(r,a){return uh(r,null,null,a),dh(r)}function $v(r,a,c){r.lanes|=c;var d=r.alternate;d!==null&&(d.lanes|=c);for(var g=!1,y=r.return;y!==null;)y.childLanes|=c,d=y.alternate,d!==null&&(d.childLanes|=c),y.tag===22&&(r=y.stateNode,r===null||r._visibility&1||(g=!0)),r=y,y=y.return;return r.tag===3?(y=r.stateNode,g&&a!==null&&(g=31-Dn(c),r=y.hiddenUpdates,d=r[g],d===null?r[g]=[a]:d.push(a),a.lane=c|536870912),y):null}function dh(r){if(50<_u)throw _u=0,gp=null,Error(n(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var rl={};function UI(r,a,c,d){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function us(r,a,c,d){return new UI(r,a,c,d)}function ug(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Br(r,a){var c=r.alternate;return c===null?(c=us(r.tag,a,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=a,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,a=r.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Qv(r,a){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,a=c.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function hh(r,a,c,d,g,y){var E=0;if(d=r,typeof r=="function")ug(r)&&(E=1);else if(typeof r=="string")E=qj(r,c,Ae.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case A:return r=us(31,c,a,g),r.elementType=A,r.lanes=y,r;case V:return Gi(c.children,g,y,a);case D:E=8,g|=24;break;case q:return r=us(12,c,a,g|2),r.elementType=q,r.lanes=y,r;case H:return r=us(13,c,a,g),r.elementType=H,r.lanes=y,r;case R:return r=us(19,c,a,g),r.elementType=R,r.lanes=y,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case z:case L:E=10;break e;case B:E=9;break e;case G:E=11;break e;case C:E=14;break e;case T:E=16,d=null;break e}E=29,c=Error(n(130,r===null?"null":typeof r,"")),d=null}return a=us(E,c,a,g),a.elementType=r,a.type=d,a.lanes=y,a}function Gi(r,a,c,d){return r=us(7,r,d,a),r.lanes=c,r}function dg(r,a,c){return r=us(6,r,null,a),r.lanes=c,r}function hg(r,a,c){return a=us(4,r.children!==null?r.children:[],r.key,a),a.lanes=c,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var al=[],il=0,fh=null,mh=0,Cs=[],Rs=0,Hi=null,zr=1,Gr="";function $i(r,a){al[il++]=mh,al[il++]=fh,fh=r,mh=a}function Kv(r,a,c){Cs[Rs++]=zr,Cs[Rs++]=Gr,Cs[Rs++]=Hi,Hi=r;var d=zr;r=Gr;var g=32-Dn(d)-1;d&=~(1<<g),c+=1;var y=32-Dn(a)+g;if(30<y){var E=g-g%5;y=(d&(1<<E)-1).toString(32),d>>=E,g-=E,zr=1<<32-Dn(a)+g|c<<g|d,Gr=y+r}else zr=1<<y|c<<g|d,Gr=r}function fg(r){r.return!==null&&($i(r,1),Kv(r,1,0))}function mg(r){for(;r===fh;)fh=al[--il],al[il]=null,mh=al[--il],al[il]=null;for(;r===Hi;)Hi=Cs[--Rs],Cs[Rs]=null,Gr=Cs[--Rs],Cs[Rs]=null,zr=Cs[--Rs],Cs[Rs]=null}var Hn=null,Bt=null,ct=!1,Qi=null,dr=!1,gg=Error(n(519));function Ki(r){var a=Error(n(418,""));throw Zc(Is(a,r)),gg}function Yv(r){var a=r.stateNode,c=r.type,d=r.memoizedProps;switch(a[an]=r,a[Jt]=d,c){case"dialog":Ze("cancel",a),Ze("close",a);break;case"iframe":case"object":case"embed":Ze("load",a);break;case"video":case"audio":for(c=0;c<Tu.length;c++)Ze(Tu[c],a);break;case"source":Ze("error",a);break;case"img":case"image":case"link":Ze("error",a),Ze("load",a);break;case"details":Ze("toggle",a);break;case"input":Ze("invalid",a),ki(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),Go(a);break;case"select":Ze("invalid",a);break;case"textarea":Ze("invalid",a),Di(a,d.value,d.defaultValue,d.children),Go(a)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||d.suppressHydrationWarning===!0||h_(a.textContent,c)?(d.popover!=null&&(Ze("beforetoggle",a),Ze("toggle",a)),d.onScroll!=null&&Ze("scroll",a),d.onScrollEnd!=null&&Ze("scrollend",a),d.onClick!=null&&(a.onclick=Kh),a=!0):a=!1,a||Ki(r)}function Xv(r){for(Hn=r.return;Hn;)switch(Hn.tag){case 5:case 13:dr=!1;return;case 27:case 3:dr=!0;return;default:Hn=Hn.return}}function Wc(r){if(r!==Hn)return!1;if(!ct)return Xv(r),ct=!0,!1;var a=r.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||Rp(r.type,r.memoizedProps)),c=!c),c&&Bt&&Ki(r),Xv(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));e:{for(r=r.nextSibling,a=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(a===0){Bt=Gs(r.nextSibling);break e}a--}else c!=="$"&&c!=="$!"&&c!=="$?"||a++;r=r.nextSibling}Bt=null}}else a===27?(a=Bt,La(r.type)?(r=Mp,Mp=null,Bt=r):Bt=a):Bt=Hn?Gs(r.stateNode.nextSibling):null;return!0}function Jc(){Bt=Hn=null,ct=!1}function Wv(){var r=Qi;return r!==null&&(Yn===null?Yn=r:Yn.push.apply(Yn,r),Qi=null),r}function Zc(r){Qi===null?Qi=[r]:Qi.push(r)}var pg=oe(null),Yi=null,Hr=null;function Ta(r,a,c){me(pg,a._currentValue),a._currentValue=c}function $r(r){r._currentValue=pg.current,ge(pg)}function yg(r,a,c){for(;r!==null;){var d=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),r===c)break;r=r.return}}function xg(r,a,c,d){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var y=g.dependencies;if(y!==null){var E=g.child;y=y.firstContext;e:for(;y!==null;){var S=y;y=g;for(var O=0;O<a.length;O++)if(S.context===a[O]){y.lanes|=c,S=y.alternate,S!==null&&(S.lanes|=c),yg(y.return,c,r),d||(E=null);break e}y=S.next}}else if(g.tag===18){if(E=g.return,E===null)throw Error(n(341));E.lanes|=c,y=E.alternate,y!==null&&(y.lanes|=c),yg(E,c,r),E=null}else E=g.child;if(E!==null)E.return=g;else for(E=g;E!==null;){if(E===r){E=null;break}if(g=E.sibling,g!==null){g.return=E.return,E=g;break}E=E.return}g=E}}function eu(r,a,c,d){r=null;for(var g=a,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var E=g.alternate;if(E===null)throw Error(n(387));if(E=E.memoizedProps,E!==null){var S=g.type;cs(g.pendingProps.value,E.value)||(r!==null?r.push(S):r=[S])}}else if(g===le.current){if(E=g.alternate,E===null)throw Error(n(387));E.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(ju):r=[ju])}g=g.return}r!==null&&xg(a,r,c,d),a.flags|=262144}function gh(r){for(r=r.firstContext;r!==null;){if(!cs(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Xi(r){Yi=r,Hr=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Pn(r){return Jv(Yi,r)}function ph(r,a){return Yi===null&&Xi(r),Jv(r,a)}function Jv(r,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Hr===null){if(r===null)throw Error(n(308));Hr=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else Hr=Hr.next=a;return c}var FI=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(c,d){r.push(d)}};this.abort=function(){a.aborted=!0,r.forEach(function(c){return c()})}},qI=s.unstable_scheduleCallback,BI=s.unstable_NormalPriority,cn={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vg(){return{controller:new FI,data:new Map,refCount:0}}function tu(r){r.refCount--,r.refCount===0&&qI(BI,function(){r.controller.abort()})}var nu=null,bg=0,ol=0,ll=null;function zI(r,a){if(nu===null){var c=nu=[];bg=0,ol=wp(),ll={status:"pending",value:void 0,then:function(d){c.push(d)}}}return bg++,a.then(Zv,Zv),a}function Zv(){if(--bg===0&&nu!==null){ll!==null&&(ll.status="fulfilled");var r=nu;nu=null,ol=0,ll=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function GI(r,a){var c=[],d={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){d.status="fulfilled",d.value=a;for(var g=0;g<c.length;g++)(0,c[g])(a)},function(g){for(d.status="rejected",d.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),d}var eb=F.S;F.S=function(r,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&zI(r,a),eb!==null&&eb(r,a)};var Wi=oe(null);function _g(){var r=Wi.current;return r!==null?r:It.pooledCache}function yh(r,a){a===null?me(Wi,Wi.current):me(Wi,a.pool)}function tb(){var r=_g();return r===null?null:{parent:cn._currentValue,pool:r}}var su=Error(n(460)),nb=Error(n(474)),xh=Error(n(542)),wg={then:function(){}};function sb(r){return r=r.status,r==="fulfilled"||r==="rejected"}function vh(){}function rb(r,a,c){switch(c=r[c],c===void 0?r.push(a):c!==a&&(a.then(vh,vh),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,ib(r),r;default:if(typeof a.status=="string")a.then(vh,vh);else{if(r=It,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=a,r.status="pending",r.then(function(d){if(a.status==="pending"){var g=a;g.status="fulfilled",g.value=d}},function(d){if(a.status==="pending"){var g=a;g.status="rejected",g.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,ib(r),r}throw ru=a,su}}var ru=null;function ab(){if(ru===null)throw Error(n(459));var r=ru;return ru=null,r}function ib(r){if(r===su||r===xh)throw Error(n(483))}var Ea=!1;function Tg(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Eg(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Sa(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Na(r,a,c){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(mt&2)!==0){var g=d.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),d.pending=a,a=dh(r),$v(r,null,c),a}return uh(r,d,a,c),dh(r)}function au(r,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var d=a.lanes;d&=r.pendingLanes,c|=d,a.lanes=c,Dc(r,c)}}function Sg(r,a){var c=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var E={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=E:y=y.next=E,c=c.next}while(c!==null);y===null?g=y=a:y=y.next=a}else g=y=a;c={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:d.shared,callbacks:d.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=a:r.next=a,c.lastBaseUpdate=a}var Ng=!1;function iu(){if(Ng){var r=ll;if(r!==null)throw r}}function ou(r,a,c,d){Ng=!1;var g=r.updateQueue;Ea=!1;var y=g.firstBaseUpdate,E=g.lastBaseUpdate,S=g.shared.pending;if(S!==null){g.shared.pending=null;var O=S,Z=O.next;O.next=null,E===null?y=Z:E.next=Z,E=O;var ce=r.alternate;ce!==null&&(ce=ce.updateQueue,S=ce.lastBaseUpdate,S!==E&&(S===null?ce.firstBaseUpdate=Z:S.next=Z,ce.lastBaseUpdate=O))}if(y!==null){var he=g.baseState;E=0,ce=Z=O=null,S=y;do{var ne=S.lane&-536870913,re=ne!==S.lane;if(re?(at&ne)===ne:(d&ne)===ne){ne!==0&&ne===ol&&(Ng=!0),ce!==null&&(ce=ce.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var Le=r,De=S;ne=a;var Tt=c;switch(De.tag){case 1:if(Le=De.payload,typeof Le=="function"){he=Le.call(Tt,he,ne);break e}he=Le;break e;case 3:Le.flags=Le.flags&-65537|128;case 0:if(Le=De.payload,ne=typeof Le=="function"?Le.call(Tt,he,ne):Le,ne==null)break e;he=x({},he,ne);break e;case 2:Ea=!0}}ne=S.callback,ne!==null&&(r.flags|=64,re&&(r.flags|=8192),re=g.callbacks,re===null?g.callbacks=[ne]:re.push(ne))}else re={lane:ne,tag:S.tag,payload:S.payload,callback:S.callback,next:null},ce===null?(Z=ce=re,O=he):ce=ce.next=re,E|=ne;if(S=S.next,S===null){if(S=g.shared.pending,S===null)break;re=S,S=re.next,re.next=null,g.lastBaseUpdate=re,g.shared.pending=null}}while(!0);ce===null&&(O=he),g.baseState=O,g.firstBaseUpdate=Z,g.lastBaseUpdate=ce,y===null&&(g.shared.lanes=0),Pa|=E,r.lanes=E,r.memoizedState=he}}function ob(r,a){if(typeof r!="function")throw Error(n(191,r));r.call(a)}function lb(r,a){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)ob(c[r],a)}var cl=oe(null),bh=oe(0);function cb(r,a){r=Zr,me(bh,r),me(cl,a),Zr=r|a.baseLanes}function Ag(){me(bh,Zr),me(cl,cl.current)}function Ig(){Zr=bh.current,ge(cl),ge(bh)}var Aa=0,Ke=null,_t=null,en=null,_h=!1,ul=!1,Ji=!1,wh=0,lu=0,dl=null,HI=0;function Qt(){throw Error(n(321))}function jg(r,a){if(a===null)return!1;for(var c=0;c<a.length&&c<r.length;c++)if(!cs(r[c],a[c]))return!1;return!0}function Cg(r,a,c,d,g,y){return Aa=y,Ke=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,F.H=r===null||r.memoizedState===null?$b:Qb,Ji=!1,y=c(d,g),Ji=!1,ul&&(y=db(a,c,d,g)),ub(r),y}function ub(r){F.H=Ih;var a=_t!==null&&_t.next!==null;if(Aa=0,en=_t=Ke=null,_h=!1,lu=0,dl=null,a)throw Error(n(300));r===null||xn||(r=r.dependencies,r!==null&&gh(r)&&(xn=!0))}function db(r,a,c,d){Ke=r;var g=0;do{if(ul&&(dl=null),lu=0,ul=!1,25<=g)throw Error(n(301));if(g+=1,en=_t=null,r.updateQueue!=null){var y=r.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}F.H=JI,y=a(c,d)}while(ul);return y}function $I(){var r=F.H,a=r.useState()[0];return a=typeof a.then=="function"?cu(a):a,r=r.useState()[0],(_t!==null?_t.memoizedState:null)!==r&&(Ke.flags|=1024),a}function Rg(){var r=wh!==0;return wh=0,r}function kg(r,a,c){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~c}function Dg(r){if(_h){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}_h=!1}Aa=0,en=_t=Ke=null,ul=!1,lu=wh=0,dl=null}function Qn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?Ke.memoizedState=en=r:en=en.next=r,en}function tn(){if(_t===null){var r=Ke.alternate;r=r!==null?r.memoizedState:null}else r=_t.next;var a=en===null?Ke.memoizedState:en.next;if(a!==null)en=a,_t=r;else{if(r===null)throw Ke.alternate===null?Error(n(467)):Error(n(310));_t=r,r={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},en===null?Ke.memoizedState=en=r:en=en.next=r}return en}function Pg(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function cu(r){var a=lu;return lu+=1,dl===null&&(dl=[]),r=rb(dl,r,a),a=Ke,(en===null?a.memoizedState:en.next)===null&&(a=a.alternate,F.H=a===null||a.memoizedState===null?$b:Qb),r}function Th(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return cu(r);if(r.$$typeof===L)return Pn(r)}throw Error(n(438,String(r)))}function Mg(r){var a=null,c=Ke.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var d=Ke.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(g){return g.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Pg(),Ke.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(r),d=0;d<r;d++)c[d]=k;return a.index++,c}function Qr(r,a){return typeof a=="function"?a(r):a}function Eh(r){var a=tn();return Vg(a,_t,r)}function Vg(r,a,c){var d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=c;var g=r.baseQueue,y=d.pending;if(y!==null){if(g!==null){var E=g.next;g.next=y.next,y.next=E}a.baseQueue=g=y,d.pending=null}if(y=r.baseState,g===null)r.memoizedState=y;else{a=g.next;var S=E=null,O=null,Z=a,ce=!1;do{var he=Z.lane&-536870913;if(he!==Z.lane?(at&he)===he:(Aa&he)===he){var ne=Z.revertLane;if(ne===0)O!==null&&(O=O.next={lane:0,revertLane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),he===ol&&(ce=!0);else if((Aa&ne)===ne){Z=Z.next,ne===ol&&(ce=!0);continue}else he={lane:0,revertLane:Z.revertLane,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},O===null?(S=O=he,E=y):O=O.next=he,Ke.lanes|=ne,Pa|=ne;he=Z.action,Ji&&c(y,he),y=Z.hasEagerState?Z.eagerState:c(y,he)}else ne={lane:he,revertLane:Z.revertLane,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},O===null?(S=O=ne,E=y):O=O.next=ne,Ke.lanes|=he,Pa|=he;Z=Z.next}while(Z!==null&&Z!==a);if(O===null?E=y:O.next=S,!cs(y,r.memoizedState)&&(xn=!0,ce&&(c=ll,c!==null)))throw c;r.memoizedState=y,r.baseState=E,r.baseQueue=O,d.lastRenderedState=y}return g===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function Og(r){var a=tn(),c=a.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=r;var d=c.dispatch,g=c.pending,y=a.memoizedState;if(g!==null){c.pending=null;var E=g=g.next;do y=r(y,E.action),E=E.next;while(E!==g);cs(y,a.memoizedState)||(xn=!0),a.memoizedState=y,a.baseQueue===null&&(a.baseState=y),c.lastRenderedState=y}return[y,d]}function hb(r,a,c){var d=Ke,g=tn(),y=ct;if(y){if(c===void 0)throw Error(n(407));c=c()}else c=a();var E=!cs((_t||g).memoizedState,c);E&&(g.memoizedState=c,xn=!0),g=g.queue;var S=gb.bind(null,d,g,r);if(uu(2048,8,S,[r]),g.getSnapshot!==a||E||en!==null&&en.memoizedState.tag&1){if(d.flags|=2048,hl(9,Sh(),mb.bind(null,d,g,c,a),null),It===null)throw Error(n(349));y||(Aa&124)!==0||fb(d,a,c)}return c}function fb(r,a,c){r.flags|=16384,r={getSnapshot:a,value:c},a=Ke.updateQueue,a===null?(a=Pg(),Ke.updateQueue=a,a.stores=[r]):(c=a.stores,c===null?a.stores=[r]:c.push(r))}function mb(r,a,c,d){a.value=c,a.getSnapshot=d,pb(a)&&yb(r)}function gb(r,a,c){return c(function(){pb(a)&&yb(r)})}function pb(r){var a=r.getSnapshot;r=r.value;try{var c=a();return!cs(r,c)}catch{return!0}}function yb(r){var a=sl(r,2);a!==null&&gs(a,r,2)}function Lg(r){var a=Qn();if(typeof r=="function"){var c=r;if(r=c(),Ji){os(!0);try{c()}finally{os(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qr,lastRenderedState:r},a}function xb(r,a,c,d){return r.baseState=c,Vg(r,_t,typeof d=="function"?d:Qr)}function QI(r,a,c,d,g){if(Ah(r))throw Error(n(485));if(r=a.action,r!==null){var y={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){y.listeners.push(E)}};F.T!==null?c(!0):y.isTransition=!1,d(y),c=a.pending,c===null?(y.next=a.pending=y,vb(a,y)):(y.next=c.next,a.pending=c.next=y)}}function vb(r,a){var c=a.action,d=a.payload,g=r.state;if(a.isTransition){var y=F.T,E={};F.T=E;try{var S=c(g,d),O=F.S;O!==null&&O(E,S),bb(r,a,S)}catch(Z){Ug(r,a,Z)}finally{F.T=y}}else try{y=c(g,d),bb(r,a,y)}catch(Z){Ug(r,a,Z)}}function bb(r,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){_b(r,a,d)},function(d){return Ug(r,a,d)}):_b(r,a,c)}function _b(r,a,c){a.status="fulfilled",a.value=c,wb(a),r.state=c,a=r.pending,a!==null&&(c=a.next,c===a?r.pending=null:(c=c.next,a.next=c,vb(r,c)))}function Ug(r,a,c){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=c,wb(a),a=a.next;while(a!==d)}r.action=null}function wb(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function Tb(r,a){return a}function Eb(r,a){if(ct){var c=It.formState;if(c!==null){e:{var d=Ke;if(ct){if(Bt){t:{for(var g=Bt,y=dr;g.nodeType!==8;){if(!y){g=null;break t}if(g=Gs(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){Bt=Gs(g.nextSibling),d=g.data==="F!";break e}}Ki(d)}d=!1}d&&(a=c[0])}}return c=Qn(),c.memoizedState=c.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tb,lastRenderedState:a},c.queue=d,c=zb.bind(null,Ke,d),d.dispatch=c,d=Lg(!1),y=Gg.bind(null,Ke,!1,d.queue),d=Qn(),g={state:a,dispatch:null,action:r,pending:null},d.queue=g,c=QI.bind(null,Ke,g,y,c),g.dispatch=c,d.memoizedState=r,[a,c,!1]}function Sb(r){var a=tn();return Nb(a,_t,r)}function Nb(r,a,c){if(a=Vg(r,a,Tb)[0],r=Eh(Qr)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=cu(a)}catch(E){throw E===su?xh:E}else d=a;a=tn();var g=a.queue,y=g.dispatch;return c!==a.memoizedState&&(Ke.flags|=2048,hl(9,Sh(),KI.bind(null,g,c),null)),[d,y,r]}function KI(r,a){r.action=a}function Ab(r){var a=tn(),c=_t;if(c!==null)return Nb(a,c,r);tn(),a=a.memoizedState,c=tn();var d=c.queue.dispatch;return c.memoizedState=r,[a,d,!1]}function hl(r,a,c,d){return r={tag:r,create:c,deps:d,inst:a,next:null},a=Ke.updateQueue,a===null&&(a=Pg(),Ke.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=r.next=r:(d=c.next,c.next=r,r.next=d,a.lastEffect=r),r}function Sh(){return{destroy:void 0,resource:void 0}}function Ib(){return tn().memoizedState}function Nh(r,a,c,d){var g=Qn();d=d===void 0?null:d,Ke.flags|=r,g.memoizedState=hl(1|a,Sh(),c,d)}function uu(r,a,c,d){var g=tn();d=d===void 0?null:d;var y=g.memoizedState.inst;_t!==null&&d!==null&&jg(d,_t.memoizedState.deps)?g.memoizedState=hl(a,y,c,d):(Ke.flags|=r,g.memoizedState=hl(1|a,y,c,d))}function jb(r,a){Nh(8390656,8,r,a)}function Cb(r,a){uu(2048,8,r,a)}function Rb(r,a){return uu(4,2,r,a)}function kb(r,a){return uu(4,4,r,a)}function Db(r,a){if(typeof a=="function"){r=r();var c=a(r);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function Pb(r,a,c){c=c!=null?c.concat([r]):null,uu(4,4,Db.bind(null,a,r),c)}function Fg(){}function Mb(r,a){var c=tn();a=a===void 0?null:a;var d=c.memoizedState;return a!==null&&jg(a,d[1])?d[0]:(c.memoizedState=[r,a],r)}function Vb(r,a){var c=tn();a=a===void 0?null:a;var d=c.memoizedState;if(a!==null&&jg(a,d[1]))return d[0];if(d=r(),Ji){os(!0);try{r()}finally{os(!1)}}return c.memoizedState=[d,a],d}function qg(r,a,c){return c===void 0||(Aa&1073741824)!==0?r.memoizedState=a:(r.memoizedState=c,r=U0(),Ke.lanes|=r,Pa|=r,c)}function Ob(r,a,c,d){return cs(c,a)?c:cl.current!==null?(r=qg(r,c,d),cs(r,a)||(xn=!0),r):(Aa&42)===0?(xn=!0,r.memoizedState=c):(r=U0(),Ke.lanes|=r,Pa|=r,a)}function Lb(r,a,c,d,g){var y=ie.p;ie.p=y!==0&&8>y?y:8;var E=F.T,S={};F.T=S,Gg(r,!1,a,c);try{var O=g(),Z=F.S;if(Z!==null&&Z(S,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var ce=GI(O,d);du(r,a,ce,ms(r))}else du(r,a,d,ms(r))}catch(he){du(r,a,{then:function(){},status:"rejected",reason:he},ms())}finally{ie.p=y,F.T=E}}function YI(){}function Bg(r,a,c,d){if(r.tag!==5)throw Error(n(476));var g=Ub(r).queue;Lb(r,g,a,K,c===null?YI:function(){return Fb(r),c(d)})}function Ub(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qr,lastRenderedState:K},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qr,lastRenderedState:c},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function Fb(r){var a=Ub(r).next.queue;du(r,a,{},ms())}function zg(){return Pn(ju)}function qb(){return tn().memoizedState}function Bb(){return tn().memoizedState}function XI(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var c=ms();r=Sa(c);var d=Na(a,r,c);d!==null&&(gs(d,a,c),au(d,a,c)),a={cache:vg()},r.payload=a;return}a=a.return}}function WI(r,a,c){var d=ms();c={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},Ah(r)?Gb(a,c):(c=cg(r,a,c,d),c!==null&&(gs(c,r,d),Hb(c,a,d)))}function zb(r,a,c){var d=ms();du(r,a,c,d)}function du(r,a,c,d){var g={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ah(r))Gb(a,g);else{var y=r.alternate;if(r.lanes===0&&(y===null||y.lanes===0)&&(y=a.lastRenderedReducer,y!==null))try{var E=a.lastRenderedState,S=y(E,c);if(g.hasEagerState=!0,g.eagerState=S,cs(S,E))return uh(r,a,g,0),It===null&&ch(),!1}catch{}finally{}if(c=cg(r,a,g,d),c!==null)return gs(c,r,d),Hb(c,a,d),!0}return!1}function Gg(r,a,c,d){if(d={lane:2,revertLane:wp(),action:d,hasEagerState:!1,eagerState:null,next:null},Ah(r)){if(a)throw Error(n(479))}else a=cg(r,c,d,2),a!==null&&gs(a,r,2)}function Ah(r){var a=r.alternate;return r===Ke||a!==null&&a===Ke}function Gb(r,a){ul=_h=!0;var c=r.pending;c===null?a.next=a:(a.next=c.next,c.next=a),r.pending=a}function Hb(r,a,c){if((c&4194048)!==0){var d=a.lanes;d&=r.pendingLanes,c|=d,a.lanes=c,Dc(r,c)}}var Ih={readContext:Pn,use:Th,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt},$b={readContext:Pn,use:Th,useCallback:function(r,a){return Qn().memoizedState=[r,a===void 0?null:a],r},useContext:Pn,useEffect:jb,useImperativeHandle:function(r,a,c){c=c!=null?c.concat([r]):null,Nh(4194308,4,Db.bind(null,a,r),c)},useLayoutEffect:function(r,a){return Nh(4194308,4,r,a)},useInsertionEffect:function(r,a){Nh(4,2,r,a)},useMemo:function(r,a){var c=Qn();a=a===void 0?null:a;var d=r();if(Ji){os(!0);try{r()}finally{os(!1)}}return c.memoizedState=[d,a],d},useReducer:function(r,a,c){var d=Qn();if(c!==void 0){var g=c(a);if(Ji){os(!0);try{c(a)}finally{os(!1)}}}else g=a;return d.memoizedState=d.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},d.queue=r,r=r.dispatch=WI.bind(null,Ke,r),[d.memoizedState,r]},useRef:function(r){var a=Qn();return r={current:r},a.memoizedState=r},useState:function(r){r=Lg(r);var a=r.queue,c=zb.bind(null,Ke,a);return a.dispatch=c,[r.memoizedState,c]},useDebugValue:Fg,useDeferredValue:function(r,a){var c=Qn();return qg(c,r,a)},useTransition:function(){var r=Lg(!1);return r=Lb.bind(null,Ke,r.queue,!0,!1),Qn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,c){var d=Ke,g=Qn();if(ct){if(c===void 0)throw Error(n(407));c=c()}else{if(c=a(),It===null)throw Error(n(349));(at&124)!==0||fb(d,a,c)}g.memoizedState=c;var y={value:c,getSnapshot:a};return g.queue=y,jb(gb.bind(null,d,y,r),[r]),d.flags|=2048,hl(9,Sh(),mb.bind(null,d,y,c,a),null),c},useId:function(){var r=Qn(),a=It.identifierPrefix;if(ct){var c=Gr,d=zr;c=(d&~(1<<32-Dn(d)-1)).toString(32)+c,a="«"+a+"R"+c,c=wh++,0<c&&(a+="H"+c.toString(32)),a+="»"}else c=HI++,a="«"+a+"r"+c.toString(32)+"»";return r.memoizedState=a},useHostTransitionStatus:zg,useFormState:Eb,useActionState:Eb,useOptimistic:function(r){var a=Qn();a.memoizedState=a.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Gg.bind(null,Ke,!0,c),c.dispatch=a,[r,a]},useMemoCache:Mg,useCacheRefresh:function(){return Qn().memoizedState=XI.bind(null,Ke)}},Qb={readContext:Pn,use:Th,useCallback:Mb,useContext:Pn,useEffect:Cb,useImperativeHandle:Pb,useInsertionEffect:Rb,useLayoutEffect:kb,useMemo:Vb,useReducer:Eh,useRef:Ib,useState:function(){return Eh(Qr)},useDebugValue:Fg,useDeferredValue:function(r,a){var c=tn();return Ob(c,_t.memoizedState,r,a)},useTransition:function(){var r=Eh(Qr)[0],a=tn().memoizedState;return[typeof r=="boolean"?r:cu(r),a]},useSyncExternalStore:hb,useId:qb,useHostTransitionStatus:zg,useFormState:Sb,useActionState:Sb,useOptimistic:function(r,a){var c=tn();return xb(c,_t,r,a)},useMemoCache:Mg,useCacheRefresh:Bb},JI={readContext:Pn,use:Th,useCallback:Mb,useContext:Pn,useEffect:Cb,useImperativeHandle:Pb,useInsertionEffect:Rb,useLayoutEffect:kb,useMemo:Vb,useReducer:Og,useRef:Ib,useState:function(){return Og(Qr)},useDebugValue:Fg,useDeferredValue:function(r,a){var c=tn();return _t===null?qg(c,r,a):Ob(c,_t.memoizedState,r,a)},useTransition:function(){var r=Og(Qr)[0],a=tn().memoizedState;return[typeof r=="boolean"?r:cu(r),a]},useSyncExternalStore:hb,useId:qb,useHostTransitionStatus:zg,useFormState:Ab,useActionState:Ab,useOptimistic:function(r,a){var c=tn();return _t!==null?xb(c,_t,r,a):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Mg,useCacheRefresh:Bb},fl=null,hu=0;function jh(r){var a=hu;return hu+=1,fl===null&&(fl=[]),rb(fl,r,a)}function fu(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function Ch(r,a){throw a.$$typeof===b?Error(n(525)):(r=Object.prototype.toString.call(a),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function Kb(r){var a=r._init;return a(r._payload)}function Yb(r){function a(Y,Q){if(r){var J=Y.deletions;J===null?(Y.deletions=[Q],Y.flags|=16):J.push(Q)}}function c(Y,Q){if(!r)return null;for(;Q!==null;)a(Y,Q),Q=Q.sibling;return null}function d(Y){for(var Q=new Map;Y!==null;)Y.key!==null?Q.set(Y.key,Y):Q.set(Y.index,Y),Y=Y.sibling;return Q}function g(Y,Q){return Y=Br(Y,Q),Y.index=0,Y.sibling=null,Y}function y(Y,Q,J){return Y.index=J,r?(J=Y.alternate,J!==null?(J=J.index,J<Q?(Y.flags|=67108866,Q):J):(Y.flags|=67108866,Q)):(Y.flags|=1048576,Q)}function E(Y){return r&&Y.alternate===null&&(Y.flags|=67108866),Y}function S(Y,Q,J,de){return Q===null||Q.tag!==6?(Q=dg(J,Y.mode,de),Q.return=Y,Q):(Q=g(Q,J),Q.return=Y,Q)}function O(Y,Q,J,de){var Ie=J.type;return Ie===V?ce(Y,Q,J.props.children,de,J.key):Q!==null&&(Q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===T&&Kb(Ie)===Q.type)?(Q=g(Q,J.props),fu(Q,J),Q.return=Y,Q):(Q=hh(J.type,J.key,J.props,null,Y.mode,de),fu(Q,J),Q.return=Y,Q)}function Z(Y,Q,J,de){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==J.containerInfo||Q.stateNode.implementation!==J.implementation?(Q=hg(J,Y.mode,de),Q.return=Y,Q):(Q=g(Q,J.children||[]),Q.return=Y,Q)}function ce(Y,Q,J,de,Ie){return Q===null||Q.tag!==7?(Q=Gi(J,Y.mode,de,Ie),Q.return=Y,Q):(Q=g(Q,J),Q.return=Y,Q)}function he(Y,Q,J){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=dg(""+Q,Y.mode,J),Q.return=Y,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case w:return J=hh(Q.type,Q.key,Q.props,null,Y.mode,J),fu(J,Q),J.return=Y,J;case N:return Q=hg(Q,Y.mode,J),Q.return=Y,Q;case T:var de=Q._init;return Q=de(Q._payload),he(Y,Q,J)}if(se(Q)||$(Q))return Q=Gi(Q,Y.mode,J,null),Q.return=Y,Q;if(typeof Q.then=="function")return he(Y,jh(Q),J);if(Q.$$typeof===L)return he(Y,ph(Y,Q),J);Ch(Y,Q)}return null}function ne(Y,Q,J,de){var Ie=Q!==null?Q.key:null;if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return Ie!==null?null:S(Y,Q,""+J,de);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case w:return J.key===Ie?O(Y,Q,J,de):null;case N:return J.key===Ie?Z(Y,Q,J,de):null;case T:return Ie=J._init,J=Ie(J._payload),ne(Y,Q,J,de)}if(se(J)||$(J))return Ie!==null?null:ce(Y,Q,J,de,null);if(typeof J.then=="function")return ne(Y,Q,jh(J),de);if(J.$$typeof===L)return ne(Y,Q,ph(Y,J),de);Ch(Y,J)}return null}function re(Y,Q,J,de,Ie){if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return Y=Y.get(J)||null,S(Q,Y,""+de,Ie);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case w:return Y=Y.get(de.key===null?J:de.key)||null,O(Q,Y,de,Ie);case N:return Y=Y.get(de.key===null?J:de.key)||null,Z(Q,Y,de,Ie);case T:var Ye=de._init;return de=Ye(de._payload),re(Y,Q,J,de,Ie)}if(se(de)||$(de))return Y=Y.get(J)||null,ce(Q,Y,de,Ie,null);if(typeof de.then=="function")return re(Y,Q,J,jh(de),Ie);if(de.$$typeof===L)return re(Y,Q,J,ph(Q,de),Ie);Ch(Q,de)}return null}function Le(Y,Q,J,de){for(var Ie=null,Ye=null,Re=Q,Me=Q=0,bn=null;Re!==null&&Me<J.length;Me++){Re.index>Me?(bn=Re,Re=null):bn=Re.sibling;var ot=ne(Y,Re,J[Me],de);if(ot===null){Re===null&&(Re=bn);break}r&&Re&&ot.alternate===null&&a(Y,Re),Q=y(ot,Q,Me),Ye===null?Ie=ot:Ye.sibling=ot,Ye=ot,Re=bn}if(Me===J.length)return c(Y,Re),ct&&$i(Y,Me),Ie;if(Re===null){for(;Me<J.length;Me++)Re=he(Y,J[Me],de),Re!==null&&(Q=y(Re,Q,Me),Ye===null?Ie=Re:Ye.sibling=Re,Ye=Re);return ct&&$i(Y,Me),Ie}for(Re=d(Re);Me<J.length;Me++)bn=re(Re,Y,Me,J[Me],de),bn!==null&&(r&&bn.alternate!==null&&Re.delete(bn.key===null?Me:bn.key),Q=y(bn,Q,Me),Ye===null?Ie=bn:Ye.sibling=bn,Ye=bn);return r&&Re.forEach(function(za){return a(Y,za)}),ct&&$i(Y,Me),Ie}function De(Y,Q,J,de){if(J==null)throw Error(n(151));for(var Ie=null,Ye=null,Re=Q,Me=Q=0,bn=null,ot=J.next();Re!==null&&!ot.done;Me++,ot=J.next()){Re.index>Me?(bn=Re,Re=null):bn=Re.sibling;var za=ne(Y,Re,ot.value,de);if(za===null){Re===null&&(Re=bn);break}r&&Re&&za.alternate===null&&a(Y,Re),Q=y(za,Q,Me),Ye===null?Ie=za:Ye.sibling=za,Ye=za,Re=bn}if(ot.done)return c(Y,Re),ct&&$i(Y,Me),Ie;if(Re===null){for(;!ot.done;Me++,ot=J.next())ot=he(Y,ot.value,de),ot!==null&&(Q=y(ot,Q,Me),Ye===null?Ie=ot:Ye.sibling=ot,Ye=ot);return ct&&$i(Y,Me),Ie}for(Re=d(Re);!ot.done;Me++,ot=J.next())ot=re(Re,Y,Me,ot.value,de),ot!==null&&(r&&ot.alternate!==null&&Re.delete(ot.key===null?Me:ot.key),Q=y(ot,Q,Me),Ye===null?Ie=ot:Ye.sibling=ot,Ye=ot);return r&&Re.forEach(function(Zj){return a(Y,Zj)}),ct&&$i(Y,Me),Ie}function Tt(Y,Q,J,de){if(typeof J=="object"&&J!==null&&J.type===V&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case w:e:{for(var Ie=J.key;Q!==null;){if(Q.key===Ie){if(Ie=J.type,Ie===V){if(Q.tag===7){c(Y,Q.sibling),de=g(Q,J.props.children),de.return=Y,Y=de;break e}}else if(Q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===T&&Kb(Ie)===Q.type){c(Y,Q.sibling),de=g(Q,J.props),fu(de,J),de.return=Y,Y=de;break e}c(Y,Q);break}else a(Y,Q);Q=Q.sibling}J.type===V?(de=Gi(J.props.children,Y.mode,de,J.key),de.return=Y,Y=de):(de=hh(J.type,J.key,J.props,null,Y.mode,de),fu(de,J),de.return=Y,Y=de)}return E(Y);case N:e:{for(Ie=J.key;Q!==null;){if(Q.key===Ie)if(Q.tag===4&&Q.stateNode.containerInfo===J.containerInfo&&Q.stateNode.implementation===J.implementation){c(Y,Q.sibling),de=g(Q,J.children||[]),de.return=Y,Y=de;break e}else{c(Y,Q);break}else a(Y,Q);Q=Q.sibling}de=hg(J,Y.mode,de),de.return=Y,Y=de}return E(Y);case T:return Ie=J._init,J=Ie(J._payload),Tt(Y,Q,J,de)}if(se(J))return Le(Y,Q,J,de);if($(J)){if(Ie=$(J),typeof Ie!="function")throw Error(n(150));return J=Ie.call(J),De(Y,Q,J,de)}if(typeof J.then=="function")return Tt(Y,Q,jh(J),de);if(J.$$typeof===L)return Tt(Y,Q,ph(Y,J),de);Ch(Y,J)}return typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint"?(J=""+J,Q!==null&&Q.tag===6?(c(Y,Q.sibling),de=g(Q,J),de.return=Y,Y=de):(c(Y,Q),de=dg(J,Y.mode,de),de.return=Y,Y=de),E(Y)):c(Y,Q)}return function(Y,Q,J,de){try{hu=0;var Ie=Tt(Y,Q,J,de);return fl=null,Ie}catch(Re){if(Re===su||Re===xh)throw Re;var Ye=us(29,Re,null,Y.mode);return Ye.lanes=de,Ye.return=Y,Ye}finally{}}}var ml=Yb(!0),Xb=Yb(!1),ks=oe(null),hr=null;function Ia(r){var a=r.alternate;me(un,un.current&1),me(ks,r),hr===null&&(a===null||cl.current!==null||a.memoizedState!==null)&&(hr=r)}function Wb(r){if(r.tag===22){if(me(un,un.current),me(ks,r),hr===null){var a=r.alternate;a!==null&&a.memoizedState!==null&&(hr=r)}}else ja()}function ja(){me(un,un.current),me(ks,ks.current)}function Kr(r){ge(ks),hr===r&&(hr=null),ge(un)}var un=oe(0);function Rh(r){for(var a=r;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||Pp(c)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function Hg(r,a,c,d){a=r.memoizedState,c=c(d,a),c=c==null?a:x({},a,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var $g={enqueueSetState:function(r,a,c){r=r._reactInternals;var d=ms(),g=Sa(d);g.payload=a,c!=null&&(g.callback=c),a=Na(r,g,d),a!==null&&(gs(a,r,d),au(a,r,d))},enqueueReplaceState:function(r,a,c){r=r._reactInternals;var d=ms(),g=Sa(d);g.tag=1,g.payload=a,c!=null&&(g.callback=c),a=Na(r,g,d),a!==null&&(gs(a,r,d),au(a,r,d))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var c=ms(),d=Sa(c);d.tag=2,a!=null&&(d.callback=a),a=Na(r,d,c),a!==null&&(gs(a,r,c),au(a,r,c))}};function Jb(r,a,c,d,g,y,E){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,y,E):a.prototype&&a.prototype.isPureReactComponent?!Yc(c,d)||!Yc(g,y):!0}function Zb(r,a,c,d){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,d),a.state!==r&&$g.enqueueReplaceState(a,a.state,null)}function Zi(r,a){var c=a;if("ref"in a){c={};for(var d in a)d!=="ref"&&(c[d]=a[d])}if(r=r.defaultProps){c===a&&(c=x({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}var kh=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function e0(r){kh(r)}function t0(r){console.error(r)}function n0(r){kh(r)}function Dh(r,a){try{var c=r.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function s0(r,a,c){try{var d=r.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Qg(r,a,c){return c=Sa(c),c.tag=3,c.payload={element:null},c.callback=function(){Dh(r,a)},c}function r0(r){return r=Sa(r),r.tag=3,r}function a0(r,a,c,d){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=d.value;r.payload=function(){return g(y)},r.callback=function(){s0(a,c,d)}}var E=c.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(r.callback=function(){s0(a,c,d),typeof g!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var S=d.stack;this.componentDidCatch(d.value,{componentStack:S!==null?S:""})})}function ZI(r,a,c,d,g){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=c.alternate,a!==null&&eu(a,c,g,!0),c=ks.current,c!==null){switch(c.tag){case 13:return hr===null?yp():c.alternate===null&&zt===0&&(zt=3),c.flags&=-257,c.flags|=65536,c.lanes=g,d===wg?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([d]):a.add(d),vp(r,d,g)),!1;case 22:return c.flags|=65536,d===wg?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([d]):c.add(d)),vp(r,d,g)),!1}throw Error(n(435,c.tag))}return vp(r,d,g),yp(),!1}if(ct)return a=ks.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=g,d!==gg&&(r=Error(n(422),{cause:d}),Zc(Is(r,c)))):(d!==gg&&(a=Error(n(423),{cause:d}),Zc(Is(a,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,d=Is(d,c),g=Qg(r.stateNode,d,g),Sg(r,g),zt!==4&&(zt=2)),!1;var y=Error(n(520),{cause:d});if(y=Is(y,c),bu===null?bu=[y]:bu.push(y),zt!==4&&(zt=2),a===null)return!0;d=Is(d,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=Qg(c.stateNode,d,r),Sg(c,r),!1;case 1:if(a=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ma===null||!Ma.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=r0(g),a0(g,r,c,d),Sg(c,g),!1}c=c.return}while(c!==null);return!1}var i0=Error(n(461)),xn=!1;function In(r,a,c,d){a.child=r===null?Xb(a,null,c,d):ml(a,r.child,c,d)}function o0(r,a,c,d,g){c=c.render;var y=a.ref;if("ref"in d){var E={};for(var S in d)S!=="ref"&&(E[S]=d[S])}else E=d;return Xi(a),d=Cg(r,a,c,E,y,g),S=Rg(),r!==null&&!xn?(kg(r,a,g),Yr(r,a,g)):(ct&&S&&fg(a),a.flags|=1,In(r,a,d,g),a.child)}function l0(r,a,c,d,g){if(r===null){var y=c.type;return typeof y=="function"&&!ug(y)&&y.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=y,c0(r,a,y,d,g)):(r=hh(c.type,null,d,a,a.mode,g),r.ref=a.ref,r.return=a,a.child=r)}if(y=r.child,!tp(r,g)){var E=y.memoizedProps;if(c=c.compare,c=c!==null?c:Yc,c(E,d)&&r.ref===a.ref)return Yr(r,a,g)}return a.flags|=1,r=Br(y,d),r.ref=a.ref,r.return=a,a.child=r}function c0(r,a,c,d,g){if(r!==null){var y=r.memoizedProps;if(Yc(y,d)&&r.ref===a.ref)if(xn=!1,a.pendingProps=d=y,tp(r,g))(r.flags&131072)!==0&&(xn=!0);else return a.lanes=r.lanes,Yr(r,a,g)}return Kg(r,a,c,d,g)}function u0(r,a,c){var d=a.pendingProps,g=d.children,y=r!==null?r.memoizedState:null;if(d.mode==="hidden"){if((a.flags&128)!==0){if(d=y!==null?y.baseLanes|c:c,r!==null){for(g=a.child=r.child,y=0;g!==null;)y=y|g.lanes|g.childLanes,g=g.sibling;a.childLanes=y&~d}else a.childLanes=0,a.child=null;return d0(r,a,d,c)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&yh(a,y!==null?y.cachePool:null),y!==null?cb(a,y):Ag(),Wb(a);else return a.lanes=a.childLanes=536870912,d0(r,a,y!==null?y.baseLanes|c:c,c)}else y!==null?(yh(a,y.cachePool),cb(a,y),ja(),a.memoizedState=null):(r!==null&&yh(a,null),Ag(),ja());return In(r,a,g,c),a.child}function d0(r,a,c,d){var g=_g();return g=g===null?null:{parent:cn._currentValue,pool:g},a.memoizedState={baseLanes:c,cachePool:g},r!==null&&yh(a,null),Ag(),Wb(a),r!==null&&eu(r,a,d,!0),null}function Ph(r,a){var c=a.ref;if(c===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(r===null||r.ref!==c)&&(a.flags|=4194816)}}function Kg(r,a,c,d,g){return Xi(a),c=Cg(r,a,c,d,void 0,g),d=Rg(),r!==null&&!xn?(kg(r,a,g),Yr(r,a,g)):(ct&&d&&fg(a),a.flags|=1,In(r,a,c,g),a.child)}function h0(r,a,c,d,g,y){return Xi(a),a.updateQueue=null,c=db(a,d,c,g),ub(r),d=Rg(),r!==null&&!xn?(kg(r,a,y),Yr(r,a,y)):(ct&&d&&fg(a),a.flags|=1,In(r,a,c,y),a.child)}function f0(r,a,c,d,g){if(Xi(a),a.stateNode===null){var y=rl,E=c.contextType;typeof E=="object"&&E!==null&&(y=Pn(E)),y=new c(d,y),a.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=$g,a.stateNode=y,y._reactInternals=a,y=a.stateNode,y.props=d,y.state=a.memoizedState,y.refs={},Tg(a),E=c.contextType,y.context=typeof E=="object"&&E!==null?Pn(E):rl,y.state=a.memoizedState,E=c.getDerivedStateFromProps,typeof E=="function"&&(Hg(a,c,E,d),y.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(E=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),E!==y.state&&$g.enqueueReplaceState(y,y.state,null),ou(a,d,y,g),iu(),y.state=a.memoizedState),typeof y.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(r===null){y=a.stateNode;var S=a.memoizedProps,O=Zi(c,S);y.props=O;var Z=y.context,ce=c.contextType;E=rl,typeof ce=="object"&&ce!==null&&(E=Pn(ce));var he=c.getDerivedStateFromProps;ce=typeof he=="function"||typeof y.getSnapshotBeforeUpdate=="function",S=a.pendingProps!==S,ce||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(S||Z!==E)&&Zb(a,y,d,E),Ea=!1;var ne=a.memoizedState;y.state=ne,ou(a,d,y,g),iu(),Z=a.memoizedState,S||ne!==Z||Ea?(typeof he=="function"&&(Hg(a,c,he,d),Z=a.memoizedState),(O=Ea||Jb(a,c,O,d,ne,Z,E))?(ce||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(a.flags|=4194308)):(typeof y.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=Z),y.props=d,y.state=Z,y.context=E,d=O):(typeof y.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{y=a.stateNode,Eg(r,a),E=a.memoizedProps,ce=Zi(c,E),y.props=ce,he=a.pendingProps,ne=y.context,Z=c.contextType,O=rl,typeof Z=="object"&&Z!==null&&(O=Pn(Z)),S=c.getDerivedStateFromProps,(Z=typeof S=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(E!==he||ne!==O)&&Zb(a,y,d,O),Ea=!1,ne=a.memoizedState,y.state=ne,ou(a,d,y,g),iu();var re=a.memoizedState;E!==he||ne!==re||Ea||r!==null&&r.dependencies!==null&&gh(r.dependencies)?(typeof S=="function"&&(Hg(a,c,S,d),re=a.memoizedState),(ce=Ea||Jb(a,c,ce,d,ne,re,O)||r!==null&&r.dependencies!==null&&gh(r.dependencies))?(Z||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,re,O),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,re,O)),typeof y.componentDidUpdate=="function"&&(a.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof y.componentDidUpdate!="function"||E===r.memoizedProps&&ne===r.memoizedState||(a.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&ne===r.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=re),y.props=d,y.state=re,y.context=O,d=ce):(typeof y.componentDidUpdate!="function"||E===r.memoizedProps&&ne===r.memoizedState||(a.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&ne===r.memoizedState||(a.flags|=1024),d=!1)}return y=d,Ph(r,a),d=(a.flags&128)!==0,y||d?(y=a.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:y.render(),a.flags|=1,r!==null&&d?(a.child=ml(a,r.child,null,g),a.child=ml(a,null,c,g)):In(r,a,c,g),a.memoizedState=y.state,r=a.child):r=Yr(r,a,g),r}function m0(r,a,c,d){return Jc(),a.flags|=256,In(r,a,c,d),a.child}var Yg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xg(r){return{baseLanes:r,cachePool:tb()}}function Wg(r,a,c){return r=r!==null?r.childLanes&~c:0,a&&(r|=Ds),r}function g0(r,a,c){var d=a.pendingProps,g=!1,y=(a.flags&128)!==0,E;if((E=y)||(E=r!==null&&r.memoizedState===null?!1:(un.current&2)!==0),E&&(g=!0,a.flags&=-129),E=(a.flags&32)!==0,a.flags&=-33,r===null){if(ct){if(g?Ia(a):ja(),ct){var S=Bt,O;if(O=S){e:{for(O=S,S=dr;O.nodeType!==8;){if(!S){S=null;break e}if(O=Gs(O.nextSibling),O===null){S=null;break e}}S=O}S!==null?(a.memoizedState={dehydrated:S,treeContext:Hi!==null?{id:zr,overflow:Gr}:null,retryLane:536870912,hydrationErrors:null},O=us(18,null,null,0),O.stateNode=S,O.return=a,a.child=O,Hn=a,Bt=null,O=!0):O=!1}O||Ki(a)}if(S=a.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return Pp(S)?a.lanes=32:a.lanes=536870912,null;Kr(a)}return S=d.children,d=d.fallback,g?(ja(),g=a.mode,S=Mh({mode:"hidden",children:S},g),d=Gi(d,g,c,null),S.return=a,d.return=a,S.sibling=d,a.child=S,g=a.child,g.memoizedState=Xg(c),g.childLanes=Wg(r,E,c),a.memoizedState=Yg,d):(Ia(a),Jg(a,S))}if(O=r.memoizedState,O!==null&&(S=O.dehydrated,S!==null)){if(y)a.flags&256?(Ia(a),a.flags&=-257,a=Zg(r,a,c)):a.memoizedState!==null?(ja(),a.child=r.child,a.flags|=128,a=null):(ja(),g=d.fallback,S=a.mode,d=Mh({mode:"visible",children:d.children},S),g=Gi(g,S,c,null),g.flags|=2,d.return=a,g.return=a,d.sibling=g,a.child=d,ml(a,r.child,null,c),d=a.child,d.memoizedState=Xg(c),d.childLanes=Wg(r,E,c),a.memoizedState=Yg,a=g);else if(Ia(a),Pp(S)){if(E=S.nextSibling&&S.nextSibling.dataset,E)var Z=E.dgst;E=Z,d=Error(n(419)),d.stack="",d.digest=E,Zc({value:d,source:null,stack:null}),a=Zg(r,a,c)}else if(xn||eu(r,a,c,!1),E=(c&r.childLanes)!==0,xn||E){if(E=It,E!==null&&(d=c&-c,d=(d&42)!==0?1:pa(d),d=(d&(E.suspendedLanes|c))!==0?0:d,d!==0&&d!==O.retryLane))throw O.retryLane=d,sl(r,d),gs(E,r,d),i0;S.data==="$?"||yp(),a=Zg(r,a,c)}else S.data==="$?"?(a.flags|=192,a.child=r.child,a=null):(r=O.treeContext,Bt=Gs(S.nextSibling),Hn=a,ct=!0,Qi=null,dr=!1,r!==null&&(Cs[Rs++]=zr,Cs[Rs++]=Gr,Cs[Rs++]=Hi,zr=r.id,Gr=r.overflow,Hi=a),a=Jg(a,d.children),a.flags|=4096);return a}return g?(ja(),g=d.fallback,S=a.mode,O=r.child,Z=O.sibling,d=Br(O,{mode:"hidden",children:d.children}),d.subtreeFlags=O.subtreeFlags&65011712,Z!==null?g=Br(Z,g):(g=Gi(g,S,c,null),g.flags|=2),g.return=a,d.return=a,d.sibling=g,a.child=d,d=g,g=a.child,S=r.child.memoizedState,S===null?S=Xg(c):(O=S.cachePool,O!==null?(Z=cn._currentValue,O=O.parent!==Z?{parent:Z,pool:Z}:O):O=tb(),S={baseLanes:S.baseLanes|c,cachePool:O}),g.memoizedState=S,g.childLanes=Wg(r,E,c),a.memoizedState=Yg,d):(Ia(a),c=r.child,r=c.sibling,c=Br(c,{mode:"visible",children:d.children}),c.return=a,c.sibling=null,r!==null&&(E=a.deletions,E===null?(a.deletions=[r],a.flags|=16):E.push(r)),a.child=c,a.memoizedState=null,c)}function Jg(r,a){return a=Mh({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function Mh(r,a){return r=us(22,r,null,a),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Zg(r,a,c){return ml(a,r.child,null,c),r=Jg(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function p0(r,a,c){r.lanes|=a;var d=r.alternate;d!==null&&(d.lanes|=a),yg(r.return,a,c)}function ep(r,a,c,d,g){var y=r.memoizedState;y===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:g}:(y.isBackwards=a,y.rendering=null,y.renderingStartTime=0,y.last=d,y.tail=c,y.tailMode=g)}function y0(r,a,c){var d=a.pendingProps,g=d.revealOrder,y=d.tail;if(In(r,a,d.children,c),d=un.current,(d&2)!==0)d=d&1|2,a.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&p0(r,c,a);else if(r.tag===19)p0(r,c,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}switch(me(un,d),g){case"forwards":for(c=a.child,g=null;c!==null;)r=c.alternate,r!==null&&Rh(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=a.child,a.child=null):(g=c.sibling,c.sibling=null),ep(a,!1,g,c,y);break;case"backwards":for(c=null,g=a.child,a.child=null;g!==null;){if(r=g.alternate,r!==null&&Rh(r)===null){a.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}ep(a,!0,c,null,y);break;case"together":ep(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Yr(r,a,c){if(r!==null&&(a.dependencies=r.dependencies),Pa|=a.lanes,(c&a.childLanes)===0)if(r!==null){if(eu(r,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(n(153));if(a.child!==null){for(r=a.child,c=Br(r,r.pendingProps),a.child=c,c.return=a;r.sibling!==null;)r=r.sibling,c=c.sibling=Br(r,r.pendingProps),c.return=a;c.sibling=null}return a.child}function tp(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&gh(r)))}function ej(r,a,c){switch(a.tag){case 3:ye(a,a.stateNode.containerInfo),Ta(a,cn,r.memoizedState.cache),Jc();break;case 27:case 5:Oe(a);break;case 4:ye(a,a.stateNode.containerInfo);break;case 10:Ta(a,a.type,a.memoizedProps.value);break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(Ia(a),a.flags|=128,null):(c&a.child.childLanes)!==0?g0(r,a,c):(Ia(a),r=Yr(r,a,c),r!==null?r.sibling:null);Ia(a);break;case 19:var g=(r.flags&128)!==0;if(d=(c&a.childLanes)!==0,d||(eu(r,a,c,!1),d=(c&a.childLanes)!==0),g){if(d)return y0(r,a,c);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),me(un,un.current),d)break;return null;case 22:case 23:return a.lanes=0,u0(r,a,c);case 24:Ta(a,cn,r.memoizedState.cache)}return Yr(r,a,c)}function x0(r,a,c){if(r!==null)if(r.memoizedProps!==a.pendingProps)xn=!0;else{if(!tp(r,c)&&(a.flags&128)===0)return xn=!1,ej(r,a,c);xn=(r.flags&131072)!==0}else xn=!1,ct&&(a.flags&1048576)!==0&&Kv(a,mh,a.index);switch(a.lanes=0,a.tag){case 16:e:{r=a.pendingProps;var d=a.elementType,g=d._init;if(d=g(d._payload),a.type=d,typeof d=="function")ug(d)?(r=Zi(d,r),a.tag=1,a=f0(null,a,d,r,c)):(a.tag=0,a=Kg(null,a,d,r,c));else{if(d!=null){if(g=d.$$typeof,g===G){a.tag=11,a=o0(null,a,d,r,c);break e}else if(g===C){a.tag=14,a=l0(null,a,d,r,c);break e}}throw a=ze(d)||d,Error(n(306,a,""))}}return a;case 0:return Kg(r,a,a.type,a.pendingProps,c);case 1:return d=a.type,g=Zi(d,a.pendingProps),f0(r,a,d,g,c);case 3:e:{if(ye(a,a.stateNode.containerInfo),r===null)throw Error(n(387));d=a.pendingProps;var y=a.memoizedState;g=y.element,Eg(r,a),ou(a,d,null,c);var E=a.memoizedState;if(d=E.cache,Ta(a,cn,d),d!==y.cache&&xg(a,[cn],c,!0),iu(),d=E.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:E.cache},a.updateQueue.baseState=y,a.memoizedState=y,a.flags&256){a=m0(r,a,d,c);break e}else if(d!==g){g=Is(Error(n(424)),a),Zc(g),a=m0(r,a,d,c);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(Bt=Gs(r.firstChild),Hn=a,ct=!0,Qi=null,dr=!0,c=Xb(a,null,d,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Jc(),d===g){a=Yr(r,a,c);break e}In(r,a,d,c)}a=a.child}return a;case 26:return Ph(r,a),r===null?(c=w_(a.type,null,a.pendingProps,null))?a.memoizedState=c:ct||(c=a.type,r=a.pendingProps,d=Yh(Ee.current).createElement(c),d[an]=a,d[Jt]=r,Cn(d,c,r),$t(d),a.stateNode=d):a.memoizedState=w_(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return Oe(a),r===null&&ct&&(d=a.stateNode=v_(a.type,a.pendingProps,Ee.current),Hn=a,dr=!0,g=Bt,La(a.type)?(Mp=g,Bt=Gs(d.firstChild)):Bt=g),In(r,a,a.pendingProps.children,c),Ph(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&ct&&((g=d=Bt)&&(d=Ij(d,a.type,a.pendingProps,dr),d!==null?(a.stateNode=d,Hn=a,Bt=Gs(d.firstChild),dr=!1,g=!0):g=!1),g||Ki(a)),Oe(a),g=a.type,y=a.pendingProps,E=r!==null?r.memoizedProps:null,d=y.children,Rp(g,y)?d=null:E!==null&&Rp(g,E)&&(a.flags|=32),a.memoizedState!==null&&(g=Cg(r,a,$I,null,null,c),ju._currentValue=g),Ph(r,a),In(r,a,d,c),a.child;case 6:return r===null&&ct&&((r=c=Bt)&&(c=jj(c,a.pendingProps,dr),c!==null?(a.stateNode=c,Hn=a,Bt=null,r=!0):r=!1),r||Ki(a)),null;case 13:return g0(r,a,c);case 4:return ye(a,a.stateNode.containerInfo),d=a.pendingProps,r===null?a.child=ml(a,null,d,c):In(r,a,d,c),a.child;case 11:return o0(r,a,a.type,a.pendingProps,c);case 7:return In(r,a,a.pendingProps,c),a.child;case 8:return In(r,a,a.pendingProps.children,c),a.child;case 12:return In(r,a,a.pendingProps.children,c),a.child;case 10:return d=a.pendingProps,Ta(a,a.type,d.value),In(r,a,d.children,c),a.child;case 9:return g=a.type._context,d=a.pendingProps.children,Xi(a),g=Pn(g),d=d(g),a.flags|=1,In(r,a,d,c),a.child;case 14:return l0(r,a,a.type,a.pendingProps,c);case 15:return c0(r,a,a.type,a.pendingProps,c);case 19:return y0(r,a,c);case 31:return d=a.pendingProps,c=a.mode,d={mode:d.mode,children:d.children},r===null?(c=Mh(d,c),c.ref=a.ref,a.child=c,c.return=a,a=c):(c=Br(r.child,d),c.ref=a.ref,a.child=c,c.return=a,a=c),a;case 22:return u0(r,a,c);case 24:return Xi(a),d=Pn(cn),r===null?(g=_g(),g===null&&(g=It,y=vg(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),a.memoizedState={parent:d,cache:g},Tg(a),Ta(a,cn,g)):((r.lanes&c)!==0&&(Eg(r,a),ou(a,null,null,c),iu()),g=r.memoizedState,y=a.memoizedState,g.parent!==d?(g={parent:d,cache:d},a.memoizedState=g,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=g),Ta(a,cn,d)):(d=y.cache,Ta(a,cn,d),d!==g.cache&&xg(a,[cn],c,!0))),In(r,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function Xr(r){r.flags|=4}function v0(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!A_(a)){if(a=ks.current,a!==null&&((at&4194048)===at?hr!==null:(at&62914560)!==at&&(at&536870912)===0||a!==hr))throw ru=wg,nb;r.flags|=8192}}function Vh(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?Rc():536870912,r.lanes|=a,xl|=a)}function mu(r,a){if(!ct)switch(r.tailMode){case"hidden":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function Ut(r){var a=r.alternate!==null&&r.alternate.child===r.child,c=0,d=0;if(a)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=d,r.childLanes=c,a}function tj(r,a,c){var d=a.pendingProps;switch(mg(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(a),null;case 1:return Ut(a),null;case 3:return c=a.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),$r(cn),Te(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Wc(a)?Xr(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Wv())),Ut(a),null;case 26:return c=a.memoizedState,r===null?(Xr(a),c!==null?(Ut(a),v0(a,c)):(Ut(a),a.flags&=-16777217)):c?c!==r.memoizedState?(Xr(a),Ut(a),v0(a,c)):(Ut(a),a.flags&=-16777217):(r.memoizedProps!==d&&Xr(a),Ut(a),a.flags&=-16777217),null;case 27:nt(a),c=Ee.current;var g=a.type;if(r!==null&&a.stateNode!=null)r.memoizedProps!==d&&Xr(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return Ut(a),null}r=Ae.current,Wc(a)?Yv(a):(r=v_(g,d,c),a.stateNode=r,Xr(a))}return Ut(a),null;case 5:if(nt(a),c=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==d&&Xr(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return Ut(a),null}if(r=Ae.current,Wc(a))Yv(a);else{switch(g=Yh(Ee.current),r){case 1:r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof d.is=="string"?g.createElement("select",{is:d.is}):g.createElement("select"),d.multiple?r.multiple=!0:d.size&&(r.size=d.size);break;default:r=typeof d.is=="string"?g.createElement(c,{is:d.is}):g.createElement(c)}}r[an]=a,r[Jt]=d;e:for(g=a.child;g!==null;){if(g.tag===5||g.tag===6)r.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===a)break e;for(;g.sibling===null;){if(g.return===null||g.return===a)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}a.stateNode=r;e:switch(Cn(r,c,d),c){case"button":case"input":case"select":case"textarea":r=!!d.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Xr(a)}}return Ut(a),a.flags&=-16777217,null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==d&&Xr(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(n(166));if(r=Ee.current,Wc(a)){if(r=a.stateNode,c=a.memoizedProps,d=null,g=Hn,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}r[an]=a,r=!!(r.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||h_(r.nodeValue,c)),r||Ki(a)}else r=Yh(r).createTextNode(d),r[an]=a,a.stateNode=r}return Ut(a),null;case 13:if(d=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Wc(a),d!==null&&d.dehydrated!==null){if(r===null){if(!g)throw Error(n(318));if(g=a.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(n(317));g[an]=a}else Jc(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ut(a),g=!1}else g=Wv(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return a.flags&256?(Kr(a),a):(Kr(a),null)}if(Kr(a),(a.flags&128)!==0)return a.lanes=c,a;if(c=d!==null,r=r!==null&&r.memoizedState!==null,c){d=a.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool);var y=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==g&&(d.flags|=2048)}return c!==r&&c&&(a.child.flags|=8192),Vh(a,a.updateQueue),Ut(a),null;case 4:return Te(),r===null&&Np(a.stateNode.containerInfo),Ut(a),null;case 10:return $r(a.type),Ut(a),null;case 19:if(ge(un),g=a.memoizedState,g===null)return Ut(a),null;if(d=(a.flags&128)!==0,y=g.rendering,y===null)if(d)mu(g,!1);else{if(zt!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(y=Rh(r),y!==null){for(a.flags|=128,mu(g,!1),r=y.updateQueue,a.updateQueue=r,Vh(a,r),a.subtreeFlags=0,r=c,c=a.child;c!==null;)Qv(c,r),c=c.sibling;return me(un,un.current&1|2),a.child}r=r.sibling}g.tail!==null&&St()>Uh&&(a.flags|=128,d=!0,mu(g,!1),a.lanes=4194304)}else{if(!d)if(r=Rh(y),r!==null){if(a.flags|=128,d=!0,r=r.updateQueue,a.updateQueue=r,Vh(a,r),mu(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!ct)return Ut(a),null}else 2*St()-g.renderingStartTime>Uh&&c!==536870912&&(a.flags|=128,d=!0,mu(g,!1),a.lanes=4194304);g.isBackwards?(y.sibling=a.child,a.child=y):(r=g.last,r!==null?r.sibling=y:a.child=y,g.last=y)}return g.tail!==null?(a=g.tail,g.rendering=a,g.tail=a.sibling,g.renderingStartTime=St(),a.sibling=null,r=un.current,me(un,d?r&1|2:r&1),a):(Ut(a),null);case 22:case 23:return Kr(a),Ig(),d=a.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(c&536870912)!==0&&(a.flags&128)===0&&(Ut(a),a.subtreeFlags&6&&(a.flags|=8192)):Ut(a),c=a.updateQueue,c!==null&&Vh(a,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==c&&(a.flags|=2048),r!==null&&ge(Wi),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),$r(cn),Ut(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function nj(r,a){switch(mg(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return $r(cn),Te(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return nt(a),null;case 13:if(Kr(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(n(340));Jc()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return ge(un),null;case 4:return Te(),null;case 10:return $r(a.type),null;case 22:case 23:return Kr(a),Ig(),r!==null&&ge(Wi),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return $r(cn),null;case 25:return null;default:return null}}function b0(r,a){switch(mg(a),a.tag){case 3:$r(cn),Te();break;case 26:case 27:case 5:nt(a);break;case 4:Te();break;case 13:Kr(a);break;case 19:ge(un);break;case 10:$r(a.type);break;case 22:case 23:Kr(a),Ig(),r!==null&&ge(Wi);break;case 24:$r(cn)}}function gu(r,a){try{var c=a.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var g=d.next;c=g;do{if((c.tag&r)===r){d=void 0;var y=c.create,E=c.inst;d=y(),E.destroy=d}c=c.next}while(c!==g)}}catch(S){Nt(a,a.return,S)}}function Ca(r,a,c){try{var d=a.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var y=g.next;d=y;do{if((d.tag&r)===r){var E=d.inst,S=E.destroy;if(S!==void 0){E.destroy=void 0,g=a;var O=c,Z=S;try{Z()}catch(ce){Nt(g,O,ce)}}}d=d.next}while(d!==y)}}catch(ce){Nt(a,a.return,ce)}}function _0(r){var a=r.updateQueue;if(a!==null){var c=r.stateNode;try{lb(a,c)}catch(d){Nt(r,r.return,d)}}}function w0(r,a,c){c.props=Zi(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(d){Nt(r,a,d)}}function pu(r,a){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof c=="function"?r.refCleanup=c(d):c.current=d}}catch(g){Nt(r,a,g)}}function fr(r,a){var c=r.ref,d=r.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(g){Nt(r,a,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Nt(r,a,g)}else c.current=null}function T0(r){var a=r.type,c=r.memoizedProps,d=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break e;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(g){Nt(r,r.return,g)}}function np(r,a,c){try{var d=r.stateNode;Tj(d,r.type,c,a),d[Jt]=a}catch(g){Nt(r,r.return,g)}}function E0(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&La(r.type)||r.tag===4}function sp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||E0(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&La(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function rp(r,a,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(r),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Kh));else if(d!==4&&(d===27&&La(r.type)&&(c=r.stateNode,a=null),r=r.child,r!==null))for(rp(r,a,c),r=r.sibling;r!==null;)rp(r,a,c),r=r.sibling}function Oh(r,a,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,a?c.insertBefore(r,a):c.appendChild(r);else if(d!==4&&(d===27&&La(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Oh(r,a,c),r=r.sibling;r!==null;)Oh(r,a,c),r=r.sibling}function S0(r){var a=r.stateNode,c=r.memoizedProps;try{for(var d=r.type,g=a.attributes;g.length;)a.removeAttributeNode(g[0]);Cn(a,d,c),a[an]=r,a[Jt]=c}catch(y){Nt(r,r.return,y)}}var Wr=!1,Kt=!1,ap=!1,N0=typeof WeakSet=="function"?WeakSet:Set,vn=null;function sj(r,a){if(r=r.containerInfo,jp=tf,r=Ov(r),sg(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var g=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var E=0,S=-1,O=-1,Z=0,ce=0,he=r,ne=null;t:for(;;){for(var re;he!==c||g!==0&&he.nodeType!==3||(S=E+g),he!==y||d!==0&&he.nodeType!==3||(O=E+d),he.nodeType===3&&(E+=he.nodeValue.length),(re=he.firstChild)!==null;)ne=he,he=re;for(;;){if(he===r)break t;if(ne===c&&++Z===g&&(S=E),ne===y&&++ce===d&&(O=E),(re=he.nextSibling)!==null)break;he=ne,ne=he.parentNode}he=re}c=S===-1||O===-1?null:{start:S,end:O}}else c=null}c=c||{start:0,end:0}}else c=null;for(Cp={focusedElem:r,selectionRange:c},tf=!1,vn=a;vn!==null;)if(a=vn,r=a.child,(a.subtreeFlags&1024)!==0&&r!==null)r.return=a,vn=r;else for(;vn!==null;){switch(a=vn,y=a.alternate,r=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&y!==null){r=void 0,c=a,g=y.memoizedProps,y=y.memoizedState,d=c.stateNode;try{var Le=Zi(c.type,g,c.elementType===c.type);r=d.getSnapshotBeforeUpdate(Le,y),d.__reactInternalSnapshotBeforeUpdate=r}catch(De){Nt(c,c.return,De)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,c=r.nodeType,c===9)Dp(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Dp(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=a.sibling,r!==null){r.return=a.return,vn=r;break}vn=a.return}}function A0(r,a,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:Ra(r,c),d&4&&gu(5,c);break;case 1:if(Ra(r,c),d&4)if(r=c.stateNode,a===null)try{r.componentDidMount()}catch(E){Nt(c,c.return,E)}else{var g=Zi(c.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(g,a,r.__reactInternalSnapshotBeforeUpdate)}catch(E){Nt(c,c.return,E)}}d&64&&_0(c),d&512&&pu(c,c.return);break;case 3:if(Ra(r,c),d&64&&(r=c.updateQueue,r!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{lb(r,a)}catch(E){Nt(c,c.return,E)}}break;case 27:a===null&&d&4&&S0(c);case 26:case 5:Ra(r,c),a===null&&d&4&&T0(c),d&512&&pu(c,c.return);break;case 12:Ra(r,c);break;case 13:Ra(r,c),d&4&&C0(r,c),d&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=hj.bind(null,c),Cj(r,c))));break;case 22:if(d=c.memoizedState!==null||Wr,!d){a=a!==null&&a.memoizedState!==null||Kt,g=Wr;var y=Kt;Wr=d,(Kt=a)&&!y?ka(r,c,(c.subtreeFlags&8772)!==0):Ra(r,c),Wr=g,Kt=y}break;case 30:break;default:Ra(r,c)}}function I0(r){var a=r.alternate;a!==null&&(r.alternate=null,I0(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&va(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Dt=null,Kn=!1;function Jr(r,a,c){for(c=c.child;c!==null;)j0(r,a,c),c=c.sibling}function j0(r,a,c){if(ft&&typeof ft.onCommitFiberUnmount=="function")try{ft.onCommitFiberUnmount(qt,c)}catch{}switch(c.tag){case 26:Kt||fr(c,a),Jr(r,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Kt||fr(c,a);var d=Dt,g=Kn;La(c.type)&&(Dt=c.stateNode,Kn=!1),Jr(r,a,c),Su(c.stateNode),Dt=d,Kn=g;break;case 5:Kt||fr(c,a);case 6:if(d=Dt,g=Kn,Dt=null,Jr(r,a,c),Dt=d,Kn=g,Dt!==null)if(Kn)try{(Dt.nodeType===9?Dt.body:Dt.nodeName==="HTML"?Dt.ownerDocument.body:Dt).removeChild(c.stateNode)}catch(y){Nt(c,a,y)}else try{Dt.removeChild(c.stateNode)}catch(y){Nt(c,a,y)}break;case 18:Dt!==null&&(Kn?(r=Dt,y_(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),Du(r)):y_(Dt,c.stateNode));break;case 4:d=Dt,g=Kn,Dt=c.stateNode.containerInfo,Kn=!0,Jr(r,a,c),Dt=d,Kn=g;break;case 0:case 11:case 14:case 15:Kt||Ca(2,c,a),Kt||Ca(4,c,a),Jr(r,a,c);break;case 1:Kt||(fr(c,a),d=c.stateNode,typeof d.componentWillUnmount=="function"&&w0(c,a,d)),Jr(r,a,c);break;case 21:Jr(r,a,c);break;case 22:Kt=(d=Kt)||c.memoizedState!==null,Jr(r,a,c),Kt=d;break;default:Jr(r,a,c)}}function C0(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Du(r)}catch(c){Nt(a,a.return,c)}}function rj(r){switch(r.tag){case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new N0),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new N0),a;default:throw Error(n(435,r.tag))}}function ip(r,a){var c=rj(r);a.forEach(function(d){var g=fj.bind(null,r,d);c.has(d)||(c.add(d),d.then(g,g))})}function ds(r,a){var c=a.deletions;if(c!==null)for(var d=0;d<c.length;d++){var g=c[d],y=r,E=a,S=E;e:for(;S!==null;){switch(S.tag){case 27:if(La(S.type)){Dt=S.stateNode,Kn=!1;break e}break;case 5:Dt=S.stateNode,Kn=!1;break e;case 3:case 4:Dt=S.stateNode.containerInfo,Kn=!0;break e}S=S.return}if(Dt===null)throw Error(n(160));j0(y,E,g),Dt=null,Kn=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)R0(a,r),a=a.sibling}var zs=null;function R0(r,a){var c=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ds(a,r),hs(r),d&4&&(Ca(3,r,r.return),gu(3,r),Ca(5,r,r.return));break;case 1:ds(a,r),hs(r),d&512&&(Kt||c===null||fr(c,c.return)),d&64&&Wr&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var g=zs;if(ds(a,r),hs(r),d&512&&(Kt||c===null||fr(c,c.return)),d&4){var y=c!==null?c.memoizedState:null;if(d=r.memoizedState,c===null)if(d===null)if(r.stateNode===null){e:{d=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(d){case"title":y=g.getElementsByTagName("title")[0],(!y||y[Ii]||y[an]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(d),g.head.insertBefore(y,g.querySelector("head > title"))),Cn(y,d,c),y[an]=r,$t(y),d=y;break e;case"link":var E=S_("link","href",g).get(d+(c.href||""));if(E){for(var S=0;S<E.length;S++)if(y=E[S],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){E.splice(S,1);break t}}y=g.createElement(d),Cn(y,d,c),g.head.appendChild(y);break;case"meta":if(E=S_("meta","content",g).get(d+(c.content||""))){for(S=0;S<E.length;S++)if(y=E[S],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){E.splice(S,1);break t}}y=g.createElement(d),Cn(y,d,c),g.head.appendChild(y);break;default:throw Error(n(468,d))}y[an]=r,$t(y),d=y}r.stateNode=d}else N_(g,r.type,r.stateNode);else r.stateNode=E_(g,d,r.memoizedProps);else y!==d?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,d===null?N_(g,r.type,r.stateNode):E_(g,d,r.memoizedProps)):d===null&&r.stateNode!==null&&np(r,r.memoizedProps,c.memoizedProps)}break;case 27:ds(a,r),hs(r),d&512&&(Kt||c===null||fr(c,c.return)),c!==null&&d&4&&np(r,r.memoizedProps,c.memoizedProps);break;case 5:if(ds(a,r),hs(r),d&512&&(Kt||c===null||fr(c,c.return)),r.flags&32){g=r.stateNode;try{Es(g,"")}catch(re){Nt(r,r.return,re)}}d&4&&r.stateNode!=null&&(g=r.memoizedProps,np(r,g,c!==null?c.memoizedProps:g)),d&1024&&(ap=!0);break;case 6:if(ds(a,r),hs(r),d&4){if(r.stateNode===null)throw Error(n(162));d=r.memoizedProps,c=r.stateNode;try{c.nodeValue=d}catch(re){Nt(r,r.return,re)}}break;case 3:if(Jh=null,g=zs,zs=Xh(a.containerInfo),ds(a,r),zs=g,hs(r),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Du(a.containerInfo)}catch(re){Nt(r,r.return,re)}ap&&(ap=!1,k0(r));break;case 4:d=zs,zs=Xh(r.stateNode.containerInfo),ds(a,r),hs(r),zs=d;break;case 12:ds(a,r),hs(r);break;case 13:ds(a,r),hs(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(hp=St()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,ip(r,d)));break;case 22:g=r.memoizedState!==null;var O=c!==null&&c.memoizedState!==null,Z=Wr,ce=Kt;if(Wr=Z||g,Kt=ce||O,ds(a,r),Kt=ce,Wr=Z,hs(r),d&8192)e:for(a=r.stateNode,a._visibility=g?a._visibility&-2:a._visibility|1,g&&(c===null||O||Wr||Kt||eo(r)),c=null,a=r;;){if(a.tag===5||a.tag===26){if(c===null){O=c=a;try{if(y=O.stateNode,g)E=y.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{S=O.stateNode;var he=O.memoizedProps.style,ne=he!=null&&he.hasOwnProperty("display")?he.display:null;S.style.display=ne==null||typeof ne=="boolean"?"":(""+ne).trim()}}catch(re){Nt(O,O.return,re)}}}else if(a.tag===6){if(c===null){O=a;try{O.stateNode.nodeValue=g?"":O.memoizedProps}catch(re){Nt(O,O.return,re)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=r.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,ip(r,c))));break;case 19:ds(a,r),hs(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,ip(r,d)));break;case 30:break;case 21:break;default:ds(a,r),hs(r)}}function hs(r){var a=r.flags;if(a&2){try{for(var c,d=r.return;d!==null;){if(E0(d)){c=d;break}d=d.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var g=c.stateNode,y=sp(r);Oh(r,y,g);break;case 5:var E=c.stateNode;c.flags&32&&(Es(E,""),c.flags&=-33);var S=sp(r);Oh(r,S,E);break;case 3:case 4:var O=c.stateNode.containerInfo,Z=sp(r);rp(r,Z,O);break;default:throw Error(n(161))}}catch(ce){Nt(r,r.return,ce)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function k0(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;k0(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function Ra(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)A0(r,a.alternate,a),a=a.sibling}function eo(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Ca(4,a,a.return),eo(a);break;case 1:fr(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&w0(a,a.return,c),eo(a);break;case 27:Su(a.stateNode);case 26:case 5:fr(a,a.return),eo(a);break;case 22:a.memoizedState===null&&eo(a);break;case 30:eo(a);break;default:eo(a)}r=r.sibling}}function ka(r,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,g=r,y=a,E=y.flags;switch(y.tag){case 0:case 11:case 15:ka(g,y,c),gu(4,y);break;case 1:if(ka(g,y,c),d=y,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Z){Nt(d,d.return,Z)}if(d=y,g=d.updateQueue,g!==null){var S=d.stateNode;try{var O=g.shared.hiddenCallbacks;if(O!==null)for(g.shared.hiddenCallbacks=null,g=0;g<O.length;g++)ob(O[g],S)}catch(Z){Nt(d,d.return,Z)}}c&&E&64&&_0(y),pu(y,y.return);break;case 27:S0(y);case 26:case 5:ka(g,y,c),c&&d===null&&E&4&&T0(y),pu(y,y.return);break;case 12:ka(g,y,c);break;case 13:ka(g,y,c),c&&E&4&&C0(g,y);break;case 22:y.memoizedState===null&&ka(g,y,c),pu(y,y.return);break;case 30:break;default:ka(g,y,c)}a=a.sibling}}function op(r,a){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&tu(c))}function lp(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&tu(r))}function mr(r,a,c,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)D0(r,a,c,d),a=a.sibling}function D0(r,a,c,d){var g=a.flags;switch(a.tag){case 0:case 11:case 15:mr(r,a,c,d),g&2048&&gu(9,a);break;case 1:mr(r,a,c,d);break;case 3:mr(r,a,c,d),g&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&tu(r)));break;case 12:if(g&2048){mr(r,a,c,d),r=a.stateNode;try{var y=a.memoizedProps,E=y.id,S=y.onPostCommit;typeof S=="function"&&S(E,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(O){Nt(a,a.return,O)}}else mr(r,a,c,d);break;case 13:mr(r,a,c,d);break;case 23:break;case 22:y=a.stateNode,E=a.alternate,a.memoizedState!==null?y._visibility&2?mr(r,a,c,d):yu(r,a):y._visibility&2?mr(r,a,c,d):(y._visibility|=2,gl(r,a,c,d,(a.subtreeFlags&10256)!==0)),g&2048&&op(E,a);break;case 24:mr(r,a,c,d),g&2048&&lp(a.alternate,a);break;default:mr(r,a,c,d)}}function gl(r,a,c,d,g){for(g=g&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var y=r,E=a,S=c,O=d,Z=E.flags;switch(E.tag){case 0:case 11:case 15:gl(y,E,S,O,g),gu(8,E);break;case 23:break;case 22:var ce=E.stateNode;E.memoizedState!==null?ce._visibility&2?gl(y,E,S,O,g):yu(y,E):(ce._visibility|=2,gl(y,E,S,O,g)),g&&Z&2048&&op(E.alternate,E);break;case 24:gl(y,E,S,O,g),g&&Z&2048&&lp(E.alternate,E);break;default:gl(y,E,S,O,g)}a=a.sibling}}function yu(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=r,d=a,g=d.flags;switch(d.tag){case 22:yu(c,d),g&2048&&op(d.alternate,d);break;case 24:yu(c,d),g&2048&&lp(d.alternate,d);break;default:yu(c,d)}a=a.sibling}}var xu=8192;function pl(r){if(r.subtreeFlags&xu)for(r=r.child;r!==null;)P0(r),r=r.sibling}function P0(r){switch(r.tag){case 26:pl(r),r.flags&xu&&r.memoizedState!==null&&zj(zs,r.memoizedState,r.memoizedProps);break;case 5:pl(r);break;case 3:case 4:var a=zs;zs=Xh(r.stateNode.containerInfo),pl(r),zs=a;break;case 22:r.memoizedState===null&&(a=r.alternate,a!==null&&a.memoizedState!==null?(a=xu,xu=16777216,pl(r),xu=a):pl(r));break;default:pl(r)}}function M0(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function vu(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var d=a[c];vn=d,O0(d,r)}M0(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)V0(r),r=r.sibling}function V0(r){switch(r.tag){case 0:case 11:case 15:vu(r),r.flags&2048&&Ca(9,r,r.return);break;case 3:vu(r);break;case 12:vu(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,Lh(r)):vu(r);break;default:vu(r)}}function Lh(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var d=a[c];vn=d,O0(d,r)}M0(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Ca(8,a,a.return),Lh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Lh(a));break;default:Lh(a)}r=r.sibling}}function O0(r,a){for(;vn!==null;){var c=vn;switch(c.tag){case 0:case 11:case 15:Ca(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:tu(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,vn=d;else e:for(c=r;vn!==null;){d=vn;var g=d.sibling,y=d.return;if(I0(d),d===c){vn=null;break e}if(g!==null){g.return=y,vn=g;break e}vn=y}}}var aj={getCacheForType:function(r){var a=Pn(cn),c=a.data.get(r);return c===void 0&&(c=r(),a.data.set(r,c)),c}},ij=typeof WeakMap=="function"?WeakMap:Map,mt=0,It=null,Je=null,at=0,gt=0,fs=null,Da=!1,yl=!1,cp=!1,Zr=0,zt=0,Pa=0,to=0,up=0,Ds=0,xl=0,bu=null,Yn=null,dp=!1,hp=0,Uh=1/0,Fh=null,Ma=null,jn=0,Va=null,vl=null,bl=0,fp=0,mp=null,L0=null,_u=0,gp=null;function ms(){if((mt&2)!==0&&at!==0)return at&-at;if(F.T!==null){var r=ol;return r!==0?r:wp()}return ya()}function U0(){Ds===0&&(Ds=(at&536870912)===0||ct?Cc():536870912);var r=ks.current;return r!==null&&(r.flags|=32),Ds}function gs(r,a,c){(r===It&&(gt===2||gt===9)||r.cancelPendingCommit!==null)&&(_l(r,0),Oa(r,at,Ds,!1)),Rr(r,c),((mt&2)===0||r!==It)&&(r===It&&((mt&2)===0&&(to|=c),zt===4&&Oa(r,at,Ds,!1)),gr(r))}function F0(r,a,c){if((mt&6)!==0)throw Error(n(327));var d=!c&&(a&124)===0&&(a&r.expiredLanes)===0||Ai(r,a),g=d?cj(r,a):xp(r,a,!0),y=d;do{if(g===0){yl&&!d&&Oa(r,a,0,!1);break}else{if(c=r.current.alternate,y&&!oj(c)){g=xp(r,a,!1),y=!1;continue}if(g===2){if(y=a,r.errorRecoveryDisabledLanes&y)var E=0;else E=r.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){a=E;e:{var S=r;g=bu;var O=S.current.memoizedState.isDehydrated;if(O&&(_l(S,E).flags|=256),E=xp(S,E,!1),E!==2){if(cp&&!O){S.errorRecoveryDisabledLanes|=y,to|=y,g=4;break e}y=Yn,Yn=g,y!==null&&(Yn===null?Yn=y:Yn.push.apply(Yn,y))}g=E}if(y=!1,g!==2)continue}}if(g===1){_l(r,0),Oa(r,a,0,!0);break}e:{switch(d=r,y=g,y){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Oa(d,a,Ds,!Da);break e;case 2:Yn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(g=hp+300-St(),10<g)){if(Oa(d,a,Ds,!Da),Lo(d,0,!0)!==0)break e;d.timeoutHandle=g_(q0.bind(null,d,c,Yn,Fh,dp,a,Ds,to,xl,Da,y,2,-0,0),g);break e}q0(d,c,Yn,Fh,dp,a,Ds,to,xl,Da,y,0,-0,0)}}break}while(!0);gr(r)}function q0(r,a,c,d,g,y,E,S,O,Z,ce,he,ne,re){if(r.timeoutHandle=-1,he=a.subtreeFlags,(he&8192||(he&16785408)===16785408)&&(Iu={stylesheets:null,count:0,unsuspend:Bj},P0(a),he=Gj(),he!==null)){r.cancelPendingCommit=he(K0.bind(null,r,a,y,c,d,g,E,S,O,ce,1,ne,re)),Oa(r,y,E,!Z);return}K0(r,a,y,c,d,g,E,S,O)}function oj(r){for(var a=r;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var g=c[d],y=g.getSnapshot;g=g.value;try{if(!cs(y(),g))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Oa(r,a,c,d){a&=~up,a&=~to,r.suspendedLanes|=a,r.pingedLanes&=~a,d&&(r.warmLanes|=a),d=r.expirationTimes;for(var g=a;0<g;){var y=31-Dn(g),E=1<<y;d[y]=-1,g&=~E}c!==0&&er(r,c,a)}function qh(){return(mt&6)===0?(wu(0),!1):!0}function pp(){if(Je!==null){if(gt===0)var r=Je.return;else r=Je,Hr=Yi=null,Dg(r),fl=null,hu=0,r=Je;for(;r!==null;)b0(r.alternate,r),r=r.return;Je=null}}function _l(r,a){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,Sj(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),pp(),It=r,Je=c=Br(r.current,null),at=a,gt=0,fs=null,Da=!1,yl=Ai(r,a),cp=!1,xl=Ds=up=to=Pa=zt=0,Yn=bu=null,dp=!1,(a&8)!==0&&(a|=a&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=a;0<d;){var g=31-Dn(d),y=1<<g;a|=r[g],d&=~y}return Zr=a,ch(),c}function B0(r,a){Ke=null,F.H=Ih,a===su||a===xh?(a=ab(),gt=3):a===nb?(a=ab(),gt=4):gt=a===i0?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,fs=a,Je===null&&(zt=1,Dh(r,Is(a,r.current)))}function z0(){var r=F.H;return F.H=Ih,r===null?Ih:r}function G0(){var r=F.A;return F.A=aj,r}function yp(){zt=4,Da||(at&4194048)!==at&&ks.current!==null||(yl=!0),(Pa&134217727)===0&&(to&134217727)===0||It===null||Oa(It,at,Ds,!1)}function xp(r,a,c){var d=mt;mt|=2;var g=z0(),y=G0();(It!==r||at!==a)&&(Fh=null,_l(r,a)),a=!1;var E=zt;e:do try{if(gt!==0&&Je!==null){var S=Je,O=fs;switch(gt){case 8:pp(),E=6;break e;case 3:case 2:case 9:case 6:ks.current===null&&(a=!0);var Z=gt;if(gt=0,fs=null,wl(r,S,O,Z),c&&yl){E=0;break e}break;default:Z=gt,gt=0,fs=null,wl(r,S,O,Z)}}lj(),E=zt;break}catch(ce){B0(r,ce)}while(!0);return a&&r.shellSuspendCounter++,Hr=Yi=null,mt=d,F.H=g,F.A=y,Je===null&&(It=null,at=0,ch()),E}function lj(){for(;Je!==null;)H0(Je)}function cj(r,a){var c=mt;mt|=2;var d=z0(),g=G0();It!==r||at!==a?(Fh=null,Uh=St()+500,_l(r,a)):yl=Ai(r,a);e:do try{if(gt!==0&&Je!==null){a=Je;var y=fs;t:switch(gt){case 1:gt=0,fs=null,wl(r,a,y,1);break;case 2:case 9:if(sb(y)){gt=0,fs=null,$0(a);break}a=function(){gt!==2&&gt!==9||It!==r||(gt=7),gr(r)},y.then(a,a);break e;case 3:gt=7;break e;case 4:gt=5;break e;case 7:sb(y)?(gt=0,fs=null,$0(a)):(gt=0,fs=null,wl(r,a,y,7));break;case 5:var E=null;switch(Je.tag){case 26:E=Je.memoizedState;case 5:case 27:var S=Je;if(!E||A_(E)){gt=0,fs=null;var O=S.sibling;if(O!==null)Je=O;else{var Z=S.return;Z!==null?(Je=Z,Bh(Z)):Je=null}break t}}gt=0,fs=null,wl(r,a,y,5);break;case 6:gt=0,fs=null,wl(r,a,y,6);break;case 8:pp(),zt=6;break e;default:throw Error(n(462))}}uj();break}catch(ce){B0(r,ce)}while(!0);return Hr=Yi=null,F.H=d,F.A=g,mt=c,Je!==null?0:(It=null,at=0,ch(),zt)}function uj(){for(;Je!==null&&!Qe();)H0(Je)}function H0(r){var a=x0(r.alternate,r,Zr);r.memoizedProps=r.pendingProps,a===null?Bh(r):Je=a}function $0(r){var a=r,c=a.alternate;switch(a.tag){case 15:case 0:a=h0(c,a,a.pendingProps,a.type,void 0,at);break;case 11:a=h0(c,a,a.pendingProps,a.type.render,a.ref,at);break;case 5:Dg(a);default:b0(c,a),a=Je=Qv(a,Zr),a=x0(c,a,Zr)}r.memoizedProps=r.pendingProps,a===null?Bh(r):Je=a}function wl(r,a,c,d){Hr=Yi=null,Dg(a),fl=null,hu=0;var g=a.return;try{if(ZI(r,g,a,c,at)){zt=1,Dh(r,Is(c,r.current)),Je=null;return}}catch(y){if(g!==null)throw Je=g,y;zt=1,Dh(r,Is(c,r.current)),Je=null;return}a.flags&32768?(ct||d===1?r=!0:yl||(at&536870912)!==0?r=!1:(Da=r=!0,(d===2||d===9||d===3||d===6)&&(d=ks.current,d!==null&&d.tag===13&&(d.flags|=16384))),Q0(a,r)):Bh(a)}function Bh(r){var a=r;do{if((a.flags&32768)!==0){Q0(a,Da);return}r=a.return;var c=tj(a.alternate,a,Zr);if(c!==null){Je=c;return}if(a=a.sibling,a!==null){Je=a;return}Je=a=r}while(a!==null);zt===0&&(zt=5)}function Q0(r,a){do{var c=nj(r.alternate,r);if(c!==null){c.flags&=32767,Je=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(r=r.sibling,r!==null)){Je=r;return}Je=r=c}while(r!==null);zt=6,Je=null}function K0(r,a,c,d,g,y,E,S,O){r.cancelPendingCommit=null;do zh();while(jn!==0);if((mt&6)!==0)throw Error(n(327));if(a!==null){if(a===r.current)throw Error(n(177));if(y=a.lanes|a.childLanes,y|=lg,kc(r,c,y,E,S,O),r===It&&(Je=It=null,at=0),vl=a,Va=r,bl=c,fp=y,mp=g,L0=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,mj($n,function(){return Z0(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=F.T,F.T=null,g=ie.p,ie.p=2,E=mt,mt|=4;try{sj(r,a,c)}finally{mt=E,ie.p=g,F.T=d}}jn=1,Y0(),X0(),W0()}}function Y0(){if(jn===1){jn=0;var r=Va,a=vl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=F.T,F.T=null;var d=ie.p;ie.p=2;var g=mt;mt|=4;try{R0(a,r);var y=Cp,E=Ov(r.containerInfo),S=y.focusedElem,O=y.selectionRange;if(E!==S&&S&&S.ownerDocument&&Vv(S.ownerDocument.documentElement,S)){if(O!==null&&sg(S)){var Z=O.start,ce=O.end;if(ce===void 0&&(ce=Z),"selectionStart"in S)S.selectionStart=Z,S.selectionEnd=Math.min(ce,S.value.length);else{var he=S.ownerDocument||document,ne=he&&he.defaultView||window;if(ne.getSelection){var re=ne.getSelection(),Le=S.textContent.length,De=Math.min(O.start,Le),Tt=O.end===void 0?De:Math.min(O.end,Le);!re.extend&&De>Tt&&(E=Tt,Tt=De,De=E);var Y=Mv(S,De),Q=Mv(S,Tt);if(Y&&Q&&(re.rangeCount!==1||re.anchorNode!==Y.node||re.anchorOffset!==Y.offset||re.focusNode!==Q.node||re.focusOffset!==Q.offset)){var J=he.createRange();J.setStart(Y.node,Y.offset),re.removeAllRanges(),De>Tt?(re.addRange(J),re.extend(Q.node,Q.offset)):(J.setEnd(Q.node,Q.offset),re.addRange(J))}}}}for(he=[],re=S;re=re.parentNode;)re.nodeType===1&&he.push({element:re,left:re.scrollLeft,top:re.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<he.length;S++){var de=he[S];de.element.scrollLeft=de.left,de.element.scrollTop=de.top}}tf=!!jp,Cp=jp=null}finally{mt=g,ie.p=d,F.T=c}}r.current=a,jn=2}}function X0(){if(jn===2){jn=0;var r=Va,a=vl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=F.T,F.T=null;var d=ie.p;ie.p=2;var g=mt;mt|=4;try{A0(r,a.alternate,a)}finally{mt=g,ie.p=d,F.T=c}}jn=3}}function W0(){if(jn===4||jn===3){jn=0,vt();var r=Va,a=vl,c=bl,d=L0;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?jn=5:(jn=0,vl=Va=null,J0(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Ma=null),Uo(c),a=a.stateNode,ft&&typeof ft.onCommitFiberRoot=="function")try{ft.onCommitFiberRoot(qt,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=F.T,g=ie.p,ie.p=2,F.T=null;try{for(var y=r.onRecoverableError,E=0;E<d.length;E++){var S=d[E];y(S.value,{componentStack:S.stack})}}finally{F.T=a,ie.p=g}}(bl&3)!==0&&zh(),gr(r),g=r.pendingLanes,(c&4194090)!==0&&(g&42)!==0?r===gp?_u++:(_u=0,gp=r):_u=0,wu(0)}}function J0(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,tu(a)))}function zh(r){return Y0(),X0(),W0(),Z0()}function Z0(){if(jn!==5)return!1;var r=Va,a=fp;fp=0;var c=Uo(bl),d=F.T,g=ie.p;try{ie.p=32>c?32:c,F.T=null,c=mp,mp=null;var y=Va,E=bl;if(jn=0,vl=Va=null,bl=0,(mt&6)!==0)throw Error(n(331));var S=mt;if(mt|=4,V0(y.current),D0(y,y.current,E,c),mt=S,wu(0,!1),ft&&typeof ft.onPostCommitFiberRoot=="function")try{ft.onPostCommitFiberRoot(qt,y)}catch{}return!0}finally{ie.p=g,F.T=d,J0(r,a)}}function e_(r,a,c){a=Is(c,a),a=Qg(r.stateNode,a,2),r=Na(r,a,2),r!==null&&(Rr(r,2),gr(r))}function Nt(r,a,c){if(r.tag===3)e_(r,r,c);else for(;a!==null;){if(a.tag===3){e_(a,r,c);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ma===null||!Ma.has(d))){r=Is(c,r),c=r0(2),d=Na(a,c,2),d!==null&&(a0(c,d,a,r),Rr(d,2),gr(d));break}}a=a.return}}function vp(r,a,c){var d=r.pingCache;if(d===null){d=r.pingCache=new ij;var g=new Set;d.set(a,g)}else g=d.get(a),g===void 0&&(g=new Set,d.set(a,g));g.has(c)||(cp=!0,g.add(c),r=dj.bind(null,r,a,c),a.then(r,r))}function dj(r,a,c){var d=r.pingCache;d!==null&&d.delete(a),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,It===r&&(at&c)===c&&(zt===4||zt===3&&(at&62914560)===at&&300>St()-hp?(mt&2)===0&&_l(r,0):up|=c,xl===at&&(xl=0)),gr(r)}function t_(r,a){a===0&&(a=Rc()),r=sl(r,a),r!==null&&(Rr(r,a),gr(r))}function hj(r){var a=r.memoizedState,c=0;a!==null&&(c=a.retryLane),t_(r,c)}function fj(r,a){var c=0;switch(r.tag){case 13:var d=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(a),t_(r,c)}function mj(r,a){return ut(r,a)}var Gh=null,Tl=null,bp=!1,Hh=!1,_p=!1,no=0;function gr(r){r!==Tl&&r.next===null&&(Tl===null?Gh=Tl=r:Tl=Tl.next=r),Hh=!0,bp||(bp=!0,pj())}function wu(r,a){if(!_p&&Hh){_p=!0;do for(var c=!1,d=Gh;d!==null;){if(r!==0){var g=d.pendingLanes;if(g===0)var y=0;else{var E=d.suspendedLanes,S=d.pingedLanes;y=(1<<31-Dn(42|r)+1)-1,y&=g&~(E&~S),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,a_(d,y))}else y=at,y=Lo(d,d===It?y:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(y&3)===0||Ai(d,y)||(c=!0,a_(d,y));d=d.next}while(c);_p=!1}}function gj(){n_()}function n_(){Hh=bp=!1;var r=0;no!==0&&(Ej()&&(r=no),no=0);for(var a=St(),c=null,d=Gh;d!==null;){var g=d.next,y=s_(d,a);y===0?(d.next=null,c===null?Gh=g:c.next=g,g===null&&(Tl=c)):(c=d,(r!==0||(y&3)!==0)&&(Hh=!0)),d=g}wu(r)}function s_(r,a){for(var c=r.suspendedLanes,d=r.pingedLanes,g=r.expirationTimes,y=r.pendingLanes&-62914561;0<y;){var E=31-Dn(y),S=1<<E,O=g[E];O===-1?((S&c)===0||(S&d)!==0)&&(g[E]=jc(S,a)):O<=a&&(r.expiredLanes|=S),y&=~S}if(a=It,c=at,c=Lo(r,r===a?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,c===0||r===a&&(gt===2||gt===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&$e(d),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Ai(r,c)){if(a=c&-c,a===r.callbackPriority)return a;switch(d!==null&&$e(d),Uo(c)){case 2:case 8:c=gn;break;case 32:c=$n;break;case 268435456:c=jr;break;default:c=$n}return d=r_.bind(null,r),c=ut(c,d),r.callbackPriority=a,r.callbackNode=c,a}return d!==null&&d!==null&&$e(d),r.callbackPriority=2,r.callbackNode=null,2}function r_(r,a){if(jn!==0&&jn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(zh()&&r.callbackNode!==c)return null;var d=at;return d=Lo(r,r===It?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(F0(r,d,a),s_(r,St()),r.callbackNode!=null&&r.callbackNode===c?r_.bind(null,r):null)}function a_(r,a){if(zh())return null;F0(r,a,!0)}function pj(){Nj(function(){(mt&6)!==0?ut(ws,gj):n_()})}function wp(){return no===0&&(no=Cc()),no}function i_(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Ho(""+r)}function o_(r,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,r.id&&c.setAttribute("form",r.id),a.parentNode.insertBefore(c,a),r=new FormData(r),c.parentNode.removeChild(c),r}function yj(r,a,c,d,g){if(a==="submit"&&c&&c.stateNode===g){var y=i_((g[Jt]||null).action),E=d.submitter;E&&(a=(a=E[Jt]||null)?i_(a.formAction):E.getAttribute("formAction"),a!==null&&(y=a,E=null));var S=new $o("action","action",null,d,g);r.push({event:S,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(no!==0){var O=E?o_(g,E):new FormData(g);Bg(c,{pending:!0,data:O,method:g.method,action:y},null,O)}}else typeof y=="function"&&(S.preventDefault(),O=E?o_(g,E):new FormData(g),Bg(c,{pending:!0,data:O,method:g.method,action:y},y,O))},currentTarget:g}]})}}for(var Tp=0;Tp<og.length;Tp++){var Ep=og[Tp],xj=Ep.toLowerCase(),vj=Ep[0].toUpperCase()+Ep.slice(1);Bs(xj,"on"+vj)}Bs(Fv,"onAnimationEnd"),Bs(qv,"onAnimationIteration"),Bs(Bv,"onAnimationStart"),Bs("dblclick","onDoubleClick"),Bs("focusin","onFocus"),Bs("focusout","onBlur"),Bs(VI,"onTransitionRun"),Bs(OI,"onTransitionStart"),Bs(LI,"onTransitionCancel"),Bs(zv,"onTransitionEnd"),Dr("onMouseEnter",["mouseout","mouseover"]),Dr("onMouseLeave",["mouseout","mouseover"]),Dr("onPointerEnter",["pointerout","pointerover"]),Dr("onPointerLeave",["pointerout","pointerover"]),Fs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tu));function l_(r,a){a=(a&4)!==0;for(var c=0;c<r.length;c++){var d=r[c],g=d.event;d=d.listeners;e:{var y=void 0;if(a)for(var E=d.length-1;0<=E;E--){var S=d[E],O=S.instance,Z=S.currentTarget;if(S=S.listener,O!==y&&g.isPropagationStopped())break e;y=S,g.currentTarget=Z;try{y(g)}catch(ce){kh(ce)}g.currentTarget=null,y=O}else for(E=0;E<d.length;E++){if(S=d[E],O=S.instance,Z=S.currentTarget,S=S.listener,O!==y&&g.isPropagationStopped())break e;y=S,g.currentTarget=Z;try{y(g)}catch(ce){kh(ce)}g.currentTarget=null,y=O}}}}function Ze(r,a){var c=a[Pc];c===void 0&&(c=a[Pc]=new Set);var d=r+"__bubble";c.has(d)||(c_(a,r,2,!1),c.add(d))}function Sp(r,a,c){var d=0;a&&(d|=4),c_(c,r,d,a)}var $h="_reactListening"+Math.random().toString(36).slice(2);function Np(r){if(!r[$h]){r[$h]=!0,Mc.forEach(function(c){c!=="selectionchange"&&(bj.has(c)||Sp(c,!1,r),Sp(c,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[$h]||(a[$h]=!0,Sp("selectionchange",!1,a))}}function c_(r,a,c,d){switch(D_(a)){case 2:var g=Qj;break;case 8:g=Kj;break;default:g=Fp}c=g.bind(null,a,c,r),g=void 0,!Ns||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),d?g!==void 0?r.addEventListener(a,c,{capture:!0,passive:g}):r.addEventListener(a,c,!0):g!==void 0?r.addEventListener(a,c,{passive:g}):r.addEventListener(a,c,!1)}function Ap(r,a,c,d,g){var y=d;if((a&1)===0&&(a&2)===0&&d!==null)e:for(;;){if(d===null)return;var E=d.tag;if(E===3||E===4){var S=d.stateNode.containerInfo;if(S===g)break;if(E===4)for(E=d.return;E!==null;){var O=E.tag;if((O===3||O===4)&&E.stateNode.containerInfo===g)return;E=E.return}for(;S!==null;){if(E=kr(S),E===null)return;if(O=E.tag,O===5||O===6||O===26||O===27){d=y=E;continue e}S=S.parentNode}}d=d.return}Kd(function(){var Z=y,ce=Ss(c),he=[];e:{var ne=Gv.get(r);if(ne!==void 0){var re=$o,Le=r;switch(r){case"keypress":if(ir(c)===0)break e;case"keydown":case"keyup":re=Jo;break;case"focusin":Le="focus",re=Yo;break;case"focusout":Le="blur",re=Yo;break;case"beforeblur":case"afterblur":re=Yo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=As;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=Zm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=nh;break;case Fv:case qv:case Bv:re=Xo;break;case zv:re=rh;break;case"scroll":case"scrollend":re=Yd;break;case"wheel":re=Zo;break;case"copy":case"cut":case"paste":re=Wo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=Qc;break;case"toggle":case"beforetoggle":re=ih}var De=(a&4)!==0,Tt=!De&&(r==="scroll"||r==="scrollend"),Y=De?ne!==null?ne+"Capture":null:ne;De=[];for(var Q=Z,J;Q!==null;){var de=Q;if(J=de.stateNode,de=de.tag,de!==5&&de!==26&&de!==27||J===null||Y===null||(de=Mi(Q,Y),de!=null&&De.push(Eu(Q,de,J))),Tt)break;Q=Q.return}0<De.length&&(ne=new re(ne,Le,null,c,ce),he.push({event:ne,listeners:De}))}}if((a&7)===0){e:{if(ne=r==="mouseover"||r==="pointerover",re=r==="mouseout"||r==="pointerout",ne&&c!==Vr&&(Le=c.relatedTarget||c.fromElement)&&(kr(Le)||Le[Ts]))break e;if((re||ne)&&(ne=ce.window===ce?ce:(ne=ce.ownerDocument)?ne.defaultView||ne.parentWindow:window,re?(Le=c.relatedTarget||c.toElement,re=Z,Le=Le?kr(Le):null,Le!==null&&(Tt=l(Le),De=Le.tag,Le!==Tt||De!==5&&De!==27&&De!==6)&&(Le=null)):(re=null,Le=Z),re!==Le)){if(De=As,de="onMouseLeave",Y="onMouseEnter",Q="mouse",(r==="pointerout"||r==="pointerover")&&(De=Qc,de="onPointerLeave",Y="onPointerEnter",Q="pointer"),Tt=re==null?ne:nr(re),J=Le==null?ne:nr(Le),ne=new De(de,Q+"leave",re,c,ce),ne.target=Tt,ne.relatedTarget=J,de=null,kr(ce)===Z&&(De=new De(Y,Q+"enter",Le,c,ce),De.target=J,De.relatedTarget=Tt,de=De),Tt=de,re&&Le)t:{for(De=re,Y=Le,Q=0,J=De;J;J=El(J))Q++;for(J=0,de=Y;de;de=El(de))J++;for(;0<Q-J;)De=El(De),Q--;for(;0<J-Q;)Y=El(Y),J--;for(;Q--;){if(De===Y||Y!==null&&De===Y.alternate)break t;De=El(De),Y=El(Y)}De=null}else De=null;re!==null&&u_(he,ne,re,De,!1),Le!==null&&Tt!==null&&u_(he,Tt,Le,De,!0)}}e:{if(ne=Z?nr(Z):window,re=ne.nodeName&&ne.nodeName.toLowerCase(),re==="select"||re==="input"&&ne.type==="file")var Ie=jv;else if(ln(ne))if(Cv)Ie=DI;else{Ie=RI;var Ye=CI}else re=ne.nodeName,!re||re.toLowerCase()!=="input"||ne.type!=="checkbox"&&ne.type!=="radio"?Z&&Fc(Z.elementType)&&(Ie=jv):Ie=kI;if(Ie&&(Ie=Ie(r,Z))){qr(he,Ie,c,ce);break e}Ye&&Ye(r,ne,Z),r==="focusout"&&Z&&ne.type==="number"&&Z.memoizedProps.value!=null&&_a(ne,"number",ne.value)}switch(Ye=Z?nr(Z):window,r){case"focusin":(ln(Ye)||Ye.contentEditable==="true")&&(el=Ye,rg=Z,Xc=null);break;case"focusout":Xc=rg=el=null;break;case"mousedown":ag=!0;break;case"contextmenu":case"mouseup":case"dragend":ag=!1,Lv(he,c,ce);break;case"selectionchange":if(MI)break;case"keydown":case"keyup":Lv(he,c,ce)}var Re;if(cr)e:{switch(r){case"compositionstart":var Me="onCompositionStart";break e;case"compositionend":Me="onCompositionEnd";break e;case"compositionupdate":Me="onCompositionUpdate";break e}Me=void 0}else st?ae(r,c)&&(Me="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Me="onCompositionStart");Me&&(_&&c.locale!=="ko"&&(st||Me!=="onCompositionStart"?Me==="onCompositionEnd"&&st&&(Re=Bc()):(ar=ce,wa="value"in ar?ar.value:ar.textContent,st=!0)),Ye=Qh(Z,Me),0<Ye.length&&(Me=new Hc(Me,r,null,c,ce),he.push({event:Me,listeners:Ye}),Re?Me.data=Re:(Re=ve(c),Re!==null&&(Me.data=Re)))),(Re=v?on(r,c):rt(r,c))&&(Me=Qh(Z,"onBeforeInput"),0<Me.length&&(Ye=new Hc("onBeforeInput","beforeinput",null,c,ce),he.push({event:Ye,listeners:Me}),Ye.data=Re)),yj(he,r,Z,c,ce)}l_(he,a)})}function Eu(r,a,c){return{instance:r,listener:a,currentTarget:c}}function Qh(r,a){for(var c=a+"Capture",d=[];r!==null;){var g=r,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=Mi(r,c),g!=null&&d.unshift(Eu(r,g,y)),g=Mi(r,a),g!=null&&d.push(Eu(r,g,y))),r.tag===3)return d;r=r.return}return[]}function El(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function u_(r,a,c,d,g){for(var y=a._reactName,E=[];c!==null&&c!==d;){var S=c,O=S.alternate,Z=S.stateNode;if(S=S.tag,O!==null&&O===d)break;S!==5&&S!==26&&S!==27||Z===null||(O=Z,g?(Z=Mi(c,y),Z!=null&&E.unshift(Eu(c,Z,O))):g||(Z=Mi(c,y),Z!=null&&E.push(Eu(c,Z,O)))),c=c.return}E.length!==0&&r.push({event:a,listeners:E})}var _j=/\r\n?/g,wj=/\u0000|\uFFFD/g;function d_(r){return(typeof r=="string"?r:""+r).replace(_j,`
`).replace(wj,"")}function h_(r,a){return a=d_(a),d_(r)===a}function Kh(){}function wt(r,a,c,d,g,y){switch(c){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||Es(r,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&Es(r,""+d);break;case"className":sr(r,"class",d);break;case"tabIndex":sr(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":sr(r,c,d);break;case"style":Uc(r,d,y);break;case"data":if(a!=="object"){sr(r,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||c!=="href")){r.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=Ho(""+d),r.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(a!=="input"&&wt(r,a,"name",g.name,g,null),wt(r,a,"formEncType",g.formEncType,g,null),wt(r,a,"formMethod",g.formMethod,g,null),wt(r,a,"formTarget",g.formTarget,g,null)):(wt(r,a,"encType",g.encType,g,null),wt(r,a,"method",g.method,g,null),wt(r,a,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=Ho(""+d),r.setAttribute(c,d);break;case"onClick":d!=null&&(r.onclick=Kh);break;case"onScroll":d!=null&&Ze("scroll",r);break;case"onScrollEnd":d!=null&&Ze("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}c=Ho(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""+d):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":d===!0?r.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,d):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(c,d):r.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(c):r.setAttribute(c,d);break;case"popover":Ze("beforetoggle",r),Ze("toggle",r),ba(r,"popover",d);break;case"xlinkActuate":Nn(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Nn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Nn(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Nn(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Nn(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Nn(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Nn(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Nn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Nn(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ba(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Wm.get(c)||c,ba(r,c,d))}}function Ip(r,a,c,d,g,y){switch(c){case"style":Uc(r,d,y);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"children":typeof d=="string"?Es(r,d):(typeof d=="number"||typeof d=="bigint")&&Es(r,""+d);break;case"onScroll":d!=null&&Ze("scroll",r);break;case"onScrollEnd":d!=null&&Ze("scrollend",r);break;case"onClick":d!=null&&(r.onclick=Kh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Fo.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),a=c.slice(2,g?c.length-7:void 0),y=r[Jt]||null,y=y!=null?y[c]:null,typeof y=="function"&&r.removeEventListener(a,y,g),typeof d=="function")){typeof y!="function"&&y!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(a,d,g);break e}c in r?r[c]=d:d===!0?r.setAttribute(c,""):ba(r,c,d)}}}function Cn(r,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ze("error",r),Ze("load",r);var d=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var E=c[y];if(E!=null)switch(y){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:wt(r,a,y,E,c,null)}}g&&wt(r,a,"srcSet",c.srcSet,c,null),d&&wt(r,a,"src",c.src,c,null);return;case"input":Ze("invalid",r);var S=y=E=g=null,O=null,Z=null;for(d in c)if(c.hasOwnProperty(d)){var ce=c[d];if(ce!=null)switch(d){case"name":g=ce;break;case"type":E=ce;break;case"checked":O=ce;break;case"defaultChecked":Z=ce;break;case"value":y=ce;break;case"defaultValue":S=ce;break;case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(n(137,a));break;default:wt(r,a,d,ce,c,null)}}ki(r,y,S,O,Z,E,g,!1),Go(r);return;case"select":Ze("invalid",r),d=E=y=null;for(g in c)if(c.hasOwnProperty(g)&&(S=c[g],S!=null))switch(g){case"value":y=S;break;case"defaultValue":E=S;break;case"multiple":d=S;default:wt(r,a,g,S,c,null)}a=y,c=E,r.multiple=!!d,a!=null?Mr(r,!!d,a,!1):c!=null&&Mr(r,!!d,c,!0);return;case"textarea":Ze("invalid",r),y=g=d=null;for(E in c)if(c.hasOwnProperty(E)&&(S=c[E],S!=null))switch(E){case"value":d=S;break;case"defaultValue":g=S;break;case"children":y=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:wt(r,a,E,S,c,null)}Di(r,d,g,y),Go(r);return;case"option":for(O in c)if(c.hasOwnProperty(O)&&(d=c[O],d!=null))switch(O){case"selected":r.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:wt(r,a,O,d,c,null)}return;case"dialog":Ze("beforetoggle",r),Ze("toggle",r),Ze("cancel",r),Ze("close",r);break;case"iframe":case"object":Ze("load",r);break;case"video":case"audio":for(d=0;d<Tu.length;d++)Ze(Tu[d],r);break;case"image":Ze("error",r),Ze("load",r);break;case"details":Ze("toggle",r);break;case"embed":case"source":case"link":Ze("error",r),Ze("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Z in c)if(c.hasOwnProperty(Z)&&(d=c[Z],d!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:wt(r,a,Z,d,c,null)}return;default:if(Fc(a)){for(ce in c)c.hasOwnProperty(ce)&&(d=c[ce],d!==void 0&&Ip(r,a,ce,d,c,void 0));return}}for(S in c)c.hasOwnProperty(S)&&(d=c[S],d!=null&&wt(r,a,S,d,c,null))}function Tj(r,a,c,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,E=null,S=null,O=null,Z=null,ce=null;for(re in c){var he=c[re];if(c.hasOwnProperty(re)&&he!=null)switch(re){case"checked":break;case"value":break;case"defaultValue":O=he;default:d.hasOwnProperty(re)||wt(r,a,re,null,d,he)}}for(var ne in d){var re=d[ne];if(he=c[ne],d.hasOwnProperty(ne)&&(re!=null||he!=null))switch(ne){case"type":y=re;break;case"name":g=re;break;case"checked":Z=re;break;case"defaultChecked":ce=re;break;case"value":E=re;break;case"defaultValue":S=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(n(137,a));break;default:re!==he&&wt(r,a,ne,re,d,he)}}ls(r,E,S,O,Z,ce,y,g);return;case"select":re=E=S=ne=null;for(y in c)if(O=c[y],c.hasOwnProperty(y)&&O!=null)switch(y){case"value":break;case"multiple":re=O;default:d.hasOwnProperty(y)||wt(r,a,y,null,d,O)}for(g in d)if(y=d[g],O=c[g],d.hasOwnProperty(g)&&(y!=null||O!=null))switch(g){case"value":ne=y;break;case"defaultValue":S=y;break;case"multiple":E=y;default:y!==O&&wt(r,a,g,y,d,O)}a=S,c=E,d=re,ne!=null?Mr(r,!!c,ne,!1):!!d!=!!c&&(a!=null?Mr(r,!!c,a,!0):Mr(r,!!c,c?[]:"",!1));return;case"textarea":re=ne=null;for(S in c)if(g=c[S],c.hasOwnProperty(S)&&g!=null&&!d.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:wt(r,a,S,null,d,g)}for(E in d)if(g=d[E],y=c[E],d.hasOwnProperty(E)&&(g!=null||y!=null))switch(E){case"value":ne=g;break;case"defaultValue":re=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(n(91));break;default:g!==y&&wt(r,a,E,g,d,y)}bt(r,ne,re);return;case"option":for(var Le in c)if(ne=c[Le],c.hasOwnProperty(Le)&&ne!=null&&!d.hasOwnProperty(Le))switch(Le){case"selected":r.selected=!1;break;default:wt(r,a,Le,null,d,ne)}for(O in d)if(ne=d[O],re=c[O],d.hasOwnProperty(O)&&ne!==re&&(ne!=null||re!=null))switch(O){case"selected":r.selected=ne&&typeof ne!="function"&&typeof ne!="symbol";break;default:wt(r,a,O,ne,d,re)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var De in c)ne=c[De],c.hasOwnProperty(De)&&ne!=null&&!d.hasOwnProperty(De)&&wt(r,a,De,null,d,ne);for(Z in d)if(ne=d[Z],re=c[Z],d.hasOwnProperty(Z)&&ne!==re&&(ne!=null||re!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(n(137,a));break;default:wt(r,a,Z,ne,d,re)}return;default:if(Fc(a)){for(var Tt in c)ne=c[Tt],c.hasOwnProperty(Tt)&&ne!==void 0&&!d.hasOwnProperty(Tt)&&Ip(r,a,Tt,void 0,d,ne);for(ce in d)ne=d[ce],re=c[ce],!d.hasOwnProperty(ce)||ne===re||ne===void 0&&re===void 0||Ip(r,a,ce,ne,d,re);return}}for(var Y in c)ne=c[Y],c.hasOwnProperty(Y)&&ne!=null&&!d.hasOwnProperty(Y)&&wt(r,a,Y,null,d,ne);for(he in d)ne=d[he],re=c[he],!d.hasOwnProperty(he)||ne===re||ne==null&&re==null||wt(r,a,he,ne,d,re)}var jp=null,Cp=null;function Yh(r){return r.nodeType===9?r:r.ownerDocument}function f_(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function m_(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function Rp(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var kp=null;function Ej(){var r=window.event;return r&&r.type==="popstate"?r===kp?!1:(kp=r,!0):(kp=null,!1)}var g_=typeof setTimeout=="function"?setTimeout:void 0,Sj=typeof clearTimeout=="function"?clearTimeout:void 0,p_=typeof Promise=="function"?Promise:void 0,Nj=typeof queueMicrotask=="function"?queueMicrotask:typeof p_<"u"?function(r){return p_.resolve(null).then(r).catch(Aj)}:g_;function Aj(r){setTimeout(function(){throw r})}function La(r){return r==="head"}function y_(r,a){var c=a,d=0,g=0;do{var y=c.nextSibling;if(r.removeChild(c),y&&y.nodeType===8)if(c=y.data,c==="/$"){if(0<d&&8>d){c=d;var E=r.ownerDocument;if(c&1&&Su(E.documentElement),c&2&&Su(E.body),c&4)for(c=E.head,Su(c),E=c.firstChild;E;){var S=E.nextSibling,O=E.nodeName;E[Ii]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=S}}if(g===0){r.removeChild(y),Du(a);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:d=c.charCodeAt(0)-48;else d=0;c=y}while(c);Du(a)}function Dp(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Dp(c),va(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function Ij(r,a,c,d){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[Ii])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(y=r.getAttribute("rel"),y==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(y!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(y=r.getAttribute("src"),(y!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===y)return r}else return r;if(r=Gs(r.nextSibling),r===null)break}return null}function jj(r,a,c){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=Gs(r.nextSibling),r===null))return null;return r}function Pp(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function Cj(r,a){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")a();else{var d=function(){a(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function Gs(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return r}var Mp=null;function x_(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(a===0)return r;a--}else c==="/$"&&a++}r=r.previousSibling}return null}function v_(r,a,c){switch(a=Yh(c),r){case"html":if(r=a.documentElement,!r)throw Error(n(452));return r;case"head":if(r=a.head,!r)throw Error(n(453));return r;case"body":if(r=a.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function Su(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);va(r)}var Ps=new Map,b_=new Set;function Xh(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var ea=ie.d;ie.d={f:Rj,r:kj,D:Dj,C:Pj,L:Mj,m:Vj,X:Lj,S:Oj,M:Uj};function Rj(){var r=ea.f(),a=qh();return r||a}function kj(r){var a=tr(r);a!==null&&a.tag===5&&a.type==="form"?Fb(a):ea.r(r)}var Sl=typeof document>"u"?null:document;function __(r,a,c){var d=Sl;if(d&&typeof a=="string"&&a){var g=Zt(a);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),b_.has(g)||(b_.add(g),r={rel:r,crossOrigin:c,href:a},d.querySelector(g)===null&&(a=d.createElement("link"),Cn(a,"link",r),$t(a),d.head.appendChild(a)))}}function Dj(r){ea.D(r),__("dns-prefetch",r,null)}function Pj(r,a){ea.C(r,a),__("preconnect",r,a)}function Mj(r,a,c){ea.L(r,a,c);var d=Sl;if(d&&r&&a){var g='link[rel="preload"][as="'+Zt(a)+'"]';a==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+Zt(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+Zt(c.imageSizes)+'"]')):g+='[href="'+Zt(r)+'"]';var y=g;switch(a){case"style":y=Nl(r);break;case"script":y=Al(r)}Ps.has(y)||(r=x({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:r,as:a},c),Ps.set(y,r),d.querySelector(g)!==null||a==="style"&&d.querySelector(Nu(y))||a==="script"&&d.querySelector(Au(y))||(a=d.createElement("link"),Cn(a,"link",r),$t(a),d.head.appendChild(a)))}}function Vj(r,a){ea.m(r,a);var c=Sl;if(c&&r){var d=a&&typeof a.as=="string"?a.as:"script",g='link[rel="modulepreload"][as="'+Zt(d)+'"][href="'+Zt(r)+'"]',y=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Al(r)}if(!Ps.has(y)&&(r=x({rel:"modulepreload",href:r},a),Ps.set(y,r),c.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Au(y)))return}d=c.createElement("link"),Cn(d,"link",r),$t(d),c.head.appendChild(d)}}}function Oj(r,a,c){ea.S(r,a,c);var d=Sl;if(d&&r){var g=Bn(d).hoistableStyles,y=Nl(r);a=a||"default";var E=g.get(y);if(!E){var S={loading:0,preload:null};if(E=d.querySelector(Nu(y)))S.loading=5;else{r=x({rel:"stylesheet",href:r,"data-precedence":a},c),(c=Ps.get(y))&&Vp(r,c);var O=E=d.createElement("link");$t(O),Cn(O,"link",r),O._p=new Promise(function(Z,ce){O.onload=Z,O.onerror=ce}),O.addEventListener("load",function(){S.loading|=1}),O.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Wh(E,a,d)}E={type:"stylesheet",instance:E,count:1,state:S},g.set(y,E)}}}function Lj(r,a){ea.X(r,a);var c=Sl;if(c&&r){var d=Bn(c).hoistableScripts,g=Al(r),y=d.get(g);y||(y=c.querySelector(Au(g)),y||(r=x({src:r,async:!0},a),(a=Ps.get(g))&&Op(r,a),y=c.createElement("script"),$t(y),Cn(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function Uj(r,a){ea.M(r,a);var c=Sl;if(c&&r){var d=Bn(c).hoistableScripts,g=Al(r),y=d.get(g);y||(y=c.querySelector(Au(g)),y||(r=x({src:r,async:!0,type:"module"},a),(a=Ps.get(g))&&Op(r,a),y=c.createElement("script"),$t(y),Cn(y,"link",r),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},d.set(g,y))}}function w_(r,a,c,d){var g=(g=Ee.current)?Xh(g):null;if(!g)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Nl(c.href),c=Bn(g).hoistableStyles,d=c.get(a),d||(d={type:"style",instance:null,count:0,state:null},c.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=Nl(c.href);var y=Bn(g).hoistableStyles,E=y.get(r);if(E||(g=g.ownerDocument||g,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(r,E),(y=g.querySelector(Nu(r)))&&!y._p&&(E.instance=y,E.state.loading=5),Ps.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ps.set(r,c),y||Fj(g,r,c,E.state))),a&&d===null)throw Error(n(528,""));return E}if(a&&d!==null)throw Error(n(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Al(c),c=Bn(g).hoistableScripts,d=c.get(a),d||(d={type:"script",instance:null,count:0,state:null},c.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function Nl(r){return'href="'+Zt(r)+'"'}function Nu(r){return'link[rel="stylesheet"]['+r+"]"}function T_(r){return x({},r,{"data-precedence":r.precedence,precedence:null})}function Fj(r,a,c,d){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=r.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),Cn(a,"link",c),$t(a),r.head.appendChild(a))}function Al(r){return'[src="'+Zt(r)+'"]'}function Au(r){return"script[async]"+r}function E_(r,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var d=r.querySelector('style[data-href~="'+Zt(c.href)+'"]');if(d)return a.instance=d,$t(d),d;var g=x({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),$t(d),Cn(d,"style",g),Wh(d,c.precedence,r),a.instance=d;case"stylesheet":g=Nl(c.href);var y=r.querySelector(Nu(g));if(y)return a.state.loading|=4,a.instance=y,$t(y),y;d=T_(c),(g=Ps.get(g))&&Vp(d,g),y=(r.ownerDocument||r).createElement("link"),$t(y);var E=y;return E._p=new Promise(function(S,O){E.onload=S,E.onerror=O}),Cn(y,"link",d),a.state.loading|=4,Wh(y,c.precedence,r),a.instance=y;case"script":return y=Al(c.src),(g=r.querySelector(Au(y)))?(a.instance=g,$t(g),g):(d=c,(g=Ps.get(y))&&(d=x({},c),Op(d,g)),r=r.ownerDocument||r,g=r.createElement("script"),$t(g),Cn(g,"link",d),r.head.appendChild(g),a.instance=g);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,Wh(d,c.precedence,r));return a.instance}function Wh(r,a,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,y=g,E=0;E<d.length;E++){var S=d[E];if(S.dataset.precedence===a)y=S;else if(y!==g)break}y?y.parentNode.insertBefore(r,y.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(r,a.firstChild))}function Vp(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Op(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Jh=null;function S_(r,a,c){if(Jh===null){var d=new Map,g=Jh=new Map;g.set(c,d)}else g=Jh,d=g.get(c),d||(d=new Map,g.set(c,d));if(d.has(r))return d;for(d.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var y=c[g];if(!(y[Ii]||y[an]||r==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var E=y.getAttribute(a)||"";E=r+E;var S=d.get(E);S?S.push(y):d.set(E,[y])}}return d}function N_(r,a,c){r=r.ownerDocument||r,r.head.insertBefore(c,a==="title"?r.querySelector("head > title"):null)}function qj(r,a,c){if(c===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function A_(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var Iu=null;function Bj(){}function zj(r,a,c){if(Iu===null)throw Error(n(475));var d=Iu;if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var g=Nl(c.href),y=r.querySelector(Nu(g));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(d.count++,d=Zh.bind(d),r.then(d,d)),a.state.loading|=4,a.instance=y,$t(y);return}y=r.ownerDocument||r,c=T_(c),(g=Ps.get(g))&&Vp(c,g),y=y.createElement("link"),$t(y);var E=y;E._p=new Promise(function(S,O){E.onload=S,E.onerror=O}),Cn(y,"link",c),a.instance=y}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(d.count++,a=Zh.bind(d),r.addEventListener("load",a),r.addEventListener("error",a))}}function Gj(){if(Iu===null)throw Error(n(475));var r=Iu;return r.stylesheets&&r.count===0&&Lp(r,r.stylesheets),0<r.count?function(a){var c=setTimeout(function(){if(r.stylesheets&&Lp(r,r.stylesheets),r.unsuspend){var d=r.unsuspend;r.unsuspend=null,d()}},6e4);return r.unsuspend=a,function(){r.unsuspend=null,clearTimeout(c)}}:null}function Zh(){if(this.count--,this.count===0){if(this.stylesheets)Lp(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var ef=null;function Lp(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,ef=new Map,a.forEach(Hj,r),ef=null,Zh.call(r))}function Hj(r,a){if(!(a.state.loading&4)){var c=ef.get(r);if(c)var d=c.get(null);else{c=new Map,ef.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var E=g[y];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(c.set(E.dataset.precedence,E),d=E)}d&&c.set(null,d)}g=a.instance,E=g.getAttribute("data-precedence"),y=c.get(E)||d,y===d&&c.set(null,g),c.set(E,g),this.count++,d=Zh.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),y?y.parentNode.insertBefore(g,y.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),a.state.loading|=4}}var ju={$$typeof:L,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function $j(r,a,c,d,g,y,E,S){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Cr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cr(0),this.hiddenUpdates=Cr(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function I_(r,a,c,d,g,y,E,S,O,Z,ce,he){return r=new $j(r,a,c,E,S,O,Z,he),a=1,y===!0&&(a|=24),y=us(3,null,null,a),r.current=y,y.stateNode=r,a=vg(),a.refCount++,r.pooledCache=a,a.refCount++,y.memoizedState={element:d,isDehydrated:c,cache:a},Tg(y),r}function j_(r){return r?(r=rl,r):rl}function C_(r,a,c,d,g,y){g=j_(g),d.context===null?d.context=g:d.pendingContext=g,d=Sa(a),d.payload={element:c},y=y===void 0?null:y,y!==null&&(d.callback=y),c=Na(r,d,a),c!==null&&(gs(c,r,a),au(c,r,a))}function R_(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<a?c:a}}function Up(r,a){R_(r,a),(r=r.alternate)&&R_(r,a)}function k_(r){if(r.tag===13){var a=sl(r,67108864);a!==null&&gs(a,r,67108864),Up(r,67108864)}}var tf=!0;function Qj(r,a,c,d){var g=F.T;F.T=null;var y=ie.p;try{ie.p=2,Fp(r,a,c,d)}finally{ie.p=y,F.T=g}}function Kj(r,a,c,d){var g=F.T;F.T=null;var y=ie.p;try{ie.p=8,Fp(r,a,c,d)}finally{ie.p=y,F.T=g}}function Fp(r,a,c,d){if(tf){var g=qp(d);if(g===null)Ap(r,a,d,nf,c),P_(r,d);else if(Xj(g,r,a,c,d))d.stopPropagation();else if(P_(r,d),a&4&&-1<Yj.indexOf(r)){for(;g!==null;){var y=tr(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var E=Us(y.pendingLanes);if(E!==0){var S=y;for(S.pendingLanes|=2,S.entangledLanes|=2;E;){var O=1<<31-Dn(E);S.entanglements[1]|=O,E&=~O}gr(y),(mt&6)===0&&(Uh=St()+500,wu(0))}}break;case 13:S=sl(y,2),S!==null&&gs(S,y,2),qh(),Up(y,2)}if(y=qp(d),y===null&&Ap(r,a,d,nf,c),y===g)break;g=y}g!==null&&d.stopPropagation()}else Ap(r,a,d,null,c)}}function qp(r){return r=Ss(r),Bp(r)}var nf=null;function Bp(r){if(nf=null,r=kr(r),r!==null){var a=l(r);if(a===null)r=null;else{var c=a.tag;if(c===13){if(r=u(a),r!==null)return r;r=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return nf=r,null}function D_(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Lt()){case ws:return 2;case gn:return 8;case $n:case Ir:return 32;case jr:return 268435456;default:return 32}default:return 32}}var zp=!1,Ua=null,Fa=null,qa=null,Cu=new Map,Ru=new Map,Ba=[],Yj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function P_(r,a){switch(r){case"focusin":case"focusout":Ua=null;break;case"dragenter":case"dragleave":Fa=null;break;case"mouseover":case"mouseout":qa=null;break;case"pointerover":case"pointerout":Cu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ru.delete(a.pointerId)}}function ku(r,a,c,d,g,y){return r===null||r.nativeEvent!==y?(r={blockedOn:a,domEventName:c,eventSystemFlags:d,nativeEvent:y,targetContainers:[g]},a!==null&&(a=tr(a),a!==null&&k_(a)),r):(r.eventSystemFlags|=d,a=r.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),r)}function Xj(r,a,c,d,g){switch(a){case"focusin":return Ua=ku(Ua,r,a,c,d,g),!0;case"dragenter":return Fa=ku(Fa,r,a,c,d,g),!0;case"mouseover":return qa=ku(qa,r,a,c,d,g),!0;case"pointerover":var y=g.pointerId;return Cu.set(y,ku(Cu.get(y)||null,r,a,c,d,g)),!0;case"gotpointercapture":return y=g.pointerId,Ru.set(y,ku(Ru.get(y)||null,r,a,c,d,g)),!0}return!1}function M_(r){var a=kr(r.target);if(a!==null){var c=l(a);if(c!==null){if(a=c.tag,a===13){if(a=u(c),a!==null){r.blockedOn=a,qd(r.priority,function(){if(c.tag===13){var d=ms();d=pa(d);var g=sl(c,d);g!==null&&gs(g,c,d),Up(c,d)}});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function sf(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var c=qp(r.nativeEvent);if(c===null){c=r.nativeEvent;var d=new c.constructor(c.type,c);Vr=d,c.target.dispatchEvent(d),Vr=null}else return a=tr(c),a!==null&&k_(a),r.blockedOn=c,!1;a.shift()}return!0}function V_(r,a,c){sf(r)&&c.delete(a)}function Wj(){zp=!1,Ua!==null&&sf(Ua)&&(Ua=null),Fa!==null&&sf(Fa)&&(Fa=null),qa!==null&&sf(qa)&&(qa=null),Cu.forEach(V_),Ru.forEach(V_)}function rf(r,a){r.blockedOn===a&&(r.blockedOn=null,zp||(zp=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Wj)))}var af=null;function O_(r){af!==r&&(af=r,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){af===r&&(af=null);for(var a=0;a<r.length;a+=3){var c=r[a],d=r[a+1],g=r[a+2];if(typeof d!="function"){if(Bp(d||c)===null)continue;break}var y=tr(c);y!==null&&(r.splice(a,3),a-=3,Bg(y,{pending:!0,data:g,method:c.method,action:d},d,g))}}))}function Du(r){function a(O){return rf(O,r)}Ua!==null&&rf(Ua,r),Fa!==null&&rf(Fa,r),qa!==null&&rf(qa,r),Cu.forEach(a),Ru.forEach(a);for(var c=0;c<Ba.length;c++){var d=Ba[c];d.blockedOn===r&&(d.blockedOn=null)}for(;0<Ba.length&&(c=Ba[0],c.blockedOn===null);)M_(c),c.blockedOn===null&&Ba.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var g=c[d],y=c[d+1],E=g[Jt]||null;if(typeof y=="function")E||O_(c);else if(E){var S=null;if(y&&y.hasAttribute("formAction")){if(g=y,E=y[Jt]||null)S=E.formAction;else if(Bp(g)!==null)continue}else S=E.action;typeof S=="function"?c[d+1]=S:(c.splice(d,3),d-=3),O_(c)}}}function Gp(r){this._internalRoot=r}of.prototype.render=Gp.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(n(409));var c=a.current,d=ms();C_(c,d,r,a,null,null)},of.prototype.unmount=Gp.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;C_(r.current,2,null,r,null,null),qh(),a[Ts]=null}};function of(r){this._internalRoot=r}of.prototype.unstable_scheduleHydration=function(r){if(r){var a=ya();r={blockedOn:null,target:r,priority:a};for(var c=0;c<Ba.length&&a!==0&&a<Ba[c].priority;c++);Ba.splice(c,0,r),c===0&&M_(r)}};var L_=e.version;if(L_!=="19.1.1")throw Error(n(527,L_,"19.1.1"));ie.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=m(a),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var Jj={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lf.isDisabled&&lf.supportsFiber)try{qt=lf.inject(Jj),ft=lf}catch{}}return Mu.createRoot=function(r,a){if(!i(r))throw Error(n(299));var c=!1,d="",g=e0,y=t0,E=n0,S=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(y=a.onCaughtError),a.onRecoverableError!==void 0&&(E=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(S=a.unstable_transitionCallbacks)),a=I_(r,1,!1,null,null,c,d,g,y,E,S,null),r[Ts]=a.current,Np(r),new Gp(a)},Mu.hydrateRoot=function(r,a,c){if(!i(r))throw Error(n(299));var d=!1,g="",y=e0,E=t0,S=n0,O=null,Z=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(E=c.onCaughtError),c.onRecoverableError!==void 0&&(S=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(O=c.unstable_transitionCallbacks),c.formState!==void 0&&(Z=c.formState)),a=I_(r,1,!0,a,c??null,d,g,y,E,S,O,Z),a.context=j_(null),c=a.current,d=ms(),d=pa(d),g=Sa(d),g.callback=null,Na(c,g,d),c=d,a.current.lanes=c,Rr(a,c),gr(a),r[Ts]=a.current,Np(r),new of(a)},Mu.version="19.1.1",Mu}var K_;function l1(){if(K_)return Qp.exports;K_=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),Qp.exports=o1(),Qp.exports}var c1=l1();const u1=()=>{};var Y_={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uE=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let i=s.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},d1=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const i=s[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const l=s[t++];e[n++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){const l=s[t++],u=s[t++],h=s[t++],m=((i&7)<<18|(l&63)<<12|(u&63)<<6|h&63)-65536;e[n++]=String.fromCharCode(55296+(m>>10)),e[n++]=String.fromCharCode(56320+(m&1023))}else{const l=s[t++],u=s[t++];e[n++]=String.fromCharCode((i&15)<<12|(l&63)<<6|u&63)}}return e.join("")},dE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<s.length;i+=3){const l=s[i],u=i+1<s.length,h=u?s[i+1]:0,m=i+2<s.length,p=m?s[i+2]:0,x=l>>2,b=(l&3)<<4|h>>4;let w=(h&15)<<2|p>>6,N=p&63;m||(N=64,u||(w=64)),n.push(t[x],t[b],t[w],t[N])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(uE(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):d1(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<s.length;){const l=t[s.charAt(i++)],h=i<s.length?t[s.charAt(i)]:0;++i;const p=i<s.length?t[s.charAt(i)]:64;++i;const b=i<s.length?t[s.charAt(i)]:64;if(++i,l==null||h==null||p==null||b==null)throw new h1;const w=l<<2|h>>4;if(n.push(w),p!==64){const N=h<<4&240|p>>2;if(n.push(N),b!==64){const V=p<<6&192|b;n.push(V)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class h1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const f1=function(s){const e=uE(s);return dE.encodeByteArray(e,!0)},Of=function(s){return f1(s).replace(/\./g,"")},hE=function(s){try{return dE.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m1=()=>fE().__FIREBASE_DEFAULTS__,g1=()=>{if(typeof process>"u"||typeof Y_>"u")return;const s=Y_.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},p1=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&hE(s[1]);return e&&JSON.parse(e)},um=()=>{try{return u1()||m1()||g1()||p1()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},mE=s=>um()?.emulatorHosts?.[s],gE=s=>{const e=mE(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},pE=()=>um()?.config,yE=s=>um()?.[`_${s}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mi(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}async function dm(s){return(await fetch(s,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x1(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=s.iat||0,l=s.sub||s.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...s};return[Of(JSON.stringify(t)),Of(JSON.stringify(u)),""].join(".")}const $u={};function v1(){const s={prod:[],emulator:[]};for(const e of Object.keys($u))$u[e]?s.emulator.push(e):s.prod.push(e);return s}function b1(s){let e=document.getElementById(s),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",s),t=!0),{created:t,element:e}}let X_=!1;function rx(s,e){if(typeof window>"u"||typeof document>"u"||!mi(window.location.host)||$u[s]===e||$u[s]||X_)return;$u[s]=e;function t(w){return`__firebase__banner__${w}`}const n="__firebase__banner",l=v1().prod.length>0;function u(){const w=document.getElementById(n);w&&w.remove()}function h(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function m(w,N){w.setAttribute("width","24"),w.setAttribute("id",N),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function p(){const w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{X_=!0,u()},w}function x(w,N){w.setAttribute("id",N),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function b(){const w=b1(n),N=t("text"),V=document.getElementById(N)||document.createElement("span"),D=t("learnmore"),q=document.getElementById(D)||document.createElement("a"),z=t("preprendIcon"),B=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){const L=w.element;h(L),x(q,D);const G=p();m(B,z),L.append(B,V,q,G),document.body.appendChild(L)}l?(V.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,V.innerText="Preview backend running in this workspace."),V.setAttribute("id",N)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(hn())}function xE(){const s=um()?.forceEnvironment;if(s==="node")return!0;if(s==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function w1(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function vE(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function T1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function E1(){const s=hn();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function bE(){return!xE()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _E(){return!xE()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ax(){try{return typeof indexedDB=="object"}catch{return!1}}function wE(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}function S1(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N1="FirebaseError";class Zs extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=N1,Object.setPrototypeOf(this,Zs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ro.prototype.create)}}class Ro{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,l=this.errors[e],u=l?A1(l,n):"Error",h=`${this.serviceName}: ${u} (${i}).`;return new Zs(i,h,n)}}function A1(s,e){return s.replace(I1,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const I1=/\{\$([^}]+)}/g;function j1(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function Os(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const l=s[i],u=e[i];if(W_(l)&&W_(u)){if(!Os(l,u))return!1}else if(l!==u)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function W_(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function C1(s,e){const t=new R1(s,e);return t.subscribe.bind(t)}class R1{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");k1(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=Wp),i.error===void 0&&(i.error=Wp),i.complete===void 0&&(i.complete=Wp);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function k1(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function Wp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D1=1e3,P1=2,M1=14400*1e3,V1=.5;function J_(s,e=D1,t=P1){const n=e*Math.pow(t,s),i=Math.round(V1*n*(Math.random()-.5)*2);return Math.min(M1,n+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(s){return s&&s._delegate?s._delegate:s}class Ls{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ro="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new y1;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(U1(e))try{this.getOrInitializeService({instanceIdentifier:ro})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:i});n.resolve(l)}catch{}}}}clearInstance(e=ro){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ro){return this.instances.has(e)}getOptions(e=ro){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[l,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(l);n===h&&u.resolve(i)}return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const l=this.instances.get(n);return l&&e(l,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:L1(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ro){return this.component?this.component.multipleInstances?e:ro:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function L1(s){return s===ro?void 0:s}function U1(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new O1(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var et;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(et||(et={}));const q1={debug:et.DEBUG,verbose:et.VERBOSE,info:et.INFO,warn:et.WARN,error:et.ERROR,silent:et.SILENT},B1=et.INFO,z1={[et.DEBUG]:"log",[et.VERBOSE]:"log",[et.INFO]:"info",[et.WARN]:"warn",[et.ERROR]:"error"},G1=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),i=z1[e];if(i)console[i](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class hm{constructor(e){this.name=e,this._logLevel=B1,this._logHandler=G1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in et))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?q1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,et.DEBUG,...e),this._logHandler(this,et.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,et.VERBOSE,...e),this._logHandler(this,et.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,et.INFO,...e),this._logHandler(this,et.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,et.WARN,...e),this._logHandler(this,et.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,et.ERROR,...e),this._logHandler(this,et.ERROR,...e)}}const H1=(s,e)=>e.some(t=>s instanceof t);let Z_,ew;function $1(){return Z_||(Z_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Q1(){return ew||(ew=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const TE=new WeakMap,yy=new WeakMap,EE=new WeakMap,Jp=new WeakMap,ix=new WeakMap;function K1(s){const e=new Promise((t,n)=>{const i=()=>{s.removeEventListener("success",l),s.removeEventListener("error",u)},l=()=>{t(ti(s.result)),i()},u=()=>{n(s.error),i()};s.addEventListener("success",l),s.addEventListener("error",u)});return e.then(t=>{t instanceof IDBCursor&&TE.set(t,s)}).catch(()=>{}),ix.set(e,s),e}function Y1(s){if(yy.has(s))return;const e=new Promise((t,n)=>{const i=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",u),s.removeEventListener("abort",u)},l=()=>{t(),i()},u=()=>{n(s.error||new DOMException("AbortError","AbortError")),i()};s.addEventListener("complete",l),s.addEventListener("error",u),s.addEventListener("abort",u)});yy.set(s,e)}let xy={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return yy.get(s);if(e==="objectStoreNames")return s.objectStoreNames||EE.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ti(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function X1(s){xy=s(xy)}function W1(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(Zp(this),e,...t);return EE.set(n,e.sort?e.sort():[e]),ti(n)}:Q1().includes(s)?function(...e){return s.apply(Zp(this),e),ti(TE.get(this))}:function(...e){return ti(s.apply(Zp(this),e))}}function J1(s){return typeof s=="function"?W1(s):(s instanceof IDBTransaction&&Y1(s),H1(s,$1())?new Proxy(s,xy):s)}function ti(s){if(s instanceof IDBRequest)return K1(s);if(Jp.has(s))return Jp.get(s);const e=J1(s);return e!==s&&(Jp.set(s,e),ix.set(e,s)),e}const Zp=s=>ix.get(s);function SE(s,e,{blocked:t,upgrade:n,blocking:i,terminated:l}={}){const u=indexedDB.open(s,e),h=ti(u);return n&&u.addEventListener("upgradeneeded",m=>{n(ti(u.result),m.oldVersion,m.newVersion,ti(u.transaction),m)}),t&&u.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),h.then(m=>{l&&m.addEventListener("close",()=>l()),i&&m.addEventListener("versionchange",p=>i(p.oldVersion,p.newVersion,p))}).catch(()=>{}),h}const Z1=["get","getKey","getAll","getAllKeys","count"],eC=["put","add","delete","clear"],ey=new Map;function tw(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(ey.get(e))return ey.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=eC.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Z1.includes(t)))return;const l=async function(u,...h){const m=this.transaction(u,i?"readwrite":"readonly");let p=m.store;return n&&(p=p.index(h.shift())),(await Promise.all([p[t](...h),i&&m.done]))[0]};return ey.set(e,l),l}X1(s=>({...s,get:(e,t,n)=>tw(e,t)||s.get(e,t,n),has:(e,t)=>!!tw(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(nC(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function nC(s){return s.getComponent()?.type==="VERSION"}const vy="@firebase/app",nw="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const la=new hm("@firebase/app"),sC="@firebase/app-compat",rC="@firebase/analytics-compat",aC="@firebase/analytics",iC="@firebase/app-check-compat",oC="@firebase/app-check",lC="@firebase/auth",cC="@firebase/auth-compat",uC="@firebase/database",dC="@firebase/data-connect",hC="@firebase/database-compat",fC="@firebase/functions",mC="@firebase/functions-compat",gC="@firebase/installations",pC="@firebase/installations-compat",yC="@firebase/messaging",xC="@firebase/messaging-compat",vC="@firebase/performance",bC="@firebase/performance-compat",_C="@firebase/remote-config",wC="@firebase/remote-config-compat",TC="@firebase/storage",EC="@firebase/storage-compat",SC="@firebase/firestore",NC="@firebase/ai",AC="@firebase/firestore-compat",IC="firebase",jC="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="[DEFAULT]",CC={[vy]:"fire-core",[sC]:"fire-core-compat",[aC]:"fire-analytics",[rC]:"fire-analytics-compat",[oC]:"fire-app-check",[iC]:"fire-app-check-compat",[lC]:"fire-auth",[cC]:"fire-auth-compat",[uC]:"fire-rtdb",[dC]:"fire-data-connect",[hC]:"fire-rtdb-compat",[fC]:"fire-fn",[mC]:"fire-fn-compat",[gC]:"fire-iid",[pC]:"fire-iid-compat",[yC]:"fire-fcm",[xC]:"fire-fcm-compat",[vC]:"fire-perf",[bC]:"fire-perf-compat",[_C]:"fire-rc",[wC]:"fire-rc-compat",[TC]:"fire-gcs",[EC]:"fire-gcs-compat",[SC]:"fire-fst",[AC]:"fire-fst-compat",[NC]:"fire-vertex","fire-js":"fire-js",[IC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uf=new Map,RC=new Map,by=new Map;function sw(s,e){try{s.container.addComponent(e)}catch(t){la.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Js(s){const e=s.name;if(by.has(e))return la.debug(`There were multiple attempts to register component ${e}.`),!1;by.set(e,s);for(const t of Uf.values())sw(t,s);for(const t of RC.values())sw(t,s);return!0}function Ar(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function kC(s,e,t=Lf){Ar(s,e).clearInstance(t)}function xs(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ni=new Ro("app","Firebase",DC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ls("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ni.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc=jC;function NE(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n={name:Lf,automaticDataCollectionEnabled:!0,...e},i=n.name;if(typeof i!="string"||!i)throw ni.create("bad-app-name",{appName:String(i)});if(t||(t=pE()),!t)throw ni.create("no-options");const l=Uf.get(i);if(l){if(Os(t,l.options)&&Os(n,l.config))return l;throw ni.create("duplicate-app",{appName:i})}const u=new F1(i);for(const m of by.values())u.addComponent(m);const h=new PC(t,n,u);return Uf.set(i,h),h}function fm(s=Lf){const e=Uf.get(s);if(!e&&s===Lf&&pE())return NE();if(!e)throw ni.create("no-app",{appName:s});return e}function ss(s,e,t){let n=CC[s]??s;t&&(n+=`-${t}`);const i=n.match(/\s|\//),l=e.match(/\s|\//);if(i||l){const u=[`Unable to register library "${n}" with version "${e}":`];i&&u.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&l&&u.push("and"),l&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),la.warn(u.join(" "));return}Js(new Ls(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC="firebase-heartbeat-database",VC=1,ad="firebase-heartbeat-store";let ty=null;function AE(){return ty||(ty=SE(MC,VC,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(ad)}catch(t){console.warn(t)}}}}).catch(s=>{throw ni.create("idb-open",{originalErrorMessage:s.message})})),ty}async function OC(s){try{const t=(await AE()).transaction(ad),n=await t.objectStore(ad).get(IE(s));return await t.done,n}catch(e){if(e instanceof Zs)la.warn(e.message);else{const t=ni.create("idb-get",{originalErrorMessage:e?.message});la.warn(t.message)}}}async function rw(s,e){try{const n=(await AE()).transaction(ad,"readwrite");await n.objectStore(ad).put(e,IE(s)),await n.done}catch(t){if(t instanceof Zs)la.warn(t.message);else{const n=ni.create("idb-set",{originalErrorMessage:t?.message});la.warn(n.message)}}}function IE(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC=1024,UC=30;class FC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new BC(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=aw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(i=>i.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>UC){const i=zC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){la.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=aw(),{heartbeatsToSend:t,unsentEntries:n}=qC(this._heartbeatsCache.heartbeats),i=Of(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return la.warn(e),""}}}function aw(){return new Date().toISOString().substring(0,10)}function qC(s,e=LC){const t=[];let n=s.slice();for(const i of s){const l=t.find(u=>u.agent===i.agent);if(l){if(l.dates.push(i.date),iw(t)>e){l.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),iw(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class BC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ax()?wE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await OC(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return rw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return rw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function iw(s){return Of(JSON.stringify({version:2,heartbeats:s})).length}function zC(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GC(s){Js(new Ls("platform-logger",e=>new tC(e),"PRIVATE")),Js(new Ls("heartbeat",e=>new FC(e),"PRIVATE")),ss(vy,nw,s),ss(vy,nw,"esm2020"),ss("fire-js","")}GC("");function jE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const HC=jE,CE=new Ro("auth","Firebase",jE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ff=new hm("@firebase/auth");function $C(s,...e){Ff.logLevel<=et.WARN&&Ff.warn(`Auth (${gc}): ${s}`,...e)}function bf(s,...e){Ff.logLevel<=et.ERROR&&Ff.error(`Auth (${gc}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(s,...e){throw lx(s,...e)}function Ys(s,...e){return lx(s,...e)}function ox(s,e,t){const n={...HC(),[e]:t};return new Ro("auth","Firebase",n).create(e,{appName:s.name})}function si(s){return ox(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function RE(s,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&Sr(s,"argument-error"),ox(s,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lx(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return CE.create(s,...e)}function Ue(s,e,...t){if(!s)throw lx(e,...t)}function sa(s){const e="INTERNAL ASSERTION FAILED: "+s;throw bf(e),new Error(e)}function ca(s,e){s||sa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(){return typeof self<"u"&&self.location?.href||""}function QC(){return ow()==="http:"||ow()==="https:"}function ow(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(QC()||vE()||"connection"in navigator)?navigator.onLine:!0}function YC(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e,t){this.shortDelay=e,this.longDelay=t,ca(t>e,"Short delay should be less than long delay!"),this.isMobile=_1()||T1()}get(){return KC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cx(s,e){ca(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;sa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;sa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;sa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WC=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],JC=new _d(3e4,6e4);function ux(s,e){return s.tenantId&&!e.tenantId?{...e,tenantId:s.tenantId}:e}async function pc(s,e,t,n,i={}){return DE(s,i,async()=>{let l={},u={};n&&(e==="GET"?u=n:l={body:JSON.stringify(n)});const h=bd({key:s.config.apiKey,...u}).slice(1),m=await s._getAdditionalHeaders();m["Content-Type"]="application/json",s.languageCode&&(m["X-Firebase-Locale"]=s.languageCode);const p={method:e,headers:m,...l};return w1()||(p.referrerPolicy="no-referrer"),s.emulatorConfig&&mi(s.emulatorConfig.host)&&(p.credentials="include"),kE.fetch()(await PE(s,s.config.apiHost,t,h),p)})}async function DE(s,e,t){s._canInitEmulator=!1;const n={...XC,...e};try{const i=new eR(s),l=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw cf(s,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const h=l.ok?u.errorMessage:u.error.message,[m,p]=h.split(" : ");if(m==="FEDERATED_USER_ID_ALREADY_LINKED")throw cf(s,"credential-already-in-use",u);if(m==="EMAIL_EXISTS")throw cf(s,"email-already-in-use",u);if(m==="USER_DISABLED")throw cf(s,"user-disabled",u);const x=n[m]||m.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw ox(s,x,p);Sr(s,x)}}catch(i){if(i instanceof Zs)throw i;Sr(s,"network-request-failed",{message:String(i)})}}async function ZC(s,e,t,n,i={}){const l=await pc(s,e,t,n,i);return"mfaPendingCredential"in l&&Sr(s,"multi-factor-auth-required",{_serverResponse:l}),l}async function PE(s,e,t,n){const i=`${e}${t}?${n}`,l=s,u=l.config.emulator?cx(s.config,i):`${s.config.apiScheme}://${i}`;return WC.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}class eR{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Ys(this.auth,"network-request-failed")),JC.get())})}}function cf(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=Ys(s,e,n);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR(s,e){return pc(s,"POST","/v1/accounts:delete",e)}async function qf(s,e){return pc(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function nR(s,e=!1){const t=lt(s),n=await t.getIdToken(e),i=dx(n);Ue(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const l=typeof i.firebase=="object"?i.firebase:void 0,u=l?.sign_in_provider;return{claims:i,token:n,authTime:Qu(ny(i.auth_time)),issuedAtTime:Qu(ny(i.iat)),expirationTime:Qu(ny(i.exp)),signInProvider:u||null,signInSecondFactor:l?.sign_in_second_factor||null}}function ny(s){return Number(s)*1e3}function dx(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return bf("JWT malformed, contained fewer than 3 sections"),null;try{const i=hE(t);return i?JSON.parse(i):(bf("Failed to decode base64 JWT payload"),null)}catch(i){return bf("Caught error parsing JWT payload as JSON",i?.toString()),null}}function lw(s){const e=dx(s);return Ue(e,"internal-error"),Ue(typeof e.exp<"u","internal-error"),Ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function id(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Zs&&sR(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function sR({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wy{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qu(this.lastLoginAt),this.creationTime=Qu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bf(s){const e=s.auth,t=await s.getIdToken(),n=await id(s,qf(e,{idToken:t}));Ue(n?.users.length,e,"internal-error");const i=n.users[0];s._notifyReloadListener(i);const l=i.providerUserInfo?.length?ME(i.providerUserInfo):[],u=iR(s.providerData,l),h=s.isAnonymous,m=!(s.email&&i.passwordHash)&&!u?.length,p=h?m:!1,x={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:u,metadata:new wy(i.createdAt,i.lastLoginAt),isAnonymous:p};Object.assign(s,x)}async function aR(s){const e=lt(s);await Bf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function iR(s,e){return[...s.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function ME(s){return s.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oR(s,e){const t=await DE(s,{},async()=>{const n=bd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:l}=s.config,u=await PE(s,i,"/v1/token",`key=${l}`),h=await s._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const m={method:"POST",headers:h,body:n};return s.emulatorConfig&&mi(s.emulatorConfig.host)&&(m.credentials="include"),kE.fetch()(u,m)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function lR(s,e){return pc(s,"POST","/v2/accounts:revokeToken",ux(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ue(e.idToken,"internal-error"),Ue(typeof e.idToken<"u","internal-error"),Ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):lw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ue(e.length!==0,"internal-error");const t=lw(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:l}=await oR(e,t);this.updateTokensAndExpiration(n,i,Number(l))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:l}=t,u=new Fl;return n&&(Ue(typeof n=="string","internal-error",{appName:e}),u.refreshToken=n),i&&(Ue(typeof i=="string","internal-error",{appName:e}),u.accessToken=i),l&&(Ue(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Fl,this.toJSON())}_performRefresh(){return sa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(s,e){Ue(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class Qs{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new rR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new wy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await id(this,this.stsTokenManager.getToken(this.auth,e));return Ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return nR(this,e)}reload(){return aR(this)}_assign(e){this!==e&&(Ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Qs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Bf(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xs(this.auth.app))return Promise.reject(si(this.auth));const e=await this.getIdToken();return await id(this,tR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,i=t.email??void 0,l=t.phoneNumber??void 0,u=t.photoURL??void 0,h=t.tenantId??void 0,m=t._redirectEventId??void 0,p=t.createdAt??void 0,x=t.lastLoginAt??void 0,{uid:b,emailVerified:w,isAnonymous:N,providerData:V,stsTokenManager:D}=t;Ue(b&&D,e,"internal-error");const q=Fl.fromJSON(this.name,D);Ue(typeof b=="string",e,"internal-error"),Ga(n,e.name),Ga(i,e.name),Ue(typeof w=="boolean",e,"internal-error"),Ue(typeof N=="boolean",e,"internal-error"),Ga(l,e.name),Ga(u,e.name),Ga(h,e.name),Ga(m,e.name),Ga(p,e.name),Ga(x,e.name);const z=new Qs({uid:b,auth:e,email:i,emailVerified:w,displayName:n,isAnonymous:N,photoURL:u,phoneNumber:l,tenantId:h,stsTokenManager:q,createdAt:p,lastLoginAt:x});return V&&Array.isArray(V)&&(z.providerData=V.map(B=>({...B}))),m&&(z._redirectEventId=m),z}static async _fromIdTokenResponse(e,t,n=!1){const i=new Fl;i.updateFromServerResponse(t);const l=new Qs({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Bf(l),l}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];Ue(i.localId!==void 0,"internal-error");const l=i.providerUserInfo!==void 0?ME(i.providerUserInfo):[],u=!(i.email&&i.passwordHash)&&!l?.length,h=new Fl;h.updateFromIdToken(n);const m=new Qs({uid:i.localId,auth:e,stsTokenManager:h,isAnonymous:u}),p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new wy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!l?.length};return Object.assign(m,p),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw=new Map;function ra(s){ca(s instanceof Function,"Expected a class definition");let e=cw.get(s);return e?(ca(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,cw.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}VE.type="NONE";const uw=VE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(s,e,t){return`firebase:${s}:${e}:${t}`}class ql{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:l}=this.auth;this.fullUserKey=_f(this.userKey,i.apiKey,l),this.fullPersistenceKey=_f("persistence",i.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await qf(this.auth,{idToken:e}).catch(()=>{});return t?Qs._fromGetAccountInfoResponse(this.auth,t,e):null}return Qs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ql(ra(uw),e,n);const i=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=i[0]||ra(uw);const u=_f(n,e.config.apiKey,e.name);let h=null;for(const p of t)try{const x=await p._get(u);if(x){let b;if(typeof x=="string"){const w=await qf(e,{idToken:x}).catch(()=>{});if(!w)break;b=await Qs._fromGetAccountInfoResponse(e,w,x)}else b=Qs._fromJSON(e,x);p!==l&&(h=b),l=p;break}}catch{}const m=i.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!m.length?new ql(l,e,n):(l=m[0],h&&await l._set(u,h.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(u)}catch{}})),new ql(l,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dw(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(FE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(OE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(BE(e))return"Blackberry";if(zE(e))return"Webos";if(LE(e))return"Safari";if((e.includes("chrome/")||UE(e))&&!e.includes("edge/"))return"Chrome";if(qE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if(n?.length===2)return n[1]}return"Other"}function OE(s=hn()){return/firefox\//i.test(s)}function LE(s=hn()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function UE(s=hn()){return/crios\//i.test(s)}function FE(s=hn()){return/iemobile/i.test(s)}function qE(s=hn()){return/android/i.test(s)}function BE(s=hn()){return/blackberry/i.test(s)}function zE(s=hn()){return/webos/i.test(s)}function hx(s=hn()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function cR(s=hn()){return hx(s)&&!!window.navigator?.standalone}function uR(){return E1()&&document.documentMode===10}function GE(s=hn()){return hx(s)||qE(s)||zE(s)||BE(s)||/windows phone/i.test(s)||FE(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(s,e=[]){let t;switch(s){case"Browser":t=dw(hn());break;case"Worker":t=`${dw(hn())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=l=>new Promise((u,h)=>{try{const m=e(l);u(m)}catch(m){h(m)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hR(s,e={}){return pc(s,"GET","/v2/passwordPolicy",ux(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR=6;class mR{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??fR,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hw(this),this.idTokenSubscription=new hw(this),this.beforeStateQueue=new dR(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=CE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ra(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ql.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await qf(this,{idToken:e}),n=await Qs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(xs(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,u=n?._redirectEventId,h=await this.tryRedirectSignIn(e);(!l||l===u)&&h?.user&&(n=h.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(l){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bf(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=YC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(xs(this.app))return Promise.reject(si(this));const t=e?lt(e):null;return t&&Ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return xs(this.app)?Promise.reject(si(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return xs(this.app)?Promise.reject(si(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ra(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await hR(this),t=new mR(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ro("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await lR(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ra(e)||this._popupRedirectResolver;Ue(t,this,"argument-error"),this.redirectPersistenceManager=await ql.create(this,[ra(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ue(h,this,"internal-error"),h.then(()=>{u||l(this.currentUser)}),typeof t=="function"){const m=e.addObserver(t,n,i);return()=>{u=!0,m()}}else{const m=e.addObserver(t);return()=>{u=!0,m()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=HE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(xs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&$C(`Error while retrieving App Check token: ${e.error}`),e?.token}}function wd(s){return lt(s)}class hw{constructor(e){this.auth=e,this.observer=null,this.addObserver=C1(t=>this.observer=t)}get next(){return Ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pR(s){fx=s}function yR(s){return fx.loadJS(s)}function xR(){return fx.gapiScript}function vR(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bR(s,e){const t=Ar(s,"auth");if(t.isInitialized()){const i=t.getImmediate(),l=t.getOptions();if(Os(l,e??{}))return i;Sr(i,"already-initialized")}return t.initialize({options:e})}function _R(s,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(ra);e?.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e?.popupRedirectResolver)}function wR(s,e,t){const n=wd(s);Ue(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,l=$E(e),{host:u,port:h}=TR(e),m=h===null?"":`:${h}`,p={url:`${l}//${u}${m}/`},x=Object.freeze({host:u,port:h,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){Ue(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),Ue(Os(p,n.config.emulator)&&Os(x,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=p,n.emulatorConfig=x,n.settings.appVerificationDisabledForTesting=!0,mi(u)?(dm(`${l}//${u}${m}`),rx("Auth",!0)):ER()}function $E(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function TR(s){const e=$E(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const l=i[1];return{host:l,port:fw(n.substr(l.length+1))}}else{const[l,u]=n.split(":");return{host:l,port:fw(u)}}}function fw(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function ER(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return sa("not implemented")}_getIdTokenResponse(e){return sa("not implemented")}_linkToIdToken(e,t){return sa("not implemented")}_getReauthenticationResolver(e){return sa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bl(s,e){return ZC(s,"POST","/v1/accounts:signInWithIdp",ux(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR="http://localhost";class vo extends QE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new vo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Sr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i,...l}=t;if(!n||!i)return null;const u=new vo(n,i);return u.idToken=l.idToken||void 0,u.accessToken=l.accessToken||void 0,u.secret=l.secret,u.nonce=l.nonce,u.pendingToken=l.pendingToken||null,u}_getIdTokenResponse(e){const t=this.buildRequest();return Bl(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Bl(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Bl(e,t)}buildRequest(){const e={requestUri:SR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=bd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td extends mm{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka extends Td{constructor(){super("facebook.com")}static credential(e){return vo._fromParams({providerId:Ka.PROVIDER_ID,signInMethod:Ka.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ka.credentialFromTaggedObject(e)}static credentialFromError(e){return Ka.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ka.credential(e.oauthAccessToken)}catch{return null}}}Ka.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ka.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na extends Td{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return vo._fromParams({providerId:na.PROVIDER_ID,signInMethod:na.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return na.credentialFromTaggedObject(e)}static credentialFromError(e){return na.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return na.credential(t,n)}catch{return null}}}na.GOOGLE_SIGN_IN_METHOD="google.com";na.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya extends Td{constructor(){super("github.com")}static credential(e){return vo._fromParams({providerId:Ya.PROVIDER_ID,signInMethod:Ya.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ya.credentialFromTaggedObject(e)}static credentialFromError(e){return Ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ya.credential(e.oauthAccessToken)}catch{return null}}}Ya.GITHUB_SIGN_IN_METHOD="github.com";Ya.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa extends Td{constructor(){super("twitter.com")}static credential(e,t){return vo._fromParams({providerId:Xa.PROVIDER_ID,signInMethod:Xa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Xa.credentialFromTaggedObject(e)}static credentialFromError(e){return Xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Xa.credential(t,n)}catch{return null}}}Xa.TWITTER_SIGN_IN_METHOD="twitter.com";Xa.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const l=await Qs._fromIdTokenResponse(e,n,i),u=mw(n);return new $l({user:l,providerId:u,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=mw(n);return new $l({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function mw(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf extends Zs{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,zf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new zf(e,t,n,i)}}function KE(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?zf._fromErrorAndOperation(s,l,e,n):l})}async function NR(s,e,t=!1){const n=await id(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return $l._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AR(s,e,t=!1){const{auth:n}=s;if(xs(n.app))return Promise.reject(si(n));const i="reauthenticate";try{const l=await id(s,KE(n,i,e,s),t);Ue(l.idToken,n,"internal-error");const u=dx(l.idToken);Ue(u,n,"internal-error");const{sub:h}=u;return Ue(s.uid===h,n,"user-mismatch"),$l._forOperation(s,i,l)}catch(l){throw l?.code==="auth/user-not-found"&&Sr(n,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IR(s,e,t=!1){if(xs(s.app))return Promise.reject(si(s));const n="signIn",i=await KE(s,n,e),l=await $l._fromIdTokenResponse(s,n,i);return t||await s._updateCurrentUser(l.user),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jR(s,e){return lt(s).setPersistence(e)}function YE(s,e,t,n){return lt(s).onIdTokenChanged(e,t,n)}function CR(s,e,t){return lt(s).beforeAuthStateChanged(e,t)}function RR(s,e,t,n){return lt(s).onAuthStateChanged(e,t,n)}function kR(s){return lt(s).signOut()}const Gf="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gf,"1"),this.storage.removeItem(Gf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DR=1e3,PR=10;class WE extends XE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=GE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((u,h,m)=>{this.notifyListeners(u,m)});return}const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const u=this.storage.getItem(n);!t&&this.localCache[n]===u||this.notifyListeners(n,u)},l=this.storage.getItem(n);uR()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,PR):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},DR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}WE.type="LOCAL";const JE=WE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE extends XE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ZE.type="SESSION";const eS=ZE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const n=new gm(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:l}=t.data,u=this.handlersMap[i];if(!u?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const h=Array.from(u).map(async p=>p(t.origin,l)),m=await MR(h);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:m})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mx(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let l,u;return new Promise((h,m)=>{const p=mx("",20);i.port1.start();const x=setTimeout(()=>{m(new Error("unsupported_event"))},n);u={messageChannel:i,onMessage(b){const w=b;if(w.data.eventId===p)switch(w.data.status){case"ack":clearTimeout(x),l=setTimeout(()=>{m(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),h(w.data.response);break;default:clearTimeout(x),clearTimeout(l),m(new Error("invalid_response"));break}}},this.handlers.add(u),i.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[i.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(){return window}function OR(s){_r().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tS(){return typeof _r().WorkerGlobalScope<"u"&&typeof _r().importScripts=="function"}async function LR(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function UR(){return navigator?.serviceWorker?.controller||null}function FR(){return tS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nS="firebaseLocalStorageDb",qR=1,Hf="firebaseLocalStorage",sS="fbase_key";class Ed{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function pm(s,e){return s.transaction([Hf],e?"readwrite":"readonly").objectStore(Hf)}function BR(){const s=indexedDB.deleteDatabase(nS);return new Ed(s).toPromise()}function Ty(){const s=indexedDB.open(nS,qR);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(Hf,{keyPath:sS})}catch(i){t(i)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(Hf)?e(n):(n.close(),await BR(),e(await Ty()))})})}async function gw(s,e,t){const n=pm(s,!0).put({[sS]:e,value:t});return new Ed(n).toPromise()}async function zR(s,e){const t=pm(s,!1).get(e),n=await new Ed(t).toPromise();return n===void 0?null:n.value}function pw(s,e){const t=pm(s,!0).delete(e);return new Ed(t).toPromise()}const GR=800,HR=3;class rS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ty(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>HR)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gm._getInstance(FR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await LR(),!this.activeServiceWorker)return;this.sender=new VR(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||UR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ty();return await gw(e,Gf,"1"),await pw(e,Gf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>gw(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>zR(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const l=pm(i,!1).getAll();return new Ed(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:l}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(l)&&(this.notifyListeners(i,l),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),GR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}rS.type="LOCAL";const $R=rS;new _d(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gx(s,e){return e?ra(e):(Ue(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px extends QE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bl(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Bl(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Bl(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function QR(s){return IR(s.auth,new px(s),s.bypassAuthState)}function KR(s){const{auth:e,user:t}=s;return Ue(t,e,"internal-error"),AR(t,new px(s),s.bypassAuthState)}async function YR(s){const{auth:e,user:t}=s;return Ue(t,e,"internal-error"),NR(t,new px(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(e,t,n,i,l=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:l,error:u,type:h}=e;if(u){this.reject(u);return}const m={auth:this.auth,requestUri:t,sessionId:n,tenantId:l||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(m))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return QR;case"linkViaPopup":case"linkViaRedirect":return YR;case"reauthViaPopup":case"reauthViaRedirect":return KR;default:Sr(this.auth,"internal-error")}}resolve(e){ca(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ca(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XR=new _d(2e3,1e4);async function WR(s,e,t){if(xs(s.app))return Promise.reject(Ys(s,"operation-not-supported-in-this-environment"));const n=wd(s);RE(s,e,mm);const i=gx(n,t);return new ho(n,"signInViaPopup",e,i).executeNotNull()}class ho extends aS{constructor(e,t,n,i,l){super(e,t,i,l),this.provider=n,this.authWindow=null,this.pollId=null,ho.currentPopupAction&&ho.currentPopupAction.cancel(),ho.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ue(e,this.auth,"internal-error"),e}async onExecution(){ca(this.filter.length===1,"Popup operations only handle one event");const e=mx();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ys(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ys(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ho.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ys(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,XR.get())};e()}}ho.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="pendingRedirect",wf=new Map;class ZR extends aS{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=wf.get(this.auth._key());if(!e){try{const n=await e2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}wf.set(this.auth._key(),e)}return this.bypassAuthState||wf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function e2(s,e){const t=oS(e),n=iS(s);if(!await n._isAvailable())return!1;const i=await n._get(t)==="true";return await n._remove(t),i}async function t2(s,e){return iS(s)._set(oS(e),"true")}function n2(s,e){wf.set(s._key(),e)}function iS(s){return ra(s._redirectPersistence)}function oS(s){return _f(JR,s.config.apiKey,s.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(s,e,t){return r2(s,e,t)}async function r2(s,e,t){if(xs(s.app))return Promise.reject(si(s));const n=wd(s);RE(s,e,mm),await n._initializationPromise;const i=gx(n,t);return await t2(i,n),i._openRedirect(n,e,"signInViaRedirect")}async function a2(s,e,t=!1){if(xs(s.app))return Promise.reject(si(s));const n=wd(s),i=gx(n,e),u=await new ZR(n,i,t).execute();return u&&!t&&(delete u.user._redirectEventId,await n._persistUserIfCurrent(u.user),await n._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i2=600*1e3;class o2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!l2(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!lS(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ys(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=i2&&this.cachedEventUids.clear(),this.cachedEventUids.has(yw(e))}saveEventToCache(e){this.cachedEventUids.add(yw(e)),this.lastProcessedEventTime=Date.now()}}function yw(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function lS({type:s,error:e}){return s==="unknown"&&e?.code==="auth/no-auth-event"}function l2(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lS(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c2(s,e={}){return pc(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,d2=/^https?/;async function h2(s){if(s.config.emulator)return;const{authorizedDomains:e}=await c2(s);for(const t of e)try{if(f2(t))return}catch{}Sr(s,"unauthorized-domain")}function f2(s){const e=_y(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const u=new URL(s);return u.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&u.hostname===n}if(!d2.test(t))return!1;if(u2.test(s))return n===s;const i=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m2=new _d(3e4,6e4);function xw(){const s=_r().___jsl;if(s?.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function g2(s){return new Promise((e,t)=>{function n(){xw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xw(),t(Ys(s,"network-request-failed"))},timeout:m2.get()})}if(_r().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(_r().gapi?.load)n();else{const i=vR("iframefcb");return _r()[i]=()=>{gapi.load?n():t(Ys(s,"network-request-failed"))},yR(`${xR()}?onload=${i}`).catch(l=>t(l))}}).catch(e=>{throw Tf=null,e})}let Tf=null;function p2(s){return Tf=Tf||g2(s),Tf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2=new _d(5e3,15e3),x2="__/auth/iframe",v2="emulator/auth/iframe",b2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function w2(s){const e=s.config;Ue(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?cx(e,v2):`https://${s.config.authDomain}/${x2}`,n={apiKey:e.apiKey,appName:s.name,v:gc},i=_2.get(s.config.apiHost);i&&(n.eid=i);const l=s._getFrameworks();return l.length&&(n.fw=l.join(",")),`${t}?${bd(n).slice(1)}`}async function T2(s){const e=await p2(s),t=_r().gapi;return Ue(t,s,"internal-error"),e.open({where:document.body,url:w2(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:b2,dontclear:!0},n=>new Promise(async(i,l)=>{await n.restyle({setHideOnLeave:!1});const u=Ys(s,"network-request-failed"),h=_r().setTimeout(()=>{l(u)},y2.get());function m(){_r().clearTimeout(h),i(n)}n.ping(m).then(m,()=>{l(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},S2=500,N2=600,A2="_blank",I2="http://localhost";class vw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j2(s,e,t,n=S2,i=N2){const l=Math.max((window.screen.availHeight-i)/2,0).toString(),u=Math.max((window.screen.availWidth-n)/2,0).toString();let h="";const m={...E2,width:n.toString(),height:i.toString(),top:l,left:u},p=hn().toLowerCase();t&&(h=UE(p)?A2:t),OE(p)&&(e=e||I2,m.scrollbars="yes");const x=Object.entries(m).reduce((w,[N,V])=>`${w}${N}=${V},`,"");if(cR(p)&&h!=="_self")return C2(e||"",h),new vw(null);const b=window.open(e||"",h,x);Ue(b,s,"popup-blocked");try{b.focus()}catch{}return new vw(b)}function C2(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2="__/auth/handler",k2="emulator/auth/handler",D2=encodeURIComponent("fac");async function bw(s,e,t,n,i,l){Ue(s.config.authDomain,s,"auth-domain-config-required"),Ue(s.config.apiKey,s,"invalid-api-key");const u={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:gc,eventId:i};if(e instanceof mm){e.setDefaultLanguage(s.languageCode),u.providerId=e.providerId||"",j1(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,b]of Object.entries({}))u[x]=b}if(e instanceof Td){const x=e.getScopes().filter(b=>b!=="");x.length>0&&(u.scopes=x.join(","))}s.tenantId&&(u.tid=s.tenantId);const h=u;for(const x of Object.keys(h))h[x]===void 0&&delete h[x];const m=await s._getAppCheckToken(),p=m?`#${D2}=${encodeURIComponent(m)}`:"";return`${P2(s)}?${bd(h).slice(1)}${p}`}function P2({config:s}){return s.emulator?cx(s,k2):`https://${s.authDomain}/${R2}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sy="webStorageSupport";class M2{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eS,this._completeRedirectFn=a2,this._overrideRedirectResult=n2}async _openPopup(e,t,n,i){ca(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await bw(e,t,n,_y(),i);return j2(e,l,mx())}async _openRedirect(e,t,n,i){await this._originValidation(e);const l=await bw(e,t,n,_y(),i);return OR(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:l}=this.eventManagers[t];return i?Promise.resolve(i):(ca(l,"If manager is not set, promise should be"),l)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await T2(e),n=new o2(e);return t.register("authEvent",i=>(Ue(i?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(sy,{type:sy},i=>{const l=i?.[0]?.[sy];l!==void 0&&t(!!l),Sr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=h2(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return GE()||LE()||hx()}}const V2=M2;var _w="@firebase/auth",ww="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L2(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function U2(s){Js(new Ls("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=n.options;Ue(u&&!u.includes(":"),"invalid-api-key",{appName:n.name});const m={apiKey:u,authDomain:h,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:HE(s)},p=new gR(n,i,l,m);return _R(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Js(new Ls("auth-internal",e=>{const t=wd(e.getProvider("auth").getImmediate());return(n=>new O2(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ss(_w,ww,L2(s)),ss(_w,ww,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2=300,q2=yE("authIdTokenMaxAge")||F2;let Tw=null;const B2=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>q2)return;const i=t?.token;Tw!==i&&(Tw=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function z2(s=fm()){const e=Ar(s,"auth");if(e.isInitialized())return e.getImmediate();const t=bR(s,{popupRedirectResolver:V2,persistence:[$R,JE,eS]}),n=yE("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(n,location.origin);if(location.origin===l.origin){const u=B2(l.toString());CR(t,u,()=>u(t.currentUser)),YE(t,h=>u(h))}}const i=mE("auth");return i&&wR(t,`http://${i}`),t}function G2(){return document.getElementsByTagName("head")?.[0]??document}pR({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=i=>{const l=Ys("internal-error");l.customData=i,t(l)},n.type="text/javascript",n.charset="UTF-8",G2().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});U2("Browser");var H2="firebase",$2="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ss(H2,$2,"app");var Ew=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ri,cS;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(C,T){function A(){}A.prototype=T.prototype,C.D=T.prototype,C.prototype=new A,C.prototype.constructor=C,C.C=function(k,U,$){for(var M=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)M[ze-2]=arguments[ze];return T.prototype[U].apply(k,M)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(C,T,A){A||(A=0);var k=Array(16);if(typeof T=="string")for(var U=0;16>U;++U)k[U]=T.charCodeAt(A++)|T.charCodeAt(A++)<<8|T.charCodeAt(A++)<<16|T.charCodeAt(A++)<<24;else for(U=0;16>U;++U)k[U]=T[A++]|T[A++]<<8|T[A++]<<16|T[A++]<<24;T=C.g[0],A=C.g[1],U=C.g[2];var $=C.g[3],M=T+($^A&(U^$))+k[0]+3614090360&4294967295;T=A+(M<<7&4294967295|M>>>25),M=$+(U^T&(A^U))+k[1]+3905402710&4294967295,$=T+(M<<12&4294967295|M>>>20),M=U+(A^$&(T^A))+k[2]+606105819&4294967295,U=$+(M<<17&4294967295|M>>>15),M=A+(T^U&($^T))+k[3]+3250441966&4294967295,A=U+(M<<22&4294967295|M>>>10),M=T+($^A&(U^$))+k[4]+4118548399&4294967295,T=A+(M<<7&4294967295|M>>>25),M=$+(U^T&(A^U))+k[5]+1200080426&4294967295,$=T+(M<<12&4294967295|M>>>20),M=U+(A^$&(T^A))+k[6]+2821735955&4294967295,U=$+(M<<17&4294967295|M>>>15),M=A+(T^U&($^T))+k[7]+4249261313&4294967295,A=U+(M<<22&4294967295|M>>>10),M=T+($^A&(U^$))+k[8]+1770035416&4294967295,T=A+(M<<7&4294967295|M>>>25),M=$+(U^T&(A^U))+k[9]+2336552879&4294967295,$=T+(M<<12&4294967295|M>>>20),M=U+(A^$&(T^A))+k[10]+4294925233&4294967295,U=$+(M<<17&4294967295|M>>>15),M=A+(T^U&($^T))+k[11]+2304563134&4294967295,A=U+(M<<22&4294967295|M>>>10),M=T+($^A&(U^$))+k[12]+1804603682&4294967295,T=A+(M<<7&4294967295|M>>>25),M=$+(U^T&(A^U))+k[13]+4254626195&4294967295,$=T+(M<<12&4294967295|M>>>20),M=U+(A^$&(T^A))+k[14]+2792965006&4294967295,U=$+(M<<17&4294967295|M>>>15),M=A+(T^U&($^T))+k[15]+1236535329&4294967295,A=U+(M<<22&4294967295|M>>>10),M=T+(U^$&(A^U))+k[1]+4129170786&4294967295,T=A+(M<<5&4294967295|M>>>27),M=$+(A^U&(T^A))+k[6]+3225465664&4294967295,$=T+(M<<9&4294967295|M>>>23),M=U+(T^A&($^T))+k[11]+643717713&4294967295,U=$+(M<<14&4294967295|M>>>18),M=A+($^T&(U^$))+k[0]+3921069994&4294967295,A=U+(M<<20&4294967295|M>>>12),M=T+(U^$&(A^U))+k[5]+3593408605&4294967295,T=A+(M<<5&4294967295|M>>>27),M=$+(A^U&(T^A))+k[10]+38016083&4294967295,$=T+(M<<9&4294967295|M>>>23),M=U+(T^A&($^T))+k[15]+3634488961&4294967295,U=$+(M<<14&4294967295|M>>>18),M=A+($^T&(U^$))+k[4]+3889429448&4294967295,A=U+(M<<20&4294967295|M>>>12),M=T+(U^$&(A^U))+k[9]+568446438&4294967295,T=A+(M<<5&4294967295|M>>>27),M=$+(A^U&(T^A))+k[14]+3275163606&4294967295,$=T+(M<<9&4294967295|M>>>23),M=U+(T^A&($^T))+k[3]+4107603335&4294967295,U=$+(M<<14&4294967295|M>>>18),M=A+($^T&(U^$))+k[8]+1163531501&4294967295,A=U+(M<<20&4294967295|M>>>12),M=T+(U^$&(A^U))+k[13]+2850285829&4294967295,T=A+(M<<5&4294967295|M>>>27),M=$+(A^U&(T^A))+k[2]+4243563512&4294967295,$=T+(M<<9&4294967295|M>>>23),M=U+(T^A&($^T))+k[7]+1735328473&4294967295,U=$+(M<<14&4294967295|M>>>18),M=A+($^T&(U^$))+k[12]+2368359562&4294967295,A=U+(M<<20&4294967295|M>>>12),M=T+(A^U^$)+k[5]+4294588738&4294967295,T=A+(M<<4&4294967295|M>>>28),M=$+(T^A^U)+k[8]+2272392833&4294967295,$=T+(M<<11&4294967295|M>>>21),M=U+($^T^A)+k[11]+1839030562&4294967295,U=$+(M<<16&4294967295|M>>>16),M=A+(U^$^T)+k[14]+4259657740&4294967295,A=U+(M<<23&4294967295|M>>>9),M=T+(A^U^$)+k[1]+2763975236&4294967295,T=A+(M<<4&4294967295|M>>>28),M=$+(T^A^U)+k[4]+1272893353&4294967295,$=T+(M<<11&4294967295|M>>>21),M=U+($^T^A)+k[7]+4139469664&4294967295,U=$+(M<<16&4294967295|M>>>16),M=A+(U^$^T)+k[10]+3200236656&4294967295,A=U+(M<<23&4294967295|M>>>9),M=T+(A^U^$)+k[13]+681279174&4294967295,T=A+(M<<4&4294967295|M>>>28),M=$+(T^A^U)+k[0]+3936430074&4294967295,$=T+(M<<11&4294967295|M>>>21),M=U+($^T^A)+k[3]+3572445317&4294967295,U=$+(M<<16&4294967295|M>>>16),M=A+(U^$^T)+k[6]+76029189&4294967295,A=U+(M<<23&4294967295|M>>>9),M=T+(A^U^$)+k[9]+3654602809&4294967295,T=A+(M<<4&4294967295|M>>>28),M=$+(T^A^U)+k[12]+3873151461&4294967295,$=T+(M<<11&4294967295|M>>>21),M=U+($^T^A)+k[15]+530742520&4294967295,U=$+(M<<16&4294967295|M>>>16),M=A+(U^$^T)+k[2]+3299628645&4294967295,A=U+(M<<23&4294967295|M>>>9),M=T+(U^(A|~$))+k[0]+4096336452&4294967295,T=A+(M<<6&4294967295|M>>>26),M=$+(A^(T|~U))+k[7]+1126891415&4294967295,$=T+(M<<10&4294967295|M>>>22),M=U+(T^($|~A))+k[14]+2878612391&4294967295,U=$+(M<<15&4294967295|M>>>17),M=A+($^(U|~T))+k[5]+4237533241&4294967295,A=U+(M<<21&4294967295|M>>>11),M=T+(U^(A|~$))+k[12]+1700485571&4294967295,T=A+(M<<6&4294967295|M>>>26),M=$+(A^(T|~U))+k[3]+2399980690&4294967295,$=T+(M<<10&4294967295|M>>>22),M=U+(T^($|~A))+k[10]+4293915773&4294967295,U=$+(M<<15&4294967295|M>>>17),M=A+($^(U|~T))+k[1]+2240044497&4294967295,A=U+(M<<21&4294967295|M>>>11),M=T+(U^(A|~$))+k[8]+1873313359&4294967295,T=A+(M<<6&4294967295|M>>>26),M=$+(A^(T|~U))+k[15]+4264355552&4294967295,$=T+(M<<10&4294967295|M>>>22),M=U+(T^($|~A))+k[6]+2734768916&4294967295,U=$+(M<<15&4294967295|M>>>17),M=A+($^(U|~T))+k[13]+1309151649&4294967295,A=U+(M<<21&4294967295|M>>>11),M=T+(U^(A|~$))+k[4]+4149444226&4294967295,T=A+(M<<6&4294967295|M>>>26),M=$+(A^(T|~U))+k[11]+3174756917&4294967295,$=T+(M<<10&4294967295|M>>>22),M=U+(T^($|~A))+k[2]+718787259&4294967295,U=$+(M<<15&4294967295|M>>>17),M=A+($^(U|~T))+k[9]+3951481745&4294967295,C.g[0]=C.g[0]+T&4294967295,C.g[1]=C.g[1]+(U+(M<<21&4294967295|M>>>11))&4294967295,C.g[2]=C.g[2]+U&4294967295,C.g[3]=C.g[3]+$&4294967295}n.prototype.u=function(C,T){T===void 0&&(T=C.length);for(var A=T-this.blockSize,k=this.B,U=this.h,$=0;$<T;){if(U==0)for(;$<=A;)i(this,C,$),$+=this.blockSize;if(typeof C=="string"){for(;$<T;)if(k[U++]=C.charCodeAt($++),U==this.blockSize){i(this,k),U=0;break}}else for(;$<T;)if(k[U++]=C[$++],U==this.blockSize){i(this,k),U=0;break}}this.h=U,this.o+=T},n.prototype.v=function(){var C=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);C[0]=128;for(var T=1;T<C.length-8;++T)C[T]=0;var A=8*this.o;for(T=C.length-8;T<C.length;++T)C[T]=A&255,A/=256;for(this.u(C),C=Array(16),T=A=0;4>T;++T)for(var k=0;32>k;k+=8)C[A++]=this.g[T]>>>k&255;return C};function l(C,T){var A=h;return Object.prototype.hasOwnProperty.call(A,C)?A[C]:A[C]=T(C)}function u(C,T){this.h=T;for(var A=[],k=!0,U=C.length-1;0<=U;U--){var $=C[U]|0;k&&$==T||(A[U]=$,k=!1)}this.g=A}var h={};function m(C){return-128<=C&&128>C?l(C,function(T){return new u([T|0],0>T?-1:0)}):new u([C|0],0>C?-1:0)}function p(C){if(isNaN(C)||!isFinite(C))return b;if(0>C)return q(p(-C));for(var T=[],A=1,k=0;C>=A;k++)T[k]=C/A|0,A*=4294967296;return new u(T,0)}function x(C,T){if(C.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C.charAt(0)=="-")return q(x(C.substring(1),T));if(0<=C.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=p(Math.pow(T,8)),k=b,U=0;U<C.length;U+=8){var $=Math.min(8,C.length-U),M=parseInt(C.substring(U,U+$),T);8>$?($=p(Math.pow(T,$)),k=k.j($).add(p(M))):(k=k.j(A),k=k.add(p(M)))}return k}var b=m(0),w=m(1),N=m(16777216);s=u.prototype,s.m=function(){if(D(this))return-q(this).m();for(var C=0,T=1,A=0;A<this.g.length;A++){var k=this.i(A);C+=(0<=k?k:4294967296+k)*T,T*=4294967296}return C},s.toString=function(C){if(C=C||10,2>C||36<C)throw Error("radix out of range: "+C);if(V(this))return"0";if(D(this))return"-"+q(this).toString(C);for(var T=p(Math.pow(C,6)),A=this,k="";;){var U=G(A,T).g;A=z(A,U.j(T));var $=((0<A.g.length?A.g[0]:A.h)>>>0).toString(C);if(A=U,V(A))return $+k;for(;6>$.length;)$="0"+$;k=$+k}},s.i=function(C){return 0>C?0:C<this.g.length?this.g[C]:this.h};function V(C){if(C.h!=0)return!1;for(var T=0;T<C.g.length;T++)if(C.g[T]!=0)return!1;return!0}function D(C){return C.h==-1}s.l=function(C){return C=z(this,C),D(C)?-1:V(C)?0:1};function q(C){for(var T=C.g.length,A=[],k=0;k<T;k++)A[k]=~C.g[k];return new u(A,~C.h).add(w)}s.abs=function(){return D(this)?q(this):this},s.add=function(C){for(var T=Math.max(this.g.length,C.g.length),A=[],k=0,U=0;U<=T;U++){var $=k+(this.i(U)&65535)+(C.i(U)&65535),M=($>>>16)+(this.i(U)>>>16)+(C.i(U)>>>16);k=M>>>16,$&=65535,M&=65535,A[U]=M<<16|$}return new u(A,A[A.length-1]&-2147483648?-1:0)};function z(C,T){return C.add(q(T))}s.j=function(C){if(V(this)||V(C))return b;if(D(this))return D(C)?q(this).j(q(C)):q(q(this).j(C));if(D(C))return q(this.j(q(C)));if(0>this.l(N)&&0>C.l(N))return p(this.m()*C.m());for(var T=this.g.length+C.g.length,A=[],k=0;k<2*T;k++)A[k]=0;for(k=0;k<this.g.length;k++)for(var U=0;U<C.g.length;U++){var $=this.i(k)>>>16,M=this.i(k)&65535,ze=C.i(U)>>>16,se=C.i(U)&65535;A[2*k+2*U]+=M*se,B(A,2*k+2*U),A[2*k+2*U+1]+=$*se,B(A,2*k+2*U+1),A[2*k+2*U+1]+=M*ze,B(A,2*k+2*U+1),A[2*k+2*U+2]+=$*ze,B(A,2*k+2*U+2)}for(k=0;k<T;k++)A[k]=A[2*k+1]<<16|A[2*k];for(k=T;k<2*T;k++)A[k]=0;return new u(A,0)};function B(C,T){for(;(C[T]&65535)!=C[T];)C[T+1]+=C[T]>>>16,C[T]&=65535,T++}function L(C,T){this.g=C,this.h=T}function G(C,T){if(V(T))throw Error("division by zero");if(V(C))return new L(b,b);if(D(C))return T=G(q(C),T),new L(q(T.g),q(T.h));if(D(T))return T=G(C,q(T)),new L(q(T.g),T.h);if(30<C.g.length){if(D(C)||D(T))throw Error("slowDivide_ only works with positive integers.");for(var A=w,k=T;0>=k.l(C);)A=H(A),k=H(k);var U=R(A,1),$=R(k,1);for(k=R(k,2),A=R(A,2);!V(k);){var M=$.add(k);0>=M.l(C)&&(U=U.add(A),$=M),k=R(k,1),A=R(A,1)}return T=z(C,U.j(T)),new L(U,T)}for(U=b;0<=C.l(T);){for(A=Math.max(1,Math.floor(C.m()/T.m())),k=Math.ceil(Math.log(A)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),$=p(A),M=$.j(T);D(M)||0<M.l(C);)A-=k,$=p(A),M=$.j(T);V($)&&($=w),U=U.add($),C=z(C,M)}return new L(U,C)}s.A=function(C){return G(this,C).h},s.and=function(C){for(var T=Math.max(this.g.length,C.g.length),A=[],k=0;k<T;k++)A[k]=this.i(k)&C.i(k);return new u(A,this.h&C.h)},s.or=function(C){for(var T=Math.max(this.g.length,C.g.length),A=[],k=0;k<T;k++)A[k]=this.i(k)|C.i(k);return new u(A,this.h|C.h)},s.xor=function(C){for(var T=Math.max(this.g.length,C.g.length),A=[],k=0;k<T;k++)A[k]=this.i(k)^C.i(k);return new u(A,this.h^C.h)};function H(C){for(var T=C.g.length+1,A=[],k=0;k<T;k++)A[k]=C.i(k)<<1|C.i(k-1)>>>31;return new u(A,C.h)}function R(C,T){var A=T>>5;T%=32;for(var k=C.g.length-A,U=[],$=0;$<k;$++)U[$]=0<T?C.i($+A)>>>T|C.i($+A+1)<<32-T:C.i($+A);return new u(U,C.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,cS=n,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=p,u.fromString=x,ri=u}).apply(typeof Ew<"u"?Ew:typeof self<"u"?self:typeof window<"u"?window:{});var uf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var uS,qu,dS,Ef,Ey,hS,fS,mS;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,v,_){return f==Array.prototype||f==Object.prototype||(f[v]=_.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof uf=="object"&&uf];for(var v=0;v<f.length;++v){var _=f[v];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var n=t(this);function i(f,v){if(v)e:{var _=n;f=f.split(".");for(var I=0;I<f.length-1;I++){var W=f[I];if(!(W in _))break e;_=_[W]}f=f[f.length-1],I=_[f],v=v(I),v!=I&&v!=null&&e(_,f,{configurable:!0,writable:!0,value:v})}}function l(f,v){f instanceof String&&(f+="");var _=0,I=!1,W={next:function(){if(!I&&_<f.length){var ae=_++;return{value:v(ae,f[ae]),done:!1}}return I=!0,{done:!0,value:void 0}}};return W[Symbol.iterator]=function(){return W},W}i("Array.prototype.values",function(f){return f||function(){return l(this,function(v,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var u=u||{},h=this||self;function m(f){var v=typeof f;return v=v!="object"?v:f?Array.isArray(f)?"array":v:"null",v=="array"||v=="object"&&typeof f.length=="number"}function p(f){var v=typeof f;return v=="object"&&f!=null||v=="function"}function x(f,v,_){return f.call.apply(f.bind,arguments)}function b(f,v,_){if(!f)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var W=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(W,I),f.apply(v,W)}}return function(){return f.apply(v,arguments)}}function w(f,v,_){return w=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?x:b,w.apply(null,arguments)}function N(f,v){var _=Array.prototype.slice.call(arguments,1);return function(){var I=_.slice();return I.push.apply(I,arguments),f.apply(this,I)}}function V(f,v){function _(){}_.prototype=v.prototype,f.aa=v.prototype,f.prototype=new _,f.prototype.constructor=f,f.Qb=function(I,W,ae){for(var ve=Array(arguments.length-2),st=2;st<arguments.length;st++)ve[st-2]=arguments[st];return v.prototype[W].apply(I,ve)}}function D(f){const v=f.length;if(0<v){const _=Array(v);for(let I=0;I<v;I++)_[I]=f[I];return _}return[]}function q(f,v){for(let _=1;_<arguments.length;_++){const I=arguments[_];if(m(I)){const W=f.length||0,ae=I.length||0;f.length=W+ae;for(let ve=0;ve<ae;ve++)f[W+ve]=I[ve]}else f.push(I)}}class z{constructor(v,_){this.i=v,this.j=_,this.h=0,this.g=null}get(){let v;return 0<this.h?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function B(f){return/^[\s\xa0]*$/.test(f)}function L(){var f=h.navigator;return f&&(f=f.userAgent)?f:""}function G(f){return G[" "](f),f}G[" "]=function(){};var H=L().indexOf("Gecko")!=-1&&!(L().toLowerCase().indexOf("webkit")!=-1&&L().indexOf("Edge")==-1)&&!(L().indexOf("Trident")!=-1||L().indexOf("MSIE")!=-1)&&L().indexOf("Edge")==-1;function R(f,v,_){for(const I in f)v.call(_,f[I],I,f)}function C(f,v){for(const _ in f)v.call(void 0,f[_],_,f)}function T(f){const v={};for(const _ in f)v[_]=f[_];return v}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(f,v){let _,I;for(let W=1;W<arguments.length;W++){I=arguments[W];for(_ in I)f[_]=I[_];for(let ae=0;ae<A.length;ae++)_=A[ae],Object.prototype.hasOwnProperty.call(I,_)&&(f[_]=I[_])}}function U(f){var v=1;f=f.split(":");const _=[];for(;0<v&&f.length;)_.push(f.shift()),v--;return f.length&&_.push(f.join(":")),_}function $(f){h.setTimeout(()=>{throw f},0)}function M(){var f=pe;let v=null;return f.g&&(v=f.g,f.g=f.g.next,f.g||(f.h=null),v.next=null),v}class ze{constructor(){this.h=this.g=null}add(v,_){const I=se.get();I.set(v,_),this.h?this.h.next=I:this.g=I,this.h=I}}var se=new z(()=>new F,f=>f.reset());class F{constructor(){this.next=this.g=this.h=null}set(v,_){this.h=v,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let ie,K=!1,pe=new ze,j=()=>{const f=h.Promise.resolve(void 0);ie=()=>{f.then(oe)}};var oe=()=>{for(var f;f=M();){try{f.h.call(f.g)}catch(_){$(_)}var v=se;v.j(f),100>v.h&&(v.h++,f.next=v.g,v.g=f)}K=!1};function ge(){this.s=this.s,this.C=this.C}ge.prototype.s=!1,ge.prototype.ma=function(){this.s||(this.s=!0,this.N())},ge.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(f,v){this.type=f,this.g=this.target=v,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var Ae=(function(){if(!h.addEventListener||!Object.defineProperty)return!1;var f=!1,v=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const _=()=>{};h.addEventListener("test",_,v),h.removeEventListener("test",_,v)}catch{}return f})();function we(f,v){if(me.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var _=this.type=f.type,I=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=v,v=f.relatedTarget){if(H){e:{try{G(v.nodeName);var W=!0;break e}catch{}W=!1}W||(v=null)}}else _=="mouseover"?v=f.fromElement:_=="mouseout"&&(v=f.toElement);this.relatedTarget=v,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Ee[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&we.aa.h.call(this)}}V(we,me);var Ee={2:"touch",3:"pen",4:"mouse"};we.prototype.h=function(){we.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var le="closure_listenable_"+(1e6*Math.random()|0),ye=0;function Te(f,v,_,I,W){this.listener=f,this.proxy=null,this.src=v,this.type=_,this.capture=!!I,this.ha=W,this.key=++ye,this.da=this.fa=!1}function Oe(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function nt(f){this.src=f,this.g={},this.h=0}nt.prototype.add=function(f,v,_,I,W){var ae=f.toString();f=this.g[ae],f||(f=this.g[ae]=[],this.h++);var ve=ut(f,v,I,W);return-1<ve?(v=f[ve],_||(v.fa=!1)):(v=new Te(v,this.src,ae,!!I,W),v.fa=_,f.push(v)),v};function He(f,v){var _=v.type;if(_ in f.g){var I=f.g[_],W=Array.prototype.indexOf.call(I,v,void 0),ae;(ae=0<=W)&&Array.prototype.splice.call(I,W,1),ae&&(Oe(v),f.g[_].length==0&&(delete f.g[_],f.h--))}}function ut(f,v,_,I){for(var W=0;W<f.length;++W){var ae=f[W];if(!ae.da&&ae.listener==v&&ae.capture==!!_&&ae.ha==I)return W}return-1}var $e="closure_lm_"+(1e6*Math.random()|0),Qe={};function vt(f,v,_,I,W){if(Array.isArray(v)){for(var ae=0;ae<v.length;ae++)vt(f,v[ae],_,I,W);return null}return _=Oo(_),f&&f[le]?f.K(v,_,p(I)?!!I.capture:!1,W):St(f,v,_,!1,I,W)}function St(f,v,_,I,W,ae){if(!v)throw Error("Invalid event type");var ve=p(W)?!!W.capture:!!W,st=jr(f);if(st||(f[$e]=st=new nt(f)),_=st.add(v,_,I,ve,ae),_.proxy)return _;if(I=Lt(),_.proxy=I,I.src=f,I.listener=_,f.addEventListener)Ae||(W=ve),W===void 0&&(W=!1),f.addEventListener(v.toString(),I,W);else if(f.attachEvent)f.attachEvent($n(v.toString()),I);else if(f.addListener&&f.removeListener)f.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return _}function Lt(){function f(_){return v.call(f.src,f.listener,_)}const v=Ir;return f}function ws(f,v,_,I,W){if(Array.isArray(v))for(var ae=0;ae<v.length;ae++)ws(f,v[ae],_,I,W);else I=p(I)?!!I.capture:!!I,_=Oo(_),f&&f[le]?(f=f.i,v=String(v).toString(),v in f.g&&(ae=f.g[v],_=ut(ae,_,I,W),-1<_&&(Oe(ae[_]),Array.prototype.splice.call(ae,_,1),ae.length==0&&(delete f.g[v],f.h--)))):f&&(f=jr(f))&&(v=f.g[v.toString()],f=-1,v&&(f=ut(v,_,I,W)),(_=-1<f?v[f]:null)&&gn(_))}function gn(f){if(typeof f!="number"&&f&&!f.da){var v=f.src;if(v&&v[le])He(v.i,f);else{var _=f.type,I=f.proxy;v.removeEventListener?v.removeEventListener(_,I,f.capture):v.detachEvent?v.detachEvent($n(_),I):v.addListener&&v.removeListener&&v.removeListener(I),(_=jr(v))?(He(_,f),_.h==0&&(_.src=null,v[$e]=null)):Oe(f)}}}function $n(f){return f in Qe?Qe[f]:Qe[f]="on"+f}function Ir(f,v){if(f.da)f=!0;else{v=new we(v,this);var _=f.listener,I=f.ha||f.src;f.fa&&gn(f),f=_.call(I,v)}return f}function jr(f){return f=f[$e],f instanceof nt?f:null}var Ti="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oo(f){return typeof f=="function"?f:(f[Ti]||(f[Ti]=function(v){return f.handleEvent(v)}),f[Ti])}function qt(){ge.call(this),this.i=new nt(this),this.M=this,this.F=null}V(qt,ge),qt.prototype[le]=!0,qt.prototype.removeEventListener=function(f,v,_,I){ws(this,f,v,_,I)};function ft(f,v){var _,I=f.F;if(I)for(_=[];I;I=I.F)_.push(I);if(f=f.M,I=v.type||v,typeof v=="string")v=new me(v,f);else if(v instanceof me)v.target=v.target||f;else{var W=v;v=new me(I,f),k(v,W)}if(W=!0,_)for(var ae=_.length-1;0<=ae;ae--){var ve=v.g=_[ae];W=os(ve,I,!0,v)&&W}if(ve=v.g=f,W=os(ve,I,!0,v)&&W,W=os(ve,I,!1,v)&&W,_)for(ae=0;ae<_.length;ae++)ve=v.g=_[ae],W=os(ve,I,!1,v)&&W}qt.prototype.N=function(){if(qt.aa.N.call(this),this.i){var f=this.i,v;for(v in f.g){for(var _=f.g[v],I=0;I<_.length;I++)Oe(_[I]);delete f.g[v],f.h--}}this.F=null},qt.prototype.K=function(f,v,_,I){return this.i.add(String(f),v,!1,_,I)},qt.prototype.L=function(f,v,_,I){return this.i.add(String(f),v,!0,_,I)};function os(f,v,_,I){if(v=f.i.g[String(v)],!v)return!0;v=v.concat();for(var W=!0,ae=0;ae<v.length;++ae){var ve=v[ae];if(ve&&!ve.da&&ve.capture==_){var st=ve.listener,on=ve.ha||ve.src;ve.fa&&He(f.i,ve),W=st.call(on,I)!==!1&&W}}return W&&!I.defaultPrevented}function Dn(f,v,_){if(typeof f=="function")_&&(f=w(f,_));else if(f&&typeof f.handleEvent=="function")f=w(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:h.setTimeout(f,v||0)}function Fd(f){f.g=Dn(()=>{f.g=null,f.i&&(f.i=!1,Fd(f))},f.l);const v=f.h;f.h=null,f.m.apply(null,v)}class Qm extends ge{constructor(v,_){super(),this.m=v,this.l=_,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:Fd(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ei(f){ge.call(this),this.h=f,this.g={}}V(Ei,ge);var Si=[];function Ni(f){R(f.g,function(v,_){this.g.hasOwnProperty(_)&&gn(v)},f),f.g={}}Ei.prototype.N=function(){Ei.aa.N.call(this),Ni(this)},Ei.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Us=h.JSON.stringify,Lo=h.JSON.parse,Ai=class{stringify(f){return h.JSON.stringify(f,void 0)}parse(f){return h.JSON.parse(f,void 0)}};function jc(){}jc.prototype.h=null;function Cc(f){return f.h||(f.h=f.i())}function Rc(){}var Cr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Rr(){me.call(this,"d")}V(Rr,me);function kc(){me.call(this,"c")}V(kc,me);var er={},Dc=null;function pa(){return Dc=Dc||new qt}er.La="serverreachability";function Uo(f){me.call(this,er.La,f)}V(Uo,me);function ya(f){const v=pa();ft(v,new Uo(v))}er.STAT_EVENT="statevent";function qd(f,v){me.call(this,er.STAT_EVENT,f),this.stat=v}V(qd,me);function kt(f){const v=pa();ft(v,new qd(v,f))}er.Ma="timingevent";function an(f,v){me.call(this,er.Ma,f),this.size=v}V(an,me);function Jt(f,v){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){f()},v)}function Ts(){this.g=!0}Ts.prototype.xa=function(){this.g=!1};function Pc(f,v,_,I,W,ae){f.info(function(){if(f.g)if(ae)for(var ve="",st=ae.split("&"),on=0;on<st.length;on++){var rt=st[on].split("=");if(1<rt.length){var yn=rt[0];rt=rt[1];var ln=yn.split("_");ve=2<=ln.length&&ln[1]=="type"?ve+(yn+"="+rt+"&"):ve+(yn+"=redacted&")}}else ve=null;else ve=ae;return"XMLHTTP REQ ("+I+") [attempt "+W+"]: "+v+`
`+_+`
`+ve})}function Km(f,v,_,I,W,ae,ve){f.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+W+"]: "+v+`
`+_+`
`+ae+" "+ve})}function xa(f,v,_,I){f.info(function(){return"XMLHTTP TEXT ("+v+"): "+Ii(f,_)+(I?" "+I:"")})}function Bd(f,v){f.info(function(){return"TIMEOUT: "+v})}Ts.prototype.info=function(){};function Ii(f,v){if(!f.g)return v;if(!v)return null;try{var _=JSON.parse(v);if(_){for(f=0;f<_.length;f++)if(Array.isArray(_[f])){var I=_[f];if(!(2>I.length)){var W=I[1];if(Array.isArray(W)&&!(1>W.length)){var ae=W[0];if(ae!="noop"&&ae!="stop"&&ae!="close")for(var ve=1;ve<W.length;ve++)W[ve]=""}}}}return Us(_)}catch{return v}}var va={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},kr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},tr;function nr(){}V(nr,jc),nr.prototype.g=function(){return new XMLHttpRequest},nr.prototype.i=function(){return{}},tr=new nr;function Bn(f,v,_,I){this.j=f,this.i=v,this.l=_,this.R=I||1,this.U=new Ei(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $t}function $t(){this.i=null,this.g="",this.h=!1}var Mc={},Fo={};function Fs(f,v,_){f.L=1,f.v=Di(ls(v)),f.m=_,f.P=!0,Dr(f,null)}function Dr(f,v){f.F=Date.now(),ji(f),f.A=ls(f.v);var _=f.A,I=f.R;Array.isArray(I)||(I=[String(I)]),qc(_.i,"t",I),f.C=0,_=f.j.J,f.h=new $t,f.g=rh(f.j,_?v:null,!f.m),0<f.O&&(f.M=new Qm(w(f.Y,f,f.g),f.O)),v=f.U,_=f.g,I=f.ca;var W="readystatechange";Array.isArray(W)||(W&&(Si[0]=W.toString()),W=Si);for(var ae=0;ae<W.length;ae++){var ve=vt(_,W[ae],I||v.handleEvent,!1,v.h||v);if(!ve)break;v.g[ve.key]=ve}v=f.H?T(f.H):{},f.m?(f.u||(f.u="POST"),v["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,v)):(f.u="GET",f.g.ea(f.A,f.u,null,v)),ya(),Pc(f.i,f.u,f.A,f.l,f.R,f.m)}Bn.prototype.ca=function(f){f=f.target;const v=this.M;v&&As(f)==3?v.j():this.Y(f)},Bn.prototype.Y=function(f){try{if(f==this.g)e:{const ln=As(this.g);var v=this.g.Ba();const qr=this.g.Z();if(!(3>ln)&&(ln!=3||this.g&&(this.h.h||this.g.oa()||Xd(this.g)))){this.J||ln!=4||v==7||(v==8||0>=qr?ya(3):ya(2)),ba(this);var _=this.g.Z();this.X=_;t:if(zd(this)){var I=Xd(this.g);f="";var W=I.length,ae=As(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Nn(this),sr(this);var ve="";break t}this.h.i=new h.TextDecoder}for(v=0;v<W;v++)this.h.h=!0,f+=this.h.i.decode(I[v],{stream:!(ae&&v==W-1)});I.length=0,this.h.g+=f,this.C=0,ve=this.h.g}else ve=this.g.oa();if(this.o=_==200,Km(this.i,this.u,this.A,this.l,this.R,ln,_),this.o){if(this.T&&!this.K){t:{if(this.g){var st,on=this.g;if((st=on.g?on.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(st)){var rt=st;break t}}rt=null}if(_=rt)xa(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ci(this,_);else{this.o=!1,this.s=3,kt(12),Nn(this),sr(this);break e}}if(this.P){_=!0;let An;for(;!this.J&&this.C<ve.length;)if(An=Gd(this,ve),An==Fo){ln==4&&(this.s=4,kt(14),_=!1),xa(this.i,this.l,null,"[Incomplete Response]");break}else if(An==Mc){this.s=4,kt(15),xa(this.i,this.l,ve,"[Invalid Chunk]"),_=!1;break}else xa(this.i,this.l,An,null),Ci(this,An);if(zd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ln!=4||ve.length!=0||this.h.h||(this.s=1,kt(16),_=!1),this.o=this.o&&_,!_)xa(this.i,this.l,ve,"[Invalid Chunked Response]"),Nn(this),sr(this);else if(0<ve.length&&!this.W){this.W=!0;var yn=this.j;yn.g==this&&yn.ba&&!yn.M&&(yn.j.info("Great, no buffering proxy detected. Bytes received: "+ve.length),qi(yn),yn.M=!0,kt(11))}}else xa(this.i,this.l,ve,null),Ci(this,ve);ln==4&&Nn(this),this.o&&!this.J&&(ln==4?th(this.j,this):(this.o=!1,ji(this)))}else Zm(this.g),_==400&&0<ve.indexOf("Unknown SID")?(this.s=3,kt(12)):(this.s=0,kt(13)),Nn(this),sr(this)}}}catch{}finally{}};function zd(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function Gd(f,v){var _=f.C,I=v.indexOf(`
`,_);return I==-1?Fo:(_=Number(v.substring(_,I)),isNaN(_)?Mc:(I+=1,I+_>v.length?Fo:(v=v.slice(I,I+_),f.C=I+_,v)))}Bn.prototype.cancel=function(){this.J=!0,Nn(this)};function ji(f){f.S=Date.now()+f.I,Hd(f,f.I)}function Hd(f,v){if(f.B!=null)throw Error("WatchDog timer not null");f.B=Jt(w(f.ba,f),v)}function ba(f){f.B&&(h.clearTimeout(f.B),f.B=null)}Bn.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(Bd(this.i,this.A),this.L!=2&&(ya(),kt(17)),Nn(this),this.s=2,sr(this)):Hd(this,this.S-f)};function sr(f){f.j.G==0||f.J||th(f.j,f)}function Nn(f){ba(f);var v=f.M;v&&typeof v.ma=="function"&&v.ma(),f.M=null,Ni(f.U),f.g&&(v=f.g,f.g=null,v.abort(),v.ma())}function Ci(f,v){try{var _=f.j;if(_.G!=0&&(_.g==f||Vc(_.h,f))){if(!f.K&&Vc(_.h,f)&&_.G==3){try{var I=_.Da.g.parse(v)}catch{I=null}if(Array.isArray(I)&&I.length==3){var W=I;if(W[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<f.F)Jo(_),Xo(_);else break e;$c(_),kt(18)}}else _.za=W[1],0<_.za-_.T&&37500>W[2]&&_.F&&_.v==0&&!_.C&&(_.C=Jt(w(_.Za,_),6e3));if(1>=Bo(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else Fr(_,11)}else if((f.K||_.g==f)&&Jo(_),!B(v))for(W=_.Da.g.parse(v),v=0;v<W.length;v++){let rt=W[v];if(_.T=rt[0],rt=rt[1],_.G==2)if(rt[0]=="c"){_.K=rt[1],_.ia=rt[2];const yn=rt[3];yn!=null&&(_.la=yn,_.j.info("VER="+_.la));const ln=rt[4];ln!=null&&(_.Aa=ln,_.j.info("SVER="+_.Aa));const qr=rt[5];qr!=null&&typeof qr=="number"&&0<qr&&(I=1.5*qr,_.L=I,_.j.info("backChannelRequestTimeoutMs_="+I)),I=_;const An=f.g;if(An){const ur=An.g?An.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ur){var ae=I.h;ae.g||ur.indexOf("spdy")==-1&&ur.indexOf("quic")==-1&&ur.indexOf("h2")==-1||(ae.j=ae.l,ae.g=new Set,ae.h&&(zo(ae,ae.h),ae.h=null))}if(I.D){const Kc=An.g?An.g.getResponseHeader("X-HTTP-Session-Id"):null;Kc&&(I.ya=Kc,bt(I.I,I.D,Kc))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-f.F,_.j.info("Handshake RTT: "+_.R+"ms")),I=_;var ve=f;if(I.qa=sh(I,I.J?I.ia:null,I.W),ve.K){zn(I.h,ve);var st=ve,on=I.L;on&&(st.I=on),st.B&&(ba(st),ji(st)),I.g=ve}else Zd(I);0<_.i.length&&Wo(_)}else rt[0]!="stop"&&rt[0]!="close"||Fr(_,7);else _.G==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?Fr(_,7):Gc(_):rt[0]!="noop"&&_.l&&_.l.ta(rt),_.v=0)}}ya(4)}catch{}}var $d=class{constructor(f,v){this.g=f,this.map=v}};function Pr(f){this.l=f||10,h.PerformanceNavigationTiming?(f=h.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(h.chrome&&h.chrome.loadTimes&&h.chrome.loadTimes()&&h.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function qo(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function Bo(f){return f.h?1:f.g?f.g.size:0}function Vc(f,v){return f.h?f.h==v:f.g?f.g.has(v):!1}function zo(f,v){f.g?f.g.add(v):f.h=v}function zn(f,v){f.h&&f.h==v?f.h=null:f.g&&f.g.has(v)&&f.g.delete(v)}Pr.prototype.cancel=function(){if(this.i=Oc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Oc(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let v=f.i;for(const _ of f.g.values())v=v.concat(_.D);return v}return D(f.i)}function Ym(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(m(f)){for(var v=[],_=f.length,I=0;I<_;I++)v.push(f[I]);return v}v=[],_=0;for(I in f)v[_++]=f[I];return v}function Go(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(m(f)||typeof f=="string"){var v=[];f=f.length;for(var _=0;_<f;_++)v.push(_);return v}v=[],_=0;for(const I in f)v[_++]=I;return v}}}function Lc(f,v){if(f.forEach&&typeof f.forEach=="function")f.forEach(v,void 0);else if(m(f)||typeof f=="string")Array.prototype.forEach.call(f,v,void 0);else for(var _=Go(f),I=Ym(f),W=I.length,ae=0;ae<W;ae++)v.call(void 0,I[ae],_&&_[ae],f)}var Ri=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xm(f,v){if(f){f=f.split("&");for(var _=0;_<f.length;_++){var I=f[_].indexOf("="),W=null;if(0<=I){var ae=f[_].substring(0,I);W=f[_].substring(I+1)}else ae=f[_];v(ae,W?decodeURIComponent(W.replace(/\+/g," ")):"")}}}function Zt(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof Zt){this.h=f.h,ki(this,f.j),this.o=f.o,this.g=f.g,_a(this,f.s),this.l=f.l;var v=f.i,_=new Vr;_.i=v.i,v.g&&(_.g=new Map(v.g),_.h=v.h),Mr(this,_),this.m=f.m}else f&&(v=String(f).match(Ri))?(this.h=!1,ki(this,v[1]||"",!0),this.o=Es(v[2]||""),this.g=Es(v[3]||"",!0),_a(this,v[4]),this.l=Es(v[5]||"",!0),Mr(this,v[6]||"",!0),this.m=Es(v[7]||"")):(this.h=!1,this.i=new Vr(null,this.h))}Zt.prototype.toString=function(){var f=[],v=this.j;v&&f.push(Pi(v,Uc,!0),":");var _=this.g;return(_||v=="file")&&(f.push("//"),(v=this.o)&&f.push(Pi(v,Uc,!0),"@"),f.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&f.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&f.push("/"),f.push(Pi(_,_.charAt(0)=="/"?Wm:Fc,!0))),(_=this.i.toString())&&f.push("?",_),(_=this.m)&&f.push("#",Pi(_,Ho)),f.join("")};function ls(f){return new Zt(f)}function ki(f,v,_){f.j=_?Es(v,!0):v,f.j&&(f.j=f.j.replace(/:$/,""))}function _a(f,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);f.s=v}else f.s=null}function Mr(f,v,_){v instanceof Vr?(f.i=v,Kd(f.i,f.h)):(_||(v=Pi(v,Jm)),f.i=new Vr(v,f.h))}function bt(f,v,_){f.i.set(v,_)}function Di(f){return bt(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Es(f,v){return f?v?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function Pi(f,v,_){return typeof f=="string"?(f=encodeURI(f).replace(v,Qd),_&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function Qd(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Uc=/[#\/\?@]/g,Fc=/[#\?:]/g,Wm=/[#\?]/g,Jm=/[#\?@]/g,Ho=/#/g;function Vr(f,v){this.h=this.g=null,this.i=f||null,this.j=!!v}function Ss(f){f.g||(f.g=new Map,f.h=0,f.i&&Xm(f.i,function(v,_){f.add(decodeURIComponent(v.replace(/\+/g," ")),_)}))}s=Vr.prototype,s.add=function(f,v){Ss(this),this.i=null,f=rr(this,f);var _=this.g.get(f);return _||this.g.set(f,_=[]),_.push(v),this.h+=1,this};function Or(f,v){Ss(f),v=rr(f,v),f.g.has(v)&&(f.i=null,f.h-=f.g.get(v).length,f.g.delete(v))}function Lr(f,v){return Ss(f),v=rr(f,v),f.g.has(v)}s.forEach=function(f,v){Ss(this),this.g.forEach(function(_,I){_.forEach(function(W){f.call(v,W,I,this)},this)},this)},s.na=function(){Ss(this);const f=Array.from(this.g.values()),v=Array.from(this.g.keys()),_=[];for(let I=0;I<v.length;I++){const W=f[I];for(let ae=0;ae<W.length;ae++)_.push(v[I])}return _},s.V=function(f){Ss(this);let v=[];if(typeof f=="string")Lr(this,f)&&(v=v.concat(this.g.get(rr(this,f))));else{f=Array.from(this.g.values());for(let _=0;_<f.length;_++)v=v.concat(f[_])}return v},s.set=function(f,v){return Ss(this),this.i=null,f=rr(this,f),Lr(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[v]),this.h+=1,this},s.get=function(f,v){return f?(f=this.V(f),0<f.length?String(f[0]):v):v};function qc(f,v,_){Or(f,v),0<_.length&&(f.i=null,f.g.set(rr(f,v),D(_)),f.h+=_.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],v=Array.from(this.g.keys());for(var _=0;_<v.length;_++){var I=v[_];const ae=encodeURIComponent(String(I)),ve=this.V(I);for(I=0;I<ve.length;I++){var W=ae;ve[I]!==""&&(W+="="+encodeURIComponent(String(ve[I]))),f.push(W)}}return this.i=f.join("&")};function rr(f,v){return v=String(v),f.j&&(v=v.toLowerCase()),v}function Kd(f,v){v&&!f.j&&(Ss(f),f.i=null,f.g.forEach(function(_,I){var W=I.toLowerCase();I!=W&&(Or(this,I),qc(this,W,_))},f)),f.j=v}function Mi(f,v){const _=new Ts;if(h.Image){const I=new Image;I.onload=N(Ns,_,"TestLoadImage: loaded",!0,v,I),I.onerror=N(Ns,_,"TestLoadImage: error",!1,v,I),I.onabort=N(Ns,_,"TestLoadImage: abort",!1,v,I),I.ontimeout=N(Ns,_,"TestLoadImage: timeout",!1,v,I),h.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=f}else v(!1)}function qs(f,v){const _=new Ts,I=new AbortController,W=setTimeout(()=>{I.abort(),Ns(_,"TestPingServer: timeout",!1,v)},1e4);fetch(f,{signal:I.signal}).then(ae=>{clearTimeout(W),ae.ok?Ns(_,"TestPingServer: ok",!0,v):Ns(_,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(W),Ns(_,"TestPingServer: error",!1,v)})}function Ns(f,v,_,I,W){try{W&&(W.onload=null,W.onerror=null,W.onabort=null,W.ontimeout=null),I(_)}catch{}}function Vi(){this.g=new Ai}function ar(f,v,_){const I=_||"";try{Lc(f,function(W,ae){let ve=W;p(W)&&(ve=Us(W)),v.push(I+ae+"="+encodeURIComponent(ve))})}catch(W){throw v.push(I+"type="+encodeURIComponent("_badmap")),W}}function wa(f){this.l=f.Ub||null,this.j=f.eb||!1}V(wa,jc),wa.prototype.g=function(){return new Ur(this.l,this.j)},wa.prototype.i=(function(f){return function(){return f}})({});function Ur(f,v){qt.call(this),this.D=f,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(Ur,qt),s=Ur.prototype,s.open=function(f,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=v,this.readyState=1,or(this)},s.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const v={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(v.body=f),(this.D||h).fetch(new Request(this.A,v)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ir(this)),this.readyState=0},s.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,or(this)),this.g&&(this.readyState=3,or(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof h.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bc(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function Bc(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}s.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var v=f.value?f.value:new Uint8Array(0);(v=this.v.decode(v,{stream:!f.done}))&&(this.response=this.responseText+=v)}f.done?ir(this):or(this),this.readyState==3&&Bc(this)}},s.Ra=function(f){this.g&&(this.response=this.responseText=f,ir(this))},s.Qa=function(f){this.g&&(this.response=f,ir(this))},s.ga=function(){this.g&&ir(this)};function ir(f){f.readyState=4,f.l=null,f.j=null,f.v=null,or(f)}s.setRequestHeader=function(f,v){this.u.append(f,v)},s.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],v=this.h.entries();for(var _=v.next();!_.done;)_=_.value,f.push(_[0]+": "+_[1]),_=v.next();return f.join(`\r
`)};function or(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Ur.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function zc(f){let v="";return R(f,function(_,I){v+=I,v+=":",v+=_,v+=`\r
`}),v}function pn(f,v,_){e:{for(I in _){var I=!1;break e}I=!0}I||(_=zc(_),typeof f=="string"?_!=null&&encodeURIComponent(String(_)):bt(f,v,_))}function dt(f){qt.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(dt,qt);var $o=/^https?$/i,Oi=["POST","PUT"];s=dt.prototype,s.Ha=function(f){this.J=f},s.ea=function(f,v,_,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);v=v?v.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():tr.g(),this.v=this.o?Cc(this.o):Cc(tr),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(v,String(f),!0),this.B=!1}catch(ae){Yd(this,ae);return}if(f=_||"",_=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var W in I)_.set(W,I[W]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const ae of I.keys())_.set(ae,I.get(ae));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(_.keys()).find(ae=>ae.toLowerCase()=="content-type"),W=h.FormData&&f instanceof h.FormData,!(0<=Array.prototype.indexOf.call(Oi,v,void 0))||I||W||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ae,ve]of _)this.g.setRequestHeader(ae,ve);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Li(this),this.u=!0,this.g.send(f),this.u=!1}catch(ae){Yd(this,ae)}};function Yd(f,v){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=v,f.m=5,Qo(f),lr(f)}function Qo(f){f.A||(f.A=!0,ft(f,"complete"),ft(f,"error"))}s.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,ft(this,"complete"),ft(this,"abort"),lr(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),lr(this,!0)),dt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Ko(this):this.bb())},s.bb=function(){Ko(this)};function Ko(f){if(f.h&&typeof u<"u"&&(!f.v[1]||As(f)!=4||f.Z()!=2)){if(f.u&&As(f)==4)Dn(f.Ea,0,f);else if(ft(f,"readystatechange"),As(f)==4){f.h=!1;try{const ve=f.Z();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var _;if(!(_=v)){var I;if(I=ve===0){var W=String(f.D).match(Ri)[1]||null;!W&&h.self&&h.self.location&&(W=h.self.location.protocol.slice(0,-1)),I=!$o.test(W?W.toLowerCase():"")}_=I}if(_)ft(f,"complete"),ft(f,"success");else{f.m=6;try{var ae=2<As(f)?f.g.statusText:""}catch{ae=""}f.l=ae+" ["+f.Z()+"]",Qo(f)}}finally{lr(f)}}}}function lr(f,v){if(f.g){Li(f);const _=f.g,I=f.v[0]?()=>{}:null;f.g=null,f.v=null,v||ft(f,"ready");try{_.onreadystatechange=I}catch{}}}function Li(f){f.I&&(h.clearTimeout(f.I),f.I=null)}s.isActive=function(){return!!this.g};function As(f){return f.g?f.g.readyState:0}s.Z=function(){try{return 2<As(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(f){if(this.g){var v=this.g.responseText;return f&&v.indexOf(f)==0&&(v=v.substring(f.length)),Lo(v)}};function Xd(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Zm(f){const v={};f=(f.g&&2<=As(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<f.length;I++){if(B(f[I]))continue;var _=U(f[I]);const W=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const ae=v[W]||[];v[W]=ae,ae.push(_)}C(v,function(I){return I.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ui(f,v,_){return _&&_.internalChannelParams&&_.internalChannelParams[f]||v}function Yo(f){this.Aa=0,this.i=[],this.j=new Ts,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ui("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ui("baseRetryDelayMs",5e3,f),this.cb=Ui("retryDelaySeedMs",1e4,f),this.Wa=Ui("forwardChannelMaxRetries",2,f),this.wa=Ui("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new Pr(f&&f.concurrentRequestLimit),this.Da=new Vi,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Yo.prototype,s.la=8,s.G=1,s.connect=function(f,v,_,I){kt(0),this.W=f,this.H=v||{},_&&I!==void 0&&(this.H.OSID=_,this.H.OAID=I),this.F=this.X,this.I=sh(this,null,this.W),Wo(this)};function Gc(f){if(Wd(f),f.G==3){var v=f.U++,_=ls(f.I);if(bt(_,"SID",f.K),bt(_,"RID",v),bt(_,"TYPE","terminate"),Fi(f,_),v=new Bn(f,f.j,v),v.L=2,v.v=Di(ls(_)),_=!1,h.navigator&&h.navigator.sendBeacon)try{_=h.navigator.sendBeacon(v.v.toString(),"")}catch{}!_&&h.Image&&(new Image().src=v.v,_=!0),_||(v.g=rh(v.j,null),v.g.ea(v.v)),v.F=Date.now(),ji(v)}nh(f)}function Xo(f){f.g&&(qi(f),f.g.cancel(),f.g=null)}function Wd(f){Xo(f),f.u&&(h.clearTimeout(f.u),f.u=null),Jo(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&h.clearTimeout(f.s),f.s=null)}function Wo(f){if(!qo(f.h)&&!f.s){f.s=!0;var v=f.Ga;ie||j(),K||(ie(),K=!0),pe.add(v,f),f.B=0}}function eg(f,v){return Bo(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=v.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=Jt(w(f.Ga,f,v),Qc(f,f.B)),f.B++,!0)}s.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const W=new Bn(this,this.j,f);let ae=this.o;if(this.S&&(ae?(ae=T(ae),k(ae,this.S)):ae=this.S),this.m!==null||this.O||(W.H=ae,ae=null),this.P)e:{for(var v=0,_=0;_<this.i.length;_++){t:{var I=this.i[_];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(v+=I,4096<v){v=_;break e}if(v===4096||_===this.i.length-1){v=_+1;break e}}v=1e3}else v=1e3;v=Jd(this,W,v),_=ls(this.I),bt(_,"RID",f),bt(_,"CVER",22),this.D&&bt(_,"X-HTTP-Session-Id",this.D),Fi(this,_),ae&&(this.O?v="headers="+encodeURIComponent(String(zc(ae)))+"&"+v:this.m&&pn(_,this.m,ae)),zo(this.h,W),this.Ua&&bt(_,"TYPE","init"),this.P?(bt(_,"$req",v),bt(_,"SID","null"),W.T=!0,Fs(W,_,null)):Fs(W,_,v),this.G=2}}else this.G==3&&(f?Hc(this,f):this.i.length==0||qo(this.h)||Hc(this))};function Hc(f,v){var _;v?_=v.l:_=f.U++;const I=ls(f.I);bt(I,"SID",f.K),bt(I,"RID",_),bt(I,"AID",f.T),Fi(f,I),f.m&&f.o&&pn(I,f.m,f.o),_=new Bn(f,f.j,_,f.B+1),f.m===null&&(_.H=f.o),v&&(f.i=v.D.concat(f.i)),v=Jd(f,_,1e3),_.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),zo(f.h,_),Fs(_,I,v)}function Fi(f,v){f.H&&R(f.H,function(_,I){bt(v,I,_)}),f.l&&Lc({},function(_,I){bt(v,I,_)})}function Jd(f,v,_){_=Math.min(f.i.length,_);var I=f.l?w(f.l.Na,f.l,f):null;e:{var W=f.i;let ae=-1;for(;;){const ve=["count="+_];ae==-1?0<_?(ae=W[0].g,ve.push("ofs="+ae)):ae=0:ve.push("ofs="+ae);let st=!0;for(let on=0;on<_;on++){let rt=W[on].g;const yn=W[on].map;if(rt-=ae,0>rt)ae=Math.max(0,W[on].g-100),st=!1;else try{ar(yn,ve,"req"+rt+"_")}catch{I&&I(yn)}}if(st){I=ve.join("&");break e}}}return f=f.i.splice(0,_),v.D=f,I}function Zd(f){if(!f.g&&!f.u){f.Y=1;var v=f.Fa;ie||j(),K||(ie(),K=!0),pe.add(v,f),f.v=0}}function $c(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=Jt(w(f.Fa,f),Qc(f,f.v)),f.v++,!0)}s.Fa=function(){if(this.u=null,eh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=Jt(w(this.ab,this),f)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,kt(10),Xo(this),eh(this))};function qi(f){f.A!=null&&(h.clearTimeout(f.A),f.A=null)}function eh(f){f.g=new Bn(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var v=ls(f.qa);bt(v,"RID","rpc"),bt(v,"SID",f.K),bt(v,"AID",f.T),bt(v,"CI",f.F?"0":"1"),!f.F&&f.ja&&bt(v,"TO",f.ja),bt(v,"TYPE","xmlhttp"),Fi(f,v),f.m&&f.o&&pn(v,f.m,f.o),f.L&&(f.g.I=f.L);var _=f.g;f=f.ia,_.L=1,_.v=Di(ls(v)),_.m=null,_.P=!0,Dr(_,f)}s.Za=function(){this.C!=null&&(this.C=null,Xo(this),$c(this),kt(19))};function Jo(f){f.C!=null&&(h.clearTimeout(f.C),f.C=null)}function th(f,v){var _=null;if(f.g==v){Jo(f),qi(f),f.g=null;var I=2}else if(Vc(f.h,v))_=v.D,zn(f.h,v),I=1;else return;if(f.G!=0){if(v.o)if(I==1){_=v.m?v.m.length:0,v=Date.now()-v.F;var W=f.B;I=pa(),ft(I,new an(I,_)),Wo(f)}else Zd(f);else if(W=v.s,W==3||W==0&&0<v.X||!(I==1&&eg(f,v)||I==2&&$c(f)))switch(_&&0<_.length&&(v=f.h,v.i=v.i.concat(_)),W){case 1:Fr(f,5);break;case 4:Fr(f,10);break;case 3:Fr(f,6);break;default:Fr(f,2)}}}function Qc(f,v){let _=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(_*=2),_*v}function Fr(f,v){if(f.j.info("Error code "+v),v==2){var _=w(f.fb,f),I=f.Xa;const W=!I;I=new Zt(I||"//www.google.com/images/cleardot.gif"),h.location&&h.location.protocol=="http"||ki(I,"https"),Di(I),W?Mi(I.toString(),_):qs(I.toString(),_)}else kt(2);f.G=0,f.l&&f.l.sa(v),nh(f),Wd(f)}s.fb=function(f){f?(this.j.info("Successfully pinged google.com"),kt(2)):(this.j.info("Failed to ping google.com"),kt(1))};function nh(f){if(f.G=0,f.ka=[],f.l){const v=Oc(f.h);(v.length!=0||f.i.length!=0)&&(q(f.ka,v),q(f.ka,f.i),f.h.i.length=0,D(f.i),f.i.length=0),f.l.ra()}}function sh(f,v,_){var I=_ instanceof Zt?ls(_):new Zt(_);if(I.g!="")v&&(I.g=v+"."+I.g),_a(I,I.s);else{var W=h.location;I=W.protocol,v=v?v+"."+W.hostname:W.hostname,W=+W.port;var ae=new Zt(null);I&&ki(ae,I),v&&(ae.g=v),W&&_a(ae,W),_&&(ae.l=_),I=ae}return _=f.D,v=f.ya,_&&v&&bt(I,_,v),bt(I,"VER",f.la),Fi(f,I),I}function rh(f,v,_){if(v&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return v=f.Ca&&!f.pa?new dt(new wa({eb:_})):new dt(f.pa),v.Ha(f.J),v}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function ah(){}s=ah.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Zo(){}Zo.prototype.g=function(f,v){return new Gn(f,v)};function Gn(f,v){qt.call(this),this.g=new Yo(v),this.l=f,this.h=v&&v.messageUrlParams||null,f=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(f?f["X-WebChannel-Content-Type"]=v.messageContentType:f={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.va&&(f?f["X-WebChannel-Client-Profile"]=v.va:f={"X-WebChannel-Client-Profile":v.va}),this.g.S=f,(f=v&&v.Sb)&&!B(f)&&(this.g.m=f),this.v=v&&v.supportsCrossDomainXhr||!1,this.u=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!B(v)&&(this.g.D=v,f=this.h,f!==null&&v in f&&(f=this.h,v in f&&delete f[v])),this.j=new cr(this)}V(Gn,qt),Gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Gn.prototype.close=function(){Gc(this.g)},Gn.prototype.o=function(f){var v=this.g;if(typeof f=="string"){var _={};_.__data__=f,f=_}else this.u&&(_={},_.__data__=Us(f),f=_);v.i.push(new $d(v.Ya++,f)),v.G==3&&Wo(v)},Gn.prototype.N=function(){this.g.l=null,delete this.j,Gc(this.g),delete this.g,Gn.aa.N.call(this)};function ih(f){Rr.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var v=f.__sm__;if(v){e:{for(const _ in v){f=_;break e}f=void 0}(this.i=f)&&(f=this.i,v=v!==null&&f in v?v[f]:void 0),this.data=v}else this.data=f}V(ih,Rr);function oh(){kc.call(this),this.status=1}V(oh,kc);function cr(f){this.g=f}V(cr,ah),cr.prototype.ua=function(){ft(this.g,"a")},cr.prototype.ta=function(f){ft(this.g,new ih(f))},cr.prototype.sa=function(f){ft(this.g,new oh)},cr.prototype.ra=function(){ft(this.g,"b")},Zo.prototype.createWebChannel=Zo.prototype.g,Gn.prototype.send=Gn.prototype.o,Gn.prototype.open=Gn.prototype.m,Gn.prototype.close=Gn.prototype.close,mS=function(){return new Zo},fS=function(){return pa()},hS=er,Ey={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},va.NO_ERROR=0,va.TIMEOUT=8,va.HTTP_ERROR=6,Ef=va,kr.COMPLETE="complete",dS=kr,Rc.EventType=Cr,Cr.OPEN="a",Cr.CLOSE="b",Cr.ERROR="c",Cr.MESSAGE="d",qt.prototype.listen=qt.prototype.K,qu=Rc,dt.prototype.listenOnce=dt.prototype.L,dt.prototype.getLastError=dt.prototype.Ka,dt.prototype.getLastErrorCode=dt.prototype.Ba,dt.prototype.getStatus=dt.prototype.Z,dt.prototype.getResponseJson=dt.prototype.Oa,dt.prototype.getResponseText=dt.prototype.oa,dt.prototype.send=dt.prototype.ea,dt.prototype.setWithCredentials=dt.prototype.Ha,uS=dt}).apply(typeof uf<"u"?uf:typeof self<"u"?self:typeof window<"u"?window:{});const Sw="@firebase/firestore",Nw="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Tn.UNAUTHENTICATED=new Tn(null),Tn.GOOGLE_CREDENTIALS=new Tn("google-credentials-uid"),Tn.FIRST_PARTY=new Tn("first-party-uid"),Tn.MOCK_USER=new Tn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yc="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii=new hm("@firebase/firestore");function Vl(){return ii.logLevel}function Q2(s){ii.setLogLevel(s)}function fe(s,...e){if(ii.logLevel<=et.DEBUG){const t=e.map(yx);ii.debug(`Firestore (${yc}): ${s}`,...t)}}function Xt(s,...e){if(ii.logLevel<=et.ERROR){const t=e.map(yx);ii.error(`Firestore (${yc}): ${s}`,...t)}}function bs(s,...e){if(ii.logLevel<=et.WARN){const t=e.map(yx);ii.warn(`Firestore (${yc}): ${s}`,...t)}}function yx(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(s,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,gS(s,n,t)}function gS(s,e,t){let n=`FIRESTORE (${yc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${s.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw Xt(n),new Error(n)}function je(s,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,s||gS(e,i,n)}function K2(s,e){s||Se(57014,e)}function _e(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ue extends Zs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Tn.UNAUTHENTICATED)))}shutdown(){}}class Y2{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class X2{constructor(e){this.t=e,this.currentUser=Tn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){je(this.o===void 0,42304);let n=this.i;const i=m=>this.i!==n?(n=this.i,t(m)):Promise.resolve();let l=new En;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new En,e.enqueueRetryable((()=>i(this.currentUser)))};const u=()=>{const m=l;e.enqueueRetryable((async()=>{await m.promise,await i(this.currentUser)}))},h=m=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((m=>h(m))),setTimeout((()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?h(m):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new En)}}),0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(je(typeof n.accessToken=="string",31837,{l:n}),new pS(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return je(e===null||typeof e=="string",2055,{h:e}),new Tn(e)}}class W2{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Tn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class J2{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new W2(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Tn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Sy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Z2{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,xs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){je(this.o===void 0,3512);const n=l=>{l.error!=null&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.m;return this.m=l.token,fe("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>n(l)))};const i=l=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>i(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?i(l):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Sy(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(je(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Sy(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class ek{getToken(){return Promise.resolve(new Sy(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tk(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=tk(40);for(let l=0;l<i.length;++l)n.length<20&&i[l]<t&&(n+=e.charAt(i[l]%62))}return n}}function Ve(s,e){return s<e?-1:s>e?1:0}function Ny(s,e){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++){const i=s.charAt(n),l=e.charAt(n);if(i!==l)return ry(i)===ry(l)?Ve(i,l):ry(i)?1:-1}return Ve(s.length,e.length)}const nk=55296,sk=57343;function ry(s){const e=s.charCodeAt(0);return e>=nk&&e<=sk}function Ql(s,e,t){return s.length===e.length&&s.every(((n,i)=>t(n,e[i])))}function xS(s){return s+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay="__name__";class pr{constructor(e,t,n){t===void 0?t=0:t>e.length&&Se(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Se(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return pr.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof pr?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const l=pr.compareSegments(e.get(i),t.get(i));if(l!==0)return l}return Ve(e.length,t.length)}static compareSegments(e,t){const n=pr.isNumericId(e),i=pr.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?pr.extractNumericId(e).compare(pr.extractNumericId(t)):Ny(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ri.fromString(e.substring(4,e.length-2))}}class Xe extends pr{construct(e,t,n){return new Xe(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new ue(ee.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((i=>i.length>0)))}return new Xe(t)}static emptyPath(){return new Xe([])}}const rk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rt extends pr{construct(e,t,n){return new Rt(e,t,n)}static isValidIdentifier(e){return rk.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ay}static keyField(){return new Rt([Ay])}static fromServerFormat(e){const t=[];let n="",i=0;const l=()=>{if(n.length===0)throw new ue(ee.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let u=!1;for(;i<e.length;){const h=e[i];if(h==="\\"){if(i+1===e.length)throw new ue(ee.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[i+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new ue(ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=m,i+=2}else h==="`"?(u=!u,i++):h!=="."||u?(n+=h,i++):(l(),i++)}if(l(),u)throw new ue(ee.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rt(t)}static emptyPath(){return new Rt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.path=e}static fromPath(e){return new be(Xe.fromString(e))}static fromName(e){return new be(Xe.fromString(e).popFirst(5))}static empty(){return new be(Xe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Xe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Xe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new be(new Xe(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xx(s,e,t){if(!t)throw new ue(ee.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function vS(s,e,t,n){if(e===!0&&n===!0)throw new ue(ee.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function Aw(s){if(!be.isDocumentKey(s))throw new ue(ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Iw(s){if(be.isDocumentKey(s))throw new ue(ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function bS(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}function xm(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":Se(12329,{type:typeof s})}function We(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new ue(ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=xm(s);throw new ue(ee.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}function _S(s,e){if(e<=0)throw new ue(ee.INVALID_ARGUMENT,`Function ${s}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rn(s,e){const t={typeString:s};return e&&(t.value=e),t}function ko(s,e){if(!bS(s))throw new ue(ee.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const i=e[n].typeString,l="value"in e[n]?{value:e[n].value}:void 0;if(!(n in s)){t=`JSON missing required field: '${n}'`;break}const u=s[n];if(i&&typeof u!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(l!==void 0&&u!==l.value){t=`Expected '${n}' field to equal '${l.value}'`;break}}if(t)throw new ue(ee.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jw=-62135596800,Cw=1e6;class ht{static now(){return ht.fromMillis(Date.now())}static fromDate(e){return ht.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Cw);return new ht(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ue(ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ue(ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<jw)throw new ue(ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ue(ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Cw}_compareTo(e){return this.seconds===e.seconds?Ve(this.nanoseconds,e.nanoseconds):Ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ht._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ko(e,ht._jsonSchema))return new ht(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-jw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ht._jsonSchemaVersion="firestore/timestamp/1.0",ht._jsonSchema={type:rn("string",ht._jsonSchemaVersion),seconds:rn("number"),nanoseconds:rn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{static fromTimestamp(e){return new Ce(e)}static min(){return new Ce(new ht(0,0))}static max(){return new Ce(new ht(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kl=-1;class Yl{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Iy(s){return s.fields.find((e=>e.kind===2))}function ao(s){return s.fields.filter((e=>e.kind!==2))}function ak(s,e){let t=Ve(s.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let n=0;n<Math.min(s.fields.length,e.fields.length);++n)if(t=ik(s.fields[n],e.fields[n]),t!==0)return t;return Ve(s.fields.length,e.fields.length)}Yl.UNKNOWN_ID=-1;class go{constructor(e,t){this.fieldPath=e,this.kind=t}}function ik(s,e){const t=Rt.comparator(s.fieldPath,e.fieldPath);return t!==0?t:Ve(s.kind,e.kind)}class Xl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Xl(0,_s.min())}}function wS(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,i=Ce.fromTimestamp(n===1e9?new ht(t+1,0):new ht(t,n));return new _s(i,be.empty(),e)}function TS(s){return new _s(s.readTime,s.key,Kl)}class _s{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new _s(Ce.min(),be.empty(),Kl)}static max(){return new _s(Ce.max(),be.empty(),Kl)}}function vx(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=be.comparator(s.documentKey,e.documentKey),t!==0?t:Ve(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ES="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class SS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gi(s){if(s.code!==ee.FAILED_PRECONDITION||s.message!==ES)throw s;fe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Se(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new X(((n,i)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(n,i)},this.catchCallback=l=>{this.wrapFailure(t,l).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof X?t:X.resolve(t)}catch(t){return X.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):X.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):X.reject(t)}static resolve(e){return new X(((t,n)=>{t(e)}))}static reject(e){return new X(((t,n)=>{n(e)}))}static waitFor(e){return new X(((t,n)=>{let i=0,l=0,u=!1;e.forEach((h=>{++i,h.next((()=>{++l,u&&l===i&&t()}),(m=>n(m)))})),u=!0,l===i&&t()}))}static or(e){let t=X.resolve(!1);for(const n of e)t=t.next((i=>i?X.resolve(i):n()));return t}static forEach(e,t){const n=[];return e.forEach(((i,l)=>{n.push(t.call(this,i,l))})),this.waitFor(n)}static mapArray(e,t){return new X(((n,i)=>{const l=e.length,u=new Array(l);let h=0;for(let m=0;m<l;m++){const p=m;t(e[p]).next((x=>{u[p]=x,++h,h===l&&n(u)}),(x=>i(x)))}}))}static doWhile(e,t){return new X(((n,i)=>{const l=()=>{e()===!0?t().next((()=>{l()}),i):n()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ps="SimpleDb";class vm{static open(e,t,n,i){try{return new vm(t,e.transaction(i,n))}catch(l){throw new Ku(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new En,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Ku(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const i=bx(n.target.error);this.S.reject(new Ku(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(fe(ps,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new lk(t)}}class wr{static delete(e){return fe(ps,"Removing database:",e),oo(fE().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!ax())return!1;if(wr.F())return!0;const e=hn(),t=wr.M(e),n=0<t&&t<10,i=NS(e),l=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||l)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,wr.M(hn())===12.2&&Xt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(fe(ps,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=l=>{const u=l.target.result;t(u)},i.onblocked=()=>{n(new Ku(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=l=>{const u=l.target.error;u.name==="VersionError"?n(new ue(ee.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):u.name==="InvalidStateError"?n(new ue(ee.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u)):n(new Ku(e,u))},i.onupgradeneeded=l=>{fe(ps,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const u=l.target.result;this.N.k(u,i.transaction,l.oldVersion,this.version).next((()=>{fe(ps,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,i){const l=t==="readonly";let u=0;for(;;){++u;try{this.db=await this.L(e);const h=vm.open(this.db,e,l?"readonly":"readwrite",n),m=i(h).next((p=>(h.C(),p))).catch((p=>(h.abort(p),X.reject(p)))).toPromise();return m.catch((()=>{})),await h.D,m}catch(h){const m=h,p=m.name!=="FirebaseError"&&u<3;if(fe(ps,"Transaction failed with error:",m.message,"Retrying:",p),this.close(),!p)return Promise.reject(m)}}}close(){this.db&&this.db.close(),this.db=void 0}}function NS(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class ok{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return oo(this.U.delete())}}class Ku extends ue{constructor(e,t){super(ee.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function pi(s){return s.name==="IndexedDbTransactionError"}class lk{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(fe(ps,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(fe(ps,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),oo(n)}add(e){return fe(ps,"ADD",this.store.name,e,e),oo(this.store.add(e))}get(e){return oo(this.store.get(e)).next((t=>(t===void 0&&(t=null),fe(ps,"GET",this.store.name,e,t),t)))}delete(e){return fe(ps,"DELETE",this.store.name,e),oo(this.store.delete(e))}count(){return fe(ps,"COUNT",this.store.name),oo(this.store.count())}J(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){const l=i.getAll(n.range);return new X(((u,h)=>{l.onerror=m=>{h(m.target.error)},l.onsuccess=m=>{u(m.target.result)}}))}{const l=this.cursor(n),u=[];return this.H(l,((h,m)=>{u.push(m)})).next((()=>u))}}Y(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new X(((i,l)=>{n.onerror=u=>{l(u.target.error)},n.onsuccess=u=>{i(u.target.result)}}))}Z(e,t){fe(ps,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const i=this.cursor(n);return this.H(i,((l,u,h)=>h.delete()))}ee(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.H(i,t)}te(e){const t=this.cursor({});return new X(((n,i)=>{t.onerror=l=>{const u=bx(l.target.error);i(u)},t.onsuccess=l=>{const u=l.target.result;u?e(u.primaryKey,u.value).next((h=>{h?u.continue():n()})):n()}}))}H(e,t){const n=[];return new X(((i,l)=>{e.onerror=u=>{l(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void i();const m=new ok(h),p=t(h.primaryKey,h.value,m);if(p instanceof X){const x=p.catch((b=>(m.done(),X.reject(b))));n.push(x)}m.isDone?i():m.G===null?h.continue():h.continue(m.G)}})).next((()=>X.waitFor(n)))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function oo(s){return new X(((e,t)=>{s.onsuccess=n=>{const i=n.target.result;e(i)},s.onerror=n=>{const i=bx(n.target.error);t(i)}}))}let Rw=!1;function bx(s){const e=wr.M(hn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(s.message.indexOf(t)>=0){const n=new ue("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Rw||(Rw=!0,setTimeout((()=>{throw n}),0)),n}}return s}const Yu="IndexBackfiller";class ck{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){fe(Yu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();fe(Yu,`Documents written: ${t}`)}catch(t){pi(t)?fe(Yu,"Ignoring IndexedDB error during index backfill: ",t):await gi(t)}await this.re(6e4)}))}}class uk{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const n=new Set;let i=t,l=!0;return X.doWhile((()=>l===!0&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((u=>{if(u!==null&&!n.has(u))return fe(Yu,`Processing collection: ${u}`),this.oe(e,u,i).next((h=>{i-=h,n.add(u)}));l=!1})))).next((()=>t-i))}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next((l=>{const u=l.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next((()=>this._e(i,l))).next((h=>(fe(Yu,`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h)))).next((()=>u.size))}))))}_e(e,t){let n=e;return t.changes.forEach(((i,l)=>{const u=TS(l);vx(u,n)>0&&(n=u)})),new _s(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Zn.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ai=-1;function Sd(s){return s==null}function od(s){return s===0&&1/s==-1/0}function AS(s){return typeof s=="number"&&Number.isInteger(s)&&!od(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f="";function Fn(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=kw(e)),e=dk(s.get(t),e);return kw(e)}function dk(s,e){let t=e;const n=s.length;for(let i=0;i<n;i++){const l=s.charAt(i);switch(l){case"\0":t+="";break;case $f:t+="";break;default:t+=l}}return t}function kw(s){return s+$f+""}function vr(s){const e=s.length;if(je(e>=2,64408,{path:s}),e===2)return je(s.charAt(0)===$f&&s.charAt(1)==="",56145,{path:s}),Xe.emptyPath();const t=e-2,n=[];let i="";for(let l=0;l<e;){const u=s.indexOf($f,l);switch((u<0||u>t)&&Se(50515,{path:s}),s.charAt(u+1)){case"":const h=s.substring(l,u);let m;i.length===0?m=h:(i+=h,m=i,i=""),n.push(m);break;case"":i+=s.substring(l,u),i+="\0";break;case"":i+=s.substring(l,u+1);break;default:Se(61167,{path:s})}l=u+2}return new Xe(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const io="remoteDocuments",Nd="owner",Il="owner",ld="mutationQueues",hk="userId",$s="mutations",Dw="batchId",fo="userMutationsIndex",Pw=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sf(s,e){return[s,Fn(e)]}function IS(s,e,t){return[s,Fn(e),t]}const fk={},Wl="documentMutations",Qf="remoteDocumentsV14",mk=["prefixPath","collectionGroup","readTime","documentId"],Nf="documentKeyIndex",gk=["prefixPath","collectionGroup","documentId"],jS="collectionGroupIndex",pk=["collectionGroup","readTime","prefixPath","documentId"],cd="remoteDocumentGlobal",jy="remoteDocumentGlobalKey",Jl="targets",CS="queryTargetsIndex",yk=["canonicalId","targetId"],Zl="targetDocuments",xk=["targetId","path"],_x="documentTargetsIndex",vk=["path","targetId"],Kf="targetGlobalKey",po="targetGlobal",ud="collectionParents",bk=["collectionId","parent"],ec="clientMetadata",_k="clientId",bm="bundles",wk="bundleId",_m="namedQueries",Tk="name",wx="indexConfiguration",Ek="indexId",Cy="collectionGroupIndex",Sk="collectionGroup",Xu="indexState",Nk=["indexId","uid"],RS="sequenceNumberIndex",Ak=["uid","sequenceNumber"],Wu="indexEntries",Ik=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kS="documentKeyIndex",jk=["indexId","uid","orderedDocumentKey"],wm="documentOverlays",Ck=["userId","collectionPath","documentId"],Ry="collectionPathOverlayIndex",Rk=["userId","collectionPath","largestBatchId"],DS="collectionGroupOverlayIndex",kk=["userId","collectionGroup","largestBatchId"],Tx="globals",Dk="name",PS=[ld,$s,Wl,io,Jl,Nd,po,Zl,ec,cd,ud,bm,_m],Pk=[...PS,wm],MS=[ld,$s,Wl,Qf,Jl,Nd,po,Zl,ec,cd,ud,bm,_m,wm],VS=MS,Ex=[...VS,wx,Xu,Wu],Mk=Ex,OS=[...Ex,Tx],Vk=OS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky extends SS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function mn(s,e){const t=_e(s);return wr.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function yi(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function LS(s,e){const t=[];for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.push(e(s[n],n,s));return t}function US(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,t){this.comparator=e,this.root=t||Rn.EMPTY}insert(e,t){return new jt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Rn.BLACK,null,null))}remove(e){return new jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new df(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new df(this.root,e,this.comparator,!1)}getReverseIterator(){return new df(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new df(this.root,e,this.comparator,!0)}}class df{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?n(e.key,t):1,t&&i&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rn{constructor(e,t,n,i,l){this.key=e,this.value=t,this.color=n??Rn.RED,this.left=i??Rn.EMPTY,this.right=l??Rn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,l){return new Rn(e??this.key,t??this.value,n??this.color,i??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const l=n(e,i.key);return i=l<0?i.copy(null,null,null,i.left.insert(e,t,n),null):l===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Rn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Rn.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Se(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Se(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Se(27949);return e+(this.isRed()?0:1)}}Rn.EMPTY=null,Rn.RED=!0,Rn.BLACK=!1;Rn.EMPTY=new class{constructor(){this.size=0}get key(){throw Se(57766)}get value(){throw Se(16141)}get color(){throw Se(16727)}get left(){throw Se(29726)}get right(){throw Se(36894)}copy(e,t,n,i,l){return this}insert(e,t,n){return new Rn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e){this.comparator=e,this.data=new jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vw(this.data.getIterator())}getIteratorFrom(e){return new Vw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof xt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,l=n.getNext().key;if(this.comparator(i,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new xt(this.comparator);return t.data=e,t}}class Vw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function jl(s){return s.hasNext()?s.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.fields=e,e.sort(Rt.comparator)}static empty(){return new es([])}unionWith(e){let t=new xt(Rt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new es(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ql(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ok(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new FS("Invalid base64 string: "+l):l}})(e);return new Ft(t)}static fromUint8Array(e){const t=(function(i){let l="";for(let u=0;u<i.length;++u)l+=String.fromCharCode(i[u]);return l})(e);return new Ft(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ft.EMPTY_BYTE_STRING=new Ft("");const Lk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ua(s){if(je(!!s,39018),typeof s=="string"){let e=0;const t=Lk.exec(s);if(je(!!t,46558,{timestamp:s}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Pt(s.seconds),nanos:Pt(s.nanos)}}function Pt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function da(s){return typeof s=="string"?Ft.fromBase64String(s):Ft.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qS="server_timestamp",BS="__type__",zS="__previous_value__",GS="__local_write_time__";function Tm(s){return(s?.mapValue?.fields||{})[BS]?.stringValue===qS}function Em(s){const e=s.mapValue.fields[zS];return Tm(e)?Em(e):e}function dd(s){const e=ua(s.mapValue.fields[GS].timestampValue);return new ht(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e,t,n,i,l,u,h,m,p,x){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=m,this.useFetchStreams=p,this.isUsingEmulator=x}}const hd="(default)";class oi{constructor(e,t){this.projectId=e,this.database=t||hd}static empty(){return new oi("","")}get isDefaultDatabase(){return this.database===hd}isEqual(e){return e instanceof oi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx="__type__",HS="__max__",Za={mapValue:{fields:{__type__:{stringValue:HS}}}},Nx="__vector__",tc="value",Af={nullValue:"NULL_VALUE"};function li(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?Tm(s)?4:$S(s)?9007199254740991:Sm(s)?10:11:Se(28295,{value:s})}function Nr(s,e){if(s===e)return!0;const t=li(s);if(t!==li(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return dd(s).isEqual(dd(e));case 3:return(function(i,l){if(typeof i.timestampValue=="string"&&typeof l.timestampValue=="string"&&i.timestampValue.length===l.timestampValue.length)return i.timestampValue===l.timestampValue;const u=ua(i.timestampValue),h=ua(l.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(s,e);case 5:return s.stringValue===e.stringValue;case 6:return(function(i,l){return da(i.bytesValue).isEqual(da(l.bytesValue))})(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return(function(i,l){return Pt(i.geoPointValue.latitude)===Pt(l.geoPointValue.latitude)&&Pt(i.geoPointValue.longitude)===Pt(l.geoPointValue.longitude)})(s,e);case 2:return(function(i,l){if("integerValue"in i&&"integerValue"in l)return Pt(i.integerValue)===Pt(l.integerValue);if("doubleValue"in i&&"doubleValue"in l){const u=Pt(i.doubleValue),h=Pt(l.doubleValue);return u===h?od(u)===od(h):isNaN(u)&&isNaN(h)}return!1})(s,e);case 9:return Ql(s.arrayValue.values||[],e.arrayValue.values||[],Nr);case 10:case 11:return(function(i,l){const u=i.mapValue.fields||{},h=l.mapValue.fields||{};if(Mw(u)!==Mw(h))return!1;for(const m in u)if(u.hasOwnProperty(m)&&(h[m]===void 0||!Nr(u[m],h[m])))return!1;return!0})(s,e);default:return Se(52216,{left:s})}}function fd(s,e){return(s.values||[]).find((t=>Nr(t,e)))!==void 0}function ci(s,e){if(s===e)return 0;const t=li(s),n=li(e);if(t!==n)return Ve(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ve(s.booleanValue,e.booleanValue);case 2:return(function(l,u){const h=Pt(l.integerValue||l.doubleValue),m=Pt(u.integerValue||u.doubleValue);return h<m?-1:h>m?1:h===m?0:isNaN(h)?isNaN(m)?0:-1:1})(s,e);case 3:return Ow(s.timestampValue,e.timestampValue);case 4:return Ow(dd(s),dd(e));case 5:return Ny(s.stringValue,e.stringValue);case 6:return(function(l,u){const h=da(l),m=da(u);return h.compareTo(m)})(s.bytesValue,e.bytesValue);case 7:return(function(l,u){const h=l.split("/"),m=u.split("/");for(let p=0;p<h.length&&p<m.length;p++){const x=Ve(h[p],m[p]);if(x!==0)return x}return Ve(h.length,m.length)})(s.referenceValue,e.referenceValue);case 8:return(function(l,u){const h=Ve(Pt(l.latitude),Pt(u.latitude));return h!==0?h:Ve(Pt(l.longitude),Pt(u.longitude))})(s.geoPointValue,e.geoPointValue);case 9:return Lw(s.arrayValue,e.arrayValue);case 10:return(function(l,u){const h=l.fields||{},m=u.fields||{},p=h[tc]?.arrayValue,x=m[tc]?.arrayValue,b=Ve(p?.values?.length||0,x?.values?.length||0);return b!==0?b:Lw(p,x)})(s.mapValue,e.mapValue);case 11:return(function(l,u){if(l===Za.mapValue&&u===Za.mapValue)return 0;if(l===Za.mapValue)return 1;if(u===Za.mapValue)return-1;const h=l.fields||{},m=Object.keys(h),p=u.fields||{},x=Object.keys(p);m.sort(),x.sort();for(let b=0;b<m.length&&b<x.length;++b){const w=Ny(m[b],x[b]);if(w!==0)return w;const N=ci(h[m[b]],p[x[b]]);if(N!==0)return N}return Ve(m.length,x.length)})(s.mapValue,e.mapValue);default:throw Se(23264,{he:t})}}function Ow(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return Ve(s,e);const t=ua(s),n=ua(e),i=Ve(t.seconds,n.seconds);return i!==0?i:Ve(t.nanos,n.nanos)}function Lw(s,e){const t=s.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const l=ci(t[i],n[i]);if(l)return l}return Ve(t.length,n.length)}function nc(s){return Dy(s)}function Dy(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?(function(t){const n=ua(t);return`time(${n.seconds},${n.nanos})`})(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?(function(t){return da(t).toBase64()})(s.bytesValue):"referenceValue"in s?(function(t){return be.fromName(t).toString()})(s.referenceValue):"geoPointValue"in s?(function(t){return`geo(${t.latitude},${t.longitude})`})(s.geoPointValue):"arrayValue"in s?(function(t){let n="[",i=!0;for(const l of t.values||[])i?i=!1:n+=",",n+=Dy(l);return n+"]"})(s.arrayValue):"mapValue"in s?(function(t){const n=Object.keys(t.fields||{}).sort();let i="{",l=!0;for(const u of n)l?l=!1:i+=",",i+=`${u}:${Dy(t.fields[u])}`;return i+"}"})(s.mapValue):Se(61005,{value:s})}function If(s){switch(li(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Em(s);return e?16+If(e):16;case 5:return 2*s.stringValue.length;case 6:return da(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((i,l)=>i+If(l)),0)})(s.arrayValue);case 10:case 11:return(function(n){let i=0;return yi(n.fields,((l,u)=>{i+=l.length+If(u)})),i})(s.mapValue);default:throw Se(13486,{value:s})}}function bo(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function Py(s){return!!s&&"integerValue"in s}function md(s){return!!s&&"arrayValue"in s}function Uw(s){return!!s&&"nullValue"in s}function Fw(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function jf(s){return!!s&&"mapValue"in s}function Sm(s){return(s?.mapValue?.fields||{})[Sx]?.stringValue===Nx}function Ju(s){if(s.geoPointValue)return{geoPointValue:{...s.geoPointValue}};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:{...s.timestampValue}};if(s.mapValue){const e={mapValue:{fields:{}}};return yi(s.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ju(n))),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ju(s.arrayValue.values[t]);return e}return{...s}}function $S(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===HS}const QS={mapValue:{fields:{[Sx]:{stringValue:Nx},[tc]:{arrayValue:{}}}}};function Fk(s){return"nullValue"in s?Af:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?bo(oi.empty(),be.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?Sm(s)?QS:{mapValue:{}}:Se(35942,{value:s})}function qk(s){return"nullValue"in s?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?bo(oi.empty(),be.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?QS:"mapValue"in s?Sm(s)?{mapValue:{}}:Za:Se(61959,{value:s})}function qw(s,e){const t=ci(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?-1:!s.inclusive&&e.inclusive?1:0}function Bw(s,e){const t=ci(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?1:!s.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e){this.value=e}static empty(){return new kn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!jf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ju(t)}setAll(e){let t=Rt.emptyPath(),n={},i=[];e.forEach(((u,h)=>{if(!t.isImmediateParentOf(h)){const m=this.getFieldsMap(t);this.applyChanges(m,n,i),n={},i=[],t=h.popLast()}u?n[h.lastSegment()]=Ju(u):i.push(h.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,n,i)}delete(e){const t=this.field(e.popLast());jf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];jf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){yi(t,((i,l)=>e[i]=l));for(const i of n)delete e[i]}clone(){return new kn(Ju(this.value))}}function KS(s){const e=[];return yi(s.fields,((t,n)=>{const i=new Rt([t]);if(jf(n)){const l=KS(n.mapValue).fields;if(l.length===0)e.push(i);else for(const u of l)e.push(i.child(u))}else e.push(i)})),new es(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,t,n,i,l,u,h){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=l,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Ct(e,0,Ce.min(),Ce.min(),Ce.min(),kn.empty(),0)}static newFoundDocument(e,t,n,i){return new Ct(e,1,t,Ce.min(),n,i,0)}static newNoDocument(e,t){return new Ct(e,2,t,Ce.min(),Ce.min(),kn.empty(),0)}static newUnknownDocument(e,t){return new Ct(e,3,t,Ce.min(),Ce.min(),kn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ce.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=kn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=kn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ct&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t){this.position=e,this.inclusive=t}}function zw(s,e,t){let n=0;for(let i=0;i<s.position.length;i++){const l=e[i],u=s.position[i];if(l.field.isKeyField()?n=be.comparator(be.fromName(u.referenceValue),t.key):n=ci(u,t.data.field(l.field)),l.dir==="desc"&&(n*=-1),n!==0)break}return n}function Gw(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!Nr(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd{constructor(e,t="asc"){this.field=e,this.dir=t}}function Bk(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YS{}class tt extends YS{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new zk(e,t,n):t==="array-contains"?new $k(e,n):t==="in"?new tN(e,n):t==="not-in"?new Qk(e,n):t==="array-contains-any"?new Kk(e,n):new tt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Gk(e,n):new Hk(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(ci(t,this.value)):t!==null&&li(this.value)===li(t)&&this.matchesComparison(ci(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Se(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class pt extends YS{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new pt(e,t)}matches(e){return sc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function sc(s){return s.op==="and"}function My(s){return s.op==="or"}function Ax(s){return XS(s)&&sc(s)}function XS(s){for(const e of s.filters)if(e instanceof pt)return!1;return!0}function Vy(s){if(s instanceof tt)return s.field.canonicalString()+s.op.toString()+nc(s.value);if(Ax(s))return s.filters.map((e=>Vy(e))).join(",");{const e=s.filters.map((t=>Vy(t))).join(",");return`${s.op}(${e})`}}function WS(s,e){return s instanceof tt?(function(n,i){return i instanceof tt&&n.op===i.op&&n.field.isEqual(i.field)&&Nr(n.value,i.value)})(s,e):s instanceof pt?(function(n,i){return i instanceof pt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce(((l,u,h)=>l&&WS(u,i.filters[h])),!0):!1})(s,e):void Se(19439)}function JS(s,e){const t=s.filters.concat(e);return pt.create(t,s.op)}function ZS(s){return s instanceof tt?(function(t){return`${t.field.canonicalString()} ${t.op} ${nc(t.value)}`})(s):s instanceof pt?(function(t){return t.op.toString()+" {"+t.getFilters().map(ZS).join(" ,")+"}"})(s):"Filter"}class zk extends tt{constructor(e,t,n){super(e,t,n),this.key=be.fromName(n.referenceValue)}matches(e){const t=be.comparator(e.key,this.key);return this.matchesComparison(t)}}class Gk extends tt{constructor(e,t){super(e,"in",t),this.keys=eN("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Hk extends tt{constructor(e,t){super(e,"not-in",t),this.keys=eN("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function eN(s,e){return(e.arrayValue?.values||[]).map((t=>be.fromName(t.referenceValue)))}class $k extends tt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return md(t)&&fd(t.arrayValue,this.value)}}class tN extends tt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&fd(this.value.arrayValue,t)}}class Qk extends tt{constructor(e,t){super(e,"not-in",t)}matches(e){if(fd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!fd(this.value.arrayValue,t)}}class Kk extends tt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!md(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>fd(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk{constructor(e,t=null,n=[],i=[],l=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=l,this.startAt=u,this.endAt=h,this.Te=null}}function Oy(s,e=null,t=[],n=[],i=null,l=null,u=null){return new Yk(s,e,t,n,i,l,u)}function _o(s){const e=_e(s);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>Vy(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(l){return l.field.canonicalString()+l.dir})(n))).join(","),Sd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>nc(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>nc(n))).join(",")),e.Te=t}return e.Te}function Ad(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!Bk(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!WS(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!Gw(s.startAt,e.startAt)&&Gw(s.endAt,e.endAt)}function Yf(s){return be.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}function Xf(s,e){return s.filters.filter((t=>t instanceof tt&&t.field.isEqual(e)))}function Hw(s,e,t){let n=Af,i=!0;for(const l of Xf(s,e)){let u=Af,h=!0;switch(l.op){case"<":case"<=":u=Fk(l.value);break;case"==":case"in":case">=":u=l.value;break;case">":u=l.value,h=!1;break;case"!=":case"not-in":u=Af}qw({value:n,inclusive:i},{value:u,inclusive:h})<0&&(n=u,i=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];qw({value:n,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(n=u,i=t.inclusive);break}}return{value:n,inclusive:i}}function $w(s,e,t){let n=Za,i=!0;for(const l of Xf(s,e)){let u=Za,h=!0;switch(l.op){case">=":case">":u=qk(l.value),h=!1;break;case"==":case"in":case"<=":u=l.value;break;case"<":u=l.value,h=!1;break;case"!=":case"not-in":u=Za}Bw({value:n,inclusive:i},{value:u,inclusive:h})>0&&(n=u,i=h)}if(t!==null){for(let l=0;l<s.orderBy.length;++l)if(s.orderBy[l].field.isEqual(e)){const u=t.position[l];Bw({value:n,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(n=u,i=t.inclusive);break}}return{value:n,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,t=null,n=[],i=[],l=null,u="F",h=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=l,this.limitType=u,this.startAt=h,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function nN(s,e,t,n,i,l,u,h){return new ha(s,e,t,n,i,l,u,h)}function xc(s){return new ha(s)}function Qw(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Ix(s){return s.collectionGroup!==null}function zl(s){const e=_e(s);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new xt(Rt.comparator);return u.filters.forEach((m=>{m.getFlattenedFilters().forEach((p=>{p.isInequality()&&(h=h.add(p.field))}))})),h})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new gd(l,n))})),t.has(Rt.keyField().canonicalString())||e.Ie.push(new gd(Rt.keyField(),n))}return e.Ie}function qn(s){const e=_e(s);return e.Ee||(e.Ee=rN(e,zl(s))),e.Ee}function sN(s){const e=_e(s);return e.de||(e.de=rN(e,s.explicitOrderBy)),e.de}function rN(s,e){if(s.limitType==="F")return Oy(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map((i=>{const l=i.dir==="desc"?"asc":"desc";return new gd(i.field,l)}));const t=s.endAt?new ui(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new ui(s.startAt.position,s.startAt.inclusive):null;return Oy(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Ly(s,e){const t=s.filters.concat([e]);return new ha(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function Wf(s,e,t){return new ha(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function Id(s,e){return Ad(qn(s),qn(e))&&s.limitType===e.limitType}function aN(s){return`${_o(qn(s))}|lt:${s.limitType}`}function Ol(s){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((i=>ZS(i))).join(", ")}]`),Sd(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((i=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(i))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((i=>nc(i))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((i=>nc(i))).join(",")),`Target(${n})`})(qn(s))}; limitType=${s.limitType})`}function jd(s,e){return e.isFoundDocument()&&(function(n,i){const l=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(l):be.isDocumentKey(n.path)?n.path.isEqual(l):n.path.isImmediateParentOf(l)})(s,e)&&(function(n,i){for(const l of zl(n))if(!l.field.isKeyField()&&i.data.field(l.field)===null)return!1;return!0})(s,e)&&(function(n,i){for(const l of n.filters)if(!l.matches(i))return!1;return!0})(s,e)&&(function(n,i){return!(n.startAt&&!(function(u,h,m){const p=zw(u,h,m);return u.inclusive?p<=0:p<0})(n.startAt,zl(n),i)||n.endAt&&!(function(u,h,m){const p=zw(u,h,m);return u.inclusive?p>=0:p>0})(n.endAt,zl(n),i))})(s,e)}function iN(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function oN(s){return(e,t)=>{let n=!1;for(const i of zl(s)){const l=Xk(i,e,t);if(l!==0)return l;n=n||i.field.isKeyField()}return 0}}function Xk(s,e,t){const n=s.field.isKeyField()?be.comparator(e.key,t.key):(function(l,u,h){const m=u.data.field(l),p=h.data.field(l);return m!==null&&p!==null?ci(m,p):Se(42886)})(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return Se(19790,{direction:s.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,l]of n)if(this.equalsFn(i,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let l=0;l<i.length;l++)if(this.equalsFn(i[l][0],e))return void(i[l]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){yi(this.inner,((t,n)=>{for(const[i,l]of n)e(i,l)}))}isEmpty(){return US(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk=new jt(be.comparator);function ts(){return Wk}const lN=new jt(be.comparator);function Bu(...s){let e=lN;for(const t of s)e=e.insert(t.key,t);return e}function cN(s){let e=lN;return s.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function br(){return Zu()}function uN(){return Zu()}function Zu(){return new fa((s=>s.toString()),((s,e)=>s.isEqual(e)))}const Jk=new jt(be.comparator),Zk=new xt(be.comparator);function Be(...s){let e=Zk;for(const t of s)e=e.add(t);return e}const eD=new xt(Ve);function jx(){return eD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cx(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:od(e)?"-0":e}}function dN(s){return{integerValue:""+s}}function hN(s,e){return AS(e)?dN(e):Cx(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(){this._=void 0}}function tD(s,e,t){return s instanceof rc?(function(i,l){const u={fields:{[BS]:{stringValue:qS},[GS]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return l&&Tm(l)&&(l=Em(l)),l&&(u.fields[zS]=l),{mapValue:u}})(t,e):s instanceof wo?mN(s,e):s instanceof To?gN(s,e):(function(i,l){const u=fN(i,l),h=Kw(u)+Kw(i.Ae);return Py(u)&&Py(i.Ae)?dN(h):Cx(i.serializer,h)})(s,e)}function nD(s,e,t){return s instanceof wo?mN(s,e):s instanceof To?gN(s,e):t}function fN(s,e){return s instanceof ac?(function(n){return Py(n)||(function(l){return!!l&&"doubleValue"in l})(n)})(e)?e:{integerValue:0}:null}class rc extends Nm{}class wo extends Nm{constructor(e){super(),this.elements=e}}function mN(s,e){const t=pN(e);for(const n of s.elements)t.some((i=>Nr(i,n)))||t.push(n);return{arrayValue:{values:t}}}class To extends Nm{constructor(e){super(),this.elements=e}}function gN(s,e){let t=pN(e);for(const n of s.elements)t=t.filter((i=>!Nr(i,n)));return{arrayValue:{values:t}}}class ac extends Nm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Kw(s){return Pt(s.integerValue||s.doubleValue)}function pN(s){return md(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e,t){this.field=e,this.transform=t}}function sD(s,e){return s.field.isEqual(e.field)&&(function(n,i){return n instanceof wo&&i instanceof wo||n instanceof To&&i instanceof To?Ql(n.elements,i.elements,Nr):n instanceof ac&&i instanceof ac?Nr(n.Ae,i.Ae):n instanceof rc&&i instanceof rc})(s.transform,e.transform)}class rD{constructor(e,t){this.version=e,this.transformResults=t}}class Vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Vt}static exists(e){return new Vt(void 0,e)}static updateTime(e){return new Vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cf(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class Am{}function yN(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new bc(s.key,Vt.none()):new vc(s.key,s.data,Vt.none());{const t=s.data,n=kn.empty();let i=new xt(Rt.comparator);for(let l of e.fields)if(!i.has(l)){let u=t.field(l);u===null&&l.length>1&&(l=l.popLast(),u=t.field(l)),u===null?n.delete(l):n.set(l,u),i=i.add(l)}return new ma(s.key,n,new es(i.toArray()),Vt.none())}}function aD(s,e,t){s instanceof vc?(function(i,l,u){const h=i.value.clone(),m=Xw(i.fieldTransforms,l,u.transformResults);h.setAll(m),l.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(s,e,t):s instanceof ma?(function(i,l,u){if(!Cf(i.precondition,l))return void l.convertToUnknownDocument(u.version);const h=Xw(i.fieldTransforms,l,u.transformResults),m=l.data;m.setAll(xN(i)),m.setAll(h),l.convertToFoundDocument(u.version,m).setHasCommittedMutations()})(s,e,t):(function(i,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,t)}function ed(s,e,t,n){return s instanceof vc?(function(l,u,h,m){if(!Cf(l.precondition,u))return h;const p=l.value.clone(),x=Ww(l.fieldTransforms,m,u);return p.setAll(x),u.convertToFoundDocument(u.version,p).setHasLocalMutations(),null})(s,e,t,n):s instanceof ma?(function(l,u,h,m){if(!Cf(l.precondition,u))return h;const p=Ww(l.fieldTransforms,m,u),x=u.data;return x.setAll(xN(l)),x.setAll(p),u.convertToFoundDocument(u.version,x).setHasLocalMutations(),h===null?null:h.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((b=>b.field)))})(s,e,t,n):(function(l,u,h){return Cf(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(s,e,t)}function iD(s,e){let t=null;for(const n of s.fieldTransforms){const i=e.data.field(n.field),l=fN(n.transform,i||null);l!=null&&(t===null&&(t=kn.empty()),t.set(n.field,l))}return t||null}function Yw(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!(function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Ql(n,i,((l,u)=>sD(l,u)))})(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class vc extends Am{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ma extends Am{constructor(e,t,n,i,l=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function xN(s){const e=new Map;return s.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}})),e}function Xw(s,e,t){const n=new Map;je(s.length===t.length,32656,{Re:t.length,Ve:s.length});for(let i=0;i<t.length;i++){const l=s[i],u=l.transform,h=e.data.field(l.field);n.set(l.field,nD(u,h,t[i]))}return n}function Ww(s,e,t){const n=new Map;for(const i of s){const l=i.transform,u=t.data.field(i.field);n.set(i.field,tD(l,u,e))}return n}class bc extends Am{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Rx extends Am{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const l=this.mutations[i];l.key.isEqual(e.key)&&aD(l,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ed(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ed(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=uN();return this.mutations.forEach((i=>{const l=e.get(i.key),u=l.overlayedDocument;let h=this.applyToLocalView(u,l.mutatedFields);h=t.has(i.key)?null:h;const m=yN(u,h);m!==null&&n.set(i.key,m),u.isValidDocument()||u.convertToNoDocument(Ce.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Be())}isEqual(e){return this.batchId===e.batchId&&Ql(this.mutations,e.mutations,((t,n)=>Yw(t,n)))&&Ql(this.baseMutations,e.baseMutations,((t,n)=>Yw(t,n)))}}class Dx{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){je(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=(function(){return Jk})();const l=e.mutations;for(let u=0;u<l.length;u++)i=i.insert(l[u].key,n[u].version);return new Dx(e,t,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nn,it;function bN(s){switch(s){case ee.OK:return Se(64938);case ee.CANCELLED:case ee.UNKNOWN:case ee.DEADLINE_EXCEEDED:case ee.RESOURCE_EXHAUSTED:case ee.INTERNAL:case ee.UNAVAILABLE:case ee.UNAUTHENTICATED:return!1;case ee.INVALID_ARGUMENT:case ee.NOT_FOUND:case ee.ALREADY_EXISTS:case ee.PERMISSION_DENIED:case ee.FAILED_PRECONDITION:case ee.ABORTED:case ee.OUT_OF_RANGE:case ee.UNIMPLEMENTED:case ee.DATA_LOSS:return!0;default:return Se(15467,{code:s})}}function _N(s){if(s===void 0)return Xt("GRPC error has no .code"),ee.UNKNOWN;switch(s){case nn.OK:return ee.OK;case nn.CANCELLED:return ee.CANCELLED;case nn.UNKNOWN:return ee.UNKNOWN;case nn.DEADLINE_EXCEEDED:return ee.DEADLINE_EXCEEDED;case nn.RESOURCE_EXHAUSTED:return ee.RESOURCE_EXHAUSTED;case nn.INTERNAL:return ee.INTERNAL;case nn.UNAVAILABLE:return ee.UNAVAILABLE;case nn.UNAUTHENTICATED:return ee.UNAUTHENTICATED;case nn.INVALID_ARGUMENT:return ee.INVALID_ARGUMENT;case nn.NOT_FOUND:return ee.NOT_FOUND;case nn.ALREADY_EXISTS:return ee.ALREADY_EXISTS;case nn.PERMISSION_DENIED:return ee.PERMISSION_DENIED;case nn.FAILED_PRECONDITION:return ee.FAILED_PRECONDITION;case nn.ABORTED:return ee.ABORTED;case nn.OUT_OF_RANGE:return ee.OUT_OF_RANGE;case nn.UNIMPLEMENTED:return ee.UNIMPLEMENTED;case nn.DATA_LOSS:return ee.DATA_LOSS;default:return Se(39323,{code:s})}}(it=nn||(nn={}))[it.OK=0]="OK",it[it.CANCELLED=1]="CANCELLED",it[it.UNKNOWN=2]="UNKNOWN",it[it.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",it[it.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",it[it.NOT_FOUND=5]="NOT_FOUND",it[it.ALREADY_EXISTS=6]="ALREADY_EXISTS",it[it.PERMISSION_DENIED=7]="PERMISSION_DENIED",it[it.UNAUTHENTICATED=16]="UNAUTHENTICATED",it[it.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",it[it.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",it[it.ABORTED=10]="ABORTED",it[it.OUT_OF_RANGE=11]="OUT_OF_RANGE",it[it.UNIMPLEMENTED=12]="UNIMPLEMENTED",it[it.INTERNAL=13]="INTERNAL",it[it.UNAVAILABLE=14]="UNAVAILABLE",it[it.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uy=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lD=new ri([4294967295,4294967295],0);function Jw(s){const e=wN().encode(s),t=new cS;return t.update(e),new Uint8Array(t.digest())}function Zw(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new ri([t,n],0),new ri([i,l],0)]}class Mx{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new zu(`Invalid padding: ${t}`);if(n<0)throw new zu(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new zu(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new zu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ri.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(ri.fromNumber(n)));return i.compare(lD)===1&&(i=new ri([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Jw(e),[n,i]=Zw(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,i,l);if(!this.we(u))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new Mx(l,i,t);return n.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const t=Jw(e),[n,i]=Zw(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(n,i,l);this.Se(u)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class zu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rd{constructor(e,t,n,i,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,kd.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Rd(Ce.min(),i,new jt(Ve),ts(),Be())}}class kd{constructor(e,t,n,i,l){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new kd(n,t,Be(),Be(),Be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class TN{constructor(e,t){this.targetId=e,this.Ce=t}}class EN{constructor(e,t,n=Ft.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class eT{constructor(){this.ve=0,this.Fe=tT(),this.Me=Ft.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Be(),t=Be(),n=Be();return this.Fe.forEach(((i,l)=>{switch(l){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Se(38017,{changeType:l})}})),new kd(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=tT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,je(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class cD{constructor(e){this.Ge=e,this.ze=new Map,this.je=ts(),this.Je=hf(),this.He=hf(),this.Ye=new jt(Ve)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Se(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const l=i.target;if(Yf(l))if(n===0){const u=new be(l.path);this.et(t,u,Ct.newNoDocument(u,Ce.min()))}else je(n===1,20013,{expectedCount:n});else{const u=this._t(t);if(u!==n){const h=this.ut(e),m=h?this.ct(h,e,u):1;if(m!==0){this.it(t);const p=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}Uy?.lt((function(x,b,w,N,V){const D={localCacheCount:x,existenceFilterCount:b.count,databaseId:w.database,projectId:w.projectId},q=b.unchangedNames;return q&&(D.bloomFilter={applied:V===0,hashCount:q?.hashCount??0,bitmapLength:q?.bits?.bitmap?.length??0,padding:q?.bits?.padding??0,mightContain:z=>N?.mightContain(z)??!1}),D})(u,e.Ce,this.Ge.ht(),h,m))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:l=0}=t;let u,h;try{u=da(n).toUint8Array()}catch(m){if(m instanceof FS)return bs("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{h=new Mx(u,i,l)}catch(m){return bs(m instanceof zu?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return h.ge===0?null:h}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach((l=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(h)||(this.et(t,l,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((l,u)=>{const h=this.ot(u);if(h){if(l.current&&Yf(h.target)){const m=new be(h.target.path);this.It(m).has(u)||this.Et(u,m)||this.et(u,m,Ct.newNoDocument(m,e))}l.Be&&(t.set(u,l.ke()),l.qe())}}));let n=Be();this.He.forEach(((l,u)=>{let h=!0;u.forEachWhile((m=>{const p=this.ot(m);return!p||p.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(n=n.add(l))})),this.je.forEach(((l,u)=>u.setReadTime(e)));const i=new Rd(e,t,this.Ye,this.je,n);return this.je=ts(),this.Je=hf(),this.He=hf(),this.Ye=new jt(Ve),i}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new eT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new xt(Ve),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new xt(Ve),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||fe("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new eT),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function hf(){return new jt(be.comparator)}function tT(){return new jt(be.comparator)}const uD={asc:"ASCENDING",desc:"DESCENDING"},dD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hD={and:"AND",or:"OR"};class fD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Fy(s,e){return s.useProto3Json||Sd(e)?e:{value:e}}function ic(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SN(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function mD(s,e){return ic(s,e.toTimestamp())}function Wt(s){return je(!!s,49232),Ce.fromTimestamp((function(t){const n=ua(t);return new ht(n.seconds,n.nanos)})(s))}function Vx(s,e){return qy(s,e).canonicalString()}function qy(s,e){const t=(function(i){return new Xe(["projects",i.projectId,"databases",i.database])})(s).child("documents");return e===void 0?t:t.child(e)}function NN(s){const e=Xe.fromString(s);return je(MN(e),10190,{key:e.toString()}),e}function pd(s,e){return Vx(s.databaseId,e.path)}function Tr(s,e){const t=NN(e);if(t.get(1)!==s.databaseId.projectId)throw new ue(ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new ue(ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new be(jN(t))}function AN(s,e){return Vx(s.databaseId,e)}function IN(s){const e=NN(s);return e.length===4?Xe.emptyPath():jN(e)}function By(s){return new Xe(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function jN(s){return je(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function nT(s,e,t){return{name:pd(s,e),fields:t.value.mapValue.fields}}function Im(s,e,t){const n=Tr(s,e.name),i=Wt(e.updateTime),l=e.createTime?Wt(e.createTime):Ce.min(),u=new kn({mapValue:{fields:e.fields}}),h=Ct.newFoundDocument(n,i,l,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function gD(s,e){return"found"in e?(function(n,i){je(!!i.found,43571),i.found.name,i.found.updateTime;const l=Tr(n,i.found.name),u=Wt(i.found.updateTime),h=i.found.createTime?Wt(i.found.createTime):Ce.min(),m=new kn({mapValue:{fields:i.found.fields}});return Ct.newFoundDocument(l,u,h,m)})(s,e):"missing"in e?(function(n,i){je(!!i.missing,3894),je(!!i.readTime,22933);const l=Tr(n,i.missing),u=Wt(i.readTime);return Ct.newNoDocument(l,u)})(s,e):Se(7234,{result:e})}function pD(s,e){let t;if("targetChange"in e){e.targetChange;const n=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:Se(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],l=(function(p,x){return p.useProto3Json?(je(x===void 0||typeof x=="string",58123),Ft.fromBase64String(x||"")):(je(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),Ft.fromUint8Array(x||new Uint8Array))})(s,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(p){const x=p.code===void 0?ee.UNKNOWN:_N(p.code);return new ue(x,p.message||"")})(u);t=new EN(n,i,l,h||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=Tr(s,n.document.name),l=Wt(n.document.updateTime),u=n.document.createTime?Wt(n.document.createTime):Ce.min(),h=new kn({mapValue:{fields:n.document.fields}}),m=Ct.newFoundDocument(i,l,u,h),p=n.targetIds||[],x=n.removedTargetIds||[];t=new Rf(p,x,m.key,m)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=Tr(s,n.document),l=n.readTime?Wt(n.readTime):Ce.min(),u=Ct.newNoDocument(i,l),h=n.removedTargetIds||[];t=new Rf([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=Tr(s,n.document),l=n.removedTargetIds||[];t=new Rf([],l,i,null)}else{if(!("filter"in e))return Se(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:l}=n,u=new oD(i,l),h=n.targetId;t=new TN(h,u)}}return t}function yd(s,e){let t;if(e instanceof vc)t={update:nT(s,e.key,e.value)};else if(e instanceof bc)t={delete:pd(s,e.key)};else if(e instanceof ma)t={update:nT(s,e.key,e.data),updateMask:wD(e.fieldMask)};else{if(!(e instanceof Rx))return Se(16599,{Vt:e.type});t={verify:pd(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(l,u){const h=u.transform;if(h instanceof rc)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof wo)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof To)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof ac)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw Se(20930,{transform:u.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(i,l){return l.updateTime!==void 0?{updateTime:mD(i,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Se(27497)})(s,e.precondition)),t}function zy(s,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?Vt.updateTime(Wt(l.updateTime)):l.exists!==void 0?Vt.exists(l.exists):Vt.none()})(e.currentDocument):Vt.none(),n=e.updateTransforms?e.updateTransforms.map((i=>(function(u,h){let m=null;if("setToServerValue"in h)je(h.setToServerValue==="REQUEST_TIME",16630,{proto:h}),m=new rc;else if("appendMissingElements"in h){const x=h.appendMissingElements.values||[];m=new wo(x)}else if("removeAllFromArray"in h){const x=h.removeAllFromArray.values||[];m=new To(x)}else"increment"in h?m=new ac(u,h.increment):Se(16584,{proto:h});const p=Rt.fromServerFormat(h.fieldPath);return new Cd(p,m)})(s,i))):[];if(e.update){e.update.name;const i=Tr(s,e.update.name),l=new kn({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=(function(m){const p=m.fieldPaths||[];return new es(p.map((x=>Rt.fromServerFormat(x))))})(e.updateMask);return new ma(i,l,u,t,n)}return new vc(i,l,t,n)}if(e.delete){const i=Tr(s,e.delete);return new bc(i,t)}if(e.verify){const i=Tr(s,e.verify);return new Rx(i,t)}return Se(1463,{proto:e})}function yD(s,e){return s&&s.length>0?(je(e!==void 0,14353),s.map((t=>(function(i,l){let u=i.updateTime?Wt(i.updateTime):Wt(l);return u.isEqual(Ce.min())&&(u=Wt(l)),new rD(u,i.transformResults||[])})(t,e)))):[]}function CN(s,e){return{documents:[AN(s,e.path)]}}function jm(s,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=AN(s,i);const l=(function(p){if(p.length!==0)return PN(pt.create(p,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const u=(function(p){if(p.length!==0)return p.map((x=>(function(w){return{field:Wa(w.field),direction:vD(w.dir)}})(x)))})(e.orderBy);u&&(t.structuredQuery.orderBy=u);const h=Fy(s,e.limit);return h!==null&&(t.structuredQuery.limit=h),e.startAt&&(t.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:t,parent:i}}function RN(s,e,t,n){const{ft:i,parent:l}=jm(s,e),u={},h=[];let m=0;return t.forEach((p=>{const x=n?p.alias:"aggregate_"+m++;u[x]=p.alias,p.aggregateType==="count"?h.push({alias:x,count:{}}):p.aggregateType==="avg"?h.push({alias:x,avg:{field:Wa(p.fieldPath)}}):p.aggregateType==="sum"&&h.push({alias:x,sum:{field:Wa(p.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:i.structuredQuery},parent:i.parent},gt:u,parent:l}}function kN(s){let e=IN(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){je(n===1,65062);const x=t.from[0];x.allDescendants?i=x.collectionId:e=e.child(x.collectionId)}let l=[];t.where&&(l=(function(b){const w=DN(b);return w instanceof pt&&Ax(w)?w.getFilters():[w]})(t.where));let u=[];t.orderBy&&(u=(function(b){return b.map((w=>(function(V){return new gd(Ll(V.field),(function(q){switch(q){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(V.direction))})(w)))})(t.orderBy));let h=null;t.limit&&(h=(function(b){let w;return w=typeof b=="object"?b.value:b,Sd(w)?null:w})(t.limit));let m=null;t.startAt&&(m=(function(b){const w=!!b.before,N=b.values||[];return new ui(N,w)})(t.startAt));let p=null;return t.endAt&&(p=(function(b){const w=!b.before,N=b.values||[];return new ui(N,w)})(t.endAt)),nN(e,i,u,l,h,"F",m,p)}function xD(s,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Se(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function DN(s){return s.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Ll(t.unaryFilter.field);return tt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Ll(t.unaryFilter.field);return tt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=Ll(t.unaryFilter.field);return tt.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=Ll(t.unaryFilter.field);return tt.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Se(61313);default:return Se(60726)}})(s):s.fieldFilter!==void 0?(function(t){return tt.create(Ll(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Se(58110);default:return Se(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(s):s.compositeFilter!==void 0?(function(t){return pt.create(t.compositeFilter.filters.map((n=>DN(n))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Se(1026)}})(t.compositeFilter.op))})(s):Se(30097,{filter:s})}function vD(s){return uD[s]}function bD(s){return dD[s]}function _D(s){return hD[s]}function Wa(s){return{fieldPath:s.canonicalString()}}function Ll(s){return Rt.fromServerFormat(s.fieldPath)}function PN(s){return s instanceof tt?(function(t){if(t.op==="=="){if(Fw(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NAN"}};if(Uw(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Fw(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NOT_NAN"}};if(Uw(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wa(t.field),op:bD(t.op),value:t.value}}})(s):s instanceof pt?(function(t){const n=t.getFilters().map((i=>PN(i)));return n.length===1?n[0]:{compositeFilter:{op:_D(t.op),filters:n}}})(s):Se(54877,{filter:s})}function wD(s){const e=[];return s.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function MN(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t,n,i,l=Ce.min(),u=Ce.min(),h=Ft.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=m}withSequenceNumber(e){return new aa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aa(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e){this.yt=e}}function TD(s,e){let t;if(e.document)t=Im(s.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=be.fromSegments(e.noDocument.path),i=So(e.noDocument.readTime);t=Ct.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Se(56709);{const n=be.fromSegments(e.unknownDocument.path),i=So(e.unknownDocument.version);t=Ct.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime((function(i){const l=new ht(i[0],i[1]);return Ce.fromTimestamp(l)})(e.readTime)),t}function sT(s,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Jf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(l,u){return{name:pd(l,u.key),fields:u.data.value.mapValue.fields,updateTime:ic(l,u.version.toTimestamp()),createTime:ic(l,u.createTime.toTimestamp())}})(s.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Eo(e.version)};else{if(!e.isUnknownDocument())return Se(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:Eo(e.version)}}return n}function Jf(s){const e=s.toTimestamp();return[e.seconds,e.nanoseconds]}function Eo(s){const e=s.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function So(s){const e=new ht(s.seconds,s.nanoseconds);return Ce.fromTimestamp(e)}function lo(s,e){const t=(e.baseMutations||[]).map((l=>zy(s.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const u=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const h=e.mutations[l+1];u.updateTransforms=h.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const n=e.mutations.map((l=>zy(s.yt,l))),i=ht.fromMillis(e.localWriteTimeMs);return new kx(e.batchId,i,t,n)}function Gu(s){const e=So(s.readTime),t=s.lastLimboFreeSnapshotVersion!==void 0?So(s.lastLimboFreeSnapshotVersion):Ce.min();let n;return n=(function(l){return l.documents!==void 0})(s.query)?(function(l){const u=l.documents.length;return je(u===1,1966,{count:u}),qn(xc(IN(l.documents[0])))})(s.query):(function(l){return qn(kN(l))})(s.query),new aa(n,s.targetId,"TargetPurposeListen",s.lastListenSequenceNumber,e,t,Ft.fromBase64String(s.resumeToken))}function ON(s,e){const t=Eo(e.snapshotVersion),n=Eo(e.lastLimboFreeSnapshotVersion);let i;i=Yf(e.target)?CN(s.yt,e.target):jm(s.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:_o(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Cm(s){const e=kN({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Wf(e,e.limit,"L"):e}function ay(s,e){return new Px(e.largestBatchId,zy(s.yt,e.overlayMutation))}function rT(s,e){const t=e.path.lastSegment();return[s,Fn(e.path.popLast()),t]}function aT(s,e,t,n){return{indexId:s,uid:e,sequenceNumber:t,readTime:Eo(n.readTime),documentKey:Fn(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{getBundleMetadata(e,t){return iT(e).get(t).next((n=>{if(n)return(function(l){return{id:l.bundleId,createTime:So(l.createTime),version:l.version}})(n)}))}saveBundleMetadata(e,t){return iT(e).put((function(i){return{bundleId:i.id,createTime:Eo(Wt(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return oT(e).get(t).next((n=>{if(n)return(function(l){return{name:l.name,query:Cm(l.bundledQuery),readTime:So(l.readTime)}})(n)}))}saveNamedQuery(e,t){return oT(e).put((function(i){return{name:i.name,readTime:Eo(Wt(i.readTime)),bundledQuery:i.bundledQuery}})(t))}}function iT(s){return mn(s,bm)}function oT(s){return mn(s,_m)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new Rm(e,n)}getOverlay(e,t){return Vu(e).get(rT(this.userId,t)).next((n=>n?ay(this.serializer,n):null))}getOverlays(e,t){const n=br();return X.forEach(t,(i=>this.getOverlay(e,i).next((l=>{l!==null&&n.set(i,l)})))).next((()=>n))}saveOverlays(e,t,n){const i=[];return n.forEach(((l,u)=>{const h=new Px(t,u);i.push(this.St(e,h))})),X.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach((u=>i.add(Fn(u.getCollectionPath()))));const l=[];return i.forEach((u=>{const h=IDBKeyRange.bound([this.userId,u,n],[this.userId,u,n+1],!1,!0);l.push(Vu(e).Z(Ry,h))})),X.waitFor(l)}getOverlaysForCollection(e,t,n){const i=br(),l=Fn(t),u=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,Number.POSITIVE_INFINITY],!0);return Vu(e).J(Ry,u).next((h=>{for(const m of h){const p=ay(this.serializer,m);i.set(p.getKey(),p)}return i}))}getOverlaysForCollectionGroup(e,t,n,i){const l=br();let u;const h=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Vu(e).ee({index:DS,range:h},((m,p,x)=>{const b=ay(this.serializer,p);l.size()<i||b.largestBatchId===u?(l.set(b.getKey(),b),u=b.largestBatchId):x.done()})).next((()=>l))}St(e,t){return Vu(e).put((function(i,l,u){const[h,m,p]=rT(l,u.mutation.key);return{userId:l,collectionPath:m,documentId:p,collectionGroup:u.mutation.key.getCollectionGroup(),largestBatchId:u.largestBatchId,overlayMutation:yd(i.yt,u.mutation)}})(this.serializer,this.userId,t))}}function Vu(s){return mn(s,wm)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{bt(e){return mn(e,Tx)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const n=t?.value;return n?Ft.fromUint8Array(n):Ft.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Pt(e.integerValue));else if("doubleValue"in e){const n=Pt(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),od(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=ua(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(da(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?$S(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Sm(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Se(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const i of Object.keys(n))this.Ot(i,t),this.Ct(n[i],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const i=tc,l=n[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Pt(l)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const i of n)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),be.fromName(e).path.forEach((n=>{this.Ft(t,60),this.Ut(n,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}co.Kt=new co;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl=255;function ND(s){if(s===0)return 8;let e=0;return s>>4||(e+=4,s<<=4),s>>6||(e+=2,s<<=2),s>>7||(e+=1),e}function lT(s){const e=64-(function(n){let i=0;for(let l=0;l<8;++l){const u=ND(255&n[l]);if(i+=u,u!==8)break}return i})(s);return Math.ceil(e/8)}class AD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){const t=this.en(e),n=lT(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){const t=this.en(e),n=lT(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(Cl),this.sn(255)}_n(){this.an(Cl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const u=new DataView(new ArrayBuffer(8));return u.setFloat64(0,l,!1),new Uint8Array(u.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Cl?(this.sn(Cl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Cl?(this.an(Cl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class ID{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class jD{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Ou{constructor(){this.cn=new AD,this.ln=new ID(this.cn),this.hn=new jD(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(e,t,n,i){this.Tn=e,this.In=t,this.En=n,this.dn=i}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new uo(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:kf(this.En),directionalValue:kf(this.dn),orderedDocumentKey:kf(t),documentKey:n.path.toArray()}}Vn(e,t,n){const i=this.Rn(e,t,n);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function Ha(s,e){let t=s.Tn-e.Tn;return t!==0?t:(t=cT(s.En,e.En),t!==0?t:(t=cT(s.dn,e.dn),t!==0?t:be.comparator(s.In,e.In)))}function cT(s,e){for(let t=0;t<s.length&&t<e.length;++t){const n=s[t]-e[t];if(n!==0)return n}return s.length-e.length}function kf(s){return _E()?(function(t){let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n})(s):s}function uT(s){return typeof s!="string"?s:(function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n})(s)}class dT{constructor(e){this.mn=new xt(((t,n)=>Rt.comparator(t.field,n.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(je(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Iy(e);if(t!==void 0&&!this.wn(t))return!1;const n=ao(e);let i=new Set,l=0,u=0;for(;l<n.length&&this.wn(n[l]);++l)i=i.add(n[l].fieldPath.canonicalString());if(l===n.length)return!0;if(this.mn.size>0){const h=this.mn.getIterator().getNext();if(!i.has(h.field.canonicalString())){const m=n[l];if(!this.Sn(h,m)||!this.bn(this.fn[u++],m))return!1}++l}for(;l<n.length;++l){const h=n[l];if(u>=this.fn.length||!this.bn(this.fn[u++],h))return!1}return!0}Dn(){if(this.pn)return null;let e=new xt(Rt.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new go(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new go(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new go(n.field,n.dir==="asc"?0:1)));return new Yl(Yl.UNKNOWN_ID,this.collectionId,t,Xl.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(s){if(je(s instanceof tt||s instanceof pt,20012),s instanceof tt){if(s instanceof tN){const t=s.value.arrayValue?.values?.map((n=>tt.create(s.field,"==",n)))||[];return pt.create(t,"or")}return s}const e=s.filters.map((t=>LN(t)));return pt.create(e,s.op)}function CD(s){if(s.getFilters().length===0)return[];const e=$y(LN(s));return je(UN(e),7391),Gy(e)||Hy(e)?[e]:e.getFilters()}function Gy(s){return s instanceof tt}function Hy(s){return s instanceof pt&&Ax(s)}function UN(s){return Gy(s)||Hy(s)||(function(t){if(t instanceof pt&&My(t)){for(const n of t.getFilters())if(!Gy(n)&&!Hy(n))return!1;return!0}return!1})(s)}function $y(s){if(je(s instanceof tt||s instanceof pt,34018),s instanceof tt)return s;if(s.filters.length===1)return $y(s.filters[0]);const e=s.filters.map((n=>$y(n)));let t=pt.create(e,s.op);return t=Zf(t),UN(t)?t:(je(t instanceof pt,64498),je(sc(t),40251),je(t.filters.length>1,57927),t.filters.reduce(((n,i)=>Ox(n,i))))}function Ox(s,e){let t;return je(s instanceof tt||s instanceof pt,38388),je(e instanceof tt||e instanceof pt,25473),t=s instanceof tt?e instanceof tt?(function(i,l){return pt.create([i,l],"and")})(s,e):hT(s,e):e instanceof tt?hT(e,s):(function(i,l){if(je(i.filters.length>0&&l.filters.length>0,48005),sc(i)&&sc(l))return JS(i,l.getFilters());const u=My(i)?i:l,h=My(i)?l:i,m=u.filters.map((p=>Ox(p,h)));return pt.create(m,"or")})(s,e),Zf(t)}function hT(s,e){if(sc(e))return JS(e,s.getFilters());{const t=e.filters.map((n=>Ox(s,n)));return pt.create(t,"or")}}function Zf(s){if(je(s instanceof tt||s instanceof pt,11850),s instanceof tt)return s;const e=s.getFilters();if(e.length===1)return Zf(e[0]);if(XS(s))return s;const t=e.map((i=>Zf(i))),n=[];return t.forEach((i=>{i instanceof tt?n.push(i):i instanceof pt&&(i.op===s.op?n.push(...i.filters):n.push(i))})),n.length===1?n[0]:pt.create(n,s.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RD{constructor(){this.Cn=new Lx}addToCollectionParentIndex(e,t){return this.Cn.add(t),X.resolve()}getCollectionParents(e,t){return X.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return X.resolve()}deleteFieldIndex(e,t){return X.resolve()}deleteAllFieldIndexes(e){return X.resolve()}createTargetIndexes(e,t){return X.resolve()}getDocumentsMatchingTarget(e,t){return X.resolve(null)}getIndexType(e,t){return X.resolve(0)}getFieldIndexes(e,t){return X.resolve([])}getNextCollectionGroupToUpdate(e){return X.resolve(null)}getMinOffset(e,t){return X.resolve(_s.min())}getMinOffsetFromCollectionGroup(e,t){return X.resolve(_s.min())}updateCollectionGroup(e,t,n){return X.resolve()}updateIndexEntries(e,t){return X.resolve()}}class Lx{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new xt(Xe.comparator),l=!i.has(n);return this.index[t]=i.add(n),l}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new xt(Xe.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fT="IndexedDbIndexManager",ff=new Uint8Array(0);class kD{constructor(e,t){this.databaseId=t,this.vn=new Lx,this.Fn=new fa((n=>_o(n)),((n,i)=>Ad(n,i))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:n,parent:Fn(i)};return mT(e).put(l)}return X.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[xS(t),""],!1,!0);return mT(e).J(i).next((l=>{for(const u of l){if(u.collectionId!==t)break;n.push(vr(u.parent))}return n}))}addFieldIndex(e,t){const n=Lu(e),i=(function(h){return{indexId:h.indexId,collectionGroup:h.collectionGroup,fields:h.fields.map((m=>[m.fieldPath.canonicalString(),m.kind]))}})(t);delete i.indexId;const l=n.add(i);if(t.indexState){const u=kl(e);return l.next((h=>{u.put(aT(h,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const n=Lu(e),i=kl(e),l=Rl(e);return n.delete(t.indexId).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Lu(e),n=Rl(e),i=kl(e);return t.Z().next((()=>n.Z())).next((()=>i.Z()))}createTargetIndexes(e,t){return X.forEach(this.Mn(t),(n=>this.getIndexType(e,n).next((i=>{if(i===0||i===1){const l=new dT(n).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const n=Rl(e);let i=!0;const l=new Map;return X.forEach(this.Mn(t),(u=>this.xn(e,u).next((h=>{i&&(i=!!h),l.set(u,h)})))).next((()=>{if(i){let u=Be();const h=[];return X.forEach(l,((m,p)=>{fe(fT,`Using index ${(function(L){return`id=${L.indexId}|cg=${L.collectionGroup}|f=${L.fields.map((G=>`${G.fieldPath}:${G.kind}`)).join(",")}`})(m)} to execute ${_o(t)}`);const x=(function(L,G){const H=Iy(G);if(H===void 0)return null;for(const R of Xf(L,H.fieldPath))switch(R.op){case"array-contains-any":return R.value.arrayValue.values||[];case"array-contains":return[R.value]}return null})(p,m),b=(function(L,G){const H=new Map;for(const R of ao(G))for(const C of Xf(L,R.fieldPath))switch(C.op){case"==":case"in":H.set(R.fieldPath.canonicalString(),C.value);break;case"not-in":case"!=":return H.set(R.fieldPath.canonicalString(),C.value),Array.from(H.values())}return null})(p,m),w=(function(L,G){const H=[];let R=!0;for(const C of ao(G)){const T=C.kind===0?Hw(L,C.fieldPath,L.startAt):$w(L,C.fieldPath,L.startAt);H.push(T.value),R&&(R=T.inclusive)}return new ui(H,R)})(p,m),N=(function(L,G){const H=[];let R=!0;for(const C of ao(G)){const T=C.kind===0?$w(L,C.fieldPath,L.endAt):Hw(L,C.fieldPath,L.endAt);H.push(T.value),R&&(R=T.inclusive)}return new ui(H,R)})(p,m),V=this.On(m,p,w),D=this.On(m,p,N),q=this.Nn(m,p,b),z=this.Bn(m.indexId,x,V,w.inclusive,D,N.inclusive,q);return X.forEach(z,(B=>n.Y(B,t.limit).next((L=>{L.forEach((G=>{const H=be.fromSegments(G.documentKey);u.has(H)||(u=u.add(H),h.push(H))}))}))))})).next((()=>h))}return X.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=CD(pt.create(e.filters,"and")).map((n=>Oy(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,n,i,l,u,h){const m=(t!=null?t.length:1)*Math.max(n.length,l.length),p=m/(t!=null?t.length:1),x=[];for(let b=0;b<m;++b){const w=t?this.Ln(t[b/p]):ff,N=this.kn(e,w,n[b%p],i),V=this.qn(e,w,l[b%p],u),D=h.map((q=>this.kn(e,w,q,!0)));x.push(...this.createRange(N,V,D))}return x}kn(e,t,n,i){const l=new uo(e,be.empty(),t,n);return i?l:l.An()}qn(e,t,n,i){const l=new uo(e,be.empty(),t,n);return i?l.An():l}xn(e,t){const n=new dT(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next((l=>{let u=null;for(const h of l)n.yn(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u}))}getIndexType(e,t){let n=2;const i=this.Mn(t);return X.forEach(i,(l=>this.xn(e,l).next((u=>{u?n!==0&&u.fields.length<(function(m){let p=new xt(Rt.comparator),x=!1;for(const b of m.filters)for(const w of b.getFlattenedFilters())w.field.isKeyField()||(w.op==="array-contains"||w.op==="array-contains-any"?x=!0:p=p.add(w.field));for(const b of m.orderBy)b.field.isKeyField()||(p=p.add(b.field));return p.size+(x?1:0)})(l)&&(n=1):n=0})))).next((()=>(function(u){return u.limit!==null})(t)&&i.length>1&&n===2?1:n))}Qn(e,t){const n=new Ou;for(const i of ao(e)){const l=t.data.field(i.fieldPath);if(l==null)return null;const u=n.Pn(i.kind);co.Kt.Dt(l,u)}return n.un()}Ln(e){const t=new Ou;return co.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new Ou;return co.Kt.Dt(bo(this.databaseId,t),n.Pn((function(l){const u=ao(l);return u.length===0?0:u[u.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let i=[];i.push(new Ou);let l=0;for(const u of ao(e)){const h=n[l++];for(const m of i)if(this.Un(t,u.fieldPath)&&md(h))i=this.Kn(i,u,h);else{const p=m.Pn(u.kind);co.Kt.Dt(h,p)}}return this.Wn(i)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const i=[...e],l=[];for(const u of n.arrayValue.values||[])for(const h of i){const m=new Ou;m.seed(h.un()),co.Kt.Dt(u,m.Pn(t.kind)),l.push(m)}return l}Un(e,t){return!!e.filters.find((n=>n instanceof tt&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(e,t){const n=Lu(e),i=kl(e);return(t?n.J(Cy,IDBKeyRange.bound(t,t)):n.J()).next((l=>{const u=[];return X.forEach(l,(h=>i.get([h.indexId,this.uid]).next((m=>{u.push((function(x,b){const w=b?new Xl(b.sequenceNumber,new _s(So(b.readTime),new be(vr(b.documentKey)),b.largestBatchId)):Xl.empty(),N=x.fields.map((([V,D])=>new go(Rt.fromServerFormat(V),D)));return new Yl(x.indexId,x.collectionGroup,N,w)})(h,m))})))).next((()=>u))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((n,i)=>{const l=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return l!==0?l:Ve(n.collectionGroup,i.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,n){const i=Lu(e),l=kl(e);return this.Gn(e).next((u=>i.J(Cy,IDBKeyRange.bound(t,t)).next((h=>X.forEach(h,(m=>l.put(aT(m.indexId,this.uid,u,n))))))))}updateIndexEntries(e,t){const n=new Map;return X.forEach(t,((i,l)=>{const u=n.get(i.collectionGroup);return(u?X.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next((h=>(n.set(i.collectionGroup,h),X.forEach(h,(m=>this.zn(e,i,m).next((p=>{const x=this.jn(l,m);return p.isEqual(x)?X.resolve():this.Jn(e,l,m,p,x)})))))))}))}Hn(e,t,n,i){return Rl(e).put(i.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,i){return Rl(e).delete(i.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const i=Rl(e);let l=new xt(Ha);return i.ee({index:kS,range:IDBKeyRange.only([n.indexId,this.uid,kf(this.$n(n,t))])},((u,h)=>{l=l.add(new uo(n.indexId,t,uT(h.arrayValue),uT(h.directionalValue)))})).next((()=>l))}jn(e,t){let n=new xt(Ha);const i=this.Qn(t,e);if(i==null)return n;const l=Iy(t);if(l!=null){const u=e.data.field(l.fieldPath);if(md(u))for(const h of u.arrayValue.values||[])n=n.add(new uo(t.indexId,e.key,this.Ln(h),i))}else n=n.add(new uo(t.indexId,e.key,ff,i));return n}Jn(e,t,n,i,l){fe(fT,"Updating index entries for document '%s'",t.key);const u=[];return(function(m,p,x,b,w){const N=m.getIterator(),V=p.getIterator();let D=jl(N),q=jl(V);for(;D||q;){let z=!1,B=!1;if(D&&q){const L=x(D,q);L<0?B=!0:L>0&&(z=!0)}else D!=null?B=!0:z=!0;z?(b(q),q=jl(V)):B?(w(D),D=jl(N)):(D=jl(N),q=jl(V))}})(i,l,Ha,(h=>{u.push(this.Hn(e,t,n,h))}),(h=>{u.push(this.Yn(e,t,n,h))})),X.waitFor(u)}Gn(e){let t=1;return kl(e).ee({index:RS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,i,l)=>{l.done(),t=i.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((u,h)=>Ha(u,h))).filter(((u,h,m)=>!h||Ha(u,m[h-1])!==0));const i=[];i.push(e);for(const u of n){const h=Ha(u,e),m=Ha(u,t);if(h===0)i[0]=e.An();else if(h>0&&m<0)i.push(u),i.push(u.An());else if(m>0)break}i.push(t);const l=[];for(let u=0;u<i.length;u+=2){if(this.Zn(i[u],i[u+1]))return[];const h=i[u].Vn(this.uid,ff,be.empty()),m=i[u+1].Vn(this.uid,ff,be.empty());l.push(IDBKeyRange.bound(h,m))}return l}Zn(e,t){return Ha(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(gT)}getMinOffset(e,t){return X.mapArray(this.Mn(t),(n=>this.xn(e,n).next((i=>i||Se(44426))))).next(gT)}}function mT(s){return mn(s,ud)}function Rl(s){return mn(s,Wu)}function Lu(s){return mn(s,wx)}function kl(s){return mn(s,Xu)}function gT(s){je(s.length!==0,28825);let e=s[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<s.length;n++){const i=s[n].indexState.offset;vx(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new _s(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},FN=41943040;class On{static withCacheSize(e){return new On(e,On.DEFAULT_COLLECTION_PERCENTILE,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(s,e,t){const n=s.store($s),i=s.store(Wl),l=[],u=IDBKeyRange.only(t.batchId);let h=0;const m=n.ee({range:u},((x,b,w)=>(h++,w.delete())));l.push(m.next((()=>{je(h===1,47070,{batchId:t.batchId})})));const p=[];for(const x of t.mutations){const b=IS(e,x.key.path,t.batchId);l.push(i.delete(b)),p.push(x.key)}return X.waitFor(l).next((()=>p))}function em(s){if(!s)return 0;let e;if(s.document)e=s.document;else if(s.unknownDocument)e=s.unknownDocument;else{if(!s.noDocument)throw Se(14731);e=s.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */On.DEFAULT_COLLECTION_PERCENTILE=10,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,On.DEFAULT=new On(FN,On.DEFAULT_COLLECTION_PERCENTILE,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),On.DISABLED=new On(-1,0,0);class km{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Xn={}}static wt(e,t,n,i){je(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new km(l,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $a(e).ee({index:fo,range:n},((i,l,u)=>{t=!1,u.done()})).next((()=>t))}addMutationBatch(e,t,n,i){const l=Ul(e),u=$a(e);return u.add({}).next((h=>{je(typeof h=="number",49019);const m=new kx(h,t,n,i),p=(function(N,V,D){const q=D.baseMutations.map((B=>yd(N.yt,B))),z=D.mutations.map((B=>yd(N.yt,B)));return{userId:V,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:q,mutations:z}})(this.serializer,this.userId,m),x=[];let b=new xt(((w,N)=>Ve(w.canonicalString(),N.canonicalString())));for(const w of i){const N=IS(this.userId,w.key.path,h);b=b.add(w.key.path.popLast()),x.push(u.put(p)),x.push(l.put(N,fk))}return b.forEach((w=>{x.push(this.indexManager.addToCollectionParentIndex(e,w))})),e.addOnCommittedListener((()=>{this.Xn[h]=m.keys()})),X.waitFor(x).next((()=>m))}))}lookupMutationBatch(e,t){return $a(e).get(t).next((n=>n?(je(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),lo(this.serializer,n)):null))}er(e,t){return this.Xn[t]?X.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((n=>{if(n){const i=n.keys();return this.Xn[t]=i,i}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let l=null;return $a(e).ee({index:fo,range:i},((u,h,m)=>{h.userId===this.userId&&(je(h.batchId>=n,47524,{tr:n}),l=lo(this.serializer,h)),m.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=ai;return $a(e).ee({index:fo,range:t,reverse:!0},((i,l,u)=>{n=l.batchId,u.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ai],[this.userId,Number.POSITIVE_INFINITY]);return $a(e).J(fo,t).next((n=>n.map((i=>lo(this.serializer,i)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Sf(this.userId,t.path),i=IDBKeyRange.lowerBound(n),l=[];return Ul(e).ee({range:i},((u,h,m)=>{const[p,x,b]=u,w=vr(x);if(p===this.userId&&t.path.isEqual(w))return $a(e).get(b).next((N=>{if(!N)throw Se(61480,{nr:u,batchId:b});je(N.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:N.userId,batchId:b}),l.push(lo(this.serializer,N))}));m.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new xt(Ve);const i=[];return t.forEach((l=>{const u=Sf(this.userId,l.path),h=IDBKeyRange.lowerBound(u),m=Ul(e).ee({range:h},((p,x,b)=>{const[w,N,V]=p,D=vr(N);w===this.userId&&l.path.isEqual(D)?n=n.add(V):b.done()}));i.push(m)})),X.waitFor(i).next((()=>this.rr(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,l=Sf(this.userId,n),u=IDBKeyRange.lowerBound(l);let h=new xt(Ve);return Ul(e).ee({range:u},((m,p,x)=>{const[b,w,N]=m,V=vr(w);b===this.userId&&n.isPrefixOf(V)?V.length===i&&(h=h.add(N)):x.done()})).next((()=>this.rr(e,h)))}rr(e,t){const n=[],i=[];return t.forEach((l=>{i.push($a(e).get(l).next((u=>{if(u===null)throw Se(35274,{batchId:l});je(u.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:u.userId,batchId:l}),n.push(lo(this.serializer,u))})))})),X.waitFor(i).next((()=>n))}removeMutationBatch(e,t){return qN(e.le,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),X.forEach(n,(i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return X.resolve();const n=IDBKeyRange.lowerBound((function(u){return[u]})(this.userId)),i=[];return Ul(e).ee({range:n},((l,u,h)=>{if(l[0]===this.userId){const m=vr(l[1]);i.push(m)}else h.done()})).next((()=>{je(i.length===0,56720,{sr:i.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return BN(e,this.userId,t)}_r(e){return zN(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:ai,lastStreamToken:""}))}}function BN(s,e,t){const n=Sf(e,t.path),i=n[1],l=IDBKeyRange.lowerBound(n);let u=!1;return Ul(s).ee({range:l,X:!0},((h,m,p)=>{const[x,b,w]=h;x===e&&b===i&&(u=!0),p.done()})).next((()=>u))}function $a(s){return mn(s,$s)}function Ul(s){return mn(s,Wl)}function zN(s){return mn(s,ld)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new No(0)}static cr(){return new No(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const n=new No(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>Ce.fromTimestamp(new ht(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.lr(e).next((i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.hr(e,i))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Dl(e).delete(t.targetId))).next((()=>this.lr(e))).next((n=>(je(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n))))}removeTargets(e,t,n){let i=0;const l=[];return Dl(e).ee(((u,h)=>{const m=Gu(h);m.sequenceNumber<=t&&n.get(m.targetId)===null&&(i++,l.push(this.removeTargetData(e,m)))})).next((()=>X.waitFor(l))).next((()=>i))}forEachTarget(e,t){return Dl(e).ee(((n,i)=>{const l=Gu(i);t(l)}))}lr(e){return yT(e).get(Kf).next((t=>(je(t!==null,2888),t)))}hr(e,t){return yT(e).put(Kf,t)}Pr(e,t){return Dl(e).put(ON(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const n=_o(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let l=null;return Dl(e).ee({range:i,index:CS},((u,h,m)=>{const p=Gu(h);Ad(t,p.target)&&(l=p,m.done())})).next((()=>l))}addMatchingKeys(e,t,n){const i=[],l=Ja(e);return t.forEach((u=>{const h=Fn(u.path);i.push(l.put({targetId:n,path:h})),i.push(this.referenceDelegate.addReference(e,n,u))})),X.waitFor(i)}removeMatchingKeys(e,t,n){const i=Ja(e);return X.forEach(t,(l=>{const u=Fn(l.path);return X.waitFor([i.delete([n,u]),this.referenceDelegate.removeReference(e,n,l)])}))}removeMatchingKeysForTargetId(e,t){const n=Ja(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ja(e);let l=Be();return i.ee({range:n,X:!0},((u,h,m)=>{const p=vr(u[1]),x=new be(p);l=l.add(x)})).next((()=>l))}containsKey(e,t){const n=Fn(t.path),i=IDBKeyRange.bound([n],[xS(n)],!1,!0);let l=0;return Ja(e).ee({index:_x,X:!0,range:i},(([u,h],m,p)=>{u!==0&&(l++,p.done())})).next((()=>l>0))}At(e,t){return Dl(e).get(t).next((n=>n?Gu(n):null))}}function Dl(s){return mn(s,Jl)}function yT(s){return mn(s,po)}function Ja(s){return mn(s,Zl)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT="LruGarbageCollector",GN=1048576;function vT([s,e],[t,n]){const i=Ve(s,t);return i===0?Ve(e,n):i}class PD{constructor(e){this.Ir=e,this.buffer=new xt(vT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();vT(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class HN{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){fe(xT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){pi(t)?fe(xT,"Ignoring IndexedDB error during garbage collection: ",t):await gi(t)}await this.Vr(3e5)}))}}class MD{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return X.resolve(Zn.ce);const n=new PD(t);return this.mr.forEachTarget(e,(i=>n.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>n.Ar(i))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(fe("LruGarbageCollector","Garbage collection skipped; disabled"),X.resolve(pT)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),pT):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,l,u,h,m,p;const x=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((b=>(b>this.params.maximumSequenceNumbersToCollect?(fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),i=this.params.maximumSequenceNumbersToCollect):i=b,u=Date.now(),this.nthSequenceNumber(e,i)))).next((b=>(n=b,h=Date.now(),this.removeTargets(e,n,t)))).next((b=>(l=b,m=Date.now(),this.removeOrphanedDocuments(e,n)))).next((b=>(p=Date.now(),Vl()<=et.DEBUG&&fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-x}ms
	Determined least recently used ${i} in `+(h-u)+`ms
	Removed ${l} targets in `+(m-h)+`ms
	Removed ${b} documents in `+(p-m)+`ms
Total Duration: ${p-x}ms`),X.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:l,documentsRemoved:b}))))}}function $N(s,e){return new MD(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VD{constructor(e,t){this.db=e,this.garbageCollector=$N(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((n=>t.next((i=>n+i))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((n,i)=>t(i)))}addReference(e,t,n){return mf(e,n)}removeReference(e,t,n){return mf(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return mf(e,t)}br(e,t){return(function(i,l){let u=!1;return zN(i).te((h=>BN(i,h,l).next((m=>(m&&(u=!0),X.resolve(!m)))))).next((()=>u))})(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let l=0;return this.Sr(e,((u,h)=>{if(h<=t){const m=this.br(e,u).next((p=>{if(!p)return l++,n.getEntry(e,u).next((()=>(n.removeEntry(u,Ce.min()),Ja(e).delete((function(b){return[0,Fn(b.path)]})(u)))))}));i.push(m)}})).next((()=>X.waitFor(i))).next((()=>n.apply(e))).next((()=>l))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return mf(e,t)}Sr(e,t){const n=Ja(e);let i,l=Zn.ce;return n.ee({index:_x},(([u,h],{path:m,sequenceNumber:p})=>{u===0?(l!==Zn.ce&&t(new be(vr(i)),l),l=p,i=m):l=Zn.ce})).next((()=>{l!==Zn.ce&&t(new be(vr(i)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function mf(s,e){return Ja(s).put((function(n,i){return{targetId:0,path:Fn(n.path),sequenceNumber:i}})(e,s.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(){this.changes=new fa((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ct.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?X.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return so(e).put(n)}removeEntry(e,t,n){return so(e).delete((function(l,u){const h=l.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],Jf(u),h[h.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Dr(e,n))))}getEntry(e,t){let n=Ct.newInvalidDocument(t);return so(e).ee({index:Nf,range:IDBKeyRange.only(Uu(t))},((i,l)=>{n=this.Cr(t,l)})).next((()=>n))}vr(e,t){let n={size:0,document:Ct.newInvalidDocument(t)};return so(e).ee({index:Nf,range:IDBKeyRange.only(Uu(t))},((i,l)=>{n={document:this.Cr(t,l),size:em(l)}})).next((()=>n))}getEntries(e,t){let n=ts();return this.Fr(e,t,((i,l)=>{const u=this.Cr(i,l);n=n.insert(i,u)})).next((()=>n))}Mr(e,t){let n=ts(),i=new jt(be.comparator);return this.Fr(e,t,((l,u)=>{const h=this.Cr(l,u);n=n.insert(l,h),i=i.insert(l,em(u))})).next((()=>({documents:n,Or:i})))}Fr(e,t,n){if(t.isEmpty())return X.resolve();let i=new xt(wT);t.forEach((m=>i=i.add(m)));const l=IDBKeyRange.bound(Uu(i.first()),Uu(i.last())),u=i.getIterator();let h=u.getNext();return so(e).ee({index:Nf,range:l},((m,p,x)=>{const b=be.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;h&&wT(h,b)<0;)n(h,null),h=u.getNext();h&&h.isEqual(b)&&(n(h,p),h=u.hasNext()?u.getNext():null),h?x.j(Uu(h)):x.done()})).next((()=>{for(;h;)n(h,null),h=u.hasNext()?u.getNext():null}))}getDocumentsMatchingQuery(e,t,n,i,l){const u=t.path,h=[u.popLast().toArray(),u.lastSegment(),Jf(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],m=[u.popLast().toArray(),u.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return so(e).J(IDBKeyRange.bound(h,m,!0)).next((p=>{l?.incrementDocumentReadCount(p.length);let x=ts();for(const b of p){const w=this.Cr(be.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);w.isFoundDocument()&&(jd(t,w)||i.has(w.key))&&(x=x.insert(w.key,w))}return x}))}getAllFromCollectionGroup(e,t,n,i){let l=ts();const u=_T(t,n),h=_T(t,_s.max());return so(e).ee({index:jS,range:IDBKeyRange.bound(u,h,!0)},((m,p,x)=>{const b=this.Cr(be.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);l=l.insert(b.key,b),l.size===i&&x.done()})).next((()=>l))}newChangeBuffer(e){return new LD(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return bT(e).get(jy).next((t=>(je(!!t,20021),t)))}Dr(e,t){return bT(e).put(jy,t)}Cr(e,t){if(t){const n=TD(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Ce.min())))return n}return Ct.newInvalidDocument(e)}}function KN(s){return new OD(s)}class LD extends QN{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new fa((n=>n.toString()),((n,i)=>n.isEqual(i)))}applyChanges(e){const t=[];let n=0,i=new xt(((l,u)=>Ve(l.canonicalString(),u.canonicalString())));return this.changes.forEach(((l,u)=>{const h=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,h.readTime)),u.isValidDocument()){const m=sT(this.Nr.serializer,u);i=i.add(l.path.popLast());const p=em(m);n+=p-h.size,t.push(this.Nr.addEntry(e,l,m))}else if(n-=h.size,this.trackRemovals){const m=sT(this.Nr.serializer,u.convertToNoDocument(Ce.min()));t.push(this.Nr.addEntry(e,l,m))}})),i.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,n)),X.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:n,Or:i})=>(i.forEach(((l,u)=>{this.Br.set(l,{size:u,readTime:n.get(l).readTime})})),n)))}}function bT(s){return mn(s,cd)}function so(s){return mn(s,Qf)}function Uu(s){const e=s.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function _T(s,e){const t=e.documentKey.path.toArray();return[s,Jf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function wT(s,e){const t=s.path.toArray(),n=e.path.toArray();let i=0;for(let l=0;l<t.length-2&&l<n.length-2;++l)if(i=Ve(t[l],n[l]),i)return i;return i=Ve(t.length,n.length),i||(i=Ve(t[t.length-2],n[n.length-2]),i||Ve(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(n!==null&&ed(n.mutation,i,es.empty(),ht.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,Be()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=Be()){const i=br();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((l=>{let u=Bu();return l.forEach(((h,m)=>{u=u.insert(h,m.overlayedDocument)})),u}))))}getOverlayedDocuments(e,t){const n=br();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Be())))}populateOverlays(e,t,n){const i=[];return n.forEach((l=>{t.has(l)||i.push(l)})),this.documentOverlayCache.getOverlays(e,i).next((l=>{l.forEach(((u,h)=>{t.set(u,h)}))}))}computeViews(e,t,n,i){let l=ts();const u=Zu(),h=(function(){return Zu()})();return t.forEach(((m,p)=>{const x=n.get(p.key);i.has(p.key)&&(x===void 0||x.mutation instanceof ma)?l=l.insert(p.key,p):x!==void 0?(u.set(p.key,x.mutation.getFieldMask()),ed(x.mutation,p,x.mutation.getFieldMask(),ht.now())):u.set(p.key,es.empty())})),this.recalculateAndSaveOverlays(e,l).next((m=>(m.forEach(((p,x)=>u.set(p,x))),t.forEach(((p,x)=>h.set(p,new UD(x,u.get(p)??null)))),h)))}recalculateAndSaveOverlays(e,t){const n=Zu();let i=new jt(((u,h)=>u-h)),l=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((u=>{for(const h of u)h.keys().forEach((m=>{const p=t.get(m);if(p===null)return;let x=n.get(m)||es.empty();x=h.applyToLocalView(p,x),n.set(m,x);const b=(i.get(h.batchId)||Be()).add(m);i=i.insert(h.batchId,b)}))})).next((()=>{const u=[],h=i.getReverseIterator();for(;h.hasNext();){const m=h.getNext(),p=m.key,x=m.value,b=uN();x.forEach((w=>{if(!l.has(w)){const N=yN(t.get(w),n.get(w));N!==null&&b.set(w,N),l=l.add(w)}})),u.push(this.documentOverlayCache.saveOverlays(e,p,b))}return X.waitFor(u)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,i){return(function(u){return be.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ix(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((l=>{const u=i-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-l.size):X.resolve(br());let h=Kl,m=l;return u.next((p=>X.forEach(p,((x,b)=>(h<b.largestBatchId&&(h=b.largestBatchId),l.get(x)?X.resolve():this.remoteDocumentCache.getEntry(e,x).next((w=>{m=m.insert(x,w)}))))).next((()=>this.populateOverlays(e,p,l))).next((()=>this.computeViews(e,m,p,Be()))).next((x=>({batchId:h,changes:cN(x)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new be(t)).next((n=>{let i=Bu();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const l=t.collectionGroup;let u=Bu();return this.indexManager.getCollectionParents(e,l).next((h=>X.forEach(h,(m=>{const p=(function(b,w){return new ha(w,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)})(t,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,n,i).next((x=>{x.forEach(((b,w)=>{u=u.insert(b,w)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,t,n,i){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,l,i)))).next((u=>{l.forEach(((m,p)=>{const x=p.getKey();u.get(x)===null&&(u=u.insert(x,Ct.newInvalidDocument(x)))}));let h=Bu();return u.forEach(((m,p)=>{const x=l.get(m);x!==void 0&&ed(x.mutation,p,es.empty(),ht.now()),jd(t,p)&&(h=h.insert(m,p))})),h}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return X.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Wt(i.createTime)}})(t)),X.resolve()}getNamedQuery(e,t){return X.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:Cm(i.bundledQuery),readTime:Wt(i.readTime)}})(t)),X.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(){this.overlays=new jt(be.comparator),this.qr=new Map}getOverlay(e,t){return X.resolve(this.overlays.get(t))}getOverlays(e,t){const n=br();return X.forEach(t,(i=>this.getOverlay(e,i).next((l=>{l!==null&&n.set(i,l)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((i,l)=>{this.St(e,t,l)})),X.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return i!==void 0&&(i.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(n)),X.resolve()}getOverlaysForCollection(e,t,n){const i=br(),l=t.length+1,u=new be(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const m=h.getNext().value,p=m.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&m.largestBatchId>n&&i.set(m.getKey(),m)}return X.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let l=new jt(((p,x)=>p-x));const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>n){let x=l.get(p.largestBatchId);x===null&&(x=br(),l=l.insert(p.largestBatchId,x)),x.set(p.getKey(),p)}}const h=br(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach(((p,x)=>h.set(p,x))),!(h.size()>=i)););return X.resolve(h)}St(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const u=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(n.key,new Px(t,n));let l=this.qr.get(t);l===void 0&&(l=Be(),this.qr.set(t,l)),this.qr.set(t,l.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(){this.sessionToken=Ft.EMPTY_BYTE_STRING}getSessionToken(e){return X.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,X.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(){this.Qr=new xt(wn.$r),this.Ur=new xt(wn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new wn(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new wn(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new be(new Xe([])),n=new wn(t,e),i=new wn(t,e+1),l=[];return this.Ur.forEachInRange([n,i],(u=>{this.Gr(u),l.push(u.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new be(new Xe([])),n=new wn(t,e),i=new wn(t,e+1);let l=Be();return this.Ur.forEachInRange([n,i],(u=>{l=l.add(u.key)})),l}containsKey(e){const t=new wn(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class wn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return be.comparator(e.key,t.key)||Ve(e.Yr,t.Yr)}static Kr(e,t){return Ve(e.Yr,t.Yr)||be.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new xt(wn.$r)}checkEmpty(e){return X.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new kx(l,t,n,i);this.mutationQueue.push(u);for(const h of i)this.Zr=this.Zr.add(new wn(h.key,l)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return X.resolve(u)}lookupMutationBatch(e,t){return X.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),l=i<0?0:i;return X.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return X.resolve(this.mutationQueue.length===0?ai:this.tr-1)}getAllMutationBatches(e){return X.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new wn(t,0),i=new wn(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([n,i],(u=>{const h=this.Xr(u.Yr);l.push(h)})),X.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new xt(Ve);return t.forEach((i=>{const l=new wn(i,0),u=new wn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,u],(h=>{n=n.add(h.Yr)}))})),X.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let l=n;be.isDocumentKey(l)||(l=l.child(""));const u=new wn(new be(l),0);let h=new xt(Ve);return this.Zr.forEachWhile((m=>{const p=m.key.path;return!!n.isPrefixOf(p)&&(p.length===i&&(h=h.add(m.Yr)),!0)}),u),X.resolve(this.ti(h))}ti(e){const t=[];return e.forEach((n=>{const i=this.Xr(n);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){je(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return X.forEach(t.mutations,(i=>{const l=new wn(i.key,t.batchId);return n=n.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new wn(t,0),i=this.Zr.firstAfterOrEqual(n);return X.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,X.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(e){this.ri=e,this.docs=(function(){return new jt(be.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),l=i?i.size:0,u=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return X.resolve(n?n.document.mutableCopy():Ct.newInvalidDocument(t))}getEntries(e,t){let n=ts();return t.forEach((i=>{const l=this.docs.get(i);n=n.insert(i,l?l.document.mutableCopy():Ct.newInvalidDocument(i))})),X.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let l=ts();const u=t.path,h=new be(u.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(h);for(;m.hasNext();){const{key:p,value:{document:x}}=m.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||vx(TS(x),n)<=0||(i.has(x.key)||jd(t,x))&&(l=l.insert(x.key,x.mutableCopy()))}return X.resolve(l)}getAllFromCollectionGroup(e,t,n,i){Se(9500)}ii(e,t){return X.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new HD(this)}getSize(e){return X.resolve(this.size)}}class HD extends QN{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)})),X.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e){this.persistence=e,this.si=new fa((t=>_o(t)),Ad),this.lastRemoteSnapshotVersion=Ce.min(),this.highestTargetId=0,this.oi=0,this._i=new Ux,this.targetCount=0,this.ai=No.ur()}forEachTarget(e,t){return this.si.forEach(((n,i)=>t(i))),X.resolve()}getLastRemoteSnapshotVersion(e){return X.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return X.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),X.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),X.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new No(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,X.resolve()}updateTargetData(e,t){return this.Pr(t),X.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,X.resolve()}removeTargets(e,t,n){let i=0;const l=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=t&&n.get(h.targetId)===null&&(this.si.delete(u),l.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)})),X.waitFor(l).next((()=>i))}getTargetCount(e){return X.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return X.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),X.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,l=[];return i&&t.forEach((u=>{l.push(i.markPotentiallyOrphaned(e,u))})),X.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),X.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return X.resolve(n)}containsKey(e,t){return X.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fx{constructor(e,t){this.ui={},this.overlays={},this.ci=new Zn(0),this.li=!1,this.li=!0,this.hi=new BD,this.referenceDelegate=e(this),this.Pi=new $D(this),this.indexManager=new RD,this.remoteDocumentCache=(function(i){return new GD(i)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new VN(t),this.Ii=new FD(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new zD(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){fe("MemoryPersistence","Starting transaction:",e);const i=new QD(this.ci.next());return this.referenceDelegate.Ei(),n(i).next((l=>this.referenceDelegate.di(i).next((()=>l)))).toPromise().then((l=>(i.raiseOnCommittedEvent(),l)))}Ai(e,t){return X.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class QD extends SS{constructor(e){super(),this.currentSequenceNumber=e}}class Dm{constructor(e){this.persistence=e,this.Ri=new Ux,this.Vi=null}static mi(e){return new Dm(e)}get fi(){if(this.Vi)return this.Vi;throw Se(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),X.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),X.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),X.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((l=>this.fi.add(l.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return X.forEach(this.fi,(n=>{const i=be.fromPath(n);return this.gi(e,i).next((l=>{l||t.removeEntry(i,Ce.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return X.or([()=>X.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class tm{constructor(e,t){this.persistence=e,this.pi=new fa((n=>Fn(n.path)),((n,i)=>n.isEqual(i))),this.garbageCollector=$N(this,t)}static mi(e,t){return new tm(e,t)}Ei(){}di(e){return X.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((i=>n+i))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return X.forEach(this.pi,((n,i)=>this.br(e,n,i).next((l=>l?X.resolve():t(i)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),l=i.newChangeBuffer();return i.ii(e,(u=>this.br(e,u,t).next((h=>{h||(n++,l.removeEntry(u,Ce.min()))})))).next((()=>l.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),X.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),X.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),X.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),X.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=If(e.data.value)),t}br(e,t,n){return X.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return X.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e){this.serializer=e}k(e,t,n,i){const l=new vm("createOrUpgrade",t);n<1&&i>=1&&((function(m){m.createObjectStore(Nd)})(e),(function(m){m.createObjectStore(ld,{keyPath:hk}),m.createObjectStore($s,{keyPath:Dw,autoIncrement:!0}).createIndex(fo,Pw,{unique:!0}),m.createObjectStore(Wl)})(e),TT(e),(function(m){m.createObjectStore(io)})(e));let u=X.resolve();return n<3&&i>=3&&(n!==0&&((function(m){m.deleteObjectStore(Zl),m.deleteObjectStore(Jl),m.deleteObjectStore(po)})(e),TT(e)),u=u.next((()=>(function(m){const p=m.store(po),x={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ce.min().toTimestamp(),targetCount:0};return p.put(Kf,x)})(l)))),n<4&&i>=4&&(n!==0&&(u=u.next((()=>(function(m,p){return p.store($s).J().next((b=>{m.deleteObjectStore($s),m.createObjectStore($s,{keyPath:Dw,autoIncrement:!0}).createIndex(fo,Pw,{unique:!0});const w=p.store($s),N=b.map((V=>w.put(V)));return X.waitFor(N)}))})(e,l)))),u=u.next((()=>{(function(m){m.createObjectStore(ec,{keyPath:_k})})(e)}))),n<5&&i>=5&&(u=u.next((()=>this.yi(l)))),n<6&&i>=6&&(u=u.next((()=>((function(m){m.createObjectStore(cd)})(e),this.wi(l))))),n<7&&i>=7&&(u=u.next((()=>this.Si(l)))),n<8&&i>=8&&(u=u.next((()=>this.bi(e,l)))),n<9&&i>=9&&(u=u.next((()=>{(function(m){m.objectStoreNames.contains("remoteDocumentChanges")&&m.deleteObjectStore("remoteDocumentChanges")})(e)}))),n<10&&i>=10&&(u=u.next((()=>this.Di(l)))),n<11&&i>=11&&(u=u.next((()=>{(function(m){m.createObjectStore(bm,{keyPath:wk})})(e),(function(m){m.createObjectStore(_m,{keyPath:Tk})})(e)}))),n<12&&i>=12&&(u=u.next((()=>{(function(m){const p=m.createObjectStore(wm,{keyPath:Ck});p.createIndex(Ry,Rk,{unique:!1}),p.createIndex(DS,kk,{unique:!1})})(e)}))),n<13&&i>=13&&(u=u.next((()=>(function(m){const p=m.createObjectStore(Qf,{keyPath:mk});p.createIndex(Nf,gk),p.createIndex(jS,pk)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(io)))),n<14&&i>=14&&(u=u.next((()=>this.Fi(e,l)))),n<15&&i>=15&&(u=u.next((()=>(function(m){m.createObjectStore(wx,{keyPath:Ek,autoIncrement:!0}).createIndex(Cy,Sk,{unique:!1}),m.createObjectStore(Xu,{keyPath:Nk}).createIndex(RS,Ak,{unique:!1}),m.createObjectStore(Wu,{keyPath:Ik}).createIndex(kS,jk,{unique:!1})})(e)))),n<16&&i>=16&&(u=u.next((()=>{t.objectStore(Xu).clear()})).next((()=>{t.objectStore(Wu).clear()}))),n<17&&i>=17&&(u=u.next((()=>{(function(m){m.createObjectStore(Tx,{keyPath:Dk})})(e)}))),n<18&&i>=18&&_E()&&(u=u.next((()=>{t.objectStore(Xu).clear()})).next((()=>{t.objectStore(Wu).clear()}))),u}wi(e){let t=0;return e.store(io).ee(((n,i)=>{t+=em(i)})).next((()=>{const n={byteSize:t};return e.store(cd).put(jy,n)}))}yi(e){const t=e.store(ld),n=e.store($s);return t.J().next((i=>X.forEach(i,(l=>{const u=IDBKeyRange.bound([l.userId,ai],[l.userId,l.lastAcknowledgedBatchId]);return n.J(fo,u).next((h=>X.forEach(h,(m=>{je(m.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:m.batchId});const p=lo(this.serializer,m);return qN(e,l.userId,p).next((()=>{}))}))))}))))}Si(e){const t=e.store(Zl),n=e.store(io);return e.store(po).get(Kf).next((i=>{const l=[];return n.ee(((u,h)=>{const m=new Xe(u),p=(function(b){return[0,Fn(b)]})(m);l.push(t.get(p).next((x=>x?X.resolve():(b=>t.put({targetId:0,path:Fn(b),sequenceNumber:i.highestListenSequenceNumber}))(m))))})).next((()=>X.waitFor(l)))}))}bi(e,t){e.createObjectStore(ud,{keyPath:bk});const n=t.store(ud),i=new Lx,l=u=>{if(i.add(u)){const h=u.lastSegment(),m=u.popLast();return n.put({collectionId:h,parent:Fn(m)})}};return t.store(io).ee({X:!0},((u,h)=>{const m=new Xe(u);return l(m.popLast())})).next((()=>t.store(Wl).ee({X:!0},(([u,h,m],p)=>{const x=vr(h);return l(x.popLast())}))))}Di(e){const t=e.store(Jl);return t.ee(((n,i)=>{const l=Gu(i),u=ON(this.serializer,l);return t.put(u)}))}Ci(e,t){const n=t.store(io),i=[];return n.ee(((l,u)=>{const h=t.store(Qf),m=(function(b){return b.document?new be(Xe.fromString(b.document.name).popFirst(5)):b.noDocument?be.fromSegments(b.noDocument.path):b.unknownDocument?be.fromSegments(b.unknownDocument.path):Se(36783)})(u).path.toArray(),p={prefixPath:m.slice(0,m.length-2),collectionGroup:m[m.length-2],documentId:m[m.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(h.put(p))})).next((()=>X.waitFor(i)))}Fi(e,t){const n=t.store($s),i=KN(this.serializer),l=new Fx(Dm.mi,this.serializer.yt);return n.J().next((u=>{const h=new Map;return u.forEach((m=>{let p=h.get(m.userId)??Be();lo(this.serializer,m).keys().forEach((x=>p=p.add(x))),h.set(m.userId,p)})),X.forEach(h,((m,p)=>{const x=new Tn(p),b=Rm.wt(this.serializer,x),w=l.getIndexManager(x),N=km.wt(x,this.serializer,w,l.referenceDelegate);return new YN(i,N,b,w).recalculateAndSaveOverlaysForDocumentKeys(new ky(t,Zn.ce),m).next()}))}))}}function TT(s){s.createObjectStore(Zl,{keyPath:xk}).createIndex(_x,vk,{unique:!0}),s.createObjectStore(Jl,{keyPath:"targetId"}).createIndex(CS,yk,{unique:!0}),s.createObjectStore(po)}const Qa="IndexedDbPersistence",iy=18e5,oy=5e3,ly="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",XN="main";class qx{constructor(e,t,n,i,l,u,h,m,p,x,b=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=l,this.window=u,this.document=h,this.xi=p,this.Oi=x,this.Ni=b,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=w=>Promise.resolve(),!qx.v())throw new ue(ee.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new VD(this,i),this.$i=t+XN,this.serializer=new VN(m),this.Ui=new wr(this.$i,this.Ni,new KD(this.serializer)),this.hi=new SD,this.Pi=new DD(this.referenceDelegate,this.serializer),this.remoteDocumentCache=KN(this.serializer),this.Ii=new ED,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,x===!1&&Xt(Qa,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ue(ee.FAILED_PRECONDITION,ly);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new Zn(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>gf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(pi(e))return fe(Qa,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return fe(Qa,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Fu(e).get(Il).next((t=>X.resolve(this.es(t))))}ts(e){return gf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,iy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const n=mn(t,ec);return n.J().next((i=>{const l=this.ss(i,iy),u=i.filter((h=>l.indexOf(h)===-1));return X.forEach(u,(h=>n.delete(h.clientId))).next((()=>u))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?X.resolve(!0):Fu(e).get(Il).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,oy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new ue(ee.FAILED_PRECONDITION,ly);return!1}}return!(!this.networkEnabled||!this.inForeground)||gf(e).J().next((n=>this.ss(n,oy).find((i=>{if(this.clientId!==i.clientId){const l=!this.networkEnabled&&i.networkEnabled,u=!this.inForeground&&i.inForeground,h=this.networkEnabled===i.networkEnabled;if(l||u&&h)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&fe(Qa,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Nd,ec],(e=>{const t=new ky(e,Zn.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>gf(e).J().next((t=>this.ss(t,iy).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return km.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new kD(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Rm.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){fe(Qa,"Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",l=(function(m){return m===18?Vk:m===17?OS:m===16?Mk:m===15?Ex:m===14?VS:m===13?MS:m===12?Pk:m===11?PS:void Se(60245)})(this.Ni);let u;return this.Ui.runTransaction(e,i,l,(h=>(u=new ky(h,this.ci?this.ci.next():Zn.ce),t==="readwrite-primary"?this.Hi(u).next((m=>!!m||this.Yi(u))).next((m=>{if(!m)throw Xt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new ue(ee.FAILED_PRECONDITION,ES);return n(u)})).next((m=>this.Xi(u).next((()=>m)))):this.Is(u).next((()=>n(u)))))).then((h=>(u.raiseOnCommittedEvent(),h)))}Is(e){return Fu(e).get(Il).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,oy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ue(ee.FAILED_PRECONDITION,ly)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Fu(e).put(Il,t)}static v(){return wr.v()}Zi(e){const t=Fu(e);return t.get(Il).next((n=>this.es(n)?(fe(Qa,"Releasing primary lease."),t.delete(Il)):X.resolve()))}rs(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Xt(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;bE()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return fe(Qa,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Xt(Qa,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Xt("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Fu(s){return mn(s,Nd)}function gf(s){return mn(s,ec)}function Bx(s,e){let t=s.projectId;return s.isDefaultDatabase||(t+="."+s.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=Be(),i=Be();for(const l of t.docChanges)switch(l.type){case 0:n=n.add(l.doc.key);break;case 1:i=i.add(l.doc.key)}return new zx(e,t.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return bE()?8:NS(hn())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const l={result:null};return this.ys(e,t).next((u=>{l.result=u})).next((()=>{if(!l.result)return this.ws(e,t,i,n).next((u=>{l.result=u}))})).next((()=>{if(l.result)return;const u=new YD;return this.Ss(e,t,u).next((h=>{if(l.result=h,this.Vs)return this.bs(e,t,u,h.size)}))})).next((()=>l.result))}bs(e,t,n,i){return n.documentReadCount<this.fs?(Vl()<=et.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",Ol(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),X.resolve()):(Vl()<=et.DEBUG&&fe("QueryEngine","Query:",Ol(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(Vl()<=et.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",Ol(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qn(t))):X.resolve())}ys(e,t){if(Qw(t))return X.resolve(null);let n=qn(t);return this.indexManager.getIndexType(e,n).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Wf(t,null,"F"),n=qn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((l=>{const u=Be(...l);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,n).next((m=>{const p=this.Ds(t,h);return this.Cs(t,p,u,m.readTime)?this.ys(e,Wf(t,null,"F")):this.vs(e,p,t,m)}))))})))))}ws(e,t,n,i){return Qw(t)||i.isEqual(Ce.min())?X.resolve(null):this.ps.getDocuments(e,n).next((l=>{const u=this.Ds(t,l);return this.Cs(t,u,n,i)?X.resolve(null):(Vl()<=et.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ol(t)),this.vs(e,u,t,wS(i,Kl)).next((h=>h)))}))}Ds(e,t){let n=new xt(oN(e));return t.forEach(((i,l)=>{jd(e,l)&&(n=n.add(l))})),n}Cs(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(i)>0)}Ss(e,t,n){return Vl()<=et.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",Ol(t)),this.ps.getDocumentsMatchingQuery(e,t,_s.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next((l=>(t.forEach((u=>{l=l.insert(u.key,u)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx="LocalStore",XD=3e8;class WD{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new jt(Ve),this.xs=new fa((l=>_o(l)),Ad),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new YN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function JN(s,e,t,n){return new WD(s,e,t,n)}async function ZN(s,e){const t=_e(s);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next((l=>(i=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((l=>{const u=[],h=[];let m=Be();for(const p of i){u.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}for(const p of l){h.push(p.batchId);for(const x of p.mutations)m=m.add(x.key)}return t.localDocuments.getDocuments(n,m).next((p=>({Ls:p,removedBatchIds:u,addedBatchIds:h})))}))}))}function JD(s,e){const t=_e(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const i=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,m,p,x){const b=p.batch,w=b.keys();let N=X.resolve();return w.forEach((V=>{N=N.next((()=>x.getEntry(m,V))).next((D=>{const q=p.docVersions.get(V);je(q!==null,48541),D.version.compareTo(q)<0&&(b.applyToRemoteDocument(D,p),D.isValidDocument()&&(D.setReadTime(p.commitVersion),x.addEntry(D)))}))})),N.next((()=>h.mutationQueue.removeMutationBatch(m,b)))})(t,n,e,l).next((()=>l.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(h){let m=Be();for(let p=0;p<h.mutationResults.length;++p)h.mutationResults[p].transformResults.length>0&&(m=m.add(h.batch.mutations[p].key));return m})(e)))).next((()=>t.localDocuments.getDocuments(n,i)))}))}function eA(s){const e=_e(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ZD(s,e){const t=_e(s),n=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const u=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const h=[];e.targetChanges.forEach(((x,b)=>{const w=i.get(b);if(!w)return;h.push(t.Pi.removeMatchingKeys(l,x.removedDocuments,b).next((()=>t.Pi.addMatchingKeys(l,x.addedDocuments,b))));let N=w.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(b)!==null?N=N.withResumeToken(Ft.EMPTY_BYTE_STRING,Ce.min()).withLastLimboFreeSnapshotVersion(Ce.min()):x.resumeToken.approximateByteSize()>0&&(N=N.withResumeToken(x.resumeToken,n)),i=i.insert(b,N),(function(D,q,z){return D.resumeToken.approximateByteSize()===0||q.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=XD?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0})(w,N,x)&&h.push(t.Pi.updateTargetData(l,N))}));let m=ts(),p=Be();if(e.documentUpdates.forEach((x=>{e.resolvedLimboDocuments.has(x)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(l,x))})),h.push(tA(l,u,e.documentUpdates).next((x=>{m=x.ks,p=x.qs}))),!n.isEqual(Ce.min())){const x=t.Pi.getLastRemoteSnapshotVersion(l).next((b=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,n)));h.push(x)}return X.waitFor(h).next((()=>u.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,m,p))).next((()=>m))})).then((l=>(t.Ms=i,l)))}function tA(s,e,t){let n=Be(),i=Be();return t.forEach((l=>n=n.add(l))),e.getEntries(s,n).next((l=>{let u=ts();return t.forEach(((h,m)=>{const p=l.get(h);m.isFoundDocument()!==p.isFoundDocument()&&(i=i.add(h)),m.isNoDocument()&&m.version.isEqual(Ce.min())?(e.removeEntry(h,m.readTime),u=u.insert(h,m)):!p.isValidDocument()||m.version.compareTo(p.version)>0||m.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(m),u=u.insert(h,m)):fe(Gx,"Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",m.version)})),{ks:u,qs:i}}))}function eP(s,e){const t=_e(s);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=ai),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function oc(s,e){const t=_e(s);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let i;return t.Pi.getTargetData(n,e).next((l=>l?(i=l,X.resolve(i)):t.Pi.allocateTargetId(n).next((u=>(i=new aa(e,u,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,i).next((()=>i)))))))})).then((n=>{const i=t.Ms.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function lc(s,e,t){const n=_e(s),i=n.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",l,(u=>n.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!pi(u))throw u;fe(Gx,`Failed to update sequence numbers for target ${e}: ${u}`)}n.Ms=n.Ms.remove(e),n.xs.delete(i.target)}function nm(s,e,t){const n=_e(s);let i=Ce.min(),l=Be();return n.persistence.runTransaction("Execute query","readwrite",(u=>(function(m,p,x){const b=_e(m),w=b.xs.get(x);return w!==void 0?X.resolve(b.Ms.get(w)):b.Pi.getTargetData(p,x)})(n,u,qn(e)).next((h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(u,h.targetId).next((m=>{l=m}))})).next((()=>n.Fs.getDocumentsMatchingQuery(u,e,t?i:Ce.min(),t?l:Be()))).next((h=>(rA(n,iN(e),h),{documents:h,Qs:l})))))}function nA(s,e){const t=_e(s),n=_e(t.Pi),i=t.Ms.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",(l=>n.At(l,e).next((u=>u?u.target:null))))}function sA(s,e){const t=_e(s),n=t.Os.get(e)||Ce.min();return t.persistence.runTransaction("Get new document changes","readonly",(i=>t.Ns.getAllFromCollectionGroup(i,e,wS(n,Kl),Number.MAX_SAFE_INTEGER))).then((i=>(rA(t,e,i),i)))}function rA(s,e,t){let n=s.Os.get(e)||Ce.min();t.forEach(((i,l)=>{l.readTime.compareTo(n)>0&&(n=l.readTime)})),s.Os.set(e,n)}async function tP(s,e,t,n){const i=_e(s);let l=Be(),u=ts();for(const p of t){const x=e.$s(p.metadata.name);p.document&&(l=l.add(x));const b=e.Us(p);b.setReadTime(e.Ks(p.metadata.readTime)),u=u.insert(x,b)}const h=i.Ns.newChangeBuffer({trackRemovals:!0}),m=await oc(i,(function(x){return qn(xc(Xe.fromString(`__bundle__/docs/${x}`)))})(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",(p=>tA(p,h,u).next((x=>(h.apply(p),x))).next((x=>i.Pi.removeMatchingKeysForTargetId(p,m.targetId).next((()=>i.Pi.addMatchingKeys(p,l,m.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(p,x.ks,x.qs))).next((()=>x.ks))))))}async function nP(s,e,t=Be()){const n=await oc(s,qn(Cm(e.bundledQuery))),i=_e(s);return i.persistence.runTransaction("Save named query","readwrite",(l=>{const u=Wt(e.readTime);if(n.snapshotVersion.compareTo(u)>=0)return i.Ii.saveNamedQuery(l,e);const h=n.withResumeToken(Ft.EMPTY_BYTE_STRING,u);return i.Ms=i.Ms.insert(h.targetId,h),i.Pi.updateTargetData(l,h).next((()=>i.Pi.removeMatchingKeysForTargetId(l,n.targetId))).next((()=>i.Pi.addMatchingKeys(l,t,n.targetId))).next((()=>i.Ii.saveNamedQuery(l,e)))}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aA="firestore_clients";function ET(s,e){return`${aA}_${s}_${e}`}const iA="firestore_mutations";function ST(s,e,t){let n=`${iA}_${s}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}const oA="firestore_targets";function cy(s,e){return`${oA}_${s}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yr="SharedClientState";class sm{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Ws(e,t,n){const i=JSON.parse(n);let l,u=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return u&&i.error&&(u=typeof i.error.message=="string"&&typeof i.error.code=="string",u&&(l=new ue(i.error.code,i.error.message))),u?new sm(e,t,i.state,l):(Xt(yr,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class td{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ws(e,t){const n=JSON.parse(t);let i,l=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return l&&n.error&&(l=typeof n.error.message=="string"&&typeof n.error.code=="string",l&&(i=new ue(n.error.code,n.error.message))),l?new td(e,n.state,i):(Xt(yr,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class rm{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const n=JSON.parse(t);let i=typeof n=="object"&&n.activeTargetIds instanceof Array,l=jx();for(let u=0;i&&u<n.activeTargetIds.length;++u)i=AS(n.activeTargetIds[u]),l=l.add(n.activeTargetIds[u]);return i?new rm(e,l):(Xt(yr,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hx{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Hx(t.clientId,t.onlineState):(Xt(yr,`Failed to parse online state: ${e}`),null)}}class Qy{constructor(){this.activeTargetIds=jx()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uy{constructor(e,t,n,i,l){this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new jt(Ve),this.started=!1,this.Xs=[];const u=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=l,this.eo=ET(this.persistenceKey,this.Js),this.no=(function(m){return`firestore_sequence_number_${m}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Qy),this.ro=new RegExp(`^${aA}_${u}_([^_]*)$`),this.io=new RegExp(`^${iA}_${u}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${oA}_${u}_(\\d+)$`),this.oo=(function(m){return`firestore_online_state_${m}`})(this.persistenceKey),this._o=(function(m){return`firestore_bundle_loaded_v2_${m}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const n of e){if(n===this.Js)continue;const i=this.getItem(ET(this.persistenceKey,n));if(i){const l=rm.Ws(n,i);l&&(this.Zs=this.Zs.insert(l.clientId,l))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const n=this.uo(t);n&&this.co(n)}for(const n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(cy(this.persistenceKey,e));if(i){const l=td.Ws(e,i);l&&(n=l.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(cy(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach((i=>{this.Po(i)})),this.currentUser=e,n.forEach((i=>{this.addPendingMutation(i)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return fe(yr,"READ",e,t),t}setItem(e,t){fe(yr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){fe(yr,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(fe(yr,"EVENT",t.key,t.newValue),t.key===this.eo)return void Xt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const n=this.Ro(t.key);return this.Vo(n,null)}{const n=this.mo(t.key,t.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(t.key)){if(t.newValue!==null){const n=this.fo(t.key,t.newValue);if(n)return this.po(n)}}else if(this.so.test(t.key)){if(t.newValue!==null){const n=this.yo(t.key,t.newValue);if(n)return this.wo(n)}}else if(t.key===this.oo){if(t.newValue!==null){const n=this.uo(t.newValue);if(n)return this.co(n)}}else if(t.key===this.no){const n=(function(l){let u=Zn.ce;if(l!=null)try{const h=JSON.parse(l);je(typeof h=="number",30636,{So:l}),u=h}catch(h){Xt(yr,"Failed to read sequence number from WebStorage",h)}return u})(t.newValue);n!==Zn.ce&&this.sequenceNumberHandler(n)}else if(t.key===this._o){const n=this.bo(t.newValue);await Promise.all(n.map((i=>this.syncEngine.Do(i))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){const i=new sm(this.currentUser,e,t,n),l=ST(this.persistenceKey,this.currentUser,e);this.setItem(l,i.Gs())}Po(e){const t=ST(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){const i=cy(this.persistenceKey,e),l=new td(e,t,n);this.setItem(i,l.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const n=this.Ro(e);return rm.Ws(n,t)}fo(e,t){const n=this.io.exec(e),i=Number(n[1]),l=n[2]!==void 0?n[2]:null;return sm.Ws(new Tn(l),i,t)}yo(e,t){const n=this.so.exec(e),i=Number(n[1]);return td.Ws(i,t)}uo(e){return Hx.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);fe(yr,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const n=t?this.Zs.insert(e,t):this.Zs.remove(e),i=this.lo(this.Zs),l=this.lo(n),u=[],h=[];return l.forEach((m=>{i.has(m)||u.push(m)})),i.forEach((m=>{l.has(m)||h.push(m)})),this.syncEngine.Fo(u,h).then((()=>{this.Zs=n}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=jx();return e.forEach(((n,i)=>{t=t.unionWith(i.activeTargetIds)})),t}}class lA{constructor(){this.Mo=new Qy,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Qy,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NT="ConnectivityMonitor";class AT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){fe(NT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){fe(NT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pf=null;function Ky(){return pf===null?pf=(function(){return 268435456+Math.round(2147483648*Math.random())})():pf++,"0x"+pf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dy="RestConnection",rP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aP{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===hd?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,l){const u=Ky(),h=this.zo(e,t.toUriEncodedString());fe(dy,`Sending RPC '${e}' ${u}:`,h,n);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,i,l);const{host:p}=new URL(h),x=mi(p);return this.Jo(e,h,m,n,x).then((b=>(fe(dy,`Received RPC '${e}' ${u}: `,b),b)),(b=>{throw bs(dy,`RPC '${e}' ${u} failed with error: `,b,"url: ",h,"request:",n),b}))}Ho(e,t,n,i,l,u){return this.Go(e,t,n,i,l)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+yc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,l)=>e[l]=i)),n&&n.headers.forEach(((i,l)=>e[l]=i))}zo(e,t){const n=rP[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vn="WebChannelConnection";class oP extends aP{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,l){const u=Ky();return new Promise(((h,m)=>{const p=new uS;p.setWithCredentials(!0),p.listenOnce(dS.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case Ef.NO_ERROR:const b=p.getResponseJson();fe(Vn,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(b)),h(b);break;case Ef.TIMEOUT:fe(Vn,`RPC '${e}' ${u} timed out`),m(new ue(ee.DEADLINE_EXCEEDED,"Request time out"));break;case Ef.HTTP_ERROR:const w=p.getStatus();if(fe(Vn,`RPC '${e}' ${u} failed with status:`,w,"response text:",p.getResponseText()),w>0){let N=p.getResponseJson();Array.isArray(N)&&(N=N[0]);const V=N?.error;if(V&&V.status&&V.message){const D=(function(z){const B=z.toLowerCase().replace(/_/g,"-");return Object.values(ee).indexOf(B)>=0?B:ee.UNKNOWN})(V.status);m(new ue(D,V.message))}else m(new ue(ee.UNKNOWN,"Server responded with status "+p.getStatus()))}else m(new ue(ee.UNAVAILABLE,"Connection failed."));break;default:Se(9055,{l_:e,streamId:u,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{fe(Vn,`RPC '${e}' ${u} completed.`)}}));const x=JSON.stringify(i);fe(Vn,`RPC '${e}' ${u} sending request:`,i),p.send(t,"POST",x,n,15)}))}T_(e,t,n){const i=Ky(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=mS(),h=fS(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(m.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,n),m.encodeInitMessageHeaders=!0;const x=l.join("");fe(Vn,`Creating RPC '${e}' stream ${i}: ${x}`,m);const b=u.createWebChannel(x,m);this.I_(b);let w=!1,N=!1;const V=new iP({Yo:q=>{N?fe(Vn,`Not sending because RPC '${e}' stream ${i} is closed:`,q):(w||(fe(Vn,`Opening RPC '${e}' stream ${i} transport.`),b.open(),w=!0),fe(Vn,`RPC '${e}' stream ${i} sending:`,q),b.send(q))},Zo:()=>b.close()}),D=(q,z,B)=>{q.listen(z,(L=>{try{B(L)}catch(G){setTimeout((()=>{throw G}),0)}}))};return D(b,qu.EventType.OPEN,(()=>{N||(fe(Vn,`RPC '${e}' stream ${i} transport opened.`),V.o_())})),D(b,qu.EventType.CLOSE,(()=>{N||(N=!0,fe(Vn,`RPC '${e}' stream ${i} transport closed`),V.a_(),this.E_(b))})),D(b,qu.EventType.ERROR,(q=>{N||(N=!0,bs(Vn,`RPC '${e}' stream ${i} transport errored. Name:`,q.name,"Message:",q.message),V.a_(new ue(ee.UNAVAILABLE,"The operation could not be completed")))})),D(b,qu.EventType.MESSAGE,(q=>{if(!N){const z=q.data[0];je(!!z,16349);const B=z,L=B?.error||B[0]?.error;if(L){fe(Vn,`RPC '${e}' stream ${i} received error:`,L);const G=L.status;let H=(function(T){const A=nn[T];if(A!==void 0)return _N(A)})(G),R=L.message;H===void 0&&(H=ee.INTERNAL,R="Unknown error status: "+G+" with message "+L.message),N=!0,V.a_(new ue(H,R)),b.close()}else fe(Vn,`RPC '${e}' stream ${i} received:`,z),V.u_(z)}})),D(h,hS.STAT_EVENT,(q=>{q.stat===Ey.PROXY?fe(Vn,`RPC '${e}' stream ${i} detected buffering proxy`):q.stat===Ey.NOPROXY&&fe(Vn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{V.__()}),0),V}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cA(){return typeof window<"u"?window:null}function Df(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(s){return new fD(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e,t,n=1e3,i=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&fe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IT="PersistentStream";class uA{constructor(e,t,n,i,l,u,h,m){this.Mi=e,this.S_=n,this.b_=i,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new $x(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ee.RESOURCE_EXHAUSTED?(Xt(t.toString()),Xt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ee.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,i])=>{this.D_===t&&this.G_(n,i)}),(n=>{e((()=>{const i=new ue(ee.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(i)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{n((()=>this.z_(i)))})),this.stream.onMessage((i=>{n((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return fe(IT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(fe(IT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class lP extends uA{constructor(e,t,n,i,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,u),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=pD(this.serializer,e),n=(function(l){if(!("targetChange"in l))return Ce.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?Ce.min():u.readTime?Wt(u.readTime):Ce.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=By(this.serializer),t.addTarget=(function(l,u){let h;const m=u.target;if(h=Yf(m)?{documents:CN(l,m)}:{query:jm(l,m).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=SN(l,u.resumeToken);const p=Fy(l,u.expectedCount);p!==null&&(h.expectedCount=p)}else if(u.snapshotVersion.compareTo(Ce.min())>0){h.readTime=ic(l,u.snapshotVersion.toTimestamp());const p=Fy(l,u.expectedCount);p!==null&&(h.expectedCount=p)}return h})(this.serializer,e);const n=xD(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=By(this.serializer),t.removeTarget=e,this.q_(t)}}class cP extends uA{constructor(e,t,n,i,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,u),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return je(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,je(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){je(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=yD(e.writeResults,e.commitTime),n=Wt(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=By(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>yd(this.serializer,n)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{}class dP extends uP{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new ue(ee.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Go(e,qy(t,n),i,l,u))).catch((l=>{throw l.name==="FirebaseError"?(l.code===ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new ue(ee.UNKNOWN,l.toString())}))}Ho(e,t,n,i,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,qy(t,n),i,u,h,l))).catch((u=>{throw u.name==="FirebaseError"?(u.code===ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new ue(ee.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class hP{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Xt(t),this.aa=!1):fe("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ao="RemoteStore";class fP{constructor(e,t,n,i,l){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((u=>{n.enqueueAndForget((async()=>{xi(this)&&(fe(Ao,"Restarting streams for network reachability change."),await(async function(m){const p=_e(m);p.Ea.add(4),await _c(p),p.Ra.set("Unknown"),p.Ea.delete(4),await Dd(p)})(this))}))})),this.Ra=new hP(n,i)}}async function Dd(s){if(xi(s))for(const e of s.da)await e(!0)}async function _c(s){for(const e of s.da)await e(!1)}function Pm(s,e){const t=_e(s);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Yx(t)?Kx(t):Tc(t).O_()&&Qx(t,e))}function cc(s,e){const t=_e(s),n=Tc(t);t.Ia.delete(e),n.O_()&&dA(t,e),t.Ia.size===0&&(n.O_()?n.L_():xi(t)&&t.Ra.set("Unknown"))}function Qx(s,e){if(s.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ce.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Tc(s).Y_(e)}function dA(s,e){s.Va.Ue(e),Tc(s).Z_(e)}function Kx(s){s.Va=new cD({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),At:e=>s.Ia.get(e)||null,ht:()=>s.datastore.serializer.databaseId}),Tc(s).start(),s.Ra.ua()}function Yx(s){return xi(s)&&!Tc(s).x_()&&s.Ia.size>0}function xi(s){return _e(s).Ea.size===0}function hA(s){s.Va=void 0}async function mP(s){s.Ra.set("Online")}async function gP(s){s.Ia.forEach(((e,t)=>{Qx(s,e)}))}async function pP(s,e){hA(s),Yx(s)?(s.Ra.ha(e),Kx(s)):s.Ra.set("Unknown")}async function yP(s,e,t){if(s.Ra.set("Online"),e instanceof EN&&e.state===2&&e.cause)try{await(async function(i,l){const u=l.cause;for(const h of l.targetIds)i.Ia.has(h)&&(await i.remoteSyncer.rejectListen(h,u),i.Ia.delete(h),i.Va.removeTarget(h))})(s,e)}catch(n){fe(Ao,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await am(s,n)}else if(e instanceof Rf?s.Va.Ze(e):e instanceof TN?s.Va.st(e):s.Va.tt(e),!t.isEqual(Ce.min()))try{const n=await eA(s.localStore);t.compareTo(n)>=0&&await(function(l,u){const h=l.Va.Tt(u);return h.targetChanges.forEach(((m,p)=>{if(m.resumeToken.approximateByteSize()>0){const x=l.Ia.get(p);x&&l.Ia.set(p,x.withResumeToken(m.resumeToken,u))}})),h.targetMismatches.forEach(((m,p)=>{const x=l.Ia.get(m);if(!x)return;l.Ia.set(m,x.withResumeToken(Ft.EMPTY_BYTE_STRING,x.snapshotVersion)),dA(l,m);const b=new aa(x.target,m,p,x.sequenceNumber);Qx(l,b)})),l.remoteSyncer.applyRemoteEvent(h)})(s,t)}catch(n){fe(Ao,"Failed to raise snapshot:",n),await am(s,n)}}async function am(s,e,t){if(!pi(e))throw e;s.Ea.add(1),await _c(s),s.Ra.set("Offline"),t||(t=()=>eA(s.localStore)),s.asyncQueue.enqueueRetryable((async()=>{fe(Ao,"Retrying IndexedDB access"),await t(),s.Ea.delete(1),await Dd(s)}))}function fA(s,e){return e().catch((t=>am(s,t,e)))}async function wc(s){const e=_e(s),t=di(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ai;for(;xP(e);)try{const i=await eP(e.localStore,n);if(i===null){e.Ta.length===0&&t.L_();break}n=i.batchId,vP(e,i)}catch(i){await am(e,i)}mA(e)&&gA(e)}function xP(s){return xi(s)&&s.Ta.length<10}function vP(s,e){s.Ta.push(e);const t=di(s);t.O_()&&t.X_&&t.ea(e.mutations)}function mA(s){return xi(s)&&!di(s).x_()&&s.Ta.length>0}function gA(s){di(s).start()}async function bP(s){di(s).ra()}async function _P(s){const e=di(s);for(const t of s.Ta)e.ea(t.mutations)}async function wP(s,e,t){const n=s.Ta.shift(),i=Dx.from(n,e,t);await fA(s,(()=>s.remoteSyncer.applySuccessfulWrite(i))),await wc(s)}async function TP(s,e){e&&di(s).X_&&await(async function(n,i){if((function(u){return bN(u)&&u!==ee.ABORTED})(i.code)){const l=n.Ta.shift();di(n).B_(),await fA(n,(()=>n.remoteSyncer.rejectFailedWrite(l.batchId,i))),await wc(n)}})(s,e),mA(s)&&gA(s)}async function jT(s,e){const t=_e(s);t.asyncQueue.verifyOperationInProgress(),fe(Ao,"RemoteStore received new credentials");const n=xi(t);t.Ea.add(3),await _c(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Dd(t)}async function Yy(s,e){const t=_e(s);e?(t.Ea.delete(2),await Dd(t)):e||(t.Ea.add(2),await _c(t),t.Ra.set("Unknown"))}function Tc(s){return s.ma||(s.ma=(function(t,n,i){const l=_e(t);return l.sa(),new lP(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)})(s.datastore,s.asyncQueue,{Xo:mP.bind(null,s),t_:gP.bind(null,s),r_:pP.bind(null,s),H_:yP.bind(null,s)}),s.da.push((async e=>{e?(s.ma.B_(),Yx(s)?Kx(s):s.Ra.set("Unknown")):(await s.ma.stop(),hA(s))}))),s.ma}function di(s){return s.fa||(s.fa=(function(t,n,i){const l=_e(t);return l.sa(),new cP(n,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)})(s.datastore,s.asyncQueue,{Xo:()=>Promise.resolve(),t_:bP.bind(null,s),r_:TP.bind(null,s),ta:_P.bind(null,s),na:wP.bind(null,s)}),s.da.push((async e=>{e?(s.fa.B_(),await wc(s)):(await s.fa.stop(),s.Ta.length>0&&(fe(Ao,`Stopping write stream with ${s.Ta.length} pending writes`),s.Ta=[]))}))),s.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(e,t,n,i,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=l,this.deferred=new En,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,l){const u=Date.now()+n,h=new Xx(e,t,u,i,l);return h.start(n),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ue(ee.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ec(s,e){if(Xt("AsyncQueue",`${e}: ${s}`),pi(s))return new ue(ee.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{static emptySet(e){return new yo(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||be.comparator(t.key,n.key):(t,n)=>be.comparator(t.key,n.key),this.keyedMap=Bu(),this.sortedSet=new jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof yo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,l=n.getNext().key;if(!i.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new yo;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(){this.ga=new jt(be.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Se(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Io{constructor(e,t,n,i,l,u,h,m,p){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=m,this.hasCachedResults=p}static fromInitialDocuments(e,t,n,i,l){const u=[];return t.forEach((h=>{u.push({type:0,doc:h})})),new Io(e,t,yo.emptySet(t),u,n,i,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Id(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class SP{constructor(){this.queries=RT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const i=_e(t),l=i.queries;i.queries=RT(),l.forEach(((u,h)=>{for(const m of h.Sa)m.onError(n)}))})(this,new ue(ee.ABORTED,"Firestore shutting down"))}}function RT(){return new fa((s=>aN(s)),Id)}async function Wx(s,e){const t=_e(s);let n=3;const i=e.query;let l=t.queries.get(i);l?!l.ba()&&e.Da()&&(n=2):(l=new EP,n=e.Da()?0:1);try{switch(n){case 0:l.wa=await t.onListen(i,!0);break;case 1:l.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(u){const h=Ec(u,`Initialization of query '${Ol(e.query)}' failed`);return void e.onError(h)}t.queries.set(i,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&Zx(t)}async function Jx(s,e){const t=_e(s),n=e.query;let i=3;const l=t.queries.get(n);if(l){const u=l.Sa.indexOf(e);u>=0&&(l.Sa.splice(u,1),l.Sa.length===0?i=e.Da()?0:1:!l.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function NP(s,e){const t=_e(s);let n=!1;for(const i of e){const l=i.query,u=t.queries.get(l);if(u){for(const h of u.Sa)h.Fa(i)&&(n=!0);u.wa=i}}n&&Zx(t)}function AP(s,e,t){const n=_e(s),i=n.queries.get(e);if(i)for(const l of i.Sa)l.onError(t);n.queries.delete(e)}function Zx(s){s.Ca.forEach((e=>{e.next()}))}var Xy,kT;(kT=Xy||(Xy={})).Ma="default",kT.Cache="cache";class ev{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Io(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Io.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Xy.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(e){this.serializer=e}$s(e){return Tr(this.serializer,e)}Us(e){return e.metadata.exists?Im(this.serializer,e.document,!1):Ct.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Wt(e)}}class tv{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=yA(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const n=Xe.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,n=new DT(this.serializer);for(const i of e)if(i.metadata.queries){const l=n.$s(i.metadata.name);for(const u of i.metadata.queries){const h=(t.get(u)||Be()).add(l);t.set(u,h)}}return t}async ja(e){const t=await tP(e,new DT(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(const i of this.Ka)await nP(e,i,n.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function yA(s){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e){this.key=e}}class vA{constructor(e){this.key=e}}class bA{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Be(),this.mutatedKeys=Be(),this.eu=oN(e),this.tu=new yo(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new CT,i=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,u=i,h=!1;const m=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,p=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((x,b)=>{const w=i.get(x),N=jd(this.query,b)?b:null,V=!!w&&this.mutatedKeys.has(w.key),D=!!N&&(N.hasLocalMutations||this.mutatedKeys.has(N.key)&&N.hasCommittedMutations);let q=!1;w&&N?w.data.isEqual(N.data)?V!==D&&(n.track({type:3,doc:N}),q=!0):this.su(w,N)||(n.track({type:2,doc:N}),q=!0,(m&&this.eu(N,m)>0||p&&this.eu(N,p)<0)&&(h=!0)):!w&&N?(n.track({type:0,doc:N}),q=!0):w&&!N&&(n.track({type:1,doc:w}),q=!0,(m||p)&&(h=!0)),q&&(N?(u=u.add(N),l=D?l.add(x):l.delete(x)):(u=u.delete(x),l=l.delete(x)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const x=this.query.limitType==="F"?u.last():u.first();u=u.delete(x.key),l=l.delete(x.key),n.track({type:1,doc:x})}return{tu:u,iu:n,Cs:h,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((x,b)=>(function(N,V){const D=q=>{switch(q){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Se(20277,{Rt:q})}};return D(N)-D(V)})(x.type,b.type)||this.eu(x.doc,b.doc))),this.ou(n),i=i??!1;const h=t&&!i?this._u():[],m=this.Xa.size===0&&this.current&&!i?1:0,p=m!==this.Za;return this.Za=m,u.length!==0||p?{snapshot:new Io(this.query,e.tu,l,u,e.mutatedKeys,m===0,p,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new CT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Be(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new vA(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new xA(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=Be();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Io.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const vi="SyncEngine";class IP{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class jP{constructor(e){this.key=e,this.hu=!1}}class CP{constructor(e,t,n,i,l,u){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new fa((h=>aN(h)),Id),this.Iu=new Map,this.Eu=new Set,this.du=new jt(be.comparator),this.Au=new Map,this.Ru=new Ux,this.Vu={},this.mu=new Map,this.fu=No.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function RP(s,e,t=!0){const n=Mm(s);let i;const l=n.Tu.get(e);return l?(n.sharedClientState.addLocalQueryTarget(l.targetId),i=l.view.lu()):i=await _A(n,e,t,!0),i}async function kP(s,e){const t=Mm(s);await _A(t,e,!0,!1)}async function _A(s,e,t,n){const i=await oc(s.localStore,qn(e)),l=i.targetId,u=s.sharedClientState.addLocalQueryTarget(l,t);let h;return n&&(h=await nv(s,e,l,u==="current",i.resumeToken)),s.isPrimaryClient&&t&&Pm(s.remoteStore,i),h}async function nv(s,e,t,n,i){s.pu=(b,w,N)=>(async function(D,q,z,B){let L=q.view.ru(z);L.Cs&&(L=await nm(D.localStore,q.query,!1).then((({documents:C})=>q.view.ru(C,L))));const G=B&&B.targetChanges.get(q.targetId),H=B&&B.targetMismatches.get(q.targetId)!=null,R=q.view.applyChanges(L,D.isPrimaryClient,G,H);return Wy(D,q.targetId,R.au),R.snapshot})(s,b,w,N);const l=await nm(s.localStore,e,!0),u=new bA(e,l.Qs),h=u.ru(l.documents),m=kd.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",i),p=u.applyChanges(h,s.isPrimaryClient,m);Wy(s,t,p.au);const x=new IP(e,t,u);return s.Tu.set(e,x),s.Iu.has(t)?s.Iu.get(t).push(e):s.Iu.set(t,[e]),p.snapshot}async function DP(s,e,t){const n=_e(s),i=n.Tu.get(e),l=n.Iu.get(i.targetId);if(l.length>1)return n.Iu.set(i.targetId,l.filter((u=>!Id(u,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await lc(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),t&&cc(n.remoteStore,i.targetId),uc(n,i.targetId)})).catch(gi)):(uc(n,i.targetId),await lc(n.localStore,i.targetId,!0))}async function PP(s,e){const t=_e(s),n=t.Tu.get(e),i=t.Iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),cc(t.remoteStore,n.targetId))}async function MP(s,e,t){const n=iv(s);try{const i=await(function(u,h){const m=_e(u),p=ht.now(),x=h.reduce(((N,V)=>N.add(V.key)),Be());let b,w;return m.persistence.runTransaction("Locally write mutations","readwrite",(N=>{let V=ts(),D=Be();return m.Ns.getEntries(N,x).next((q=>{V=q,V.forEach(((z,B)=>{B.isValidDocument()||(D=D.add(z))}))})).next((()=>m.localDocuments.getOverlayedDocuments(N,V))).next((q=>{b=q;const z=[];for(const B of h){const L=iD(B,b.get(B.key).overlayedDocument);L!=null&&z.push(new ma(B.key,L,KS(L.value.mapValue),Vt.exists(!0)))}return m.mutationQueue.addMutationBatch(N,p,z,h)})).next((q=>{w=q;const z=q.applyToLocalDocumentSet(b,D);return m.documentOverlayCache.saveOverlays(N,q.batchId,z)}))})).then((()=>({batchId:w.batchId,changes:cN(b)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),(function(u,h,m){let p=u.Vu[u.currentUser.toKey()];p||(p=new jt(Ve)),p=p.insert(h,m),u.Vu[u.currentUser.toKey()]=p})(n,i.batchId,t),await ga(n,i.changes),await wc(n.remoteStore)}catch(i){const l=Ec(i,"Failed to persist write");t.reject(l)}}async function wA(s,e){const t=_e(s);try{const n=await ZD(t.localStore,e);e.targetChanges.forEach(((i,l)=>{const u=t.Au.get(l);u&&(je(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?u.hu=!0:i.modifiedDocuments.size>0?je(u.hu,14607):i.removedDocuments.size>0&&(je(u.hu,42227),u.hu=!1))})),await ga(t,n,e)}catch(n){await gi(n)}}function PT(s,e,t){const n=_e(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.Tu.forEach(((l,u)=>{const h=u.view.va(e);h.snapshot&&i.push(h.snapshot)})),(function(u,h){const m=_e(u);m.onlineState=h;let p=!1;m.queries.forEach(((x,b)=>{for(const w of b.Sa)w.va(h)&&(p=!0)})),p&&Zx(m)})(n.eventManager,e),i.length&&n.Pu.H_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function VP(s,e,t){const n=_e(s);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Au.get(e),l=i&&i.key;if(l){let u=new jt(be.comparator);u=u.insert(l,Ct.newNoDocument(l,Ce.min()));const h=Be().add(l),m=new Rd(Ce.min(),new Map,new jt(Ve),u,h);await wA(n,m),n.du=n.du.remove(l),n.Au.delete(e),av(n)}else await lc(n.localStore,e,!1).then((()=>uc(n,e,t))).catch(gi)}async function OP(s,e){const t=_e(s),n=e.batch.batchId;try{const i=await JD(t.localStore,e);rv(t,n,null),sv(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await ga(t,i)}catch(i){await gi(i)}}async function LP(s,e,t){const n=_e(s);try{const i=await(function(u,h){const m=_e(u);return m.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let x;return m.mutationQueue.lookupMutationBatch(p,h).next((b=>(je(b!==null,37113),x=b.keys(),m.mutationQueue.removeMutationBatch(p,b)))).next((()=>m.mutationQueue.performConsistencyCheck(p))).next((()=>m.documentOverlayCache.removeOverlaysForBatchId(p,x,h))).next((()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,x))).next((()=>m.localDocuments.getDocuments(p,x)))}))})(n.localStore,e);rv(n,e,t),sv(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await ga(n,i)}catch(i){await gi(i)}}async function UP(s,e){const t=_e(s);xi(t.remoteStore)||fe(vi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=await(function(u){const h=_e(u);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(m=>h.mutationQueue.getHighestUnacknowledgedBatchId(m)))})(t.localStore);if(n===ai)return void e.resolve();const i=t.mu.get(n)||[];i.push(e),t.mu.set(n,i)}catch(n){const i=Ec(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function sv(s,e){(s.mu.get(e)||[]).forEach((t=>{t.resolve()})),s.mu.delete(e)}function rv(s,e,t){const n=_e(s);let i=n.Vu[n.currentUser.toKey()];if(i){const l=i.get(e);l&&(t?l.reject(t):l.resolve(),i=i.remove(e)),n.Vu[n.currentUser.toKey()]=i}}function uc(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Iu.get(e))s.Tu.delete(n),t&&s.Pu.yu(n,t);s.Iu.delete(e),s.isPrimaryClient&&s.Ru.jr(e).forEach((n=>{s.Ru.containsKey(n)||TA(s,n)}))}function TA(s,e){s.Eu.delete(e.path.canonicalString());const t=s.du.get(e);t!==null&&(cc(s.remoteStore,t),s.du=s.du.remove(e),s.Au.delete(t),av(s))}function Wy(s,e,t){for(const n of t)n instanceof xA?(s.Ru.addReference(n.key,e),FP(s,n)):n instanceof vA?(fe(vi,"Document no longer in limbo: "+n.key),s.Ru.removeReference(n.key,e),s.Ru.containsKey(n.key)||TA(s,n.key)):Se(19791,{wu:n})}function FP(s,e){const t=e.key,n=t.path.canonicalString();s.du.get(t)||s.Eu.has(n)||(fe(vi,"New document in limbo: "+t),s.Eu.add(n),av(s))}function av(s){for(;s.Eu.size>0&&s.du.size<s.maxConcurrentLimboResolutions;){const e=s.Eu.values().next().value;s.Eu.delete(e);const t=new be(Xe.fromString(e)),n=s.fu.next();s.Au.set(n,new jP(t)),s.du=s.du.insert(t,n),Pm(s.remoteStore,new aa(qn(xc(t.path)),n,"TargetPurposeLimboResolution",Zn.ce))}}async function ga(s,e,t){const n=_e(s),i=[],l=[],u=[];n.Tu.isEmpty()||(n.Tu.forEach(((h,m)=>{u.push(n.pu(m,e,t).then((p=>{if((p||t)&&n.isPrimaryClient){const x=p?!p.fromCache:t?.targetChanges.get(m.targetId)?.current;n.sharedClientState.updateQueryState(m.targetId,x?"current":"not-current")}if(p){i.push(p);const x=zx.As(m.targetId,p);l.push(x)}})))})),await Promise.all(u),n.Pu.H_(i),await(async function(m,p){const x=_e(m);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",(b=>X.forEach(p,(w=>X.forEach(w.Es,(N=>x.persistence.referenceDelegate.addReference(b,w.targetId,N))).next((()=>X.forEach(w.ds,(N=>x.persistence.referenceDelegate.removeReference(b,w.targetId,N)))))))))}catch(b){if(!pi(b))throw b;fe(Gx,"Failed to update sequence numbers: "+b)}for(const b of p){const w=b.targetId;if(!b.fromCache){const N=x.Ms.get(w),V=N.snapshotVersion,D=N.withLastLimboFreeSnapshotVersion(V);x.Ms=x.Ms.insert(w,D)}}})(n.localStore,l))}async function qP(s,e){const t=_e(s);if(!t.currentUser.isEqual(e)){fe(vi,"User change. New user:",e.toKey());const n=await ZN(t.localStore,e);t.currentUser=e,(function(l,u){l.mu.forEach((h=>{h.forEach((m=>{m.reject(new ue(ee.CANCELLED,u))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await ga(t,n.Ls)}}function BP(s,e){const t=_e(s),n=t.Au.get(e);if(n&&n.hu)return Be().add(n.key);{let i=Be();const l=t.Iu.get(e);if(!l)return i;for(const u of l){const h=t.Tu.get(u);i=i.unionWith(h.view.nu)}return i}}async function zP(s,e){const t=_e(s),n=await nm(t.localStore,e.query,!0),i=e.view.cu(n);return t.isPrimaryClient&&Wy(t,e.targetId,i.au),i}async function GP(s,e){const t=_e(s);return sA(t.localStore,e).then((n=>ga(t,n)))}async function HP(s,e,t,n){const i=_e(s),l=await(function(h,m){const p=_e(h),x=_e(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",(b=>x.er(b,m).next((w=>w?p.localDocuments.getDocuments(b,w):X.resolve(null)))))})(i.localStore,e);l!==null?(t==="pending"?await wc(i.remoteStore):t==="acknowledged"||t==="rejected"?(rv(i,e,n||null),sv(i,e),(function(h,m){_e(_e(h).mutationQueue).ir(m)})(i.localStore,e)):Se(6720,"Unknown batchState",{Su:t}),await ga(i,l)):fe(vi,"Cannot apply mutation batch with id: "+e)}async function $P(s,e){const t=_e(s);if(Mm(t),iv(t),e===!0&&t.gu!==!0){const n=t.sharedClientState.getAllActiveQueryTargets(),i=await MT(t,n.toArray());t.gu=!0,await Yy(t.remoteStore,!0);for(const l of i)Pm(t.remoteStore,l)}else if(e===!1&&t.gu!==!1){const n=[];let i=Promise.resolve();t.Iu.forEach(((l,u)=>{t.sharedClientState.isLocalQueryTarget(u)?n.push(u):i=i.then((()=>(uc(t,u),lc(t.localStore,u,!0)))),cc(t.remoteStore,u)})),await i,await MT(t,n),(function(u){const h=_e(u);h.Au.forEach(((m,p)=>{cc(h.remoteStore,p)})),h.Ru.Jr(),h.Au=new Map,h.du=new jt(be.comparator)})(t),t.gu=!1,await Yy(t.remoteStore,!1)}}async function MT(s,e,t){const n=_e(s),i=[],l=[];for(const u of e){let h;const m=n.Iu.get(u);if(m&&m.length!==0){h=await oc(n.localStore,qn(m[0]));for(const p of m){const x=n.Tu.get(p),b=await zP(n,x);b.snapshot&&l.push(b.snapshot)}}else{const p=await nA(n.localStore,u);h=await oc(n.localStore,p),await nv(n,EA(p),u,!1,h.resumeToken)}i.push(h)}return n.Pu.H_(l),i}function EA(s){return nN(s.path,s.collectionGroup,s.orderBy,s.filters,s.limit,"F",s.startAt,s.endAt)}function QP(s){return(function(t){return _e(_e(t).persistence).Ts()})(_e(s).localStore)}async function KP(s,e,t,n){const i=_e(s);if(i.gu)return void fe(vi,"Ignoring unexpected query state notification.");const l=i.Iu.get(e);if(l&&l.length>0)switch(t){case"current":case"not-current":{const u=await sA(i.localStore,iN(l[0])),h=Rd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ft.EMPTY_BYTE_STRING);await ga(i,u,h);break}case"rejected":await lc(i.localStore,e,!0),uc(i,e,n);break;default:Se(64155,t)}}async function YP(s,e,t){const n=Mm(s);if(n.gu){for(const i of e){if(n.Iu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){fe(vi,"Adding an already active target "+i);continue}const l=await nA(n.localStore,i),u=await oc(n.localStore,l);await nv(n,EA(l),u.targetId,!1,u.resumeToken),Pm(n.remoteStore,u)}for(const i of t)n.Iu.has(i)&&await lc(n.localStore,i,!1).then((()=>{cc(n.remoteStore,i),uc(n,i)})).catch(gi)}}function Mm(s){const e=_e(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=wA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=BP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=VP.bind(null,e),e.Pu.H_=NP.bind(null,e.eventManager),e.Pu.yu=AP.bind(null,e.eventManager),e}function iv(s){const e=_e(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=OP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=LP.bind(null,e),e}function XP(s,e,t){const n=_e(s);(async function(l,u,h){try{const m=await u.getMetadata();if(await(function(N,V){const D=_e(N),q=Wt(V.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",(z=>D.Ii.getBundleMetadata(z,V.id))).then((z=>!!z&&z.createTime.compareTo(q)>=0))})(l.localStore,m))return await u.close(),h._completeWith((function(N){return{taskState:"Success",documentsLoaded:N.totalDocuments,bytesLoaded:N.totalBytes,totalDocuments:N.totalDocuments,totalBytes:N.totalBytes}})(m)),Promise.resolve(new Set);h._updateProgress(yA(m));const p=new tv(m,u.serializer);let x=await u.bu();for(;x;){const w=await p.Ga(x);w&&h._updateProgress(w),x=await u.bu()}const b=await p.ja(l.localStore);return await ga(l,b.Ha,void 0),await(function(N,V){const D=_e(N);return D.persistence.runTransaction("Save bundle","readwrite",(q=>D.Ii.saveBundleMetadata(q,V)))})(l.localStore,m),h._completeWith(b.progress),Promise.resolve(b.Ja)}catch(m){return bs(vi,`Loading bundle failed with ${m}`),h._failWith(m),Promise.resolve(new Set)}})(n,e,t).then((i=>{n.sharedClientState.notifyBundleLoaded(i)}))}class dc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Do(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return JN(this.persistence,new WN,e.initialUser,this.serializer)}Cu(e){return new Fx(Dm.mi,this.serializer)}Du(e){return new lA}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}dc.provider={build:()=>new dc};class ov extends dc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){je(this.persistence.referenceDelegate instanceof tm,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new HN(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?On.withCacheSize(this.cacheSizeBytes):On.DEFAULT;return new Fx((n=>tm.mi(n,t)),this.serializer)}}class lv extends dc{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await iv(this.xu.syncEngine),await wc(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return JN(this.persistence,new WN,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new HN(n,e.asyncQueue,t)}Mu(e,t){const n=new uk(t,this.persistence);return new ck(e.asyncQueue,n)}Cu(e){const t=Bx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?On.withCacheSize(this.cacheSizeBytes):On.DEFAULT;return new qx(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,cA(),Df(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new lA}}class SA extends lv{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof uy&&(this.sharedClientState.syncEngine={Co:HP.bind(null,t),vo:KP.bind(null,t),Fo:YP.bind(null,t),Ts:QP.bind(null,t),Do:GP.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async n=>{await $P(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))}Du(e){const t=cA();if(!uy.v(t))throw new ue(ee.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Bx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uy(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class hi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>PT(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=qP.bind(null,this.syncEngine),await Yy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new SP})()}createDatastore(e){const t=Do(e.databaseInfo.databaseId),n=(function(l){return new oP(l)})(e.databaseInfo);return(function(l,u,h,m){return new dP(l,u,h,m)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,i,l,u,h){return new fP(n,i,l,u,h)})(this.localStore,this.datastore,e.asyncQueue,(t=>PT(this.syncEngine,t,0)),(function(){return AT.v()?new AT:new sP})())}createSyncEngine(e,t){return(function(i,l,u,h,m,p,x){const b=new CP(i,l,u,h,m,p);return x&&(b.gu=!0),b})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=_e(t);fe(Ao,"RemoteStore shutting down."),n.Ea.add(5),await _c(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}hi.provider={build:()=>new hi};function VT(s,e=10240){let t=0;return{async read(){if(t<s.byteLength){const n={value:s.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Xt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new En,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((n=>{n&&n.$a()?this.metadata.resolve(n.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.Qa)}`))}),(n=>this.metadata.reject(n)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),n=Number(t);isNaN(n)&&this.Qu(`length string (${t}) is not valid number`);const i=await this.$u(n);return new pA(JSON.parse(i),e.length+n)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.Qa)}`);this.metadata=n;do n=this.bu(),n!==null&&this.elements.push(n);while(n!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new pA(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new ue(ee.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ue(ee.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(i,l){const u=_e(i),h={documents:l.map((b=>pd(u.serializer,b)))},m=await u.Ho("BatchGetDocuments",u.serializer.databaseId,Xe.emptyPath(),h,l.length),p=new Map;m.forEach((b=>{const w=gD(u.serializer,b);p.set(w.key.toString(),w)}));const x=[];return l.forEach((b=>{const w=p.get(b.toString());je(!!w,55234,{key:b}),x.push(w)})),x})(this.datastore,e);return t.forEach((n=>this.recordVersion(n))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new bc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,n)=>{const i=be.fromPath(n);this.mutations.push(new Rx(i,this.precondition(i)))})),await(async function(n,i){const l=_e(n),u={writes:i.map((h=>yd(l.serializer,h)))};await l.Go("Commit",l.serializer.databaseId,Xe.emptyPath(),u)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Se(50498,{Gu:e.constructor.name});t=Ce.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new ue(ee.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ce.min())?Vt.exists(!1):Vt.updateTime(t):Vt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ce.min()))throw new ue(ee.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Vt.updateTime(t)}return Vt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(e,t,n,i,l){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=l,this.zu=n.maxAttempts,this.M_=new $x(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new ZP(this.datastore),t=this.Hu(e);t&&t.then((n=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(n)})).catch((i=>{this.Yu(i)}))))})).catch((n=>{this.Yu(n)}))}))}Hu(e){try{const t=this.updateFunction(e);return!Sd(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!bN(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi="FirestoreClient";class t4{constructor(e,t,n,i,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Tn.UNAUTHENTICATED,this.clientId=ym.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(n,(async u=>{fe(fi,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(n,(u=>(fe(fi,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new En;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ec(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function hy(s,e){s.asyncQueue.verifyOperationInProgress(),fe(fi,"Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener((async i=>{n.isEqual(i)||(await ZN(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener((()=>s.terminate())),s._offlineComponents=e}async function OT(s,e){s.asyncQueue.verifyOperationInProgress();const t=await cv(s);fe(fi,"Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener((n=>jT(e.remoteStore,n))),s.setAppCheckTokenChangeListener(((n,i)=>jT(e.remoteStore,i))),s._onlineComponents=e}async function cv(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){fe(fi,"Using user provided OfflineComponentProvider");try{await hy(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===ee.FAILED_PRECONDITION||i.code===ee.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;bs("Error using user provided cache. Falling back to memory cache: "+t),await hy(s,new dc)}}else fe(fi,"Using default OfflineComponentProvider"),await hy(s,new ov(void 0));return s._offlineComponents}async function Om(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(fe(fi,"Using user provided OnlineComponentProvider"),await OT(s,s._uninitializedComponentsProvider._online)):(fe(fi,"Using default OnlineComponentProvider"),await OT(s,new hi))),s._onlineComponents}function NA(s){return cv(s).then((e=>e.persistence))}function Sc(s){return cv(s).then((e=>e.localStore))}function AA(s){return Om(s).then((e=>e.remoteStore))}function uv(s){return Om(s).then((e=>e.syncEngine))}function IA(s){return Om(s).then((e=>e.datastore))}async function hc(s){const e=await Om(s),t=e.eventManager;return t.onListen=RP.bind(null,e.syncEngine),t.onUnlisten=DP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=kP.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=PP.bind(null,e.syncEngine),t}function n4(s){return s.asyncQueue.enqueue((async()=>{const e=await NA(s),t=await AA(s);return e.setNetworkEnabled(!0),(function(i){const l=_e(i);return l.Ea.delete(0),Dd(l)})(t)}))}function s4(s){return s.asyncQueue.enqueue((async()=>{const e=await NA(s),t=await AA(s);return e.setNetworkEnabled(!1),(async function(i){const l=_e(i);l.Ea.add(0),await _c(l),l.Ra.set("Offline")})(t)}))}function r4(s,e){const t=new En;return s.asyncQueue.enqueueAndForget((async()=>(async function(i,l,u){try{const h=await(function(p,x){const b=_e(p);return b.persistence.runTransaction("read document","readonly",(w=>b.localDocuments.getDocument(w,x)))})(i,l);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new ue(ee.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const m=Ec(h,`Failed to get document '${l} from cache`);u.reject(m)}})(await Sc(s),e,t))),t.promise}function jA(s,e,t={}){const n=new En;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new Vm({next:w=>{x.Nu(),u.enqueueAndForget((()=>Jx(l,b)));const N=w.docs.has(h);!N&&w.fromCache?p.reject(new ue(ee.UNAVAILABLE,"Failed to get document because the client is offline.")):N&&w.fromCache&&m&&m.source==="server"?p.reject(new ue(ee.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(w)},error:w=>p.reject(w)}),b=new ev(xc(h.path),x,{includeMetadataChanges:!0,qa:!0});return Wx(l,b)})(await hc(s),s.asyncQueue,e,t,n))),n.promise}function a4(s,e){const t=new En;return s.asyncQueue.enqueueAndForget((async()=>(async function(i,l,u){try{const h=await nm(i,l,!0),m=new bA(l,h.Qs),p=m.ru(h.documents),x=m.applyChanges(p,!1);u.resolve(x.snapshot)}catch(h){const m=Ec(h,`Failed to execute query '${l} against cache`);u.reject(m)}})(await Sc(s),e,t))),t.promise}function CA(s,e,t={}){const n=new En;return s.asyncQueue.enqueueAndForget((async()=>(function(l,u,h,m,p){const x=new Vm({next:w=>{x.Nu(),u.enqueueAndForget((()=>Jx(l,b))),w.fromCache&&m.source==="server"?p.reject(new ue(ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(w)},error:w=>p.reject(w)}),b=new ev(h,x,{includeMetadataChanges:!0,qa:!0});return Wx(l,b)})(await hc(s),s.asyncQueue,e,t,n))),n.promise}function i4(s,e,t){const n=new En;return s.asyncQueue.enqueueAndForget((async()=>{try{const i=await IA(s);n.resolve((async function(u,h,m){const p=_e(u),{request:x,gt:b,parent:w}=RN(p.serializer,sN(h),m);p.connection.$o||delete x.parent;const N=(await p.Ho("RunAggregationQuery",p.serializer.databaseId,w,x,1)).filter((D=>!!D.result));je(N.length===1,64727);const V=N[0].result?.aggregateFields;return Object.keys(V).reduce(((D,q)=>(D[b[q]]=V[q],D)),{})})(i,e,t))}catch(i){n.reject(i)}})),n.promise}function o4(s,e){const t=new Vm(e);return s.asyncQueue.enqueueAndForget((async()=>(function(i,l){_e(i).Ca.add(l),l.next()})(await hc(s),t))),()=>{t.Nu(),s.asyncQueue.enqueueAndForget((async()=>(function(i,l){_e(i).Ca.delete(l)})(await hc(s),t)))}}function l4(s,e,t,n){const i=(function(u,h){let m;return m=typeof u=="string"?wN().encode(u):u,(function(x,b){return new WP(x,b)})((function(x,b){if(x instanceof Uint8Array)return VT(x,b);if(x instanceof ArrayBuffer)return VT(new Uint8Array(x),b);if(x instanceof ReadableStream)return x.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(m),h)})(t,Do(e));s.asyncQueue.enqueueAndForget((async()=>{XP(await uv(s),i,n)}))}function c4(s,e){return s.asyncQueue.enqueue((async()=>(function(n,i){const l=_e(n);return l.persistence.runTransaction("Get named query","readonly",(u=>l.Ii.getNamedQuery(u,i)))})(await Sc(s),e)))}function RA(s,e){return(function(n,i){return new JP(n,i)})(s,e)}function u4(s,e){return s.asyncQueue.enqueue((async()=>(async function(n,i){const l=_e(n),u=l.indexManager,h=[];return l.persistence.runTransaction("Configure indexes","readwrite",(m=>u.getFieldIndexes(m).next((p=>(function(b,w,N,V,D){b=[...b],w=[...w],b.sort(N),w.sort(N);const q=b.length,z=w.length;let B=0,L=0;for(;B<z&&L<q;){const G=N(b[L],w[B]);G<0?D(b[L++]):G>0?V(w[B++]):(B++,L++)}for(;B<z;)V(w[B++]);for(;L<q;)D(b[L++])})(p,i,ak,(x=>{h.push(u.addFieldIndex(m,x))}),(x=>{h.push(u.deleteFieldIndex(m,x))})))).next((()=>X.waitFor(h)))))})(await Sc(s),e)))}function d4(s,e){return s.asyncQueue.enqueue((async()=>(function(n,i){_e(n).Fs.Vs=i})(await Sc(s),e)))}function h4(s){return s.asyncQueue.enqueue((async()=>(function(t){const n=_e(t),i=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",(l=>i.deleteAllFieldIndexes(l)))})(await Sc(s))))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kA(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA="firestore.googleapis.com",UT=!0;class FT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ue(ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=DA,this.ssl=UT}else this.host=e.host,this.ssl=e.ssl??UT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=FN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<GN)throw new ue(ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kA(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new ue(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new ue(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new ue(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,i){return n.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Pd{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ue(ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ue(ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new yS;switch(n.type){case"firstParty":return new J2(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new ue(ee.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=LT.get(t);n&&(fe("ComponentProvider","Removing Datastore"),LT.delete(t),n.terminate())})(this),Promise.resolve()}}function PA(s,e,t,n={}){s=We(s,Pd);const i=mi(e),l=s._getSettings(),u={...l,emulatorOptions:s._getEmulatorOptions()},h=`${e}:${t}`;i&&(dm(`https://${h}`),rx("Firestore",!0)),l.host!==DA&&l.host!==h&&bs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...l,host:h,ssl:i,emulatorOptions:n};if(!Os(m,u)&&(s._setSettings(m),n.mockUserToken)){let p,x;if(typeof n.mockUserToken=="string")p=n.mockUserToken,x=Tn.MOCK_USER;else{p=x1(n.mockUserToken,s._app?.options.projectId);const b=n.mockUserToken.sub||n.mockUserToken.user_id;if(!b)throw new ue(ee.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new Tn(b)}s._authCredentials=new Y2(new pS(p,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new fn(this.firestore,e,this._query)}}class yt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yt(this.firestore,e,this._key)}toJSON(){return{type:yt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ko(t,yt._jsonSchema))return new yt(e,n||null,new be(Xe.fromString(t.referencePath)))}}yt._jsonSchemaVersion="firestore/documentReference/1.0",yt._jsonSchema={type:rn("string",yt._jsonSchemaVersion),referencePath:rn("string")};class Xs extends fn{constructor(e,t,n){super(e,t,xc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yt(this.firestore,null,new be(e))}withConverter(e){return new Xs(this.firestore,e,this._path)}}function Ne(s,e,...t){if(s=lt(s),xx("collection","path",e),s instanceof Pd){const n=Xe.fromString(e,...t);return Iw(n),new Xs(s,null,n)}{if(!(s instanceof yt||s instanceof Xs))throw new ue(ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(Xe.fromString(e,...t));return Iw(n),new Xs(s.firestore,null,n)}}function f4(s,e){if(s=We(s,Pd),xx("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ue(ee.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new fn(s,null,(function(n){return new ha(Xe.emptyPath(),n)})(e))}function xe(s,e,...t){if(s=lt(s),arguments.length===1&&(e=ym.newId()),xx("doc","path",e),s instanceof Pd){const n=Xe.fromString(e,...t);return Aw(n),new yt(s,null,new be(n))}{if(!(s instanceof yt||s instanceof Xs))throw new ue(ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(Xe.fromString(e,...t));return Aw(n),new yt(s.firestore,s instanceof Xs?s.converter:null,new be(n))}}function m4(s,e){return s=lt(s),e=lt(e),(s instanceof yt||s instanceof Xs)&&(e instanceof yt||e instanceof Xs)&&s.firestore===e.firestore&&s.path===e.path&&s.converter===e.converter}function dv(s,e){return s=lt(s),e=lt(e),s instanceof fn&&e instanceof fn&&s.firestore===e.firestore&&Id(s._query,e._query)&&s.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT="AsyncQueue";class BT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new $x(this,"async_queue_retry"),this._c=()=>{const n=Df();n&&fe(qT,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=Df();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Df();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new En;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!pi(e))throw e;fe(qT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,Xt("INTERNAL UNHANDLED ERROR: ",zT(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Xx.createAndSchedule(this,e,t,n,(l=>this.hc(l)));return this.tc.push(i),i}uc(){this.nc&&Se(47125,{Pc:zT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function zT(s){let e=s.message||"";return s.stack&&(e=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gl(s){return(function(t,n){if(typeof t!="object"||t===null)return!1;const i=t;for(const l of n)if(l in i&&typeof i[l]=="function")return!0;return!1})(s,["next","error","complete"])}class MA{constructor(){this._progressObserver={},this._taskCompletionResolver=new En,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4=-1;class Et extends Pd{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new BT,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new BT(e),this._firestoreClient=void 0,await e}}}function p4(s,e,t){t||(t=hd);const n=Ar(s,"firestore");if(n.isInitialized(t)){const i=n.getImmediate({identifier:t}),l=n.getOptions(t);if(Os(l,e))return i;throw new ue(ee.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ue(ee.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<GN)throw new ue(ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&mi(e.host)&&dm(e.host),n.initialize({options:e,instanceIdentifier:t})}function VA(s,e){const t=typeof s=="object"?s:fm(),n=typeof s=="string"?s:e||hd,i=Ar(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const l=gE("firestore");l&&PA(i,...l)}return i}function Ot(s){if(s._terminated)throw new ue(ee.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||OA(s),s._firestoreClient}function OA(s){const e=s._freezeSettings(),t=(function(i,l,u,h){return new Uk(i,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,kA(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(s._databaseId,s._app?.options.appId||"",s._persistenceKey,e);s._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(s._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),s._firestoreClient=new t4(s._authCredentials,s._appCheckCredentials,s._queue,t,s._componentsProvider&&(function(i){const l=i?._online.build();return{_offline:i?._offline.build(l),_online:l}})(s._componentsProvider))}function y4(s,e){bs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=s._freezeSettings();return LA(s,hi.provider,{build:n=>new lv(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function x4(s){bs("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=s._freezeSettings();LA(s,hi.provider,{build:t=>new SA(t,e.cacheSizeBytes)})}function LA(s,e,t){if((s=We(s,Et))._firestoreClient||s._terminated)throw new ue(ee.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(s._componentsProvider||s._getSettings().localCache)throw new ue(ee.FAILED_PRECONDITION,"SDK cache is already specified.");s._componentsProvider={_online:e,_offline:t},OA(s)}function v4(s){if(s._initialized&&!s._terminated)throw new ue(ee.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new En;return s._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(n){if(!wr.v())return Promise.resolve();const i=n+XN;await wr.delete(i)})(Bx(s._databaseId,s._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function b4(s){return(function(t){const n=new En;return t.asyncQueue.enqueueAndForget((async()=>UP(await uv(t),n))),n.promise})(Ot(s=We(s,Et)))}function _4(s){return n4(Ot(s=We(s,Et)))}function w4(s){return s4(Ot(s=We(s,Et)))}function T4(s){return kC(s.app,"firestore",s._databaseId.database),s._delete()}function Jy(s,e){const t=Ot(s=We(s,Et)),n=new MA;return l4(t,s._databaseId,e,n),n}function UA(s,e){return c4(Ot(s=We(s,Et)),e).then((t=>t?new fn(s,null,t.query):null))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class FA{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wn(Ft.fromBase64String(e))}catch(t){throw new ue(ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wn(Ft.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Wn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ko(e,Wn._jsonSchema))return Wn.fromBase64String(e.bytes)}}Wn._jsonSchemaVersion="firestore/bytes/1.0",Wn._jsonSchema={type:rn("string",Wn._jsonSchemaVersion),bytes:rn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ue(ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function E4(){return new bi(Ay)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ue(ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ue(ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ve(this._lat,e._lat)||Ve(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ws._jsonSchemaVersion}}static fromJSON(e){if(ko(e,Ws._jsonSchema))return new Ws(e.latitude,e.longitude)}}Ws._jsonSchemaVersion="firestore/geoPoint/1.0",Ws._jsonSchema={type:rn("string",Ws._jsonSchemaVersion),latitude:rn("number"),longitude:rn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,i){if(n.length!==i.length)return!1;for(let l=0;l<n.length;++l)if(n[l]!==i[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Vs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ko(e,Vs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Vs(e.vectorValues);throw new ue(ee.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Vs._jsonSchemaVersion="firestore/vectorValue/1.0",Vs._jsonSchema={type:rn("string",Vs._jsonSchemaVersion),vectorValues:rn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S4=/^__.*__$/;class N4{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new ma(e,this.data,this.fieldMask,t,this.fieldTransforms):new vc(e,this.data,t,this.fieldTransforms)}}class qA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ma(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function BA(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Se(40011,{Ac:s})}}class Lm{constructor(e,t,n,i,l,u){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Lm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return im(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(BA(this.Ac)&&S4.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class A4{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Do(e)}Cc(e,t,n,i=!1){return new Lm({Ac:e,methodName:t,Dc:n,path:Rt.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Po(s){const e=s._freezeSettings(),t=Do(s._databaseId);return new A4(s._databaseId,!!e.ignoreUndefinedProperties,t)}function Um(s,e,t,n,i,l={}){const u=s.Cc(l.merge||l.mergeFields?2:0,e,t,i);xv("Data must be an object, but it was:",u,n);const h=HA(n,u);let m,p;if(l.merge)m=new es(u.fieldMask),p=u.fieldTransforms;else if(l.mergeFields){const x=[];for(const b of l.mergeFields){const w=xd(e,b,t);if(!u.contains(w))throw new ue(ee.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);QA(x,w)||x.push(w)}m=new es(x),p=u.fieldTransforms.filter((b=>m.covers(b.field)))}else m=null,p=u.fieldTransforms;return new N4(new kn(h),m,p)}class Md extends _i{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Md}}function zA(s,e,t){return new Lm({Ac:3,Dc:e.settings.Dc,methodName:s._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class hv extends _i{_toFieldTransform(e){return new Cd(e.path,new rc)}isEqual(e){return e instanceof hv}}class fv extends _i{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=zA(this,e,!0),n=this.vc.map((l=>Mo(l,t))),i=new wo(n);return new Cd(e.path,i)}isEqual(e){return e instanceof fv&&Os(this.vc,e.vc)}}class mv extends _i{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=zA(this,e,!0),n=this.vc.map((l=>Mo(l,t))),i=new To(n);return new Cd(e.path,i)}isEqual(e){return e instanceof mv&&Os(this.vc,e.vc)}}class gv extends _i{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new ac(e.serializer,hN(e.serializer,this.Fc));return new Cd(e.path,t)}isEqual(e){return e instanceof gv&&this.Fc===e.Fc}}function pv(s,e,t,n){const i=s.Cc(1,e,t);xv("Data must be an object, but it was:",i,n);const l=[],u=kn.empty();yi(n,((m,p)=>{const x=Fm(e,m,t);p=lt(p);const b=i.yc(x);if(p instanceof Md)l.push(x);else{const w=Mo(p,b);w!=null&&(l.push(x),u.set(x,w))}}));const h=new es(l);return new qA(u,h,i.fieldTransforms)}function yv(s,e,t,n,i,l){const u=s.Cc(1,e,t),h=[xd(e,n,t)],m=[i];if(l.length%2!=0)throw new ue(ee.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<l.length;w+=2)h.push(xd(e,l[w])),m.push(l[w+1]);const p=[],x=kn.empty();for(let w=h.length-1;w>=0;--w)if(!QA(p,h[w])){const N=h[w];let V=m[w];V=lt(V);const D=u.yc(N);if(V instanceof Md)p.push(N);else{const q=Mo(V,D);q!=null&&(p.push(N),x.set(N,q))}}const b=new es(p);return new qA(x,b,u.fieldTransforms)}function GA(s,e,t,n=!1){return Mo(t,s.Cc(n?4:3,e))}function Mo(s,e){if($A(s=lt(s)))return xv("Unsupported field value:",e,s),HA(s,e);if(s instanceof _i)return(function(n,i){if(!BA(i.Ac))throw i.Sc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${n._methodName}() is not currently supported inside arrays`);const l=n._toFieldTransform(i);l&&i.fieldTransforms.push(l)})(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,i){const l=[];let u=0;for(const h of n){let m=Mo(h,i.wc(u));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),u++}return{arrayValue:{values:l}}})(s,e)}return(function(n,i){if((n=lt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return hN(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const l=ht.fromDate(n);return{timestampValue:ic(i.serializer,l)}}if(n instanceof ht){const l=new ht(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ic(i.serializer,l)}}if(n instanceof Ws)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Wn)return{bytesValue:SN(i.serializer,n._byteString)};if(n instanceof yt){const l=i.databaseId,u=n.firestore._databaseId;if(!u.isEqual(l))throw i.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:Vx(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Vs)return(function(u,h){return{mapValue:{fields:{[Sx]:{stringValue:Nx},[tc]:{arrayValue:{values:u.toArray().map((p=>{if(typeof p!="number")throw h.Sc("VectorValues must only contain numeric values.");return Cx(h.serializer,p)}))}}}}}})(n,i);throw i.Sc(`Unsupported field value: ${xm(n)}`)})(s,e)}function HA(s,e){const t={};return US(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yi(s,((n,i)=>{const l=Mo(i,e.mc(n));l!=null&&(t[n]=l)})),{mapValue:{fields:t}}}function $A(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof ht||s instanceof Ws||s instanceof Wn||s instanceof yt||s instanceof _i||s instanceof Vs)}function xv(s,e,t){if(!$A(t)||!bS(t)){const n=xm(t);throw n==="an object"?e.Sc(s+" a custom object"):e.Sc(s+" "+n)}}function xd(s,e,t){if((e=lt(e))instanceof bi)return e._internalPath;if(typeof e=="string")return Fm(s,e);throw im("Field path arguments must be of type string or ",s,!1,void 0,t)}const I4=new RegExp("[~\\*/\\[\\]]");function Fm(s,e,t){if(e.search(I4)>=0)throw im(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new bi(...e.split("."))._internalPath}catch{throw im(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function im(s,e,t,n,i){const l=n&&!n.isEmpty(),u=i!==void 0;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let m="";return(l||u)&&(m+=" (found",l&&(m+=` in field ${n}`),u&&(m+=` in document ${i}`),m+=")"),new ue(ee.INVALID_ARGUMENT,h+s+m)}function QA(s,e){return s.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(e,t,n,i,l){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new j4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(qm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class j4 extends vd{data(){return super.data()}}function qm(s,e){return typeof e=="string"?Fm(s,e):e instanceof bi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KA(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new ue(ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vv{}class Nc extends vv{}function Pe(s,e,...t){let n=[];e instanceof vv&&n.push(e),n=n.concat(t),(function(l){const u=l.filter((m=>m instanceof Vo)).length,h=l.filter((m=>m instanceof Ac)).length;if(u>1||u>0&&h>0)throw new ue(ee.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const i of n)s=i._apply(s);return s}class Ac extends Nc{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ac(e,t,n)}_apply(e){const t=this._parse(e);return XA(e._query,t),new fn(e.firestore,e.converter,Ly(e._query,t))}_parse(e){const t=Po(e.firestore);return(function(l,u,h,m,p,x,b){let w;if(p.isKeyField()){if(x==="array-contains"||x==="array-contains-any")throw new ue(ee.INVALID_ARGUMENT,`Invalid Query. You can't perform '${x}' queries on documentId().`);if(x==="in"||x==="not-in"){HT(b,x);const V=[];for(const D of b)V.push(GT(m,l,D));w={arrayValue:{values:V}}}else w=GT(m,l,b)}else x!=="in"&&x!=="not-in"&&x!=="array-contains-any"||HT(b,x),w=GA(h,u,b,x==="in"||x==="not-in");return tt.create(p,x,w)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function qe(s,e,t){const n=e,i=qm("where",s);return Ac._create(i,n,t)}class Vo extends vv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Vo(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:pt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,l){let u=i;const h=l.getFlattenedFilters();for(const m of h)XA(u,m),u=Ly(u,m)})(e._query,t),new fn(e.firestore,e.converter,Ly(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function C4(...s){return s.forEach((e=>WA("or",e))),Vo._create("or",s)}function R4(...s){return s.forEach((e=>WA("and",e))),Vo._create("and",s)}class Bm extends Nc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Bm(e,t)}_apply(e){const t=(function(i,l,u){if(i.startAt!==null)throw new ue(ee.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new ue(ee.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gd(l,u)})(e._query,this._field,this._direction);return new fn(e.firestore,e.converter,(function(i,l){const u=i.explicitOrderBy.concat([l]);return new ha(i.path,i.collectionGroup,u,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}}function Gt(s,e="asc"){const t=e,n=qm("orderBy",s);return Bm._create(n,t)}class Vd extends Nc{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Vd(e,t,n)}_apply(e){return new fn(e.firestore,e.converter,Wf(e._query,this._limit,this._limitType))}}function Ht(s){return _S("limit",s),Vd._create("limit",s,"F")}function k4(s){return _S("limitToLast",s),Vd._create("limitToLast",s,"L")}class Od extends Nc{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Od(e,t,n)}_apply(e){const t=YA(e,this.type,this._docOrFields,this._inclusive);return new fn(e.firestore,e.converter,(function(i,l){return new ha(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,l,i.endAt)})(e._query,t))}}function D4(...s){return Od._create("startAt",s,!0)}function P4(...s){return Od._create("startAfter",s,!1)}class Ld extends Nc{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Ld(e,t,n)}_apply(e){const t=YA(e,this.type,this._docOrFields,this._inclusive);return new fn(e.firestore,e.converter,(function(i,l){return new ha(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,l)})(e._query,t))}}function M4(...s){return Ld._create("endBefore",s,!1)}function V4(...s){return Ld._create("endAt",s,!0)}function YA(s,e,t,n){if(t[0]=lt(t[0]),t[0]instanceof vd)return(function(l,u,h,m,p){if(!m)throw new ue(ee.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const x=[];for(const b of zl(l))if(b.field.isKeyField())x.push(bo(u,m.key));else{const w=m.data.field(b.field);if(Tm(w))throw new ue(ee.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+b.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(w===null){const N=b.field.canonicalString();throw new ue(ee.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${N}' (used as the orderBy) does not exist.`)}x.push(w)}return new ui(x,p)})(s._query,s.firestore._databaseId,e,t[0]._document,n);{const i=Po(s.firestore);return(function(u,h,m,p,x,b){const w=u.explicitOrderBy;if(x.length>w.length)throw new ue(ee.INVALID_ARGUMENT,`Too many arguments provided to ${p}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const N=[];for(let V=0;V<x.length;V++){const D=x[V];if(w[V].field.isKeyField()){if(typeof D!="string")throw new ue(ee.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${p}(), but got a ${typeof D}`);if(!Ix(u)&&D.indexOf("/")!==-1)throw new ue(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${p}() must be a plain document ID, but '${D}' contains a slash.`);const q=u.path.child(Xe.fromString(D));if(!be.isDocumentKey(q))throw new ue(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${p}() must result in a valid document path, but '${q}' is not because it contains an odd number of segments.`);const z=new be(q);N.push(bo(h,z))}else{const q=GA(m,p,D);N.push(q)}}return new ui(N,b)})(s._query,s.firestore._databaseId,i,e,t,n)}}function GT(s,e,t){if(typeof(t=lt(t))=="string"){if(t==="")throw new ue(ee.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ix(e)&&t.indexOf("/")!==-1)throw new ue(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Xe.fromString(t));if(!be.isDocumentKey(n))throw new ue(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return bo(s,new be(n))}if(t instanceof yt)return bo(s,t._key);throw new ue(ee.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xm(t)}.`)}function HT(s,e){if(!Array.isArray(s)||s.length===0)throw new ue(ee.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function XA(s,e){const t=(function(i,l){for(const u of i)for(const h of u.getFlattenedFilters())if(l.indexOf(h.op)>=0)return h.op;return null})(s.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new ue(ee.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ue(ee.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function WA(s,e){if(!(e instanceof Ac||e instanceof Vo))throw new ue(ee.INVALID_ARGUMENT,`Function ${s}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class bv{convertValue(e,t="none"){switch(li(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(da(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Se(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return yi(e,((i,l)=>{n[i]=this.convertValue(l,t)})),n}convertVectorValue(e){const t=e.fields?.[tc].arrayValue?.values?.map((n=>Pt(n.doubleValue)));return new Vs(t)}convertGeoPoint(e){return new Ws(Pt(e.latitude),Pt(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Em(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(dd(e));default:return null}}convertTimestamp(e){const t=ua(e);return new ht(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Xe.fromString(e);je(MN(n),9688,{name:e});const i=new oi(n.get(1),n.get(3)),l=new be(n.popFirst(5));return i.isEqual(t)||Xt(`Document ${l} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(s,e,t){let n;return n=s?t&&(t.merge||t.mergeFields)?s.toFirestore(e,t):s.toFirestore(e):e,n}class _v extends bv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O4(s){return new fc("sum",xd("sum",s))}function L4(s){return new fc("avg",xd("average",s))}function JA(){return new fc("count")}function U4(s,e){return s instanceof fc&&e instanceof fc&&s.aggregateType===e.aggregateType&&s._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function F4(s,e){return dv(s.query,e.query)&&Os(s.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZA="NOT SUPPORTED";class ia{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rs extends vd{constructor(e,t,n,i,l,u){super(e,t,n,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new nd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(qm("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ue(ee.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=rs._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function q4(s,e,t){if(ko(e,rs._jsonSchema)){if(e.bundle===ZA)throw new ue(ee.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=Do(s._databaseId),i=RA(e.bundle,n),l=i.Wu(),u=new tv(i.getMetadata(),n);for(const x of l)u.Ga(x);const h=u.documents;if(h.length!==1)throw new ue(ee.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);const m=Im(n,h[0].document),p=new be(Xe.fromString(e.bundleName));return new rs(s,new _v(s),p,m,new ia(!1,!1),t||null)}}rs._jsonSchemaVersion="firestore/documentSnapshot/1.0",rs._jsonSchema={type:rn("string",rs._jsonSchemaVersion),bundleSource:rn("string","DocumentSnapshot"),bundleName:rn("string"),bundle:rn("string")};class nd extends rs{data(e={}){return super.data(e)}}class as{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ia(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new nd(this._firestore,this._userDataWriter,n.key,n,new ia(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ue(ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,l){if(i._snapshot.oldDocs.isEmpty()){let u=0;return i._snapshot.docChanges.map((h=>{const m=new nd(i._firestore,i._userDataWriter,h.doc.key,h.doc,new ia(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter);return h.doc,{type:"added",doc:m,oldIndex:-1,newIndex:u++}}))}{let u=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((h=>l||h.type!==3)).map((h=>{const m=new nd(i._firestore,i._userDataWriter,h.doc.key,h.doc,new ia(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter);let p=-1,x=-1;return h.type!==0&&(p=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),x=u.indexOf(h.doc.key)),{type:z4(h.type),doc:m,oldIndex:p,newIndex:x}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ue(ee.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=as._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ym.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),n.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),i.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function B4(s,e,t){if(ko(e,as._jsonSchema)){if(e.bundle===ZA)throw new ue(ee.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const n=Do(s._databaseId),i=RA(e.bundle,n),l=i.Wu(),u=new tv(i.getMetadata(),n);for(const w of l)u.Ga(w);if(u.queries.length!==1)throw new ue(ee.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${u.queries.length} queries.`);const h=Cm(u.queries[0].bundledQuery),m=u.documents;let p=new yo;m.map((w=>{const N=Im(n,w.document);p=p.add(N)}));const x=Io.fromInitialDocuments(h,p,Be(),!1,!1),b=new fn(s,t||null,h);return new as(s,new _v(s),b,x)}}function z4(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Se(61501,{type:s})}}function G4(s,e){return s instanceof rs&&e instanceof rs?s._firestore===e._firestore&&s._key.isEqual(e._key)&&(s._document===null?e._document===null:s._document.isEqual(e._document))&&s._converter===e._converter:s instanceof as&&e instanceof as&&s._firestore===e._firestore&&dv(s.query,e.query)&&s.metadata.isEqual(e.metadata)&&s._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function At(s){s=We(s,yt);const e=We(s.firestore,Et);return jA(Ot(e),s._key).then((t=>wv(e,s,t)))}as._jsonSchemaVersion="firestore/querySnapshot/1.0",as._jsonSchema={type:rn("string",as._jsonSchemaVersion),bundleSource:rn("string","QuerySnapshot"),bundleName:rn("string"),bundle:rn("string")};class wi extends bv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}function H4(s){s=We(s,yt);const e=We(s.firestore,Et),t=Ot(e),n=new wi(e);return r4(t,s._key).then((i=>new rs(e,n,s._key,i,new ia(i!==null&&i.hasLocalMutations,!0),s.converter)))}function $4(s){s=We(s,yt);const e=We(s.firestore,Et);return jA(Ot(e),s._key,{source:"server"}).then((t=>wv(e,s,t)))}function Fe(s){s=We(s,fn);const e=We(s.firestore,Et),t=Ot(e),n=new wi(e);return KA(s._query),CA(t,s._query).then((i=>new as(e,n,s,i)))}function Q4(s){s=We(s,fn);const e=We(s.firestore,Et),t=Ot(e),n=new wi(e);return a4(t,s._query).then((i=>new as(e,n,s,i)))}function K4(s){s=We(s,fn);const e=We(s.firestore,Et),t=Ot(e),n=new wi(e);return CA(t,s._query,{source:"server"}).then((i=>new as(e,n,s,i)))}function Er(s,e,t){s=We(s,yt);const n=We(s.firestore,Et),i=zm(s.converter,e,t);return Ic(n,[Um(Po(n),"setDoc",s._key,i,s.converter!==null,t).toMutation(s._key,Vt.none())])}function Mt(s,e,t,...n){s=We(s,yt);const i=We(s.firestore,Et),l=Po(i);let u;return u=typeof(e=lt(e))=="string"||e instanceof bi?yv(l,"updateDoc",s._key,e,t,n):pv(l,"updateDoc",s._key,e),Ic(i,[u.toMutation(s._key,Vt.exists(!0))])}function Hl(s){return Ic(We(s.firestore,Et),[new bc(s._key,Vt.none())])}function Jn(s,e){const t=We(s.firestore,Et),n=xe(s),i=zm(s.converter,e);return Ic(t,[Um(Po(s.firestore),"addDoc",n._key,i,s.converter!==null,{}).toMutation(n._key,Vt.exists(!1))]).then((()=>n))}function Zy(s,...e){s=lt(s);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||Gl(e[n])||(t=e[n++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Gl(e[n])){const m=e[n];e[n]=m.next?.bind(m),e[n+1]=m.error?.bind(m),e[n+2]=m.complete?.bind(m)}let l,u,h;if(s instanceof yt)u=We(s.firestore,Et),h=xc(s._key.path),l={next:m=>{e[n]&&e[n](wv(u,s,m))},error:e[n+1],complete:e[n+2]};else{const m=We(s,fn);u=We(m.firestore,Et),h=m._query;const p=new wi(u);l={next:x=>{e[n]&&e[n](new as(u,p,m,x))},error:e[n+1],complete:e[n+2]},KA(s._query)}return(function(p,x,b,w){const N=new Vm(w),V=new ev(x,N,b);return p.asyncQueue.enqueueAndForget((async()=>Wx(await hc(p),V))),()=>{N.Nu(),p.asyncQueue.enqueueAndForget((async()=>Jx(await hc(p),V)))}})(Ot(u),h,i,l)}function Y4(s,e,...t){const n=lt(s),i=(function(m){const p={bundle:"",bundleName:"",bundleSource:""},x=["bundle","bundleName","bundleSource"];for(const b of x){if(!(b in m)){p.error=`snapshotJson missing required field: ${b}`;break}const w=m[b];if(typeof w!="string"){p.error=`snapshotJson field '${b}' must be a string.`;break}if(w.length===0){p.error=`snapshotJson field '${b}' cannot be an empty string.`;break}b==="bundle"?p.bundle=w:b==="bundleName"?p.bundleName=w:b==="bundleSource"&&(p.bundleSource=w)}return p})(e);if(i.error)throw new ue(ee.INVALID_ARGUMENT,i.error);let l,u=0;if(typeof t[u]!="object"||Gl(t[u])||(l=t[u++]),i.bundleSource==="QuerySnapshot"){let h=null;if(typeof t[u]=="object"&&Gl(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,b,w,N){let V,D=!1;return Jy(p,x.bundle).then((()=>UA(p,x.bundleName))).then((z=>{z&&!D&&(N&&z.withConverter(N),V=Zy(z,b||{},w))})).catch((z=>(w.error&&w.error(z),()=>{}))),()=>{D||(D=!0,V&&V())}})(n,i,l,h,t[u])}if(i.bundleSource==="DocumentSnapshot"){let h=null;if(typeof t[u]=="object"&&Gl(t[u])){const m=t[u++];h={next:m.next,error:m.error,complete:m.complete}}else h={next:t[u++],error:t[u++],complete:t[u++]};return(function(p,x,b,w,N){let V,D=!1;return Jy(p,x.bundle).then((()=>{if(!D){const z=new yt(p,N||null,be.fromPath(x.bundleName));V=Zy(z,b||{},w)}})).catch((z=>(w.error&&w.error(z),()=>{}))),()=>{D||(D=!0,V&&V())}})(n,i,l,h,t[u])}throw new ue(ee.INVALID_ARGUMENT,`unsupported bundle source: ${i.bundleSource}`)}function X4(s,e){return o4(Ot(s=We(s,Et)),Gl(e)?e:{next:e})}function Ic(s,e){return(function(n,i){const l=new En;return n.asyncQueue.enqueueAndForget((async()=>MP(await uv(n),i,l))),l.promise})(Ot(s),e)}function wv(s,e,t){const n=t.docs.get(e._key),i=new wi(s);return new rs(s,i,e._key,n,new ia(t.hasPendingWrites,t.fromCache),e.converter)}function W4(s){return eI(s,{count:JA()})}function eI(s,e){const t=We(s.firestore,Et),n=Ot(t),i=LS(e,((l,u)=>new vN(u,l.aggregateType,l._internalFieldPath)));return i4(n,s._query,i).then((l=>(function(h,m,p){const x=new wi(h);return new FA(m,x,p)})(t,s,l)))}class J4{constructor(e){this.kind="memory",this._onlineComponentProvider=hi.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new ov(void 0)}}toJSON(){return{kind:this.kind}}}class Z4{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=tI(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class eM{constructor(){this.kind="memoryEager",this._offlineComponentProvider=dc.provider}toJSON(){return{kind:this.kind}}}class tM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ov(e)}}toJSON(){return{kind:this.kind}}}function nM(){return new eM}function sM(s){return new tM(s?.cacheSizeBytes)}function rM(s){return new J4(s)}function aM(s){return new Z4(s)}class iM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=hi.provider,this._offlineComponentProvider={build:t=>new lv(t,e?.cacheSizeBytes,this.forceOwnership)}}}class oM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=hi.provider,this._offlineComponentProvider={build:t=>new SA(t,e?.cacheSizeBytes)}}}function tI(s){return new iM(s?.forceOwnership)}function lM(){return new oM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Po(e)}set(e,t,n){this._verifyNotCommitted();const i=ei(e,this._firestore),l=zm(i.converter,t,n),u=Um(this._dataReader,"WriteBatch.set",i._key,l,i.converter!==null,n);return this._mutations.push(u.toMutation(i._key,Vt.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const l=ei(e,this._firestore);let u;return u=typeof(t=lt(t))=="string"||t instanceof bi?yv(this._dataReader,"WriteBatch.update",l._key,t,n,i):pv(this._dataReader,"WriteBatch.update",l._key,t),this._mutations.push(u.toMutation(l._key,Vt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ei(e,this._firestore);return this._mutations=this._mutations.concat(new bc(t._key,Vt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ue(ee.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ei(s,e){if((s=lt(s)).firestore!==e)throw new ue(ee.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uM{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Po(e)}get(e){const t=ei(e,this._firestore),n=new _v(this._firestore);return this._transaction.lookup([t._key]).then((i=>{if(!i||i.length!==1)return Se(24041);const l=i[0];if(l.isFoundDocument())return new vd(this._firestore,n,l.key,l,t.converter);if(l.isNoDocument())return new vd(this._firestore,n,t._key,null,t.converter);throw Se(18433,{doc:l})}))}set(e,t,n){const i=ei(e,this._firestore),l=zm(i.converter,t,n),u=Um(this._dataReader,"Transaction.set",i._key,l,i.converter!==null,n);return this._transaction.set(i._key,u),this}update(e,t,n,...i){const l=ei(e,this._firestore);let u;return u=typeof(t=lt(t))=="string"||t instanceof bi?yv(this._dataReader,"Transaction.update",l._key,t,n,i):pv(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,u),this}delete(e){const t=ei(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sI extends uM{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ei(e,this._firestore),n=new wi(this._firestore);return super.get(e).then((i=>new rs(this._firestore,n,t._key,i._document,new ia(!1,!1),t.converter)))}}function Hu(s,e,t){s=We(s,Et);const n={...cM,...t};return(function(l){if(l.maxAttempts<1)throw new ue(ee.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(l,u,h){const m=new En;return l.asyncQueue.enqueueAndForget((async()=>{const p=await IA(l);new e4(l.asyncQueue,p,h,u,m).ju()})),m.promise})(Ot(s),(i=>e(new sI(s,i))),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dM(){return new Md("deleteField")}function ke(){return new hv("serverTimestamp")}function mc(...s){return new fv("arrayUnion",s)}function om(...s){return new mv("arrayRemove",s)}function Pf(s){return new gv("increment",s)}function hM(s){return new Vs(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(s){return Ot(s=We(s,Et)),new nI(s,(e=>Ic(s,e)))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fM(s,e){const t=Ot(s=We(s,Et));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return bs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const n=(function(l){const u=typeof l=="string"?(function(p){try{return JSON.parse(p)}catch(x){throw new ue(ee.INVALID_ARGUMENT,"Failed to parse JSON: "+x?.message)}})(l):l,h=[];if(Array.isArray(u.indexes))for(const m of u.indexes){const p=$T(m,"collectionGroup"),x=[];if(Array.isArray(m.fields))for(const b of m.fields){const w=Fm("setIndexConfiguration",$T(b,"fieldPath"));b.arrayConfig==="CONTAINS"?x.push(new go(w,2)):b.order==="ASCENDING"?x.push(new go(w,0)):b.order==="DESCENDING"&&x.push(new go(w,1))}h.push(new Yl(Yl.UNKNOWN_ID,p,x,Xl.empty()))}return h})(e);return u4(t,n)}function $T(s,e){if(typeof s[e]!="string")throw new ue(ee.INVALID_ARGUMENT,"Missing string value for: "+e);return s[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function mM(s){s=We(s,Et);const e=QT.get(s);if(e)return e;if(Ot(s)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const n=new rI(s);return QT.set(s,n),n}function gM(s){aI(s,!0)}function pM(s){aI(s,!1)}function yM(s){h4(Ot(s._firestore)).then((e=>fe("deleting all persistent cache indexes succeeded"))).catch((e=>bs("deleting all persistent cache indexes failed",e)))}function aI(s,e){d4(Ot(s._firestore),e).then((t=>fe(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>bs(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const QT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xM(s){const e=Ot(We(s.firestore,Et)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:jm(t,qn(s._query)).ft}function vM(s,e){const t=LS(e,((l,u)=>new vN(u,l.aggregateType,l._internalFieldPath))),n=Ot(We(s.firestore,Et)),i=n._onlineComponents?.datastore.serializer;return i===void 0?null:RN(i,sN(s._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Tv.instance.onExistenceFilterMismatch(e)}}class Tv{constructor(){this.Mc=new Map}static get instance(){return yf||(yf=new Tv,(function(t){if(Uy)throw new Error("a TestingHooksSpi instance is already set");Uy=t})(yf)),yf}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.Mc;return n.set(t,e),()=>n.delete(t)}}let yf=null;(function(e,t=!0){(function(i){yc=i})(gc),Js(new Ls("firestore",((n,{instanceIdentifier:i,options:l})=>{const u=n.getProvider("app").getImmediate(),h=new Et(new X2(n.getProvider("auth-internal")),new Z2(u,n.getProvider("app-check-internal")),(function(p,x){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new ue(ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oi(p.options.projectId,x)})(u,i),u);return l={useFetchStreams:t,...l},h._setSettings(l),h}),"PUBLIC").setMultipleInstances(!0)),ss(Sw,Nw,e),ss(Sw,Nw,"esm2020")})();const Ms=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:bv,AggregateField:fc,AggregateQuerySnapshot:FA,Bytes:Wn,CACHE_SIZE_UNLIMITED:g4,CollectionReference:Xs,DocumentReference:yt,DocumentSnapshot:rs,FieldPath:bi,FieldValue:_i,Firestore:Et,FirestoreError:ue,GeoPoint:Ws,LoadBundleTask:MA,PersistentCacheIndexManager:rI,Query:fn,QueryCompositeFilterConstraint:Vo,QueryConstraint:Nc,QueryDocumentSnapshot:nd,QueryEndAtConstraint:Ld,QueryFieldFilterConstraint:Ac,QueryLimitConstraint:Vd,QueryOrderByConstraint:Bm,QuerySnapshot:as,QueryStartAtConstraint:Od,SnapshotMetadata:ia,Timestamp:ht,Transaction:sI,VectorValue:Vs,WriteBatch:nI,_AutoId:ym,_ByteString:Ft,_DatabaseId:oi,_DocumentKey:be,_EmptyAppCheckTokenProvider:ek,_EmptyAuthCredentialsProvider:yS,_FieldPath:Rt,_TestingHooks:bM,_cast:We,_debugAssert:K2,_internalAggregationQueryToProtoRunAggregationQueryRequest:vM,_internalQueryToProtoQueryTarget:xM,_isBase64Available:Ok,_logWarn:bs,_validateIsNotUsedTogether:vS,addDoc:Jn,aggregateFieldEqual:U4,aggregateQuerySnapshotEqual:F4,and:R4,arrayRemove:om,arrayUnion:mc,average:L4,clearIndexedDbPersistence:v4,collection:Ne,collectionGroup:f4,connectFirestoreEmulator:PA,count:JA,deleteAllPersistentCacheIndexes:yM,deleteDoc:Hl,deleteField:dM,disableNetwork:w4,disablePersistentCacheIndexAutoCreation:pM,doc:xe,documentId:E4,documentSnapshotFromJSON:q4,enableIndexedDbPersistence:y4,enableMultiTabIndexedDbPersistence:x4,enableNetwork:_4,enablePersistentCacheIndexAutoCreation:gM,endAt:V4,endBefore:M4,ensureFirestoreConfigured:Ot,executeWrite:Ic,getAggregateFromServer:eI,getCountFromServer:W4,getDoc:At,getDocFromCache:H4,getDocFromServer:$4,getDocs:Fe,getDocsFromCache:Q4,getDocsFromServer:K4,getFirestore:VA,getPersistentCacheIndexManager:mM,increment:Pf,initializeFirestore:p4,limit:Ht,limitToLast:k4,loadBundle:Jy,memoryEagerGarbageCollector:nM,memoryLocalCache:rM,memoryLruGarbageCollector:sM,namedQuery:UA,onSnapshot:Zy,onSnapshotResume:Y4,onSnapshotsInSync:X4,or:C4,orderBy:Gt,persistentLocalCache:aM,persistentMultipleTabManager:lM,persistentSingleTabManager:tI,query:Pe,queryEqual:dv,querySnapshotFromJSON:B4,refEqual:m4,runTransaction:Hu,serverTimestamp:ke,setDoc:Er,setIndexConfiguration:fM,setLogLevel:Q2,snapshotEqual:G4,startAfter:P4,startAt:D4,sum:O4,terminate:T4,updateDoc:Mt,vector:hM,waitForPendingWrites:b4,where:qe,writeBatch:xo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iI="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _M{constructor(e,t,n,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,xs(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(l=>this.auth=l,()=>{}),this.messaging||n.get().then(l=>this.messaging=l,()=>{}),this.appCheck||i?.get().then(l=>this.appCheck=l,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),n=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:t,messagingToken:n,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ex="us-central1";class wM{constructor(e,t,n,i,l=ex,u=(...h)=>fetch(...h)){this.app=e,this.fetchImpl=u,this.emulatorOrigin=null,this.contextProvider=new _M(e,t,n,i),this.cancelAllRequests=new Promise(h=>{this.deleteService=()=>Promise.resolve(h())});try{const h=new URL(l);this.customDomain=h.origin+(h.pathname==="/"?"":h.pathname),this.region=ex}catch{this.customDomain=null,this.region=l}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function TM(s,e,t){const n=mi(e);s.emulatorOrigin=`http${n?"s":""}://${e}:${t}`,n&&(dm(s.emulatorOrigin+"/backends"),rx("Functions",!0))}const KT="@firebase/functions",YT="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM="auth-internal",SM="app-check-internal",NM="messaging-internal";function AM(s){const e=(t,{instanceIdentifier:n})=>{const i=t.getProvider("app").getImmediate(),l=t.getProvider(EM),u=t.getProvider(NM),h=t.getProvider(SM);return new wM(i,l,u,h,n)};Js(new Ls(iI,e,"PUBLIC").setMultipleInstances(!0)),ss(KT,YT,s),ss(KT,YT,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IM(s=fm(),e=ex){const n=Ar(lt(s),iI).getImmediate({identifier:e}),i=gE("functions");return i&&jM(n,...i),n}function jM(s,e,t){TM(lt(s),e,t)}AM();const oI="@firebase/installations",Ev="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lI=1e4,cI=`w:${Ev}`,uI="FIS_v2",CM="https://firebaseinstallations.googleapis.com/v1",RM=3600*1e3,kM="installations",DM="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},jo=new Ro(kM,DM,PM);function dI(s){return s instanceof Zs&&s.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI({projectId:s}){return`${CM}/projects/${s}/installations`}function fI(s){return{token:s.token,requestStatus:2,expiresIn:VM(s.expiresIn),creationTime:Date.now()}}async function mI(s,e){const n=(await e.json()).error;return jo.create("request-failed",{requestName:s,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function gI({apiKey:s}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":s})}function MM(s,{refreshToken:e}){const t=gI(s);return t.append("Authorization",OM(e)),t}async function pI(s){const e=await s();return e.status>=500&&e.status<600?s():e}function VM(s){return Number(s.replace("s","000"))}function OM(s){return`${uI} ${s}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LM({appConfig:s,heartbeatServiceProvider:e},{fid:t}){const n=hI(s),i=gI(s),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&i.append("x-firebase-client",p)}const u={fid:t,authVersion:uI,appId:s.appId,sdkVersion:cI},h={method:"POST",headers:i,body:JSON.stringify(u)},m=await pI(()=>fetch(n,h));if(m.ok){const p=await m.json();return{fid:p.fid||t,registrationStatus:2,refreshToken:p.refreshToken,authToken:fI(p.authToken)}}else throw await mI("Create Installation",m)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(s){return new Promise(e=>{setTimeout(e,s)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UM(s){return btoa(String.fromCharCode(...s)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FM=/^[cdef][\w-]{21}$/,tx="";function qM(){try{const s=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(s),s[0]=112+s[0]%16;const t=BM(s);return FM.test(t)?t:tx}catch{return tx}}function BM(s){return UM(s).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gm(s){return`${s.appName}!${s.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xI=new Map;function vI(s,e){const t=Gm(s);bI(t,e),zM(t,e)}function bI(s,e){const t=xI.get(s);if(t)for(const n of t)n(e)}function zM(s,e){const t=GM();t&&t.postMessage({key:s,fid:e}),HM()}let mo=null;function GM(){return!mo&&"BroadcastChannel"in self&&(mo=new BroadcastChannel("[Firebase] FID Change"),mo.onmessage=s=>{bI(s.data.key,s.data.fid)}),mo}function HM(){xI.size===0&&mo&&(mo.close(),mo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $M="firebase-installations-database",QM=1,Co="firebase-installations-store";let fy=null;function Sv(){return fy||(fy=SE($M,QM,{upgrade:(s,e)=>{switch(e){case 0:s.createObjectStore(Co)}}})),fy}async function lm(s,e){const t=Gm(s),i=(await Sv()).transaction(Co,"readwrite"),l=i.objectStore(Co),u=await l.get(t);return await l.put(e,t),await i.done,(!u||u.fid!==e.fid)&&vI(s,e.fid),e}async function _I(s){const e=Gm(s),n=(await Sv()).transaction(Co,"readwrite");await n.objectStore(Co).delete(e),await n.done}async function Hm(s,e){const t=Gm(s),i=(await Sv()).transaction(Co,"readwrite"),l=i.objectStore(Co),u=await l.get(t),h=e(u);return h===void 0?await l.delete(t):await l.put(h,t),await i.done,h&&(!u||u.fid!==h.fid)&&vI(s,h.fid),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nv(s){let e;const t=await Hm(s.appConfig,n=>{const i=KM(n),l=YM(s,i);return e=l.registrationPromise,l.installationEntry});return t.fid===tx?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function KM(s){const e=s||{fid:qM(),registrationStatus:0};return wI(e)}function YM(s,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(jo.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=XM(s,t);return{installationEntry:t,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:WM(s)}:{installationEntry:e}}async function XM(s,e){try{const t=await LM(s,e);return lm(s.appConfig,t)}catch(t){throw dI(t)&&t.customData.serverCode===409?await _I(s.appConfig):await lm(s.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function WM(s){let e=await XT(s.appConfig);for(;e.registrationStatus===1;)await yI(100),e=await XT(s.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:n}=await Nv(s);return n||t}return e}function XT(s){return Hm(s,e=>{if(!e)throw jo.create("installation-not-found");return wI(e)})}function wI(s){return JM(s)?{fid:s.fid,registrationStatus:0}:s}function JM(s){return s.registrationStatus===1&&s.registrationTime+lI<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZM({appConfig:s,heartbeatServiceProvider:e},t){const n=eV(s,t),i=MM(s,t),l=e.getImmediate({optional:!0});if(l){const p=await l.getHeartbeatsHeader();p&&i.append("x-firebase-client",p)}const u={installation:{sdkVersion:cI,appId:s.appId}},h={method:"POST",headers:i,body:JSON.stringify(u)},m=await pI(()=>fetch(n,h));if(m.ok){const p=await m.json();return fI(p)}else throw await mI("Generate Auth Token",m)}function eV(s,{fid:e}){return`${hI(s)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Av(s,e=!1){let t;const n=await Hm(s.appConfig,l=>{if(!TI(l))throw jo.create("not-registered");const u=l.authToken;if(!e&&sV(u))return l;if(u.requestStatus===1)return t=tV(s,e),l;{if(!navigator.onLine)throw jo.create("app-offline");const h=aV(l);return t=nV(s,h),h}});return t?await t:n.authToken}async function tV(s,e){let t=await WT(s.appConfig);for(;t.authToken.requestStatus===1;)await yI(100),t=await WT(s.appConfig);const n=t.authToken;return n.requestStatus===0?Av(s,e):n}function WT(s){return Hm(s,e=>{if(!TI(e))throw jo.create("not-registered");const t=e.authToken;return iV(t)?{...e,authToken:{requestStatus:0}}:e})}async function nV(s,e){try{const t=await ZM(s,e),n={...e,authToken:t};return await lm(s.appConfig,n),t}catch(t){if(dI(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await _I(s.appConfig);else{const n={...e,authToken:{requestStatus:0}};await lm(s.appConfig,n)}throw t}}function TI(s){return s!==void 0&&s.registrationStatus===2}function sV(s){return s.requestStatus===2&&!rV(s)}function rV(s){const e=Date.now();return e<s.creationTime||s.creationTime+s.expiresIn<e+RM}function aV(s){const e={requestStatus:1,requestTime:Date.now()};return{...s,authToken:e}}function iV(s){return s.requestStatus===1&&s.requestTime+lI<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oV(s){const e=s,{installationEntry:t,registrationPromise:n}=await Nv(e);return n?n.catch(console.error):Av(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lV(s,e=!1){const t=s;return await cV(t),(await Av(t,e)).token}async function cV(s){const{registrationPromise:e}=await Nv(s);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uV(s){if(!s||!s.options)throw my("App Configuration");if(!s.name)throw my("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!s.options[t])throw my(t);return{appName:s.name,projectId:s.options.projectId,apiKey:s.options.apiKey,appId:s.options.appId}}function my(s){return jo.create("missing-app-config-values",{valueName:s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EI="installations",dV="installations-internal",hV=s=>{const e=s.getProvider("app").getImmediate(),t=uV(e),n=Ar(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},fV=s=>{const e=s.getProvider("app").getImmediate(),t=Ar(e,EI).getImmediate();return{getId:()=>oV(t),getToken:i=>lV(t,i)}};function mV(){Js(new Ls(EI,hV,"PUBLIC")),Js(new Ls(dV,fV,"PRIVATE"))}mV();ss(oI,Ev);ss(oI,Ev,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cm="analytics",gV="firebase_id",pV="origin",yV=60*1e3,xV="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Iv="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is=new hm("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vV={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},vs=new Ro("analytics","Analytics",vV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bV(s){if(!s.startsWith(Iv)){const e=vs.create("invalid-gtag-resource",{gtagURL:s});return is.warn(e.message),""}return s}function SI(s){return Promise.all(s.map(e=>e.catch(t=>t)))}function _V(s,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(s,e)),t}function wV(s,e){const t=_V("firebase-js-sdk-policy",{createScriptURL:bV}),n=document.createElement("script"),i=`${Iv}?l=${s}&id=${e}`;n.src=t?t?.createScriptURL(i):i,n.async=!0,document.head.appendChild(n)}function TV(s){let e=[];return Array.isArray(window[s])?e=window[s]:window[s]=e,e}async function EV(s,e,t,n,i,l){const u=n[i];try{if(u)await e[u];else{const m=(await SI(t)).find(p=>p.measurementId===i);m&&await e[m.appId]}}catch(h){is.error(h)}s("config",i,l)}async function SV(s,e,t,n,i){try{let l=[];if(i&&i.send_to){let u=i.send_to;Array.isArray(u)||(u=[u]);const h=await SI(t);for(const m of u){const p=h.find(b=>b.measurementId===m),x=p&&e[p.appId];if(x)l.push(x);else{l=[];break}}}l.length===0&&(l=Object.values(e)),await Promise.all(l),s("event",n,i||{})}catch(l){is.error(l)}}function NV(s,e,t,n){async function i(l,...u){try{if(l==="event"){const[h,m]=u;await SV(s,e,t,h,m)}else if(l==="config"){const[h,m]=u;await EV(s,e,t,n,h,m)}else if(l==="consent"){const[h,m]=u;s("consent",h,m)}else if(l==="get"){const[h,m,p]=u;s("get",h,m,p)}else if(l==="set"){const[h]=u;s("set",h)}else s(l,...u)}catch(h){is.error(h)}}return i}function AV(s,e,t,n,i){let l=function(...u){window[n].push(arguments)};return window[i]&&typeof window[i]=="function"&&(l=window[i]),window[i]=NV(l,s,e,t),{gtagCore:l,wrappedGtag:window[i]}}function IV(s){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Iv)&&t.src.includes(s))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV=30,CV=1e3;class RV{constructor(e={},t=CV){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const NI=new RV;function kV(s){return new Headers({Accept:"application/json","x-goog-api-key":s})}async function DV(s){const{appId:e,apiKey:t}=s,n={method:"GET",headers:kV(t)},i=xV.replace("{app-id}",e),l=await fetch(i,n);if(l.status!==200&&l.status!==304){let u="";try{const h=await l.json();h.error?.message&&(u=h.error.message)}catch{}throw vs.create("config-fetch-failed",{httpStatus:l.status,responseMessage:u})}return l.json()}async function PV(s,e=NI,t){const{appId:n,apiKey:i,measurementId:l}=s.options;if(!n)throw vs.create("no-app-id");if(!i){if(l)return{measurementId:l,appId:n};throw vs.create("no-api-key")}const u=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new OV;return setTimeout(async()=>{h.abort()},yV),AI({appId:n,apiKey:i,measurementId:l},u,h,e)}async function AI(s,{throttleEndTimeMillis:e,backoffCount:t},n,i=NI){const{appId:l,measurementId:u}=s;try{await MV(n,e)}catch(h){if(u)return is.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:l,measurementId:u};throw h}try{const h=await DV(s);return i.deleteThrottleMetadata(l),h}catch(h){const m=h;if(!VV(m)){if(i.deleteThrottleMetadata(l),u)return is.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${m?.message}]`),{appId:l,measurementId:u};throw h}const p=Number(m?.customData?.httpStatus)===503?J_(t,i.intervalMillis,jV):J_(t,i.intervalMillis),x={throttleEndTimeMillis:Date.now()+p,backoffCount:t+1};return i.setThrottleMetadata(l,x),is.debug(`Calling attemptFetch again in ${p} millis`),AI(s,x,n,i)}}function MV(s,e){return new Promise((t,n)=>{const i=Math.max(e-Date.now(),0),l=setTimeout(t,i);s.addEventListener(()=>{clearTimeout(l),n(vs.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function VV(s){if(!(s instanceof Zs)||!s.customData)return!1;const e=Number(s.customData.httpStatus);return e===429||e===500||e===503||e===504}class OV{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function LV(s,e,t,n,i){if(i&&i.global){s("event",t,n);return}else{const l=await e,u={...n,send_to:l};s("event",t,u)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UV(){if(ax())try{await wE()}catch(s){return is.warn(vs.create("indexeddb-unavailable",{errorInfo:s?.toString()}).message),!1}else return is.warn(vs.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function FV(s,e,t,n,i,l,u){const h=PV(s);h.then(w=>{t[w.measurementId]=w.appId,s.options.measurementId&&w.measurementId!==s.options.measurementId&&is.warn(`The measurement ID in the local Firebase config (${s.options.measurementId}) does not match the measurement ID fetched from the server (${w.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(w=>is.error(w)),e.push(h);const m=UV().then(w=>{if(w)return n.getId()}),[p,x]=await Promise.all([h,m]);IV(l)||wV(l,p.measurementId),i("js",new Date);const b=u?.config??{};return b[pV]="firebase",b.update=!0,x!=null&&(b[gV]=x),i("config",p.measurementId,b),p.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qV=class{constructor(e){this.app=e}_delete(){return delete sd[this.app.options.appId],Promise.resolve()}},sd={},JT=[];const ZT={};let gy="dataLayer",BV="gtag",eE,II,tE=!1;function zV(){const s=[];if(vE()&&s.push("This is a browser extension environment."),S1()||s.push("Cookies are not available."),s.length>0){const e=s.map((n,i)=>`(${i+1}) ${n}`).join(" "),t=vs.create("invalid-analytics-context",{errorInfo:e});is.warn(t.message)}}function GV(s,e,t){zV();const n=s.options.appId;if(!n)throw vs.create("no-app-id");if(!s.options.apiKey)if(s.options.measurementId)is.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${s.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw vs.create("no-api-key");if(sd[n]!=null)throw vs.create("already-exists",{id:n});if(!tE){TV(gy);const{wrappedGtag:l,gtagCore:u}=AV(sd,JT,ZT,gy,BV);II=l,eE=u,tE=!0}return sd[n]=FV(s,JT,ZT,e,eE,gy,t),new qV(s)}function HV(s=fm()){s=lt(s);const e=Ar(s,cm);return e.isInitialized()?e.getImmediate():$V(s)}function $V(s,e={}){const t=Ar(s,cm);if(t.isInitialized()){const i=t.getImmediate();if(Os(e,t.getOptions()))return i;throw vs.create("already-initialized")}return t.initialize({options:e})}function xr(s,e,t,n){s=lt(s),LV(II,sd[s.app.options.appId],e,t,n).catch(i=>is.error(i))}const nE="@firebase/analytics",sE="0.10.18";function QV(){Js(new Ls(cm,(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return GV(n,i,t)},"PUBLIC")),Js(new Ls("analytics-internal",s,"PRIVATE")),ss(nE,sE),ss(nE,sE,"esm2020");function s(e){try{const t=e.getProvider(cm).getImmediate();return{logEvent:(n,i,l)=>xr(t,n,i,l)}}catch(t){throw vs.create("interop-component-reg-failed",{reason:t})}}}QV();const KV={apiKey:"AIzaSyDQnrbvsx52ikiWELf6hc4YiXQTC1G5tpY",authDomain:"three-sided-flashcard-app.firebaseapp.com",projectId:"three-sided-flashcard-app",storageBucket:"three-sided-flashcard-app.firebasestorage.app",messagingSenderId:"47503676879",appId:"1:47503676879:web:27fb875159cc4459a12eba",measurementId:"G-PBP1G21Q29"},$m=NE(KV),Xn=z2($m),te=VA($m);IM($m);const dn=HV($m),oa=Object.freeze(Object.defineProperty({__proto__:null,analytics:dn,auth:Xn,db:te},Symbol.toStringTag,{value:"Module"}));class ys{static sanitizeInput(e,t={}){if(!e||typeof e!="string")return"";const{maxLength:n=1e4,allowHtml:i=!1,allowLatex:l=!0,stripScripts:u=!0,stripUrls:h=!1}=t;let m=e;return m.length>n&&(m=m.substring(0,n)),(!i||u)&&(m=m.replace(/<script[^>]*>.*?<\/script>/gi,""),m=m.replace(/on\w+\s*=\s*["'][^"']*["']/gi,""),m=m.replace(/javascript:/gi,""),i||(m=m.replace(/data:/gi,"")),["script","iframe","object","embed","form","input","textarea","button"].forEach(x=>{const b=new RegExp(`<${x}[^>]*>.*?</${x}>`,"gi");m=m.replace(b,"");const w=new RegExp(`<${x}[^>]*/?>`,"gi");m=m.replace(w,"")})),h&&(m=m.replace(/https?:\/\/[^\s]+/gi,"[URL_REMOVED]")),m.trim()}static validateFlashcardInput(e){const t=[],n={};if(!e.statement||typeof e.statement!="string"?t.push("Statement is required and must be text"):e.statement.length<3?t.push("Statement must be at least 3 characters long"):e.statement.length>5e3?t.push("Statement must be less than 5000 characters"):n.statement=this.sanitizeInput(e.statement,{maxLength:5e3,allowLatex:!0,allowHtml:!1}),e.hints&&typeof e.hints=="string"&&(e.hints.length>5e3?t.push("Hints must be less than 5000 characters"):n.hints=this.sanitizeInput(e.hints,{maxLength:5e3,allowLatex:!0,allowHtml:!1})),e.proof&&typeof e.proof=="string"&&(e.proof.length>1e4?t.push("Proof must be less than 10000 characters"):n.proof=this.sanitizeInput(e.proof,{maxLength:1e4,allowLatex:!0,allowHtml:!1})),e.tags)if(typeof e.tags=="string"){const i=e.tags.split(",").map(l=>l.trim()).filter(l=>l);i.length>20&&t.push("Maximum 20 tags allowed"),n.tags=i.map(l=>this.sanitizeInput(l,{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(l=>l&&/^[a-zA-Z0-9\s\-_]+$/.test(l))}else Array.isArray(e.tags)&&(e.tags.length>20&&t.push("Maximum 20 tags allowed"),n.tags=e.tags.slice(0,20).map(i=>this.sanitizeInput(String(i),{maxLength:50,allowLatex:!1,allowHtml:!1})).filter(i=>i&&/^[a-zA-Z0-9\s\-_]+$/.test(i)));return e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),n.isPublic=!!e.isPublic,{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static validateProfileInput(e){const t=[],n={};return!e.displayName||typeof e.displayName!="string"?t.push("Display name is required"):e.displayName.length<2?t.push("Display name must be at least 2 characters"):e.displayName.length>50?t.push("Display name must be less than 50 characters"):/^[a-zA-Z0-9\s\-_\.]+$/.test(e.displayName)?n.displayName=this.sanitizeInput(e.displayName,{maxLength:50,allowLatex:!1,allowHtml:!1}):t.push("Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods"),e.bio&&typeof e.bio=="string"&&(e.bio.length>500?t.push("Bio must be less than 500 characters"):n.bio=this.sanitizeInput(e.bio,{maxLength:500,allowLatex:!1,allowHtml:!1})),e.subject&&typeof e.subject=="string"&&(e.subject.length>100?t.push("Subject must be less than 100 characters"):n.subject=this.sanitizeInput(e.subject,{maxLength:100,allowLatex:!1,allowHtml:!1})),{isValid:t.length===0,errors:t,sanitizedData:t.length===0?n:null}}static rateLimiter=new Map;static checkRateLimit(e,t=10,n=6e4){const i=Date.now(),u=(this.rateLimiter.get(e)||[]).filter(h=>i-h<n);return u.length>=t?{allowed:!1,retryAfter:n-(i-u[0]),message:`Rate limit exceeded. Try again in ${Math.ceil((n-(i-u[0]))/1e3)} seconds.`}:(u.push(i),this.rateLimiter.set(e,u),{allowed:!0,remaining:t-u.length})}static getPublicErrorMessage(e,t=!0){if(!t)return e.message||"Unknown error";const n={"auth/user-not-found":"Invalid email or password","auth/wrong-password":"Invalid email or password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password should be at least 6 characters","auth/invalid-email":"Please enter a valid email address","auth/user-disabled":"This account has been disabled","auth/too-many-requests":"Too many failed attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","auth/popup-closed-by-user":"Sign-in was cancelled","auth/popup-blocked":"Sign-in popup was blocked. Please disable popup blockers","permission-denied":"You don't have permission to perform this action","not-found":"The requested item was not found","already-exists":"This item already exists","resource-exhausted":"Service temporarily unavailable. Please try again","failed-precondition":"Unable to complete request. Please try again",aborted:"Request was cancelled. Please try again","out-of-range":"Request parameters are invalid",unimplemented:"This feature is not yet available",internal:"Internal error. Please try again",unavailable:"Service temporarily unavailable. Please try again","data-loss":"Data error occurred. Please contact support","functions/invalid-argument":"Invalid request parameters","functions/failed-precondition":"Unable to process request","functions/out-of-range":"Request parameters are out of range","functions/unauthenticated":"Please sign in to continue","functions/permission-denied":"You don't have permission for this action","functions/not-found":"Requested service not found","functions/already-exists":"Resource already exists","functions/resource-exhausted":"Service limit reached. Please try again later","functions/cancelled":"Request was cancelled","functions/unknown":"An unexpected error occurred","functions/deadline-exceeded":"Request timed out. Please try again","validation-error":"Please check your input and try again","rate-limit-exceeded":"Too many requests. Please wait and try again","content-too-long":"Content is too long. Please shorten and try again","invalid-content":"Content contains invalid characters","network-error":"Network error. Please check your connection"},i=e.code||e.name||"unknown";return n[i]||"Something went wrong. Please try again"}static INACTIVITY_TIMEOUT=3600*1e3;static lastActivity=Date.now();static timeoutWarningShown=!1;static updateActivity(){this.lastActivity=Date.now(),this.timeoutWarningShown=!1}static checkInactivity(e,t){const n=Date.now()-this.lastActivity;return n>this.INACTIVITY_TIMEOUT*.83&&!this.timeoutWarningShown&&(this.timeoutWarningShown=!0,e&&e()),n>this.INACTIVITY_TIMEOUT?(t&&t(),!0):!1}static setupActivityTracking(e,t){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(i=>{document.addEventListener(i,this.updateActivity.bind(this),{passive:!0})}),setInterval(()=>{this.checkInactivity(e,t)},6e4)}static detectSuspiciousContent(e){const t=[/<script[\s\S]*?>[\s\S]*?<\/script>/gi,/javascript:/gi,/vbscript:/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/union\s+select/gi,/drop\s+table/gi,/delete\s+from/gi,/data:text\/html/gi,/data:application/gi,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g],n=[];return t.forEach((i,l)=>{const u=e.match(i);u&&n.push({pattern:l,matches:u.length,content:u[0]})}),{isSuspicious:n.length>0,findings:n}}static generateSecureId(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";const i=new Uint8Array(e);crypto.getRandomValues(i);for(let l=0;l<e;l++)n+=t[i[l]%t.length];return n}static async hashForLogging(e){const n=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(u=>u.toString(16).padStart(2,"0")).join("")}}const jI=P.createContext(void 0),rE=s=>{switch(s){case"auth/popup-closed-by-user":return"Sign-in popup was closed.";case"auth/cancelled-popup-request":return"Another sign-in is in progress.";case"auth/popup-blocked":return"Popup blocked by the browser. Try again or disable the blocker.";case"auth/network-request-failed":return"Network error. Check your connection and try again.";case"auth/user-disabled":return"This account has been disabled.";default:return"Sign-in failed. Please try again."}},Sn=()=>{const s=P.useContext(jI);if(!s)throw new Error("useAuth must be used within <AuthProvider>");return s},YV=({children:s,fallback:e=null})=>{const[t,n]=P.useState(null),[i,l]=P.useState(null),[u,h]=P.useState(!0),[m,p]=P.useState(null),[x,b]=P.useState(!1),w=P.useRef(!1);P.useEffect(()=>{jR(Xn,JE).catch(B=>{console.warn("Auth persistence failed, falling back to default:",B)})},[]),P.useEffect(()=>{const B=RR(Xn,G=>{n(G),w.current||(w.current=!0,h(!1))}),L=YE(Xn,async G=>{if(G)try{const H=await G.getIdToken(!1);l(H)}catch(H){console.warn("Failed to get ID token:",H),l(null)}else l(null)});return()=>{B(),L()}},[]);const N=async()=>{if(!Xn.currentUser)return null;try{const B=await Xn.currentUser.getIdToken(!0);return l(B),B}catch(B){return console.warn("getFreshIdToken error:",B),null}},V=async()=>{p(null);const B=new na;B.setCustomParameters({prompt:"select_account"});try{return(await WR(Xn,B)).user}catch(L){if(L?.code==="auth/popup-blocked"||L?.code==="auth/popup-closed-by-user"||L?.code==="auth/cancelled-popup-request")try{return await s2(Xn,B),null}catch(G){throw p(rE(G.code)),G}throw p(rE(L.code)),L}},D=async()=>{p(null);try{await kR(Xn)}catch(B){throw p("Error signing out. Please try again."),B}};P.useEffect(()=>{if(t){const B=()=>{b(!0)},L=()=>{alert("Your session has expired due to inactivity. Please sign in again."),D()};ys.setupActivityTracking(B,L)}},[t]);const q=()=>{b(!1),ys.updateActivity()},z=P.useMemo(()=>({user:t,idToken:i,loading:u,authError:m,sessionWarning:x,dismissSessionWarning:q,signInWithGoogle:V,logout:D,getFreshIdToken:N}),[t,i,u,m,x]);return o.jsx(jI.Provider,{value:z,children:u?e:s})};class ns{static async isSlugTaken(e){try{return(await At(xe(te,"profiles",e))).exists()}catch(t){throw console.error("Error checking slug availability:",t),t}}static slugify(e){if(!e||typeof e!="string")return"";const n=e.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").slice(0,30);return n.length>=3?n:""}static async createProfile(e,t,n){try{const{displayName:i,bio:l="",institution:u="",email:h}=n;if(await this.isSlugTaken(t))throw new Error(`Slug '${t}' is already taken`);const m={userId:e,displayName:i,bio:l,institution:u,email:h,createdAt:ke(),updatedAt:ke(),flashcardCount:0,upvotesReceived:0,loginStreak:0,lastLoginDate:ke()};await Er(xe(te,"profiles",t),m),await Er(xe(te,"userToSlug",e),{slug:t}),console.log("✅ Profile created successfully:",{userId:e,slug:t})}catch(i){throw console.error("❌ Error creating profile:",i),i}}static async getProfileBySlug(e){try{const t=await At(xe(te,"profiles",e));return t.exists()?{id:t.id,slug:t.id,...t.data()}:null}catch(t){throw console.error("Error getting profile by slug:",t),t}}static async getProfileByUserId(e){try{const t=await At(xe(te,"userToSlug",e));if(!t.exists())return null;const{slug:n}=t.data();return await this.getProfileBySlug(n)}catch(t){throw console.error("Error getting profile by user ID:",t),t}}static async updateProfile(e,t){try{const n={...t,updatedAt:ke()};await Mt(xe(te,"profiles",e),n),console.log("✅ Profile updated successfully:",e)}catch(n){throw console.error("❌ Error updating profile:",n),n}}static async searchProfiles(e,t=20){try{const n=e.toLowerCase().trim();if(!n)return[];const i=Pe(Ne(te,"profiles")),l=await Fe(i),u=[];return l.docs.forEach(h=>{const m=h.data(),p=(m.displayName||"").toLowerCase(),x=(m.email||"").toLowerCase();(p.includes(n)||x.includes(n))&&u.push({slug:h.id,userId:m.userId,displayName:m.displayName,email:m.email,institution:m.institution,flashcardCount:m.flashcardCount||0})}),u.slice(0,t)}catch(n){throw console.error("Error searching profiles:",n),n}}static async getUserSlug(e){try{const t=await At(xe(te,"userToSlug",e));return t.exists()?t.data().slug:null}catch(t){return console.error("Error getting user slug:",t),null}}static async hasProfile(e){try{return!!await this.getUserSlug(e)}catch(t){return console.error("Error checking if user has profile:",t),!1}}static async updateUserStats(e,t){try{const n=await this.getUserSlug(e);if(!n)return;await this.updateProfile(n,t)}catch(n){throw console.error("Error updating user stats:",n),n}}}class Ln{static async createDeck(e,t){try{const n=await Jn(Ne(te,"decks"),{name:t.name||"Untitled Deck",description:t.description||"",userId:e,isPublic:t.isPublic||!1,isDefault:t.isDefault||!1,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,color:t.color||"#635BFF",icon:t.icon||"📚",createdAt:ke(),updatedAt:ke(),authorSlug:t.authorSlug||null,slug:t.slug||null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0});return t.isPublic&&t.slug&&t.authorSlug&&await Jn(Ne(te,"publicDecks"),{deckId:n.id,name:t.name,description:t.description,authorSlug:t.authorSlug,slug:t.slug,subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:t.tags||[],cardCount:0,likeCount:0,importCount:0,createdAt:ke()}),n.id}catch(n){throw console.error("Error creating deck:",n),n}}static async getUserDecks(e,t=!0){try{let n=Pe(Ne(te,"decks"),qe("userId","==",e),Gt("updatedAt","desc"));return t||(n=Pe(Ne(te,"decks"),qe("userId","==",e),qe("isDefault","==",!1),Gt("updatedAt","desc"))),(await Fe(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user decks:",n),n}}static async getDeck(e){try{const t=await At(xe(te,"decks",e));if(!t.exists())throw new Error("Deck not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching deck:",t),t}}static async updateDeck(e,t){try{const n={...t,updatedAt:ke()};await Mt(xe(te,"decks",e),n);const i=await this.getDeck(e);if(i.isPublic&&i.slug){const l=Pe(Ne(te,"publicDecks"),qe("deckId","==",e),Ht(1)),u=await Fe(l);if(!u.empty){const h=u.docs[0];await Mt(xe(te,"publicDecks",h.id),{name:t.name||i.name,description:t.description||i.description,subject:t.subject||i.subject,difficulty:t.difficulty||i.difficulty,tags:t.tags||i.tags})}}return!0}catch(n){throw console.error("Error updating deck:",n),n}}static async deleteDeck(e){try{const t=xo(te),n=Pe(Ne(te,"deckCards"),qe("deckId","==",e)),i=await Fe(n);for(const h of i.docs){t.delete(xe(te,"deckCards",h.id));const m=h.data().cardId,p=xe(te,"cards",m);t.update(p,{deckIds:om(e)})}t.delete(xe(te,"decks",e));const l=Pe(Ne(te,"publicDecks"),qe("deckId","==",e)),u=await Fe(l);for(const h of u.docs)t.delete(xe(te,"publicDecks",h.id));return await t.commit(),!0}catch(t){throw console.error("Error deleting deck:",t),t}}static async addCardToDeck(e,t,n=null){try{return await Hu(te,async i=>{const l=xe(te,"decks",e),u=await i.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data().cardCount||0,m=n!==null?n:h+1,p=xe(Ne(te,"deckCards"));i.set(p,{deckId:e,cardId:t,position:m,addedAt:ke(),addedBy:u.data().userId});const x=xe(te,"cards",t);return i.update(x,{deckIds:mc(e)}),i.update(l,{cardCount:h+1,updatedAt:ke()}),p.id})}catch(i){throw console.error("Error adding card to deck:",i),i}}static async removeCardFromDeck(e,t){try{return await Hu(te,async n=>{const i=Pe(Ne(te,"deckCards"),qe("deckId","==",e),qe("cardId","==",t),Ht(1)),l=await Fe(i);if(l.empty)throw new Error("Card not found in deck");const u=l.docs[0];n.delete(xe(te,"deckCards",u.id));const h=xe(te,"cards",t);n.update(h,{deckIds:om(e)});const m=xe(te,"decks",e),x=(await n.get(m)).data().cardCount||0;return n.update(m,{cardCount:Math.max(0,x-1),updatedAt:ke()}),!0})}catch(n){throw console.error("Error removing card from deck:",n),n}}static async getDeckCards(e,t=100){try{const n=Pe(Ne(te,"deckCards"),qe("deckId","==",e),Gt("position","asc"),Ht(t)),l=(await Fe(n)).docs.map(h=>h.data().cardId);if(l.length===0)return[];const u=[];for(const h of l)try{const m=await At(xe(te,"cards",h));m.exists()&&u.push({id:m.id,...m.data()})}catch(m){console.warn(`Failed to fetch card ${h}:`,m)}return u}catch(n){throw console.error("Error fetching deck cards:",n),n}}static async reorderCardsInDeck(e,t){try{const n=xo(te);for(const{cardId:i,position:l}of t){const u=Pe(Ne(te,"deckCards"),qe("deckId","==",e),qe("cardId","==",i),Ht(1)),h=await Fe(u);if(!h.empty){const m=h.docs[0];n.update(xe(te,"deckCards",m.id),{position:l})}}return await n.commit(),!0}catch(n){throw console.error("Error reordering deck cards:",n),n}}static async createDefaultDeck(e){try{const t={name:"My Flashcards",description:"Your complete collection - contains all your flashcards",isDefault:!0,isPublic:!1,subject:"",difficulty:"mixed",tags:[],color:"#635BFF",icon:"📚"};return{id:await this.createDeck(e,t),...t}}catch(t){throw console.error("Error creating default deck:",t),t}}static async getOrCreateDefaultDeck(e){try{const t=Pe(Ne(te,"decks"),qe("userId","==",e),qe("isDefault","==",!0),Ht(1)),n=await Fe(t);if(!n.empty){const i=n.docs[0];return{id:i.id,...i.data()}}return await this.createDefaultDeck(e)}catch(t){throw console.error("Error getting or creating default deck:",t),t}}static async migrateCardsToDefaultDeck(e){try{console.log(`🔄 Starting deck migration for user: ${e}`);const t=await this.getOrCreateDefaultDeck(e);console.log(`📚 Default deck: ${t.name} (${t.id})`);const[n,i]=await Promise.all([this.getUserCardsFromCollection("cards",e),this.getUserCardsFromCollection("flashcards",e)]),l=[...n,...i];if(console.log(`🃏 Found ${l.length} cards to migrate`),l.length===0)return console.log("✅ No cards to migrate"),{migratedCount:0,defaultDeck:t};let u=0;const h=xo(te);for(const m of l)try{const p=xe(Ne(te,"deckCards"));h.set(p,{deckId:t.id,cardId:m.id,position:u+1,addedAt:ke(),addedBy:e});const x=xe(te,m.collection,m.id),b=m.deckIds||[],w=b.includes(t.id)?b:[...b,t.id];h.update(x,{deckIds:w,defaultDeckId:t.id}),u++}catch(p){console.warn(`Failed to migrate card ${m.id}:`,p)}if(u>0){const m=xe(te,"decks",t.id);h.update(m,{cardCount:u,updatedAt:ke()}),await h.commit()}return console.log(`✅ Migration complete: ${u} cards migrated`),{migratedCount:u,defaultDeck:t}}catch(t){throw console.error("Error migrating cards to default deck:",t),t}}static async getUserCardsFromCollection(e,t){try{const n=Pe(Ne(te,e),qe("userId","==",t),Gt("createdAt","desc"));return(await Fe(n)).docs.map(l=>({id:l.id,collection:e,...l.data()}))}catch(n){return console.error(`Error fetching cards from ${e}:`,n),[]}}static async makeDeckPublic(e,t,n){try{return await Hu(te,async i=>{const l=xe(te,"decks",e),u=await i.get(l);if(!u.exists())throw new Error("Deck not found");const h=u.data();i.update(l,{isPublic:!0,authorSlug:t,slug:n,updatedAt:ke()});const m=xe(Ne(te,"publicDecks"));return i.set(m,{deckId:e,name:h.name,description:h.description,authorSlug:t,slug:n,subject:h.subject||"",difficulty:h.difficulty||"beginner",tags:h.tags||[],cardCount:h.cardCount||0,likeCount:0,importCount:0,createdAt:h.createdAt}),!0})}catch(i){throw console.error("Error making deck public:",i),i}}static async getPublicDecks(e={},t=50){try{let n=Pe(Ne(te,"publicDecks"));return e.subject&&(n=Pe(n,qe("subject","==",e.subject))),e.difficulty&&(n=Pe(n,qe("difficulty","==",e.difficulty))),e.tag&&(n=Pe(n,qe("tags","array-contains",e.tag))),e.sortBy==="popular"?n=Pe(n,Gt("likeCount","desc"),Gt("createdAt","desc")):e.sortBy==="imported"?n=Pe(n,Gt("importCount","desc"),Gt("createdAt","desc")):n=Pe(n,Gt("createdAt","desc")),n=Pe(n,Ht(t)),(await Fe(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching public decks:",n),n}}static async importPublicDeck(e,t){try{return await Hu(te,async n=>{const i=xe(te,"decks",e),l=await n.get(i);if(!l.exists())throw new Error("Source deck not found");const u=l.data(),h=xe(Ne(te,"decks"));n.set(h,{...u,userId:t,isPublic:!1,isDefault:!1,name:`${u.name} (Imported)`,authorSlug:null,slug:null,likeCount:0,importCount:0,viewCount:0,studyStreak:0,lastStudied:null,averageScore:0,createdAt:ke(),updatedAt:ke()});const m=Pe(Ne(te,"deckCards"),qe("deckId","==",e)),p=await Fe(m);for(const w of p.docs){const N=w.data(),V=xe(te,"cards",N.cardId),D=await n.get(V);if(D.exists()){const q=D.data(),z=xe(Ne(te,"cards"));n.set(z,{...q,userId:t,isPublic:!1,deckIds:[h.id],defaultDeckId:h.id,createdAt:ke(),originalCardId:N.cardId});const B=xe(Ne(te,"deckCards"));n.set(B,{deckId:h.id,cardId:z.id,position:N.position,addedAt:ke(),addedBy:t})}}const x=Pe(Ne(te,"publicDecks"),qe("deckId","==",e),Ht(1)),b=await Fe(x);if(!b.empty){const w=b.docs[0];n.update(xe(te,"publicDecks",w.id),{importCount:(w.data().importCount||0)+1})}return h.id})}catch(n){throw console.error("Error importing public deck:",n),n}}static async updateDeckStats(e,t){try{const n=xe(te,"decks",e);return await Mt(n,{...t,lastStudied:ke(),updatedAt:ke()}),!0}catch(n){throw console.error("Error updating deck stats:",n),n}}static async getDeckAnalytics(e){try{const t=await this.getDeck(e),n=await this.getDeckCards(e);return{cardCount:n.length,studyStreak:t.studyStreak||0,averageScore:t.averageScore||0,lastStudied:t.lastStudied,createdAt:t.createdAt,subjects:[...new Set(n.map(i=>i.subject).filter(Boolean))],tags:[...new Set(n.flatMap(i=>i.tags||[]))]}}catch(t){throw console.error("Error getting deck analytics:",t),t}}static async generateUniqueSlug(e,t){try{const n=`${e.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,30)}-${t}`;let i=n,l=0;for(;l<5;){const u=Pe(Ne(te,"publicDecks"),qe("slug","==",i),Ht(1));if((await Fe(u)).empty)return i;i=`${n}-${Math.floor(Math.random()*1e4)}`,l++}throw new Error("Failed to generate unique slug")}catch(n){throw console.error("Error generating unique slug:",n),n}}}class Mf{static async getUserProfile(e){try{return await ns.getProfileByUserId(e)}catch(t){throw console.error("Error fetching user profile:",t),t}}static async createUserProfile(e,t){try{const n=xe(te,"users",e);return await Er(n,{...t,createdAt:ke(),updatedAt:ke(),isPremium:!1,flashcardCount:0,upvotes:0,streak:0}),e}catch(n){throw console.error("Error creating user profile:",n),n}}static async updateUserProfile(e,t){try{const n=xe(te,"users",e);await Mt(n,{...t,updatedAt:ke()})}catch(n){throw console.error("Error updating user profile:",n),n}}static async getUserStats(e){try{const t=await this.getUserProfile(e);if(!t)return null;const n=[Pe(Ne(te,"cards"),qe("userId","==",e)),Pe(Ne(te,"flashcards"),qe("userId","==",e)),Pe(Ne(te,"publicCards"),qe("userId","==",e))],[i,l,u]=await Promise.all(n.map(p=>Fe(p))),h=i.size+l.size+u.size,m=[];return h>0&&m.push("first_card"),h>=10&&m.push("ten_cards"),h>=100&&m.push("hundred_cards"),t.upvotesReceived>50&&m.push("popular_creator"),{...t,flashcardCount:h,achievements:m,studySessions:Math.floor(Math.random()*20)+1,followers:Math.floor(Math.random()*100),rating:(Math.random()*2+3).toFixed(1)}}catch(t){throw console.error("Error fetching user stats:",t),t}}static async checkOnboardingStatus(e){try{const t=await this.getUserProfile(e);if(!t)return{hasProfile:!1,hasCards:!1};const n=Pe(Ne(te,"flashcards"),qe("authorId","==",e),Ht(1));return{hasProfile:!0,hasCards:!(await Fe(n)).empty,profile:t}}catch(t){throw console.error("Error checking onboarding status:",t),t}}static async getTopUsers(e=20,t="allTime"){try{const n=Pe(Ne(te,"users"),Gt("flashcardCount","desc"),Gt("upvotes","desc"),Ht(e));return(await Fe(n)).docs.map(l=>({uid:l.id,...l.data()}))}catch(n){return console.error("Error fetching top users:",n),[]}}static async getStudyHistory(e){try{return[{date:"2024-01-15",duration:45,cardsStudied:12,accuracy:85},{date:"2024-01-14",duration:30,cardsStudied:8,accuracy:92},{date:"2024-01-13",duration:60,cardsStudied:20,accuracy:78},{date:"2024-01-12",duration:25,cardsStudied:6,accuracy:95},{date:"2024-01-11",duration:40,cardsStudied:15,accuracy:88}]}catch(t){return console.error("Error fetching study history:",t),[]}}static async needsDeckMigration(e){try{if((await Ln.getUserDecks(e)).length>0)return!1;const n=Pe(Ne(te,"cards"),qe("userId","==",e),Ht(1)),i=await Fe(n),l=Pe(Ne(te,"flashcards"),qe("userId","==",e),Ht(1)),u=await Fe(l);return!i.empty||!u.empty}catch(t){return console.error("Error checking deck migration status:",t),!1}}static async migrateUserToDecks(e){try{if(console.log(`🚀 Starting deck migration for user: ${e}`),!await this.needsDeckMigration(e))return console.log("✅ User already migrated or has no cards"),{success:!0,message:"No migration needed"};const n=await Ln.migrateCardsToDefaultDeck(e),i=xe(te,"users",e);return await Er(i,{deckMigrationCompleted:!0,deckMigrationDate:ke(),updatedAt:ke()},{merge:!0}),console.log(`✅ Deck migration completed for user: ${e}`),console.log("📊 Migration stats:",n),{success:!0,message:`Successfully migrated ${n.migratedCount} cards`,migrationResult:n}}catch(t){console.error("Error migrating user to decks:",t);try{const n=xe(te,"users",e);await Er(n,{deckMigrationFailed:!0,deckMigrationError:t.message,deckMigrationAttemptDate:ke(),updatedAt:ke()},{merge:!0})}catch(n){console.error("Failed to log migration error:",n)}return{success:!1,message:`Migration failed: ${t.message}`,error:t}}}static async autoMigrateUserDecks(e){try{const t=await At(xe(te,"users",e)),n=t.exists()?t.data():{};if(n.deckMigrationCompleted)return{success:!0,message:"Already migrated"};if(n.deckMigrationFailed&&n.deckMigrationAttemptDate){const i=n.deckMigrationAttemptDate.toMillis();if((Date.now()-i)/(1e3*60*60)<24)return{success:!1,message:"Migration failed recently, will retry later"}}return await this.migrateUserToDecks(e)}catch(t){return console.error("Error in auto-migration:",t),{success:!1,message:"Auto-migration failed",error:t}}}}const XV="modulepreload",WV=function(s){return"/new/"+s},aE={},Yt=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let p=function(x){return Promise.all(x.map(b=>Promise.resolve(b).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};var u=p;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),m=h?.nonce||h?.getAttribute("nonce");i=p(t.map(x=>{if(x=WV(x),x in aE)return;aE[x]=!0;const b=x.endsWith(".css"),w=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${w}`))return;const N=document.createElement("link");if(N.rel=b?"stylesheet":XV,b||(N.as="script"),N.crossOrigin="",N.href=x,m&&N.setAttribute("nonce",m),document.head.appendChild(N),b)return new Promise((V,D)=>{N.addEventListener("load",V),N.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${x}`)))})}))}function l(h){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=h,window.dispatchEvent(m),!m.defaultPrevented)throw h}return i.then(h=>{for(const m of h||[])m.status==="rejected"&&l(m.reason);return e().catch(l)})};class Un{static async getUserFlashcards(e,t=50){try{const n=Pe(Ne(te,"cards"),qe("userId","==",e),Gt("createdAt","desc"),Ht(t));return(await Fe(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user flashcards:",n),n}}static async getPublicFlashcards(e=50){try{const t=Pe(Ne(te,"publicCards"),Gt("createdAt","desc"),Ht(e));return(await Fe(t)).docs.map(i=>({id:i.id,...i.data()}))}catch(t){throw console.error("Error fetching public flashcards:",t),t}}static async getPublicFlashcardsByUser(e,t=50){try{const n=Pe(Ne(te,"publicCards"),qe("userId","==",e),Gt("createdAt","desc"),Ht(t));return(await Fe(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(n){throw console.error("Error fetching user public flashcards:",n),n}}static async createFlashcard(e,t,n=null){try{if(console.log("🎯 Creating flashcard for user:",t,"with data:",e),!t||typeof t!="string")throw new Error("Valid user ID is required to create flashcard");const i=await Ln.getOrCreateDefaultDeck(t);console.log("📚 Default deck obtained:",i.id);const l=n||i.id,u=n&&n!==i.id?[i.id,l]:[i.id],h={statement:e.statement||e.question||"",hints:e.hints||e.answer||"",proof:e.proof||"",tags:Array.isArray(e.tags)?e.tags:typeof e.tags=="string"?e.tags.split(",").map(p=>p.trim()).filter(p=>p):[],subject:e.subject||"",userId:t,createdAt:ke(),isPublic:e.isPublic||!1,defaultDeckId:i.id,deckIds:u};console.log("💾 Creating card document:",h);const m=await Jn(Ne(te,"cards"),h);if(e.isPublic){const{getDoc:p}=await Yt(async()=>{const{getDoc:V}=await Promise.resolve().then(()=>Ms);return{getDoc:V}},void 0),x=await p(xe(te,"userToSlug",t));if(!x.exists())throw new Error("You must create a profile before posting public cards. Please create your profile first.");const b=x.data().slug,w=(e.question||e.statement).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,50),N=await this.ensureUniqueCardSlug(w);await Jn(Ne(te,"publicCards"),{statement:e.question||e.statement,hints:e.hints||e.answer,proof:e.proof||e.answer,tags:e.tags||[],userId:t,authorSlug:b,slug:N,createdAt:ke(),likeCount:0,viewCount:0,importCount:0})}for(const p of u)await Ln.addCardToDeck(p,m.id);return m.id}catch(i){throw console.error("Error creating flashcard:",i),i}}static async updateCardDeck(e,t){try{const n=xe(te,"cards",e),i=await At(n);if(!i.exists())throw new Error("Card not found");const u=i.data().deckIds||[];if(!u.includes(t)){const h=[...u,t];await Mt(n,{deckIds:h})}return!0}catch(n){throw console.error("Error updating card deck:",n),n}}static async ensureUniqueCardSlug(e){let t=e,n=0;for(;n<5;){const{query:i,where:l,limit:u,getDocs:h}=await Yt(async()=>{const{query:x,where:b,limit:w,getDocs:N}=await Promise.resolve().then(()=>Ms);return{query:x,where:b,limit:w,getDocs:N}},void 0),m=i(Ne(te,"publicCards"),l("slug","==",t),u(1));if((await h(m)).empty)return t;t=e+"-"+Math.floor(Math.random()*1e4),n++}throw new Error("Failed to generate unique card slug after multiple attempts.")}static async updateFlashcard(e,t){try{const n=xe(te,"cards",e);await Mt(n,{...t,updatedAt:ke()})}catch(n){throw console.error("Error updating flashcard:",n),n}}static async deleteFlashcard(e){try{const t=xe(te,"cards",e);await Hl(t)}catch(t){throw console.error("Error deleting flashcard:",t),t}}static async searchFlashcards(e,t={},n=20){try{const i=[qe("isPublic","==",!0)];t.subject&&i.push(qe("subject","==",t.subject));let l="createdAt",u="desc";t.sortBy==="oldest"?(l="createdAt",u="asc"):t.sortBy==="popular"&&(l="upvotes",u="desc");const h=Pe(Ne(te,"flashcards"),...i,Gt(l,u),Ht(n*3));let p=(await Fe(h)).docs.map(x=>({id:x.id,...x.data()}));if(e&&e.trim()){const x=e.toLowerCase();p=p.filter(b=>b.question?.toLowerCase().includes(x)||b.answer?.toLowerCase().includes(x)||Array.isArray(b.hints)&&b.hints.some(w=>w.toLowerCase().includes(x))||Array.isArray(b.tags)&&b.tags.some(w=>w.toLowerCase().includes(x)))}return p.slice(0,n)}catch(i){return console.error("Error searching flashcards:",i),await this.getPublicFlashcards(n)}}static async getSubjects(){try{const e=await this.getPublicFlashcards(1e3),t=new Set;return e.forEach(n=>{n.subject&&t.add(n.subject)}),Array.from(t).sort()}catch(e){return console.error("Error fetching subjects:",e),["Mathematics","Physics","Chemistry","Biology","Computer Science"]}}static async getPopularTags(e=20){try{const t=await this.getPublicFlashcards(1e3),n={};return t.forEach(i=>{i.tags&&i.tags.forEach(l=>{n[l]=(n[l]||0)+1})}),Object.entries(n).sort(([,i],[,l])=>l-i).slice(0,e).map(([i])=>i)}catch(t){return console.error("Error fetching popular tags:",t),["calculus","algebra","geometry","trigonometry","statistics"]}}static async getUserFavorites(e){try{return(await this.getPublicFlashcards(20)).slice(0,10)}catch(t){return console.error("Error fetching user favorites:",t),[]}}static async removeFromFavorites(e,t){try{return!0}catch(n){throw console.error("Error removing from favorites:",n),n}}static async getDeckFlashcards(e,t=100){try{return await Ln.getDeckCards(e,t)}catch(n){throw console.error("Error fetching deck flashcards:",n),n}}static async moveCardToDeck(e,t,n){try{return t&&await Ln.removeCardFromDeck(t,e),await Ln.addCardToDeck(n,e),await Mt(xe(te,"cards",e),{defaultDeckId:n,deckIds:mc(n)}),t&&await Mt(xe(te,"cards",e),{deckIds:om(t)}),!0}catch(i){throw console.error("Error moving card to deck:",i),i}}static async getUserFlashcardsByDeck(e){try{const t=await Ln.getUserDecks(e),n={};for(const i of t)n[i.id]={deck:i,cards:await this.getDeckFlashcards(i.id)};return n}catch(t){throw console.error("Error fetching user flashcards by deck:",t),t}}static async createFlashcardInDeck(e,t,n){try{return await this.createFlashcard(e,t,n)}catch(i){throw console.error("Error creating flashcard in deck:",i),i}}static async getFlashcardsFromDecks(e,t=200){try{const n=[];for(const l of e){const u=await this.getDeckFlashcards(l,t);n.push(...u)}return n.reduce((l,u)=>(l.find(h=>h.id===u.id)||l.push(u),l),[]).sort((l,u)=>{const h=l.createdAt?.toMillis?.()||l.createdAt?.getTime?.()||0;return(u.createdAt?.toMillis?.()||u.createdAt?.getTime?.()||0)-h})}catch(n){throw console.error("Error fetching flashcards from multiple decks:",n),n}}static async getPublicFlashcard(e){try{const t=await At(xe(te,"publicCards",e));if(!t.exists())throw new Error("Public flashcard not found");return{id:t.id,...t.data()}}catch(t){throw console.error("Error fetching public flashcard:",t),t}}static async updatePublicFlashcard(e,t,n){try{const i=await At(xe(te,"publicCards",e));if(!i.exists())throw new Error("Public flashcard not found");if(i.data().userId!==n)throw new Error("You can only edit your own public flashcards");const u=xe(te,"publicCards",e);return await Mt(u,{...t,updatedAt:ke()}),{success:!0}}catch(i){throw console.error("Error updating public flashcard:",i),i}}static async deletePublicFlashcard(e,t){try{const n=await At(xe(te,"publicCards",e));if(!n.exists())throw new Error("Public flashcard not found");if(n.data().userId!==t)throw new Error("You can only delete your own public flashcards");return await Hl(xe(te,"publicCards",e)),{success:!0}}catch(n){throw console.error("Error deleting public flashcard:",n),n}}static async toggleFlashcardPublic(e,t,n=!0){try{return n?await this.makeFlashcardPublic(e,t):await this.makeFlashcardPrivate(e,t),{success:!0}}catch(i){throw console.error("Error toggling flashcard public status:",i),i}}static async makeFlashcardPublic(e,t){try{const n=await this.getFlashcard(e,t),i=await At(xe(te,"userToSlug",t));if(!i.exists())throw new Error("You must create a profile before making cards public");const l=i.data().slug,u=this.generateSlugFromStatement(n.statement),h=await this.ensureUniqueSlug(u),m={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,authorSlug:l,slug:h,createdAt:n.createdAt||ke(),updatedAt:ke(),likeCount:0,viewCount:0,importCount:0};return await setDoc(xe(te,"publicCards",h),m),await Mt(xe(te,"cards",e),{isPublic:!0,publicSlug:h,updatedAt:ke()}),{success:!0,publicSlug:h,publicUrl:`/card/${h}`}}catch(n){throw console.error("Error making flashcard public:",n),n}}static async makeFlashcardPrivate(e,t){try{const n=await At(xe(te,"cards",e));if(!n.exists())throw new Error("Private flashcard not found");const i=n.data();if(i.userId!==t)throw new Error("You can only modify your own flashcards");return i.publicSlug&&await Hl(xe(te,"publicCards",i.publicSlug)),await Mt(xe(te,"cards",e),{isPublic:!1,publicSlug:null,updatedAt:ke()}),{success:!0}}catch(n){throw console.error("Error making flashcard private:",n),n}}static async importPublicFlashcard(e,t){try{const n=await this.getPublicFlashcard(e),i={statement:n.statement,hints:n.hints,proof:n.proof,subject:n.subject,tags:n.tags||[],userId:t,createdAt:ke(),isPublic:!1,originalCardId:e,originalAuthor:n.userId,importedAt:ke()},l=await Jn(Ne(te,"cards"),i);return await Mt(xe(te,"publicCards",e),{importCount:increment(1)}),{success:!0,cardId:l.id}}catch(n){throw console.error("Error importing public flashcard:",n),n}}static generateSlugFromStatement(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().replace(/\s+/g,"-").slice(0,50)}static async ensureUniqueSlug(e){let t=e,n=0;const i=10;for(;n<i;){if(!(await At(xe(te,"publicCards",t))).exists())return t;n++,t=`${e}-${Math.floor(Math.random()*1e4)}`}throw new Error("Failed to generate unique slug after multiple attempts")}}class Vf{static async autoFillFromStatement(e){try{const t=await Xn.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/deepseekAutofill",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}const i=await n.json();return{hints:i.hints||"",proof:i.proof||"",tags:i.tags||[]}}catch(t){throw console.error("Error with AI autofill:",t),t}}static async autoTagOnly(e){try{const t=await Xn.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/autoTagOnly",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({statement:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).tags||[]}catch(t){throw console.error("Error with AI auto-tagging:",t),t}}static async convertToLaTeX(e){try{const t=await Xn.currentUser?.getIdToken(),n=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/convertToLatex",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({input:e})});if(!n.ok){const l=await n.json();throw new Error(l.error||"AI request failed")}return(await n.json()).latex||e}catch(t){throw console.error("Error converting to LaTeX:",t),t}}}const JV=({value:s,onChange:e,className:t="",placeholder:n="Type tags here or click existing tags below"})=>{const{user:i}=Sn(),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[b,w]=P.useState([]),N=P.useRef(null);P.useEffect(()=>{const H=s?s.split(",").map(R=>R.trim()).filter(R=>R):[];w(H)},[s]);const V=()=>{if(!s)return l;const H=s.split(",").map(C=>C.trim()),R=H[H.length-1].toLowerCase();return R?l.filter(C=>C.toLowerCase().includes(R)&&!b.includes(C)).sort((C,T)=>{const A=C.toLowerCase().startsWith(R),k=T.toLowerCase().startsWith(R);return A&&!k?-1:!A&&k?1:C.localeCompare(T)}):l};P.useEffect(()=>{D()},[i]);const D=async()=>{if(!i?.uid){m(!1);return}try{m(!0);const H=await Un.getUserFlashcards(i.uid,200),{collection:R,query:C,where:T,getDocs:A}=await Yt(async()=>{const{collection:ie,query:K,where:pe,getDocs:j}=await Promise.resolve().then(()=>Ms);return{collection:ie,query:K,where:pe,getDocs:j}},void 0),{db:k}=await Yt(async()=>{const{db:ie}=await Promise.resolve().then(()=>oa);return{db:ie}},void 0),U=C(R(k,"flashcards"),T("userId","==",i.uid)),M=(await A(U)).docs.map(ie=>ie.data()),ze=[...H,...M],se=new Set;ze.forEach(ie=>{ie.tags&&Array.isArray(ie.tags)?ie.tags.forEach(K=>{K&&typeof K=="string"&&se.add(K.trim())}):typeof ie.tags=="string"&&ie.tags.split(",").forEach(K=>{const pe=K.trim();pe&&se.add(pe)})});const F=Array.from(se).sort();u(F)}catch(H){console.error("Error loading existing tags:",H),u([])}finally{m(!1)}},q=H=>{const R=b.slice();if(R.includes(H))return;const C=[...R,H],T=C.join(", ");w(C),e(T)},z=H=>{const R=b.filter(T=>T!==H),C=R.join(", ");w(R),e(C)},B=H=>{e(H.target.value)},L=H=>{if(H.key==="Tab"){const R=V();R.length>0&&(H.preventDefault(),q(R[0]))}},G=()=>{x(!p)};return o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"mb-3",children:o.jsx("textarea",{ref:N,value:s,onChange:B,onKeyDown:L,placeholder:n,className:`claude-input w-full resize-none ${t}`,rows:"2"})}),b.length>0&&o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Selected tags:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:b.map((H,R)=>o.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:["#",H,o.jsx("button",{onClick:()=>z(H),className:"ml-1 hover:bg-white/20 rounded-full w-4 h-4 flex items-center justify-center text-xs",title:"Remove tag",children:"×"})]},R))})]}),o.jsxs("div",{className:"existing-tags-section",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("div",{className:"text-sm claude-text-secondary",children:s?`Filtered tags (${V().length}):`:"Click to add existing tags:"}),l.length>6&&o.jsxs("button",{onClick:G,className:"text-sm px-2 py-1 rounded",style:{color:"var(--claude-accent)",backgroundColor:"var(--claude-accent-bg)"},children:["View All (",l.length,")"]})]}),o.jsx("div",{className:"existing-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",maxHeight:"120px",overflowY:"auto",padding:"0.75rem",backgroundColor:"var(--claude-surface)",border:"1px solid var(--claude-border)",borderRadius:"8px"},children:h?o.jsx("div",{className:"claude-text-muted italic",children:"Loading existing tags..."}):l.length===0?o.jsx("div",{className:"claude-text-muted italic",children:"No existing tags found. Create your first card to see tags here!"}):V().length===0&&s?o.jsxs("div",{className:"claude-text-muted italic",children:['No tags match your search. Press Enter to add "',s.split(",").pop()?.trim(),'" as a new tag.']}):V().slice(0,p?V().length:12).map(H=>{const R=b.includes(H);return o.jsxs("button",{onClick:()=>q(H),className:`tag-btn transition-all duration-200 ${R?"selected":""}`,style:{backgroundColor:R?"var(--claude-accent)":"var(--claude-subtle)",color:R?"white":"var(--claude-primary-text)",border:"none",padding:"0.25rem 0.75rem",borderRadius:"20px",fontSize:"0.85rem",cursor:"pointer",whiteSpace:"nowrap",opacity:R?.7:1},onMouseEnter:C=>{R||(C.target.style.backgroundColor="var(--claude-border)",C.target.style.color="var(--claude-heading)")},onMouseLeave:C=>{R||(C.target.style.backgroundColor="var(--claude-subtle)",C.target.style.color="var(--claude-primary-text)")},title:R?"Already selected":`Add "${H}" tag`,children:["#",H]},H)})})]}),p&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"claude-card max-w-2xl w-full mx-4 p-6 max-h-[80vh] overflow-hidden",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Select Tags"}),o.jsx("button",{onClick:()=>x(!1),className:"claude-text-muted hover:claude-text-secondary transition-colors text-2xl",style:{color:"var(--claude-text-muted)"},onMouseEnter:H=>H.target.style.color="var(--claude-text-secondary)",onMouseLeave:H=>H.target.style.color="var(--claude-text-muted)",children:"×"})]}),o.jsx("div",{className:"mb-4",children:o.jsx("p",{className:"claude-text-secondary",children:"Click tags to add them to your flashcard:"})}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-96 overflow-y-auto p-2",children:l.map(H=>{const R=b.includes(H);return o.jsxs("button",{onClick:()=>{q(H)},className:`p-3 rounded-lg border text-left transition-all duration-200 ${R?"border-purple-500 bg-purple-500/20":"border-gray-600 hover:border-purple-500 hover:bg-purple-500/10"}`,children:[o.jsxs("div",{className:"font-medium",style:{color:R?"var(--claude-accent)":"var(--claude-primary-text)"},children:["#",H]}),o.jsx("div",{className:"text-sm claude-text-secondary",children:R?"✓ Selected":"Click to add"})]},H)})}),o.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:o.jsxs("button",{onClick:()=>x(!1),className:"claude-button-primary flex-1",children:["Done (",b.length," selected)"]})})]})})]})},ZV=({value:s,onChange:e,className:t="",placeholder:n="Select or type a subject"})=>{const{user:i}=Sn(),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[b,w]=P.useState(!1),N=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Statistics","Calculus","Linear Algebra","Differential Equations","Organic Chemistry","Molecular Biology","Machine Learning","Data Science","Literature","World History","European History","American History","Political Science"];P.useEffect(()=>{V()},[i]);const V=async()=>{if(!i?.uid){m(!1);return}try{m(!0);const R=await Un.getUserFlashcards(i.uid,200),{collection:C,query:T,where:A,getDocs:k}=await Yt(async()=>{const{collection:K,query:pe,where:j,getDocs:oe}=await Promise.resolve().then(()=>Ms);return{collection:K,query:pe,where:j,getDocs:oe}},void 0),{db:U}=await Yt(async()=>{const{db:K}=await Promise.resolve().then(()=>oa);return{db:K}},void 0),$=T(C(U,"flashcards"),A("userId","==",i.uid)),ze=(await k($)).docs.map(K=>K.data()),se=[...R,...ze],F=new Set;se.forEach(K=>{if(K.subject&&typeof K.subject=="string"){const pe=K.subject.trim();pe&&pe!=="General"&&F.add(pe)}});const ie=Array.from(F).sort();u(ie)}catch(R){console.error("Error loading existing subjects:",R),u([])}finally{m(!1)}},D=()=>{const R=new Set([...N,...l]),C=s?.toLowerCase()||"";return C?Array.from(R).filter(T=>T.toLowerCase().includes(C)).sort((T,A)=>{const k=T.toLowerCase().startsWith(C),U=A.toLowerCase().startsWith(C);return k&&!U?-1:!k&&U?1:T.localeCompare(A)}):Array.from(R).sort()},q=R=>{e(R),x(!1)},z=R=>{e(R.target.value),x(!0)},B=()=>{w(!0),x(!0)},L=()=>{w(!1),setTimeout(()=>x(!1),150)},G=D(),H=l.length>0;return o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"text",value:s||"",onChange:z,onFocus:B,onBlur:L,placeholder:n,className:`claude-input w-full ${t}`}),p&&(b||s)&&o.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:h?o.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading subjects..."}):o.jsxs(o.Fragment,{children:[H&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-purple-400",children:"📚 Your Subjects"})}),l.filter(R=>!s||R.toLowerCase().includes(s.toLowerCase())).slice(0,5).map(R=>o.jsx("button",{onClick:()=>q(R),className:"w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-purple-400",children:"📖"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:R}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"From your cards"})]})]})},`existing-${R}`))]}),o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-blue-400",children:"🌟 Popular Subjects"})}),G.filter(R=>!l.includes(R)).slice(0,8).map(R=>o.jsx("button",{onClick:()=>q(R),className:"w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 last:border-b-0",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-blue-400",children:"📚"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:R}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Popular choice"})]})]})},`popular-${R}`)),G.length===0&&s&&o.jsxs("div",{className:"p-4 text-center",children:[o.jsx("div",{className:"claude-text-muted mb-2",children:"No matching subjects found"}),o.jsxs("button",{onClick:()=>q(s),className:"px-4 py-2 rounded text-sm",style:{backgroundColor:"var(--claude-accent)",color:"white"},children:['Create "',s,'"']})]}),s&&!G.some(R=>R.toLowerCase()===s.toLowerCase())&&o.jsx("button",{onClick:()=>q(s),className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-green-500/10 transition-colors",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-green-400",children:"✨"}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:['Create "',s,'"']}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"New custom subject"})]})]})})]})}),!b&&!s&&H&&o.jsxs("div",{className:"mt-3",children:[o.jsx("div",{className:"text-sm claude-text-secondary mb-2",children:"Recent subjects:"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:l.slice(0,6).map(R=>o.jsx("button",{onClick:()=>q(R),className:"px-3 py-1 rounded-full text-sm font-medium transition-all duration-200",style:{backgroundColor:"#e2e8f0",color:"#4a5568"},onMouseEnter:C=>{C.target.style.backgroundColor="var(--claude-accent)",C.target.style.color="white"},onMouseLeave:C=>{C.target.style.backgroundColor="#e2e8f0",C.target.style.color="#4a5568"},children:R},R))})]})]})},e3=({value:s,onChange:e,className:t="",placeholder:n="Select a deck for this card",rememberSelection:i=!0})=>{const{user:l}=Sn(),[u,h]=P.useState([]),[m,p]=P.useState(!0),[x,b]=P.useState(!1),[w,N]=P.useState(null);P.useEffect(()=>{V(),D()},[l]);const V=async()=>{if(!l?.uid){p(!1);return}try{p(!0);const G=await Ln.getUserDecks(l.uid,!0);h(G)}catch(G){console.error("Error loading user decks:",G),h([])}finally{p(!1)}},D=()=>{if(!i||!l?.uid)return;const G=localStorage.getItem(`selectedDeck_${l.uid}`);if(G&&!s){const H=u.find(R=>R.id===G);H&&(N(H),e(G))}};P.useEffect(()=>{if(u.length>0&&!s&&i&&l?.uid){const G=localStorage.getItem(`selectedDeck_${l.uid}`);if(G){const H=u.find(R=>R.id===G);H&&(N(H),e(G))}}},[u,s,i,l?.uid,e]),P.useEffect(()=>{if(s&&u.length>0){const G=u.find(H=>H.id===s);N(G||null)}else N(null)},[s,u]);const q=G=>{N(G),e(G.id),b(!1),i&&l?.uid&&localStorage.setItem(`selectedDeck_${l.uid}`,G.id)},z=()=>{N(null),e(""),i&&l?.uid&&localStorage.removeItem(`selectedDeck_${l.uid}`)},B=u.find(G=>G.isDefault),L=u.filter(G=>!G.isDefault);return o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:`relative ${t}`,onClick:()=>b(!x),children:o.jsxs("div",{className:"claude-input w-full cursor-pointer flex items-center justify-between",style:{minHeight:"44px"},children:[w?o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:w.icon||"📚"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:w.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[w.cardCount||0," cards • ",w.subject||"General"]})]})]}):o.jsx("span",{className:"claude-text-muted",children:n}),o.jsxs("div",{className:"flex items-center gap-2",children:[w&&o.jsx("button",{onClick:G=>{G.stopPropagation(),z()},className:"transition-colors p-1",style:{color:"var(--claude-text-muted)"},onMouseEnter:G=>G.target.style.color="var(--claude-primary-text)",onMouseLeave:G=>G.target.style.color="var(--claude-text-muted)",title:"Clear selection",children:"×"}),o.jsx("span",{className:"text-gray-400",children:x?"▲":"▼"})]})]})}),x&&o.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 rounded-lg shadow-lg border",style:{backgroundColor:"var(--claude-surface)",borderColor:"var(--claude-border)",maxHeight:"300px",overflowY:"auto"},children:m?o.jsx("div",{className:"p-4 claude-text-muted text-center",children:"Loading decks..."}):u.length===0?o.jsxs("div",{className:"p-4 text-center",children:[o.jsx("div",{className:"claude-text-muted mb-3",children:"No decks found"}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Create a deck first to organize your cards"})]}):o.jsxs(o.Fragment,{children:[B&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-blue-400",children:"🏠 Default Collection"})}),o.jsx("button",{onClick:()=>q(B),className:`w-full text-left px-4 py-3 hover:bg-blue-500/10 transition-colors border-b border-gray-700/50 ${w?.id===B.id?"bg-blue-500/20":""}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:B.icon||"📚"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:B.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[B.cardCount||0," cards • All your flashcards"]})]})]})})]}),L.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-4 py-2 border-b border-gray-600",children:o.jsx("div",{className:"text-sm font-medium text-purple-400",children:"📁 Your Decks"})}),L.map(G=>o.jsx("button",{onClick:()=>q(G),className:`w-full text-left px-4 py-3 hover:bg-purple-500/10 transition-colors border-b border-gray-700/50 last:border-b-0 ${w?.id===G.id?"bg-purple-500/20":""}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:G.icon||"📚"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:G.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[G.cardCount||0," cards • ",G.subject||"General"]})]})]})},G.id))]}),o.jsx("button",{onClick:()=>{z(),b(!1)},className:"w-full text-left px-4 py-3 border-t border-gray-600 hover:bg-gray-500/10 transition-colors",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-gray-400",children:"○"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-gray-300 font-medium",children:"No specific deck"}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Just use default collection"})]})]})})]})}),i&&w&&o.jsxs("div",{className:"mt-2 text-xs claude-text-secondary flex items-center gap-1",children:[o.jsx("span",{children:"💾"}),o.jsx("span",{children:"This deck will be remembered for future cards"})]}),x&&o.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>b(!1)})]})},t3=({onCardCreated:s,onClose:e})=>{const{user:t}=Sn(),[n,i]=P.useState({statement:"",hints:"",proof:"",tags:"",subject:"",isPublic:!0,deckId:""}),[l,u]=P.useState(!1),[h,m]=P.useState(""),[p,x]=P.useState(!1),[b,w]=P.useState({autoFill:!1,autoTag:!1,convertLatex:!1});P.useEffect(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},[n]),P.useEffect(()=>{if(!t?.uid)return;const B=localStorage.getItem(`flashcard_draft_${t.uid}`);if(B)try{const L=JSON.parse(B);Date.now()-(L.timestamp||0)<1440*60*1e3?i(H=>({...H,...L.data})):localStorage.removeItem(`flashcard_draft_${t.uid}`)}catch(L){console.warn("Failed to restore draft:",L),localStorage.removeItem(`flashcard_draft_${t.uid}`)}},[t?.uid]),P.useEffect(()=>{if(!t?.uid||!(n.statement.trim()||n.hints.trim()||n.proof.trim()))return;const L=setTimeout(()=>{const G={data:n,timestamp:Date.now()};localStorage.setItem(`flashcard_draft_${t.uid}`,JSON.stringify(G))},2e3);return()=>clearTimeout(L)},[n,t?.uid]);const N=(B,L)=>{i(G=>({...G,[B]:L})),m("")},V=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}w(B=>({...B,autoFill:!0})),m("");try{const B=await Vf.autoFillFromStatement(n.statement);i(L=>({...L,hints:B.hints||L.hints,proof:B.proof||L.proof,tags:B.tags?B.tags.join(", "):L.tags})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(B){console.error("AI autofill error:",B),m(`AI autofill failed: ${B.message}`)}finally{w(B=>({...B,autoFill:!1}))}},D=async()=>{if(!n.statement.trim()){m("Please enter a statement first");return}w(B=>({...B,autoTag:!0})),m("");try{const B=await Vf.autoTagOnly(n.statement);i(L=>({...L,tags:B.join(", ")}))}catch(B){console.error("AI auto-tag error:",B),m(`AI auto-tag failed: ${B.message}`)}finally{w(B=>({...B,autoTag:!1}))}},q=async B=>{const L=n[B];if(!L.trim()){m(`Please enter some ${B} content first`);return}w(G=>({...G,convertLatex:!0})),m("");try{const G=await Vf.convertToLaTeX(L);i(H=>({...H,[B]:G})),setTimeout(()=>{window.MathJax&&window.MathJax.typesetPromise&&window.MathJax.typesetPromise()},100)}catch(G){console.error("LaTeX conversion error:",G),m(`LaTeX conversion failed: ${G.message}`)}finally{w(G=>({...G,convertLatex:!1}))}},z=async B=>{if(B.preventDefault(),!t){m("Please sign in to create flashcards");return}const L=ys.checkRateLimit(`flashcard_create_${t.uid}`,5,3e5);if(!L.allowed){m(L.message);return}const G=ys.validateFlashcardInput(n);if(!G.isValid){m(G.errors[0]);return}const H=ys.detectSuspiciousContent(`${n.statement} ${n.hints} ${n.proof}`);if(H.isSuspicious){m("Content contains potentially unsafe elements. Please review and try again."),console.warn("Suspicious content detected:",H.findings);return}u(!0),m("");try{const R={...G.sanitizedData,createdAt:new Date};await Un.createFlashcard(R,t.uid,n.deckId||null),localStorage.removeItem(`flashcard_draft_${t.uid}`),x(!0),setTimeout(()=>{s&&s(),e&&e()},1500)}catch(R){console.error("Error creating flashcard:",R);const C=ys.getPublicErrorMessage(R,!0);m(C)}finally{u(!1)}};return p?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-4",children:"✅"}),o.jsx("h3",{className:"text-2xl font-bold claude-success mb-4",children:"Flashcard Created!"}),o.jsx("p",{className:"claude-text-secondary",children:"Your flashcard has been saved successfully."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"✏️ Create Flashcard"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Build a three-sided flashcard with statement, hints, and proof"}),t&&(n.statement.trim()||n.hints.trim()||n.proof.trim())&&o.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),o.jsx("span",{children:"Auto-saving draft..."})]})]}),o.jsxs("form",{onSubmit:z,className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-10 h-10 claude-gradient rounded-xl flex items-center justify-center text-white font-bold",children:"1"}),o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Statement"}),o.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),o.jsx("textarea",{value:n.statement,onChange:B=>N("statement",B.target.value),placeholder:`Enter the problem statement, theorem, or question here...

Example: Prove that the derivative of sin(x) is cos(x)`,className:"claude-input w-full h-32 resize-none",required:!0}),n.statement.trim()&&o.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[o.jsxs("button",{type:"button",onClick:V,disabled:b.autoFill,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:b.autoFill?"var(--claude-muted)":"linear-gradient(135deg, #635BFF 0%, #7C3AED 100%)"},children:[b.autoFill?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:"🤖"}),o.jsx("span",{children:b.autoFill?"Generating...":"Autofill Hints, Proof & Tags"})]}),o.jsxs("button",{type:"button",onClick:D,disabled:b.autoTag,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",style:{background:b.autoTag?"var(--claude-muted)":"linear-gradient(135deg, #10B981 0%, #059669 100%)"},children:[b.autoTag?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:"🏷️"}),o.jsx("span",{children:b.autoTag?"Generating...":"Auto Tag Only"})]})]}),n.statement&&o.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[o.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),o.jsx("div",{style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.statement}})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, #9333ea 0%, #a855f7 100%)"},children:"2"}),o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Hints"}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Optional"})]}),o.jsx("textarea",{value:n.hints,onChange:B=>N("hints",B.target.value),placeholder:`Provide helpful hints or guidance...

Example: Start by using the definition of derivative as a limit. Consider the addition formula for sine.`,className:"claude-input w-full h-24 resize-none"}),n.hints.trim()&&o.jsx("div",{className:"mt-3",children:o.jsxs("button",{type:"button",onClick:()=>q("hints"),disabled:b.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:b.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[b.convertLatex?o.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:"📐"}),o.jsx("span",{children:b.convertLatex?"Converting...":"Convert to LaTeX"})]})})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold",style:{background:"linear-gradient(135deg, var(--claude-success) 0%, #10b981 100%)"},children:"3"}),o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"Proof / Answer"}),o.jsx("span",{className:"claude-error text-sm",children:"*Required"})]}),o.jsx("textarea",{value:n.proof,onChange:B=>N("proof",B.target.value),placeholder:`Provide the complete proof, solution, or detailed answer...

Example: Using the definition of derivative:
f'(x) = lim(h→0) [sin(x+h) - sin(x)]/h
= lim(h→0) [sin(x)cos(h) + cos(x)sin(h) - sin(x)]/h
...`,className:"claude-input w-full h-40 resize-none",required:!0}),n.proof.trim()&&o.jsx("div",{className:"mt-3",children:o.jsxs("button",{type:"button",onClick:()=>q("proof"),disabled:b.convertLatex,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white font-medium text-sm shadow hover:shadow-lg transform hover:scale-105 transition-all duration-200",style:{background:b.convertLatex?"var(--claude-muted)":"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:[b.convertLatex?o.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx("span",{children:"📐"}),o.jsx("span",{children:b.convertLatex?"Converting...":"Convert to LaTeX"})]})}),n.proof&&o.jsxs("div",{className:"mt-4 p-4",style:{backgroundColor:"var(--claude-subtle)",border:"1px solid var(--claude-border)",borderRadius:"12px"},children:[o.jsx("div",{className:"text-sm claude-text-muted mb-2",children:"Preview:"}),o.jsx("div",{className:"whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:n.proof}})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Card Details"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),o.jsx(ZV,{value:n.subject,onChange:B=>N("subject",B),placeholder:"Select or type a subject (e.g. Calculus, Physics)"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),o.jsx(JV,{value:n.tags,onChange:B=>N("tags",B),placeholder:"Type tags here or click existing tags below"})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck ",o.jsx("span",{className:"text-sm claude-text-muted",children:"(optional)"})]}),o.jsx(e3,{value:n.deckId,onChange:B=>N("deckId",B),placeholder:"Choose a deck to organize this card",rememberSelection:!0})]})]}),o.jsx("div",{className:"mt-6",children:o.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:n.isPublic,onChange:B=>N("isPublic",B.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--claude-accent)",backgroundColor:n.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),o.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this flashcard public (others can discover and study it)"})]})})]}),h&&o.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:o.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[o.jsx("span",{children:"❌"}),o.jsx("span",{children:h})]})}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&o.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{type:"submit",disabled:l||!n.statement.trim()||!n.proof.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:l||!n.statement.trim()||!n.proof.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:l?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"✨"}),"Create Flashcard"]})})]})]}),o.jsxs("div",{className:"mt-8 p-6 rounded-2xl",style:{backgroundColor:"rgba(68, 90, 255, 0.1)",border:"1px solid var(--claude-accent-blue)"},children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:"var(--claude-accent-blue)"},children:"💡 LaTeX Math Support"}),o.jsxs("div",{className:"claude-text-secondary text-sm space-y-2",children:[o.jsx("p",{children:"Use LaTeX for mathematical expressions:"}),o.jsxs("div",{className:"claude-card p-3 font-mono text-xs",children:[o.jsxs("div",{children:["Inline: ",o.jsx("code",{children:"$f(x) = x^2 + 2x + 1$"})]}),o.jsxs("div",{children:["Block: ",o.jsxs("code",{children:["$$\\int_0^1 x^2 dx = \\frac",1,3,"$$"]})]})]})]})]})]})})};class rd{static isPermissionOrIndexError(e){const t=e.message||"";return t.includes("Missing or insufficient permissions")||t.includes("requires an index")||t.includes("permission-denied")}static async startStudySession(e,t={}){try{const n={userId:e,sessionId:this.generateSessionId(),startTime:ke(),mode:t.mode||"study",deckId:t.deckId||null,deckName:t.deckName||null,cardsStudied:0,cardsCorrect:0,cardsIncorrect:0,cardResults:[],isActive:!0},i=await Jn(Ne(te,"studySessions"),n);if(dn)try{xr(dn,"study_session_start",{mode:t.mode,deck_id:t.deckId,user_id:e})}catch(l){console.warn("Firebase Analytics not available:",l)}return{id:i.id,...n}}catch(n){throw console.error("Error starting study session:",n),n}}static async endStudySession(e,t){try{const n=xe(te,"studySessions",e),i=await At(n);if(!i.exists())throw new Error("Session not found");const l=i.data(),u=l.startTime.toMillis(),h=Date.now(),m=Math.round((h-u)/1e3),p=l.cardsStudied>0?l.cardsCorrect/l.cardsStudied:0,x=l.cardsStudied>0?m/l.cardsStudied:0;if(await Mt(n,{endTime:ke(),duration:m,accuracy:p,averageTimePerCard:x,isActive:!1}),await this.updateUserAnalytics(t,{sessionDuration:m,cardsStudied:l.cardsStudied,accuracy:p,deckId:l.deckId}),await this.updateDailyStats(t,{studyTime:m,sessionsCount:1,cardsStudied:l.cardsStudied,accuracy:p}),dn)try{xr(dn,"study_session_end",{duration:m,cards_studied:l.cardsStudied,accuracy:p,user_id:t})}catch(b){console.warn("Firebase Analytics not available:",b)}return{duration:m,cardsStudied:l.cardsStudied,accuracy:p,averageTimePerCard:x}}catch(n){if(this.isPermissionOrIndexError(n))return{duration:0,cardsStudied:0,accuracy:0,averageTimePerCard:0};throw console.error("Error ending study session:",n),n}}static async recordCardAnswer(e,t){try{const n=xe(te,"studySessions",e),i=await At(n);if(!i.exists())throw new Error("Session not found");const l=xo(te),u={cardId:t.cardId,timeSpent:t.timeSpent,wasCorrect:t.wasCorrect,attempts:t.attempts||1,difficulty:t.difficulty||"medium",confidenceLevel:t.confidenceLevel||3,timestamp:ke()};if(l.update(n,{cardsStudied:mc(u),[`cards${t.wasCorrect?"Correct":"Incorrect"}`]:(i.data()[`cards${t.wasCorrect?"Correct":"Incorrect"}`]||0)+1}),await this.updateCardProgress(t.userId,t.cardId,{wasCorrect:t.wasCorrect,timeSpent:t.timeSpent,confidenceLevel:t.confidenceLevel}),await l.commit(),dn)try{xr(dn,"card_answered",{card_id:t.cardId,was_correct:t.wasCorrect,time_spent:t.timeSpent,user_id:t.userId})}catch(h){console.warn("Firebase Analytics not available:",h)}return!0}catch(n){throw console.error("Error recording card answer:",n),n}}static async updateCardProgress(e,t,n){try{const i=xe(te,"learningProgress",e,"cards",t),l=await At(i);let u;l.exists()?u=l.data():u={cardId:t,userId:e,totalReviews:0,correctReviews:0,accuracy:0,averageTimeToAnswer:0,fastestTime:1/0,slowestTime:0,masteryLevel:0,improvementRate:0,createdAt:ke()},u.totalReviews+=1,n.wasCorrect&&(u.correctReviews+=1),u.accuracy=u.correctReviews/u.totalReviews;const h=n.timeSpent;u.averageTimeToAnswer=(u.averageTimeToAnswer*(u.totalReviews-1)+h)/u.totalReviews,u.fastestTime=Math.min(u.fastestTime,h),u.slowestTime=Math.max(u.slowestTime,h);const m=u.accuracy,p=1-(u.slowestTime-u.fastestTime)/u.slowestTime,x=(n.confidenceLevel||3)/5;return u.masteryLevel=m*.5+p*.3+x*.2,u.lastMasteryUpdate=ke(),await Er(i,u,{merge:!0}),u}catch(i){throw console.error("Error updating card progress:",i),i}}static async getCardProgress(e,t=null){try{const n=Ne(te,"learningProgress",e,"cards");let i=n;t&&t.length>0&&(i=Pe(n,qe("cardId","in",t)));const l=await Fe(i),u={};return l.docs.forEach(h=>{const m=h.data();u[m.cardId]=m}),u}catch(n){if(this.isPermissionOrIndexError(n))return{};throw console.error("Error getting card progress:",n),n}}static async updateUserAnalytics(e,t){try{const n=xe(te,"userAnalytics",e),i=await At(n);let l;if(i.exists()?l=i.data():l={userId:e,totalStudyTime:0,totalSessions:0,studyStreak:0,longestStreak:0,overallAccuracy:0,improvementRate:0,subjectStats:{},deckStats:{},createdAt:ke()},l.totalStudyTime+=t.sessionDuration,l.totalSessions+=1,l.overallAccuracy=(l.overallAccuracy*(l.totalSessions-1)+t.accuracy)/l.totalSessions,t.deckId){l.deckStats[t.deckId]||(l.deckStats[t.deckId]={studyTime:0,sessions:0,accuracy:0});const u=l.deckStats[t.deckId];u.studyTime+=t.sessionDuration,u.sessions+=1,u.accuracy=(u.accuracy*(u.sessions-1)+t.accuracy)/u.sessions}return l.lastUpdated=ke(),await Er(n,l,{merge:!0}),l}catch(n){throw console.error("Error updating user analytics:",n),n}}static async updateDailyStats(e,t){try{const n=new Date().toISOString().split("T")[0],i=xe(te,"dailyStats",e,"days",n),l=await At(i);let u;return l.exists()?u=l.data():u={date:n,userId:e,studyTime:0,sessionsCount:0,cardsStudied:0,accuracy:0,decksStudied:[],subjectsStudied:[]},u.studyTime+=t.studyTime,u.sessionsCount+=t.sessionsCount,u.cardsStudied+=t.cardsStudied,u.sessionsCount>0&&(u.accuracy=(u.accuracy*(u.sessionsCount-1)+t.accuracy)/u.sessionsCount),await Er(i,u,{merge:!0}),u}catch(n){throw console.error("Error updating daily stats:",n),n}}static async getUserInsights(e,t="week"){try{const[n,i,l]=await Promise.all([this.getUserAnalytics(e),this.getRecentSessions(e,t),this.getCardProgress(e)]);return{accuracyTrend:this.calculateTrend(i,"accuracy"),studyTimeTrend:this.calculateTrend(i,"duration"),masteryProgress:this.calculateMasteryProgress(l),strugglingCards:this.identifyStrugglingCards(l),strongSubjects:this.identifyStrongSubjects(n.subjectStats),optimalStudyTime:this.identifyOptimalStudyTime(i),consistencyScore:this.calculateConsistencyScore(i),recommendations:this.generateRecommendations(n,l)}}catch(n){if(this.isPermissionOrIndexError(n))return{studyStreaks:{current:0,longest:0},totalStudyTime:0,averageAccuracy:0,cardsStudied:0,sessionsCompleted:0,improvementTrend:"stable",weeklyProgress:[],strongSubjects:[],weakSubjects:[]};throw console.error("Error getting user insights:",n),n}}static async getRecentSessions(e,t="week"){try{const n=t==="week"?7:t==="month"?30:1,i=new Date(Date.now()-n*24*60*60*1e3),l=Pe(Ne(te,"studySessions"),qe("userId","==",e),qe("startTime",">=",i),qe("isActive","==",!1),Gt("startTime","desc"),Ht(100));return(await Fe(l)).docs.map(h=>({id:h.id,...h.data()}))}catch(n){return this.isPermissionOrIndexError(n)?[]:(console.error("Error getting recent sessions:",n),[])}}static async getUserAnalytics(e){try{const t=xe(te,"userAnalytics",e),n=await At(t);return n.exists()?n.data():{totalStudyTime:0,totalSessions:0,overallAccuracy:0,studyStreak:0,subjectStats:{},deckStats:{}}}catch(t){throw console.error("Error getting user analytics:",t),t}}static generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static calculateTrend(e,t){if(e.length<2)return 0;const n=e.slice(0,Math.floor(e.length/2)),i=e.slice(Math.floor(e.length/2)),l=n.reduce((h,m)=>h+(m[t]||0),0)/n.length,u=i.reduce((h,m)=>h+(m[t]||0),0)/i.length;return u>0?(l-u)/u:0}static calculateMasteryProgress(e){const t=Object.values(e);return t.length===0?0:t.reduce((n,i)=>n+(i.masteryLevel||0),0)/t.length}static identifyStrugglingCards(e){return Object.values(e).filter(t=>t.accuracy<.6&&t.totalReviews>=3).sort((t,n)=>t.accuracy-n.accuracy).slice(0,5)}static identifyStrongSubjects(e){return Object.entries(e).filter(([t,n])=>n.accuracy>.8).sort(([t,n],[i,l])=>l.accuracy-n.accuracy).slice(0,3).map(([t,n])=>t)}static identifyOptimalStudyTime(e){const t={morning:[],afternoon:[],evening:[]};e.forEach(l=>{const u=new Date(l.startTime.toMillis()).getHours();let h="afternoon";u<12?h="morning":u>18&&(h="evening"),t[h].push(l.accuracy||0)});let n="afternoon",i=0;return Object.entries(t).forEach(([l,u])=>{if(u.length>0){const h=u.reduce((m,p)=>m+p)/u.length;h>i&&(i=h,n=l)}}),n}static calculateConsistencyScore(e){if(e.length<3)return 0;const t=e.map(u=>u.duration||0),n=t.reduce((u,h)=>u+h)/t.length,i=t.reduce((u,h)=>u+Math.pow(h-n,2),0)/t.length,l=Math.sqrt(i);return Math.max(0,1-l/n)}static generateRecommendations(e,t){const n=[];e.totalStudyTime<3600&&n.push({type:"study_time",title:"Increase Study Time",description:"Try to study for at least 20 minutes per day to see better results.",priority:"high"}),e.overallAccuracy<.7&&n.push({type:"accuracy",title:"Focus on Understanding",description:"Review the hints and explanations more carefully before answering.",priority:"high"});const i=this.identifyStrugglingCards(t);return i.length>0&&n.push({type:"struggling_cards",title:"Review Difficult Cards",description:`You have ${i.length} cards that need extra attention.`,priority:"medium"}),n}}const Ud=(s=[],e)=>{P.useEffect(()=>{let t=!1;const n=()=>{if(!window.MathJax?.typesetPromise)return;const i=typeof e=="string"?document.querySelector(e):e||document.body;window.MathJax.typesetClear&&window.MathJax.typesetClear([i]),window.MathJax.typesetPromise([i]).catch(l=>{t||console.error("MathJax typeset error:",l)})};if(window.MathJax&&window.MathJax.typesetPromise)n();else if(window.MathJaxReady)n();else{const i=()=>{t||(window.MathJax?.typesetPromise||window.MathJaxReady?n():requestAnimationFrame(i))},l=()=>!t&&n();return document.addEventListener("mathjax:ready",l),i(),()=>{t=!0,document.removeEventListener("mathjax:ready",l)}}return()=>{t=!0}},s)},n3=()=>{const{user:s}=Sn(),[e,t]=P.useState([]),[n,i]=P.useState(0),[l,u]=P.useState(0),[h,m]=P.useState(!0),[p,x]=P.useState(""),[b,w]=P.useState(null),[N,V]=P.useState(null),[D,q]=P.useState(!1),[z,B]=P.useState({}),L=P.useRef(null),G=P.useRef(!1),H=P.useRef(null),R=e[n],C=P.useMemo(()=>{const j=R?.statement??R?.question??"No statement available",oe=Array.isArray(R?.hints)?R.hints.join(`
`):R?.hints??R?.hint??"No hint available",ge=R?.proof??R?.answer??"No proof available";return[j,oe,ge]},[R?.statement,R?.question,R?.hints,R?.hint,R?.proof,R?.answer]),T=["Statement","Hint","Proof"];Ud([n,l],H?.current),P.useEffect(()=>{$()},[s]),P.useEffect(()=>{s&&e.length>0&&!b&&A()},[s,e.length,b]),P.useEffect(()=>{R&&V(Date.now())},[n]),P.useEffect(()=>()=>{b&&k()},[b]);const A=async()=>{try{const j=await rd.startStudySession(s.uid,{mode:"study",deckId:null,deckName:"All Cards"});w(j),console.log("Study session started:",j.sessionId)}catch(j){console.error("Failed to start study session:",j)}},k=async()=>{if(b)try{const j=await rd.endStudySession(b.sessionId,s.uid);console.log("Study session ended:",j),w(null)}catch(j){console.warn("Analytics not available for session end:",j),w(null)}},U=async(j,oe=3)=>{if(!b||!R||!N)return;const ge=Math.round((Date.now()-N)/1e3);try{await rd.recordCardAnswer(b.sessionId,{cardId:R.id,userId:s.uid,timeSpent:ge,wasCorrect:j,attempts:1,difficulty:"medium",confidenceLevel:oe}),B(me=>({...me,[R.id]:j})),setTimeout(()=>{M()},1e3)}catch(me){console.warn("Analytics not available, but rating recorded locally:",me),B(Ae=>({...Ae,[R.id]:j})),setTimeout(()=>{M()},1e3)}},$=P.useCallback(async()=>{try{m(!0),x("");let j=[];if(s)try{const oe=await Un.getUserFlashcards(s.uid,50),{collection:ge,query:me,where:Ae,orderBy:we,limit:Ee,getDocs:le}=await Yt(async()=>{const{collection:He,query:ut,where:$e,orderBy:Qe,limit:vt,getDocs:St}=await Promise.resolve().then(()=>Ms);return{collection:He,query:ut,where:$e,orderBy:Qe,limit:vt,getDocs:St}},void 0),{db:ye}=await Yt(async()=>{const{db:He}=await Promise.resolve().then(()=>oa);return{db:He}},void 0),Te=me(ge(ye,"flashcards"),Ae("userId","==",s.uid),we("createdAt","desc"),Ee(50)),nt=(await le(Te)).docs.map(He=>({id:He.id,...He.data()}));j=[...oe,...nt].sort((He,ut)=>{const $e=He.createdAt?.toMillis?.()||He.createdAt?.getTime?.()||0;return(ut.createdAt?.toMillis?.()||ut.createdAt?.getTime?.()||0)-$e})}catch(oe){console.warn("Failed to load user cards, falling back to public:",oe)}j.length||(j=await Un.getPublicFlashcards(50)),Array.isArray(j)&&j.length>0?(t(j),i(0),u(0)):(t([]),i(0),u(0))}catch(j){x("Failed to load flashcards"),console.error("Error loading flashcards:",j),t([])}finally{m(!1)}},[s]),M=P.useCallback(()=>{e.length>0&&(i(j=>Math.min(j+1,e.length-1)),u(0))},[e.length]),ze=P.useCallback(()=>{e.length>0&&(i(j=>Math.max(j-1,0)),u(0))},[e.length]),se=P.useCallback(()=>{u(j=>(j+1)%3)},[]),F=P.useCallback(j=>{j.key==="ArrowRight"?M():j.key==="ArrowLeft"?ze():(j.key===" "||j.code==="Space")&&(j.preventDefault(),se())},[M,ze,se]),ie=j=>{L.current=j.touches[0].clientX,G.current=!1},K=j=>{G.current=!0},pe=j=>{if(!L.current)return;const oe=L.current-j.changedTouches[0].clientX;if(L.current=null,Math.abs(oe)>50)return oe>0?M():ze();G.current||se()};return P.useEffect(()=>(window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)),[F]),h?o.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[o.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-6"}),o.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"📚 Loading Flashcards..."}),o.jsx("p",{className:"text-slate-300",children:"Please wait while we load your study materials."})]})}):p?o.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:o.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-3xl p-12 text-center max-w-lg",children:[o.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-4",children:"❌ Error Loading Flashcards"}),o.jsx("p",{className:"text-red-300 mb-6",children:p}),o.jsx("button",{onClick:$,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-xl transition-all duration-200",children:"Try Again"})]})}):e.length===0?o.jsx("div",{className:"bg-slate-900 min-h-screen pt-20 flex items-center justify-center",children:o.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-3xl p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-6",children:"📚"}),o.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"No Flashcards Available"}),o.jsx("p",{className:"text-slate-300",children:"Create your first flashcard to start studying!"})]})}):R?o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},role:"main",children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-8",children:[o.jsx("h2",{className:"text-4xl font-extrabold",style:{color:"var(--claude-heading)"},children:"📚 Study Mode"}),o.jsx("div",{className:"claude-card px-4 py-2",children:o.jsxs("span",{className:"claude-text-secondary font-medium",children:[n+1," of ",e.length]})})]}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"flex justify-center mb-6",children:o.jsx("div",{className:"flex claude-card p-2",children:T.map((j,oe)=>o.jsx("button",{onClick:()=>u(oe),className:`px-6 py-2 rounded-xl font-medium transition-colors duration-200 ${l===oe?"bg-[var(--claude-accent)] text-white":"text-[var(--claude-secondary-text)] hover:bg-[var(--claude-surface-hover)] hover:text-[var(--claude-primary-text)]"}`,"aria-pressed":l===oe,"aria-label":`Show ${j} (${oe+1} of ${T.length})`,children:j},oe))})}),o.jsxs("div",{onClick:se,onTouchStart:ie,onTouchMove:K,onTouchEnd:pe,onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),se())},className:"claude-card p-12 min-h-[400px] flex flex-col justify-center items-center cursor-pointer transition-all duration-300 group hover:-translate-y-0.5 hover:border-[var(--claude-accent)] focus:outline-none focus:ring-2 focus:ring-[var(--claude-accent)] focus:ring-opacity-50",style:{borderRadius:"24px"},tabIndex:0,role:"button","aria-label":`Show ${T[l]} content. Press Space or Enter to continue.`,children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-sm font-medium mb-4 uppercase tracking-wider",style:{color:"var(--claude-accent)"},children:T[l]}),o.jsx("div",{ref:H,className:"text-xl leading-relaxed transition-colors whitespace-pre-wrap",style:{color:"var(--claude-primary-text)"},children:C[l]})]}),o.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 claude-text-muted text-sm",children:l<2?"Tap to see next side":"Tap to restart"})]}),o.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[R.subject&&o.jsx("span",{className:"claude-tag",children:R.subject}),R.slug?o.jsxs("a",{href:`/card/${R.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-primary inline-flex items-center gap-2 text-sm",children:[o.jsx("span",{children:"🔗"}),"View Public Card"]}):o.jsxs("div",{className:"claude-button-secondary inline-flex items-center gap-2 text-sm opacity-50 cursor-not-allowed",children:[o.jsx("span",{children:"🔒"}),"Private Card"]})]}),l===2&&b&&o.jsxs("div",{className:"mt-6 claude-card p-4 bg-blue-50 border-blue-200",children:[o.jsxs("div",{className:"text-center mb-4",children:[o.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"How well did you know this?"}),o.jsx("p",{className:"text-sm text-blue-600",children:"This helps track your learning progress"})]}),o.jsxs("div",{className:"flex justify-center gap-2",children:[o.jsx("button",{onClick:()=>U(!1,1),className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg transition-colors text-sm font-medium",children:"😰 Struggled"}),o.jsx("button",{onClick:()=>U(!1,2),className:"px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 rounded-lg transition-colors text-sm font-medium",children:"🤔 Unsure"}),o.jsx("button",{onClick:()=>U(!0,4),className:"px-4 py-2 bg-green-100 hover:bg-green-200 text-green-800 rounded-lg transition-colors text-sm font-medium",children:"😊 Good"}),o.jsx("button",{onClick:()=>U(!0,5),className:"px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition-colors text-sm font-medium",children:"🚀 Perfect"})]}),z[R.id]!==void 0&&o.jsx("div",{className:"mt-3 text-center",children:o.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${z[R.id]?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z[R.id]?"✅ Recorded as correct":"❌ Recorded as incorrect"})})]})]}),o.jsxs("div",{className:"flex justify-between items-center mt-8",children:[o.jsx("button",{onClick:ze,disabled:n===0,className:"claude-button-secondary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"← Previous"}),o.jsx("div",{className:"claude-text-muted text-sm",children:"Use arrow keys or swipe to navigate • Space to flip sides"}),o.jsx("button",{onClick:M,disabled:n===e.length-1,className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:n===e.length-1?"var(--claude-muted)":"var(--claude-accent)"},children:"Next →"})]}),o.jsx("span",{className:"sr-only","aria-live":"polite",children:T[l]})]})}):o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-6",children:"⚠️"}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Card Not Found"}),o.jsx("p",{className:"claude-text-secondary",children:"Unable to load the requested flashcard."}),o.jsx("button",{onClick:$,className:"claude-button-primary mt-6",children:"Reload Cards"})]})})},s3=()=>{const{user:s}=Sn(),[e,t]=P.useState(""),[n,i]=P.useState(""),[l,u]=P.useState(!0),[h,m]=P.useState([]),[p,x]=P.useState("recent"),[b,w]=P.useState(""),[N,V]=P.useState(new Set),[D,q]=P.useState(1),[z,B]=P.useState(new Set),[L,G]=P.useState(new Set),[H,R]=P.useState(new Set),[C,T]=P.useState(new Set),[A,k]=P.useState(""),U=12;P.useEffect(()=>{const le=setTimeout(()=>i(e),200);return()=>clearTimeout(le)},[e]);const $=P.useCallback(le=>le?.toMillis?le.toMillis():le||0,[]),M=P.useCallback(le=>{if(!le)return"Unknown date";const ye=le.toDate?le.toDate():new Date(le);return Number.isNaN(ye.getTime())?"Unknown date":ye.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},[]),ze=P.useCallback(async()=>{const le=await Yt(()=>Promise.resolve().then(()=>Ms),void 0),{db:ye}=await Yt(async()=>{const{db:Te}=await Promise.resolve().then(()=>oa);return{db:Te}},void 0);return{db:ye,firestore:le}},[]),se=P.useMemo(()=>{const le=n.trim().toLowerCase(),ye=h.filter(Te=>{const Oe=Array.isArray(Te.hints)?Te.hints.join(" "):typeof Te.hints=="string"?Te.hints:"",nt=!le||(Te.statement||"").toLowerCase().includes(le)||Oe.toLowerCase().includes(le)||(Te.proof||"").toLowerCase().includes(le)||(Te.authorSlug||"").toLowerCase().includes(le)||(Te.tags||[]).some(ut=>(ut||"").toLowerCase().includes(le)),He=!b||(Te.tags||[]).includes(b);return nt&&He});switch(p){case"upvotes":ye.sort((Te,Oe)=>(Oe.likeCount||0)-(Te.likeCount||0));break;case"oldest":ye.sort((Te,Oe)=>$(Te.createdAt)-$(Oe.createdAt));break;case"alphabetical":ye.sort((Te,Oe)=>(Te.statement||"").localeCompare(Oe.statement||""));break;default:ye.sort((Te,Oe)=>$(Oe.createdAt)-$(Te.createdAt))}return ye},[h,n,p,b]);Ud([se,D]),P.useEffect(()=>{ie(),s&&F()},[s]);const F=async()=>{if(s)try{const{collection:le,query:ye,where:Te,getDocs:Oe}=await Yt(async()=>{const{collection:vt,query:St,where:Lt,getDocs:ws}=await Promise.resolve().then(()=>Ms);return{collection:vt,query:St,where:Lt,getDocs:ws}},void 0),{db:nt}=await Yt(async()=>{const{db:vt}=await Promise.resolve().then(()=>oa);return{db:vt}},void 0),He=await Oe(ye(le(nt,"userUpvotes"),Te("userId","==",s.uid))),ut=new Set(He.docs.map(vt=>vt.data().cardId));B(ut);const $e=await Oe(ye(le(nt,"flashcards"),Te("userId","==",s.uid))),Qe=new Set;$e.docs.forEach(vt=>{Qe.add(vt.data().statement)}),G(Qe)}catch(le){console.error("Error loading user data:",le)}},ie=P.useCallback(async()=>{try{u(!0);const{db:le,firestore:ye}=await ze(),{collection:Te,orderBy:Oe,query:nt,getDocs:He}=ye;console.log("🔍 Loading public cards...");const ut=nt(Te(le,"publicCards"),Oe("createdAt","desc")),$e=await He(ut),Qe=new Set,vt=$e.docs.map(St=>{const Lt=St.data();return(Lt.tags||[]).forEach(ws=>Qe.add(ws)),{id:St.id,...Lt}});console.log("✅ Loaded public cards:",vt.length,vt.slice(0,3)),m(vt),V(Qe)}catch(le){console.error("❌ Error loading public cards:",le),m([]),V(new Set)}finally{u(!1)}},[ze]);P.useEffect(()=>{q(1)},[n,p,b]);const K=P.useCallback(async le=>{if(s&&!H.has(le)){R(ye=>new Set(ye).add(le));try{const{runTransaction:ye,doc:Te,serverTimestamp:Oe}=await Yt(async()=>{const{runTransaction:$e,doc:Qe,serverTimestamp:vt}=await Promise.resolve().then(()=>Ms);return{runTransaction:$e,doc:Qe,serverTimestamp:vt}},void 0),{db:nt}=await Yt(async()=>{const{db:$e}=await Promise.resolve().then(()=>oa);return{db:$e}},void 0),He=Te(nt,"userUpvotes",`${s.uid}_${le}`),ut=Te(nt,"publicCards",le);await ye(nt,async $e=>{const Qe=await $e.get(He),St=(await $e.get(ut)).data()?.likeCount||0;Qe.exists()?($e.delete(He),$e.update(ut,{likeCount:Math.max(0,St-1)})):($e.set(He,{userId:s.uid,cardId:le,createdAt:Oe()}),$e.update(ut,{likeCount:St+1}))}),B($e=>{const Qe=new Set($e);return Qe.has(le)?Qe.delete(le):Qe.add(le),Qe}),m($e=>$e.map(Qe=>Qe.id===le?{...Qe,likeCount:Math.max(0,(Qe.likeCount||0)+(z.has(le)?-1:1))}:Qe))}catch(ye){console.error("Error upvoting card:",ye),k("Error upvoting card. Please try again."),setTimeout(()=>k(""),5e3)}finally{R(ye=>{const Te=new Set(ye);return Te.delete(le),Te})}}},[s,z,H,m]),pe=P.useCallback(async le=>{if(!s||C.has(le))return;const ye=h.find(Te=>Te.id===le);if(ye){if(L.has(ye.statement)){k("Card already imported"),setTimeout(()=>k(""),3e3);return}T(Te=>new Set(Te).add(le));try{const{collection:Te,addDoc:Oe,doc:nt,updateDoc:He,increment:ut}=await Yt(async()=>{const{collection:Lt,addDoc:ws,doc:gn,updateDoc:$n,increment:Ir}=await Promise.resolve().then(()=>Ms);return{collection:Lt,addDoc:ws,doc:gn,updateDoc:$n,increment:Ir}},void 0),{serverTimestamp:$e}=await Yt(async()=>{const{serverTimestamp:Lt}=await Promise.resolve().then(()=>Ms);return{serverTimestamp:Lt}},void 0),{db:Qe}=await Yt(async()=>{const{db:Lt}=await Promise.resolve().then(()=>oa);return{db:Lt}},void 0);await Oe(Te(Qe,"flashcards"),{userId:s.uid,statement:ye.statement,hints:ye.hints,proof:ye.proof||"",tags:ye.tags||[],createdAt:$e(),updatedAt:$e(),importedFrom:le}),await He(nt(Qe,"publicCards",le),{importCount:ut(1)});const vt=new Set(L);vt.add(ye.statement),G(vt);const St=h.map(Lt=>Lt.id===le?{...Lt,importCount:(Lt.importCount||0)+1}:Lt);m(St),k("Card imported successfully!"),setTimeout(()=>k(""),3e3)}catch(Te){console.error("Error importing card:",Te),k("Error importing card. Please try again."),setTimeout(()=>k(""),5e3)}finally{T(Te=>{const Oe=new Set(Te);return Oe.delete(le),Oe})}}},[s,h,L,ze,C]),j=le=>{if(!le)return"";const ye=document.createElement("div");return ye.textContent=le,ye.innerHTML},oe=le=>{const ye=s&&z.has(le.id),Te=s&&L.has(le.statement),Oe=H.has(le.id),nt=C.has(le.id),He=M(le.createdAt),ut=le.authorSlug?le.authorSlug.charAt(0).toUpperCase():"U";return o.jsxs("div",{className:"claude-card p-6 hover:shadow-lg transition-all duration-200",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm",style:{backgroundColor:"var(--claude-accent)"},children:ut}),o.jsxs("div",{children:[le.authorSlug?o.jsx("a",{href:`/profile/${le.authorSlug}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium hover:underline",style:{color:"var(--claude-accent)"},children:le.authorSlug}):o.jsx("span",{className:"font-medium claude-text-secondary",children:"Anonymous User"}),o.jsx("div",{className:"claude-text-muted text-sm",children:He})]})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Statement"}),o.jsx("div",{className:"text-sm leading-relaxed",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:j(le.statement)}})]}),le.hints&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"font-medium mb-1 claude-text-secondary text-sm",children:"Hints"}),o.jsx("div",{className:"text-sm claude-text-secondary",dangerouslySetInnerHTML:{__html:j(le.hints)}})]}),le.proof&&o.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)",borderLeft:"4px solid var(--claude-accent)"},children:[o.jsx("div",{className:"text-xs font-semibold claude-text-secondary mb-1 uppercase tracking-wider",children:"Proof Preview"}),o.jsx("div",{className:"text-sm",style:{color:"var(--claude-primary-text)"},dangerouslySetInnerHTML:{__html:j(le.proof.substring(0,150)+(le.proof.length>150?"...":""))}})]}),o.jsxs("div",{className:"flex gap-4 mb-4 text-sm claude-text-muted",children:[o.jsxs("span",{children:["👁️ ",Math.max(0,le.viewCount||0)," views"]}),o.jsxs("span",{children:["📥 ",Math.max(0,le.importCount||0)," imports"]})]}),le.tags&&le.tags.length>0&&o.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:le.tags.map($e=>o.jsx("span",{className:"claude-tag cursor-pointer hover:opacity-80",onClick:()=>w($e),children:$e},$e))}),o.jsxs("div",{className:"flex gap-3 items-center",children:[o.jsxs("button",{onClick:()=>K(le.id),disabled:!s||Oe,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${ye?"text-white":"claude-button-secondary"} ${!s||Oe?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:ye?"var(--claude-accent)":void 0,border:ye?"none":void 0},title:s?`${ye?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards","aria-label":s?`${ye?"Remove upvote from":"Upvote"} this flashcard`:"Sign in to upvote cards",children:[Oe?"⏳":"👍"," ",Math.max(0,le.likeCount||0)]}),o.jsx("button",{onClick:()=>pe(le.id),disabled:!s||Te||nt,className:`claude-button-primary text-sm ${!s||Te||nt?"opacity-50 cursor-not-allowed":""}`,title:s?Te?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards","aria-label":s?Te?"Card already imported":"Import this flashcard to your collection":"Sign in to import cards",children:nt?"⏳ Importing...":Te?"✓ Imported":"📥 Import"}),o.jsx("a",{href:`/card/${le.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary text-sm",children:"👁️ View"})]})]},le.id)},ge=Math.ceil(se.length/U),me=(D-1)*U,Ae=me+U,we=se.slice(me,Ae),Ee=P.useCallback(le=>{le<1||le>ge||(q(le),window.scrollTo({top:0,behavior:"smooth"}))},[ge]);return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"🔍 Search Flashcards"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Discover and import flashcards from the community"})]}),A&&o.jsx("div",{className:`mb-6 p-4 rounded-lg border ${A.includes("successfully")?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{children:A}),o.jsx("button",{onClick:()=>k(""),className:"ml-2 text-lg font-bold opacity-60 hover:opacity-100",children:"×"})]})}),!s&&o.jsxs("div",{className:"text-center p-4 mb-6 rounded-2xl",style:{background:"linear-gradient(135deg, var(--claude-accent) 0%, var(--claude-accent-blue) 100%)",color:"white"},children:[o.jsx("p",{className:"mb-3",children:"Unlock the full experience!"}),o.jsx("a",{href:"/index.html",className:"inline-block px-6 py-2 rounded-lg font-semibold transition-all hover:scale-105",style:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",textDecoration:"none"},onMouseEnter:le=>le.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:le=>le.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Sign in"}),o.jsx("span",{children:" to upvote and import flashcards to your account."})]}),o.jsx("div",{className:"claude-card p-6 mb-8",children:o.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[o.jsxs("div",{className:"relative flex-1 w-full",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:o.jsx("span",{className:"claude-text-muted",children:"🔍"})}),o.jsx("input",{type:"text",value:e,onChange:le=>t(le.target.value),placeholder:"Search flashcards, tags, or authors...",className:"claude-input w-full pl-10"}),e&&o.jsx("button",{onClick:()=>t(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center claude-text-muted hover:opacity-70",children:"×"})]}),o.jsxs("div",{className:"flex gap-3 items-center",children:[o.jsxs("select",{value:p,onChange:le=>x(le.target.value),className:"claude-input",children:[o.jsx("option",{value:"recent",children:"Most Recent"}),o.jsx("option",{value:"upvotes",children:"Most Upvoted"}),o.jsx("option",{value:"oldest",children:"Oldest First"}),o.jsx("option",{value:"alphabetical",children:"Alphabetical"})]}),o.jsxs("select",{value:b,onChange:le=>w(le.target.value),className:"claude-input",children:[o.jsx("option",{value:"",children:"All Tags"}),Array.from(N).sort().map(le=>o.jsx("option",{value:le,children:le},le))]})]})]})}),se.length>0&&o.jsx("div",{className:"claude-card p-4 mb-6",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"claude-text-secondary",children:[o.jsx("span",{className:"font-semibold",children:se.length})," flashcards found"]}),o.jsxs("div",{className:"claude-text-muted text-sm",children:["Showing ",me+1,"-",Math.min(Ae,se.length)," of ",se.length]})]})}),l&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-10 h-10 border-4 border-t-4 rounded-full animate-spin mx-auto mb-4",style:{borderColor:"var(--claude-border)",borderTopColor:"var(--claude-accent)"}}),o.jsx("div",{className:"claude-text-secondary",children:"Loading flashcards..."})]}),!l&&se.length===0&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4 opacity-50",children:"🔍"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No flashcards found"}),o.jsx("p",{className:"claude-text-muted",children:"Try adjusting your search terms or filters"})]}),!l&&we.length>0&&o.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:we.map(oe)}),ge>1&&o.jsxs("div",{className:"flex justify-center items-center gap-2",children:[o.jsx("button",{onClick:()=>Ee(D-1),disabled:D===1,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"← Previous"}),Array.from({length:Math.min(5,ge)},(le,ye)=>{const Te=ye+1;return o.jsx("button",{onClick:()=>Ee(Te),className:`px-4 py-2 rounded-lg font-medium transition-all ${Te===D?"text-white":"claude-button-secondary"}`,style:{backgroundColor:Te===D?"var(--claude-accent)":void 0},children:Te},Te)}),o.jsx("button",{onClick:()=>Ee(D+1),disabled:D===ge,className:"claude-button-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Next →"})]})]})})},iE=new Map,r3=300*1e3,a3=()=>{const{user:s}=Sn(),[e,t]=P.useState([]),[n,i]=P.useState({totalUsers:0,totalCards:0,totalViews:0}),[l,u]=P.useState(!0),[h,m]=P.useState("creators"),[p,x]=P.useState(!1);P.useEffect(()=>{b(),w()},[h]);const b=async(D=!1)=>{try{u(!0);let q="upvotes";h==="creators"?q="flashcards":h==="streak"&&(q="streak");const z=`leaderboard_${q}`;if(!D){const G=iE.get(z);if(G&&Date.now()-G.timestamp<r3){console.log("📋 Using cached leaderboard data for:",q),t(G.data),x(!0),u(!1);return}}console.log("🏆 Loading leaderboard using backend API for:",q);const B=await fetch(`https://us-central1-three-sided-flashcard-app.cloudfunctions.net/getLeaderboard?sort=${encodeURIComponent(q)}`);if(!B.ok)throw new Error(`HTTP error! status: ${B.status}`);const L=await B.json();if(console.log("📊 Leaderboard data loaded:",L),!L.leaderboard||!Array.isArray(L.leaderboard))throw new Error("Invalid leaderboard data format");iE.set(z,{data:L.leaderboard,timestamp:Date.now()}),t(L.leaderboard),x(!1),console.log("✅ Leaderboard loaded:",L.leaderboard.length,"entries")}catch(q){console.error("💥 Error loading leaderboard:",q),t([])}finally{u(!1)}},w=async()=>{try{const D=Pe(Ne(te,"profiles")),q=await Fe(D),z=Pe(Ne(te,"publicCards")),B=await Fe(z);let L=0;B.docs.forEach(G=>{const H=G.data();L+=H.viewCount||0}),i({totalUsers:q.size,totalCards:B.size,totalViews:L})}catch(D){console.error("Error loading community stats:",D)}},N=D=>D?D.split(" ").map(q=>q.charAt(0)).join("").toUpperCase().slice(0,2):"?",V=D=>{switch(D){case 0:return"🥇";case 1:return"🥈";case 2:return"🥉";default:return`#${D+1}`}};return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"🏆 Community Leaderboard"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Celebrating our top contributors and creators"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:"👥"}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:n.totalUsers.toLocaleString()}),o.jsx("div",{className:"claude-text-secondary",children:"Community Members"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:"📚"}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:n.totalCards.toLocaleString()}),o.jsx("div",{className:"claude-text-secondary",children:"Total Flashcards"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:"👁️"}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:n.totalViews.toLocaleString()}),o.jsx("div",{className:"claude-text-secondary",children:"Total Views"})]})]}),o.jsx("div",{className:"claude-card p-2 mb-8",children:o.jsx("div",{className:"flex",children:[{id:"popular",label:"Most Upvoted",icon:"🔥"},{id:"creators",label:"Top Creators",icon:"👑"},{id:"streak",label:"Login Streak",icon:"⚡"}].map(D=>o.jsxs("button",{onClick:()=>m(D.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200",style:{backgroundColor:h===D.id?"var(--claude-accent)":"transparent",color:h===D.id?"white":"var(--claude-secondary-text)"},onMouseEnter:q=>{h!==D.id&&(q.target.style.backgroundColor="var(--claude-surface-hover)",q.target.style.color="var(--claude-primary-text)")},onMouseLeave:q=>{h!==D.id&&(q.target.style.backgroundColor="transparent",q.target.style.color="var(--claude-secondary-text)")},children:[o.jsx("span",{children:D.icon}),D.label]},D.id))})}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:h==="creators"?"👑 Top Creators":h==="popular"?"🔥 Most Upvoted":"⚡ Login Streak Champions"}),o.jsxs("div",{className:"flex items-center gap-3",children:[p&&o.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:"📋 Cached"}),o.jsx("button",{onClick:()=>b(!0),className:"claude-button-primary",title:"Force refresh from server (bypasses cache)",children:"Refresh"})]})]}),l?o.jsx("div",{className:"space-y-4",children:Array.from({length:10}).map((D,q)=>o.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl animate-pulse",style:{backgroundColor:"var(--claude-subtle)"},children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),o.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]},q))}):e.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),o.jsx("p",{className:"claude-text-muted",children:"Be the first to create some flashcards!"})]}):o.jsx("div",{className:"space-y-3",children:e.map((D,q)=>o.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl transition-all duration-300 hover:scale-105",style:{backgroundColor:q<3?"rgba(255, 215, 0, 0.1)":"var(--claude-subtle)",border:`1px solid ${q<3?"rgba(255, 215, 0, 0.3)":"var(--claude-border)"}`},children:[o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg",style:{background:q<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:q<3?"white":"var(--claude-background)"},children:V(q)}),o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:N(D.displayName)}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:D.displayName||"Anonymous"}),D.slug&&o.jsxs("a",{href:`/profile/${D.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",D.slug]})]}),o.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?`${D.flashcardCount||0} flashcards created`:h==="popular"?`${D.upvotesReceived||0} upvotes received`:`${D.loginStreak||0} day login streak`})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:q<3?"#B8860B":"var(--claude-accent-blue)"},children:h==="creators"?D.flashcardCount||0:h==="popular"?D.upvotesReceived||0:D.loginStreak||0}),o.jsx("div",{className:"claude-text-muted text-sm",children:h==="creators"?"cards":h==="popular"?"upvotes":"day streak"})]})]},D.slug||D.id))})]}),s&&o.jsxs("div",{className:"mt-8 bg-slate-800/30 border border-slate-700 rounded-2xl p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Your Position"}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:N(s.displayName)}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-white",children:s.displayName}),o.jsx("div",{className:"text-slate-400 text-sm",children:"That's you!"})]})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-xl font-bold text-blue-400",children:["#",e.findIndex(D=>D.id===s.uid)+1||"Unranked"]}),o.jsx("div",{className:"text-slate-400 text-sm",children:"Position"})]})]})]})]})})},i3=({onClose:s,refreshCallback:e})=>{const{user:t}=Sn(),[n,i]=P.useState([]),[l,u]=P.useState(!0),[h,m]=P.useState(""),[p,x]=P.useState(null),[b,w]=P.useState(null),[N,V]=P.useState({statement:"",hints:"",proof:"",subject:"",tags:""});P.useEffect(()=>{t&&D()},[t]);const D=async()=>{try{u(!0);const T=await Un.getPublicFlashcardsByUser(t.uid);i(T),m("")}catch(T){console.error("Error loading public cards:",T),m("Failed to load your public flashcards")}finally{u(!1)}},q=T=>{x(T),V({statement:T.statement||"",hints:Array.isArray(T.hints)?T.hints.join(`
`):T.hints||"",proof:T.proof||"",subject:T.subject||"",tags:Array.isArray(T.tags)?T.tags.join(", "):""})},z=async()=>{if(p)try{const T=ys.checkRateLimit(`edit_public_${t.uid}`,10,3e5);if(!T.allowed){m(T.message);return}const A=ys.validateFlashcardInput(N);if(!A.isValid){m(A.errors[0]);return}await Un.updatePublicFlashcard(p.id,A.sanitizedData,t.uid),x(null),m(""),await D(),e&&e()}catch(T){console.error("Error updating public card:",T);const A=ys.getPublicErrorMessage(T,!0);m(A)}},B=async T=>{try{const A=ys.checkRateLimit(`delete_public_${t.uid}`,5,3e5);if(!A.allowed){m(A.message);return}await Un.deletePublicFlashcard(T,t.uid),w(null),m(""),await D(),e&&e()}catch(A){console.error("Error deleting public card:",A);const k=ys.getPublicErrorMessage(A,!0);m(k)}},L=async T=>{try{const A=ys.checkRateLimit(`toggle_public_${t.uid}`,10,3e5);if(!A.allowed){m(A.message);return}await Un.toggleFlashcardPublic(T,t.uid,!1),m(""),await D(),e&&e()}catch(A){console.error("Error making card private:",A);const k=ys.getPublicErrorMessage(A,!0);m(k)}},G=(T,A)=>{V(k=>({...k,[T]:A}))},H=T=>T?(T.toDate?T.toDate():new Date(T)).toLocaleDateString():"Unknown",R=T=>`${window.location.origin}/card/${T.slug}`,C=T=>{const A=R(T);navigator.clipboard.writeText(A).then(()=>{alert("Card URL copied to clipboard!")})};return l?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:o.jsx("div",{className:"claude-card p-8 rounded-2xl shadow-2xl max-w-md",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading your public flashcards..."})]})})}):o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"📢 Manage Public Flashcards"}),o.jsx("button",{onClick:s,className:"claude-text-muted hover:text-gray-700 text-3xl transition-colors","aria-label":"Close manager",children:"×"})]}),h&&o.jsx("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsx("p",{className:"text-red-700 text-sm",children:h})}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:n.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📝"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No Public Flashcards Yet"}),o.jsx("p",{className:"claude-text-secondary mb-4",children:"Create flashcards and make them public to share your knowledge with the world!"}),o.jsx("button",{onClick:s,className:"claude-button-primary",children:"Create Your First Public Card"})]}):o.jsx("div",{className:"space-y-4",children:n.map(T=>o.jsxs("div",{className:"claude-card p-6 rounded-xl border-l-4 border-l-blue-500",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-lg mb-2",style:{color:"var(--claude-heading)"},children:T.statement?.length>100?`${T.statement.slice(0,100)}...`:T.statement}),o.jsxs("div",{className:"flex gap-4 text-sm claude-text-secondary",children:[o.jsxs("span",{children:["Created: ",H(T.createdAt)]}),o.jsxs("span",{children:["❤️ ",T.likeCount||0," likes"]}),o.jsxs("span",{children:["👁️ ",T.viewCount||0," views"]}),o.jsxs("span",{children:["📥 ",T.importCount||0," imports"]})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>C(T),className:"claude-button-secondary text-sm px-3 py-1",title:"Copy public URL",children:"🔗 Copy Link"}),o.jsx("button",{onClick:()=>q(T),className:"claude-button-secondary text-sm px-3 py-1",children:"✏️ Edit"}),o.jsx("button",{onClick:()=>L(T.id),className:"claude-button-secondary text-sm px-3 py-1 text-orange-600",title:"Make private (remove from public)",children:"🔒 Make Private"}),o.jsx("button",{onClick:()=>w(T.id),className:"claude-button-secondary text-sm px-3 py-1 text-red-600",children:"🗑️ Delete"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Subject & Tags:"}),o.jsxs("div",{className:"flex gap-2 flex-wrap",children:[o.jsx("span",{className:"claude-tag",children:T.subject||"General"}),T.tags?.map((A,k)=>o.jsx("span",{className:"claude-tag",children:A},k))]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Public URL:"}),o.jsx("a",{href:R(T),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 text-xs break-all",children:R(T)})]})]})]},T.id))})}),p&&o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Edit Public Flashcard"}),o.jsx("button",{onClick:()=>x(null),className:"claude-text-muted hover:text-gray-700 text-2xl",children:"×"})]}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-140px)]",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Statement *"}),o.jsx("textarea",{value:N.statement,onChange:T=>G("statement",T.target.value),className:"claude-input w-full h-24 resize-none",placeholder:"Enter the main statement or question...",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Hints"}),o.jsx("textarea",{value:N.hints,onChange:T=>G("hints",T.target.value),className:"claude-input w-full h-20 resize-none",placeholder:"Helpful hints (optional)..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Proof/Answer *"}),o.jsx("textarea",{value:N.proof,onChange:T=>G("proof",T.target.value),className:"claude-input w-full h-32 resize-none",placeholder:"Enter the proof, solution, or answer...",required:!0})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Subject"}),o.jsx("input",{type:"text",value:N.subject,onChange:T=>G("subject",T.target.value),className:"claude-input w-full",placeholder:"Mathematics, Physics, etc."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Tags"}),o.jsx("input",{type:"text",value:N.tags,onChange:T=>G("tags",T.target.value),className:"claude-input w-full",placeholder:"algebra, calculus, geometry (comma-separated)"})]})]})]})}),o.jsxs("div",{className:"px-6 py-4 border-t border-gray-300 flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>x(null),className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{onClick:z,className:"claude-button-primary",disabled:!N.statement.trim()||!N.proof.trim(),children:"Save Changes"})]})]})}),b&&o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:o.jsx("div",{className:"claude-card rounded-2xl shadow-2xl max-w-md w-full mx-4",children:o.jsxs("div",{className:"p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),o.jsx("h3",{className:"text-xl font-bold mb-2 text-red-600",children:"Delete Public Flashcard?"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:"This will permanently delete this flashcard from the public collection. This action cannot be undone."}),o.jsxs("div",{className:"flex gap-3 justify-center",children:[o.jsx("button",{onClick:()=>w(null),className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{onClick:()=>B(b),className:"claude-button-secondary bg-red-100 text-red-800 hover:bg-red-200 border-red-300",children:"Delete Forever"})]})]})})})]})})},Pl=(...s)=>!1,nx=s=>{if(!s)return null;if(typeof s?.toDate=="function")return s.toDate();const e=new Date(s);return Number.isNaN(e.getTime())?null:e},o3=(s,e=0)=>({id:s.id??`card-${e}`,subject:s.subject??"General",question:s.question??s.statement??"",answer:s.answer??s.proof??"",createdAt:nx(s.createdAt)??new Date(0),...s}),oE=(s,e)=>typeof s=="string"?s.length>e?s.slice(0,e)+"…":s:"",l3=()=>{const{user:s}=Sn(),[e,t]=P.useState(null),[n,i]=P.useState([]),[l,u]=P.useState([]),[h,m]=P.useState(!0),[p,x]=P.useState(!1),[b,w]=P.useState("overview"),[N,V]=P.useState(null),[D,q]=P.useState(!1),[z,B]=P.useState(!1),[L,G]=P.useState(null),[H,R]=P.useState([]),[C,T]=P.useState(!1);P.useEffect(()=>{if(!s?.uid){t(null),i([]),u([]),m(!1);return}A()},[s?.uid]);const A=P.useCallback(async()=>{let K=!0;m(!0),w(pe=>pe);try{const pe=s.uid;Pl("🔍 Loading user data for:",pe);const j=[Mf.getUserProfile(pe),(async()=>{try{const ye=await Un.getUserFlashcards(pe,100),{collection:Te,query:Oe,where:nt,orderBy:He,limit:ut,getDocs:$e}=await Yt(async()=>{const{collection:gn,query:$n,where:Ir,orderBy:jr,limit:Ti,getDocs:Oo}=await Promise.resolve().then(()=>Ms);return{collection:gn,query:$n,where:Ir,orderBy:jr,limit:Ti,getDocs:Oo}},void 0),{db:Qe}=await Yt(async()=>{const{db:gn}=await Promise.resolve().then(()=>oa);return{db:gn}},void 0),vt=Oe(Te(Qe,"flashcards"),nt("userId","==",pe),He("createdAt","desc"),ut(100)),Lt=(await $e(vt)).docs.map(gn=>({id:gn.id,...gn.data()}));return[...ye,...Lt].sort((gn,$n)=>{const Ir=gn.createdAt?.toMillis?.()||gn.createdAt?.getTime?.()||0;return($n.createdAt?.toMillis?.()||$n.createdAt?.getTime?.()||0)-Ir})}catch(ye){return Pl("Failed to load user cards:",ye),[]}})(),(async()=>{try{const{collection:ye,query:Te,where:Oe,getDocs:nt}=await Yt(async()=>{const{collection:Qe,query:vt,where:St,getDocs:Lt}=await Promise.resolve().then(()=>Ms);return{collection:Qe,query:vt,where:St,getDocs:Lt}},void 0),{db:He}=await Yt(async()=>{const{db:Qe}=await Promise.resolve().then(()=>oa);return{db:Qe}},void 0),ut=Te(ye(He,"cards"),Oe("userId","==",pe),Oe("originalCardId","!=",null));return(await nt(ut)).docs.map(Qe=>({id:Qe.id,...Qe.data()}))}catch(ye){return Pl("Failed to load imported cards:",ye),[]}})()],[oe,ge,me]=await Promise.allSettled(j);if(!K)return;const Ae=oe.status==="fulfilled"?oe.value:null,Ee=(ge.status==="fulfilled"?ge.value??[]:[]).map(o3),le=me.status==="fulfilled"?me.value??[]:[];Pl("👤 User profile:",Ae),Pl("📝 Private cards found:",Ee.length),Pl("📥 Imported cards found:",le.length),t(Ae),i(Ee),u(le)}catch(pe){console.error("💥 Error loading user data:",pe)}finally{K&&m(!1)}return()=>{K=!1}},[s?.uid]),k=async K=>{if(!confirm("Delete this card? This cannot be undone."))return;const pe=n;i(j=>j.filter(oe=>oe.id!==K));try{await Un.deleteFlashcard(K)}catch(j){console.error("Error deleting card:",j),i(pe)}},U=P.useCallback(async()=>{try{if(!s?.uid)return;const K=await Ln.getUserDecks(s.uid,!0);R(K)}catch(K){console.error("Error loading user decks:",K)}},[s?.uid]);P.useEffect(()=>{U()},[U]);const $=K=>{G(K),T(!0)},M=async K=>{if(L)try{await Ln.addCardToDeck(K,L.id),await Un.updateCardDeck(L.id,K),T(!1),G(null),await A()}catch(pe){console.error("Error moving card to deck:",pe),alert("Failed to move card. Please try again.")}},ze=async()=>{x(!0),await A(),x(!1)},se=P.useCallback(K=>{V(K),q(!0)},[]),F=P.useCallback(()=>{q(!1),V(null)},[]);Ud([N]);const ie=P.useMemo(()=>!n||n.length===0?0:new Set(n.map(pe=>pe.subject??"General")).size,[n]);return h?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-t-transparent rounded-full mx-auto mb-6",style:{borderColor:"var(--claude-accent)",borderTopColor:"transparent"}}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"Loading Dashboard..."}),o.jsx("p",{className:"claude-text-secondary",children:"Fetching your data"})]})}):o.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"🎯 Your Dashboard"}),o.jsxs("p",{className:"claude-text-secondary text-lg",children:["Welcome back, ",s?.displayName||"Student","!"]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs("div",{className:"claude-card p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:o.jsx("span",{className:"text-2xl",children:"📚"})}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Total"})]}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:n.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards Created"})]}),o.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:o.jsx("span",{className:"text-2xl",children:"📥"})}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Imported"})]}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:l.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported"})]}),o.jsxs("div",{className:"claude-card rounded-2xl p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"p-3 bg-green-500/20 rounded-xl",children:o.jsx("span",{className:"text-2xl",children:"🔥"})}),o.jsx("span",{className:"claude-text-muted text-sm",children:"Streak"})]}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-heading)"},children:e?.loginStreak||0}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]}),o.jsx("div",{role:"tablist","aria-label":"Dashboard sections",className:"flex claude-card rounded-2xl p-2 mb-8",children:[{id:"overview",label:"Overview",icon:"📊"},{id:"profile",label:"My Profile",icon:"👤"},{id:"cards",label:"My Cards",icon:"📚"},{id:"public",label:"Public Cards",icon:"📢"},{id:"imported",label:"Imported Cards",icon:"📥"}].map((K,pe)=>{const j=[{id:"overview",label:"Overview",icon:"📊"},{id:"profile",label:"My Profile",icon:"👤"},{id:"cards",label:"My Cards",icon:"📚"},{id:"public",label:"Public Cards",icon:"📢"},{id:"imported",label:"Imported Cards",icon:"📥"}],oe=b===K.id;return o.jsxs("button",{role:"tab","aria-selected":oe,"aria-controls":`${K.id}-panel`,id:`${K.id}-tab`,tabIndex:oe?0:-1,onKeyDown:ge=>{ge.key==="ArrowRight"&&w(j[(pe+1)%j.length].id),ge.key==="ArrowLeft"&&w(j[(pe-1+j.length)%j.length].id)},onClick:()=>w(K.id),className:`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 ${oe?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"claude-text-secondary hover:text-gray-700 hover:bg-gray-100"}`,children:[o.jsx("span",{children:K.icon}),K.label]},K.id)})}),b==="overview"&&o.jsxs("div",{role:"tabpanel",id:"overview-panel","aria-labelledby":"overview-tab",className:"space-y-8",children:[o.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"📈 Recent Activity"}),o.jsxs("div",{className:"space-y-4",children:[n.slice(0,5).map(K=>o.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-700/30 rounded-xl",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:[K.question?.slice(0,60),"..."]}),o.jsxs("p",{className:"claude-text-muted text-sm",children:["Created ",new Date(K.createdAt?.toDate?.()||K.createdAt).toLocaleDateString()]})]}),o.jsx("span",{className:"text-blue-400 text-sm",children:K.subject||"General"})]},K.id)),n.length===0&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-4xl mb-4",children:"📝"}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards yet"}),o.jsx("p",{className:"claude-text-muted",children:"Create your first flashcard to get started!"})]})]})]}),o.jsxs("div",{className:"claude-card rounded-3xl p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"📊 Quick Stats"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:n.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Total Cards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:l.length}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Imported Cards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:ie}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Subjects"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:e?.loginStreak||0}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Day Streak"})]})]})]})]}),b==="profile"&&o.jsxs("div",{role:"tabpanel",id:"profile-panel","aria-labelledby":"profile-tab",className:"claude-card rounded-3xl p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"👤 My Profile"}),e?o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Display Name"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsx("span",{className:"claude-text-primary",children:e.displayName||"Not set"})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Profile URL"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsxs("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 transition-colors",children:["three-sided.com/profile/",e.slug]})})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Bio"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsx("span",{className:"claude-text-primary",children:e.bio||"No bio added yet"})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Institution"}),o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsx("span",{className:"claude-text-primary",children:e.institution||"Not specified"})})]}),o.jsxs("div",{className:"flex gap-4 pt-4",children:[o.jsx("button",{onClick:()=>{console.log("Edit profile")},className:"claude-button-primary",children:"✏️ Edit Profile"}),o.jsx("a",{href:`/profile/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"claude-button-secondary",children:"👁️ View Public Profile"})]})]}):o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"👤"}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No profile yet"}),o.jsx("p",{className:"claude-text-muted mb-6",children:"Create a profile to share your flashcards publicly and connect with other students."}),o.jsx("button",{onClick:()=>{console.log("Create profile")},className:"claude-button-primary",children:"🚀 Create My Profile"})]})]}),b==="cards"&&o.jsxs("div",{role:"tabpanel",id:"cards-panel","aria-labelledby":"cards-tab",className:"claude-card rounded-3xl p-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:["📚 My Cards (",n.length,")"]}),o.jsx("button",{onClick:ze,disabled:p,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-60 rounded-lg transition-all duration-200",style:{color:"white"},children:p?"Refreshing…":"Refresh"})]}),n.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📝"}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No cards found"}),o.jsx("p",{className:"claude-text-muted mb-6",children:"It looks like you haven't created any flashcards yet, or there might be a connection issue."}),o.jsxs("div",{className:"space-x-4",children:[o.jsx("a",{href:"#",onClick:K=>{K.preventDefault(),window.location.href="/#create"},className:"inline-block px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-xl transition-all duration-200",style:{color:"white"},children:"Create a Flashcard"}),o.jsx("button",{onClick:ze,disabled:p,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:opacity-60 font-semibold rounded-xl transition-all duration-200",style:{color:"white"},children:p?"Refreshing…":"Try Loading Again"})]})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(K=>o.jsxs("div",{className:"group claude-card border hover:border-blue-500/50 rounded-2xl p-6 transition-all duration-300",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("span",{className:"text-sm text-blue-400 font-medium",children:K.subject||"General"}),o.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-200",children:[o.jsx("button",{onClick:()=>$(K),className:"text-purple-400 hover:text-purple-300 text-sm px-2 py-1 rounded bg-purple-500/10 hover:bg-purple-500/20",title:"Move to deck",children:"📁"}),o.jsx("button",{onClick:()=>k(K.id),className:"text-red-400 hover:text-red-300",title:"Delete card",children:"🗑️"})]})]}),o.jsx("h3",{className:"font-semibold mb-3 group-hover:text-blue-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:oE(K.question,80)}),o.jsx("p",{className:"claude-text-secondary text-sm mb-4 leading-relaxed",children:oE(K.answer,100)}),o.jsxs("div",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"claude-text-muted",children:nx(K.createdAt)?.toLocaleDateString()??"—"}),o.jsx("div",{className:"flex gap-2",children:K.slug?o.jsx("a",{href:`/card/${K.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"View Public →"}):o.jsx("button",{onClick:()=>se(K),className:"text-blue-400 hover:text-blue-300 font-medium transition-colors cursor-pointer",children:"🔍 Inspect"})})]})]},K.id))})]}),b==="public"&&o.jsxs("div",{role:"tabpanel",id:"public-panel","aria-labelledby":"public-tab",className:"claude-card rounded-3xl p-8",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:"📢 Your Public Cards"}),o.jsx("button",{onClick:()=>B(!0),className:"claude-button-primary",children:"📋 Manage Public Cards"})]}),o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📢"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Public Flashcard Management"}),o.jsx("p",{className:"claude-text-muted mb-6",children:"View, edit, and manage all your public flashcards in one place. Control what the world sees and track engagement."}),o.jsx("button",{onClick:()=>B(!0),className:"claude-button-primary",children:"Open Public Card Manager"})]})]}),b==="imported"&&o.jsxs("div",{role:"tabpanel",id:"imported-panel","aria-labelledby":"imported-tab",className:"claude-card rounded-3xl p-8",children:[o.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:["📥 Imported Cards (",l.length,")"]}),l.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📚"}),o.jsx("h3",{className:"text-xl font-semibold claude-text-secondary mb-2",children:"No imported cards yet"}),o.jsx("p",{className:"claude-text-muted",children:"Import useful cards from the public library!"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(K=>o.jsxs("div",{className:"group claude-card border hover:border-purple-500/50 rounded-2xl p-6 transition-all duration-300",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsx("span",{className:"text-sm text-purple-400 font-medium",children:K.subject||"General"}),o.jsx("span",{className:"text-blue-400",children:"📥"})]}),o.jsx("h3",{className:"font-semibold mb-3 group-hover:text-purple-300 transition-colors",style:{color:"var(--claude-primary-text)"},children:K.question?.length>80?K.question.slice(0,80)+"...":K.question}),o.jsx("p",{className:"claude-text-secondary text-sm leading-relaxed",children:K.answer?.length>100?K.answer.slice(0,100)+"...":K.answer})]},K.id))})]})]}),D&&N&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-300 flex justify-between items-center",children:[o.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Card Inspector"}),o.jsx("button",{onClick:F,className:"claude-text-muted hover:text-gray-700 text-2xl transition-colors","aria-label":"Close inspector",children:"×"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:[o.jsxs("div",{className:"flex gap-4 mb-6",children:[o.jsx("span",{className:"claude-tag",children:N.subject||"General"}),o.jsxs("span",{className:"claude-text-muted text-sm",children:["Created: ",nx(N.createdAt)?.toLocaleDateString()??"Unknown"]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-purple-400 mb-3",children:"Statement"}),o.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:N.statement||N.question||"No statement available"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-3",children:"Hints"}),o.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:Array.isArray(N.hints)?N.hints.join(`
`):N.hints||N.hint||"No hints available"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-green-400 mb-3",children:"Proof"}),o.jsx("div",{className:"claude-card rounded-xl p-4 leading-relaxed claude-text-primary",children:N.proof||N.answer||"No proof available"})]}),N.tags&&N.tags.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-orange-400 mb-3",children:"Tags"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:N.tags.map((K,pe)=>o.jsx("span",{className:"claude-tag",children:K},pe))})]}),o.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-300",children:[o.jsx("button",{onClick:()=>{console.log("Edit card:",N.id)},className:"claude-button-secondary",children:"✏️ Edit Card"}),o.jsx("button",{onClick:async()=>{await k(N.id),F()},className:"claude-button-danger",children:"🗑️ Delete Card"}),o.jsx("button",{onClick:F,className:"claude-button-primary ml-auto",children:"✓ Close"})]})]})]})}),z&&o.jsx(i3,{onClose:()=>B(!1),refreshCallback:A}),C&&L&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"claude-card max-w-md w-full mx-4 p-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-xl font-bold",style:{color:"var(--claude-heading)"},children:"Move Card to Deck"}),o.jsx("button",{onClick:()=>T(!1),className:"transition-colors",style:{color:"var(--claude-text-muted)"},onMouseEnter:K=>K.target.style.color="var(--claude-primary-text)",onMouseLeave:K=>K.target.style.color="var(--claude-text-muted)",children:"×"})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("p",{className:"claude-text-secondary mb-2",children:"Moving card:"}),o.jsx("p",{className:"font-medium truncate",style:{color:"var(--claude-primary-text)"},children:L.statement||L.question||"Untitled Card"})]}),o.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[H.map(K=>o.jsx("button",{onClick:()=>M(K.id),className:"w-full text-left p-3 rounded-lg border border-gray-600 hover:border-purple-500 hover:bg-purple-500/10 transition-all duration-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:K.icon||"📚"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--claude-primary-text)"},children:K.name}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[K.cardCount||0," cards • ",K.subject||"General"]})]})]})},K.id)),H.length===0&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"claude-text-secondary",children:"No decks available"}),o.jsx("p",{className:"text-sm claude-text-muted mt-2",children:"Create a deck first to organize your cards"})]})]}),o.jsx("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-600",children:o.jsx("button",{onClick:()=>T(!1),className:"claude-button-secondary flex-1",children:"Cancel"})})]})})]})},Ml=s=>s.trim().toLowerCase().replace(/[\s_]+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,40),c3=(s,e=200)=>{const[t,n]=P.useState(s);return P.useEffect(()=>{const i=setTimeout(()=>n(s),e);return()=>clearTimeout(i)},[s,e]),t},u3=({selectedTags:s=[],onTagsChange:e,onClose:t,isVisible:n=!1,maxSelected:i})=>{const[l,u]=P.useState([]),[h,m]=P.useState(""),[p,x]=P.useState(!0),[b,w]=P.useState(""),[N,V]=P.useState(""),D=P.useRef(null),q=c3(N,150);P.useEffect(()=>{if(!n)return;const T=document.body.style.overflow;document.body.style.overflow="hidden",setTimeout(()=>D.current?.focus(),0);const A=k=>{k.key==="Escape"&&t?.()};return window.addEventListener("keydown",A),()=>{document.body.style.overflow=T,window.removeEventListener("keydown",A)}},[n,t]),P.useEffect(()=>{if(!n)return;let T=!0;return(async()=>{x(!0),w("");try{const A=await Un.getPopularTags(100);if(!T)return;const k=Array.from(new Set((A||[]).map(U=>Ml(String(U||""))).filter(Boolean))).sort((U,$)=>U.localeCompare($));u(k.length?k:z())}catch(A){if(console.error("Error loading tags:",A),!T)return;u(z()),w("Could not load popular tags. Showing common tags.")}finally{T&&x(!1)}})(),()=>{T=!1}},[n]);const z=()=>["calculus","algebra","geometry","trigonometry","statistics","physics","chemistry","biology","computer-science","mathematics","linear-algebra","differential-equations","real-analysis","abstract-algebra","topology","number-theory","combinatorics","probability","optimization"],B=P.useMemo(()=>Array.from(new Set(s.map(T=>Ml(T)).filter(Boolean))),[s]),L=T=>typeof i=="number"?T<=i:!0,G=P.useCallback(T=>{const A=Ml(T),U=B.includes(A)?B.filter($=>$!==A):[...B,A];L(U.length)&&e?.(U)},[B,e,i]),H=P.useCallback(()=>{const T=Ml(h);if(T){if(!l.includes(T)){const A=[...l,T].sort((k,U)=>k.localeCompare(U));u(A)}if(!B.includes(T)){const A=[...B,T];L(A.length)&&e?.(A)}m("")}},[h,l,B,e,i]),R=P.useCallback(T=>{const A=Ml(T),k=B.filter(U=>U!==A);e?.(k)},[B,e]),C=P.useMemo(()=>{const T=q.trim().toLowerCase();return T?l.filter(A=>A.includes(T)):l},[l,q]);return n?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:o.jsxs("div",{ref:D,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"tags-title",className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden outline-none",children:[o.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"tags-title",className:"text-2xl font-bold",children:"🏷️ Tag Management"}),o.jsx("button",{onClick:t,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:"✕"})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Organize your flashcards with tags"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:[b&&o.jsx("div",{className:"mb-4 p-3 rounded-lg border border-yellow-200 bg-yellow-50 text-yellow-900",children:b}),B.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Selected Tags"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(T=>o.jsxs("span",{className:"inline-flex items-center gap-2 bg-primary-100 text-primary-800 px-3 py-2 rounded-full text-sm font-medium",children:["#",T,o.jsx("button",{onClick:()=>R(T),className:"text-primary-600 hover:text-primary-800 transition-colors","aria-label":`Remove tag ${T}`,children:"✕"})]},T))})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Add Custom Tag"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:h,onChange:T=>m(T.target.value),placeholder:"Enter new tag (e.g., linear-algebra)…",className:"input flex-1",onKeyDown:T=>T.key==="Enter"&&H(),"aria-label":"New tag"}),o.jsx("button",{onClick:H,className:"btn btn-primary whitespace-nowrap",disabled:!Ml(h),children:"Add Tag"})]}),!!i&&o.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[B.length,"/",i," selected"]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:"Browse Tags"}),o.jsx("input",{type:"text",value:N,onChange:T=>V(T.target.value),placeholder:"Search tags…",className:"input","aria-label":"Search tags"})]}),o.jsxs("div",{children:[o.jsxs("h3",{className:"text-lg font-semibold text-neutral-800 mb-3",children:["Available Tags (",C.length,")"]}),p?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-neutral-600",children:"Loading tags…"})]}):C.length===0?o.jsxs("div",{className:"text-center py-8 text-neutral-600",children:['No tags found matching "',q,'"']}):o.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 lg:grid-cols-4",children:C.map(T=>{const A=B.includes(T),k=!A&&i&&B.length>=i;return o.jsxs("button",{onClick:()=>G(T),disabled:k,className:`p-3 rounded-lg text-sm font-medium transition-all duration-200 text-left
                        ${A?"bg-primary-100 text-primary-800 border-2 border-primary-300":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200 border-2 border-transparent"}
                        ${k?"opacity-50 cursor-not-allowed":""}`,"aria-pressed":A,"aria-label":`Tag ${T}`,title:k?"Maximum selected":`#${T}`,children:["#",T]},T)})})]})]}),o.jsx("div",{className:"bg-neutral-50 px-6 py-4 border-t border-neutral-200",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"text-sm text-neutral-600",children:[B.length," tag",B.length!==1?"s":""," selected",i?` • max ${i}`:""]}),o.jsx("button",{onClick:t,className:"btn btn-primary",children:"Done"})]})})]})}):null},d3=1.3;function h3(s,e,t){const n={repetition:s.repetition??0,interval:s.interval??0,easeFactor:s.easeFactor??2.5};let{repetition:i,interval:l,easeFactor:u}=n;if(e<3)i=0,l=1;else{i===0?l=1:i===1?l=6:l=Math.round(l*u),i+=1;const p=.1-(5-e)*(.08+(5-e)*.02);u=Math.max(d3,parseFloat((u+p).toFixed(2)))}const h=new Date(t+l*24*60*60*1e3);return{next:{...s,repetition:i,interval:l,easeFactor:u,reviewCount:(s.reviewCount??0)+1,lastReviewed:new Date(t),nextReview:h}}}const f3=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState([]),[i,l]=P.useState(0),[u,h]=P.useState(!1),[m,p]=P.useState(!0),[x,b]=P.useState({total:0,due:0,new:0,learning:0,reviewing:0}),w=P.useRef(!0);P.useEffect(()=>(w.current=!0,e&&N(),()=>{w.current=!1}),[e]),P.useEffect(()=>{if(!e)return;const G=H=>{if(H.key==="Escape")return s?.();if(t.length){if(!u&&(H.key===" "||H.key==="Enter")){H.preventDefault(),h(!0);return}u&&"12345".includes(H.key)&&(H.preventDefault(),D(parseInt(H.key,10))),H.key.toLowerCase()==="r"&&q()}};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[e,t.length,u]),P.useEffect(()=>{if(!e)return;const G=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=G}},[e]);const N=async()=>{try{p(!0);const G=await Un.getPublicFlashcards(50);if(!w.current)return;const H=Date.now(),C=G.map((T,A)=>({...T,id:T.id||`card-${A}`,repetition:T.repetition??0,interval:T.interval??0,easeFactor:T.easeFactor??2.5,reviewCount:T.reviewCount??0,nextReview:T.nextReview?new Date(T.nextReview):new Date(H),difficulty:T.difficulty??3,lastReviewed:T.lastReviewed?new Date(T.lastReviewed):null,question:T.statement??T.question??"",answer:T.proof??T.answer??"",hints:Array.isArray(T.hints)?T.hints:T.hints?[T.hints]:[]})).sort((T,A)=>T.nextReview-A.nextReview);if(!w.current)return;n(C),V(C)}catch(G){console.error("Error loading cards:",G),w.current&&n([])}finally{w.current&&p(!1)}},V=G=>{const H=Date.now(),R=G.length,C=G.filter(k=>(k.nextReview?.getTime?.()??k.nextReview)<=H).length,T=k=>k.reviewCount??0,A={total:R,due:C,new:G.filter(k=>T(k)===0).length,learning:G.filter(k=>T(k)>0&&T(k)<5).length,reviewing:G.filter(k=>T(k)>=5).length};b(A)},D=G=>{const H=Date.now();n(R=>{if(!R.length)return R;const C=R[i];if(!C)return R;const{next:T}=h3(C,G,H),A=[...R];A[i]=T;const k=[...A].sort((U,$)=>U.nextReview-$.nextReview);return V(k),k}),l(R=>Math.min(R+1,t.length-1)),h(!1)},q=()=>{l(0),h(!1)},z=()=>t[i]||null,B=z();Ud([B,u]);const L=()=>[{value:1,label:"Again",color:"bg-danger-500 hover:bg-danger-600"},{value:2,label:"Hard",color:"bg-warning-500 hover:bg-warning-600"},{value:3,label:"Good",color:"bg-success-500 hover:bg-success-600"},{value:4,label:"Easy",color:"bg-primary-500 hover:bg-primary-600"},{value:5,label:"Perfect",color:"bg-accent-500 hover:bg-accent-600"}];return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:o.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"sr-title",className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",tabIndex:-1,children:[o.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 px-6 py-4 text-white",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"sr-title",className:"text-2xl font-bold",children:"🎯 Spaced Repetition"}),o.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close spaced repetition",title:"Close (Esc)",children:"✕"})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Intelligent study scheduling for optimal learning"})]}),o.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:m?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-neutral-600 text-lg",children:"Loading your study session..."})]}):t.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📚"}),o.jsx("h3",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"No cards available"}),o.jsx("p",{className:"text-neutral-600",children:"Create some flashcards to start studying!"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-primary-600",children:x.total}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Total"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-danger-600",children:x.due}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Due"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-accent-600",children:x.new}),o.jsx("div",{className:"text-sm text-neutral-600",children:"New"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-warning-600",children:x.learning}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Learning"})]}),o.jsxs("div",{className:"card p-4 text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-success-600",children:x.reviewing}),o.jsx("div",{className:"text-sm text-neutral-600",children:"Reviewing"})]})]}),o.jsxs("div",{className:"mb-6",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("span",{className:"text-sm font-medium text-neutral-700",children:["Card ",i+1," of ",t.length]}),o.jsxs("span",{className:"text-sm text-neutral-500",children:[Math.round((i+1)/t.length*100),"% complete"]})]}),o.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:o.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-secondary-500 h-2 rounded-full transition-all duration-300",style:{width:`${(i+1)/t.length*100}%`}})})]}),o.jsx("div",{className:"card p-8 mb-8",children:o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex justify-center gap-4 mb-6 text-sm text-neutral-600",children:[o.jsxs("span",{children:["Interval: ",z()?.interval||0," days"]}),o.jsxs("span",{children:["Reviews: ",z()?.reviewCount||0]}),o.jsxs("span",{children:["Ease: ",z()?.easeFactor?.toFixed(1)||"2.5"]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Question"}),o.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:z()?.question||"Loading..."})]}),u&&o.jsxs("div",{className:"mb-8 animate-fade-in",children:[o.jsx("h3",{className:"text-xl font-semibold text-neutral-800 mb-4",children:"Answer"}),o.jsx("div",{className:"bg-neutral-50 p-6 rounded-xl text-lg text-neutral-700 min-h-[100px] flex items-center justify-center",children:z()?.answer||"No answer available"}),z()?.hints&&z().hints.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("h4",{className:"text-lg font-medium text-neutral-700 mb-2",children:"Hints"}),o.jsx("div",{className:"space-y-2",children:z().hints.map((G,H)=>o.jsxs("div",{className:"bg-accent-50 p-3 rounded-lg text-neutral-700",children:["💡 ",G]},H))})]})]}),u?o.jsxs("div",{className:"space-y-4",children:[o.jsx("h4",{className:"text-lg font-semibold text-neutral-800",children:"How well did you know this?"}),o.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:L().map(({value:G,label:H,color:R})=>o.jsxs("button",{onClick:()=>D(G),className:`btn text-white px-6 py-3 ${R}`,title:`${H} (${G})`,"aria-label":`Rate as ${H} (Press ${G})`,children:[G,". ",H]},G))})]}):o.jsx("button",{onClick:()=>h(!0),className:"btn btn-primary text-lg px-8 py-4",title:"Show Answer (Space or Enter)",children:"Show Answer"})]})}),o.jsxs("div",{className:"text-center mt-6 p-4 bg-gray-50 rounded-lg",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"⌨️ Keyboard Shortcuts"}),o.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Space"})," Show Answer"]}),o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"1-5"})," Rate Quality"]}),o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"R"})," Reset Session"]}),o.jsxs("div",{children:[o.jsx("kbd",{className:"px-1 py-0.5 bg-white border rounded text-xs",children:"Esc"})," Close"]})]})]}),o.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[o.jsx("button",{onClick:q,className:"btn btn-secondary",title:"Reset Session (R)",children:"🔄 Reset Session"}),o.jsx("button",{onClick:s,className:"btn btn-primary",title:"Finish Session (Esc)",children:"Finish Session"})]})]})})]})}):null},m3=(s,e=200)=>{const[t,n]=P.useState(s);return P.useEffect(()=>{const i=setTimeout(()=>n(s),e);return()=>clearTimeout(i)},[s,e]),t},g3=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState(""),[i,l]=P.useState(""),[u,h]=P.useState(!1),[m,p]=P.useState(!1),[x,b]=P.useState(""),w=P.useRef(null),N=P.useRef(null),[V]=P.useState(["A direct sum B","The integral from 0 to infinity of x squared dx","The limit as x approaches 0 of sin x over x","The matrix with rows [1,2] and [3,4]","The set of all real numbers x such that x is greater than 0","The derivative of f with respect to x","The sum from n equals 1 to infinity of 1 over n squared","The product from i equals 1 to n of i","The square root of a squared plus b squared","The absolute value of x minus 3"]),D=m3(i,150);P.useEffect(()=>{e&&setTimeout(()=>w.current?.focus(),0)},[e]),P.useEffect(()=>{if(!e)return;const H=R=>{R.key==="Escape"&&s?.()};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[e,s]),Ud([D],N.current);const q=P.useCallback(async()=>{if(!(!t.trim()||u)){h(!0),b(""),p(!1);try{const H=await Vf.convertToLaTeX(t);l(H||"")}catch(H){console.error("Error converting to LaTeX:",H),b("Could not convert to LaTeX. Please try again.")}finally{h(!1)}}},[t,u]),z=async H=>{n(H),setTimeout(()=>{q()},0)},B=async()=>{if(i)try{await navigator.clipboard.writeText(i),p(!0),setTimeout(()=>p(!1),1500)}catch(H){console.error("Failed to copy:",H),p(!1)}},L=()=>{n(""),l(""),p(!1),b(""),h(!1)},G=H=>{(H.ctrlKey||H.metaKey)&&H.key==="Enter"&&(H.preventDefault(),q())};return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},role:"dialog","aria-modal":"true","aria-labelledby":"latex-converter-title",children:o.jsxs("div",{className:"claude-card rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"latex-converter-title",className:"text-2xl font-bold",children:"🔄 LaTeX Converter"}),o.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:"✕"})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Convert natural language to beautiful mathematical notation"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Input"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"nl-input",className:"block text-sm font-medium claude-text-secondary mb-2",children:"Natural Language Description"}),o.jsx("textarea",{id:"nl-input",ref:w,value:t,onChange:H=>n(H.target.value),placeholder:"e.g., A direct sum B, The integral from 0 to infinity of x squared dx...",className:"claude-input h-32",onKeyDown:G}),o.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Press Ctrl/⌘ + Enter to convert"})]}),o.jsx("button",{onClick:q,disabled:!t.trim()||u,className:"claude-button-primary w-full mb-4 disabled:opacity-60",children:u?o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Converting..."]}):"🔄 Convert to LaTeX"}),x&&o.jsxs("div",{className:"claude-alert claude-alert-error mb-4",children:[x," ",o.jsx("button",{className:"underline ml-1 font-medium",onClick:q,disabled:u,children:"Retry"})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-medium claude-text-secondary mb-3",children:"Quick Examples"}),o.jsx("div",{className:"space-y-2",children:V.map((H,R)=>o.jsx("button",{onClick:()=>z(H),className:"claude-card block w-full text-left p-3 text-sm claude-text-secondary transition-all hover:shadow-md","aria-label":`Use example: ${H}`,children:H},R))})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--heading)"},children:"Output"}),o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{htmlFor:"latex-output",className:"block text-sm font-medium claude-text-secondary mb-2",children:"LaTeX Code"}),o.jsxs("div",{className:"relative",children:[o.jsx("textarea",{id:"latex-output",value:i,readOnly:!0,placeholder:"LaTeX will appear here...",className:"claude-input h-32 font-mono",style:{backgroundColor:"var(--background-modal)"}}),o.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[i&&o.jsx("button",{onClick:B,className:"claude-button-secondary p-2",title:"Copy to clipboard","aria-label":"Copy LaTeX to clipboard",children:"📋"}),m&&o.jsx("span",{className:"px-2 py-1 text-xs rounded",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},role:"status","aria-live":"polite",children:"Copied!"})]})]})]}),i&&o.jsxs("div",{className:"mb-6",children:[o.jsx("label",{className:"block text-sm font-medium claude-text-secondary mb-2",children:"Preview"}),o.jsxs("div",{className:"claude-card p-4 min-h-[100px]",style:{border:"2px dashed var(--border-light)"},children:[o.jsx("div",{ref:N,className:"prose max-w-none",children:D}),!window.MathJax&&o.jsx("div",{className:"text-center mt-2 claude-text-muted text-xs",children:"(MathJax not loaded – preview shows raw TeX)"})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:L,disabled:!t&&!i&&!x,className:"claude-button-secondary w-full disabled:opacity-60",children:"🗑️ Clear All"}),o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-sm claude-text-secondary",children:"💡 Tip: Use this tool to quickly convert mathematical expressions"}),o.jsx("p",{className:"text-xs claude-text-muted mt-1",children:"Perfect for creating flashcards with LaTeX support"})]})]})]})]}),o.jsxs("div",{className:"mt-8 p-4 rounded-xl",style:{background:"linear-gradient(to right, var(--background-modal), rgba(68, 90, 255, 0.05))"},children:[o.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--heading)"},children:"How to use LaTeX in Three-Sided:"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm claude-text-secondary",children:[o.jsxs("div",{children:[o.jsx("strong",{children:"Inline math:"})," Wrap with ",o.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$ $"}),o.jsx("br",{}),o.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",o.jsx("code",{children:"$x^2 + y^2 = z^2$"})]})]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Block math:"})," Wrap with ",o.jsx("code",{className:"px-2 py-1 rounded",style:{backgroundColor:"var(--background-surface)"},children:"$$ $$"}),o.jsx("br",{}),o.jsxs("span",{className:"text-xs claude-text-muted",children:["Example: ",o.jsxs("code",{children:["$$\\int_0^\\infty e^","{-x}"," \\, dx = 1$$"]})]})]})]})]})]})]})}):null};class py{static async createCheckoutSession(){try{const e=await Xn.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const i=await t.json();throw new Error(i.error||"Failed to create checkout session")}return(await t.json()).id}catch(e){throw console.error("Error creating checkout session:",e),e}}static async createPortalLink(){try{const e=await Xn.currentUser?.getIdToken();if(!e)throw new Error("User must be authenticated");const t=await fetch("https://us-central1-three-sided-flashcard-app.cloudfunctions.net/createPortalLink",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const i=await t.json();throw new Error(i.error||"Failed to create portal link")}return(await t.json()).url}catch(e){throw console.error("Error creating portal link:",e),e}}static async redirectToCheckout(e){const t=window.Stripe?window.Stripe("pk_live_51RUu9KE3qmOAkttRGqw7Cr2wJ6qRHtCz9qXpHJHO0Bv4Q7gGHg5QXI9GFdXGh4IhQD5Xf9XUvLFCr9G2PHK0003w0Q"):null;if(!t)throw new Error("Stripe.js not loaded. Please include the Stripe script in your HTML.");const{error:n}=await t.redirectToCheckout({sessionId:e});if(n)throw new Error(n.message)}}const ta={monthly:{label:"Monthly",displayPrice:"£5",period:"month",savings:null,popular:!1,priceId:"price_1RUvcJE3qmOAkttR2Rh4YzOY",interval:"month"},yearly:{label:"Yearly",displayPrice:"£50",period:"year",savings:"£10",popular:!0,priceId:"price_YEARLY_REPLACE_ME",interval:"year"}},p3=[{name:"Spaced Repetition Mode",description:"Advanced algorithm for optimal learning",free:"✅",premium:"✅",icon:"🎯"},{name:"AI Autofill (Hint, Proof, Tags)",description:"Generate content with AI assistance",free:"⚠️ Limited (1/day)",premium:"✅ Unlimited",icon:"🤖"},{name:"AI Auto-Tagging",description:"Automatic tag suggestions",free:"⚠️ Limited (1/day)",premium:"✅ Unlimited",icon:"🏷️"},{name:"AI LaTeX Conversion",description:"Convert text to mathematical notation",free:"✅ Unlimited",premium:"✅ Unlimited",icon:"📐"},{name:"Public Profile & Sharing",description:"Share your flashcards with the community",free:"✅",premium:"✅ + Custom Themes",icon:"👤"},{name:"Advanced Analytics",description:"Detailed learning progress tracking",free:"❌",premium:"✅",icon:"📊"},{name:"Priority Support",description:"Get help when you need it most",free:"❌",premium:"✅",icon:"🎧"},{name:"Export & Backup",description:"Download your data anytime",free:"❌",premium:"✅",icon:"💾"}],y3=({onClose:s,isVisible:e=!1})=>{const[t,n]=P.useState("monthly"),[i,l]=P.useState(!1),[u,h]=P.useState(!1),[m,p]=P.useState(""),x=P.useRef(null);P.useEffect(()=>{if(e){const N=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=N}}},[e]),P.useEffect(()=>{if(!e)return;setTimeout(()=>x.current?.focus(),0);const N=V=>{V.key==="Escape"&&s?.()};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[e,s]);const b=P.useCallback(async()=>{p("");try{l(!0);const N=await py.createCheckoutSession();await py.redirectToCheckout(N)}catch(N){console.error("Error creating subscription:",N),p("Failed to start subscription. Please check your connection and try again.")}finally{l(!1)}},[t]),w=P.useCallback(async()=>{p("");try{h(!0);const N=await py.createPortalLink();window.location.href=N}catch(N){console.error("Error accessing subscription management:",N),p("Failed to open the billing portal. Please try again.")}finally{h(!1)}},[]);return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:o.jsxs("div",{ref:x,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"premium-title",className:"claude-card rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden outline-none",children:[o.jsxs("div",{className:"px-6 py-4 text-white claude-gradient",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{id:"premium-title",className:"text-2xl font-bold",children:"✨ Premium Features"}),o.jsx("button",{onClick:s,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Close",children:"✕"})]}),o.jsx("p",{className:"text-white/90 mt-1",children:"Unlock the full potential of Three-Sided"})]}),o.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[m&&o.jsx("div",{className:"claude-alert claude-alert-error mb-4",children:m}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Choose Your Plan"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto",role:"radiogroup","aria-label":"Billing plan",children:[o.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 ${t==="monthly"?"claude-card-elevated":""}`,style:{border:t==="monthly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="monthly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[o.jsx("input",{type:"radio",name:"plan",value:"monthly",className:"sr-only",checked:t==="monthly",onChange:()=>n("monthly"),"aria-label":"Monthly plan"}),o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:ta.monthly.label}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:ta.monthly.displayPrice}),o.jsxs("div",{className:"claude-text-secondary mb-4",children:["per ",ta.monthly.period]}),o.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto border-2",style:{backgroundColor:t==="monthly"?"var(--accent-primary)":"transparent",borderColor:t==="monthly"?"var(--accent-primary)":"var(--border-light)"}})]})]}),o.jsxs("label",{className:`claude-card p-6 cursor-pointer transition-all duration-200 relative ${t==="yearly"?"claude-card-elevated":""}`,style:{border:t==="yearly"?"2px solid var(--accent-primary)":void 0,boxShadow:t==="yearly"?"0 0 20px rgba(99, 91, 255, 0.2)":void 0},children:[o.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:o.jsx("span",{className:"text-white px-3 py-1 rounded-full text-xs font-bold",style:{backgroundColor:"var(--accent-secondary)"},children:"MOST POPULAR"})}),o.jsx("input",{type:"radio",name:"plan",value:"yearly",className:"sr-only",checked:t==="yearly",onChange:()=>n("yearly"),"aria-label":"Yearly plan"}),o.jsxs("div",{className:"text-center",children:[o.jsx("h4",{className:"text-xl font-bold mb-2",style:{color:"var(--heading)"},children:ta.yearly.label}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--accent-primary)"},children:ta.yearly.displayPrice}),o.jsxs("div",{className:"claude-text-secondary mb-2",children:["per ",ta.yearly.period]}),o.jsxs("div",{className:"font-bold mb-4",style:{color:"var(--success)"},children:["Save ",ta.yearly.savings,"!"]}),o.jsx("div",{className:"w-4 h-4 rounded-full border-2 mx-auto",style:{backgroundColor:t==="yearly"?"var(--accent-primary)":"transparent",borderColor:t==="yearly"?"var(--accent-primary)":"var(--border-light)"}})]})]})]})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Feature Comparison"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:"2px solid var(--border-light)"},children:[o.jsx("th",{className:"text-left p-4 font-semibold",style:{color:"var(--heading)"},children:"Feature"}),o.jsx("th",{className:"text-center p-4 font-semibold",style:{color:"var(--heading)"},children:"Free"}),o.jsx("th",{className:"text-center p-4 font-semibold rounded-lg",style:{color:"var(--heading)",background:"linear-gradient(to right, rgba(99, 91, 255, 0.1), rgba(68, 90, 255, 0.1))"},children:"Premium"})]})}),o.jsx("tbody",{children:p3.map((N,V)=>o.jsxs("tr",{className:"claude-card hover:shadow-sm transition-all",style:{border:"none",marginBottom:"4px"},children:[o.jsx("td",{className:"p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:N.icon}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",style:{color:"var(--heading)"},children:N.name}),o.jsx("div",{className:"text-sm claude-text-secondary",children:N.description})]})]})}),o.jsx("td",{className:"p-4 text-center",children:o.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:N.free==="✅"?"rgba(91, 200, 162, 0.1)":N.free.startsWith("⚠️")?"rgba(255, 213, 84, 0.1)":"var(--background-modal)",color:N.free==="✅"?"var(--success)":N.free.startsWith("⚠️")?"var(--warning)":"var(--text-secondary)"},children:N.free})}),o.jsx("td",{className:"p-4 text-center",style:{background:"linear-gradient(to right, rgba(99, 91, 255, 0.05), rgba(68, 90, 255, 0.05))"},children:o.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:N.premium})})]},V))})]})})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-2xl font-bold text-center mb-6",style:{color:"var(--heading)"},children:"Why Go Premium?"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:"🚀"}),o.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Accelerate Learning"}),o.jsx("p",{className:"claude-text-secondary",children:"Unlimited AI assistance helps you create better flashcards faster"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:"📈"}),o.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Track Progress"}),o.jsx("p",{className:"claude-text-secondary",children:"Advanced analytics show your learning journey and improvement"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-4xl mb-4",children:"🎯"}),o.jsx("h4",{className:"text-lg font-bold mb-2",style:{color:"var(--heading)"},children:"Study Smarter"}),o.jsx("p",{className:"claude-text-secondary",children:"Spaced repetition algorithm optimizes your study schedule"})]})]})]}),o.jsxs("div",{className:"text-center space-y-4",children:[o.jsx("button",{onClick:b,disabled:i,className:"claude-button-primary text-lg px-12 py-4 disabled:opacity-60 disabled:cursor-not-allowed",style:{boxShadow:"0 0 20px rgba(99, 91, 255, 0.3)"},children:i?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):`Go Premium - ${ta[t].displayPrice}/${ta[t].period}`}),o.jsxs("div",{className:"flex justify-center gap-4",children:[o.jsx("button",{onClick:w,disabled:u,className:"claude-button-secondary disabled:opacity-60 disabled:cursor-not-allowed",children:u?"Opening…":"Manage Subscription"}),o.jsx("button",{onClick:s,className:"claude-button-secondary",children:"Maybe Later"})]})]}),o.jsx("div",{className:"mt-8 p-4 rounded-xl text-center",style:{backgroundColor:"var(--background-modal)"},children:o.jsx("p",{className:"text-sm claude-text-secondary",children:"💳 Secure payment powered by Stripe • Cancel anytime • 30-day money-back guarantee"})})]})]})}):null},x3=({onProfileCreated:s,onClose:e})=>{const{user:t}=Sn(),[n,i]=P.useState({displayName:"",bio:"",institution:""}),[l,u]=P.useState(""),[h,m]=P.useState({state:"idle",message:""}),[p,x]=P.useState(!1),[b,w]=P.useState(null),N={displayName:50,bio:1e3,institution:100},V=P.useCallback(async L=>{const G=ns.slugify(L);if(u(G),!G){m({state:"idle",message:""});return}m({state:"checking",message:"Checking availability..."});try{const H=await ns.isSlugTaken(G);m(H?{state:"taken",message:`❌ ${G} is already taken`}:{state:"available",message:`✅ ${G} is available!`})}catch{m({state:"error",message:"❌ Error checking availability. Please try again."})}},[]),D=L=>{i(H=>({...H,displayName:L})),b&&clearTimeout(b);const G=setTimeout(()=>{V(L)},400);w(G)},q=async L=>{if(L.preventDefault(),!t){alert("You must be logged in to create a profile.");return}if(n.displayName.length<2||n.displayName.length>N.displayName){alert(`Display name must be between 2 and ${N.displayName} characters.`);return}if(n.bio.length>N.bio){alert(`Bio must be ${N.bio} characters or less.`);return}if(n.institution.length>N.institution){alert(`Institution must be ${N.institution} characters or less.`);return}if(!l||h.state!=="available"){alert("Please wait for slug availability check or choose a different name.");return}x(!0);try{if(await ns.isSlugTaken(l)){alert(`Username "${l}" was just taken. Please choose another name.`),await V(n.displayName);return}await ns.createProfile(t.uid,l,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim(),email:t.email}),s&&s()}catch(G){console.error("Error creating profile:",G),alert("Something went wrong. Please try again.")}finally{x(!1)}},z=({current:L,max:G,label:H})=>{const R=L/G*100;let C="text-sm ";return R>90?C+="text-red-500":R>70?C+="text-yellow-500":C+="text-gray-500",o.jsxs("div",{className:C,children:[L,"/",G," ",H]})};P.useEffect(()=>()=>{b&&clearTimeout(b)},[b]);const B=n.displayName.length>=2&&n.displayName.length<=N.displayName&&n.bio.length<=N.bio&&n.institution.length<=N.institution&&h.state==="available";return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Create Your Profile"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Set up your public profile to connect with others"})]}),o.jsx("div",{className:"claude-card p-8",children:o.jsxs("form",{onSubmit:q,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),o.jsx("input",{type:"text",value:n.displayName,onChange:L=>D(L.target.value),placeholder:"Enter your display name",maxLength:N.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:L=>{L.target.style.borderColor="var(--claude-accent)",L.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:L=>{L.target.style.borderColor="var(--claude-border)",L.target.style.boxShadow="none"}}),o.jsx("div",{className:"flex justify-between items-center mt-2",children:o.jsx(z,{current:n.displayName.length,max:N.displayName,label:"characters"})}),o.jsxs("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[o.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your profile URL: ",o.jsxs("strong",{children:["three-sided.app/profile/",o.jsx("span",{className:"font-mono",children:l||"..."})]})]}),h.message&&o.jsxs("div",{className:`text-sm mt-1 ${h.state==="checking"?"text-blue-500":h.state==="available"?"text-green-500":(h.state==="taken","text-red-500")}`,children:[h.state==="checking"&&o.jsxs("span",{className:"inline-flex items-center gap-2",children:[o.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin"}),h.message]}),h.state!=="checking"&&h.message]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Short Bio"}),o.jsx("textarea",{value:n.bio,onChange:L=>i(G=>({...G,bio:L.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:N.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:L=>{L.target.style.borderColor="var(--claude-accent)",L.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:L=>{L.target.style.borderColor="var(--claude-border)",L.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),o.jsx(z,{current:n.bio.length,max:N.bio,label:"characters"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),o.jsx("input",{type:"text",value:n.institution,onChange:L=>i(G=>({...G,institution:L.target.value})),placeholder:"University, company, or organization (optional)",maxLength:N.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:L=>{L.target.style.borderColor="var(--claude-accent)",L.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:L=>{L.target.style.borderColor="var(--claude-border)",L.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{}),o.jsx(z,{current:n.institution.length,max:N.institution,label:"characters"})]})]}),o.jsxs("div",{className:"flex gap-4 pt-4",children:[o.jsx("button",{type:"submit",disabled:!B||p,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:p?o.jsxs("span",{className:"flex items-center justify-center gap-2",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Profile..."]}):"Create Profile"}),e&&o.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 rounded-xl font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:L=>{L.target.style.backgroundColor="var(--claude-surface-hover)"},onMouseLeave:L=>{L.target.style.backgroundColor="var(--claude-subtle)"},children:"Cancel"})]})]})})]})})};class sn{static async getFriendRequests(e){try{const t=Pe(Ne(te,"friendRequests"),qe("to","==",e),Gt("timestamp","desc")),n=await Fe(t),i=[];for(const l of n.docs){const u=l.data(),h=u.from,m=await ns.getProfileByUserId(h);i.push({id:l.id,fromId:h,toId:u.to,timestamp:u.timestamp,senderProfile:m||{displayName:"Unknown User",slug:null}})}return i}catch(t){throw console.error("Error getting friend requests:",t),t}}static async sendFriendRequest(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs");const[n,i]=await Promise.all([this.checkExistingRequest(e,t),this.checkExistingRequest(t,e)]);if(n)throw new Error("Friend request already sent");if(i)throw new Error("This user has already sent you a friend request");if(await this.areFriends(e,t))throw new Error("You are already friends");const u=3;let h;for(let m=1;m<=u;m++)try{await Jn(Ne(te,"friendRequests"),{from:e,to:t,timestamp:ke(),status:"pending"}),console.log("✅ Friend request sent:",{fromId:e,toId:t});return}catch(p){h=p,m<u&&(console.warn(`Retry ${m}/${u} for friend request:`,p.message),await new Promise(x=>setTimeout(x,1e3*m)))}throw h}catch(n){throw console.error("❌ Error sending friend request:",n),n}}static async acceptFriendRequest(e,t,n){try{if(!e||!t||!n||t===n)throw new Error("Invalid parameters for accepting friend request");const i=await At(xe(te,"friendRequests",e));if(!i.exists())throw new Error("Friend request not found");const l=i.data();if(l.from!==t||l.to!==n)throw new Error("Friend request does not match the specified users");if(await this.areFriends(t,n)){await Hl(xe(te,"friendRequests",e)),console.log("Users were already friends, cleaned up request");return}const h=xo(te),m=xe(te,"userFriends",n,"friends",t),p=xe(te,"userFriends",t,"friends",n),x={addedAt:ke(),requestAcceptedAt:ke(),status:"active"};h.set(m,x),h.set(p,x);const b=xe(te,"friendRequests",e);h.delete(b);const w=3;let N;for(let V=1;V<=w;V++)try{await h.commit(),console.log("✅ Friend request accepted:",{fromId:t,toId:n,requestId:e});return}catch(D){N=D,V<w&&(console.warn(`Retry ${V}/${w} for accepting friend request:`,D.message),await new Promise(q=>setTimeout(q,1e3*V)))}throw N}catch(i){throw console.error("❌ Error accepting friend request:",i),i}}static async rejectFriendRequest(e){try{await Hl(xe(te,"friendRequests",e)),console.log("✅ Friend request rejected:",e)}catch(t){throw console.error("❌ Error rejecting friend request:",t),t}}static async removeFriend(e,t){try{if(!e||!t||e===t)throw new Error("Invalid user IDs for removing friend");if(!await this.areFriends(e,t)){console.log("Users are not friends, nothing to remove");return}const i=xo(te),l=xe(te,"userFriends",e,"friends",t),u=xe(te,"userFriends",t,"friends",e);i.delete(l),i.delete(u);const h=3;let m;for(let p=1;p<=h;p++)try{await i.commit(),console.log("✅ Friend removed:",{userId:e,friendId:t});return}catch(x){m=x,p<h&&(console.warn(`Retry ${p}/${h} for removing friend:`,x.message),await new Promise(b=>setTimeout(b,1e3*p)))}throw m}catch(n){throw console.error("❌ Error removing friend:",n),n}}static async getFriends(e){try{const t=Pe(Ne(te,"userFriends",e,"friends")),n=await Fe(t),i=[];for(const l of n.docs){const u=l.id,h=l.data(),m=await ns.getProfileByUserId(u);m&&i.push({userId:u,addedAt:h.addedAt,...m})}return i}catch(t){throw console.error("Error getting friends:",t),t}}static async getFriendshipStatus(e,t){try{const n=await this.areFriends(e,t),i=await this.checkExistingRequest(e,t),l=await this.checkExistingRequest(t,e);return{areFriends:n,sentRequest:!!i,receivedRequest:!!l,receivedRequestId:l?.id||null}}catch(n){return console.error("Error getting friendship status:",n),{areFriends:!1,sentRequest:!1,receivedRequest:!1,receivedRequestId:null}}}static async areFriends(e,t){try{return(await At(xe(te,"userFriends",e,"friends",t))).exists()}catch(n){return console.error("Error checking friendship:",n),!1}}static async checkExistingRequest(e,t){try{const n=Pe(Ne(te,"friendRequests"),qe("from","==",e),qe("to","==",t)),i=await Fe(n);if(!i.empty){const l=i.docs[0];return{id:l.id,...l.data()}}return null}catch(n){return console.error("Error checking existing request:",n),null}}static async getMutualFriends(e,t){try{const[n,i]=await Promise.all([this.getFriendIds(e),this.getFriendIds(t)]),l=n.filter(h=>i.includes(h)),u=[];for(let h=0;h<Math.min(3,l.length);h++){const m=await ns.getProfileByUserId(l[h]);m&&u.push(m)}return{total:l.length,profiles:u,hasMore:l.length>3}}catch(n){return console.error("Error getting mutual friends:",n),{total:0,profiles:[],hasMore:!1}}}static async getFriendCount(e){try{const t=Pe(Ne(te,"userFriends",e,"friends"));return(await Fe(t)).size}catch(t){return console.error("Error getting friend count:",t),0}}static async getFriendIds(e){try{const t=Pe(Ne(te,"userFriends",e,"friends"));return(await Fe(t)).docs.map(i=>i.id)}catch(t){return console.error("Error getting friend IDs:",t),[]}}}const v3=({onViewProfile:s})=>{const{user:e}=Sn(),[t,n]=P.useState("friends"),[i,l]=P.useState([]),[u,h]=P.useState([]),[m,p]=P.useState([]),[x,b]=P.useState(""),[w,N]=P.useState(!1),[V,D]=P.useState([]),[q,z]=P.useState({friendCount:0,requestCount:0,sharedCardsCount:0,mutualConnections:0});P.useEffect(()=>{e&&B()},[e]),P.useEffect(()=>{switch(t){case"friends":L();break;case"requests":G();break;case"leaderboard":k();break}},[t]);const B=async()=>{try{const[se,F,ie]=await Promise.all([sn.getFriendCount(e.uid),sn.getFriendRequests(e.uid),Un.getPublicFlashcardsByUser(e.uid)]);z(K=>({...K,friendCount:se,requestCount:F.length,sharedCardsCount:ie.length}))}catch(se){console.error("Error loading initial data:",se)}},L=async()=>{N(!0);try{const se=await sn.getFriends(e.uid);l(se),z(F=>({...F,friendCount:se.length}))}catch(se){console.error("Error loading friends:",se)}finally{N(!1)}},G=async()=>{N(!0);try{const se=await sn.getFriendRequests(e.uid);h(se),z(F=>({...F,requestCount:se.length}))}catch(se){console.error("Error loading friend requests:",se)}finally{N(!1)}},H=async()=>{if(x.trim()){N(!0);try{const F=(await ns.searchProfiles(x)).filter(K=>K.userId!==e.uid),ie=await Promise.all(F.map(async K=>{const pe=await sn.getFriendshipStatus(e.uid,K.userId),j=await sn.getMutualFriends(e.uid,K.userId);return{...K,friendshipStatus:pe,mutualFriends:j}}));p(ie)}catch(se){console.error("Error searching users:",se)}finally{N(!1)}}},R=async se=>{try{await sn.sendFriendRequest(e.uid,se),U("Friend request sent!"),x&&await H(),await B()}catch(F){console.error("Error sending friend request:",F),U("Failed to send friend request",!0)}},C=async se=>{try{await sn.acceptFriendRequest(se.id,se.fromId,e.uid),U("Friend request accepted!"),await G(),await B(),t==="friends"&&await L()}catch(F){console.error("Error accepting friend request:",F),U("Failed to accept friend request",!0)}},T=async se=>{try{await sn.rejectFriendRequest(se),U("Friend request declined"),await G(),await B()}catch(F){console.error("Error rejecting friend request:",F),U("Failed to reject friend request",!0)}},A=async(se,F)=>{if(confirm(`Remove ${F} from your friends?`))try{await sn.removeFriend(e.uid,se),U("Friend removed"),await L(),await B()}catch(ie){console.error("Error removing friend:",ie),U("Failed to remove friend",!0)}},k=async()=>{N(!0);try{const se=await sn.getFriendIds(e.uid),F=[e.uid,...se],ie=[];for(const pe of F){const j=await ns.getProfileByUserId(pe);j&&ie.push({...j,userId:pe})}const K=await Promise.all(ie.map(async pe=>{const j=await sn.getFriendCount(pe.userId);return{...pe,friendCount:j,isCurrentUser:pe.userId===e.uid}}));K.sort((pe,j)=>j.friendCount-pe.friendCount),D(K)}catch(se){console.error("Error loading leaderboard:",se)}finally{N(!1)}},U=(se,F=!1)=>{const ie=document.createElement("div");ie.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",ie.style.backgroundColor=F?"#ef4444":"#10b981",ie.textContent=se,document.body.appendChild(ie),setTimeout(()=>{ie.style.transform="translateX(0)"},100),setTimeout(()=>{ie.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(ie)},300)},3e3)},$=se=>se?se.split(" ").map(F=>F.charAt(0)).join("").toUpperCase().slice(0,2):"?",M=(se,F,ie,K=!0)=>{const pe=()=>K?F?.areFriends?o.jsx("button",{onClick:()=>A(se.userId,se.displayName),className:"px-3 py-1 rounded-lg text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove"}):F?.sentRequest?o.jsx("span",{className:"px-3 py-1 rounded-lg text-sm font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):F?.receivedRequest?o.jsx("button",{onClick:()=>C({id:F.receivedRequestId,fromId:se.userId}),className:"px-3 py-1 rounded-lg text-sm font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}):o.jsx("button",{onClick:()=>R(se.userId),className:"px-3 py-1 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}):null,j=()=>F?.areFriends?o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-green-100 text-green-800",children:"Friends"}):F?.sentRequest?o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"Pending"}):F?.receivedRequest?o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"Wants to connect"}):null;return o.jsx("div",{className:"claude-card p-4 hover:scale-[1.02] transition-transform",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:$(se.displayName)}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:s&&se.slug?o.jsx("button",{onClick:()=>s(se.slug),className:"hover:underline transition-colors",style:{color:"var(--claude-heading)"},children:se.displayName||"Unknown User"}):se.displayName||"Unknown User"}),j()]}),o.jsxs("div",{className:"text-sm claude-text-secondary space-y-1",children:[se.email&&o.jsx("div",{children:se.email}),se.institution&&o.jsxs("div",{children:["🏫 ",se.institution]}),ie?.total>0&&o.jsxs("div",{className:"text-green-600 font-medium",children:[ie.total," mutual friend",ie.total>1?"s":""]})]})]})]}),o.jsx("div",{className:"flex items-center gap-2",children:pe()})]})},se.userId)},ze=[{id:"friends",label:"My Friends",icon:"👥"},{id:"discover",label:"Discover",icon:"🔍"},{id:"requests",label:"Requests",icon:"📬",badge:q.requestCount},{id:"leaderboard",label:"Leaderboard",icon:"🏆"}];return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"👥 Friends & Social"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Connect with fellow learners and share your progress"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:"👥"}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent-blue)"},children:q.friendCount}),o.jsx("div",{className:"claude-text-secondary",children:"Friends"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:"📚"}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-accent)"},children:q.sharedCardsCount}),o.jsx("div",{className:"claude-text-secondary",children:"Cards Shared"})]}),o.jsxs("div",{className:"claude-card p-6 text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:"📬"}),o.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:"var(--claude-success)"},children:q.requestCount}),o.jsx("div",{className:"claude-text-secondary",children:"Pending Requests"})]})]}),o.jsx("div",{className:"claude-card p-2 mb-8",children:o.jsx("div",{className:"flex",children:ze.map(se=>o.jsxs("button",{onClick:()=>n(se.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-medium transition-all duration-200 relative",style:{backgroundColor:t===se.id?"var(--claude-accent)":"transparent",color:t===se.id?"white":"var(--claude-secondary-text)"},children:[o.jsx("span",{children:se.icon}),se.label,se.badge>0&&o.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:se.badge})]},se.id))})}),o.jsxs("div",{className:"claude-card p-8",children:[t==="friends"&&o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:["👥 My Friends (",q.friendCount,")"]}),w?o.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((se,F)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},F))}):i.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"👥"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No friends yet"}),o.jsx("p",{className:"claude-text-secondary",children:"Search for users to add your first friend!"})]}):o.jsx("div",{className:"space-y-4",children:i.map(se=>M(se,{areFriends:!0},null,!0))})]}),t==="discover"&&o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"🔍 Discover Users"}),o.jsxs("div",{className:"flex gap-4 mb-6",children:[o.jsx("input",{type:"text",value:x,onChange:se=>b(se.target.value),onKeyPress:se=>se.key==="Enter"&&H(),placeholder:"Search by email or display name...",className:"flex-1 px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"}}),o.jsxs("button",{onClick:H,disabled:!x.trim()||w,className:"claude-button-primary disabled:opacity-50",children:[w?"⏳":"🔍"," Search"]})]}),o.jsx("p",{className:"text-sm claude-text-secondary mb-6",children:"💡 Tip: Search by email address or display name for best results"}),w?o.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((se,F)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},F))}):m.length===0&&x?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"😔"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No users found"}),o.jsx("p",{className:"claude-text-secondary",children:"Try searching with a different email or username"})]}):m.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"Discover new friends"}),o.jsx("p",{className:"claude-text-secondary",children:"Search for users to connect with and share your learning journey!"})]}):o.jsx("div",{className:"space-y-4",children:m.map(se=>M(se,se.friendshipStatus,se.mutualFriends,!0))})]}),t==="requests"&&o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:["📬 Friend Requests (",q.requestCount,")"]}),w?o.jsx("div",{className:"space-y-4",children:Array.from({length:2}).map((se,F)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]})]})},F))}):u.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📬"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No pending requests"}),o.jsx("p",{className:"claude-text-secondary",children:"You're all caught up! New friend requests will appear here."})]}):o.jsx("div",{className:"space-y-4",children:u.map(se=>o.jsx("div",{className:"claude-card p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:$(se.senderProfile.displayName)}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:se.senderProfile.displayName||"Unknown User"}),o.jsx("div",{className:"text-sm claude-text-secondary",children:"Wants to connect with you"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>C(se),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept"}),o.jsx("button",{onClick:()=>T(se.id),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Decline"})]})]})},se.id))})]}),t==="leaderboard"&&o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"🏆 Friends Leaderboard"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:"Top learners among you and your friends"}),w?o.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((se,F)=>o.jsx("div",{className:"animate-pulse claude-card p-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"w-12 h-12 rounded-full",style:{backgroundColor:"var(--claude-border)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"h-4 rounded mb-2",style:{backgroundColor:"var(--claude-border)"}}),o.jsx("div",{className:"h-3 rounded w-1/2",style:{backgroundColor:"var(--claude-border)"}})]}),o.jsx("div",{className:"w-16 h-8 rounded",style:{backgroundColor:"var(--claude-border)"}})]})},F))}):V.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No leaderboard data"}),o.jsx("p",{className:"claude-text-secondary",children:"Add some friends to see the leaderboard!"})]}):o.jsx("div",{className:"space-y-3",children:V.map((se,F)=>o.jsx("div",{className:`claude-card p-4 transition-all duration-300 hover:scale-[1.02] ${se.isCurrentUser?"ring-2 ring-blue-500 bg-blue-50/10":""}`,style:{backgroundColor:F<3&&!se.isCurrentUser?"rgba(255, 215, 0, 0.1)":se.isCurrentUser?"rgba(59, 130, 246, 0.1)":"var(--claude-surface)",border:`1px solid ${F<3&&!se.isCurrentUser?"rgba(255, 215, 0, 0.3)":se.isCurrentUser?"rgba(59, 130, 246, 0.3)":"var(--claude-border)"}`},children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm",style:{background:F<3?"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)":"var(--claude-muted)",color:F<3?"white":"var(--claude-text)"},children:F===0?"🥇":F===1?"🥈":F===2?"🥉":F+1}),o.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{background:"var(--claude-accent)"},children:$(se.displayName)}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("h3",{className:"font-semibold",style:{color:"var(--claude-heading)"},children:[se.displayName||"Unknown User",se.isCurrentUser&&o.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"You"})]}),se.slug&&o.jsxs("button",{onClick:()=>s&&s(se.slug),className:"text-sm transition-colors hover:underline",style:{color:"var(--claude-accent)"},children:["@",se.slug]})]}),o.jsx("div",{className:"claude-text-secondary text-sm",children:se.institution&&`🏫 ${se.institution}`})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-xl font-bold",style:{color:F<3?"#FFD700":"var(--claude-accent-blue)"},children:se.friendCount}),o.jsxs("div",{className:"claude-text-secondary text-sm",children:["friend",se.friendCount!==1?"s":""]})]})]})},se.userId))})]})]})]})})},b3=({profile:s,onSave:e,onCancel:t})=>{const[n,i]=P.useState({displayName:"",bio:"",institution:""}),[l,u]=P.useState(!1),h={displayName:50,bio:1e3,institution:100};P.useEffect(()=>{s&&i({displayName:s.displayName||"",bio:s.bio||"",institution:s.institution||""})},[s]);const m=async x=>{if(x.preventDefault(),n.displayName.length<2||n.displayName.length>h.displayName){alert(`Display name must be between 2 and ${h.displayName} characters.`);return}if(n.bio.length>h.bio){alert(`Bio must be ${h.bio} characters or less.`);return}if(n.institution.length>h.institution){alert(`Institution must be ${h.institution} characters or less.`);return}u(!0);try{await ns.updateProfile(s.slug,{displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()}),e&&e({...s,displayName:n.displayName.trim(),bio:n.bio.trim(),institution:n.institution.trim()})}catch(b){console.error("Error updating profile:",b),alert("Something went wrong. Please try again.")}finally{u(!1)}},p=({current:x,max:b,label:w})=>{const N=x/b*100;let V="text-sm ";return N>90?V+="text-red-500":N>70?V+="text-yellow-500":V+="text-gray-500",o.jsxs("div",{className:V,children:[x,"/",b," ",w]})};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"claude-card p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-3xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:"Edit Profile"}),o.jsx("p",{className:"claude-text-secondary",children:"Update your public profile information"})]}),o.jsxs("form",{onSubmit:m,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Display Name *"}),o.jsx("input",{type:"text",value:n.displayName,onChange:x=>i(b=>({...b,displayName:x.target.value})),placeholder:"Enter your display name",maxLength:h.displayName,required:!0,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsxs("div",{className:"text-sm claude-text-secondary",children:["Your username @",s?.slug," cannot be changed"]}),o.jsx(p,{current:n.displayName.length,max:h.displayName,label:"characters"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Bio"}),o.jsx("textarea",{value:n.bio,onChange:x=>i(b=>({...b,bio:x.target.value})),placeholder:"Tell others a bit about yourself...",maxLength:h.bio,rows:4,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2 resize-none",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{className:"text-sm claude-text-secondary",children:"Share your interests, expertise, or what you're studying"}),o.jsx(p,{current:n.bio.length,max:h.bio,label:"characters"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--claude-heading)"},children:"Institution"}),o.jsx("input",{type:"text",value:n.institution,onChange:x=>i(b=>({...b,institution:x.target.value})),placeholder:"University, company, or organization (optional)",maxLength:h.institution,className:"w-full px-4 py-3 rounded-xl border transition-colors focus:outline-none focus:ring-2",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},onFocus:x=>{x.target.style.borderColor="var(--claude-accent)",x.target.style.boxShadow="0 0 0 3px rgba(99, 91, 255, 0.1)"},onBlur:x=>{x.target.style.borderColor="var(--claude-border)",x.target.style.boxShadow="none"}}),o.jsxs("div",{className:"flex justify-between items-center mt-2",children:[o.jsx("div",{}),o.jsx(p,{current:n.institution.length,max:h.institution,label:"characters"})]})]}),o.jsxs("div",{className:"flex gap-4 pt-4",children:[o.jsx("button",{type:"submit",disabled:l,className:"flex-1 claude-button-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?o.jsxs("span",{className:"flex items-center justify-center gap-2",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"}),o.jsx("button",{type:"button",onClick:t,disabled:l,className:"px-6 py-3 rounded-xl font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},onMouseEnter:x=>{l||(x.target.style.backgroundColor="var(--claude-surface-hover)")},onMouseLeave:x=>{l||(x.target.style.backgroundColor="var(--claude-subtle)")},children:"Cancel"})]})]})]})})},_3=({profileSlug:s,onClose:e})=>{const{user:t}=Sn(),[n,i]=P.useState(null),[l,u]=P.useState([]),[h,m]=P.useState(null),[p,x]=P.useState(null),[b,w]=P.useState({cardCount:0,friendCount:0}),[N,V]=P.useState(!0),[D,q]=P.useState("upvotes"),[z,B]=P.useState(!1),[L,G]=P.useState(null);P.useEffect(()=>{s&&H()},[s]),P.useEffect(()=>{n&&n.userId&&R()},[n,D]);const H=async()=>{V(!0);try{const F=await ns.getProfileBySlug(s);if(!F)throw new Error("Profile not found");i(F)}catch(F){console.error("Error loading profile:",F),alert("Profile not found or error loading profile"),e&&e()}finally{V(!1)}},R=async()=>{try{const[F,ie,K,pe]=await Promise.all([C(),sn.getFriendCount(n.userId),t?sn.getFriendshipStatus(t.uid,n.userId):null,t?sn.getMutualFriends(t.uid,n.userId):null]);w({cardCount:F.length,friendCount:ie}),m(K),x(pe)}catch(F){console.error("Error loading profile data:",F)}},C=async()=>{try{const ie=(await Un.getPublicFlashcardsByUser(n.userId)).sort((K,pe)=>{switch(D){case"upvotes":return(pe.upvotes||0)-(K.upvotes||0);case"date":return new Date(pe.createdAt)-new Date(K.createdAt);default:return 0}});return u(ie),ie}catch(F){return console.error("Error loading public cards:",F),[]}},T=async F=>{if(!t){alert("Please sign in to connect with friends");return}try{switch(F){case"send_request":await sn.sendFriendRequest(t.uid,n.userId),A("Friend request sent!");break;case"accept_request":await sn.acceptFriendRequest(h.receivedRequestId,n.userId,t.uid),A("Friend request accepted!");break;case"remove_friend":confirm(`Remove ${n.displayName} from your friends?`)&&(await sn.removeFriend(t.uid,n.userId),A("Friend removed"));break}const ie=await sn.getFriendshipStatus(t.uid,n.userId);m(ie);const K=await sn.getFriendCount(n.userId);w(pe=>({...pe,friendCount:K}))}catch(ie){console.error("Error with friend action:",ie),A("Failed to perform action",!0)}},A=(F,ie=!1)=>{const K=document.createElement("div");K.className="fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-transform transform translate-x-full",K.style.backgroundColor=ie?"#ef4444":"#10b981",K.textContent=F,document.body.appendChild(K),setTimeout(()=>{K.style.transform="translateX(0)"},100),setTimeout(()=>{K.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(K)},300)},3e3)},k=F=>F?F.split(" ").map(ie=>ie.charAt(0)).join("").toUpperCase().slice(0,2):"?",U=()=>!t||!h?null:h.areFriends?o.jsx("button",{onClick:()=>T("remove_friend"),className:"px-4 py-2 rounded-lg font-medium bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Remove Friend"}):h.sentRequest?o.jsx("span",{className:"px-4 py-2 rounded-lg font-medium bg-yellow-100 text-yellow-800",children:"Request Sent"}):h.receivedRequest?o.jsx("button",{onClick:()=>T("accept_request"),className:"px-4 py-2 rounded-lg font-medium bg-green-500 text-white hover:bg-green-600 transition-colors",children:"Accept Friend Request"}):o.jsx("button",{onClick:()=>T("send_request"),className:"px-4 py-2 rounded-lg font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:"Add Friend"}),$=F=>F?(F.toDate?F.toDate():new Date(F)).toLocaleDateString():"Unknown",M=F=>{i(F),B(!1),A("Profile updated successfully!")},ze=()=>{B(!1)};if(N)return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading profile..."})]})})});if(!n)return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:"😔"}),o.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:"Profile not found"}),o.jsx("p",{className:"claude-text-secondary mb-4",children:"The profile you're looking for doesn't exist or has been removed."}),e&&o.jsx("button",{onClick:e,className:"claude-button-primary",children:"Go Back"})]})})});const se=t&&t.uid===n.userId;return o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e&&o.jsx("button",{onClick:e,className:"mb-4 px-4 py-2 rounded-lg font-medium transition-colors",style:{backgroundColor:"var(--claude-subtle)",color:"var(--claude-secondary-text)"},children:"← Back"}),o.jsx("div",{className:"claude-card p-8 mb-8",children:o.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[o.jsxs("div",{className:"text-center md:text-left",children:[o.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto md:mx-0 mb-4",style:{background:"var(--claude-accent)"},children:k(n.displayName)}),o.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:n.displayName||"Anonymous User"}),o.jsxs("p",{className:"claude-text-secondary text-lg mb-2",children:["@",n.slug]}),n.institution&&o.jsxs("p",{className:"claude-text-secondary",children:["🏫 ",n.institution]})]}),o.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[n.bio&&o.jsx("div",{className:"mb-4",children:o.jsx("p",{className:"claude-text-primary",children:n.bio})}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent-blue)"},children:b.cardCount}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Flashcards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-accent)"},children:b.friendCount}),o.jsx("div",{className:"claude-text-secondary text-sm",children:"Friends"})]})]}),p&&p.total>0&&o.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"var(--claude-subtle)"},children:[o.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--claude-heading)"},children:[p.total," mutual friend",p.total>1?"s":""]}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:[p.profiles.map(F=>F.displayName).join(", "),p.hasMore&&` and ${p.total-p.profiles.length} more`]})]}),o.jsxs("div",{className:"flex gap-3",children:[U(),se&&o.jsx("button",{onClick:()=>B(!0),className:"px-4 py-2 rounded-lg font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors",children:"Edit Profile"})]})]})]})}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:["Public Flashcards (",b.cardCount,")"]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("label",{className:"text-sm font-medium",style:{color:"var(--claude-secondary-text)"},children:"Sort by:"}),o.jsxs("select",{value:D,onChange:F=>q(F.target.value),className:"px-3 py-1 rounded-lg border",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)",color:"var(--claude-primary-text)"},children:[o.jsx("option",{value:"upvotes",children:"Upvotes"}),o.jsx("option",{value:"date",children:"Date Created"})]})]})]}),l.length===0?o.jsxs("div",{className:"text-center py-16",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📚"}),o.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--claude-heading)"},children:"No public flashcards"}),o.jsx("p",{className:"claude-text-secondary",children:se?"You haven't shared any flashcards publicly yet.":`${n.displayName} hasn't shared any flashcards publicly yet.`})]}):o.jsx("div",{className:"grid gap-4",children:l.map(F=>o.jsxs("div",{className:"border rounded-xl p-6 transition-all hover:shadow-md",style:{backgroundColor:"var(--claude-subtle)",borderColor:"var(--claude-border)"},children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--claude-heading)"},children:F.statement||F.question||"Untitled Card"}),F.subject&&o.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 mb-2",children:F.subject}),o.jsxs("div",{className:"text-sm claude-text-secondary",children:["Created ",$(F.createdAt)]})]}),o.jsxs("div",{className:"flex items-center gap-3 text-sm claude-text-secondary",children:[o.jsxs("span",{children:["👍 ",F.upvotes||0]}),o.jsxs("span",{children:["👁️ ",F.viewCount||0]})]})]}),F.tags&&F.tags.length>0&&o.jsx("div",{className:"flex flex-wrap gap-2",children:F.tags.map((ie,K)=>o.jsxs("span",{className:"px-2 py-1 rounded text-xs",style:{backgroundColor:"var(--claude-border)",color:"var(--claude-secondary-text)"},children:["#",ie]},K))})]},F.id))})]}),z&&o.jsx(b3,{profile:n,onSave:M,onCancel:ze})]})})},lE=({onDeckCreated:s,onClose:e,editingDeck:t=null})=>{const{user:n}=Sn(),[i,l]=P.useState({name:"",description:"",subject:"",difficulty:"beginner",tags:"",color:"#635BFF",icon:"📚",isPublic:!1}),[u,h]=P.useState(!1),[m,p]=P.useState(""),[x,b]=P.useState(!1),w=["#635BFF","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"],N=["📚","🧮","🔬","🎓","📖","✏️","🎯","💡","🚀","⚡","🏆","🎨","🔍","💻","🧠","📊"],V=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Spanish","French","Psychology","Economics","Philosophy","Art","Music","Geography","Other"];P.useEffect(()=>{t&&l({name:t.name||"",description:t.description||"",subject:t.subject||"",difficulty:t.difficulty||"beginner",tags:(t.tags||[]).join(", "),color:t.color||"#635BFF",icon:t.icon||"📚",isPublic:t.isPublic||!1})},[t]);const D=(z,B)=>{l(L=>({...L,[z]:B})),p("")},q=async z=>{if(z.preventDefault(),!n){p("Please sign in to create decks");return}if(!i.name.trim()){p("Deck name is required");return}h(!0),p("");try{const B={name:i.name.trim(),description:i.description.trim(),subject:i.subject,difficulty:i.difficulty,tags:i.tags.split(",").map(G=>G.trim()).filter(G=>G),color:i.color,icon:i.icon,isPublic:i.isPublic};if(i.isPublic){const G=await ns.getUserSlug(n.uid);if(!G){p("You must create a profile before making public decks."),h(!1);return}B.authorSlug=G,B.slug=await Ln.generateUniqueSlug(i.name,G)}let L;t?(await Ln.updateDeck(t.id,B),L=t.id):L=await Ln.createDeck(n.uid,B),b(!0),setTimeout(()=>{s&&s(L),e&&e()},1500)}catch(B){console.error("Error saving deck:",B),p(B.message||"Failed to save deck. Please try again.")}finally{h(!1)}};return x?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-12 text-center max-w-lg",children:[o.jsx("div",{className:"text-6xl mb-4",children:"✅"}),o.jsx("h3",{className:"text-2xl font-bold claude-success mb-4",children:t?"Deck Updated!":"Deck Created!"}),o.jsxs("p",{className:"claude-text-secondary",children:["Your deck has been ",t?"updated":"created"," successfully."]})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-4",style:{color:"var(--claude-heading)"},children:t?"✏️ Edit Deck":"📚 Create New Deck"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:t?"Update your deck details":"Organize your flashcards into a themed collection"})]}),o.jsxs("form",{onSubmit:q,className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Basic Information"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block claude-text-secondary font-medium mb-2",children:["Deck Name ",o.jsx("span",{className:"claude-error",children:"*"})]}),o.jsx("input",{type:"text",value:i.name,onChange:z=>D("name",z.target.value),placeholder:"e.g. Calculus I - Derivatives",className:"claude-input w-full",maxLength:100,required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Description"}),o.jsx("textarea",{value:i.description,onChange:z=>D("description",z.target.value),placeholder:"Brief description of what this deck covers...",className:"claude-input w-full h-24 resize-none",maxLength:300}),o.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:[i.description.length,"/300 characters"]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Subject"}),o.jsxs("select",{value:i.subject,onChange:z=>D("subject",z.target.value),className:"claude-input w-full",children:[o.jsx("option",{value:"",children:"Select a subject"}),V.map(z=>o.jsx("option",{value:z,children:z},z))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Difficulty Level"}),o.jsxs("select",{value:i.difficulty,onChange:z=>D("difficulty",z.target.value),className:"claude-input w-full",children:[o.jsx("option",{value:"beginner",children:"Beginner"}),o.jsx("option",{value:"intermediate",children:"Intermediate"}),o.jsx("option",{value:"advanced",children:"Advanced"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-2",children:"Tags"}),o.jsx("input",{type:"text",value:i.tags,onChange:z=>D("tags",z.target.value),placeholder:"e.g. calculus, derivatives, math (comma-separated)",className:"claude-input w-full"}),o.jsx("div",{className:"text-xs claude-text-muted mt-1",children:"Separate tags with commas"})]})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Appearance"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Color"}),o.jsx("div",{className:"flex flex-wrap gap-3",children:w.map(z=>o.jsx("button",{type:"button",onClick:()=>D("color",z),className:`w-12 h-12 rounded-xl border-4 transition-all duration-200 ${i.color===z?"border-white shadow-lg scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:z},title:z},z))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Deck Icon"}),o.jsx("div",{className:"flex flex-wrap gap-3",children:N.map(z=>o.jsx("button",{type:"button",onClick:()=>D("icon",z),className:`w-12 h-12 rounded-xl text-2xl flex items-center justify-center transition-all duration-200 ${i.icon===z?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg scale-110":"claude-card hover:scale-105"}`,title:z,children:z},z))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block claude-text-secondary font-medium mb-3",children:"Preview"}),o.jsxs("div",{className:"claude-card p-6 max-w-xs rounded-2xl shadow-lg",style:{borderLeft:`6px solid ${i.color}`},children:[o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{backgroundColor:i.color,color:"white"},children:i.icon}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold claude-text-primary",children:i.name||"Deck Name"}),o.jsx("p",{className:"text-sm claude-text-muted",children:i.subject||"Subject"})]})]}),i.description&&o.jsx("p",{className:"text-sm claude-text-secondary",children:i.description})]})]})]})]}),o.jsxs("div",{className:"claude-card p-8",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",style:{color:"var(--claude-heading)"},children:"Privacy & Sharing"}),o.jsx("div",{className:"space-y-4",children:o.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:i.isPublic,onChange:z=>D("isPublic",z.target.checked),className:"w-5 h-5 rounded mt-1",style:{accentColor:"var(--claude-accent)",backgroundColor:i.isPublic?"var(--claude-accent)":"var(--claude-surface)",borderColor:"var(--claude-border)"}}),o.jsxs("div",{children:[o.jsx("span",{className:"claude-text-secondary font-medium",children:"Make this deck public"}),o.jsx("p",{className:"text-sm claude-text-muted mt-1",children:"Public decks can be discovered and imported by other users. You need a profile to create public decks."})]})]})})]}),m&&o.jsx("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:o.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[o.jsx("span",{children:"❌"}),o.jsx("span",{children:m})]})}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e&&o.jsx("button",{type:"button",onClick:e,className:"claude-button-secondary",children:"Cancel"}),o.jsx("button",{type:"submit",disabled:u||!i.name.trim(),className:"claude-button-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:u||!i.name.trim()?"var(--claude-muted)":"var(--claude-accent)"},children:u?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t?"Updating...":"Creating..."]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:t?"✏️":"📚"}),t?"Update Deck":"Create Deck"]})})]})]})]})})},w3=({onCreateDeck:s,onEditDeck:e,onSelectDeck:t})=>{const{user:n}=Sn(),[i,l]=P.useState([]),[u,h]=P.useState(!0),[m,p]=P.useState(""),[x,b]=P.useState(""),[w,N]=P.useState("all");P.useEffect(()=>{n&&V()},[n]);const V=async()=>{try{h(!0),p("");const z=await Ln.getUserDecks(n.uid);l(z)}catch(z){console.error("Error loading decks:",z),p("Failed to load decks. Please try again.")}finally{h(!1)}},D=async(z,B)=>{if(window.confirm(`Are you sure you want to delete "${B}"? This action cannot be undone.`))try{await Ln.deleteDeck(z),l(i.filter(L=>L.id!==z))}catch(L){console.error("Error deleting deck:",L),p("Failed to delete deck. Please try again.")}},q=i.filter(z=>{const B=!x||z.name.toLowerCase().includes(x.toLowerCase())||z.description.toLowerCase().includes(x.toLowerCase())||z.subject&&z.subject.toLowerCase().includes(x.toLowerCase()),L=w==="all"||w==="public"&&z.isPublic||w==="private"&&!z.isPublic;return B&&L});return u?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading your decks..."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:"📚 My Decks"}),o.jsx("p",{className:"claude-text-secondary",children:"Organize and manage your flashcard collections"})]}),o.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary mt-4 md:mt-0 flex items-center gap-2",children:[o.jsx("span",{children:"➕"}),"Create New Deck"]})]}),o.jsxs("div",{className:"claude-card p-6 mb-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[o.jsx("div",{className:"flex-1",children:o.jsx("input",{type:"text",value:x,onChange:z=>b(z.target.value),placeholder:"Search decks by name, subject, or description...",className:"claude-input w-full"})}),o.jsx("div",{className:"md:w-48",children:o.jsxs("select",{value:w,onChange:z=>N(z.target.value),className:"claude-input w-full",children:[o.jsx("option",{value:"all",children:"All Decks"}),o.jsx("option",{value:"private",children:"Private Only"}),o.jsx("option",{value:"public",children:"Public Only"})]})})]}),o.jsxs("div",{className:"flex flex-wrap gap-6 mt-4 pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:i.length}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Total Decks"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:i.reduce((z,B)=>z+(B.cardCount||0),0)}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Total Cards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--claude-heading)"},children:i.filter(z=>z.isPublic).length}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Public Decks"})]})]})]}),m&&o.jsx("div",{className:"p-4 rounded-2xl mb-6",style:{backgroundColor:"rgba(255, 99, 99, 0.1)",border:"1px solid var(--claude-error)"},children:o.jsxs("div",{className:"flex items-center gap-2 claude-error",children:[o.jsx("span",{children:"❌"}),o.jsx("span",{children:m})]})}),q.length===0?o.jsxs("div",{className:"claude-card p-12 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:"📚"}),o.jsx("h3",{className:"text-xl font-bold mb-2",style:{color:"var(--claude-heading)"},children:x||w!=="all"?"No matching decks found":"No decks yet"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:x||w!=="all"?"Try adjusting your search or filter criteria":"Create your first deck to start organizing your flashcards"}),!x&&w==="all"&&o.jsxs("button",{onClick:()=>s&&s(),className:"claude-button-primary flex items-center gap-2 mx-auto",children:[o.jsx("span",{children:"➕"}),"Create Your First Deck"]})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:q.map(z=>o.jsx(T3,{deck:z,onEdit:()=>e&&e(z),onDelete:()=>D(z.id,z.name),onSelect:()=>t&&t(z)},z.id))})]})})},T3=({deck:s,onEdit:e,onDelete:t,onSelect:n})=>{const i=l=>l?(l.toDate?l.toDate():new Date(l)).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"Unknown";return o.jsxs("div",{className:"claude-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer relative group",style:{borderLeft:`6px solid ${s.color||"#635BFF"}`},onClick:()=>n&&n(),children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl text-white",style:{backgroundColor:s.color||"#635BFF"},children:s.icon||"📚"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"font-bold claude-text-primary truncate",children:s.name}),o.jsx("p",{className:"text-sm claude-text-muted",children:s.subject||"No subject"})]})]}),o.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:l=>{l.stopPropagation(),e()},className:"p-2 rounded-lg hover:bg-gray-100 text-gray-600 hover:text-gray-800",title:"Edit deck",children:"✏️"}),!s.isDefault&&o.jsx("button",{onClick:l=>{l.stopPropagation(),t()},className:"p-2 rounded-lg hover:bg-red-100 text-red-600 hover:text-red-800",title:"Delete deck",children:"🗑️"})]})})]}),s.description&&o.jsx("p",{className:"text-sm claude-text-secondary mb-4 line-clamp-2",children:s.description}),o.jsxs("div",{className:"flex items-center justify-between text-sm claude-text-muted mb-4",children:[o.jsxs("span",{children:[s.cardCount||0," cards"]}),o.jsx("span",{children:s.difficulty||"Mixed"})]}),s.tags&&s.tags.length>0&&o.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[s.tags.slice(0,3).map((l,u)=>o.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${s.color||"#635BFF"}20`,color:s.color||"#635BFF"},children:l},u)),s.tags.length>3&&o.jsxs("span",{className:"px-2 py-1 rounded-full text-xs claude-text-muted",children:["+",s.tags.length-3]})]}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",style:{borderColor:"var(--claude-border)"},children:[o.jsxs("div",{className:"flex items-center gap-2",children:[s.isPublic&&o.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 text-green-700",children:"Public"}),s.isDefault&&o.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700",children:"Default"})]}),o.jsx("span",{className:"text-xs claude-text-muted",children:i(s.updatedAt||s.createdAt)})]})]})},E3=({onClose:s})=>{const{user:e}=Sn(),[t,n]=P.useState(null),[i,l]=P.useState(null),[u,h]=P.useState("week"),[m,p]=P.useState(!0),[x,b]=P.useState("overview");P.useEffect(()=>{e&&w()},[e,u]);const w=async()=>{try{p(!0);const[D,q]=await Promise.all([rd.getUserAnalytics(e.uid),rd.getUserInsights(e.uid,u)]);n(D),l(q)}catch(D){console.error("Error loading analytics:",D)}finally{p(!1)}},N=D=>{const q=Math.floor(D/3600),z=Math.floor(D%3600/60);return q>0?`${q}h ${z}m`:`${z}m`},V=D=>`${Math.round(D*100)}%`;return m?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading your analytics..."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:"📊 Learning Analytics"}),o.jsx("p",{className:"claude-text-secondary",children:"Track your progress, identify patterns, and optimize your learning"})]}),o.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[o.jsxs("select",{value:u,onChange:D=>h(D.target.value),className:"claude-input",children:[o.jsx("option",{value:"day",children:"Today"}),o.jsx("option",{value:"week",children:"This Week"}),o.jsx("option",{value:"month",children:"This Month"})]}),s&&o.jsx("button",{onClick:s,className:"claude-button-secondary",children:"✕ Close"})]})]}),o.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:"📈 Overview",icon:"📈"},{id:"performance",label:"🎯 Performance",icon:"🎯"},{id:"insights",label:"💡 Insights",icon:"💡"},{id:"progress",label:"📚 Progress",icon:"📚"}].map(D=>o.jsxs("button",{onClick:()=>b(D.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===D.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[o.jsx("span",{className:"mr-2",children:D.icon}),o.jsx("span",{className:"hidden sm:inline",children:D.label.replace(/^.+\s/,"")})]},D.id))}),x==="overview"&&o.jsx(S3,{analytics:t,insights:i,formatTime:N,formatPercentage:V}),x==="performance"&&o.jsx(N3,{analytics:t,insights:i,formatPercentage:V}),x==="insights"&&o.jsx(A3,{insights:i,formatTime:N}),x==="progress"&&o.jsx(I3,{analytics:t,insights:i,formatPercentage:V})]})})},S3=({analytics:s,insights:e,formatTime:t,formatPercentage:n})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(xf,{title:"Total Study Time",value:t(s?.totalStudyTime||0),icon:"⏱️",color:"blue",trend:e?.studyTimeTrend}),o.jsx(xf,{title:"Study Sessions",value:s?.totalSessions||0,icon:"📚",color:"green"}),o.jsx(xf,{title:"Overall Accuracy",value:n(s?.overallAccuracy||0),icon:"🎯",color:"purple",trend:e?.accuracyTrend}),o.jsx(xf,{title:"Study Streak",value:`${s?.studyStreak||0} days`,icon:"🔥",color:"orange"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📅 Recent Activity"}),o.jsxs("div",{className:"space-y-4",children:[s?.deckStats&&Object.entries(s.deckStats).slice(0,5).map(([i,l])=>o.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",children:["Deck ",i.slice(-6)]}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[l.sessions," sessions"]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"font-bold text-green-600",children:n(l.accuracy)}),o.jsx("div",{className:"text-sm claude-text-muted",children:t(l.studyTime)})]})]},i)),(!s?.deckStats||Object.keys(s.deckStats).length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No study activity yet. Start studying to see your progress!"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📈 Performance Trends"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(cE,{label:"Accuracy Trend",value:e?.accuracyTrend||0,description:"How your accuracy has changed recently"}),o.jsx(cE,{label:"Study Time Trend",value:e?.studyTimeTrend||0,description:"How your study duration has changed"}),o.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[o.jsx("div",{className:"font-medium text-blue-800",children:"Mastery Progress"}),o.jsxs("div",{className:"text-sm text-blue-600 mb-2",children:["Overall understanding: ",n(e?.masteryProgress||0)]}),o.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:o.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(e?.masteryProgress||0)*100}%`}})})]})]})]})]})]}),N3=({analytics:s,insights:e,formatPercentage:t})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📊 Subject Performance"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s?.subjectStats&&Object.entries(s.subjectStats).map(([n,i])=>o.jsxs("div",{className:"p-4 border rounded-lg",children:[o.jsx("div",{className:"font-medium mb-2",children:n||"General"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm claude-text-muted",children:"Accuracy:"}),o.jsx("span",{className:"font-medium",children:t(i.accuracy)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm claude-text-muted",children:"Mastery:"}),o.jsx("span",{className:"font-medium",children:t(i.masteryLevel||0)})]}),o.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:o.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${i.accuracy*100}%`}})})]})]},n)),(!s?.subjectStats||Object.keys(s.subjectStats).length===0)&&o.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"No subject data available yet. Study more to see subject breakdown!"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"⚠️ Cards Needing Attention"}),o.jsx("div",{className:"space-y-4",children:e?.strugglingCards&&e.strugglingCards.length>0?e.strugglingCards.map((n,i)=>o.jsxs("div",{className:"flex items-center justify-between p-4 border-l-4 border-red-500 bg-red-50",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium",children:["Card ",n.cardId.slice(-6)]}),o.jsxs("div",{className:"text-sm text-red-600",children:[n.totalReviews," attempts"]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-red-700 font-bold",children:t(n.accuracy)}),o.jsx("div",{className:"text-sm text-red-600",children:"accuracy"})]})]},n.cardId)):o.jsx("div",{className:"text-center py-8 text-green-600",children:"🎉 Great job! No cards need special attention right now."})})]})]}),A3=({insights:s,formatTime:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"💡 Personalized Recommendations"}),o.jsx("div",{className:"space-y-4",children:s?.recommendations&&s.recommendations.length>0?s.recommendations.map((t,n)=>o.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${t.priority==="high"?"border-red-500 bg-red-50":t.priority==="medium"?"border-yellow-500 bg-yellow-50":"border-blue-500 bg-blue-50"}`,children:[o.jsx("div",{className:`font-medium ${t.priority==="high"?"text-red-800":t.priority==="medium"?"text-yellow-800":"text-blue-800"}`,children:t.title}),o.jsx("div",{className:`text-sm mt-1 ${t.priority==="high"?"text-red-600":t.priority==="medium"?"text-yellow-600":"text-blue-600"}`,children:t.description})]},n)):o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"Keep studying to get personalized recommendations!"})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"⏰ Optimal Study Time"}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl mb-2",children:s?.optimalStudyTime==="morning"?"🌅":s?.optimalStudyTime==="afternoon"?"☀️":"🌙"}),o.jsx("div",{className:"text-lg font-medium capitalize",children:s?.optimalStudyTime||"Not enough data"}),o.jsx("div",{className:"text-sm claude-text-muted mt-2",children:"You perform best during this time"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📊 Consistency Score"}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"text-3xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:[Math.round((s?.consistencyScore||0)*100),"%"]}),o.jsx("div",{className:"text-sm claude-text-muted",children:"How consistent your study sessions are"}),o.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-3",children:o.jsx("div",{className:"claude-gradient h-3 rounded-full transition-all duration-300",style:{width:`${(s?.consistencyScore||0)*100}%`}})})]})]})]})]}),I3=({analytics:s,insights:e,formatPercentage:t})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📈 Learning Progress"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-success)"},children:t(e?.masteryProgress||0)}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Overall Mastery"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-accent)"},children:s?.studyStreak||0}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Day Streak"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:"var(--claude-warning)"},children:s?.longestStreak||0}),o.jsx("div",{className:"text-sm claude-text-muted",children:"Longest Streak"})]})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"🌟 Your Strongest Subjects"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e?.strongSubjects&&e.strongSubjects.length>0?e.strongSubjects.map((n,i)=>o.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border-2 border-green-200",children:[o.jsx("div",{className:"text-2xl mb-2",children:"🏆"}),o.jsx("div",{className:"font-medium text-green-800",children:n}),o.jsx("div",{className:"text-sm text-green-600",children:"Strong performance"})]},n)):o.jsx("div",{className:"col-span-full text-center py-8 claude-text-muted",children:"Keep studying to identify your strongest subjects!"})})]})]}),xf=({title:s,value:e,icon:t,color:n,trend:i})=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl relative overflow-hidden",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"text-2xl",children:t}),i!==void 0&&o.jsxs("div",{className:`text-sm font-medium ${i>0?"text-green-600":i<0?"text-red-600":"text-gray-600"}`,children:[i>0?"↗️":i<0?"↘️":"→"," ",Math.abs(i*100).toFixed(1),"%"]})]}),o.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),o.jsx("div",{className:"text-sm claude-text-muted",children:s})]}),cE=({label:s,value:e,description:t})=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:s}),o.jsx("div",{className:"text-sm claude-text-muted",children:t})]}),o.jsxs("div",{className:`text-right ${e>0?"text-green-600":e<0?"text-red-600":"text-gray-600"}`,children:[o.jsxs("div",{className:"font-bold",children:[e>0?"↗️":e<0?"↘️":"→"," ",Math.abs(e*100).toFixed(1),"%"]}),o.jsx("div",{className:"text-sm",children:e>0?"Improving":e<0?"Declining":"Stable"})]})]});class _n{static async initializeSession(e=null){try{const t=this.generateSessionId(),n={sessionId:t,userId:e||null,startTime:ke(),isActive:!0,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},referrer:document.referrer||null,initialUrl:window.location.href,pageViews:0,clicks:0,timeSpent:0,pagesVisited:[],actionsPerformed:[],isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isTablet:/iPad/i.test(navigator.userAgent),platform:navigator.platform};if(await Er(xe(te,"websiteSessions",t),n),localStorage.setItem("website_session_id",t),dn)try{xr(dn,"session_start",{session_id:t,user_id:e,is_mobile:n.isMobile})}catch(i){console.warn("Firebase Analytics not available:",i)}return this.setupVisibilityTracking(t),this.setupUnloadTracking(t),t}catch(t){throw console.error("Error initializing session:",t),t}}static async trackPageView(e,t=null,n=null){try{const i=t||localStorage.getItem("website_session_id");if(!i)return;const l={sessionId:i,userId:n||null,page:e,url:window.location.href,timestamp:ke(),referrer:document.referrer||null,timeOnPage:0,scrollDepth:0,interactions:0},u=await Jn(Ne(te,"pageViews"),l),h=xe(te,"websiteSessions",i);if(await Mt(h,{pageViews:Pf(1),pagesVisited:mc(e),lastPageView:ke(),currentPage:e}),dn)try{xr(dn,"page_view",{page_title:document.title,page_location:window.location.href,session_id:i,user_id:n})}catch(m){console.warn("Firebase Analytics not available:",m)}return this.startPageTimeTracking(u.id,i),u.id}catch(i){console.error("Error tracking page view:",i)}}static async trackInteraction(e,t=null,n=null){try{const i=t||localStorage.getItem("website_session_id");if(!i)return;const l={sessionId:i,userId:n||null,timestamp:ke(),page:window.location.pathname,...e};await Jn(Ne(te,"interactions"),l);const u=xe(te,"websiteSessions",i);if(await Mt(u,{clicks:Pf(1),actionsPerformed:mc(e.action||"unknown"),lastActivity:ke()}),dn)try{xr(dn,"user_interaction",{action:e.action,element:e.element,session_id:i,user_id:n})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(i){console.error("Error tracking interaction:",i)}}static async trackScrollDepth(e,t=null){try{const n=t||localStorage.getItem("website_session_id");if(!n)return;const i=Pe(Ne(te,"pageViews"),qe("sessionId","==",n),Gt("timestamp","desc"),Ht(1)),l=await Fe(i);if(!l.empty){const u=l.docs[0];await Mt(u.ref,{scrollDepth:Math.max(e,u.data().scrollDepth||0)})}}catch(n){if(n.message&&(n.message.includes("requires an index")||n.message.includes("Missing or insufficient permissions")||n.message.includes("permission-denied")))return;console.error("Error tracking scroll depth:",n)}}static async trackFeatureUsage(e,t,n={},i=null){try{const l=localStorage.getItem("website_session_id"),u={sessionId:l,userId:i||null,feature:e,action:t,metadata:n,timestamp:ke(),page:window.location.pathname};if(await Jn(Ne(te,"featureUsage"),u),dn)try{xr(dn,"feature_usage",{feature_name:e,action_type:t,session_id:l,user_id:i})}catch(h){console.warn("Firebase Analytics not available:",h)}}catch(l){console.error("Error tracking feature usage:",l)}}static async trackConversion(e,t=null,n=null){try{const i=localStorage.getItem("website_session_id"),l={sessionId:i,userId:n||null,conversionType:e,value:t,timestamp:ke(),page:window.location.pathname};if(await Jn(Ne(te,"conversions"),l),dn)try{xr(dn,"conversion",{conversion_type:e,conversion_value:t,session_id:i,user_id:n})}catch(u){console.warn("Firebase Analytics not available:",u)}}catch(i){console.error("Error tracking conversion:",i)}}static async trackUserFlow(e,t,n="navigation",i=null){try{const u={sessionId:localStorage.getItem("website_session_id"),userId:i||null,fromPage:e,toPage:t,action:n,timestamp:ke()};await Jn(Ne(te,"userFlows"),u)}catch(l){console.error("Error tracking user flow:",l)}}static async trackClick(e,t={},n=null){try{await this.trackInteraction({action:"click",element:e,context:t,elementText:t.text||"",elementId:t.id||"",elementClass:t.className||""},null,n)}catch(i){console.error("Error tracking click:",i)}}static async trackFormInteraction(e,t,n=null,i=null){try{await this.trackInteraction({action:"form_interaction",element:"form",formName:e,formAction:t,field:n},null,i)}catch(l){console.error("Error tracking form interaction:",l)}}static startPageTimeTracking(e,t){window.pageTimeTracking||(window.pageTimeTracking={}),window.pageTimeTracking[e]={startTime:Date.now(),sessionId:t,pageViewId:e}}static async endPageTimeTracking(e){try{if(!window.pageTimeTracking||!window.pageTimeTracking[e])return;const t=window.pageTimeTracking[e],n=Math.round((Date.now()-t.startTime)/1e3),i=xe(te,"pageViews",e);await Mt(i,{timeOnPage:n});const l=xe(te,"websiteSessions",t.sessionId);await Mt(l,{timeSpent:Pf(n)}),delete window.pageTimeTracking[e]}catch(t){console.error("Error ending page time tracking:",t)}}static async endSession(e=null){try{const t=e||localStorage.getItem("website_session_id");if(!t)return;if(window.pageTimeTracking)for(const i of Object.keys(window.pageTimeTracking))await this.endPageTimeTracking(i);const n=xe(te,"websiteSessions",t);if(await Mt(n,{endTime:ke(),isActive:!1}),localStorage.removeItem("website_session_id"),dn)try{xr(dn,"session_end",{session_id:t})}catch(i){console.warn("Firebase Analytics not available:",i)}}catch(t){console.error("Error ending session:",t)}}static async getAnalyticsSummary(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),i=Pe(Ne(te,"websiteSessions"),qe("startTime",">=",n)),u=(await Fe(i)).docs.map(R=>({id:R.id,...R.data()})),h=Pe(Ne(te,"pageViews"),qe("timestamp",">=",n)),p=(await Fe(h)).docs.map(R=>({id:R.id,...R.data()})),x=Pe(Ne(te,"interactions"),qe("timestamp",">=",n)),w=(await Fe(x)).docs.map(R=>({id:R.id,...R.data()})),N=new Set(u.filter(R=>R.userId).map(R=>R.userId)).size,V=u.length,D=p.length,q=w.length,z=u.reduce((R,C)=>R+(C.timeSpent||0),0)/u.length,B=D/V,L={};p.forEach(R=>{const C=R.page||"unknown";L[C]||(L[C]={views:0,totalTime:0,interactions:0}),L[C].views++,L[C].totalTime+=R.timeOnPage||0}),w.forEach(R=>{const C=R.page||"unknown";L[C]&&L[C].interactions++});const G=Object.entries(L).map(([R,C])=>({page:R,...C,avgTimeOnPage:C.totalTime/C.views})).sort((R,C)=>C.views-R.views).slice(0,10),H={mobile:u.filter(R=>R.isMobile).length,tablet:u.filter(R=>R.isTablet).length,desktop:u.filter(R=>!R.isMobile&&!R.isTablet).length};return{summary:{uniqueUsers:N,totalSessions:V,totalPageViews:D,totalInteractions:q,avgSessionDuration:Math.round(z),avgPagesPerSession:Math.round(B*10)/10},popularPages:G,deviceStats:H,sessions:u,timeframe:e}}catch(t){throw console.error("Error getting analytics summary:",t),t}}static async getUserJourneyAnalytics(e="week"){try{const t=e==="week"?7:e==="month"?30:1,n=new Date(Date.now()-t*24*60*60*1e3),i=Pe(Ne(te,"userFlows"),qe("timestamp",">=",n)),u=(await Fe(i)).docs.map(b=>({id:b.id,...b.data()})),h={};u.forEach(b=>{const w=`${b.fromPage} → ${b.toPage}`;h[w]=(h[w]||0)+1});const m=Object.entries(h).map(([b,w])=>({path:b,count:w})).sort((b,w)=>w.count-b.count).slice(0,10),p={},x={};return u.forEach(b=>{p[b.fromPage]=(p[b.fromPage]||0)+1,x[b.toPage]=(x[b.toPage]||0)+1}),{commonPaths:m,entryPoints:Object.entries(p).map(([b,w])=>({page:b,count:w})).sort((b,w)=>w.count-b.count).slice(0,5),exitPoints:Object.entries(x).map(([b,w])=>({page:b,count:w})).sort((b,w)=>w.count-b.count).slice(0,5)}}catch(t){throw console.error("Error getting user journey analytics:",t),t}}static generateSessionId(){return`ws_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static setupVisibilityTracking(e){let t=!document.hidden,n=Date.now();const i=()=>{const l=Date.now();if(document.hidden&&t){const u=l-n;this.trackInteraction({action:"page_hidden",element:"page",timeVisible:u},e),t=!1}else!document.hidden&&!t&&(this.trackInteraction({action:"page_visible",element:"page"},e),t=!0,n=l)};document.addEventListener("visibilitychange",i)}static setupUnloadTracking(e){const t=()=>{this.endSession(e)};window.addEventListener("beforeunload",t)}static setupScrollTracking(){let e=0,t;const n=()=>{const i=window.pageYOffset||document.documentElement.scrollTop,l=document.documentElement.scrollHeight-window.innerHeight,u=l>0?i/l*100:0;e=Math.max(e,u),clearTimeout(t),t=setTimeout(()=>{this.trackScrollDepth(Math.round(e))},1e3)};window.addEventListener("scroll",n,{passive:!0})}static setupAutoClickTracking(){document.addEventListener("click",e=>{const t=e.target.closest("[data-track]");if(t){const n={action:t.getAttribute("data-track"),text:t.textContent.trim(),id:t.id,className:t.className};this.trackClick(t.tagName.toLowerCase(),n)}})}static initializeAutoTracking(e=null){this.initializeSession(e),this.setupScrollTracking(),this.setupAutoClickTracking(),setTimeout(()=>{this.trackPageView(window.location.pathname,null,e)},100)}}const j3=({onClose:s})=>{const{user:e}=Sn(),[t,n]=P.useState(null),[i,l]=P.useState(null),[u,h]=P.useState("week"),[m,p]=P.useState(!0),[x,b]=P.useState("overview"),[w,N]=P.useState({activeSessions:0,currentPageViews:0,recentInteractions:[]});P.useEffect(()=>{if(e){V();const z=setInterval(V,3e4);return()=>clearInterval(z)}},[e,u]);const V=async()=>{try{p(!0);const[z,B]=await Promise.all([_n.getAnalyticsSummary(u),_n.getUserJourneyAnalytics(u)]);n(z),l(B);const L=z.sessions.filter(H=>H.isActive).length,G=z.sessions.flatMap(H=>H.actionsPerformed||[]).slice(-10);N({activeSessions:L,currentPageViews:z.summary.totalPageViews,recentInteractions:G})}catch(z){console.error("Error loading analytics:",z)}finally{p(!1)}},D=z=>{const B=Math.floor(z/3600),L=Math.floor(z%3600/60),G=z%60;return B>0?`${B}h ${L}m ${G}s`:L>0?`${L}m ${G}s`:`${G}s`},q=z=>`${Math.round(z*100)}%`;return m?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Loading website analytics..."})]})}):o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2",style:{color:"var(--claude-heading)"},children:"🚀 Website Analytics"}),o.jsx("p",{className:"claude-text-secondary",children:"Track growth, engagement, and user behavior across your platform"})]}),o.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[o.jsxs("select",{value:u,onChange:z=>h(z.target.value),className:"claude-input",children:[o.jsx("option",{value:"day",children:"Today"}),o.jsx("option",{value:"week",children:"This Week"}),o.jsx("option",{value:"month",children:"This Month"})]}),o.jsx("button",{onClick:V,className:"claude-button-secondary",children:"🔄 Refresh"}),s&&o.jsx("button",{onClick:s,className:"claude-button-secondary",children:"✕ Close"})]})]}),o.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),o.jsx("span",{className:"font-medium",children:"Live Now"})]}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[w.activeSessions," active sessions • ",w.currentPageViews," page views today"]})]}),o.jsxs("div",{className:"text-xs claude-text-muted",children:["Last updated: ",new Date().toLocaleTimeString()]})]})}),o.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:"📊 Overview",icon:"📊"},{id:"traffic",label:"🌐 Traffic",icon:"🌐"},{id:"engagement",label:"👆 Engagement",icon:"👆"},{id:"journeys",label:"🗺️ User Journeys",icon:"🗺️"},{id:"realtime",label:"⚡ Real-time",icon:"⚡"}].map(z=>o.jsxs("button",{onClick:()=>b(z.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${x===z.id?"claude-gradient text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[o.jsx("span",{className:"mr-2",children:z.icon}),o.jsx("span",{className:"hidden sm:inline",children:z.label.replace(/^.+\s/,"")})]},z.id))}),x==="overview"&&o.jsx(C3,{analytics:t,formatDuration:D,formatPercentage:q}),x==="traffic"&&o.jsx(R3,{analytics:t,formatDuration:D}),x==="engagement"&&o.jsx(k3,{analytics:t,formatDuration:D}),x==="journeys"&&o.jsx(D3,{userJourney:i}),x==="realtime"&&o.jsx(P3,{realTimeData:w,analytics:t})]})})},C3=({analytics:s,formatDuration:e,formatPercentage:t})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(Ks,{title:"Unique Users",value:s?.summary?.uniqueUsers||0,icon:"👥",color:"blue",description:"Distinct users this period"}),o.jsx(Ks,{title:"Total Sessions",value:s?.summary?.totalSessions||0,icon:"🎯",color:"green",description:"User sessions tracked"}),o.jsx(Ks,{title:"Page Views",value:s?.summary?.totalPageViews||0,icon:"👀",color:"purple",description:"Total pages visited"}),o.jsx(Ks,{title:"Avg Session Duration",value:e(s?.summary?.avgSessionDuration||0),icon:"⏱️",color:"orange",description:"Average time per session"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📈 Most Popular Pages"}),o.jsxs("div",{className:"space-y-4",children:[s?.popularPages?.slice(0,8).map((n,i)=>o.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-bold text-blue-800",children:i+1}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:n.page}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[n.views," views"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"font-bold text-blue-600",children:e(n.avgTimeOnPage||0)}),o.jsx("div",{className:"text-sm claude-text-muted",children:"avg time"})]})]},n.page)),(!s?.popularPages||s.popularPages.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No page data available yet"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📱 Device Breakdown"}),o.jsx("div",{className:"space-y-4",children:s?.deviceStats&&Object.entries(s.deviceStats).map(([n,i])=>{const l=Object.values(s.deviceStats).reduce((m,p)=>m+p,0),u=l>0?i/l*100:0,h=n==="mobile"?"📱":n==="tablet"?"📚":"💻";return o.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:h}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium capitalize",children:n}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[i," sessions"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"font-bold text-green-600",children:[Math.round(u),"%"]}),o.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2 mt-1",children:o.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})]})]},n)})})]})]})]}),R3=({analytics:s,formatDuration:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsx(Ks,{title:"Pages per Session",value:s?.summary?.avgPagesPerSession||0,icon:"📄",color:"blue",description:"Average pages viewed per session"}),o.jsx(Ks,{title:"Total Interactions",value:s?.summary?.totalInteractions||0,icon:"🖱️",color:"green",description:"Total clicks and interactions"}),o.jsx(Ks,{title:"Bounce Rate",value:`${Math.round(((s?.summary?.totalSessions-s?.summary?.totalPageViews)/s?.summary?.totalSessions||0)*100)}%`,icon:"⚡",color:"orange",description:"Single page sessions"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"📊 Detailed Page Analytics"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"border-b",children:[o.jsx("th",{className:"text-left py-3 px-4 font-medium claude-text-secondary",children:"Page"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Views"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Avg Time"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Interactions"}),o.jsx("th",{className:"text-right py-3 px-4 font-medium claude-text-secondary",children:"Engagement"})]})}),o.jsx("tbody",{children:s?.popularPages?.map((t,n)=>{const i=t.views>0?t.interactions/t.views*100:0;return o.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[o.jsx("td",{className:"py-3 px-4",children:o.jsx("div",{className:"font-medium",children:t.page})}),o.jsx("td",{className:"text-right py-3 px-4 font-medium",children:t.views}),o.jsx("td",{className:"text-right py-3 px-4",children:e(t.avgTimeOnPage||0)}),o.jsx("td",{className:"text-right py-3 px-4",children:t.interactions}),o.jsx("td",{className:"text-right py-3 px-4",children:o.jsxs("span",{className:`font-medium ${i>50?"text-green-600":i>20?"text-yellow-600":"text-red-600"}`,children:[Math.round(i),"%"]})})]},t.page)})})]})})]})]}),k3=({analytics:s,formatDuration:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(Ks,{title:"Click Rate",value:`${Math.round((s?.summary?.totalInteractions/s?.summary?.totalPageViews||0)*100)}%`,icon:"👆",color:"blue",description:"Interactions per page view"}),o.jsx(Ks,{title:"Session Depth",value:s?.summary?.avgPagesPerSession||0,icon:"📚",color:"green",description:"Pages explored per session"}),o.jsx(Ks,{title:"Return Rate",value:`${Math.round((s?.summary?.uniqueUsers/s?.summary?.totalSessions||0)*100)}%`,icon:"🔄",color:"purple",description:"Users who return"}),o.jsx(Ks,{title:"Engagement Score",value:Math.round((s?.summary?.avgSessionDuration||0)/60*(s?.summary?.avgPagesPerSession||0)),icon:"⭐",color:"orange",description:"Overall engagement rating"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"🔥 Most Engaging Content"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s?.popularPages?.slice(0,6).map((t,n)=>{const i=(t.avgTimeOnPage||0)*(t.interactions||0)/100;return o.jsxs("div",{className:"p-4 border rounded-lg hover:border-blue-500 transition-colors",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsx("h4",{className:"font-medium",children:t.page}),o.jsxs("span",{className:"text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["#",n+1]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Time on Page"}),o.jsx("div",{className:"font-medium",children:e(t.avgTimeOnPage||0)})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Interactions"}),o.jsx("div",{className:"font-medium",children:t.interactions||0})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Views"}),o.jsx("div",{className:"font-medium",children:t.views})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Engagement"}),o.jsx("div",{className:"font-medium text-green-600",children:Math.round(i)})]})]})]},t.page)})})]})]}),D3=({userJourney:s})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"🗺️ Most Common User Paths"}),o.jsxs("div",{className:"space-y-4",children:[s?.commonPaths?.slice(0,8).map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-800",children:t+1}),o.jsx("div",{className:"font-mono text-sm",children:e.path})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"font-bold text-purple-600",children:e.count}),o.jsx("div",{className:"text-sm claude-text-muted",children:"transitions"})]})]},e.path)),(!s?.commonPaths||s.commonPaths.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No user journey data available yet"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"🚪 Top Entry Points"}),o.jsxs("div",{className:"space-y-3",children:[s?.entryPoints?.map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[o.jsx("div",{className:"font-medium",children:e.page}),o.jsx("div",{className:"text-green-700 font-bold",children:e.count})]},e.page)),(!s?.entryPoints||s.entryPoints.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No entry data"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"🚪 Top Exit Points"}),o.jsxs("div",{className:"space-y-3",children:[s?.exitPoints?.map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[o.jsx("div",{className:"font-medium",children:e.page}),o.jsx("div",{className:"text-red-700 font-bold",children:e.count})]},e.page)),(!s?.exitPoints||s.exitPoints.length===0)&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No exit data"})]})]})]})]}),P3=({realTimeData:s,analytics:e})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full animate-pulse"}),o.jsx("h3",{className:"font-bold text-green-800",children:"Active Now"})]}),o.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:s.activeSessions}),o.jsx("div",{className:"text-sm text-green-700",children:"Active sessions"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("span",{className:"text-2xl",children:"👀"}),o.jsx("h3",{className:"font-bold text-blue-800",children:"Page Views"})]}),o.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:s.currentPageViews}),o.jsx("div",{className:"text-sm text-blue-700",children:"Total today"})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("span",{className:"text-2xl",children:"🖱️"}),o.jsx("h3",{className:"font-bold text-purple-800",children:"Interactions"})]}),o.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:e?.summary?.totalInteractions||0}),o.jsx("div",{className:"text-sm text-purple-700",children:"Total clicks"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"⚡ Recent Activity"}),o.jsxs("div",{className:"space-y-3",children:[s.recentInteractions.slice(0,10).map((t,n)=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),o.jsx("span",{className:"font-medium",children:t})]}),o.jsx("span",{className:"text-sm claude-text-muted",children:"Just now"})]},n)),s.recentInteractions.length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No recent interactions"})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"var(--claude-heading)"},children:"👥 Active Sessions Detail"}),o.jsxs("div",{className:"space-y-4",children:[e?.sessions?.filter(t=>t.isActive).slice(0,5).map((t,n)=>o.jsxs("div",{className:"p-4 border rounded-lg",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{className:"font-medium",children:["Session ",t.sessionId.slice(-6)]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),o.jsx("span",{className:"text-sm text-green-600",children:"Active"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Device"}),o.jsx("div",{children:t.isMobile?"📱 Mobile":t.isTablet?"📚 Tablet":"💻 Desktop"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Page Views"}),o.jsx("div",{children:t.pageViews||0})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Duration"}),o.jsxs("div",{children:[Math.round((t.timeSpent||0)/60),"m"]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"claude-text-muted",children:"Current Page"}),o.jsx("div",{className:"truncate",children:t.currentPage||"Unknown"})]})]})]},t.sessionId)),e?.sessions?.filter(t=>t.isActive).length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No active sessions"})]})]})]}),Ks=({title:s,value:e,icon:t,color:n,description:i})=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("div",{className:"flex items-center justify-between mb-4",children:o.jsx("div",{className:"text-2xl",children:t})}),o.jsx("div",{className:"text-2xl font-bold mb-1",style:{color:`var(--claude-${n||"accent"})`},children:e}),o.jsx("div",{className:"text-sm font-medium mb-1",children:s}),i&&o.jsx("div",{className:"text-xs claude-text-muted",children:i})]});class Hs{static ADMIN_EMAILS=["three.dash.sided@gmail.com"];static isAdmin(e){return!e||!e.email?!1:this.ADMIN_EMAILS.includes(e.email)}static async getAdminStatus(e){try{const n=(await At(xe(te,"users",e))).data();return{isAdmin:n?.isAdmin||!1,adminLevel:n?.adminLevel||"none",permissions:n?.adminPermissions||[]}}catch(t){return console.error("Error getting admin status:",t),{isAdmin:!1,adminLevel:"none",permissions:[]}}}static async verifyAdminAccess(e){return!e||!this.isAdmin(e)?!1:(await this.getAdminStatus(e.uid)).isAdmin}static async getAllUsers(e=100){try{const t=Pe(Ne(te,"users"),Gt("createdAt","desc"),Ht(e)),n=await Fe(t),i=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await At(l(te,"profiles",l.id));m.exists()&&(h=m.data())}catch{console.warn("Could not load profile for user:",l.id)}i.push({id:l.id,...u,profile:h,displayName:h.displayName||u.displayName||u.email?.split("@")[0]||"Unknown",joinDate:u.createdAt?.toDate?.()||new Date,lastSeen:u.lastLogin?.toDate?.()||u.createdAt?.toDate?.()||new Date})}return i}catch(t){throw console.error("Error getting all users:",t),t}}static async updateUserPremium(e,t){try{return await Mt(xe(te,"users",e),{isPremium:t,premiumUpdatedAt:new Date,premiumUpdatedBy:"admin"}),!0}catch(n){throw console.error("Error updating user premium status:",n),n}}static async updateUserAdmin(e,t,n="admin"){try{const i={isAdmin:t,adminUpdatedAt:new Date,adminUpdatedBy:"super_admin"};return t?(i.adminLevel=n,i.adminPermissions=this.getDefaultPermissions(n)):(i.adminLevel="none",i.adminPermissions=[]),await Mt(xe(te,"users",e),i),!0}catch(i){throw console.error("Error updating user admin status:",i),i}}static getDefaultPermissions(e){switch(e){case"super":return["user_management","content_moderation","system_settings","analytics_access","data_export","admin_management"];case"admin":return["user_management","content_moderation","analytics_access"];case"moderator":return["content_moderation"];default:return[]}}static async getPublicCardsForModeration(e=50){try{const t=Pe(Ne(te,"publicCards"),Gt("createdAt","desc"),Ht(e)),n=await Fe(t),i=[];for(const l of n.docs){const u=l.data();let h={};try{if(u.userId){const m=await At(l(te,"users",u.userId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}}catch{console.warn("Could not load author info for card:",l.id)}i.push({id:l.id,...u,author:h,createdDate:u.createdAt?.toDate?.()||new Date})}return i}catch(t){throw console.error("Error getting public cards:",t),t}}static async moderateCard(e,t,n=""){try{const i={moderatedAt:new Date,moderatedBy:"admin",moderationAction:t,moderationReason:n};return t==="hide"?i.isHidden=!0:t==="remove"&&(i.isRemoved=!0),await Mt(xe(te,"publicCards",e),i),!0}catch(i){throw console.error("Error moderating card:",i),i}}static async getSystemStats(){try{const[e,t,n]=await Promise.all([Fe(Ne(te,"users")),Fe(Ne(te,"cards")),Fe(Ne(te,"publicCards"))]),i=e.docs.map(V=>V.data()),l=i.length,u=i.filter(V=>V.isPremium).length,h=i.filter(V=>V.isAdmin).length,m=new Date(Date.now()-10080*60*1e3),p=i.filter(V=>V.createdAt?.toDate?.()>m||V.lastLogin?.toDate?.()>m).length,x=t.size,b=n.size,N=n.docs.map(V=>V.data()).filter(V=>V.createdAt?.toDate?.()>m).length;return{users:{total:l,premium:u,admin:h,recentlyActive:p,conversionRate:l>0?(u/l*100).toFixed(1):0},content:{totalPrivateCards:x,totalPublicCards:b,totalCards:x+b,recentPublicCards:N,avgCardsPerUser:l>0?((x+b)/l).toFixed(1):0},system:{lastUpdated:new Date,status:"operational"}}}catch(e){throw console.error("Error getting system stats:",e),e}}static async logAdminAction(e,t,n={}){try{await Jn(Ne(te,"adminLogs"),{adminUserId:e,action:t,details:n,timestamp:new Date,userAgent:navigator.userAgent,ip:null})}catch(i){console.error("Error logging admin action:",i)}}static async getAdminActivity(e=50){try{const t=Pe(Ne(te,"adminLogs"),Gt("timestamp","desc"),Ht(e)),n=await Fe(t),i=[];for(const l of n.docs){const u=l.data();let h={};try{const m=await At(l(te,"users",u.adminUserId));if(m.exists()){const p=m.data();h={email:p.email,displayName:p.displayName||p.email?.split("@")[0]}}}catch{console.warn("Could not load admin info for log:",l.id)}i.push({id:l.id,...u,admin:h,timestamp:u.timestamp?.toDate?.()||new Date})}return i}catch(t){throw console.error("Error getting admin activity:",t),t}}}const M3=({onClose:s})=>{const{user:e}=Sn(),[t,n]=P.useState(null),[i,l]=P.useState(!0),[u,h]=P.useState("overview"),[m,p]=P.useState(null),[x,b]=P.useState([]),[w,N]=P.useState([]),[V,D]=P.useState([]);P.useEffect(()=>{e&&q()},[e]);const q=async()=>{try{if(l(!0),!await Hs.verifyAdminAccess(e)){s&&s();return}const A=await Hs.getAdminStatus(e.uid);n(A),await z()}catch(T){console.error("Error checking admin access:",T),s&&s()}finally{l(!1)}},z=async()=>{try{const T=await Hs.getSystemStats();p(T)}catch(T){console.error("Error loading system stats:",T)}},B=async()=>{try{const T=await Hs.getAllUsers(100);b(T)}catch(T){console.error("Error loading users:",T)}},L=async()=>{try{const T=await Hs.getPublicCardsForModeration(50);N(T)}catch(T){console.error("Error loading public cards:",T)}},G=async()=>{try{const T=await Hs.getAdminActivity(30);D(T)}catch(T){console.error("Error loading admin activity:",T)}},H=async T=>{switch(h(T),T){case"users":await B();break;case"content":await L();break;case"activity":await G();break}},R=async(T,A)=>{try{await Hs.updateUserPremium(T,A),await Hs.logAdminAction(e.uid,"user_premium_update",{targetUserId:T,newStatus:A}),await B()}catch(k){console.error("Error updating user premium:",k),alert("Failed to update user premium status")}},C=async(T,A,k="")=>{try{await Hs.moderateCard(T,A,k),await Hs.logAdminAction(e.uid,"content_moderation",{cardId:T,action:A,reason:k}),await L()}catch(U){console.error("Error moderating card:",U),alert("Failed to moderate content")}};return i?o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-red-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"claude-text-secondary",children:"Verifying admin access..."})]})}):t?.isAdmin?o.jsx("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-extrabold mb-2 text-red-600",children:"🔧 Admin Dashboard"}),o.jsx("p",{className:"claude-text-secondary",children:"System management and content moderation"}),o.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[o.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[t.adminLevel.toUpperCase()," ADMIN"]}),o.jsxs("span",{className:"text-sm claude-text-muted",children:["Logged in as: ",e.email]})]})]}),o.jsxs("div",{className:"flex items-center gap-4 mt-4 md:mt-0",children:[o.jsx("button",{onClick:z,className:"claude-button-secondary",children:"🔄 Refresh Data"}),s&&o.jsx("button",{onClick:s,className:"claude-button-secondary",children:"✕ Close Admin"})]})]}),o.jsx("div",{className:"mb-8 claude-card p-4 bg-gradient-to-r from-red-50 to-orange-50 border-red-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:"⚠️"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-semibold text-red-800",children:"Administrator Mode Active"}),o.jsx("div",{className:"text-sm text-red-600",children:"All actions are logged. Use admin privileges responsibly."})]})]})}),o.jsx("div",{className:"flex space-x-1 mb-8 claude-card p-1 rounded-2xl",children:[{id:"overview",label:"📊 Overview",icon:"📊"},{id:"users",label:"👥 Users",icon:"👥"},{id:"content",label:"📝 Content",icon:"📝"},{id:"activity",label:"📋 Activity",icon:"📋"}].map(T=>o.jsxs("button",{onClick:()=>H(T.id),className:`flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-200 ${u===T.id?"bg-red-500 text-white shadow-lg":"claude-text-secondary hover:bg-gray-100"}`,children:[o.jsx("span",{className:"mr-2",children:T.icon}),o.jsx("span",{className:"hidden sm:inline",children:T.label.replace(/^.+\s/,"")})]},T.id))}),u==="overview"&&o.jsx(V3,{systemStats:m}),u==="users"&&o.jsx(O3,{users:x,onPremiumToggle:R}),u==="content"&&o.jsx(L3,{publicCards:w,onModerate:C}),u==="activity"&&o.jsx(U3,{adminActivity:V})]})}):o.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center",style:{backgroundColor:"var(--claude-background)"},children:o.jsxs("div",{className:"claude-card p-8 text-center max-w-md",children:[o.jsx("div",{className:"text-6xl mb-4",children:"🚫"}),o.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-600",children:"Access Denied"}),o.jsx("p",{className:"claude-text-secondary mb-6",children:"You don't have administrator privileges to access this dashboard."}),o.jsx("button",{onClick:s,className:"claude-button-primary",children:"Return to App"})]})})},V3=({systemStats:s})=>o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[o.jsx(vf,{title:"Total Users",value:s?.users?.total||0,icon:"👥",color:"blue",subtitle:`${s?.users?.recentlyActive||0} active this week`}),o.jsx(vf,{title:"Premium Users",value:s?.users?.premium||0,icon:"⭐",color:"gold",subtitle:`${s?.users?.conversionRate||0}% conversion rate`}),o.jsx(vf,{title:"Total Content",value:s?.content?.totalCards||0,icon:"📚",color:"green",subtitle:`${s?.content?.totalPublicCards||0} public cards`}),o.jsx(vf,{title:"Recent Activity",value:s?.content?.recentPublicCards||0,icon:"📈",color:"purple",subtitle:"New public cards this week"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[o.jsx("span",{className:"text-green-500",children:"🟢"}),"System Status"]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Database"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Authentication"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"File Storage"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Analytics"}),o.jsx("span",{className:"text-green-600 font-medium",children:"Operational"})]})]})]}),o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsx("h3",{className:"text-xl font-bold mb-4",children:"📊 Usage Statistics"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Avg Cards per User"}),o.jsx("span",{className:"font-medium",children:s?.content?.avgCardsPerUser||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Admin Users"}),o.jsx("span",{className:"font-medium",children:s?.users?.admin||0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Public vs Private"}),o.jsxs("span",{className:"font-medium",children:[s?.content?.totalPublicCards||0," / ",s?.content?.totalPrivateCards||0]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Last Updated"}),o.jsx("span",{className:"font-medium text-sm",children:s?.system?.lastUpdated?new Date(s.system.lastUpdated).toLocaleTimeString():"Never"})]})]})]})]})]}),O3=({users:s,onPremiumToggle:e})=>o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",children:"User Management"}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," users loaded"]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold",children:t.displayName}),o.jsx("p",{className:"text-sm claude-text-muted",children:t.email}),o.jsxs("p",{className:"text-xs claude-text-muted",children:["Joined: ",t.joinDate.toLocaleDateString()]})]}),o.jsxs("div",{className:"flex flex-col gap-1",children:[t.isPremium&&o.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"Premium"}),t.isAdmin&&o.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:"Admin"})]})]}),o.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Profile:"}),o.jsx("span",{children:t.profile?.displayName?"Complete":"Incomplete"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Last Seen:"}),o.jsx("span",{children:t.lastSeen.toLocaleDateString()})]})]}),o.jsx("div",{className:"space-y-2",children:o.jsx("button",{onClick:()=>e(t.id,!t.isPremium),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t.isPremium?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.isPremium?"❌ Remove Premium":"⭐ Grant Premium"})})]},t.id))})]}),L3=({publicCards:s,onModerate:e})=>o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",children:"Content Moderation"}),o.jsxs("div",{className:"text-sm claude-text-muted",children:[s.length," public cards"]})]}),o.jsxs("div",{className:"space-y-4",children:[s.map(t=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("h4",{className:"font-bold mb-2",children:[t.statement?.substring(0,100),"..."]}),o.jsxs("div",{className:"flex items-center gap-4 text-sm claude-text-muted",children:[o.jsxs("span",{children:["By: ",t.author?.displayName||t.author?.email||"Unknown"]}),o.jsxs("span",{children:["Created: ",t.createdDate.toLocaleDateString()]}),o.jsxs("span",{children:["Likes: ",t.likeCount||0]}),o.jsxs("span",{children:["Views: ",t.viewCount||0]})]})]}),o.jsxs("div",{className:"flex gap-2 ml-4",children:[o.jsx("button",{onClick:()=>e(t.id,"hide","Hidden by admin"),className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-sm hover:bg-yellow-200",children:"👁️ Hide"}),o.jsx("button",{onClick:()=>e(t.id,"remove","Removed by admin"),className:"px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200",children:"🗑️ Remove"})]})]}),t.isHidden&&o.jsx("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:"⚠️ This card is currently hidden from public view"}),t.isRemoved&&o.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:"🚫 This card has been removed"})]},t.id)),s.length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No public cards found"})]})]}),U3=({adminActivity:s})=>o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h3",{className:"text-xl font-bold",children:"Admin Activity Log"}),o.jsxs("div",{className:"text-sm claude-text-muted",children:["Recent ",s.length," actions"]})]}),o.jsxs("div",{className:"space-y-3",children:[s.map(e=>o.jsx("div",{className:"claude-card p-4 rounded-xl",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:e.action.replace(/_/g," ").toUpperCase()}),o.jsxs("div",{className:"text-sm claude-text-muted",children:["By: ",e.admin?.displayName||e.admin?.email||"Unknown"]}),e.details&&Object.keys(e.details).length>0&&o.jsxs("div",{className:"text-xs claude-text-muted mt-1",children:["Details: ",JSON.stringify(e.details,null,2)]})]}),o.jsx("div",{className:"text-xs claude-text-muted",children:e.timestamp.toLocaleString()})]})},e.id)),s.length===0&&o.jsx("div",{className:"text-center py-8 claude-text-muted",children:"No admin activity recorded"})]})]}),vf=({title:s,value:e,icon:t,color:n,subtitle:i})=>o.jsxs("div",{className:"claude-card p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("div",{className:"text-2xl",children:t}),o.jsx("div",{className:`w-3 h-3 rounded-full bg-${n}-500`})]}),o.jsx("div",{className:`text-2xl font-bold mb-1 text-${n}-600`,children:e}),o.jsx("div",{className:"text-sm font-medium mb-1",children:s}),i&&o.jsx("div",{className:"text-xs claude-text-muted",children:i})]});function F3(){const[s,e]=P.useState("home"),[t,n]=P.useState(null),[i,l]=P.useState(null),[u,h]=P.useState(null),[m,p]=P.useState({hasProfile:!1,hasCards:!1}),[x,b]=P.useState(!1),[w,N]=P.useState(!1),[V,D]=P.useState(!1),[q,z]=P.useState(!1),[B,L]=P.useState(0),[G,H]=P.useState(!1),{user:R,signInWithGoogle:C,logout:T,authError:A,getFreshIdToken:k,sessionWarning:U,dismissSessionWarning:$}=Sn();P.useEffect(()=>{R&&ze()},[R]),P.useEffect(()=>{_n.initializeAutoTracking(R?.uid),_n.trackFeatureUsage("app","loaded",{userLoggedIn:!!R},R?.uid)},[]),P.useEffect(()=>{if(s){_n.trackPageView(`/new/${s}`,null,R?.uid),_n.trackUserFlow(localStorage.getItem("lastMode")||"home",s,"navigation",R?.uid),localStorage.setItem("lastMode",s);const we=new URL(window.location);we.searchParams.set("mode",s),window.history.replaceState({mode:s},"",we.toString())}},[s]),P.useEffect(()=>{const we=ye=>{const Oe=new URLSearchParams(window.location.search).get("mode")||ye.state?.mode||"home";e(Oe)};window.addEventListener("popstate",we);const le=new URLSearchParams(window.location.search).get("mode");return le&&e(le),()=>window.removeEventListener("popstate",we)},[]),P.useEffect(()=>{R?(_n.trackConversion("user_login",1,R.uid),_n.trackFeatureUsage("auth","login_success",{},R.uid),M()):H(!1)},[R]);const M=async()=>{try{const we=await Hs.verifyAdminAccess(R);H(we)}catch(we){console.error("Error checking admin status:",we),H(!1)}},ze=async()=>{try{const we=await Mf.checkOnboardingStatus(R.uid),Ee=await ns.hasProfile(R.uid);try{const le=await Mf.autoMigrateUserDecks(R.uid);le.success&&le.migrationResult&&console.log("✅ Deck migration completed:",le.message)}catch(le){console.warn("Deck migration failed:",le)}p({...we,hasProfile:we.hasProfile||Ee})}catch(we){console.error("Error checking onboarding status:",we)}},se=async()=>{try{await C()}catch(we){console.error("Error signing in:",we)}},F=async()=>{try{await T()}catch(we){console.error("Error signing out:",we)}},ie=async()=>{if(!R){await se();return}try{const we=await Mf.getUserProfile(R.uid);e(we?"dashboard":"create-profile")}catch(we){console.error("Error checking profile:",we),e("create-profile")}},K=async we=>{if(!R){await se();return}we==="profile"&&!m.hasProfile&&e("create-profile")},pe=async()=>{await ze(),e("home")},j=we=>{n(we),e("profile")},oe=()=>{L(we=>we+1),R&&ze()},ge=()=>{switch(s){case"create":return o.jsx(t3,{onCardCreated:oe,onClose:()=>e("home")});case"study":return o.jsx(n3,{},B);case"search":return o.jsx(s3,{});case"decks":return o.jsx(w3,{onCreateDeck:()=>e("create-deck"),onEditDeck:we=>{l(we),e("edit-deck")},onSelectDeck:we=>{h(we),e("study")}});case"create-deck":return o.jsx(lE,{onDeckCreated:()=>e("decks"),onClose:()=>e("decks")});case"edit-deck":return o.jsx(lE,{editingDeck:i,onDeckCreated:()=>{l(null),e("decks")},onClose:()=>{l(null),e("decks")}});case"analytics":return o.jsx(E3,{onClose:()=>e("home")});case"admin-analytics":return o.jsx(j3,{onClose:()=>e("home")});case"admin-dashboard":return o.jsx(M3,{onClose:()=>e("home")});case"leaderboard":return o.jsx(a3,{});case"dashboard":return o.jsx(l3,{});case"create-profile":return o.jsx(x3,{onProfileCreated:pe,onClose:()=>e("home")});case"social":return o.jsx(v3,{onViewProfile:j});case"profile":return o.jsx(_3,{profileSlug:t,onClose:()=>e("home")});default:return Ae()}},me=()=>{const[we,Ee]=P.useState(!1),[le,ye]=P.useState(!1),[Te,Oe]=P.useState(!1),[nt,He]=P.useState(!1);return o.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-md border-b",style:{backgroundColor:"rgba(246, 245, 236, 0.8)",borderBottomColor:"var(--border-light)"},children:[o.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3 group cursor-pointer",onClick:()=>e("home"),children:[o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"40",height:"40",className:"rounded-xl shadow-lg group-hover:shadow-blue-500/25 transition-all duration-300 group-hover:scale-105"}),o.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"})]}),o.jsx("span",{className:"text-xl md:text-2xl font-extrabold tracking-tight",style:{color:"var(--claude-heading)"},children:"Three‑Sided"})]}),s==="home"&&R&&o.jsxs("div",{className:"hidden lg:flex items-center gap-3",children:[o.jsx("button",{className:"claude-button-secondary",onClick:()=>e("search"),children:"🔍 Search"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>ye(!le),onBlur:()=>setTimeout(()=>ye(!1),200),children:"📚 Study ▾"}),le&&o.jsxs("div",{className:"absolute top-full mt-1 left-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),ye(!1)},children:"📚 My Decks"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),ye(!1)},children:"🎯 Study Mode"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),ye(!1)},children:"✏️ Create Flashcard"})]})]}),o.jsx("button",{className:"claude-button-secondary",onClick:()=>e("social"),children:"👥 Social"}),o.jsx("button",{className:"claude-button-secondary",onClick:()=>e("leaderboard"),children:"🏆 Leaderboard"}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{className:"claude-button-secondary flex items-center gap-1",onClick:()=>Oe(!Te),onBlur:()=>setTimeout(()=>Oe(!1),200),children:"👤 Account ▾"}),Te&&o.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Oe(!1)},children:"🎯 My Dashboard"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{ie(),Oe(!1)},children:"👤 My Profile"}),o.jsx("div",{className:"border-t border-gray-200 my-1"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Oe(!1),_n.trackClick("button",{text:"Analytics",action:"view_analytics"},R?.uid)},children:"📊 Learning Analytics"})]})]}),G&&o.jsxs("div",{className:"relative",children:[o.jsx("button",{className:"claude-button-secondary bg-red-50 text-red-700 hover:bg-red-100 border-red-200 flex items-center gap-1",onClick:()=>He(!nt),onBlur:()=>setTimeout(()=>He(!1),200),children:"🔧 Admin ▾"}),nt&&o.jsxs("div",{className:"absolute top-full mt-1 right-0 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-48 z-60",children:[o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors",onClick:()=>{e("admin-analytics"),He(!1),_n.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},R?.uid)},children:"🚀 Website Analytics"}),o.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors text-red-600",onClick:()=>{e("admin-dashboard"),He(!1),_n.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},R?.uid)},children:"🔧 Admin Dashboard"})]})]})]}),s!=="home"&&o.jsx("div",{className:"hidden md:block",children:o.jsxs("span",{className:"text-lg font-bold",style:{color:"var(--claude-heading)"},children:[s==="create"&&"✏️ Create Flashcard",s==="study"&&"📚 Study Mode",s==="search"&&"🔍 Search & Discovery",s==="decks"&&"📚 My Decks",s==="create-deck"&&"➕ Create Deck",s==="edit-deck"&&"✏️ Edit Deck",s==="analytics"&&"📊 Learning Analytics",s==="admin-analytics"&&"🚀 Website Analytics",s==="admin-dashboard"&&"🔧 Admin Dashboard",s==="leaderboard"&&"🏆 Leaderboard & Stats",s==="dashboard"&&"🎯 My Dashboard",s==="social"&&"👥 Social Hub",s==="create-profile"&&"👤 Create Profile",t&&"👤 Profile"]})}),o.jsxs("div",{className:"flex items-center gap-3",children:[R&&o.jsx("button",{className:"lg:hidden claude-button-secondary",onClick:()=>Ee(!we),children:"☰"}),R?o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-2 rounded-xl",style:{backgroundColor:"rgba(91, 200, 162, 0.15)",border:"1px solid var(--success)",color:"var(--success)"},children:[o.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),o.jsx("span",{className:"text-sm font-medium",children:R.displayName?.split(" ")[0]||"User"})]}),o.jsx("button",{className:"claude-button-secondary",style:{borderColor:"var(--error)",color:"var(--error)"},onClick:F,children:"Sign Out"})]}):o.jsxs("div",{className:"flex flex-col items-end gap-2",children:[A&&o.jsx("div",{className:"text-xs text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200 max-w-xs text-right",children:A}),o.jsx("button",{className:"claude-button-primary transform hover:scale-105 transition-all duration-200",onClick:se,children:"✨ Sign In"})]})]})]}),R&&we&&o.jsx("div",{className:"lg:hidden bg-white border-t border-gray-200 shadow-lg",children:o.jsxs("div",{className:"px-4 py-3 space-y-2",children:[o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("search"),Ee(!1)},children:"🔍 Search"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("decks"),Ee(!1)},children:"📚 My Decks"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("study"),Ee(!1)},children:"🎯 Study Mode"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("create"),Ee(!1)},children:"✏️ Create Flashcard"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("social"),Ee(!1)},children:"👥 Social"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("leaderboard"),Ee(!1)},children:"🏆 Leaderboard"}),o.jsx("div",{className:"border-t border-gray-200 my-2"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("dashboard"),Ee(!1)},children:"🎯 My Dashboard"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{ie(),Ee(!1)},children:"👤 My Profile"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>{e("analytics"),Ee(!1),_n.trackClick("button",{text:"Analytics",action:"view_analytics"},R?.uid)},children:"📊 Learning Analytics"}),G&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-red-200 my-2"}),o.jsx("div",{className:"px-3 py-1 text-xs font-semibold text-red-600 bg-red-50 rounded-lg mb-2",children:"🔧 ADMIN CONTROLS"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-analytics"),Ee(!1),_n.trackClick("button",{text:"Website Analytics",action:"view_admin_analytics"},R?.uid)},children:"🚀 Website Analytics"}),o.jsx("button",{className:"w-full text-left py-2 px-3 rounded-lg hover:bg-red-50 transition-colors text-red-600 font-medium",onClick:()=>{e("admin-dashboard"),Ee(!1),_n.trackClick("button",{text:"Admin Dashboard",action:"view_admin_dashboard"},R?.uid)},children:"🔧 Admin Dashboard"})]})]})})]})},Ae=()=>o.jsxs("div",{className:"min-h-screen pt-20",style:{backgroundColor:"var(--claude-background)"},children:[!R&&o.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, var(--claude-background) 0%, var(--claude-subtle) 50%, var(--claude-surface) 100%)"},children:[o.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234B284E' fill-opacity='0.05'%3E%3Cpath d='m36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),o.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(99, 91, 255, 0.08)"}}),o.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse",style:{backgroundColor:"rgba(68, 90, 255, 0.08)",animationDelay:"1s"}}),o.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full blur-2xl animate-pulse",style:{backgroundColor:"rgba(91, 194, 162, 0.08)",animationDelay:"2s"}})]}),o.jsxs("div",{className:"max-w-7xl mx-auto px-4 relative z-10 text-center py-24",children:[o.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full mb-8",style:{backgroundColor:"rgba(91, 194, 162, 0.15)",border:"1px solid var(--claude-success)",color:"var(--claude-success)"},children:[o.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--claude-success)"}}),o.jsx("span",{className:"text-sm font-semibold",children:"✨ New React Version - Live Now"})]}),o.jsxs("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-extrabold tracking-tight mb-8",style:{color:"var(--heading)"},children:["Master Any Subject",o.jsx("br",{}),o.jsx("span",{style:{color:"var(--accent-primary)"},children:"with Three‑Sided"})]}),o.jsxs("p",{className:"text-xl md:text-2xl max-w-4xl mx-auto mb-12 leading-relaxed claude-text-secondary",children:["Create, study, and share flashcards with ",o.jsx("span",{style:{color:"var(--claude-accent)",fontWeight:"600"},children:"AI assistance"}),". Learn faster with ",o.jsx("span",{style:{color:"var(--claude-accent-blue)",fontWeight:"600"},children:"spaced repetition"})," and a",o.jsx("span",{style:{color:"var(--claude-success)",fontWeight:"600"},children:" community library"}),"."]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[o.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group relative min-w-[200px] transform hover:scale-105 transition-all duration-300",style:{background:"var(--claude-accent)",boxShadow:"0 8px 32px rgba(99, 91, 255, 0.25)"},children:[o.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:["🔍 ",o.jsx("span",{children:"Search Flashcards"})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),o.jsx("button",{onClick:()=>e("leaderboard"),className:"claude-button-secondary group transform hover:scale-105 transition-all duration-300 min-w-[200px]",children:o.jsxs("span",{className:"flex items-center gap-3",children:["🏆 ",o.jsx("span",{children:"View Leaderboard"})]})})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-8 justify-center items-center mt-16",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"500+"}),o.jsx("div",{className:"claude-text-muted",children:"Flashcards"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),o.jsx("div",{className:"claude-text-muted",children:"Students"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-3xl font-bold",style:{color:"var(--heading)"},children:"150+"}),o.jsx("div",{className:"claude-text-muted",children:"Public"})]})]})]}),o.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce",children:o.jsx("div",{className:"w-6 h-10 border-2 border-neutral-400 rounded-full flex justify-center",children:o.jsx("div",{className:"w-1 h-3 bg-neutral-400 rounded-full mt-2 animate-pulse"})})})]}),o.jsxs("div",{className:`max-w-7xl mx-auto px-4 ${R?"py-8":"py-16"}`,children:[R&&o.jsxs("div",{className:"relative p-8 mb-16 rounded-3xl bg-neutral-800/50 border border-neutral-700 backdrop-blur-sm shadow-2xl",children:[o.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r from-blue-500/5 to-purple-500/5"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--claude-heading)"},children:"🚀 Quick Actions"}),o.jsx("p",{className:"text-neutral-300 text-lg",children:"Jump into your learning journey"})]}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6",children:[o.jsxs("button",{onClick:()=>{e("create"),_n.trackClick("homepage_action",{action:"create_flashcard",location:"quick_actions"},R?.uid),_n.trackFeatureUsage("flashcard","create_started",{},R?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--success) 0%, #10b981 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:"✏️"}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Create"}),o.jsx("div",{className:"text-white/90 text-sm",children:"New Flashcard"})]})]}),o.jsxs("button",{onClick:()=>{e("study"),_n.trackClick("homepage_action",{action:"study_mode",location:"quick_actions"},R?.uid),_n.trackFeatureUsage("study","session_started",{},R?.uid)},className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--accent-secondary) 0%, #3D4EE6 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:"📚"}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Study"}),o.jsx("div",{className:"text-white/90 text-sm",children:"Practice Mode"})]})]}),o.jsxs("button",{onClick:()=>e("search"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--accent-primary) 0%, #5B54E6 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:"🔍"}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Search"}),o.jsx("div",{className:"text-white/90 text-sm",children:"& Discover"})]})]}),o.jsxs("button",{onClick:()=>e("dashboard"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, var(--warning) 0%, #E6A441 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:"🎯"}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Dashboard"}),o.jsx("div",{className:"text-white/90 text-sm",children:"My Progress"})]})]}),o.jsxs("button",{onClick:()=>e("decks"),className:"claude-card group relative overflow-hidden p-6 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",style:{background:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)"},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center text-white",children:[o.jsx("div",{className:"text-4xl mb-3",children:"📚"}),o.jsx("div",{className:"font-bold text-lg mb-1",children:"Decks"}),o.jsx("div",{className:"text-white/90 text-sm",children:"Organize Cards"})]})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 gap-8 mb-16 lg:grid-cols-3",children:[o.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:"👥"}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"Community‑Driven"}),o.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Discover and share flashcards with students worldwide. Learn from the community's collective knowledge and contribute your own."})]})]}),o.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:"🧠"}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"AI‑Powered Assistance"}),o.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Get AI‑generated hints, proofs, and suggestions to help you create better flashcards faster and study more effectively."})]})]}),o.jsxs("div",{className:"claude-card group relative overflow-hidden p-8 transition-all duration-500 hover:scale-105",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl mb-6 text-4xl shadow-lg group-hover:shadow-xl transition-all duration-300",children:"📐"}),o.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:"var(--heading)"},children:"LaTeX Support"}),o.jsx("p",{className:"claude-text-secondary leading-relaxed",children:"Beautiful mathematical notation with full LaTeX rendering. Use $...$ for inline math and $$...$$ for display blocks."})]})]})]}),o.jsxs("div",{className:"claude-card relative p-8 mb-16 backdrop-blur-sm shadow-2xl",children:[o.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-success-500/5 to-accent-500/5"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h2",{className:"text-4xl font-extrabold mb-3",style:{color:"var(--heading)"},children:"🚀 Get Started"}),o.jsx("p",{className:"claude-text-secondary text-lg",children:"Complete these quick steps to join our community"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 cursor-pointer ${R?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10"}`,onClick:()=>K("login"),children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${R?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:R?"✓":"1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:R?"Signed In":"Sign In"}),o.jsx("div",{className:"claude-text-secondary text-sm",children:R?`Welcome, ${R.displayName?.split(" ")[0]||"User"}!`:"Use Google to get started"})]})]})}),o.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasProfile?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":R?"bg-white/5 border-white/20 hover:border-white/40 hover:bg-white/10 cursor-pointer":"bg-white/5 border-white/10 opacity-50"}`,onClick:R&&!m.hasProfile?()=>K("profile"):void 0,children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasProfile?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:m.hasProfile?"✓":"2"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasProfile?"Profile Created":"Create Profile"}),o.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasProfile?"Profile is ready!":"Set display name & avatar"})]})]})}),o.jsx("div",{className:`group relative overflow-hidden p-6 rounded-2xl border-2 transition-all duration-300 ${m.hasCards?"bg-gradient-to-br from-success-500/20 to-success-600/30 border-success-400/40 shadow-lg":R?"bg-white/5 border-white/20":"bg-white/5 border-white/10 opacity-50"}`,children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg ${m.hasCards?"bg-success-500 text-white":"bg-primary-500 text-white"}`,children:m.hasCards?"✓":"3"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"var(--heading)"},children:m.hasCards?"First Card Published":"Publish First Card"}),o.jsx("div",{className:"claude-text-secondary text-sm",children:m.hasCards?"Nice work!":"Share with the community"})]})]})})]}),R&&!m.hasCards&&o.jsx("div",{className:"text-center mt-8",children:o.jsx("button",{onClick:()=>e("create"),className:"claude-button-primary px-8 py-4 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:"✏️ Create Your First Card"})})]})]}),o.jsxs("div",{className:"relative overflow-hidden p-16 mb-16 rounded-3xl bg-gradient-to-br from-accent-500/20 via-primary-500/20 to-secondary-500/20 border border-white/20 text-center group hover:scale-105 transition-all duration-500",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-accent-500/10 to-primary-500/10"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-accent-400 to-primary-500 rounded-3xl mb-8 text-5xl shadow-2xl group-hover:shadow-glow/80 transition-all duration-300",children:"🔍"}),o.jsx("h2",{className:"text-4xl md:text-5xl font-extrabold mb-6",style:{color:"var(--heading)"},children:"🔍 Looking for something specific?"}),o.jsxs("p",{className:"text-xl claude-text-secondary max-w-3xl mx-auto mb-8 leading-relaxed",children:["Search our community database of ",o.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"600"},children:"10,000+ flashcards"})," from",o.jsx("span",{style:{color:"var(--accent-secondary)",fontWeight:"600"},children:" students worldwide"}),". Find exactly what you need to ace your studies."]}),o.jsxs("button",{onClick:()=>e("search"),className:"claude-button-primary group/btn relative overflow-hidden px-12 py-6 font-semibold text-lg shadow-2xl transform hover:scale-105 transition-all duration-300",children:[o.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:["🔎 ",o.jsx("span",{children:"Search Community Flashcards"})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-white/10 opacity-0 group-hover/btn:opacity-100 transition-opacity duration-300"})]})]})]}),o.jsx("footer",{className:"claude-card relative overflow-hidden mt-24 py-16",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[o.jsxs("div",{className:"text-center mb-12",children:[o.jsxs("div",{className:"inline-flex items-center gap-3 mb-4",children:[o.jsx("img",{src:"/files/three-sided_logo.png",alt:"Three-Sided",width:"48",height:"48",className:"rounded-xl shadow-lg"}),o.jsx("span",{className:"text-3xl font-extrabold",style:{color:"var(--heading)"},children:"Three‑Sided"})]}),o.jsx("p",{className:"claude-text-secondary text-lg max-w-2xl mx-auto",children:"Empowering students worldwide with AI-enhanced flashcards and collaborative learning."})]}),o.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-8 pt-8",style:{borderTop:"1px solid var(--border-light)"},children:[o.jsxs("div",{className:"claude-text-muted",children:["© ",new Date().getFullYear()," Three‑Sided. Made with ❤️ for students."]}),o.jsxs("div",{className:"flex items-center gap-8",children:[o.jsx("a",{href:"mailto:amirbattye@gmail.com",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-primary)"},children:"Contact"}),o.jsx("a",{href:"/latex_guide.html",target:"_blank",rel:"noreferrer",className:"hover:opacity-70 transition-colors duration-200 font-medium",style:{color:"var(--accent-secondary)"},children:"LaTeX Guide"}),o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:"rgba(91, 200, 162, 0.1)",color:"var(--success)"},children:[o.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:"var(--success)"}}),o.jsx("span",{className:"font-medium",children:"Beta"})]})]})]})]})})]})]});return o.jsxs("div",{className:"min-h-screen",children:[o.jsx(me,{}),ge(),o.jsx(u3,{isVisible:x,onClose:()=>b(!1),selectedTags:[],onTagsChange:()=>{}}),o.jsx(f3,{isVisible:w,onClose:()=>N(!1)}),o.jsx(g3,{isVisible:V,onClose:()=>D(!1)}),o.jsx(y3,{isVisible:q,onClose:()=>z(!1)}),U&&o.jsx("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4 shadow-2xl",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("span",{className:"text-2xl",children:"⏰"}),o.jsx("h3",{className:"text-lg font-bold text-orange-600",children:"Session Timeout Warning"})]}),o.jsx("p",{className:"text-gray-700 mb-6",children:`Your session will expire soon due to inactivity. Click "Stay Active" to continue, or you'll be signed out automatically.`}),o.jsxs("div",{className:"flex gap-3 justify-end",children:[o.jsx("button",{onClick:()=>{$(),T()},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Sign Out"}),o.jsx("button",{onClick:$,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Stay Active"})]})]})})]})}const q3=()=>o.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"var(--background-main)"},children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-t-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-lg font-medium",style:{color:"var(--text-main)"},children:"Loading Three-Sided..."})]})});c1.createRoot(document.getElementById("root")).render(o.jsx(P.StrictMode,{children:o.jsx(YV,{fallback:o.jsx(q3,{}),children:o.jsx(F3,{})})}));
